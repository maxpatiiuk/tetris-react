import{ai as i,aj as n,ck as z,k_ as G,al as w,cp as ye,cj as te,k$ as le,bz as $,l0 as ie,l1 as oe,cl as c,bA as R,l2 as ae,ko as O,ay as L,bY as H,f4 as W,d2 as ne,l3 as re,l4 as ue,gM as me,jp as pe,cz as X,l5 as D,dZ as ve,ar as be,b9 as J,ho as ge,d8 as Ve,l6 as Ie,l7 as _e,aG as A,l8 as Se}from"./index-080e108a.js";import{a as we}from"./diffUtils-590c9088.js";var Y;let g=Y=class extends z{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new Y({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};i([n({type:String,json:{write:!0}})],g.prototype,"description",void 0),i([n({type:String,json:{write:!0}})],g.prototype,"label",void 0),i([n({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],g.prototype,"minValue",void 0),i([n({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],g.prototype,"maxValue",void 0),i([n(G)],g.prototype,"symbol",void 0),g=Y=i([w("esri.renderers.support.ClassBreakInfo")],g);const P=g;var Z;const de="log",C="percent-of-total",T="field",M=new ye({esriNormalizeByLog:de,esriNormalizeByPercentOfTotal:C,esriNormalizeByField:T}),qe=te(P);let p=Z=class extends le(pe){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,s,t){if(!Array.isArray(e))return;let l=s.minValue;return e.map(o=>{const a=new P;return a.read(o,t),a.minValue==null&&(a.minValue=l),a.maxValue==null&&(a.maxValue=a.minValue),l=a.maxValue,a})}writeClassBreakInfos(e,s,t,l){const o=e.map(a=>a.write({},l));this._areClassBreaksConsecutive()&&o.forEach(a=>delete a.classMinValue),s[t]=o}castField(e){return e==null?e:typeof e=="function"?($.getLogger(this).error(".field: field must be a string value"),null):ie(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const s=!!this.normalizationField,t=this.normalizationTotal!=null;return s||t?(e=s&&T||t&&C||null,s&&t&&$.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==T&&e!==C||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,s,t){let l=null;l=typeof e=="number"?new P({minValue:e,maxValue:s,symbol:oe(t)}):qe(c(e)),this.classBreakInfos.push(l),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,s){const t=this.classBreakInfos.length;for(let l=0;l<t;l++){const o=[this.classBreakInfos[l].minValue,this.classBreakInfos[l].maxValue];if(o[0]===e&&o[1]===s){this.classBreakInfos.splice(l,1);break}}}getBreakIndex(e,s){return!this.valueExpression||s!=null&&s.arcade!=null||$.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,s):this._getBreakIndexForField(e)}async getClassBreakInfo(e,s){let t=s;!this.valueExpression||s!=null&&s.arcade!=null||(t={...t,arcade:await R()});const l=this.getBreakIndex(e,t);return l!==-1?this.classBreakInfos[l]:null}getSymbol(e,s){if(this.valueExpression&&(s==null||s.arcade==null))return void $.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const t=this.getBreakIndex(e,s);return t>-1?this.classBreakInfos[t].symbol:this.defaultSymbol}async getSymbolAsync(e,s){let t=s;if(this.valueExpression&&(s==null||s.arcade==null)){const o=await R(),{arcadeUtils:a}=o;a.hasGeometryOperations(this.valueExpression)&&await a.enableGeometryOperations(),t={...t,arcade:o}}const l=this.getBreakIndex(e,t);return l>-1?this.classBreakInfos[l].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(s=>{s.symbol&&e.push(s.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,s)=>e+s.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),s=JSON.stringify(this.defaultSymbol),t=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${s}.${this.classBreakInfos.reduce((l,o)=>l+o.getMeshHash(),"")}.${t}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new Z({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:c(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:c(this.visualVariables),legendOptions:c(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,s){const t=[this.collectVVRequiredFields(e,s),this.collectSymbolFields(e,s)];await Promise.all(t)}async collectSymbolFields(e,s){const t=[...this.getSymbols().map(l=>l.collectRequiredFields(e,s)),ae(e,s,this.valueExpression)];O(e,s,this.field),O(e,s,this.normalizationField),await Promise.all(t)}_getBreakIndexForExpression(e,s){const{viewingMode:t,scale:l,spatialReference:o,arcade:a}=s??{},{valueExpression:r}=this;let d=this._compiledValueExpression.valueExpression===r?this._compiledValueExpression.compiledFunction:null;const h=a.arcadeUtils;if(!d){const I=h.createSyntaxTree(r);d=h.createFunction(I),this._compiledValueExpression.compiledFunction=d}this._compiledValueExpression.valueExpression=r;const f=h.executeFunction(d,h.createExecContext(e,h.getViewInfo({viewingMode:t,scale:l,spatialReference:o})));return this._getBreakIndexfromInfos(f)}_getBreakIndexForField(e){const s=this.field,t=e.attributes,l=this.normalizationType;let o=parseFloat(t[s]);if(l){const a=this.normalizationTotal,r=parseFloat(this.normalizationField?t[this.normalizationField]:void 0);if(l===de)o=Math.log(o)*Math.LOG10E;else if(l!==C||a==null||isNaN(a)){if(l===T&&!isNaN(r)){if(isNaN(o)||isNaN(r))return-1;o/=r}}else o=o/a*100}return this._getBreakIndexfromInfos(o)}_getBreakIndexfromInfos(e){const s=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let t=0;t<this.classBreakInfos.length;t++){const l=[this.classBreakInfos[t].minValue,this.classBreakInfos[t].maxValue];if(l[0]<=e&&(s?e<=l[1]:e<l[1]))return t}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,s=e.length;for(let t=1;t<s;t++)if(e[t-1].maxValue!==e[t].minValue)return!1;return!0}};i([n(re)],p.prototype,"backgroundFillSymbol",void 0),i([n({type:[P]})],p.prototype,"classBreakInfos",void 0),i([L("classBreakInfos")],p.prototype,"readClassBreakInfos",null),i([H("classBreakInfos")],p.prototype,"writeClassBreakInfos",null),i([n({type:String,json:{write:!0}})],p.prototype,"defaultLabel",void 0),i([n(G)],p.prototype,"defaultSymbol",void 0),i([n({type:String,json:{write:!0}})],p.prototype,"field",void 0),i([W("field")],p.prototype,"castField",null),i([n({type:Boolean})],p.prototype,"isMaxInclusive",void 0),i([n({type:ue,json:{write:!0}})],p.prototype,"legendOptions",void 0),i([n({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],p.prototype,"minValue",null),i([n({type:String,json:{write:!0}})],p.prototype,"normalizationField",void 0),i([n({type:Number,cast:e=>me(e),json:{write:!0}})],p.prototype,"normalizationTotal",void 0),i([n({type:M.apiValues,value:null,json:{type:M.jsonValues,read:M.read,write:M.write}})],p.prototype,"normalizationType",null),i([ne({classBreaks:"class-breaks"})],p.prototype,"type",void 0),i([n({type:String,json:{write:!0}})],p.prototype,"valueExpression",void 0),i([n({type:String,json:{write:!0}})],p.prototype,"valueExpressionTitle",void 0),p=Z=i([w("esri.renderers.ClassBreaksRenderer")],p);const Ue=p;let q=class extends X(z){constructor(s){super(s),this.value=null,this.value2=null,this.value3=null}};i([n(D)],q.prototype,"value",void 0),i([n(D)],q.prototype,"value2",void 0),i([n(D)],q.prototype,"value3",void 0),q=i([w("esri.renderers.support.UniqueValue")],q);const x=q;let V=class extends X(z){constructor(s){super(s),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(s){if(s==null)return null;const t=typeof(s=Array.isArray(s)?s:[s])[0];return t==="string"||t==="number"?s.map(l=>new x({value:l})):t==="object"?s[0]instanceof x?s:s.map(l=>new x(l)):null}};i([n({type:String,json:{write:!0}})],V.prototype,"description",void 0),i([n({type:String,json:{write:!0}})],V.prototype,"label",void 0),i([n(G)],V.prototype,"symbol",void 0),i([n({type:[x],json:{type:[[String]],read:{reader:e=>e?e.map(s=>new x({value:s[0],value2:s[1],value3:s[2]})):null},write:{writer:(e,s)=>{const t=[];for(const l of e){const o=[l.value,l.value2,l.value3].filter(ve).map(a=>a.toString());t.push(o)}s.values=t}}}})],V.prototype,"values",void 0),i([W("values")],V.prototype,"castValues",null),V=i([w("esri.renderers.support.UniqueValueClass")],V);const he=V;let U=class extends X(z){constructor(e){super(e),this.heading=null,this.classes=null}};i([n({type:String,json:{write:!0}})],U.prototype,"heading",void 0),i([n({type:[he],json:{write:!0}})],U.prototype,"classes",void 0),U=i([w("esri.renderers.support.UniqueValueGroup")],U);const K=U;var Q;let S=Q=class extends z{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new Q({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};i([n({type:String,json:{write:!0}})],S.prototype,"description",void 0),i([n({type:String,json:{write:!0}})],S.prototype,"label",void 0),i([n(G)],S.prototype,"symbol",void 0),i([n(D)],S.prototype,"value",void 0),S=Q=i([w("esri.renderers.support.UniqueValueInfo")],S);const j=S;var B;const ce="esri.renderers.UniqueValueRenderer",b=$.getLogger(ce),ee="uvInfos-watcher",se="uvGroups-watcher",xe=",",Fe=te(j);function ke(e){const{field1:s,field2:t,field3:l,fieldDelimiter:o,uniqueValueInfos:a,valueExpression:r}=e,d=!(!s||!t);return[{classes:(a??[]).map(h=>{var _;const{symbol:f,label:I,value:y,description:m}=h,[F,k,E]=d?((_=y==null?void 0:y.toString())==null?void 0:_.split(o||""))||[]:[y],v=[];return(s||r)&&v.push(F),t&&v.push(k),l&&v.push(E),{symbol:f,label:I,values:[v],description:m}})}]}let u=B=class extends le(pe){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(s,t){if(!s&&!t)return;if(!s||!t)return{type:"complete",oldValue:s,newValue:t};let l=!1;const o={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let a=0;a<t.length;a++){const r=s.find(d=>d.value===t[a].value);r?we(r,t[a])?(o.changed.push({type:"complete",oldValue:r,newValue:t[a]}),l=!0):o.unchanged.push({oldValue:r,newValue:t[a]}):(o.added.push(t[a]),l=!0)}for(let a=0;a<s.length;a++)t.find(r=>r.value===s[a].value)||(o.removed.push(s[a]),l=!0);return l?o:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return e==null||typeof e=="function"?e:ie(e)}writeField(e,s,t,l){typeof e=="string"?s[t]=e:l&&l.messages?l.messages.push(new be("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):b.error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,s,t){return t.portal||J.getDefault()}readStyleOrigin(e,s,t){if(s.styleName)return Object.freeze({styleName:s.styleName});if(s.styleUrl){const l=ge(s.styleUrl,t);return Object.freeze({styleUrl:l})}}writeStyleOrigin(e,s,t,l){e.styleName?s.styleName=e.styleName:e.styleUrl&&(s.styleUrl=Ve(e.styleUrl,l))}set uniqueValueGroups(e){this.styleOrigin?b.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?b.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,s){var l;if(this.styleOrigin)return void b.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let t;t=typeof e=="object"?Fe(e):new j({value:e,symbol:oe(s)}),(l=this.uniqueValueInfos)==null||l.push(t),this._valueInfoMap[t.value]=t,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void b.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const s=this.uniqueValueInfos;if(s){for(let t=0;t<s.length;t++)if(s[t].value===e+""){delete this._valueInfoMap[e],s.splice(t,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,s){let t=s;return!this.valueExpression||s!=null&&s.arcade!=null||(t={...t,arcade:await R()}),this._getUniqueValueInfo(e,t)}getSymbol(e,s){if(this.valueExpression&&(s==null||s.arcade==null))return void b.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const t=this._getUniqueValueInfo(e,s);return t&&t.symbol||this.defaultSymbol}async getSymbolAsync(e,s){let t=s;if(this.valueExpression&&(t==null||t.arcade==null)){const o=await R(),{arcadeUtils:a}=o;a.hasGeometryOperations(this.valueExpression)&&await a.enableGeometryOperations(),t={...t,arcade:o}}const l=this._getUniqueValueInfo(e,t);return l&&l.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const s of this.uniqueValueInfos??[])s.symbol&&e.push(s.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,s)=>e+s.getAttributeHash(),"")}getMeshHash(){var l;const e=JSON.stringify(this.backgroundFillSymbol),s=JSON.stringify(this.defaultSymbol),t=(l=this.uniqueValueInfos)==null?void 0:l.reduce((o,a)=>o+a.getMeshHash(),"");return`${e}.${s}.${t}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new B({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:c(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:c(this.visualVariables),legendOptions:c(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:c(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const s=c(this.uniqueValueInfos),t=c(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(c(this.styleOrigin))),Object.freeze(s),Object.freeze(t)),e._set("uniqueValueInfos",s),e._updateValueInfoMap(),e._set("uniqueValueGroups",t),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,s){const t=[this.collectVVRequiredFields(e,s),this.collectSymbolFields(e,s)];await Promise.all(t)}async collectSymbolFields(e,s){const t=[...this.getSymbols().map(l=>l.collectRequiredFields(e,s)),ae(e,s,this.valueExpression)];O(e,s,this.field),O(e,s,this.field2),O(e,s,this.field3),await Promise.all(t)}populateFromStyle(){return Ie(this.styleOrigin,{portal:this.portal}).then(e=>{var t;const s=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(l=>{const o=new _e({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:l.name});this.defaultSymbol||l.name!==e.data.defaultItem||(this.defaultSymbol=o,this._isDefaultSymbolDerived=!0);const a=new j({value:l.name,symbol:o});s.push(a),this._valueInfoMap[l.name]=a}),this._set("uniqueValueInfos",Object.freeze(s)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((t=this.uniqueValueInfos)!=null&&t.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",xe)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const s of e)this._valueInfoMap[s.value+""]=s}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(ee);const{uniqueValueInfos:e}=this;if(e){const s=[];for(const t of e)s.push(A(()=>({symbol:t.symbol,value:t.value,label:t.label,description:t.description}),(l,o)=>{l!==o&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(s,ee)}}_watchUniqueValueGroups(){this.removeHandles(se);const{uniqueValueGroups:e}=this;if(e){const s=[];for(const t of e){s.push(A(()=>({classes:t.classes}),(l,o)=>{l!==o&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const l of t.classes??[])s.push(A(()=>({symbol:l.symbol,values:l.values,label:l.label,description:l.description}),(o,a)=>{o!==a&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(s,se)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:s,field2:t,field3:l,fieldDelimiter:o,uniqueValueGroups:a,valueExpression:r}=this;if(!s&&!r)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const d=!(!s||!t);for(const h of a)for(const f of h.classes??[]){const{symbol:I,label:y,values:m,description:F}=f;for(const k of m??[]){const{value:E,value2:v,value3:_}=k,N=[E];t&&N.push(v),l&&N.push(_);const fe=d?N.join(o||""):N[0];e.push(new j({symbol:I,label:y,value:fe,description:F}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:s,field2:t,valueExpression:l,fieldDelimiter:o,uniqueValueInfos:a}=this;if(!s&&!l||!a.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const r=!(!s||!t),d=a.map(f=>{var _;const{symbol:I,label:y,value:m,description:F}=f,[k,E,v]=r?((_=m==null?void 0:m.toString())==null?void 0:_.split(o||""))||[]:[m];return new he({symbol:I,label:y,description:F,values:[new x({value:k,value2:E,value3:v})]})}),h=[new K({classes:d})];e&&Object.freeze(h),this._set("uniqueValueGroups",h),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,s){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,s):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,s){const{viewingMode:t,scale:l,spatialReference:o,arcade:a}=s??{};let r=this._cache.compiledFunc;const d=a.arcadeUtils;if(!r){const f=d.createSyntaxTree(this.valueExpression);r=d.createFunction(f),this._cache.compiledFunc=r}const h=d.executeFunction(r,d.createExecContext(e,d.getViewInfo({viewingMode:t,scale:l,spatialReference:o})));return this._valueInfoMap[h+""]}_getUnqiueValueInfoForFields(e){const s=this.field,t=e.attributes;let l;if(typeof s!="function"&&this.field2){const o=this.field2,a=this.field3,r=[];s&&r.push(t[s]),o&&r.push(t[o]),a&&r.push(t[a]),l=r.join(this.fieldDelimiter||"")}else typeof s=="function"?l=s(e):s&&(l=t[s]);return this._valueInfoMap[l+""]}static fromPortalStyle(e,s){const t=new B(s&&s.properties);t._set("styleOrigin",Object.freeze({styleName:e})),t._set("portal",s&&s.portal||J.getDefault());const l=t.populateFromStyle();return l.catch(o=>{b.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",o)}),l}static fromStyleUrl(e,s){const t=new B(s&&s.properties);t._set("styleOrigin",Object.freeze({styleUrl:e}));const l=t.populateFromStyle();return l.catch(o=>{b.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",o)}),l}};i([n({readOnly:!0})],u.prototype,"_cache",null),i([ne({uniqueValue:"unique-value"})],u.prototype,"type",void 0),i([n(re)],u.prototype,"backgroundFillSymbol",void 0),i([n({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],u.prototype,"field",null),i([W("field")],u.prototype,"castField",null),i([H("field")],u.prototype,"writeField",null),i([n({type:String,value:null,json:{write:!0}})],u.prototype,"field2",null),i([n({type:String,value:null,json:{write:!0}})],u.prototype,"field3",null),i([n({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],u.prototype,"orderByClassesEnabled",void 0),i([n({type:String,value:null,json:{write:!0}})],u.prototype,"valueExpression",null),i([n({type:String,json:{write:!0}})],u.prototype,"valueExpressionTitle",void 0),i([n({type:ue,json:{write:!0}})],u.prototype,"legendOptions",void 0),i([n({type:String,json:{write:!0}})],u.prototype,"defaultLabel",void 0),i([n(Se({...G},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],u.prototype,"defaultSymbol",null),i([n({type:String,value:null,json:{write:!0}})],u.prototype,"fieldDelimiter",null),i([n({type:J,readOnly:!0})],u.prototype,"portal",void 0),i([L("portal",["styleName"])],u.prototype,"readPortal",null),i([n({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],u.prototype,"styleOrigin",void 0),i([L("styleOrigin",["styleName","styleUrl"])],u.prototype,"readStyleOrigin",null),i([H("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],u.prototype,"writeStyleOrigin",null),i([n({type:[K],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,s,t)=>(s.uniqueValueGroups||ke(s)).map(l=>K.fromJSON(l,t))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],u.prototype,"uniqueValueGroups",null),i([n({type:[j],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],u.prototype,"uniqueValueInfos",null),u=B=i([w(ce)],u);const je=u;export{je as A,P as a,j as n,Ue as w};
