(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();function o$e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Lpe={exports:{}},CF={},Dpe={exports:{}},Nr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eP=Symbol.for("react.element"),a$e=Symbol.for("react.portal"),l$e=Symbol.for("react.fragment"),c$e=Symbol.for("react.strict_mode"),u$e=Symbol.for("react.profiler"),h$e=Symbol.for("react.provider"),d$e=Symbol.for("react.context"),p$e=Symbol.for("react.forward_ref"),f$e=Symbol.for("react.suspense"),m$e=Symbol.for("react.memo"),g$e=Symbol.for("react.lazy"),qK=Symbol.iterator;function y$e(t){return t===null||typeof t!="object"?null:(t=qK&&t[qK]||t["@@iterator"],typeof t=="function"?t:null)}var Npe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Fpe=Object.assign,Upe={};function sE(t,e,r){this.props=t,this.context=e,this.refs=Upe,this.updater=r||Npe}sE.prototype.isReactComponent={};sE.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};sE.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function kpe(){}kpe.prototype=sE.prototype;function xq(t,e,r){this.props=t,this.context=e,this.refs=Upe,this.updater=r||Npe}var Tq=xq.prototype=new kpe;Tq.constructor=xq;Fpe(Tq,sE.prototype);Tq.isPureReactComponent=!0;var XK=Array.isArray,zpe=Object.prototype.hasOwnProperty,Sq={current:null},Bpe={key:!0,ref:!0,__self:!0,__source:!0};function Vpe(t,e,r){var i,n={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)zpe.call(e,i)&&!Bpe.hasOwnProperty(i)&&(n[i]=e[i]);var a=arguments.length-2;if(a===1)n.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];n.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)n[i]===void 0&&(n[i]=a[i]);return{$$typeof:eP,type:t,key:s,ref:o,props:n,_owner:Sq.current}}function _$e(t,e){return{$$typeof:eP,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Eq(t){return typeof t=="object"&&t!==null&&t.$$typeof===eP}function v$e(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var YK=/\/+/g;function fU(t,e){return typeof t=="object"&&t!==null&&t.key!=null?v$e(""+t.key):e.toString(36)}function CL(t,e,r,i,n){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case eP:case a$e:o=!0}}if(o)return o=t,n=n(o),t=i===""?"."+fU(o,0):i,XK(n)?(r="",t!=null&&(r=t.replace(YK,"$&/")+"/"),CL(n,e,r,"",function(c){return c})):n!=null&&(Eq(n)&&(n=_$e(n,r+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(YK,"$&/")+"/")+t)),e.push(n)),1;if(o=0,i=i===""?".":i+":",XK(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+fU(s,a);o+=CL(s,e,r,l,n)}else if(l=y$e(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+fU(s,a++),o+=CL(s,e,r,l,n);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function dM(t,e,r){if(t==null)return t;var i=[],n=0;return CL(t,i,"","",function(s){return e.call(r,s,n++)}),i}function b$e(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Il={current:null},AL={transition:null},w$e={ReactCurrentDispatcher:Il,ReactCurrentBatchConfig:AL,ReactCurrentOwner:Sq};Nr.Children={map:dM,forEach:function(t,e,r){dM(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return dM(t,function(){e++}),e},toArray:function(t){return dM(t,function(e){return e})||[]},only:function(t){if(!Eq(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Nr.Component=sE;Nr.Fragment=l$e;Nr.Profiler=u$e;Nr.PureComponent=xq;Nr.StrictMode=c$e;Nr.Suspense=f$e;Nr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=w$e;Nr.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Fpe({},t.props),n=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Sq.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)zpe.call(e,l)&&!Bpe.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:eP,type:t.type,key:n,ref:s,props:i,_owner:o}};Nr.createContext=function(t){return t={$$typeof:d$e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:h$e,_context:t},t.Consumer=t};Nr.createElement=Vpe;Nr.createFactory=function(t){var e=Vpe.bind(null,t);return e.type=t,e};Nr.createRef=function(){return{current:null}};Nr.forwardRef=function(t){return{$$typeof:p$e,render:t}};Nr.isValidElement=Eq;Nr.lazy=function(t){return{$$typeof:g$e,_payload:{_status:-1,_result:t},_init:b$e}};Nr.memo=function(t,e){return{$$typeof:m$e,type:t,compare:e===void 0?null:e}};Nr.startTransition=function(t){var e=AL.transition;AL.transition={};try{t()}finally{AL.transition=e}};Nr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Nr.useCallback=function(t,e){return Il.current.useCallback(t,e)};Nr.useContext=function(t){return Il.current.useContext(t)};Nr.useDebugValue=function(){};Nr.useDeferredValue=function(t){return Il.current.useDeferredValue(t)};Nr.useEffect=function(t,e){return Il.current.useEffect(t,e)};Nr.useId=function(){return Il.current.useId()};Nr.useImperativeHandle=function(t,e,r){return Il.current.useImperativeHandle(t,e,r)};Nr.useInsertionEffect=function(t,e){return Il.current.useInsertionEffect(t,e)};Nr.useLayoutEffect=function(t,e){return Il.current.useLayoutEffect(t,e)};Nr.useMemo=function(t,e){return Il.current.useMemo(t,e)};Nr.useReducer=function(t,e,r){return Il.current.useReducer(t,e,r)};Nr.useRef=function(t){return Il.current.useRef(t)};Nr.useState=function(t){return Il.current.useState(t)};Nr.useSyncExternalStore=function(t,e,r){return Il.current.useSyncExternalStore(t,e,r)};Nr.useTransition=function(){return Il.current.useTransition()};Nr.version="18.2.0";Dpe.exports=Nr;var Cq=Dpe.exports;const ai=o$e(Cq);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x$e=Cq,T$e=Symbol.for("react.element"),S$e=Symbol.for("react.fragment"),E$e=Object.prototype.hasOwnProperty,C$e=x$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,A$e={key:!0,ref:!0,__self:!0,__source:!0};function Gpe(t,e,r){var i,n={},s=null,o=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)E$e.call(e,i)&&!A$e.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)n[i]===void 0&&(n[i]=e[i]);return{$$typeof:T$e,type:t,key:s,ref:o,props:n,_owner:C$e.current}}CF.Fragment=S$e;CF.jsx=Gpe;CF.jsxs=Gpe;Lpe.exports=CF;var st=Lpe.exports,_B={},jpe={exports:{}},Tu={},Hpe={exports:{}},Wpe={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(I,L){var B=I.length;I.push(L);e:for(;0<B;){var H=B-1>>>1,Z=I[H];if(0<n(Z,L))I[H]=L,I[B]=Z,B=H;else break e}}function r(I){return I.length===0?null:I[0]}function i(I){if(I.length===0)return null;var L=I[0],B=I.pop();if(B!==L){I[0]=B;e:for(var H=0,Z=I.length,K=Z>>>1;H<K;){var de=2*(H+1)-1,Re=I[de],Ke=de+1,_t=I[Ke];if(0>n(Re,B))Ke<Z&&0>n(_t,Re)?(I[H]=_t,I[Ke]=B,H=Ke):(I[H]=Re,I[de]=B,H=de);else if(Ke<Z&&0>n(_t,B))I[H]=_t,I[Ke]=B,H=Ke;else break e}}return L}function n(I,L){var B=I.sortIndex-L.sortIndex;return B!==0?B:I.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,p=3,m=!1,y=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(I){for(var L=r(c);L!==null;){if(L.callback===null)i(c);else if(L.startTime<=I)i(c),L.sortIndex=L.expirationTime,e(l,L);else break;L=r(c)}}function S(I){if(_=!1,T(I),!y)if(r(l)!==null)y=!0,Q(A);else{var L=r(c);L!==null&&M(S,L.startTime-I)}}function A(I,L){y=!1,_&&(_=!1,b(P),P=-1),m=!0;var B=p;try{for(T(L),d=r(l);d!==null&&(!(d.expirationTime>L)||I&&!V());){var H=d.callback;if(typeof H=="function"){d.callback=null,p=d.priorityLevel;var Z=H(d.expirationTime<=L);L=t.unstable_now(),typeof Z=="function"?d.callback=Z:d===r(l)&&i(l),T(L)}else i(l);d=r(l)}if(d!==null)var K=!0;else{var de=r(c);de!==null&&M(S,de.startTime-L),K=!1}return K}finally{d=null,p=B,m=!1}}var C=!1,R=null,P=-1,F=5,k=-1;function V(){return!(t.unstable_now()-k<F)}function z(){if(R!==null){var I=t.unstable_now();k=I;var L=!0;try{L=R(!0,I)}finally{L?X():(C=!1,R=null)}}else C=!1}var X;if(typeof x=="function")X=function(){x(z)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,G=q.port2;q.port1.onmessage=z,X=function(){G.postMessage(null)}}else X=function(){v(z,0)};function Q(I){R=I,C||(C=!0,X())}function M(I,L){P=v(function(){I(t.unstable_now())},L)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){y||m||(y=!0,Q(A))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(I){switch(p){case 1:case 2:case 3:var L=3;break;default:L=p}var B=p;p=L;try{return I()}finally{p=B}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,L){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var B=p;p=I;try{return L()}finally{p=B}},t.unstable_scheduleCallback=function(I,L,B){var H=t.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?H+B:H):B=H,I){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=B+Z,I={id:u++,callback:L,priorityLevel:I,startTime:B,expirationTime:Z,sortIndex:-1},B>H?(I.sortIndex=B,e(c,I),r(l)===null&&I===r(c)&&(_?(b(P),P=-1):_=!0,M(S,B-H))):(I.sortIndex=Z,e(l,I),y||m||(y=!0,Q(A))),I},t.unstable_shouldYield=V,t.unstable_wrapCallback=function(I){var L=p;return function(){var B=p;p=L;try{return I.apply(this,arguments)}finally{p=B}}}})(Wpe);Hpe.exports=Wpe;var O$e=Hpe.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qpe=Cq,gu=O$e;function Oe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Xpe=new Set,PO={};function Ow(t,e){nS(t,e),nS(t+"Capture",e)}function nS(t,e){for(PO[t]=e,t=0;t<e.length;t++)Xpe.add(e[t])}var Pg=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vB=Object.prototype.hasOwnProperty,R$e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ZK={},QK={};function P$e(t){return vB.call(QK,t)?!0:vB.call(ZK,t)?!1:R$e.test(t)?QK[t]=!0:(ZK[t]=!0,!1)}function M$e(t,e,r,i){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function $$e(t,e,r,i){if(e===null||typeof e>"u"||M$e(t,e,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ll(t,e,r,i,n,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var ga={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ga[t]=new Ll(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ga[e]=new Ll(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ga[t]=new Ll(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ga[t]=new Ll(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ga[t]=new Ll(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ga[t]=new Ll(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ga[t]=new Ll(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ga[t]=new Ll(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ga[t]=new Ll(t,5,!1,t.toLowerCase(),null,!1,!1)});var Aq=/[\-:]([a-z])/g;function Oq(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Aq,Oq);ga[e]=new Ll(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Aq,Oq);ga[e]=new Ll(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Aq,Oq);ga[e]=new Ll(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ga[t]=new Ll(t,1,!1,t.toLowerCase(),null,!1,!1)});ga.xlinkHref=new Ll("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ga[t]=new Ll(t,1,!1,t.toLowerCase(),null,!0,!0)});function Rq(t,e,r,i){var n=ga.hasOwnProperty(e)?ga[e]:null;(n!==null?n.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&($$e(e,r,n,i)&&(r=null),i||n===null?P$e(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):n.mustUseProperty?t[n.propertyName]=r===null?n.type===3?!1:"":r:(e=n.attributeName,i=n.attributeNamespace,r===null?t.removeAttribute(e):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?t.setAttributeNS(i,e,r):t.setAttribute(e,r))))}var Yg=qpe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pM=Symbol.for("react.element"),H2=Symbol.for("react.portal"),W2=Symbol.for("react.fragment"),Pq=Symbol.for("react.strict_mode"),bB=Symbol.for("react.profiler"),Ype=Symbol.for("react.provider"),Zpe=Symbol.for("react.context"),Mq=Symbol.for("react.forward_ref"),wB=Symbol.for("react.suspense"),xB=Symbol.for("react.suspense_list"),$q=Symbol.for("react.memo"),Ey=Symbol.for("react.lazy"),Qpe=Symbol.for("react.offscreen"),JK=Symbol.iterator;function BE(t){return t===null||typeof t!="object"?null:(t=JK&&t[JK]||t["@@iterator"],typeof t=="function"?t:null)}var Yn=Object.assign,mU;function r3(t){if(mU===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);mU=e&&e[1]||""}return`
`+mU+t}var gU=!1;function yU(t,e){if(!t||gU)return"";gU=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=i.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{gU=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?r3(t):""}function I$e(t){switch(t.tag){case 5:return r3(t.type);case 16:return r3("Lazy");case 13:return r3("Suspense");case 19:return r3("SuspenseList");case 0:case 2:case 15:return t=yU(t.type,!1),t;case 11:return t=yU(t.type.render,!1),t;case 1:return t=yU(t.type,!0),t;default:return""}}function TB(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case W2:return"Fragment";case H2:return"Portal";case bB:return"Profiler";case Pq:return"StrictMode";case wB:return"Suspense";case xB:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Zpe:return(t.displayName||"Context")+".Consumer";case Ype:return(t._context.displayName||"Context")+".Provider";case Mq:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case $q:return e=t.displayName||null,e!==null?e:TB(t.type)||"Memo";case Ey:e=t._payload,t=t._init;try{return TB(t(e))}catch{}}return null}function L$e(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return TB(e);case 8:return e===Pq?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function M_(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Jpe(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function D$e(t){var e=Jpe(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function fM(t){t._valueTracker||(t._valueTracker=D$e(t))}function Kpe(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),i="";return t&&(i=Jpe(t)?t.checked?"true":"false":t.value),t=i,t!==r?(e.setValue(t),!0):!1}function SN(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function SB(t,e){var r=e.checked;return Yn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function KK(t,e){var r=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;r=M_(e.value!=null?e.value:r),t._wrapperState={initialChecked:i,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function efe(t,e){e=e.checked,e!=null&&Rq(t,"checked",e,!1)}function EB(t,e){efe(t,e);var r=M_(e.value),i=e.type;if(r!=null)i==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?CB(t,e.type,r):e.hasOwnProperty("defaultValue")&&CB(t,e.type,M_(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function eee(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function CB(t,e,r){(e!=="number"||SN(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var i3=Array.isArray;function ST(t,e,r,i){if(t=t.options,e){e={};for(var n=0;n<r.length;n++)e["$"+r[n]]=!0;for(r=0;r<t.length;r++)n=e.hasOwnProperty("$"+t[r].value),t[r].selected!==n&&(t[r].selected=n),n&&i&&(t[r].defaultSelected=!0)}else{for(r=""+M_(r),e=null,n=0;n<t.length;n++){if(t[n].value===r){t[n].selected=!0,i&&(t[n].defaultSelected=!0);return}e!==null||t[n].disabled||(e=t[n])}e!==null&&(e.selected=!0)}}function AB(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Oe(91));return Yn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function tee(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(Oe(92));if(i3(r)){if(1<r.length)throw Error(Oe(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:M_(r)}}function tfe(t,e){var r=M_(e.value),i=M_(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),i!=null&&(t.defaultValue=""+i)}function ree(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function rfe(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function OB(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?rfe(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var mM,ife=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,i,n){MSApp.execUnsafeLocalFunction(function(){return t(e,r,i,n)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(mM=mM||document.createElement("div"),mM.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mM.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function MO(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var OA={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},N$e=["Webkit","ms","Moz","O"];Object.keys(OA).forEach(function(t){N$e.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),OA[e]=OA[t]})});function nfe(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||OA.hasOwnProperty(t)&&OA[t]?(""+e).trim():e+"px"}function sfe(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=nfe(r,e[r],i);r==="float"&&(r="cssFloat"),i?t.setProperty(r,n):t[r]=n}}var F$e=Yn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function RB(t,e){if(e){if(F$e[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Oe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Oe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Oe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Oe(62))}}function PB(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var MB=null;function Iq(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var $B=null,ET=null,CT=null;function iee(t){if(t=iP(t)){if(typeof $B!="function")throw Error(Oe(280));var e=t.stateNode;e&&(e=MF(e),$B(t.stateNode,t.type,e))}}function ofe(t){ET?CT?CT.push(t):CT=[t]:ET=t}function afe(){if(ET){var t=ET,e=CT;if(CT=ET=null,iee(t),e)for(t=0;t<e.length;t++)iee(e[t])}}function lfe(t,e){return t(e)}function cfe(){}var _U=!1;function ufe(t,e,r){if(_U)return t(e,r);_U=!0;try{return lfe(t,e,r)}finally{_U=!1,(ET!==null||CT!==null)&&(cfe(),afe())}}function $O(t,e){var r=t.stateNode;if(r===null)return null;var i=MF(r);if(i===null)return null;r=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(Oe(231,e,typeof r));return r}var IB=!1;if(Pg)try{var VE={};Object.defineProperty(VE,"passive",{get:function(){IB=!0}}),window.addEventListener("test",VE,VE),window.removeEventListener("test",VE,VE)}catch{IB=!1}function U$e(t,e,r,i,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(u){this.onError(u)}}var RA=!1,EN=null,CN=!1,LB=null,k$e={onError:function(t){RA=!0,EN=t}};function z$e(t,e,r,i,n,s,o,a,l){RA=!1,EN=null,U$e.apply(k$e,arguments)}function B$e(t,e,r,i,n,s,o,a,l){if(z$e.apply(this,arguments),RA){if(RA){var c=EN;RA=!1,EN=null}else throw Error(Oe(198));CN||(CN=!0,LB=c)}}function Rw(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function hfe(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function nee(t){if(Rw(t)!==t)throw Error(Oe(188))}function V$e(t){var e=t.alternate;if(!e){if(e=Rw(t),e===null)throw Error(Oe(188));return e!==t?null:t}for(var r=t,i=e;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return nee(n),t;if(s===i)return nee(n),e;s=s.sibling}throw Error(Oe(188))}if(r.return!==i.return)r=n,i=s;else{for(var o=!1,a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o)throw Error(Oe(189))}}if(r.alternate!==i)throw Error(Oe(190))}if(r.tag!==3)throw Error(Oe(188));return r.stateNode.current===r?t:e}function dfe(t){return t=V$e(t),t!==null?pfe(t):null}function pfe(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=pfe(t);if(e!==null)return e;t=t.sibling}return null}var ffe=gu.unstable_scheduleCallback,see=gu.unstable_cancelCallback,G$e=gu.unstable_shouldYield,j$e=gu.unstable_requestPaint,Ts=gu.unstable_now,H$e=gu.unstable_getCurrentPriorityLevel,Lq=gu.unstable_ImmediatePriority,mfe=gu.unstable_UserBlockingPriority,AN=gu.unstable_NormalPriority,W$e=gu.unstable_LowPriority,gfe=gu.unstable_IdlePriority,AF=null,Mf=null;function q$e(t){if(Mf&&typeof Mf.onCommitFiberRoot=="function")try{Mf.onCommitFiberRoot(AF,t,void 0,(t.current.flags&128)===128)}catch{}}var Qd=Math.clz32?Math.clz32:Z$e,X$e=Math.log,Y$e=Math.LN2;function Z$e(t){return t>>>=0,t===0?32:31-(X$e(t)/Y$e|0)|0}var gM=64,yM=4194304;function n3(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ON(t,e){var r=t.pendingLanes;if(r===0)return 0;var i=0,n=t.suspendedLanes,s=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~n;a!==0?i=n3(a):(s&=o,s!==0&&(i=n3(s)))}else o=r&~n,o!==0?i=n3(o):s!==0&&(i=n3(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&n)&&(n=i&-i,s=e&-e,n>=s||n===16&&(s&4194240)!==0))return e;if(i&4&&(i|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)r=31-Qd(e),n=1<<r,i|=t[r],e&=~n;return i}function Q$e(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function J$e(t,e){for(var r=t.suspendedLanes,i=t.pingedLanes,n=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Qd(s),a=1<<o,l=n[o];l===-1?(!(a&r)||a&i)&&(n[o]=Q$e(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function DB(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function yfe(){var t=gM;return gM<<=1,!(gM&4194240)&&(gM=64),t}function vU(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function tP(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Qd(e),t[e]=r}function K$e(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<r;){var n=31-Qd(r),s=1<<n;e[n]=0,i[n]=-1,t[n]=-1,r&=~s}}function Dq(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var i=31-Qd(r),n=1<<i;n&e|t[i]&e&&(t[i]|=e),r&=~n}}var zi=0;function _fe(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var vfe,Nq,bfe,wfe,xfe,NB=!1,_M=[],m_=null,g_=null,y_=null,IO=new Map,LO=new Map,ky=[],eIe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function oee(t,e){switch(t){case"focusin":case"focusout":m_=null;break;case"dragenter":case"dragleave":g_=null;break;case"mouseover":case"mouseout":y_=null;break;case"pointerover":case"pointerout":IO.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":LO.delete(e.pointerId)}}function GE(t,e,r,i,n,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},e!==null&&(e=iP(e),e!==null&&Nq(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),t)}function tIe(t,e,r,i,n){switch(e){case"focusin":return m_=GE(m_,t,e,r,i,n),!0;case"dragenter":return g_=GE(g_,t,e,r,i,n),!0;case"mouseover":return y_=GE(y_,t,e,r,i,n),!0;case"pointerover":var s=n.pointerId;return IO.set(s,GE(IO.get(s)||null,t,e,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,LO.set(s,GE(LO.get(s)||null,t,e,r,i,n)),!0}return!1}function Tfe(t){var e=ub(t.target);if(e!==null){var r=Rw(e);if(r!==null){if(e=r.tag,e===13){if(e=hfe(r),e!==null){t.blockedOn=e,xfe(t.priority,function(){bfe(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function OL(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=FB(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var i=new r.constructor(r.type,r);MB=i,r.target.dispatchEvent(i),MB=null}else return e=iP(r),e!==null&&Nq(e),t.blockedOn=r,!1;e.shift()}return!0}function aee(t,e,r){OL(t)&&r.delete(e)}function rIe(){NB=!1,m_!==null&&OL(m_)&&(m_=null),g_!==null&&OL(g_)&&(g_=null),y_!==null&&OL(y_)&&(y_=null),IO.forEach(aee),LO.forEach(aee)}function jE(t,e){t.blockedOn===e&&(t.blockedOn=null,NB||(NB=!0,gu.unstable_scheduleCallback(gu.unstable_NormalPriority,rIe)))}function DO(t){function e(n){return jE(n,t)}if(0<_M.length){jE(_M[0],t);for(var r=1;r<_M.length;r++){var i=_M[r];i.blockedOn===t&&(i.blockedOn=null)}}for(m_!==null&&jE(m_,t),g_!==null&&jE(g_,t),y_!==null&&jE(y_,t),IO.forEach(e),LO.forEach(e),r=0;r<ky.length;r++)i=ky[r],i.blockedOn===t&&(i.blockedOn=null);for(;0<ky.length&&(r=ky[0],r.blockedOn===null);)Tfe(r),r.blockedOn===null&&ky.shift()}var AT=Yg.ReactCurrentBatchConfig,RN=!0;function iIe(t,e,r,i){var n=zi,s=AT.transition;AT.transition=null;try{zi=1,Fq(t,e,r,i)}finally{zi=n,AT.transition=s}}function nIe(t,e,r,i){var n=zi,s=AT.transition;AT.transition=null;try{zi=4,Fq(t,e,r,i)}finally{zi=n,AT.transition=s}}function Fq(t,e,r,i){if(RN){var n=FB(t,e,r,i);if(n===null)RU(t,e,i,PN,r),oee(t,i);else if(tIe(n,t,e,r,i))i.stopPropagation();else if(oee(t,i),e&4&&-1<eIe.indexOf(t)){for(;n!==null;){var s=iP(n);if(s!==null&&vfe(s),s=FB(t,e,r,i),s===null&&RU(t,e,i,PN,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else RU(t,e,i,null,r)}}var PN=null;function FB(t,e,r,i){if(PN=null,t=Iq(i),t=ub(t),t!==null)if(e=Rw(t),e===null)t=null;else if(r=e.tag,r===13){if(t=hfe(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return PN=t,null}function Sfe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(H$e()){case Lq:return 1;case mfe:return 4;case AN:case W$e:return 16;case gfe:return 536870912;default:return 16}default:return 16}}var Yy=null,Uq=null,RL=null;function Efe(){if(RL)return RL;var t,e=Uq,r=e.length,i,n="value"in Yy?Yy.value:Yy.textContent,s=n.length;for(t=0;t<r&&e[t]===n[t];t++);var o=r-t;for(i=1;i<=o&&e[r-i]===n[s-i];i++);return RL=n.slice(t,1<i?1-i:void 0)}function PL(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function vM(){return!0}function lee(){return!1}function Su(t){function e(r,i,n,s,o){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?vM:lee,this.isPropagationStopped=lee,this}return Yn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=vM)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=vM)},persist:function(){},isPersistent:vM}),e}var oE={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kq=Su(oE),rP=Yn({},oE,{view:0,detail:0}),sIe=Su(rP),bU,wU,HE,OF=Yn({},rP,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zq,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==HE&&(HE&&t.type==="mousemove"?(bU=t.screenX-HE.screenX,wU=t.screenY-HE.screenY):wU=bU=0,HE=t),bU)},movementY:function(t){return"movementY"in t?t.movementY:wU}}),cee=Su(OF),oIe=Yn({},OF,{dataTransfer:0}),aIe=Su(oIe),lIe=Yn({},rP,{relatedTarget:0}),xU=Su(lIe),cIe=Yn({},oE,{animationName:0,elapsedTime:0,pseudoElement:0}),uIe=Su(cIe),hIe=Yn({},oE,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),dIe=Su(hIe),pIe=Yn({},oE,{data:0}),uee=Su(pIe),fIe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mIe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gIe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yIe(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=gIe[t])?!!e[t]:!1}function zq(){return yIe}var _Ie=Yn({},rP,{key:function(t){if(t.key){var e=fIe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=PL(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?mIe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zq,charCode:function(t){return t.type==="keypress"?PL(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?PL(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),vIe=Su(_Ie),bIe=Yn({},OF,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hee=Su(bIe),wIe=Yn({},rP,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zq}),xIe=Su(wIe),TIe=Yn({},oE,{propertyName:0,elapsedTime:0,pseudoElement:0}),SIe=Su(TIe),EIe=Yn({},OF,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),CIe=Su(EIe),AIe=[9,13,27,32],Bq=Pg&&"CompositionEvent"in window,PA=null;Pg&&"documentMode"in document&&(PA=document.documentMode);var OIe=Pg&&"TextEvent"in window&&!PA,Cfe=Pg&&(!Bq||PA&&8<PA&&11>=PA),dee=String.fromCharCode(32),pee=!1;function Afe(t,e){switch(t){case"keyup":return AIe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ofe(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var q2=!1;function RIe(t,e){switch(t){case"compositionend":return Ofe(e);case"keypress":return e.which!==32?null:(pee=!0,dee);case"textInput":return t=e.data,t===dee&&pee?null:t;default:return null}}function PIe(t,e){if(q2)return t==="compositionend"||!Bq&&Afe(t,e)?(t=Efe(),RL=Uq=Yy=null,q2=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Cfe&&e.locale!=="ko"?null:e.data;default:return null}}var MIe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fee(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!MIe[t.type]:e==="textarea"}function Rfe(t,e,r,i){ofe(i),e=MN(e,"onChange"),0<e.length&&(r=new kq("onChange","change",null,r,i),t.push({event:r,listeners:e}))}var MA=null,NO=null;function $Ie(t){zfe(t,0)}function RF(t){var e=Z2(t);if(Kpe(e))return t}function IIe(t,e){if(t==="change")return e}var Pfe=!1;if(Pg){var TU;if(Pg){var SU="oninput"in document;if(!SU){var mee=document.createElement("div");mee.setAttribute("oninput","return;"),SU=typeof mee.oninput=="function"}TU=SU}else TU=!1;Pfe=TU&&(!document.documentMode||9<document.documentMode)}function gee(){MA&&(MA.detachEvent("onpropertychange",Mfe),NO=MA=null)}function Mfe(t){if(t.propertyName==="value"&&RF(NO)){var e=[];Rfe(e,NO,t,Iq(t)),ufe($Ie,e)}}function LIe(t,e,r){t==="focusin"?(gee(),MA=e,NO=r,MA.attachEvent("onpropertychange",Mfe)):t==="focusout"&&gee()}function DIe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return RF(NO)}function NIe(t,e){if(t==="click")return RF(e)}function FIe(t,e){if(t==="input"||t==="change")return RF(e)}function UIe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var op=typeof Object.is=="function"?Object.is:UIe;function FO(t,e){if(op(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!vB.call(e,n)||!op(t[n],e[n]))return!1}return!0}function yee(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function _ee(t,e){var r=yee(t);t=0;for(var i;r;){if(r.nodeType===3){if(i=t+r.textContent.length,t<=e&&i>=e)return{node:r,offset:e-t};t=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=yee(r)}}function $fe(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?$fe(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Ife(){for(var t=window,e=SN();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=SN(t.document)}return e}function Vq(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function kIe(t){var e=Ife(),r=t.focusedElem,i=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&$fe(r.ownerDocument.documentElement,r)){if(i!==null&&Vq(r)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!t.extend&&s>i&&(n=i,i=s,s=n),n=_ee(r,s);var o=_ee(r,i);n&&o&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var zIe=Pg&&"documentMode"in document&&11>=document.documentMode,X2=null,UB=null,$A=null,kB=!1;function vee(t,e,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;kB||X2==null||X2!==SN(i)||(i=X2,"selectionStart"in i&&Vq(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),$A&&FO($A,i)||($A=i,i=MN(UB,"onSelect"),0<i.length&&(e=new kq("onSelect","select",null,e,r),t.push({event:e,listeners:i}),e.target=X2)))}function bM(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var Y2={animationend:bM("Animation","AnimationEnd"),animationiteration:bM("Animation","AnimationIteration"),animationstart:bM("Animation","AnimationStart"),transitionend:bM("Transition","TransitionEnd")},EU={},Lfe={};Pg&&(Lfe=document.createElement("div").style,"AnimationEvent"in window||(delete Y2.animationend.animation,delete Y2.animationiteration.animation,delete Y2.animationstart.animation),"TransitionEvent"in window||delete Y2.transitionend.transition);function PF(t){if(EU[t])return EU[t];if(!Y2[t])return t;var e=Y2[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in Lfe)return EU[t]=e[r];return t}var Dfe=PF("animationend"),Nfe=PF("animationiteration"),Ffe=PF("animationstart"),Ufe=PF("transitionend"),kfe=new Map,bee="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function i1(t,e){kfe.set(t,e),Ow(e,[t])}for(var CU=0;CU<bee.length;CU++){var AU=bee[CU],BIe=AU.toLowerCase(),VIe=AU[0].toUpperCase()+AU.slice(1);i1(BIe,"on"+VIe)}i1(Dfe,"onAnimationEnd");i1(Nfe,"onAnimationIteration");i1(Ffe,"onAnimationStart");i1("dblclick","onDoubleClick");i1("focusin","onFocus");i1("focusout","onBlur");i1(Ufe,"onTransitionEnd");nS("onMouseEnter",["mouseout","mouseover"]);nS("onMouseLeave",["mouseout","mouseover"]);nS("onPointerEnter",["pointerout","pointerover"]);nS("onPointerLeave",["pointerout","pointerover"]);Ow("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ow("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ow("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ow("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ow("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ow("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var s3="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GIe=new Set("cancel close invalid load scroll toggle".split(" ").concat(s3));function wee(t,e,r){var i=t.type||"unknown-event";t.currentTarget=r,B$e(i,e,void 0,t),t.currentTarget=null}function zfe(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var i=t[r],n=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;wee(n,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;wee(n,a,c),s=l}}}if(CN)throw t=LB,CN=!1,LB=null,t}function bn(t,e){var r=e[jB];r===void 0&&(r=e[jB]=new Set);var i=t+"__bubble";r.has(i)||(Bfe(e,t,2,!1),r.add(i))}function OU(t,e,r){var i=0;e&&(i|=4),Bfe(r,t,i,e)}var wM="_reactListening"+Math.random().toString(36).slice(2);function UO(t){if(!t[wM]){t[wM]=!0,Xpe.forEach(function(r){r!=="selectionchange"&&(GIe.has(r)||OU(r,!1,t),OU(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[wM]||(e[wM]=!0,OU("selectionchange",!1,e))}}function Bfe(t,e,r,i){switch(Sfe(e)){case 1:var n=iIe;break;case 4:n=nIe;break;default:n=Fq}r=n.bind(null,e,r,t),n=void 0,!IB||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),i?n!==void 0?t.addEventListener(e,r,{capture:!0,passive:n}):t.addEventListener(e,r,!0):n!==void 0?t.addEventListener(e,r,{passive:n}):t.addEventListener(e,r,!1)}function RU(t,e,r,i,n){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=ub(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}ufe(function(){var c=s,u=Iq(r),d=[];e:{var p=kfe.get(t);if(p!==void 0){var m=kq,y=t;switch(t){case"keypress":if(PL(r)===0)break e;case"keydown":case"keyup":m=vIe;break;case"focusin":y="focus",m=xU;break;case"focusout":y="blur",m=xU;break;case"beforeblur":case"afterblur":m=xU;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=cee;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=aIe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=xIe;break;case Dfe:case Nfe:case Ffe:m=uIe;break;case Ufe:m=SIe;break;case"scroll":m=sIe;break;case"wheel":m=CIe;break;case"copy":case"cut":case"paste":m=dIe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=hee}var _=(e&4)!==0,v=!_&&t==="scroll",b=_?p!==null?p+"Capture":null:p;_=[];for(var x=c,T;x!==null;){T=x;var S=T.stateNode;if(T.tag===5&&S!==null&&(T=S,b!==null&&(S=$O(x,b),S!=null&&_.push(kO(x,S,T)))),v)break;x=x.return}0<_.length&&(p=new m(p,y,null,r,u),d.push({event:p,listeners:_}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",p&&r!==MB&&(y=r.relatedTarget||r.fromElement)&&(ub(y)||y[Mg]))break e;if((m||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,m?(y=r.relatedTarget||r.toElement,m=c,y=y?ub(y):null,y!==null&&(v=Rw(y),y!==v||y.tag!==5&&y.tag!==6)&&(y=null)):(m=null,y=c),m!==y)){if(_=cee,S="onMouseLeave",b="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(_=hee,S="onPointerLeave",b="onPointerEnter",x="pointer"),v=m==null?p:Z2(m),T=y==null?p:Z2(y),p=new _(S,x+"leave",m,r,u),p.target=v,p.relatedTarget=T,S=null,ub(u)===c&&(_=new _(b,x+"enter",y,r,u),_.target=T,_.relatedTarget=v,S=_),v=S,m&&y)t:{for(_=m,b=y,x=0,T=_;T;T=Yw(T))x++;for(T=0,S=b;S;S=Yw(S))T++;for(;0<x-T;)_=Yw(_),x--;for(;0<T-x;)b=Yw(b),T--;for(;x--;){if(_===b||b!==null&&_===b.alternate)break t;_=Yw(_),b=Yw(b)}_=null}else _=null;m!==null&&xee(d,p,m,_,!1),y!==null&&v!==null&&xee(d,v,y,_,!0)}}e:{if(p=c?Z2(c):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var A=IIe;else if(fee(p))if(Pfe)A=FIe;else{A=DIe;var C=LIe}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(A=NIe);if(A&&(A=A(t,c))){Rfe(d,A,r,u);break e}C&&C(t,p,c),t==="focusout"&&(C=p._wrapperState)&&C.controlled&&p.type==="number"&&CB(p,"number",p.value)}switch(C=c?Z2(c):window,t){case"focusin":(fee(C)||C.contentEditable==="true")&&(X2=C,UB=c,$A=null);break;case"focusout":$A=UB=X2=null;break;case"mousedown":kB=!0;break;case"contextmenu":case"mouseup":case"dragend":kB=!1,vee(d,r,u);break;case"selectionchange":if(zIe)break;case"keydown":case"keyup":vee(d,r,u)}var R;if(Bq)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else q2?Afe(t,r)&&(P="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(P="onCompositionStart");P&&(Cfe&&r.locale!=="ko"&&(q2||P!=="onCompositionStart"?P==="onCompositionEnd"&&q2&&(R=Efe()):(Yy=u,Uq="value"in Yy?Yy.value:Yy.textContent,q2=!0)),C=MN(c,P),0<C.length&&(P=new uee(P,t,null,r,u),d.push({event:P,listeners:C}),R?P.data=R:(R=Ofe(r),R!==null&&(P.data=R)))),(R=OIe?RIe(t,r):PIe(t,r))&&(c=MN(c,"onBeforeInput"),0<c.length&&(u=new uee("onBeforeInput","beforeinput",null,r,u),d.push({event:u,listeners:c}),u.data=R))}zfe(d,e)})}function kO(t,e,r){return{instance:t,listener:e,currentTarget:r}}function MN(t,e){for(var r=e+"Capture",i=[];t!==null;){var n=t,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=$O(t,r),s!=null&&i.unshift(kO(t,s,n)),s=$O(t,e),s!=null&&i.push(kO(t,s,n))),t=t.return}return i}function Yw(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function xee(t,e,r,i,n){for(var s=e._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,n?(l=$O(r,s),l!=null&&o.unshift(kO(r,l,a))):n||(l=$O(r,s),l!=null&&o.push(kO(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var jIe=/\r\n?/g,HIe=/\u0000|\uFFFD/g;function Tee(t){return(typeof t=="string"?t:""+t).replace(jIe,`
`).replace(HIe,"")}function xM(t,e,r){if(e=Tee(e),Tee(t)!==e&&r)throw Error(Oe(425))}function $N(){}var zB=null,BB=null;function VB(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var GB=typeof setTimeout=="function"?setTimeout:void 0,WIe=typeof clearTimeout=="function"?clearTimeout:void 0,See=typeof Promise=="function"?Promise:void 0,qIe=typeof queueMicrotask=="function"?queueMicrotask:typeof See<"u"?function(t){return See.resolve(null).then(t).catch(XIe)}:GB;function XIe(t){setTimeout(function(){throw t})}function PU(t,e){var r=e,i=0;do{var n=r.nextSibling;if(t.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){t.removeChild(n),DO(e);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);DO(e)}function __(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Eee(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var aE=Math.random().toString(36).slice(2),vf="__reactFiber$"+aE,zO="__reactProps$"+aE,Mg="__reactContainer$"+aE,jB="__reactEvents$"+aE,YIe="__reactListeners$"+aE,ZIe="__reactHandles$"+aE;function ub(t){var e=t[vf];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Mg]||r[vf]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=Eee(t);t!==null;){if(r=t[vf])return r;t=Eee(t)}return e}t=r,r=t.parentNode}return null}function iP(t){return t=t[vf]||t[Mg],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Z2(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Oe(33))}function MF(t){return t[zO]||null}var HB=[],Q2=-1;function n1(t){return{current:t}}function Mn(t){0>Q2||(t.current=HB[Q2],HB[Q2]=null,Q2--)}function pn(t,e){Q2++,HB[Q2]=t.current,t.current=e}var $_={},Ya=n1($_),_c=n1(!1),Bb=$_;function sS(t,e){var r=t.type.contextTypes;if(!r)return $_;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),n}function vc(t){return t=t.childContextTypes,t!=null}function IN(){Mn(_c),Mn(Ya)}function Cee(t,e,r){if(Ya.current!==$_)throw Error(Oe(168));pn(Ya,e),pn(_c,r)}function Vfe(t,e,r){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in e))throw Error(Oe(108,L$e(t)||"Unknown",n));return Yn({},r,i)}function LN(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||$_,Bb=Ya.current,pn(Ya,t),pn(_c,_c.current),!0}function Aee(t,e,r){var i=t.stateNode;if(!i)throw Error(Oe(169));r?(t=Vfe(t,e,Bb),i.__reactInternalMemoizedMergedChildContext=t,Mn(_c),Mn(Ya),pn(Ya,t)):Mn(_c),pn(_c,r)}var ig=null,$F=!1,MU=!1;function Gfe(t){ig===null?ig=[t]:ig.push(t)}function QIe(t){$F=!0,Gfe(t)}function s1(){if(!MU&&ig!==null){MU=!0;var t=0,e=zi;try{var r=ig;for(zi=1;t<r.length;t++){var i=r[t];do i=i(!0);while(i!==null)}ig=null,$F=!1}catch(n){throw ig!==null&&(ig=ig.slice(t+1)),ffe(Lq,s1),n}finally{zi=e,MU=!1}}return null}var J2=[],K2=0,DN=null,NN=0,sh=[],oh=0,Vb=null,ug=1,hg="";function iv(t,e){J2[K2++]=NN,J2[K2++]=DN,DN=t,NN=e}function jfe(t,e,r){sh[oh++]=ug,sh[oh++]=hg,sh[oh++]=Vb,Vb=t;var i=ug;t=hg;var n=32-Qd(i)-1;i&=~(1<<n),r+=1;var s=32-Qd(e)+n;if(30<s){var o=n-n%5;s=(i&(1<<o)-1).toString(32),i>>=o,n-=o,ug=1<<32-Qd(e)+n|r<<n|i,hg=s+t}else ug=1<<s|r<<n|i,hg=t}function Gq(t){t.return!==null&&(iv(t,1),jfe(t,1,0))}function jq(t){for(;t===DN;)DN=J2[--K2],J2[K2]=null,NN=J2[--K2],J2[K2]=null;for(;t===Vb;)Vb=sh[--oh],sh[oh]=null,hg=sh[--oh],sh[oh]=null,ug=sh[--oh],sh[oh]=null}var cu=null,ou=null,Fn=!1,Fd=null;function Hfe(t,e){var r=yh(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function Oee(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,cu=t,ou=__(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,cu=t,ou=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Vb!==null?{id:ug,overflow:hg}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=yh(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,cu=t,ou=null,!0):!1;default:return!1}}function WB(t){return(t.mode&1)!==0&&(t.flags&128)===0}function qB(t){if(Fn){var e=ou;if(e){var r=e;if(!Oee(t,e)){if(WB(t))throw Error(Oe(418));e=__(r.nextSibling);var i=cu;e&&Oee(t,e)?Hfe(i,r):(t.flags=t.flags&-4097|2,Fn=!1,cu=t)}}else{if(WB(t))throw Error(Oe(418));t.flags=t.flags&-4097|2,Fn=!1,cu=t}}}function Ree(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;cu=t}function TM(t){if(t!==cu)return!1;if(!Fn)return Ree(t),Fn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!VB(t.type,t.memoizedProps)),e&&(e=ou)){if(WB(t))throw Wfe(),Error(Oe(418));for(;e;)Hfe(t,e),e=__(e.nextSibling)}if(Ree(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Oe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){ou=__(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}ou=null}}else ou=cu?__(t.stateNode.nextSibling):null;return!0}function Wfe(){for(var t=ou;t;)t=__(t.nextSibling)}function oS(){ou=cu=null,Fn=!1}function Hq(t){Fd===null?Fd=[t]:Fd.push(t)}var JIe=Yg.ReactCurrentBatchConfig;function Rd(t,e){if(t&&t.defaultProps){e=Yn({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var FN=n1(null),UN=null,eT=null,Wq=null;function qq(){Wq=eT=UN=null}function Xq(t){var e=FN.current;Mn(FN),t._currentValue=e}function XB(t,e,r){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===r)break;t=t.return}}function OT(t,e){UN=t,Wq=eT=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(fc=!0),t.firstContext=null)}function Rh(t){var e=t._currentValue;if(Wq!==t)if(t={context:t,memoizedValue:e,next:null},eT===null){if(UN===null)throw Error(Oe(308));eT=t,UN.dependencies={lanes:0,firstContext:t}}else eT=eT.next=t;return e}var hb=null;function Yq(t){hb===null?hb=[t]:hb.push(t)}function qfe(t,e,r,i){var n=e.interleaved;return n===null?(r.next=r,Yq(e)):(r.next=n.next,n.next=r),e.interleaved=r,$g(t,i)}function $g(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Cy=!1;function Zq(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Xfe(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function gg(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function v_(t,e,r){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,li&2){var n=i.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),i.pending=e,$g(t,r)}return n=i.interleaved,n===null?(e.next=e,Yq(i)):(e.next=n.next,n.next=e),i.interleaved=e,$g(t,r)}function ML(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,Dq(t,r)}}function Pee(t,e){var r=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=o:s=s.next=o,r=r.next}while(r!==null);s===null?n=s=e:s=s.next=e}else n=s=e;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function kN(t,e,r,i){var n=t.updateQueue;Cy=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=n.baseState;o=0,u=c=l=null,a=s;do{var p=a.lane,m=a.eventTime;if((i&p)===p){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=t,_=a;switch(p=e,m=r,_.tag){case 1:if(y=_.payload,typeof y=="function"){d=y.call(m,d,p);break e}d=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=_.payload,p=typeof y=="function"?y.call(m,d,p):y,p==null)break e;d=Yn({},d,p);break e;case 2:Cy=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=n.effects,p===null?n.effects=[a]:p.push(a))}else m={eventTime:m,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=m,l=d):u=u.next=m,o|=p;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;p=a,a=p.next,p.next=null,n.lastBaseUpdate=p,n.shared.pending=null}}while(1);if(u===null&&(l=d),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,e=n.shared.interleaved,e!==null){n=e;do o|=n.lane,n=n.next;while(n!==e)}else s===null&&(n.shared.lanes=0);jb|=o,t.lanes=o,t.memoizedState=d}}function Mee(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(Oe(191,n));n.call(i)}}}var Yfe=new qpe.Component().refs;function YB(t,e,r,i){e=t.memoizedState,r=r(i,e),r=r==null?e:Yn({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var IF={isMounted:function(t){return(t=t._reactInternals)?Rw(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var i=Al(),n=w_(t),s=gg(i,n);s.payload=e,r!=null&&(s.callback=r),e=v_(t,s,n),e!==null&&(Jd(e,t,n,i),ML(e,t,n))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var i=Al(),n=w_(t),s=gg(i,n);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=v_(t,s,n),e!==null&&(Jd(e,t,n,i),ML(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Al(),i=w_(t),n=gg(r,i);n.tag=2,e!=null&&(n.callback=e),e=v_(t,n,i),e!==null&&(Jd(e,t,i,r),ML(e,t,i))}};function $ee(t,e,r,i,n,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!FO(r,i)||!FO(n,s):!0}function Zfe(t,e,r){var i=!1,n=$_,s=e.contextType;return typeof s=="object"&&s!==null?s=Rh(s):(n=vc(e)?Bb:Ya.current,i=e.contextTypes,s=(i=i!=null)?sS(t,n):$_),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=IF,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function Iee(t,e,r,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,i),e.state!==t&&IF.enqueueReplaceState(e,e.state,null)}function ZB(t,e,r,i){var n=t.stateNode;n.props=r,n.state=t.memoizedState,n.refs=Yfe,Zq(t);var s=e.contextType;typeof s=="object"&&s!==null?n.context=Rh(s):(s=vc(e)?Bb:Ya.current,n.context=sS(t,s)),n.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(YB(t,e,s,r),n.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&IF.enqueueReplaceState(n,n.state,null),kN(t,r,n,i),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function WE(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Oe(309));var i=r.stateNode}if(!i)throw Error(Oe(147,t));var n=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=n.refs;a===Yfe&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(Oe(284));if(!r._owner)throw Error(Oe(290,t))}return t}function SM(t,e){throw t=Object.prototype.toString.call(e),Error(Oe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Lee(t){var e=t._init;return e(t._payload)}function Qfe(t){function e(b,x){if(t){var T=b.deletions;T===null?(b.deletions=[x],b.flags|=16):T.push(x)}}function r(b,x){if(!t)return null;for(;x!==null;)e(b,x),x=x.sibling;return null}function i(b,x){for(b=new Map;x!==null;)x.key!==null?b.set(x.key,x):b.set(x.index,x),x=x.sibling;return b}function n(b,x){return b=x_(b,x),b.index=0,b.sibling=null,b}function s(b,x,T){return b.index=T,t?(T=b.alternate,T!==null?(T=T.index,T<x?(b.flags|=2,x):T):(b.flags|=2,x)):(b.flags|=1048576,x)}function o(b){return t&&b.alternate===null&&(b.flags|=2),b}function a(b,x,T,S){return x===null||x.tag!==6?(x=UU(T,b.mode,S),x.return=b,x):(x=n(x,T),x.return=b,x)}function l(b,x,T,S){var A=T.type;return A===W2?u(b,x,T.props.children,S,T.key):x!==null&&(x.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Ey&&Lee(A)===x.type)?(S=n(x,T.props),S.ref=WE(b,x,T),S.return=b,S):(S=FL(T.type,T.key,T.props,null,b.mode,S),S.ref=WE(b,x,T),S.return=b,S)}function c(b,x,T,S){return x===null||x.tag!==4||x.stateNode.containerInfo!==T.containerInfo||x.stateNode.implementation!==T.implementation?(x=kU(T,b.mode,S),x.return=b,x):(x=n(x,T.children||[]),x.return=b,x)}function u(b,x,T,S,A){return x===null||x.tag!==7?(x=Tb(T,b.mode,S,A),x.return=b,x):(x=n(x,T),x.return=b,x)}function d(b,x,T){if(typeof x=="string"&&x!==""||typeof x=="number")return x=UU(""+x,b.mode,T),x.return=b,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case pM:return T=FL(x.type,x.key,x.props,null,b.mode,T),T.ref=WE(b,null,x),T.return=b,T;case H2:return x=kU(x,b.mode,T),x.return=b,x;case Ey:var S=x._init;return d(b,S(x._payload),T)}if(i3(x)||BE(x))return x=Tb(x,b.mode,T,null),x.return=b,x;SM(b,x)}return null}function p(b,x,T,S){var A=x!==null?x.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return A!==null?null:a(b,x,""+T,S);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case pM:return T.key===A?l(b,x,T,S):null;case H2:return T.key===A?c(b,x,T,S):null;case Ey:return A=T._init,p(b,x,A(T._payload),S)}if(i3(T)||BE(T))return A!==null?null:u(b,x,T,S,null);SM(b,T)}return null}function m(b,x,T,S,A){if(typeof S=="string"&&S!==""||typeof S=="number")return b=b.get(T)||null,a(x,b,""+S,A);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case pM:return b=b.get(S.key===null?T:S.key)||null,l(x,b,S,A);case H2:return b=b.get(S.key===null?T:S.key)||null,c(x,b,S,A);case Ey:var C=S._init;return m(b,x,T,C(S._payload),A)}if(i3(S)||BE(S))return b=b.get(T)||null,u(x,b,S,A,null);SM(x,S)}return null}function y(b,x,T,S){for(var A=null,C=null,R=x,P=x=0,F=null;R!==null&&P<T.length;P++){R.index>P?(F=R,R=null):F=R.sibling;var k=p(b,R,T[P],S);if(k===null){R===null&&(R=F);break}t&&R&&k.alternate===null&&e(b,R),x=s(k,x,P),C===null?A=k:C.sibling=k,C=k,R=F}if(P===T.length)return r(b,R),Fn&&iv(b,P),A;if(R===null){for(;P<T.length;P++)R=d(b,T[P],S),R!==null&&(x=s(R,x,P),C===null?A=R:C.sibling=R,C=R);return Fn&&iv(b,P),A}for(R=i(b,R);P<T.length;P++)F=m(R,b,P,T[P],S),F!==null&&(t&&F.alternate!==null&&R.delete(F.key===null?P:F.key),x=s(F,x,P),C===null?A=F:C.sibling=F,C=F);return t&&R.forEach(function(V){return e(b,V)}),Fn&&iv(b,P),A}function _(b,x,T,S){var A=BE(T);if(typeof A!="function")throw Error(Oe(150));if(T=A.call(T),T==null)throw Error(Oe(151));for(var C=A=null,R=x,P=x=0,F=null,k=T.next();R!==null&&!k.done;P++,k=T.next()){R.index>P?(F=R,R=null):F=R.sibling;var V=p(b,R,k.value,S);if(V===null){R===null&&(R=F);break}t&&R&&V.alternate===null&&e(b,R),x=s(V,x,P),C===null?A=V:C.sibling=V,C=V,R=F}if(k.done)return r(b,R),Fn&&iv(b,P),A;if(R===null){for(;!k.done;P++,k=T.next())k=d(b,k.value,S),k!==null&&(x=s(k,x,P),C===null?A=k:C.sibling=k,C=k);return Fn&&iv(b,P),A}for(R=i(b,R);!k.done;P++,k=T.next())k=m(R,b,P,k.value,S),k!==null&&(t&&k.alternate!==null&&R.delete(k.key===null?P:k.key),x=s(k,x,P),C===null?A=k:C.sibling=k,C=k);return t&&R.forEach(function(z){return e(b,z)}),Fn&&iv(b,P),A}function v(b,x,T,S){if(typeof T=="object"&&T!==null&&T.type===W2&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case pM:e:{for(var A=T.key,C=x;C!==null;){if(C.key===A){if(A=T.type,A===W2){if(C.tag===7){r(b,C.sibling),x=n(C,T.props.children),x.return=b,b=x;break e}}else if(C.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===Ey&&Lee(A)===C.type){r(b,C.sibling),x=n(C,T.props),x.ref=WE(b,C,T),x.return=b,b=x;break e}r(b,C);break}else e(b,C);C=C.sibling}T.type===W2?(x=Tb(T.props.children,b.mode,S,T.key),x.return=b,b=x):(S=FL(T.type,T.key,T.props,null,b.mode,S),S.ref=WE(b,x,T),S.return=b,b=S)}return o(b);case H2:e:{for(C=T.key;x!==null;){if(x.key===C)if(x.tag===4&&x.stateNode.containerInfo===T.containerInfo&&x.stateNode.implementation===T.implementation){r(b,x.sibling),x=n(x,T.children||[]),x.return=b,b=x;break e}else{r(b,x);break}else e(b,x);x=x.sibling}x=kU(T,b.mode,S),x.return=b,b=x}return o(b);case Ey:return C=T._init,v(b,x,C(T._payload),S)}if(i3(T))return y(b,x,T,S);if(BE(T))return _(b,x,T,S);SM(b,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,x!==null&&x.tag===6?(r(b,x.sibling),x=n(x,T),x.return=b,b=x):(r(b,x),x=UU(T,b.mode,S),x.return=b,b=x),o(b)):r(b,x)}return v}var aS=Qfe(!0),Jfe=Qfe(!1),nP={},$f=n1(nP),BO=n1(nP),VO=n1(nP);function db(t){if(t===nP)throw Error(Oe(174));return t}function Qq(t,e){switch(pn(VO,e),pn(BO,t),pn($f,nP),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:OB(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=OB(e,t)}Mn($f),pn($f,e)}function lS(){Mn($f),Mn(BO),Mn(VO)}function Kfe(t){db(VO.current);var e=db($f.current),r=OB(e,t.type);e!==r&&(pn(BO,t),pn($f,r))}function Jq(t){BO.current===t&&(Mn($f),Mn(BO))}var Wn=n1(0);function zN(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var $U=[];function Kq(){for(var t=0;t<$U.length;t++)$U[t]._workInProgressVersionPrimary=null;$U.length=0}var $L=Yg.ReactCurrentDispatcher,IU=Yg.ReactCurrentBatchConfig,Gb=0,qn=null,go=null,Io=null,BN=!1,IA=!1,GO=0,KIe=0;function Ta(){throw Error(Oe(321))}function eX(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!op(t[r],e[r]))return!1;return!0}function tX(t,e,r,i,n,s){if(Gb=s,qn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$L.current=t===null||t.memoizedState===null?iLe:nLe,t=r(i,n),IA){s=0;do{if(IA=!1,GO=0,25<=s)throw Error(Oe(301));s+=1,Io=go=null,e.updateQueue=null,$L.current=sLe,t=r(i,n)}while(IA)}if($L.current=VN,e=go!==null&&go.next!==null,Gb=0,Io=go=qn=null,BN=!1,e)throw Error(Oe(300));return t}function rX(){var t=GO!==0;return GO=0,t}function ff(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Io===null?qn.memoizedState=Io=t:Io=Io.next=t,Io}function Ph(){if(go===null){var t=qn.alternate;t=t!==null?t.memoizedState:null}else t=go.next;var e=Io===null?qn.memoizedState:Io.next;if(e!==null)Io=e,go=t;else{if(t===null)throw Error(Oe(310));go=t,t={memoizedState:go.memoizedState,baseState:go.baseState,baseQueue:go.baseQueue,queue:go.queue,next:null},Io===null?qn.memoizedState=Io=t:Io=Io.next=t}return Io}function jO(t,e){return typeof e=="function"?e(t):e}function LU(t){var e=Ph(),r=e.queue;if(r===null)throw Error(Oe(311));r.lastRenderedReducer=t;var i=go,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Gb&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=i):l=l.next=d,qn.lanes|=u,jb|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,op(i,e.memoizedState)||(fc=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,r.lastRenderedState=i}if(t=r.interleaved,t!==null){n=t;do s=n.lane,qn.lanes|=s,jb|=s,n=n.next;while(n!==t)}else n===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function DU(t){var e=Ph(),r=e.queue;if(r===null)throw Error(Oe(311));r.lastRenderedReducer=t;var i=r.dispatch,n=r.pending,s=e.memoizedState;if(n!==null){r.pending=null;var o=n=n.next;do s=t(s,o.action),o=o.next;while(o!==n);op(s,e.memoizedState)||(fc=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,i]}function eme(){}function tme(t,e){var r=qn,i=Ph(),n=e(),s=!op(i.memoizedState,n);if(s&&(i.memoizedState=n,fc=!0),i=i.queue,iX(nme.bind(null,r,i,t),[t]),i.getSnapshot!==e||s||Io!==null&&Io.memoizedState.tag&1){if(r.flags|=2048,HO(9,ime.bind(null,r,i,n,e),void 0,null),jo===null)throw Error(Oe(349));Gb&30||rme(r,e,n)}return n}function rme(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=qn.updateQueue,e===null?(e={lastEffect:null,stores:null},qn.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function ime(t,e,r,i){e.value=r,e.getSnapshot=i,sme(e)&&ome(t)}function nme(t,e,r){return r(function(){sme(e)&&ome(t)})}function sme(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!op(t,r)}catch{return!0}}function ome(t){var e=$g(t,1);e!==null&&Jd(e,t,1,-1)}function Dee(t){var e=ff();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:jO,lastRenderedState:t},e.queue=t,t=t.dispatch=rLe.bind(null,qn,t),[e.memoizedState,t]}function HO(t,e,r,i){return t={tag:t,create:e,destroy:r,deps:i,next:null},e=qn.updateQueue,e===null?(e={lastEffect:null,stores:null},qn.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(i=r.next,r.next=t,t.next=i,e.lastEffect=t)),t}function ame(){return Ph().memoizedState}function IL(t,e,r,i){var n=ff();qn.flags|=t,n.memoizedState=HO(1|e,r,void 0,i===void 0?null:i)}function LF(t,e,r,i){var n=Ph();i=i===void 0?null:i;var s=void 0;if(go!==null){var o=go.memoizedState;if(s=o.destroy,i!==null&&eX(i,o.deps)){n.memoizedState=HO(e,r,s,i);return}}qn.flags|=t,n.memoizedState=HO(1|e,r,s,i)}function Nee(t,e){return IL(8390656,8,t,e)}function iX(t,e){return LF(2048,8,t,e)}function lme(t,e){return LF(4,2,t,e)}function cme(t,e){return LF(4,4,t,e)}function ume(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function hme(t,e,r){return r=r!=null?r.concat([t]):null,LF(4,4,ume.bind(null,e,t),r)}function nX(){}function dme(t,e){var r=Ph();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&eX(e,i[1])?i[0]:(r.memoizedState=[t,e],t)}function pme(t,e){var r=Ph();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&eX(e,i[1])?i[0]:(t=t(),r.memoizedState=[t,e],t)}function fme(t,e,r){return Gb&21?(op(r,e)||(r=yfe(),qn.lanes|=r,jb|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,fc=!0),t.memoizedState=r)}function eLe(t,e){var r=zi;zi=r!==0&&4>r?r:4,t(!0);var i=IU.transition;IU.transition={};try{t(!1),e()}finally{zi=r,IU.transition=i}}function mme(){return Ph().memoizedState}function tLe(t,e,r){var i=w_(t);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},gme(t))yme(e,r);else if(r=qfe(t,e,r,i),r!==null){var n=Al();Jd(r,t,i,n),_me(r,e,i)}}function rLe(t,e,r){var i=w_(t),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(gme(t))yme(e,n);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,r);if(n.hasEagerState=!0,n.eagerState=a,op(a,o)){var l=e.interleaved;l===null?(n.next=n,Yq(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}r=qfe(t,e,n,i),r!==null&&(n=Al(),Jd(r,t,i,n),_me(r,e,i))}}function gme(t){var e=t.alternate;return t===qn||e!==null&&e===qn}function yme(t,e){IA=BN=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function _me(t,e,r){if(r&4194240){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,Dq(t,r)}}var VN={readContext:Rh,useCallback:Ta,useContext:Ta,useEffect:Ta,useImperativeHandle:Ta,useInsertionEffect:Ta,useLayoutEffect:Ta,useMemo:Ta,useReducer:Ta,useRef:Ta,useState:Ta,useDebugValue:Ta,useDeferredValue:Ta,useTransition:Ta,useMutableSource:Ta,useSyncExternalStore:Ta,useId:Ta,unstable_isNewReconciler:!1},iLe={readContext:Rh,useCallback:function(t,e){return ff().memoizedState=[t,e===void 0?null:e],t},useContext:Rh,useEffect:Nee,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,IL(4194308,4,ume.bind(null,e,t),r)},useLayoutEffect:function(t,e){return IL(4194308,4,t,e)},useInsertionEffect:function(t,e){return IL(4,2,t,e)},useMemo:function(t,e){var r=ff();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var i=ff();return e=r!==void 0?r(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=tLe.bind(null,qn,t),[i.memoizedState,t]},useRef:function(t){var e=ff();return t={current:t},e.memoizedState=t},useState:Dee,useDebugValue:nX,useDeferredValue:function(t){return ff().memoizedState=t},useTransition:function(){var t=Dee(!1),e=t[0];return t=eLe.bind(null,t[1]),ff().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var i=qn,n=ff();if(Fn){if(r===void 0)throw Error(Oe(407));r=r()}else{if(r=e(),jo===null)throw Error(Oe(349));Gb&30||rme(i,e,r)}n.memoizedState=r;var s={value:r,getSnapshot:e};return n.queue=s,Nee(nme.bind(null,i,s,t),[t]),i.flags|=2048,HO(9,ime.bind(null,i,s,r,e),void 0,null),r},useId:function(){var t=ff(),e=jo.identifierPrefix;if(Fn){var r=hg,i=ug;r=(i&~(1<<32-Qd(i)-1)).toString(32)+r,e=":"+e+"R"+r,r=GO++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=KIe++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},nLe={readContext:Rh,useCallback:dme,useContext:Rh,useEffect:iX,useImperativeHandle:hme,useInsertionEffect:lme,useLayoutEffect:cme,useMemo:pme,useReducer:LU,useRef:ame,useState:function(){return LU(jO)},useDebugValue:nX,useDeferredValue:function(t){var e=Ph();return fme(e,go.memoizedState,t)},useTransition:function(){var t=LU(jO)[0],e=Ph().memoizedState;return[t,e]},useMutableSource:eme,useSyncExternalStore:tme,useId:mme,unstable_isNewReconciler:!1},sLe={readContext:Rh,useCallback:dme,useContext:Rh,useEffect:iX,useImperativeHandle:hme,useInsertionEffect:lme,useLayoutEffect:cme,useMemo:pme,useReducer:DU,useRef:ame,useState:function(){return DU(jO)},useDebugValue:nX,useDeferredValue:function(t){var e=Ph();return go===null?e.memoizedState=t:fme(e,go.memoizedState,t)},useTransition:function(){var t=DU(jO)[0],e=Ph().memoizedState;return[t,e]},useMutableSource:eme,useSyncExternalStore:tme,useId:mme,unstable_isNewReconciler:!1};function cS(t,e){try{var r="",i=e;do r+=I$e(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:n,digest:null}}function NU(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function QB(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var oLe=typeof WeakMap=="function"?WeakMap:Map;function vme(t,e,r){r=gg(-1,r),r.tag=3,r.payload={element:null};var i=e.value;return r.callback=function(){jN||(jN=!0,aV=i),QB(t,e)},r}function bme(t,e,r){r=gg(-1,r),r.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var n=e.value;r.payload=function(){return i(n)},r.callback=function(){QB(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){QB(t,e),typeof i!="function"&&(b_===null?b_=new Set([this]):b_.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function Fee(t,e,r){var i=t.pingCache;if(i===null){i=t.pingCache=new oLe;var n=new Set;i.set(e,n)}else n=i.get(e),n===void 0&&(n=new Set,i.set(e,n));n.has(r)||(n.add(r),t=bLe.bind(null,t,e,r),e.then(t,t))}function Uee(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function kee(t,e,r,i,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=gg(-1,1),e.tag=2,v_(r,e,1))),r.lanes|=1),t)}var aLe=Yg.ReactCurrentOwner,fc=!1;function bl(t,e,r,i){e.child=t===null?Jfe(e,null,r,i):aS(e,t.child,r,i)}function zee(t,e,r,i,n){r=r.render;var s=e.ref;return OT(e,n),i=tX(t,e,r,i,s,n),r=rX(),t!==null&&!fc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,Ig(t,e,n)):(Fn&&r&&Gq(e),e.flags|=1,bl(t,e,i,n),e.child)}function Bee(t,e,r,i,n){if(t===null){var s=r.type;return typeof s=="function"&&!dX(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,wme(t,e,s,i,n)):(t=FL(r.type,null,i,e,e.mode,n),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&n)){var o=s.memoizedProps;if(r=r.compare,r=r!==null?r:FO,r(o,i)&&t.ref===e.ref)return Ig(t,e,n)}return e.flags|=1,t=x_(s,i),t.ref=e.ref,t.return=e,e.child=t}function wme(t,e,r,i,n){if(t!==null){var s=t.memoizedProps;if(FO(s,i)&&t.ref===e.ref)if(fc=!1,e.pendingProps=i=s,(t.lanes&n)!==0)t.flags&131072&&(fc=!0);else return e.lanes=t.lanes,Ig(t,e,n)}return JB(t,e,r,i,n)}function xme(t,e,r){var i=e.pendingProps,n=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},pn(rT,Xc),Xc|=r;else{if(!(r&1073741824))return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,pn(rT,Xc),Xc|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,pn(rT,Xc),Xc|=i}else s!==null?(i=s.baseLanes|r,e.memoizedState=null):i=r,pn(rT,Xc),Xc|=i;return bl(t,e,n,r),e.child}function Tme(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function JB(t,e,r,i,n){var s=vc(r)?Bb:Ya.current;return s=sS(e,s),OT(e,n),r=tX(t,e,r,i,s,n),i=rX(),t!==null&&!fc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,Ig(t,e,n)):(Fn&&i&&Gq(e),e.flags|=1,bl(t,e,r,n),e.child)}function Vee(t,e,r,i,n){if(vc(r)){var s=!0;LN(e)}else s=!1;if(OT(e,n),e.stateNode===null)LL(t,e),Zfe(e,r,i),ZB(e,r,i,n),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=Rh(c):(c=vc(r)?Bb:Ya.current,c=sS(e,c));var u=r.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Iee(e,o,i,c),Cy=!1;var p=e.memoizedState;o.state=p,kN(e,i,o,n),l=e.memoizedState,a!==i||p!==l||_c.current||Cy?(typeof u=="function"&&(YB(e,r,u,i),l=e.memoizedState),(a=Cy||$ee(e,r,a,i,p,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Xfe(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Rd(e.type,a),o.props=c,d=e.pendingProps,p=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=Rh(l):(l=vc(r)?Bb:Ya.current,l=sS(e,l));var m=r.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||p!==l)&&Iee(e,o,i,l),Cy=!1,p=e.memoizedState,o.state=p,kN(e,i,o,n);var y=e.memoizedState;a!==d||p!==y||_c.current||Cy?(typeof m=="function"&&(YB(e,r,m,i),y=e.memoizedState),(c=Cy||$ee(e,r,c,i,p,y,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,y,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,y,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),o.props=i,o.state=y,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),i=!1)}return KB(t,e,r,i,s,n)}function KB(t,e,r,i,n,s){Tme(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return n&&Aee(e,r,!1),Ig(t,e,s);i=e.stateNode,aLe.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=aS(e,t.child,null,s),e.child=aS(e,null,a,s)):bl(t,e,a,s),e.memoizedState=i.state,n&&Aee(e,r,!0),e.child}function Sme(t){var e=t.stateNode;e.pendingContext?Cee(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Cee(t,e.context,!1),Qq(t,e.containerInfo)}function Gee(t,e,r,i,n){return oS(),Hq(n),e.flags|=256,bl(t,e,r,i),e.child}var eV={dehydrated:null,treeContext:null,retryLane:0};function tV(t){return{baseLanes:t,cachePool:null,transitions:null}}function Eme(t,e,r){var i=e.pendingProps,n=Wn.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(n&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),pn(Wn,n&1),t===null)return qB(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=FF(o,i,0,null),t=Tb(t,i,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=tV(r),e.memoizedState=eV,t):sX(e,o));if(n=t.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return lLe(t,e,o,i,a,n,r);if(s){s=i.fallback,o=e.mode,n=t.child,a=n.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==n?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=x_(n,l),i.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=x_(a,s):(s=Tb(s,o,r,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?tV(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~r,e.memoizedState=eV,i}return s=t.child,t=s.sibling,i=x_(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=r),i.return=e,i.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=i,e.memoizedState=null,i}function sX(t,e){return e=FF({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function EM(t,e,r,i){return i!==null&&Hq(i),aS(e,t.child,null,r),t=sX(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function lLe(t,e,r,i,n,s,o){if(r)return e.flags&256?(e.flags&=-257,i=NU(Error(Oe(422))),EM(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,n=e.mode,i=FF({mode:"visible",children:i.children},n,0,null),s=Tb(s,n,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&aS(e,t.child,null,o),e.child.memoizedState=tV(o),e.memoizedState=eV,s);if(!(e.mode&1))return EM(t,e,o,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(Oe(419)),i=NU(s,i,void 0),EM(t,e,o,i)}if(a=(o&t.childLanes)!==0,fc||a){if(i=jo,i!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,$g(t,n),Jd(i,t,n,-1))}return hX(),i=NU(Error(Oe(421))),EM(t,e,o,i)}return n.data==="$?"?(e.flags|=128,e.child=t.child,e=wLe.bind(null,t),n._reactRetry=e,null):(t=s.treeContext,ou=__(n.nextSibling),cu=e,Fn=!0,Fd=null,t!==null&&(sh[oh++]=ug,sh[oh++]=hg,sh[oh++]=Vb,ug=t.id,hg=t.overflow,Vb=e),e=sX(e,i.children),e.flags|=4096,e)}function jee(t,e,r){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),XB(t.return,e,r)}function FU(t,e,r,i,n){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function Cme(t,e,r){var i=e.pendingProps,n=i.revealOrder,s=i.tail;if(bl(t,e,i.children,r),i=Wn.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&jee(t,r,e);else if(t.tag===19)jee(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(pn(Wn,i),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(r=e.child,n=null;r!==null;)t=r.alternate,t!==null&&zN(t)===null&&(n=r),r=r.sibling;r=n,r===null?(n=e.child,e.child=null):(n=r.sibling,r.sibling=null),FU(e,!1,n,r,s);break;case"backwards":for(r=null,n=e.child,e.child=null;n!==null;){if(t=n.alternate,t!==null&&zN(t)===null){e.child=n;break}t=n.sibling,n.sibling=r,r=n,n=t}FU(e,!0,r,null,s);break;case"together":FU(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function LL(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ig(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),jb|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Oe(153));if(e.child!==null){for(t=e.child,r=x_(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=x_(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function cLe(t,e,r){switch(e.tag){case 3:Sme(e),oS();break;case 5:Kfe(e);break;case 1:vc(e.type)&&LN(e);break;case 4:Qq(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,n=e.memoizedProps.value;pn(FN,i._currentValue),i._currentValue=n;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(pn(Wn,Wn.current&1),e.flags|=128,null):r&e.child.childLanes?Eme(t,e,r):(pn(Wn,Wn.current&1),t=Ig(t,e,r),t!==null?t.sibling:null);pn(Wn,Wn.current&1);break;case 19:if(i=(r&e.childLanes)!==0,t.flags&128){if(i)return Cme(t,e,r);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),pn(Wn,Wn.current),i)break;return null;case 22:case 23:return e.lanes=0,xme(t,e,r)}return Ig(t,e,r)}var Ame,rV,Ome,Rme;Ame=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};rV=function(){};Ome=function(t,e,r,i){var n=t.memoizedProps;if(n!==i){t=e.stateNode,db($f.current);var s=null;switch(r){case"input":n=SB(t,n),i=SB(t,i),s=[];break;case"select":n=Yn({},n,{value:void 0}),i=Yn({},i,{value:void 0}),s=[];break;case"textarea":n=AB(t,n),i=AB(t,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=$N)}RB(r,i);var o;r=null;for(c in n)if(!i.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var a=n[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(PO.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=n!=null?n[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(s||(s=[]),s.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(PO.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&bn("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}r&&(s=s||[]).push("style",r);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};Rme=function(t,e,r,i){r!==i&&(e.flags|=4)};function qE(t,e){if(!Fn)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Sa(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,i=0;if(e)for(var n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=i,t.childLanes=r,e}function uLe(t,e,r){var i=e.pendingProps;switch(jq(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sa(e),null;case 1:return vc(e.type)&&IN(),Sa(e),null;case 3:return i=e.stateNode,lS(),Mn(_c),Mn(Ya),Kq(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(TM(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Fd!==null&&(uV(Fd),Fd=null))),rV(t,e),Sa(e),null;case 5:Jq(e);var n=db(VO.current);if(r=e.type,t!==null&&e.stateNode!=null)Ome(t,e,r,i,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Oe(166));return Sa(e),null}if(t=db($f.current),TM(e)){i=e.stateNode,r=e.type;var s=e.memoizedProps;switch(i[vf]=e,i[zO]=s,t=(e.mode&1)!==0,r){case"dialog":bn("cancel",i),bn("close",i);break;case"iframe":case"object":case"embed":bn("load",i);break;case"video":case"audio":for(n=0;n<s3.length;n++)bn(s3[n],i);break;case"source":bn("error",i);break;case"img":case"image":case"link":bn("error",i),bn("load",i);break;case"details":bn("toggle",i);break;case"input":KK(i,s),bn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},bn("invalid",i);break;case"textarea":tee(i,s),bn("invalid",i)}RB(r,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&xM(i.textContent,a,t),n=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&xM(i.textContent,a,t),n=["children",""+a]):PO.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&bn("scroll",i)}switch(r){case"input":fM(i),eee(i,s,!0);break;case"textarea":fM(i),ree(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=$N)}i=n,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=rfe(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(r,{is:i.is}):(t=o.createElement(r),r==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,r),t[vf]=e,t[zO]=i,Ame(t,e,!1,!1),e.stateNode=t;e:{switch(o=PB(r,i),r){case"dialog":bn("cancel",t),bn("close",t),n=i;break;case"iframe":case"object":case"embed":bn("load",t),n=i;break;case"video":case"audio":for(n=0;n<s3.length;n++)bn(s3[n],t);n=i;break;case"source":bn("error",t),n=i;break;case"img":case"image":case"link":bn("error",t),bn("load",t),n=i;break;case"details":bn("toggle",t),n=i;break;case"input":KK(t,i),n=SB(t,i),bn("invalid",t);break;case"option":n=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},n=Yn({},i,{value:void 0}),bn("invalid",t);break;case"textarea":tee(t,i),n=AB(t,i),bn("invalid",t);break;default:n=i}RB(r,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?sfe(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&ife(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&MO(t,l):typeof l=="number"&&MO(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(PO.hasOwnProperty(s)?l!=null&&s==="onScroll"&&bn("scroll",t):l!=null&&Rq(t,s,l,o))}switch(r){case"input":fM(t),eee(t,i,!1);break;case"textarea":fM(t),ree(t);break;case"option":i.value!=null&&t.setAttribute("value",""+M_(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ST(t,!!i.multiple,s,!1):i.defaultValue!=null&&ST(t,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=$N)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Sa(e),null;case 6:if(t&&e.stateNode!=null)Rme(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Oe(166));if(r=db(VO.current),db($f.current),TM(e)){if(i=e.stateNode,r=e.memoizedProps,i[vf]=e,(s=i.nodeValue!==r)&&(t=cu,t!==null))switch(t.tag){case 3:xM(i.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&xM(i.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[vf]=e,e.stateNode=i}return Sa(e),null;case 13:if(Mn(Wn),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Fn&&ou!==null&&e.mode&1&&!(e.flags&128))Wfe(),oS(),e.flags|=98560,s=!1;else if(s=TM(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(Oe(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Oe(317));s[vf]=e}else oS(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Sa(e),s=!1}else Fd!==null&&(uV(Fd),Fd=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Wn.current&1?bo===0&&(bo=3):hX())),e.updateQueue!==null&&(e.flags|=4),Sa(e),null);case 4:return lS(),rV(t,e),t===null&&UO(e.stateNode.containerInfo),Sa(e),null;case 10:return Xq(e.type._context),Sa(e),null;case 17:return vc(e.type)&&IN(),Sa(e),null;case 19:if(Mn(Wn),s=e.memoizedState,s===null)return Sa(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)qE(s,!1);else{if(bo!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=zN(t),o!==null){for(e.flags|=128,qE(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=r,r=e.child;r!==null;)s=r,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return pn(Wn,Wn.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ts()>uS&&(e.flags|=128,i=!0,qE(s,!1),e.lanes=4194304)}else{if(!i)if(t=zN(o),t!==null){if(e.flags|=128,i=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),qE(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Fn)return Sa(e),null}else 2*Ts()-s.renderingStartTime>uS&&r!==1073741824&&(e.flags|=128,i=!0,qE(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(r=s.last,r!==null?r.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ts(),e.sibling=null,r=Wn.current,pn(Wn,i?r&1|2:r&1),e):(Sa(e),null);case 22:case 23:return uX(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Xc&1073741824&&(Sa(e),e.subtreeFlags&6&&(e.flags|=8192)):Sa(e),null;case 24:return null;case 25:return null}throw Error(Oe(156,e.tag))}function hLe(t,e){switch(jq(e),e.tag){case 1:return vc(e.type)&&IN(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return lS(),Mn(_c),Mn(Ya),Kq(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Jq(e),null;case 13:if(Mn(Wn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Oe(340));oS()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Mn(Wn),null;case 4:return lS(),null;case 10:return Xq(e.type._context),null;case 22:case 23:return uX(),null;case 24:return null;default:return null}}var CM=!1,Ga=!1,dLe=typeof WeakSet=="function"?WeakSet:Set,ct=null;function tT(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){is(t,e,i)}else r.current=null}function iV(t,e,r){try{r()}catch(i){is(t,e,i)}}var Hee=!1;function pLe(t,e){if(zB=RN,t=Ife(),Vq(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,p=null;t:for(;;){for(var m;d!==r||n!==0&&d.nodeType!==3||(a=o+n),d!==s||i!==0&&d.nodeType!==3||(l=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(m=d.firstChild)!==null;)p=d,d=m;for(;;){if(d===t)break t;if(p===r&&++c===n&&(a=o),p===s&&++u===i&&(l=o),(m=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=m}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(BB={focusedElem:t,selectionRange:r},RN=!1,ct=e;ct!==null;)if(e=ct,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ct=t;else for(;ct!==null;){e=ct;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var _=y.memoizedProps,v=y.memoizedState,b=e.stateNode,x=b.getSnapshotBeforeUpdate(e.elementType===e.type?_:Rd(e.type,_),v);b.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Oe(163))}}catch(S){is(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,ct=t;break}ct=e.return}return y=Hee,Hee=!1,y}function LA(t,e,r){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&t)===t){var s=n.destroy;n.destroy=void 0,s!==void 0&&iV(e,r,s)}n=n.next}while(n!==i)}}function DF(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var i=r.create;r.destroy=i()}r=r.next}while(r!==e)}}function nV(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function Pme(t){var e=t.alternate;e!==null&&(t.alternate=null,Pme(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[vf],delete e[zO],delete e[jB],delete e[YIe],delete e[ZIe])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Mme(t){return t.tag===5||t.tag===3||t.tag===4}function Wee(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Mme(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function sV(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=$N));else if(i!==4&&(t=t.child,t!==null))for(sV(t,e,r),t=t.sibling;t!==null;)sV(t,e,r),t=t.sibling}function oV(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(oV(t,e,r),t=t.sibling;t!==null;)oV(t,e,r),t=t.sibling}var ta=null,$d=!1;function g0(t,e,r){for(r=r.child;r!==null;)$me(t,e,r),r=r.sibling}function $me(t,e,r){if(Mf&&typeof Mf.onCommitFiberUnmount=="function")try{Mf.onCommitFiberUnmount(AF,r)}catch{}switch(r.tag){case 5:Ga||tT(r,e);case 6:var i=ta,n=$d;ta=null,g0(t,e,r),ta=i,$d=n,ta!==null&&($d?(t=ta,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):ta.removeChild(r.stateNode));break;case 18:ta!==null&&($d?(t=ta,r=r.stateNode,t.nodeType===8?PU(t.parentNode,r):t.nodeType===1&&PU(t,r),DO(t)):PU(ta,r.stateNode));break;case 4:i=ta,n=$d,ta=r.stateNode.containerInfo,$d=!0,g0(t,e,r),ta=i,$d=n;break;case 0:case 11:case 14:case 15:if(!Ga&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&iV(r,e,o),n=n.next}while(n!==i)}g0(t,e,r);break;case 1:if(!Ga&&(tT(r,e),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){is(r,e,a)}g0(t,e,r);break;case 21:g0(t,e,r);break;case 22:r.mode&1?(Ga=(i=Ga)||r.memoizedState!==null,g0(t,e,r),Ga=i):g0(t,e,r);break;default:g0(t,e,r)}}function qee(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new dLe),e.forEach(function(i){var n=xLe.bind(null,t,i);r.has(i)||(r.add(i),i.then(n,n))})}}function Yh(t,e){var r=e.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:ta=a.stateNode,$d=!1;break e;case 3:ta=a.stateNode.containerInfo,$d=!0;break e;case 4:ta=a.stateNode.containerInfo,$d=!0;break e}a=a.return}if(ta===null)throw Error(Oe(160));$me(s,o,n),ta=null,$d=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){is(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Ime(e,t),e=e.sibling}function Ime(t,e){var r=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Yh(e,t),Sp(t),i&4){try{LA(3,t,t.return),DF(3,t)}catch(_){is(t,t.return,_)}try{LA(5,t,t.return)}catch(_){is(t,t.return,_)}}break;case 1:Yh(e,t),Sp(t),i&512&&r!==null&&tT(r,r.return);break;case 5:if(Yh(e,t),Sp(t),i&512&&r!==null&&tT(r,r.return),t.flags&32){var n=t.stateNode;try{MO(n,"")}catch(_){is(t,t.return,_)}}if(i&4&&(n=t.stateNode,n!=null)){var s=t.memoizedProps,o=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&efe(n,s),PB(a,o);var c=PB(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?sfe(n,d):u==="dangerouslySetInnerHTML"?ife(n,d):u==="children"?MO(n,d):Rq(n,u,d,c)}switch(a){case"input":EB(n,s);break;case"textarea":tfe(n,s);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?ST(n,!!s.multiple,m,!1):p!==!!s.multiple&&(s.defaultValue!=null?ST(n,!!s.multiple,s.defaultValue,!0):ST(n,!!s.multiple,s.multiple?[]:"",!1))}n[zO]=s}catch(_){is(t,t.return,_)}}break;case 6:if(Yh(e,t),Sp(t),i&4){if(t.stateNode===null)throw Error(Oe(162));n=t.stateNode,s=t.memoizedProps;try{n.nodeValue=s}catch(_){is(t,t.return,_)}}break;case 3:if(Yh(e,t),Sp(t),i&4&&r!==null&&r.memoizedState.isDehydrated)try{DO(e.containerInfo)}catch(_){is(t,t.return,_)}break;case 4:Yh(e,t),Sp(t);break;case 13:Yh(e,t),Sp(t),n=t.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(lX=Ts())),i&4&&qee(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(Ga=(c=Ga)||u,Yh(e,t),Ga=c):Yh(e,t),Sp(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(ct=t,u=t.child;u!==null;){for(d=ct=u;ct!==null;){switch(p=ct,m=p.child,p.tag){case 0:case 11:case 14:case 15:LA(4,p,p.return);break;case 1:tT(p,p.return);var y=p.stateNode;if(typeof y.componentWillUnmount=="function"){i=p,r=p.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(_){is(i,r,_)}}break;case 5:tT(p,p.return);break;case 22:if(p.memoizedState!==null){Yee(d);continue}}m!==null?(m.return=p,ct=m):Yee(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{n=d.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=nfe("display",o))}catch(_){is(t,t.return,_)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(_){is(t,t.return,_)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Yh(e,t),Sp(t),i&4&&qee(t);break;case 21:break;default:Yh(e,t),Sp(t)}}function Sp(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(Mme(r)){var i=r;break e}r=r.return}throw Error(Oe(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(MO(n,""),i.flags&=-33);var s=Wee(t);oV(t,s,n);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Wee(t);sV(t,a,o);break;default:throw Error(Oe(161))}}catch(l){is(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function fLe(t,e,r){ct=t,Lme(t)}function Lme(t,e,r){for(var i=(t.mode&1)!==0;ct!==null;){var n=ct,s=n.child;if(n.tag===22&&i){var o=n.memoizedState!==null||CM;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||Ga;a=CM;var c=Ga;if(CM=o,(Ga=l)&&!c)for(ct=n;ct!==null;)o=ct,l=o.child,o.tag===22&&o.memoizedState!==null?Zee(n):l!==null?(l.return=o,ct=l):Zee(n);for(;s!==null;)ct=s,Lme(s),s=s.sibling;ct=n,CM=a,Ga=c}Xee(t)}else n.subtreeFlags&8772&&s!==null?(s.return=n,ct=s):Xee(t)}}function Xee(t){for(;ct!==null;){var e=ct;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ga||DF(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Ga)if(r===null)i.componentDidMount();else{var n=e.elementType===e.type?r.memoizedProps:Rd(e.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Mee(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}Mee(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&DO(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Oe(163))}Ga||e.flags&512&&nV(e)}catch(p){is(e,e.return,p)}}if(e===t){ct=null;break}if(r=e.sibling,r!==null){r.return=e.return,ct=r;break}ct=e.return}}function Yee(t){for(;ct!==null;){var e=ct;if(e===t){ct=null;break}var r=e.sibling;if(r!==null){r.return=e.return,ct=r;break}ct=e.return}}function Zee(t){for(;ct!==null;){var e=ct;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{DF(4,e)}catch(l){is(e,r,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var n=e.return;try{i.componentDidMount()}catch(l){is(e,n,l)}}var s=e.return;try{nV(e)}catch(l){is(e,s,l)}break;case 5:var o=e.return;try{nV(e)}catch(l){is(e,o,l)}}}catch(l){is(e,e.return,l)}if(e===t){ct=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ct=a;break}ct=e.return}}var mLe=Math.ceil,GN=Yg.ReactCurrentDispatcher,oX=Yg.ReactCurrentOwner,Th=Yg.ReactCurrentBatchConfig,li=0,jo=null,Hs=null,da=0,Xc=0,rT=n1(0),bo=0,WO=null,jb=0,NF=0,aX=0,DA=null,cc=null,lX=0,uS=1/0,Km=null,jN=!1,aV=null,b_=null,AM=!1,Zy=null,HN=0,NA=0,lV=null,DL=-1,NL=0;function Al(){return li&6?Ts():DL!==-1?DL:DL=Ts()}function w_(t){return t.mode&1?li&2&&da!==0?da&-da:JIe.transition!==null?(NL===0&&(NL=yfe()),NL):(t=zi,t!==0||(t=window.event,t=t===void 0?16:Sfe(t.type)),t):1}function Jd(t,e,r,i){if(50<NA)throw NA=0,lV=null,Error(Oe(185));tP(t,r,i),(!(li&2)||t!==jo)&&(t===jo&&(!(li&2)&&(NF|=r),bo===4&&zy(t,da)),bc(t,i),r===1&&li===0&&!(e.mode&1)&&(uS=Ts()+500,$F&&s1()))}function bc(t,e){var r=t.callbackNode;J$e(t,e);var i=ON(t,t===jo?da:0);if(i===0)r!==null&&see(r),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(r!=null&&see(r),e===1)t.tag===0?QIe(Qee.bind(null,t)):Gfe(Qee.bind(null,t)),qIe(function(){!(li&6)&&s1()}),r=null;else{switch(_fe(i)){case 1:r=Lq;break;case 4:r=mfe;break;case 16:r=AN;break;case 536870912:r=gfe;break;default:r=AN}r=Vme(r,Dme.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function Dme(t,e){if(DL=-1,NL=0,li&6)throw Error(Oe(327));var r=t.callbackNode;if(RT()&&t.callbackNode!==r)return null;var i=ON(t,t===jo?da:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=WN(t,i);else{e=i;var n=li;li|=2;var s=Fme();(jo!==t||da!==e)&&(Km=null,uS=Ts()+500,xb(t,e));do try{_Le();break}catch(a){Nme(t,a)}while(1);qq(),GN.current=s,li=n,Hs!==null?e=0:(jo=null,da=0,e=bo)}if(e!==0){if(e===2&&(n=DB(t),n!==0&&(i=n,e=cV(t,n))),e===1)throw r=WO,xb(t,0),zy(t,i),bc(t,Ts()),r;if(e===6)zy(t,i);else{if(n=t.current.alternate,!(i&30)&&!gLe(n)&&(e=WN(t,i),e===2&&(s=DB(t),s!==0&&(i=s,e=cV(t,s))),e===1))throw r=WO,xb(t,0),zy(t,i),bc(t,Ts()),r;switch(t.finishedWork=n,t.finishedLanes=i,e){case 0:case 1:throw Error(Oe(345));case 2:nv(t,cc,Km);break;case 3:if(zy(t,i),(i&130023424)===i&&(e=lX+500-Ts(),10<e)){if(ON(t,0)!==0)break;if(n=t.suspendedLanes,(n&i)!==i){Al(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=GB(nv.bind(null,t,cc,Km),e);break}nv(t,cc,Km);break;case 4:if(zy(t,i),(i&4194240)===i)break;for(e=t.eventTimes,n=-1;0<i;){var o=31-Qd(i);s=1<<o,o=e[o],o>n&&(n=o),i&=~s}if(i=n,i=Ts()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*mLe(i/1960))-i,10<i){t.timeoutHandle=GB(nv.bind(null,t,cc,Km),i);break}nv(t,cc,Km);break;case 5:nv(t,cc,Km);break;default:throw Error(Oe(329))}}}return bc(t,Ts()),t.callbackNode===r?Dme.bind(null,t):null}function cV(t,e){var r=DA;return t.current.memoizedState.isDehydrated&&(xb(t,e).flags|=256),t=WN(t,e),t!==2&&(e=cc,cc=r,e!==null&&uV(e)),t}function uV(t){cc===null?cc=t:cc.push.apply(cc,t)}function gLe(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!op(s(),n))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zy(t,e){for(e&=~aX,e&=~NF,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Qd(e),i=1<<r;t[r]=-1,e&=~i}}function Qee(t){if(li&6)throw Error(Oe(327));RT();var e=ON(t,0);if(!(e&1))return bc(t,Ts()),null;var r=WN(t,e);if(t.tag!==0&&r===2){var i=DB(t);i!==0&&(e=i,r=cV(t,i))}if(r===1)throw r=WO,xb(t,0),zy(t,e),bc(t,Ts()),r;if(r===6)throw Error(Oe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,nv(t,cc,Km),bc(t,Ts()),null}function cX(t,e){var r=li;li|=1;try{return t(e)}finally{li=r,li===0&&(uS=Ts()+500,$F&&s1())}}function Hb(t){Zy!==null&&Zy.tag===0&&!(li&6)&&RT();var e=li;li|=1;var r=Th.transition,i=zi;try{if(Th.transition=null,zi=1,t)return t()}finally{zi=i,Th.transition=r,li=e,!(li&6)&&s1()}}function uX(){Xc=rT.current,Mn(rT)}function xb(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,WIe(r)),Hs!==null)for(r=Hs.return;r!==null;){var i=r;switch(jq(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&IN();break;case 3:lS(),Mn(_c),Mn(Ya),Kq();break;case 5:Jq(i);break;case 4:lS();break;case 13:Mn(Wn);break;case 19:Mn(Wn);break;case 10:Xq(i.type._context);break;case 22:case 23:uX()}r=r.return}if(jo=t,Hs=t=x_(t.current,null),da=Xc=e,bo=0,WO=null,aX=NF=jb=0,cc=DA=null,hb!==null){for(e=0;e<hb.length;e++)if(r=hb[e],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var o=s.next;s.next=n,i.next=o}r.pending=i}hb=null}return t}function Nme(t,e){do{var r=Hs;try{if(qq(),$L.current=VN,BN){for(var i=qn.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}BN=!1}if(Gb=0,Io=go=qn=null,IA=!1,GO=0,oX.current=null,r===null||r.return===null){bo=1,WO=e,Hs=null;break}e:{var s=t,o=r.return,a=r,l=e;if(e=da,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=Uee(o);if(m!==null){m.flags&=-257,kee(m,o,a,s,e),m.mode&1&&Fee(s,c,e),e=m,l=c;var y=e.updateQueue;if(y===null){var _=new Set;_.add(l),e.updateQueue=_}else y.add(l);break e}else{if(!(e&1)){Fee(s,c,e),hX();break e}l=Error(Oe(426))}}else if(Fn&&a.mode&1){var v=Uee(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),kee(v,o,a,s,e),Hq(cS(l,a));break e}}s=l=cS(l,a),bo!==4&&(bo=2),DA===null?DA=[s]:DA.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var b=vme(s,l,e);Pee(s,b);break e;case 1:a=l;var x=s.type,T=s.stateNode;if(!(s.flags&128)&&(typeof x.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(b_===null||!b_.has(T)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=bme(s,a,e);Pee(s,S);break e}}s=s.return}while(s!==null)}kme(r)}catch(A){e=A,Hs===r&&r!==null&&(Hs=r=r.return);continue}break}while(1)}function Fme(){var t=GN.current;return GN.current=VN,t===null?VN:t}function hX(){(bo===0||bo===3||bo===2)&&(bo=4),jo===null||!(jb&268435455)&&!(NF&268435455)||zy(jo,da)}function WN(t,e){var r=li;li|=2;var i=Fme();(jo!==t||da!==e)&&(Km=null,xb(t,e));do try{yLe();break}catch(n){Nme(t,n)}while(1);if(qq(),li=r,GN.current=i,Hs!==null)throw Error(Oe(261));return jo=null,da=0,bo}function yLe(){for(;Hs!==null;)Ume(Hs)}function _Le(){for(;Hs!==null&&!G$e();)Ume(Hs)}function Ume(t){var e=Bme(t.alternate,t,Xc);t.memoizedProps=t.pendingProps,e===null?kme(t):Hs=e,oX.current=null}function kme(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=hLe(r,e),r!==null){r.flags&=32767,Hs=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{bo=6,Hs=null;return}}else if(r=uLe(r,e,Xc),r!==null){Hs=r;return}if(e=e.sibling,e!==null){Hs=e;return}Hs=e=t}while(e!==null);bo===0&&(bo=5)}function nv(t,e,r){var i=zi,n=Th.transition;try{Th.transition=null,zi=1,vLe(t,e,r,i)}finally{Th.transition=n,zi=i}return null}function vLe(t,e,r,i){do RT();while(Zy!==null);if(li&6)throw Error(Oe(327));r=t.finishedWork;var n=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(Oe(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(K$e(t,s),t===jo&&(Hs=jo=null,da=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||AM||(AM=!0,Vme(AN,function(){return RT(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=Th.transition,Th.transition=null;var o=zi;zi=1;var a=li;li|=4,oX.current=null,pLe(t,r),Ime(r,t),kIe(BB),RN=!!zB,BB=zB=null,t.current=r,fLe(r),j$e(),li=a,zi=o,Th.transition=s}else t.current=r;if(AM&&(AM=!1,Zy=t,HN=n),s=t.pendingLanes,s===0&&(b_=null),q$e(r.stateNode),bc(t,Ts()),e!==null)for(i=t.onRecoverableError,r=0;r<e.length;r++)n=e[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(jN)throw jN=!1,t=aV,aV=null,t;return HN&1&&t.tag!==0&&RT(),s=t.pendingLanes,s&1?t===lV?NA++:(NA=0,lV=t):NA=0,s1(),null}function RT(){if(Zy!==null){var t=_fe(HN),e=Th.transition,r=zi;try{if(Th.transition=null,zi=16>t?16:t,Zy===null)var i=!1;else{if(t=Zy,Zy=null,HN=0,li&6)throw Error(Oe(331));var n=li;for(li|=4,ct=t.current;ct!==null;){var s=ct,o=s.child;if(ct.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ct=c;ct!==null;){var u=ct;switch(u.tag){case 0:case 11:case 15:LA(8,u,s)}var d=u.child;if(d!==null)d.return=u,ct=d;else for(;ct!==null;){u=ct;var p=u.sibling,m=u.return;if(Pme(u),u===c){ct=null;break}if(p!==null){p.return=m,ct=p;break}ct=m}}}var y=s.alternate;if(y!==null){var _=y.child;if(_!==null){y.child=null;do{var v=_.sibling;_.sibling=null,_=v}while(_!==null)}}ct=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,ct=o;else e:for(;ct!==null;){if(s=ct,s.flags&2048)switch(s.tag){case 0:case 11:case 15:LA(9,s,s.return)}var b=s.sibling;if(b!==null){b.return=s.return,ct=b;break e}ct=s.return}}var x=t.current;for(ct=x;ct!==null;){o=ct;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,ct=T;else e:for(o=x;ct!==null;){if(a=ct,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:DF(9,a)}}catch(A){is(a,a.return,A)}if(a===o){ct=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,ct=S;break e}ct=a.return}}if(li=n,s1(),Mf&&typeof Mf.onPostCommitFiberRoot=="function")try{Mf.onPostCommitFiberRoot(AF,t)}catch{}i=!0}return i}finally{zi=r,Th.transition=e}}return!1}function Jee(t,e,r){e=cS(r,e),e=vme(t,e,1),t=v_(t,e,1),e=Al(),t!==null&&(tP(t,1,e),bc(t,e))}function is(t,e,r){if(t.tag===3)Jee(t,t,r);else for(;e!==null;){if(e.tag===3){Jee(e,t,r);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(b_===null||!b_.has(i))){t=cS(r,t),t=bme(e,t,1),e=v_(e,t,1),t=Al(),e!==null&&(tP(e,1,t),bc(e,t));break}}e=e.return}}function bLe(t,e,r){var i=t.pingCache;i!==null&&i.delete(e),e=Al(),t.pingedLanes|=t.suspendedLanes&r,jo===t&&(da&r)===r&&(bo===4||bo===3&&(da&130023424)===da&&500>Ts()-lX?xb(t,0):aX|=r),bc(t,e)}function zme(t,e){e===0&&(t.mode&1?(e=yM,yM<<=1,!(yM&130023424)&&(yM=4194304)):e=1);var r=Al();t=$g(t,e),t!==null&&(tP(t,e,r),bc(t,r))}function wLe(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),zme(t,r)}function xLe(t,e){var r=0;switch(t.tag){case 13:var i=t.stateNode,n=t.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Oe(314))}i!==null&&i.delete(e),zme(t,r)}var Bme;Bme=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||_c.current)fc=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return fc=!1,cLe(t,e,r);fc=!!(t.flags&131072)}else fc=!1,Fn&&e.flags&1048576&&jfe(e,NN,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;LL(t,e),t=e.pendingProps;var n=sS(e,Ya.current);OT(e,r),n=tX(null,e,i,t,n,r);var s=rX();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,vc(i)?(s=!0,LN(e)):s=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,Zq(e),n.updater=IF,e.stateNode=n,n._reactInternals=e,ZB(e,i,t,r),e=KB(null,e,i,!0,s,r)):(e.tag=0,Fn&&s&&Gq(e),bl(null,e,n,r),e=e.child),e;case 16:i=e.elementType;e:{switch(LL(t,e),t=e.pendingProps,n=i._init,i=n(i._payload),e.type=i,n=e.tag=SLe(i),t=Rd(i,t),n){case 0:e=JB(null,e,i,t,r);break e;case 1:e=Vee(null,e,i,t,r);break e;case 11:e=zee(null,e,i,t,r);break e;case 14:e=Bee(null,e,i,Rd(i.type,t),r);break e}throw Error(Oe(306,i,""))}return e;case 0:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:Rd(i,n),JB(t,e,i,n,r);case 1:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:Rd(i,n),Vee(t,e,i,n,r);case 3:e:{if(Sme(e),t===null)throw Error(Oe(387));i=e.pendingProps,s=e.memoizedState,n=s.element,Xfe(t,e),kN(e,i,null,r);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){n=cS(Error(Oe(423)),e),e=Gee(t,e,i,r,n);break e}else if(i!==n){n=cS(Error(Oe(424)),e),e=Gee(t,e,i,r,n);break e}else for(ou=__(e.stateNode.containerInfo.firstChild),cu=e,Fn=!0,Fd=null,r=Jfe(e,null,i,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(oS(),i===n){e=Ig(t,e,r);break e}bl(t,e,i,r)}e=e.child}return e;case 5:return Kfe(e),t===null&&qB(e),i=e.type,n=e.pendingProps,s=t!==null?t.memoizedProps:null,o=n.children,VB(i,n)?o=null:s!==null&&VB(i,s)&&(e.flags|=32),Tme(t,e),bl(t,e,o,r),e.child;case 6:return t===null&&qB(e),null;case 13:return Eme(t,e,r);case 4:return Qq(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=aS(e,null,i,r):bl(t,e,i,r),e.child;case 11:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:Rd(i,n),zee(t,e,i,n,r);case 7:return bl(t,e,e.pendingProps,r),e.child;case 8:return bl(t,e,e.pendingProps.children,r),e.child;case 12:return bl(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(i=e.type._context,n=e.pendingProps,s=e.memoizedProps,o=n.value,pn(FN,i._currentValue),i._currentValue=o,s!==null)if(op(s.value,o)){if(s.children===n.children&&!_c.current){e=Ig(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=gg(-1,r&-r),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),XB(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Oe(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),XB(o,r,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}bl(t,e,n.children,r),e=e.child}return e;case 9:return n=e.type,i=e.pendingProps.children,OT(e,r),n=Rh(n),i=i(n),e.flags|=1,bl(t,e,i,r),e.child;case 14:return i=e.type,n=Rd(i,e.pendingProps),n=Rd(i.type,n),Bee(t,e,i,n,r);case 15:return wme(t,e,e.type,e.pendingProps,r);case 17:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:Rd(i,n),LL(t,e),e.tag=1,vc(i)?(t=!0,LN(e)):t=!1,OT(e,r),Zfe(e,i,n),ZB(e,i,n,r),KB(null,e,i,!0,t,r);case 19:return Cme(t,e,r);case 22:return xme(t,e,r)}throw Error(Oe(156,e.tag))};function Vme(t,e){return ffe(t,e)}function TLe(t,e,r,i){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yh(t,e,r,i){return new TLe(t,e,r,i)}function dX(t){return t=t.prototype,!(!t||!t.isReactComponent)}function SLe(t){if(typeof t=="function")return dX(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Mq)return 11;if(t===$q)return 14}return 2}function x_(t,e){var r=t.alternate;return r===null?(r=yh(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function FL(t,e,r,i,n,s){var o=2;if(i=t,typeof t=="function")dX(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case W2:return Tb(r.children,n,s,e);case Pq:o=8,n|=8;break;case bB:return t=yh(12,r,e,n|2),t.elementType=bB,t.lanes=s,t;case wB:return t=yh(13,r,e,n),t.elementType=wB,t.lanes=s,t;case xB:return t=yh(19,r,e,n),t.elementType=xB,t.lanes=s,t;case Qpe:return FF(r,n,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Ype:o=10;break e;case Zpe:o=9;break e;case Mq:o=11;break e;case $q:o=14;break e;case Ey:o=16,i=null;break e}throw Error(Oe(130,t==null?t:typeof t,""))}return e=yh(o,r,e,n),e.elementType=t,e.type=i,e.lanes=s,e}function Tb(t,e,r,i){return t=yh(7,t,i,e),t.lanes=r,t}function FF(t,e,r,i){return t=yh(22,t,i,e),t.elementType=Qpe,t.lanes=r,t.stateNode={isHidden:!1},t}function UU(t,e,r){return t=yh(6,t,null,e),t.lanes=r,t}function kU(t,e,r){return e=yh(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function ELe(t,e,r,i,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vU(0),this.expirationTimes=vU(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vU(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function pX(t,e,r,i,n,s,o,a,l){return t=new ELe(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=yh(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zq(s),t}function CLe(t,e,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:H2,key:i==null?null:""+i,children:t,containerInfo:e,implementation:r}}function Gme(t){if(!t)return $_;t=t._reactInternals;e:{if(Rw(t)!==t||t.tag!==1)throw Error(Oe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(vc(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Oe(171))}if(t.tag===1){var r=t.type;if(vc(r))return Vfe(t,r,e)}return e}function jme(t,e,r,i,n,s,o,a,l){return t=pX(r,i,!0,t,n,s,o,a,l),t.context=Gme(null),r=t.current,i=Al(),n=w_(r),s=gg(i,n),s.callback=e??null,v_(r,s,n),t.current.lanes=n,tP(t,n,i),bc(t,i),t}function UF(t,e,r,i){var n=e.current,s=Al(),o=w_(n);return r=Gme(r),e.context===null?e.context=r:e.pendingContext=r,e=gg(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=v_(n,e,o),t!==null&&(Jd(t,n,o,s),ML(t,n,o)),o}function qN(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Kee(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function fX(t,e){Kee(t,e),(t=t.alternate)&&Kee(t,e)}function ALe(){return null}var Hme=typeof reportError=="function"?reportError:function(t){console.error(t)};function mX(t){this._internalRoot=t}kF.prototype.render=mX.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Oe(409));UF(t,e,null,null)};kF.prototype.unmount=mX.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Hb(function(){UF(null,t,null,null)}),e[Mg]=null}};function kF(t){this._internalRoot=t}kF.prototype.unstable_scheduleHydration=function(t){if(t){var e=wfe();t={blockedOn:null,target:t,priority:e};for(var r=0;r<ky.length&&e!==0&&e<ky[r].priority;r++);ky.splice(r,0,t),r===0&&Tfe(t)}};function gX(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function zF(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function ete(){}function OLe(t,e,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var c=qN(o);s.call(c)}}var o=jme(e,i,t,0,null,!1,!1,"",ete);return t._reactRootContainer=o,t[Mg]=o.current,UO(t.nodeType===8?t.parentNode:t),Hb(),o}for(;n=t.lastChild;)t.removeChild(n);if(typeof i=="function"){var a=i;i=function(){var c=qN(l);a.call(c)}}var l=pX(t,0,!1,null,null,!1,!1,"",ete);return t._reactRootContainer=l,t[Mg]=l.current,UO(t.nodeType===8?t.parentNode:t),Hb(function(){UF(e,l,r,i)}),l}function BF(t,e,r,i,n){var s=r._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=qN(o);a.call(l)}}UF(e,o,t,n)}else o=OLe(r,e,t,n,i);return qN(o)}vfe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=n3(e.pendingLanes);r!==0&&(Dq(e,r|1),bc(e,Ts()),!(li&6)&&(uS=Ts()+500,s1()))}break;case 13:Hb(function(){var i=$g(t,1);if(i!==null){var n=Al();Jd(i,t,1,n)}}),fX(t,1)}};Nq=function(t){if(t.tag===13){var e=$g(t,134217728);if(e!==null){var r=Al();Jd(e,t,134217728,r)}fX(t,134217728)}};bfe=function(t){if(t.tag===13){var e=w_(t),r=$g(t,e);if(r!==null){var i=Al();Jd(r,t,e,i)}fX(t,e)}};wfe=function(){return zi};xfe=function(t,e){var r=zi;try{return zi=t,e()}finally{zi=r}};$B=function(t,e,r){switch(e){case"input":if(EB(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var i=r[e];if(i!==t&&i.form===t.form){var n=MF(i);if(!n)throw Error(Oe(90));Kpe(i),EB(i,n)}}}break;case"textarea":tfe(t,r);break;case"select":e=r.value,e!=null&&ST(t,!!r.multiple,e,!1)}};lfe=cX;cfe=Hb;var RLe={usingClientEntryPoint:!1,Events:[iP,Z2,MF,ofe,afe,cX]},XE={findFiberByHostInstance:ub,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},PLe={bundleType:XE.bundleType,version:XE.version,rendererPackageName:XE.rendererPackageName,rendererConfig:XE.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yg.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=dfe(t),t===null?null:t.stateNode},findFiberByHostInstance:XE.findFiberByHostInstance||ALe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var OM=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!OM.isDisabled&&OM.supportsFiber)try{AF=OM.inject(PLe),Mf=OM}catch{}}Tu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RLe;Tu.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gX(e))throw Error(Oe(200));return CLe(t,e,null,r)};Tu.createRoot=function(t,e){if(!gX(t))throw Error(Oe(299));var r=!1,i="",n=Hme;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=pX(t,1,!1,null,null,r,!1,i,n),t[Mg]=e.current,UO(t.nodeType===8?t.parentNode:t),new mX(e)};Tu.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Oe(188)):(t=Object.keys(t).join(","),Error(Oe(268,t)));return t=dfe(e),t=t===null?null:t.stateNode,t};Tu.flushSync=function(t){return Hb(t)};Tu.hydrate=function(t,e,r){if(!zF(e))throw Error(Oe(200));return BF(null,t,e,!0,r)};Tu.hydrateRoot=function(t,e,r){if(!gX(t))throw Error(Oe(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",o=Hme;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=jme(e,null,t,1,r??null,n,!1,s,o),t[Mg]=e.current,UO(t),i)for(t=0;t<i.length;t++)r=i[t],n=r._getVersion,n=n(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,n]:e.mutableSourceEagerHydrationData.push(r,n);return new kF(e)};Tu.render=function(t,e,r){if(!zF(e))throw Error(Oe(200));return BF(null,t,e,!1,r)};Tu.unmountComponentAtNode=function(t){if(!zF(t))throw Error(Oe(40));return t._reactRootContainer?(Hb(function(){BF(null,null,t,!1,function(){t._reactRootContainer=null,t[Mg]=null})}),!0):!1};Tu.unstable_batchedUpdates=cX;Tu.unstable_renderSubtreeIntoContainer=function(t,e,r,i){if(!zF(r))throw Error(Oe(200));if(t==null||t._reactInternals===void 0)throw Error(Oe(38));return BF(t,e,r,!1,i)};Tu.version="18.2.0-next-9e3b772b8-20220608";function Wme(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Wme)}catch(t){console.error(t)}}Wme(),jpe.exports=Tu;var MLe=jpe.exports,tte=MLe;_B.createRoot=tte.createRoot,_B.hydrateRoot=tte.hydrateRoot;const $Le=t=>t.filter(e=>e!==void 0),qme=([t,e,r])=>`hsl(${t} ${e}% ${r}%)`;function VF(t,e=10){let r=t.flatMap(i=>Array.from({length:e},()=>i));return()=>{const i=rte(r),n=r.indexOf(i);return r.splice(n,1,rte(t)),i}}const rte=t=>t[Math.floor(Math.random()*t.length)],sP=10,yX=20,ILe=1e3,Xme=100,oP={I:{color:[180,100,50],definition:[["1"],["1"],["1"],["1"]],spawn:!0},O:{color:[200,100,50],definition:[["1","1"],["1","1"]],spawn:!0},T:{color:[300,100,50],definition:[["1","0"],["1","1"],["1","0"]],spawn:!0},S:{color:[120,100,50],definition:[["0","1","1"],["1","1","0"]],spawn:!0},J:{color:[240,100,50],definition:[["1","0","0"],["1","1","1"]],spawn:!0},Z:{color:[0,100,50],definition:[["1","1","0"],["0","1","1"]],spawn:!0},L:{color:[38.82,100,50],definition:[["1","0"],["1","0"],["1","1"]],spawn:!0},_:{color:[0,0,0],definition:[],spawn:!1}},UL=VF(Object.entries(oP).filter(([,{spawn:t}])=>t).map(([t])=>t));var Nn=(t=>(t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT",t))(Nn||{});const ite=t=>Object.entries(t).flatMap(([e,r])=>Object.keys(r).map(i=>[Number.parseInt(e),Number.parseInt(i)])),hS=(t,e,r=1)=>e===Nn.UP?LLe(t,r):Object.fromEntries(Object.entries(t).map(([i,n])=>[e===Nn.DOWN?Number.parseInt(i)+r:i,e===Nn.DOWN?n:Object.fromEntries(Object.keys(n).map(s=>[Number.parseInt(s)+(e===Nn.RIGHT?1:-1)*r,!0]))])),LLe=(t,e=1)=>DLe(t,r=>ULe(kLe(zLe(e,jLe(r))))),DLe=(t,e)=>[t].map(r=>({shape:r,shapeXOffset:XN(r,"x"),shapeYOffset:XN(r,"y")})).map(({shape:r,shapeXOffset:i,shapeYOffset:n})=>FLe(e(Yme(r,i,n)),i,n))[0],XN=(t,e)=>NLe((e==="x"?Object.values(t).flatMap(r=>Object.keys(r)):Object.keys(t)).map(r=>Number.parseInt(r))),NLe=t=>t.reduce((e,r)=>Number.isNaN(e)||r<e?r:e,Number.NaN),FLe=(t,e,r)=>hS(hS(t,Nn.DOWN,r),Nn.RIGHT,e),Yme=(t,e,r)=>hS(hS(t,Nn.DOWN,-r),Nn.LEFT,e),ULe=t=>Yme(t,XN(t,"x"),XN(t,"y")),kLe=t=>Object.fromEntries(t.map((e,r)=>[r,Object.fromEntries(e.map((i,n)=>({cell:i,cellIndex:n})).filter(({cell:i})=>i).map(({cellIndex:i})=>[i,!0]))]).filter(([,e])=>Object.keys(e).length>0)),zLe=(t,e)=>Array.from(Array.from({length:t%4})).reduce(r=>BLe(r),e),BLe=t=>GLe(VLe(t)),VLe=t=>t[0].map((e,r)=>t.map(i=>i[r])),GLe=t=>t.map(e=>e.slice().reverse()),jLe=t=>[t].map(e=>({shape:e,size:Math.max(nte(e,"x"),nte(e,"y"))})).map(({shape:e,size:r})=>Array.from(new Array(r)).reduce((i,n,s)=>[...i,Array.from(new Array(r)).reduce((o,a,l)=>{var c;return[...o,(c=e[s])!=null&&c[l]?1:0]},[])],[]))[0],nte=(t,e)=>HLe((e==="y"?Object.keys(t):Object.values(t).flatMap(r=>Object.keys(r))).map(r=>Number.parseInt(r)+1)),HLe=t=>t.reduce((e,r)=>Number.isNaN(e)||r>e?r:e,Number.NaN);function WLe(t,e){const r=t.nextShapes[0],i=oP[r].definition,n=i[0].length,s=Math.round((sP-n)/2),o=t.board.some((c,u)=>c.some((d,p)=>{var m;return((m=i[u])==null?void 0:m[p-s])==="1"&&d!=="_"})),a={};function l(c,u){return a[c]??(a[c]={}),a[c][u]=!0,r}return{...t,isGameOver:o,currentShape:r,nextShapes:[...t.nextShapes.slice(1),e],currentShapeLocation:a,board:t.board.map((c,u)=>c.map((d,p)=>{var m;return((m=i[u])==null?void 0:m[p-s])==="1"?l(u,p):d}))}}function ste(t,e){return ite(e).some(([,r])=>r<0||r>=sP)?t:ite(e).some(([r])=>r>=yX)||t.board.some((r,i)=>r.some((n,s)=>{var o,a;return((o=e[i])==null?void 0:o[s])&&!((a=t.currentShapeLocation[i])!=null&&a[s])&&n!=="_"}))?qLe({...t,currentShapeLocation:{}},XLe(t.board)):{...t,currentShapeLocation:e,board:t.board.map((r,i)=>r.map((n,s)=>{var o,a;return(o=e[i])!=null&&o[s]?t.currentShape:(a=t.currentShapeLocation[i])!=null&&a[s]?"_":n}))}}const qLe=(t,e)=>e.length===0?t:{...t,score:t.score+Xme*2^e.length-1,board:[...Array.from({length:e.length}).fill(new Array(sP).fill("_")),...t.board.filter((r,i)=>!e.includes(i))]},XLe=t=>t.map((e,r)=>({isCompleted:e.every(i=>i!=="_"),index:r})).filter(({isCompleted:e})=>e).map(({index:e})=>e),Ay={initial:t=>({board:Array.from({length:yX}).fill(Array.from({length:sP}).fill("_")),currentShapeLocation:{},currentShape:"_",nextShapes:t,score:0,isPaused:!1}),togglePause:t=>({...t,isPaused:!t.isPaused}),move:(t,e)=>Object.keys(t.currentShapeLocation).length===0||t.isPaused&&e!==Nn.DOWN?t:ste(t,hS(t.currentShapeLocation,e,t.isPaused?-1:1)),hardDrop(t){let e=t,r=t;for(;Object.keys(e.currentShapeLocation).length>0;)e=r,r=Ay.move(e,Nn.DOWN);return r},gravity(t,e){return t.isPaused?t:Object.keys(t.currentShapeLocation).length===0?WLe(t,e):ste(t,hS(t.currentShapeLocation,Nn.DOWN))}},RM="tetris-react-";function Zme(t,e){const[r,i]=ai.useState(()=>{const s=localStorage.getItem(`${RM}${t}`);return s===null?e:JSON.parse(s)}),n=ai.useCallback(s=>{localStorage.setItem(`${RM}${t}`,JSON.stringify(s)),i(s)},[t]);return ai.useEffect(()=>{globalThis.addEventListener("storage",({storageArea:s,key:o,newValue:a})=>{s!==globalThis.localStorage||o===null||!o.startsWith(RM)||a===null||o.slice(RM.length)!==t||JSON.stringify(r)===a||i(JSON.parse(a))})},[]),[r,n]}const Qme=()=>Zme("bestScore",0),YLe=()=>Zme("gameState",Ay.initial(Array.from({length:5},UL))),Ss={title:"Tetris React",paused:"Game is paused",esc:"ESC",pressKeyToResume:t=>st.jsxs(st.Fragment,{children:["Press ",t," to resume"]}),instructions:"Control the game using WSAD or arrow keys. Pause using the ESC key",score:"Score: ",gameOver:"Game Over!",yourScore:"Your score was: ",yourBestScore:"Your best score is: ",playAgain:"Play again?",saveGame:"Save game",loadGame:"Load game",panoramaRenderer:"Panorama World",sceneryRenderer:"Scenery World",gridRenderer:"Grid World",changeMap:"Change Map",nextSong:"Next Song",inspiredBy:t=>st.jsxs(st.Fragment,{children:["Inspired by ",t("Tetris Effect")]}),sourceCode:"Source Code"};function Jme({score:t,nextShapes:e}){const[r]=Qme();return st.jsxs("div",{className:"p-2 overflow-hidden",children:[st.jsxs("span",{className:"text-4xl",children:[Ss.score,st.jsx("span",{className:t>r?"text-red-500":void 0,children:t})]}),st.jsx("br",{}),st.jsx("span",{className:"pt-2 text-4xl font-mono",children:e.map((i,n)=>st.jsx("span",{style:{color:qme(oP[i].color),colorScheme:"white only"},children:i},n))})]})}function ZLe({board:t,score:e,nextShapes:r}){return st.jsxs("div",{className:"grid grid-cols-4",style:{width:"100vmin",height:"100vmin"},children:[st.jsx("span",{}),st.jsx(QLe,{board:t}),st.jsx(Jme,{score:e,nextShapes:r})]})}function QLe({board:t}){return st.jsx("div",{className:"bg-gradient-to-tr from-yellow-400 to-purple-400 col-span-2 p-2",children:st.jsx("div",{className:"h-full grid grid-cols-10 gap-0.5",children:t.map((e,r)=>st.jsx(ai.Fragment,{children:e.map((i,n)=>st.jsx("div",{style:{backgroundColor:qme(oP[i].color)}},n))},r))})})}const JLe="modulepreload",KLe=function(t){return"/tetris-react/"+t},ote={},ce=function(e,r,i){if(!r||r.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=KLe(s),s in ote)return;ote[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=n.length-1;u>=0;u--){const d=n[u];if(d.href===s&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":JLe,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};function h(t,e,r,i){var n,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}function OEt(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}function eDe(t){return t&&t.release&&typeof t.release=="function"}function tDe(t){return t&&t.acquire&&typeof t.acquire=="function"}let ko=class hV{constructor(e,r,i,n=1,s=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let r;if(hV.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let n=0;n<i;n++)this._pool[n]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):tDe(r)&&r.acquire(...e),r}release(e){e&&!hV.test.disabled&&(this._releaseFunction?this._releaseFunction(e):eDe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};ko.test={disabled:!1};function rDe(t){t.length=0}let uc=class{constructor(e=50,r=50){this._pool=new ko(Array,void 0,rDe,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return zU.acquire()}static release(e){return zU.release(e)}static prune(){zU.prune()}};const zU=new uc(100);function PEt(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function iDe(t,e){for(const r of t)if(r!=null&&e(r))return r}function dV(t){return t!=null&&typeof t[Symbol.iterator]=="function"}function _h(t,e){return t!=null?e(t):null}function sc(t,e){return GF(t,e),t}function GF(t,e){if(t==null)throw new Error(e??"value is None")}function Me(t){return t==null||t.destroy(),null}function Le(t){return t==null||t.dispose(),null}function Pi(t){return t==null||t.remove(),null}function yu(t){return t==null||t.abort(),null}function Fi(t){return t==null||t.release(),null}function nDe(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function lE(t){return null}function MEt(t,e){const r=new Array;for(const i of t)r.push(i!=null?e(i):null);return r}function $Et(t,e){for(const r of t)_h(r,e)}function IEt(t){return t}let Vi=class pV{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(dV(e)){const i=this._getOrCreateGroup(r);for(const n of e)this._isHandle(n)&&i.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&dV(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof pV)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof pV?r.removeAll():r.remove()}};const Kme=Symbol("Accessor-beforeDestroy");function dS(t){return Za(()=>t.forEach(e=>e!=null&&e.remove()))}function Za(t){return{remove:()=>{t&&(t(),t=void 0)}}}function LEt(t){return Za(t!=null?()=>t.destroy():void 0)}let FA=class sv{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*sv._m}getInt(){return this._seed=(sv._a*this._seed+sv._c)%sv._m,this._seed}getFloat(){return this.getInt()/(sv._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/sv._m*i}};FA._m=2147483647,FA._a=48271,FA._c=0;const jF=1.5,sDe=1/jF,oDe=.5;function HF(t,e){return e?t.filter((r,i,n)=>n.findIndex(e.bind(null,r))===i):t.filter((r,i,n)=>n.indexOf(r)===i)}function Hf(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function _X(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function aDe(t,e,r){let i,n;return r?(i=e.filter(s=>!t.some(o=>r(o,s))),n=t.filter(s=>!e.some(o=>r(o,s)))):(i=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:i,removed:n}}function lDe(t){return t&&typeof t.length=="number"}function DEt(t,e){const r=t.length;if(r===0)return[];const i=[];for(let n=0;n<r;n+=e)i.push(t.slice(n,n+e));return i}const cDe=!!Array.prototype.fill;function NEt(t,e){if(cDe)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function uDe(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function hDe(t,e,r){const i=t.length;let n=0,s=i-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return r?e>=t[i-1]?-1:o===e?n:n-1:o===e?n:-1}let ege=class{constructor(){this.last=0}};const tge=new ege;function fV(t,e,r,i){i=i||tge;const n=Math.max(0,i.last-10);for(let o=n;o<r;++o)if(t[o]===e)return i.last=o,o;const s=Math.min(n,r);for(let o=0;o<s;++o)if(t[o]===e)return i.last=o,o;return-1}function qO(t,e,r,i){const n=r??t.length,s=fV(t,e,n,i);if(s!==-1)return t[s]=t[n-1],r==null&&t.pop(),e}const Zh=new Set;function dDe(t,e,r=t.length,i=e.length,n,s){if(i===0||r===0)return r;Zh.clear();for(let a=0;a<i;++a)Zh.add(e[a]);n=n||tge;const o=Math.max(0,n.last-10);for(let a=o;a<r;++a)if(Zh.has(t[a])&&(s&&s.push(t[a]),Zh.delete(t[a]),t[a]=t[r-1],--r,--a,Zh.size===0||r===0))return Zh.clear(),r;for(let a=0;a<o;++a)if(Zh.has(t[a])&&(s&&s.push(t[a]),Zh.delete(t[a]),t[a]=t[r-1],--r,--a,Zh.size===0||r===0))return Zh.clear(),r;return Zh.clear(),r}function pDe(t,e){let r=0;for(let i=0;i<t.length;++i){const n=t[i];e(n,i)&&(t[r]=n,r++)}t.length=r}function fDe(t){return t?(ate.seed=t,()=>ate.getFloat()):Math.random}function UEt(t,e){const r=fDe(e);for(let i=t.length-1;i>0;i--){const n=Math.floor(r()*(i+1)),s=t[i];t[i]=t[n],t[n]=s}return t}const ate=new FA;function vX(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function kEt(t,e){const r=new Map,i=t.length;for(let n=0;n<i;n++){const s=t[n],o=e(s,n,t),a=r.get(o);a?a.push(s):r.set(o,[s])}return r}function aP(t,e){return t!=null}const mDe=[];let Qy;function se(t){return typeof Qy[t]=="function"?Qy[t]=Qy[t](globalThis):Qy[t]}var Cpe,Ape,Ope,Rpe;Qy=(Cpe=globalThis.dojoConfig)!=null&&Cpe.has||(Ape=globalThis.esriConfig)!=null&&Ape.has?{...(Ope=globalThis.dojoConfig)==null?void 0:Ope.has,...(Rpe=globalThis.esriConfig)==null?void 0:Rpe.has}:{},se.add=(t,e,r,i)=>((i||Qy[t]===void 0)&&(Qy[t]=e),r&&se(t)),se.cache=Qy,se.add("esri-deprecation-warnings",!0),se.add("esri-force-fullscreen-debug",!1),(()=>{var e;se.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(se.add("host-browser",t),se.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),se.add("dom",t),se("host-browser")){const r=navigator,i=r.userAgent,n=r.appVersion,s=parseFloat(n);if(se.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),se.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),se.add("khtml",n.includes("Konqueror")?s:void 0),se.add("edge",parseFloat(i.split("Edge/")[1])||void 0),se.add("opr",parseFloat(i.split("OPR/")[1])||void 0),se.add("webkit",!se("wp")&&!se("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),se.add("chrome",!se("edge")&&!se("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),se.add("android",!se("wp")&&parseFloat(i.split("Android ")[1])||void 0),se.add("safari",!n.includes("Safari")||se("wp")||se("chrome")||se("android")||se("edge")||se("opr")?void 0:parseFloat(n.split("Version/")[1])),se.add("mac",n.includes("Macintosh")),!se("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));se.add(o,l),se.add("ios",l)}se("webkit")||(!i.includes("Gecko")||se("wp")||se("khtml")||se("edge")||se.add("mozilla",s),se("mozilla")&&se.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&se.add("esri-mobile",e),r&&se.add("esri-iPhone",r),se.add("esri-geolocation",!!navigator.geolocation)}se.add("esri-wasm","WebAssembly"in globalThis),se.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),se.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),se.add("esri-atomics","Atomics"in globalThis),se.add("esri-workers","Worker"in globalThis),se.add("web-feat:cache","caches"in globalThis),se.add("esri-workers-arraybuffer-transfer",!se("safari")||Number(se("safari"))>=12),se.add("workers-pool-size",8),se.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),se.add("featurelayer-simplify-payload-size-factors",[1,1,4]),se.add("featurelayer-animation-enabled",!0),se.add("featurelayer-snapshot-enabled",!0),se.add("featurelayer-snapshot-point-min-threshold",8e4),se.add("featurelayer-snapshot-point-max-threshold",4e5),se.add("featurelayer-snapshot-point-coverage",.1),se.add("featurelayer-advanced-symbols",!1),se.add("featurelayer-pbf",!0),se.add("featurelayer-pbf-statistics",!1),se.add("feature-layers-workers",!0),se.add("feature-polyline-generalization-factor",1),se.add("mapview-transitions-duration",200),se.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),se.add("mapserver-pbf-version-support",10.81),se.add("mapservice-popup-identify-max-tolerance",20),se.add("heatmap-allow-raster-fallback",!1),se.add("heatmap-force-raster",!1),se("host-webworker")||se("host-browser")&&(se.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),se.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{se.add("esri-image-decode",!0,!0,!0)}).catch(()=>{se.add("esri-image-decode",!1,!0,!0)})}return!1}),se.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function o3(t){return t instanceof ArrayBuffer}function bX(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function Jy(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function rge(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function wX(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function WF(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function xX(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function qF(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function cE(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function uE(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function ap(t){return!("buffer"in t)}function Ky(t){return t!=null?ap(t)?8*t.length+12:t.byteLength+ige:0}const ige=145,_u=1024;function gDe(t){return uE(t)||cE(t)||xX(t)||wX(t)||bX(t)}function yDe(t){return uE(t)||cE(t)}function _De(t){return uE(t)?179769e303:cE(t)?3402823e32:qF(t)?4294967295:WF(t)?65535:Jy(t)||rge(t)?255:xX(t)?2147483647:wX(t)?32767:bX(t)?127:256}function nge(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&nge(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function ye(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=age(t);if(e!=null)return e;if(YN(t))return t.clone();if(sge(t))return t.map(ye);if(oge(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=ye(t[i]);return r}function mV(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=age(t);if(e!=null)return e;if(sge(t)){let r=!0;const i=t.map(n=>{const s=mV(n);return n!=null&&s==null&&(r=!1),s});return r?i:null}if(YN(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!oge(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const n=t[i],s=mV(n);if(n!=null&&s==null)return null;r[i]=s}return r}return null}function YN(t){return typeof t.clone=="function"}function sge(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function oge(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function lte(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function age(t){if(bX(t)||Jy(t)||rge(t)||wX(t)||WF(t)||xX(t)||qF(t)||cE(t)||uE(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,ye(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(ye(r));return e}return null}function TX(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function lge(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Hf(t,e):t instanceof Set?e instanceof Set&&bDe(t,e):t instanceof Map?e instanceof Map&&wDe(t,e):!!lte(t)&&lte(e)&&vDe(t,e))}function vDe(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function bDe(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function wDe(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const n=e.get(r);if(n!==i||n===void 0&&!e.has(r))return!1}return!0}function I_(t){return t.__accessor__??null}function xDe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function kL(t,e,r){return r?ZN(t,e,{policy:r,path:""}):ZN(t,e,null)}function ZN(t,e,r){return e?Object.keys(e).reduce((i,n)=>{const s=n;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${n}`:n,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[s]))return i[s]=e[s],i;if(i[s]===void 0)return i[s]=ye(e[s]),i;let l=i[s],c=e[s];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[s]=l.concat():i[s]=[l]:i[s]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(r){const u=r.path;r.path=o,i[s]=ZN(l,c,r),r.path=u}else i[s]=ZN(l,c,null);else i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[s]=c);return i},t||{}):t}function cge(t){return Array.isArray(t)?t:t.split(".")}function cte(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function TDe(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...cte(r));return e}return cte(t)}function uge(t,e,r,i){const n=TDe(e);if(n.length!==1){const s=n.map(o=>i(t,o,r));return dS(s)}return i(t,n[0],r)}function SX(t){let e=!1;return()=>{e||(e=!0,t())}}function hge(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const i=I_(e);return xDe(i,r)?i.get(r):e[r]}function dge(t,e,r){if(t==null)return t;const i=hge(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:dge(i,e,r+1)}function lP(t,e,r=0){return typeof e!="string"||e.includes(".")?dge(t,cge(e),r):hge(e,t)}function QN(t,e){return lP(t,e)}function ute(t,e){return lP(e,t)!==void 0}function cP(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=ye(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function XF(t,e){const r=cP(t);let i=r[e];return i||(i=r[e]={}),i}function SDe(t,e){return kL(t,e,CDe)}const EDe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function CDe(t){return EDe.test(t)?"replace":"merge"}function ADe(t,e,r=!1){return fge(t,e,r)}function uP(t,e){if(e!=null)return e[t]||pge(t.split("."),!1,e)}function Pw(t,e,r){const i=t.split("."),n=i.pop(),s=pge(i,!0,r);s&&n&&(s[n]=e)}function pge(t,e,r){let i=r;for(const n of t){if(i==null)return;if(!(n in i)){if(!e)return;i[n]={}}i=i[n]}return i}function fge(t,e,r){return e?Object.keys(e).reduce((i,n)=>{let s=i[n],o=e[n];return s===o?i:s===void 0?(i[n]=ye(o),i):(Array.isArray(o)||Array.isArray(i)?(s=s?Array.isArray(s)?i[n]=s.concat():i[n]=[s]:i[n]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{s.includes(a)||s.push(a)}):i[n]=o.concat())):o&&typeof o=="object"?i[n]=fge(s,o,r):i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[n]=o),i)},t||{}):t}var Ppe;const Jr={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:(Ppe=globalThis.location)==null?void 0:Ppe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(ADe(Jr,globalThis.esriConfig,!0),delete Jr.has),!Jr.assetsPath){{const t="4.27";Jr.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Jr.defaultAssetsPath=Jr.assetsPath}const ODe=/\{([^\}]+)\}/g;function hte(t){return t??""}function YF(t,e){return t.replaceAll(ODe,typeof e=="object"?(r,i)=>hte(uP(i,e)):(r,i)=>hte(e(i)))}function zEt(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function mge(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function BEt(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function VEt(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const dte={info:0,warn:1,error:2,none:3};let J=class Oa{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Oa._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Oa.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=Oa._loggers;return Oa._loggers=e,r},set throttlingDisabled(e){Oa._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Oa._loggers.get(e)||new Oa({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Oa._throttlingDisabled){const n=this._argsToKey(i),s=this._loggedMessages[e].get(n);if(r==="once"&&s!=null||r==="oncePerTick"&&s&&s>=Oa._tickCounter)return;this._loggedMessages[e].set(n,Oa._tickCounter),Oa._scheduleTickCounterIncrement()}for(const n of Jr.log.interceptors)if(n(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const n=i[e];if(n!=null)return n;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=Jr.log.level||"warn";return dte[this._parentWithMember("level",r)]<=dte[e]}_argsToKey(...e){return mge(JSON.stringify(e,(i,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){Oa._tickCounterScheduled||(Oa._tickCounterScheduled=!0,Promise.resolve().then(()=>{Oa._tickCounter++,Oa._tickCounterScheduled=!1}))}};J._loggers=new Map,J._tickCounter=0,J._tickCounterScheduled=!1,J._throttlingDisabled=!1;var ag;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(ag||(ag={}));let RDe=class{constructor(e,r){this._observers=e,this._observer=r}remove(){vX(this._observers,this._observer)}},gge=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return PDe;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,n=!1;const s=r.length;for(let o=0;o<s;++o){const a=r[o];if(a.destroyed)n=!0;else if(a===e){i=!0;break}}return i||(r.push(e),n&&this._removeDestroyedObservers()),new RDe(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let n=0;n<r;++n){for(;n+i<r&&e[n+i].destroyed;)++i;if(i>0){if(!(n+i<r))break;e[n]=e[n+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const PDe=Za();var Qr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Qr||(Qr={}));const HEt=Qr.USER+1;function yge(t){switch(t){case"defaults":return Qr.DEFAULTS;case"service":return Qr.SERVICE;case"portal-item":return Qr.PORTAL_ITEM;case"web-scene":return Qr.WEB_SCENE;case"web-map":return Qr.WEB_MAP;case"link-chart":return Qr.LINK_CHART;case"user":return Qr.USER;default:return null}}function gV(t){switch(t){case Qr.DEFAULTS:return"defaults";case Qr.SERVICE:return"service";case Qr.PORTAL_ITEM:return"portal-item";case Qr.WEB_SCENE:return"web-scene";case Qr.WEB_MAP:return"web-map";case Qr.LINK_CHART:return"link-chart";case Qr.USER:return"user"}return void 0}function MDe(t){return gV(t)}var Ei;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Ei||(Ei={}));const JN={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},a3=[];let UA=JN;function Ht(t){UA.onObservableAccessed(t)}let zL=!1,BL=!1;function Lg(t,e,r){if(zL)return EX(t,e,r);_ge(t);const i=e.call(r);return vge(),i}function $De(t,e){return Lg(JN,t,e)}function EX(t,e,r){const i=zL;zL=!0,_ge(t);let n=null;try{n=e.call(r)}catch(s){BL&&J.getLogger("esri.core.accessorSupport.tracking").error(s)}return vge(),zL=i,n}function _ge(t){UA=t,a3.push(t)}function vge(){const t=a3.length;if(t>1){const e=a3.pop();UA=a3[t-2],e.onTrackingEnd()}else if(t===1){const e=a3.pop();UA=JN,e.onTrackingEnd()}else UA=JN}function bge(t,e){const r=e.observerObject;if(r.flags&Ei.DepTrackingInitialized)return;const i=BL;BL=!1,r.flags&Ei.AutoTracked?EX(e,e.metadata.get,t):wge(t,e),BL=i}const IDe=[];function wge(t,e){const r=e.observerObject;r.flags&Ei.ExplicitlyTracking||(r.flags|=Ei.ExplicitlyTracking,EX(e,()=>{const i=e.metadata.dependsOn||IDe;for(const n of i)if(typeof n!="string"||n.includes(".")){const s=cge(n);for(let o=0,a=t;o<s.length&&a!=null&&typeof a=="object";++o)a=pte(a,s[o],o!==s.length-1)}else pte(t,n,!1)}),r.flags&=~Ei.ExplicitlyTracking)}function pte(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=I_(t);if(n){const s=n.propertiesByName.get(i);s&&(Ht(s.observerObject),bge(t,s))}return r?t[i]:void 0}let fte=class{constructor(e,r){this.propertyName=e,this.metadata=r,this.observerObject=new LDe,this._accessed=null,this._handles=null,this.observerObject.flags=Ei.Dirty|(r.nonNullable?Ei.NonNullable:0)|(r.hasOwnProperty("value")?Ei.HasDefaultValue:0)|(r.get===void 0?Ei.DepTrackingInitialized:0)|(r.dependsOn===void 0?Ei.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const r=this.observerObject;Ht(r);const i=e.store,n=this.propertyName,s=r.flags,o=i.get(n);if(s&Ei.Computing||~s&Ei.Dirty&&i.has(n))return o;r.flags|=Ei.Computing;const a=e.host;let l;s&Ei.AutoTracked?l=Lg(this,this.metadata.get,a):(wge(a,this),l=this.metadata.get.call(a)),i.set(n,l,Qr.COMPUTED);const c=i.get(n);return c===o?r.flags&=~Ei.Dirty:$De(this.commit,this),r.flags&=~Ei.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=Ei.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let n=0;n<r.length;++n)i.push(r[n].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~Ei.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},LDe=class extends gge{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&Ei.Overriden&&(this.flags|=Ei.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&Ei.Dirty&&this.onCommitted(),super.destroy()}},DDe=class xge{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new xge;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,ye(i))}),r}get(e){return this._values.get(e)}originOf(){return Qr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function PM(t,e,r){return t!==void 0}function mte(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&Ei.NonNullable)||(i.lifecycle,ag.INITIALIZING,!1))}function NDe(t){return t&&typeof t.destroy=="function"}J.getLogger("esri.core.accessorSupport.Properties");let FDe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=ag.INITIALIZING,this.store=new DDe,this._origin=Qr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const n=new fte(i,r[i]);this.propertiesByName.set(i,n)}this.metadatas=r}initialize(){this.lifecycle=ag.CONSTRUCTING}constructed(){this.lifecycle=ag.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&NDe(i)&&(i.destroy(),~r.observerObject.flags&Ei.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==ag.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Ht(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.observerObject.flags&Ei.HasDefaultValue)return"defaults"}return gV(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(PM(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);PM(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const n=this.propertiesByName.get(r);if(!PM(n))return"";const s=new Set,o=Lg({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(s.size===0)return a;i+="  ";for(const l of s)l instanceof fte&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const n=this.propertiesByName.get(e);if(PM(n))return this._setAtOrigin(n,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.observerObject.flags&Ei.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e),i=r==null?void 0:r.observerObject;i&&i.flags&Ei.Overriden&&(i.flags&=~Ei.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!mte(i,e,r,this))return;const n=i.metadata.cast;if(n){const s=this._cast(n,r),{valid:o,value:a}=s;if(BU.release(s),!o)return;r=a}i.observerObject.flags|=Ei.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!mte(i,e,r,this))return;const n=i.metadata.cast;if(n){const o=this._cast(n,r),{valid:a,value:l}=o;if(BU.release(o),!a)return;r=l}const s=i.metadata.set;s?s.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=yge(e)}getDefaultOrigin(){return gV(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==ag.INITIALIZING?this._origin:Qr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const n=this.store,s=e.propertyName;n.has(s,i)&&TX(r,n.get(s))&&~e.observerObject.flags&Ei.Overriden&&i===n.originOf(s)||(e.invalidate(),n.set(s,r,i),e.commit(),bge(this.host,e))}_cast(e,r){const i=BU.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},UDe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const BU=new ko(UDe);function kDe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(uP(i,e)??"").toString())}let Tge=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&kDe(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},Y=class Sge extends Tge{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ye(r)}catch{return"[object]"}}))}}catch(e){throw J.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Sge(e.name,e.message,e.details)}};Y.prototype.type="error";function KN(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))KN(t,i,e[i]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(n.length-1,1)[0];return void KN(QN(t,n),s,r)}const i=t.__accessor__;i!=null&&zDe(e,i),t[e]=r}}function zDe(t,e){if(se("esri-unknown-property-errors")&&!BDe(t,e))throw new Y("set:unknown-property",VDe(t,e))}function BDe(t,e){return e.metadatas[t]!=null}function VDe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let GDe;function jDe(){return GDe}let Ege=class extends ko{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=lE(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const MM=[];function pS(t){MM.push(t),MM.length===1&&queueMicrotask(()=>{const e=MM.slice();MM.length=0;for(const r of e)r()})}let dg=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var yV;(function(t){const e=(s,o,a,l)=>{let c=o,u=o;const d=a>>>1,p=s[c-1];for(;u<=d;){u=c<<1,u<a&&l(s[u-1],s[u])<0&&++u;const m=s[u-1];if(l(m,p)<=0)break;s[c-1]=m,c=u}s[c-1]=p},r=(s,o)=>s<o?-1:s>o?1:0;function i(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const d=s[o];s[o]=s[u],s[u]=d,e(s,c,u,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const d=s[o];s[o]=s[u],s[u]=d,e(s,c,u,l),yield}}t.sort=i,t.iterableSort=n})(yV||(yV={}));const gte=yV,HDe=1.5,WDe=1.1;let Nt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new ege,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>yte(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const n=this.data[i];e(n)&&r.push(n)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,yte(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=fV(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(fV(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=dDe(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){gte.sort(this.data,0,this.length,e)}iterableSort(e){return gte.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const n=this.data[i];if(e.call(r,n,i))return n}}filterInPlace(e,r){let i=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(r,s,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let n=i;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,n=this.data;for(let s=0;s<i;++s)e.call(r,n[s],s,n)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let n=0;n<this.length;++n)i[n]=e.call(r,this.data[n],n,this.data);return i}reduce(e,r){let i=r;for(let n=0;n<this.length;++n)i=e(i,this.data[n],n,this.data);return i}has(e){const r=this.length,i=this.data;for(let n=0;n<r;++n)if(i[n]===e)return!0;return!1}};function yte(t){t.data.length>HDe*t.length&&(t.data.length=Math.floor(t.length*WDe))}function qDe(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const hP=qDe(globalThis);function ZF(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function dP(t,e,r){if(!ZF(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const n of i)t.addEventListener(n,r);return{remove(){for(const n of i)t.removeEventListener(n,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function Cge(t,e,r){if(!ZF(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=dP(t,e,n=>{i.remove(),r.call(t,n)});return{remove(){i.remove()}}}const XDe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function YDe({key:t}){return XDe[t]||t}function wr(t="Aborted"){return new Y("AbortError",t)}function Bt(t,e="Aborted"){if(ss(t))throw wr(e)}function QF(t){return t!=null?"aborted"in t?t:t.signal:t}function ss(t){const e=QF(t);return e!=null&&e.aborted}function Mw(t){if(Zn(t))throw t}function _te(t){if(!Zn(t))throw t}function pa(t,e){const r=QF(t);if(r!=null){if(!r.aborted)return Cge(r,"abort",()=>e());e()}}function CX(t,e){const r=QF(t);if(r!=null)return Bt(r),Cge(r,"abort",()=>e(wr()))}function AX(t,e){return QF(e)==null?t:new Promise((r,i)=>{let n=pa(e,()=>i(wr()));const s=()=>n=Pi(n);t.then(s,s),t.then(r,i)})}function Zn(t){return(t==null?void 0:t.name)==="AbortError"}async function _V(t){try{return await t}catch(e){if(!Zn(e))throw e;return}}async function eCt(t,e=J.getLogger("esri")){try{return await t}catch(r){Zn(r)||e.error(r)}}async function o1(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),n=await o1(i),s={};return r.map((o,a)=>s[o]=n[a]),s}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,n)=>{const s=r[n];return s.status==="fulfilled"?{promise:i,value:s.value}:{promise:i,error:s.reason}}))}async function e4(t){return(await o1(t)).filter(e=>!!e.value).map(e=>e.value)}function XO(t,e=void 0,r){const i=new AbortController;return pa(r,()=>i.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);pa(i,()=>{o&&(clearTimeout(o),s(wr()))})})}function Eu(t){return t&&typeof t.then=="function"}function vV(t){return Eu(t)?t:Promise.resolve(t)}function Age(t,e=-1){let r,i,n,s,o=null;const a=(...l)=>{if(r){i=l,s&&s.reject(wr()),s=Wo();const p=s.promise;if(o){const m=o;o=null,m.abort()}return p}if(n=s||Wo(),s=null,e>0){const p=new AbortController;r=vV(t(...l,p.signal));const m=r;XO(e).then(()=>{r===m&&(s?p.abort():o=p)})}else r=1,r=vV(t(...l));const c=()=>{const p=i;i=n=r=o=null,p!=null&&a(...p)},u=r,d=n;return u.then(c,c),u.then(d.resolve,d.reject),d.promise};return a}function Wo(){let t,e;const r=new Promise((n,s)=>{t=n,e=s}),i=n=>{t(n)};return i.resolve=n=>t(n),i.reject=n=>e(n),i.timeout=(n,s)=>hP.setTimeout(()=>i.reject(s),n),i.promise=r,i}function tCt(t,e){return t.then(e,e)}async function vte(t){await Promise.resolve(),Bt(t)}function rCt(t){return t}function Oge(t){return 1e3*t}function OX(t){return .001*t}function ZDe(){return performance.now()}let QDe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},JDe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},bV=0,wV=0;const YE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},xV=["prepare","preRender","render","postRender","update","finish"],TV=[],Wb=new Nt;let KDe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const t4={frameTasks:Wb,willDispatch:!1,clearFrameTasks:eNe,dispatch:Mge,executeFrameTasks:rNe};function pP(t){const e=new JDe(t);return TV.push(e),t4.willDispatch||(t4.willDispatch=!0,pS(Mge)),e}function fS(t){const e=new QDe(t);return Wb.push(e),r4==null&&(bV=performance.now(),r4=requestAnimationFrame(Rge)),new KDe(e)}let r4=null;function eNe(t=!1){Wb.forAll(e=>{e.removed=!0}),t&&Pge()}function tNe(t){wV=Math.max(0,t)}function Rge(){const t=performance.now();r4=null,r4=Wb.length>0?requestAnimationFrame(Rge):null,t4.executeFrameTasks(t)}function rNe(t){const e=t-bV;bV=t;const r=wV>0?wV:1e3/60,i=Math.max(0,e-r);YE.time=t,YE.frameDuration=r-i;for(let n=0;n<xV.length;n++){const s=performance.now(),o=xV[n];Wb.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(YE.elapsedFrameTime=performance.now()-t,YE.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,YE)))}),iNe[n].record(performance.now()-s)}Pge(),nNe.record(performance.now()-t)}const $M=new Nt;function Pge(){Wb.forAll(t=>{t.removed&&$M.push(t)}),Wb.removeUnorderedMany($M.data,$M.length),$M.clear()}function Mge(){for(;TV.length;){const t=TV.shift();t.isActive&&t.callback()}t4.willDispatch=!1}function oCt(t=1,e){const r=Wo(),i=()=>{ss(e)?r.reject(wr()):t===0?r():(--t,pS(()=>i()))};return i(),r.promise}const iNe=xV.map(t=>new dg(t)),nNe=new dg("total");function VL(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let sNe=0;const oNe=0;function wc(){return++sNe}let JF=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new aNe(e),bte.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;bte.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let n=0;n<r.length;++n)e.push(r[n].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},aNe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=lNe}};const bte=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function lNe(){}let PT=!1;const i4=[];function $ge(t,e){let r=new JF(s),i=null,n=!1;function s(){if(!r||n)return;if(PT)return void Dge(s);const a=i;r.clear(),PT=!0,n=!0,i=Lg(r,t),n=!1,PT=!1,e(i,a),Nge()}function o(){r&&(r.destroy(),r=null,i=null)}return n=!0,i=Lg(r,t),n=!1,{remove:o}}function Ige(t,e){let r=new JF(n),i=null;function n(){e(i,o)}function s(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=Lg(r,t),i):null}return o(),{remove:s}}function Lge(t){let e=new JF(i),r=!1;function i(){e&&!r&&(PT?Dge(i):(e.clear(),PT=!0,r=!0,Lg(e,t),r=!1,PT=!1,Nge()))}function n(){e&&(e.destroy(),e=null)}return r=!0,Lg(e,t),r=!1,{remove:n}}function Dge(t){i4.includes(t)||i4.unshift(t)}function Nge(){for(;i4.length;)i4.pop()()}var kA;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(kA||(kA={}));let YO=class{constructor(){this.uid=wc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,n,s){return this.pool.acquire(kA.Untracked,e,r,i,n,s,TX)}static acquireTracked(e,r,i,n){return this.pool.acquire(kA.Tracked,e,r,i,null,null,n)}notify(e,r){this.type===kA.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,n,s,o,a){this.uid=wc(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=wc(),this.removed=!0}};YO.pool=new Ege(YO);const GL=new uc,yg=new Set;let n4;function s4(t){yg.delete(t),yg.add(t),n4||(n4=pP(hNe))}function cNe(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function uNe(t){for(const e of yg.values())e.target===t&&(e.removed=!0)}function hNe(){let t=10;for(;n4&&t--;){n4=null;const e=dNe(),r=GL.acquire();for(const i of e){const n=i.uid;cNe(i),n===i.uid&&i.removed&&r.push(i)}for(const i of yg)i.removed&&(r.push(i),yg.delete(i));for(const i of r)YO.pool.release(i);GL.release(r),GL.release(e),SV.forEach(i=>i())}}function dNe(){const t=GL.acquire();t.length=yg.size;let e=0;for(const r of yg)t[e]=r,++e;return yg.clear(),t}const SV=new Set;function Fge(t){return SV.add(t),{remove(){SV.delete(t)}}}function pNe(t,e,r){let i=uge(t,e,r,(n,s,o)=>{let a,l,c=Ige(()=>lP(n,s),(u,d)=>{n.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=YO.acquireUntracked(u,o,d,n,s),l=a.uid),s4(a))});return{remove:SX(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,s4(a)),a=null),i=c=null})}});return i}function fNe(t,e,r){const i=uge(t,e,r,(n,s,o)=>{let a=!1;return $ge(()=>lP(n,s),(l,c)=>{n.__accessor__.destroyed?i.remove():a||(a=!0,TX(c,l)||o.call(n,l,c,s,n),a=!1)})});return i}function mNe(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?fNe(t,e,r):pNe(t,e,r)}function gNe(t,e,r){let i,n,s=Ige(t,(o,a)=>{i&&i.uid!==n?s.remove():(i||(i=YO.acquireTracked(o,e,a,r),n=i.uid),s4(i))});return{remove:SX(()=>{s.remove(),i&&(i.uid!==n||i.removed||(i.removed=!0,s4(i)),i=null),s=null})}}function yNe(t,e,r){let i=!1;return $ge(t,(n,s)=>{i||(i=!0,r(s,n)||e(n,s),i=!1)})}function _Ne(t,e,r=!1,i=lge){return r?yNe(t,e,i):gNe(t,e,i)}function wte(t){return VL(yg,e=>e.oldValue===t)}function Do(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function uCt(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function Uge(t,e,r){const i=t.get(e);if(i!==void 0)return i;const n=r();return t.set(e,n),n}const MT=J.getLogger("esri.core.accessorSupport.ensureTypes");function vNe(t){return t==null?t:new Date(t)}function bNe(t){return t==null?t:!!t}function kge(t){return t==null?t:t.toString()}function Ud(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function RX(t){return t==null?t:Math.round(parseFloat(t))}function zge(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function o4(t,e){return e!=null&&t&&!(e instanceof t)}function Bge(t){return t&&"isCollection"in t}function xte(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function wNe(t,e){if(!e||!e.constructor||!Bge(e.constructor))return EV(t,e)?e:new t(e);const r=xte(t.prototype.itemType),i=xte(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(EV(t,e),e):new t(e):e}function EV(t,e){return!!zge(e)&&(MT.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+KF(t)+"'"),!0)}function mS(t,e){return e==null?e:Bge(t)?wNe(t,e):o4(t,e)?EV(t,e)?e:new t(e):e}function KF(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const xNe=new WeakMap;function TNe(t){switch(t){case Number:return Ud;case mn:return RX;case Boolean:return bNe;case String:return kge;case Date:return vNe;default:return Uge(xNe,t,()=>mS.bind(null,t))}}function Qa(t,e){const r=TNe(t);return arguments.length===1?r:r(e)}function ZO(t,e,r){return arguments.length===1?ZO.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function SNe(t,e){return arguments.length===1?ZO(r=>Qa(t,r)):ZO(r=>Qa(t,r),e)}function Vge(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>Vge(t,e-1,i)):t(r)}function a4(t,e,r){if(arguments.length===2)return s=>a4(t,e,s);if(!r)return r;r=Vge(t,e,r);let i=e,n=r;for(;i>0&&Array.isArray(n);)i--,n=n[0];if(n!==void 0)for(let s=0;s<i;s++)r=[r];return r}function ENe(t,e,r){return arguments.length===2?a4(i=>Qa(t,i),e):a4(i=>Qa(t,i),e,r)}function Gge(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function CV(t,e){if(arguments.length===2)return CV(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||n.some(d=>c==="string"&&d===String||c==="number"&&d===Number))||c==="object"&&n.some(d=>!o4(a,d))?a:(u&&i.length?(s||(s=i.map(d=>typeof d=="string"?`'${d}'`:`${d}`).join(", ")),MT.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(d=>KF(d)).join(", ")),MT.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):MT.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function L_(t,e){if(arguments.length===2)return L_(t).call(null,e);const r={},i=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=Qa(c),i.push(KF(c)),n.push(l)}const s=()=>`'${i.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!o4(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=r[c];if(!u)return MT.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!o4(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!zge(l)){const d={};for(const p in l)p!==t.key&&(d[p]=l[p]);return u(d)}return u(l)}}let mn=class{};const dCt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function CNe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function jge(t){switch(t.type){case"native":return Qa(t.value);case"array":return ZO(jge(t.value));case"one-of":return ANe(t);default:return null}}function ANe(t){let e=null;return(r,i)=>OV(r,t)?r:(e==null&&(e=AV(t)),MT.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function AV(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case mn:return"integer";case Date:return"date";default:return KF(t.value)}case"array":return`array of ${AV(t.value)}`;case"one-of":{const e=t.values.map(r=>AV(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function OV(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case mn:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!OV(r,e.value));case"one-of":return e.values.some(r=>OV(t,r))}}function f(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),n=XF(e,r);i&&(i.get||i.set?(n.get=i.get||n.get,n.set=i.set||n.set):"value"in i&&("value"in t&&J.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=i.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let u;n.dependsOn=[l],n.get=function(){let d=QN(this,l);if(typeof d=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=QN(this,u);p&&(d=d.bind(p))}return d},n.readOnly||(n.set=c?function(d){this._override(r,d)}:function(d){KN(this,l,d)})}const o=t.type,a=t.types;n.cast||(o?n.cast=ONe(o):a&&(Array.isArray(a)?n.cast=ZO(L_(a[0])):n.cast=L_(a))),SDe(n,t),t.range&&(n.cast=RNe(n.cast,t.range))}}function Hge(t,e,r){const i=XF(t,r);i.json||(i.json={});let n=i.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function ONe(t){let e=0,r=t;if(CNe(t))return jge(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(Gge(i))return e===0?CV(i):a4(CV(i),e);if(e===1)return SNe(i);if(e>1)return ENe(i,e);const n=t;return n.from?n.from:Qa(n)}function RNe(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function PNe(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const n=e[i];r[i].forEach(s=>{e[s]=n}),delete e[i]}}}let D_=class extends Tge{constructor(e,r,i){super(e,r,i)}};D_.prototype.type="warning";function Wge(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const RV=J.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function Tte(t,e,r){var i,n;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((n=e.read)==null?void 0:n.enabled)===!1||INe(t)&&Pw("read.reader",PX(t),e))}function PX(t){var r,i;const e=t.ndimArray??0;if(e>1)return $Ne(t);if(e===1)return Ste(t);if("type"in t&&Xge(t.type)){const n=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,s=Ste(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return MX(t)}function MX(t){return"type"in t?MNe(t.type):LNe(t.types)}function MNe(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void RV.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,i),s}:t.fromJSON}function qge(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(n=>qge(t,n,r,i-1)):t(e,void 0,r)}function $Ne(t){const e=MX(t),r=qge.bind(null,e),i=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=r(n,o,i);let a=i,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function Ste(t){const e=MX(t);return(r,i,n)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(r,void 0,n);return s!==void 0?[s]:void 0}}function Xge(t){if(!Wge(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?$X(e.Type):Yge(e.Type))}function INe(t){return"types"in t?Yge(t.types):$X(t.type)}function $X(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Xge(t))}function Yge(t){for(const e in t.typeMap)if(!$X(t.typeMap[e]))return!1;return!0}function LNe(t){let e=null;const r=t.errorContext??"type";return(i,n,s)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void RV.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=DNe(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const d=`Type '${l||"unknown"}' is not supported`;return s&&s.messages&&i&&s.messages.push(new D_(`${r}:unsupported`,d,{definition:i,context:s})),void RV.error(d)}const u=new c;return u.read(i,s),u}}function DNe(t){var r,i;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=cP(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=s);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){e[n]=s;continue}const c=l.target,u=typeof c=="string"?c:t.key,d={};l.writer(n,d,u),d[u]&&(e[d[u]]=s)}return e}function NNe(t){if(t.json||(t.json={}),Cte(t.json),Ate(t.json),Ete(t.json),t.json.origins)for(const e in t.json.origins)Cte(t.json.origins[e]),Ate(t.json.origins[e]),Ete(t.json.origins[e]);return!0}function Ete(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function Cte(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function Ate(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function Ote(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&Wge(t.type))?e.write.writer=kNe:r>1?e.write.writer=zNe(r):e.types?Array.isArray(e.types)?e.write.writer=UNe(e.types[0]):e.write.writer=FNe(e.types):e.write.writer=QO}function FNe(t){return(e,r,i,n)=>e?Zge(e,t,n)?QO(e,r,i,n):void 0:QO(e,r,i,n)}function Zge(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new Y(`${i}:unsupported`,n,{definition:t,context:r})),J.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function UNe(t){return(e,r,i,n)=>!e||!Array.isArray(e)?QO(e,r,i,n):QO(e.filter(s=>Zge(s,t,n)),r,i,n)}function QO(t,e,r,i){Pw(r,l4(t,i),e)}function l4(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?c4(t):t}function c4(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function kNe(t,e,r,i){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>l4(s,i)),typeof n.toArray=="function"&&(n=n.toArray())):n=[l4(t,i)],Pw(r,n,e)}function Qge(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>Qge(i,e,r-1)):l4(t,e)}function zNe(t){return(e,r,i,n)=>{let s;if(e===null)s=null;else{s=Qge(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}Pw(i,s,r)}}function BNe(t,e){return IX(t,"any",e==null?void 0:e.origin)}function PV(t,e){return IX(t,"read",e==null?void 0:e.origin)}function Jge(t,e){return IX(t,"write",e==null?void 0:e.origin)}function IX(t,e,r){let i=t==null?void 0:t.json;if(i!=null&&i.origins&&r){let n;n=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],n&&(e==="any"||e in n)&&(i=n)}return i}function VNe(t){const e=GNe(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],n=i.types?jNe(i):e;Tte(n,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),Ote(n,i)}Tte(e,t.json,!0),Ote(e,t.json)}function GNe(t){return t.json.types?MV(t.json):t.type?Kge(t):MV(t)}function jNe(t){return t.type?Kge(t):MV(t)}function Kge(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!Gge(r);)r=r[0],e++;return{type:r,ndimArray:e}}function MV(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function HNe(t){NNe(t)&&(PNe(t),VNe(t))}const VU=new Set,GU=new Set;function N(t){return e=>{e.prototype.declaredClass=t,qNe(e);const r=[],i=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!VU.has(n.initialize)&&(VU.add(n.initialize),r.push(n.initialize)),n.hasOwnProperty("destroy")&&!GU.has(n.destroy)&&(GU.add(n.destroy),i.push(n.destroy)),n=Object.getPrototypeOf(n);VU.clear(),GU.clear();class s extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[Kme];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}this.postscript(...a)}}}return s.__accessorMetadata__=cP(e.prototype),s.prototype.declaredClass=t,s}}function WNe(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Ht(i.observerObject);const n=r.store;return n.has(t)?n.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function qNe(t){const e=t.prototype,r=cP(e),i={};for(const n of Object.getOwnPropertyNames(r)){const s=r[n];HNe(s),i[n]={enumerable:!0,configurable:!0,get:WNe(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===ag.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var e0e,t0e;function XNe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const K0=Symbol("Accessor-Handles"),$V=Symbol("Accessor-Initialized");let xe=class r0e{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}cP(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let d;this.inherited=function(...p){if(s.prototype[a])return s.prototype[a].apply(this,p)};try{d=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,d}:e[a]}for(const a in r){const l=XNe(r[a]);f(l)(o.prototype,a)}return N(i)(o)}constructor(...e){if(this[e0e]=null,this[t0e]=!1,this.constructor===r0e)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new FDe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e)),Rte.register(this,r.propertiesByName,this)}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[$V]=!0}initialize(){}[Kme](){this[K0]=Me(this[K0])}destroy(){var e;this.destroyed||(Rte.unregister(this),uNe(this),this.__accessor__.destroy(),(e=jDe())==null||e.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[$V]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return QN(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return KN(this,e,r),this}watch(e,r,i){return mNe(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){if(this.destroyed){const n=Array.isArray(e)?e:[e];for(const s of n)s.remove();return}let i=this[K0];i==null&&(i=this[K0]=new Vi),i.add(e,r)}removeHandles(e){const r=this[K0];r!=null&&r.remove(e)}removeAllHandles(){const e=this[K0];e!=null&&e.removeAll()}hasHandles(e){const r=this[K0];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};e0e=K0,t0e=$V;const Rte=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()});let jL=class i0e{constructor(){this._emitter=new i0e.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){var n;(n=this._listenersMap)==null||n.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){const o=this._listenersMap&&this._listenersMap.get(n);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,s)}),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return dS(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(n)||[],l=a.indexOf(s);l>=0&&a.splice(l,1)}}}once(n,s){const o=this.on(n,a=>{o.remove(),s.call(null,a)});return o}hasEventListener(n){const s=this._listenersMap&&this._listenersMap.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let n=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=h([N("esri.core.Evented")],n),n};let r=class extends xe{constructor(){super(...arguments),this._emitter=new jL.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,n){return this._emitter.emit(i,n)}on(i,n){return this._emitter.on(i,n)}once(i,n){return this._emitter.once(i,n)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=h([N("esri.core.Evented")],r),t.EventedAccessor=r})(jL||(jL={}));const Bn=jL;var Yr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Yr||(Yr={}));function n0e(t){return(e,r)=>{e[r]=t}}let e6=class extends gge{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var ng;let YNe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const Ou=new ko(YNe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),ZNe=()=>{};function jU(t){return t?t instanceof Yv?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function HU(t){if(t&&t.length)return t[0]}function QNe(t,e,r,i){const n=Math.min(t.length-r,e.length-i);let s=0;for(;s<n&&t[r+s]===e[i+s];)s++;return s}function s0e(t,e,r,i){e&&e.forEach((n,s,o)=>{t.push(n),s0e(t,r.call(i,n,s,o),r,i)})}const y0=new Set,_0=new Set,v0=new Set,WU=new Map;let JNe=0,Yv=ng=class extends Bn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof ng}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new e6,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:JNe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof ng?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Ht(this._observable),this._items}set items(t){this._emitBeforeChanges(Yr.ADD)||(this._splice(0,this.length,jU(t)),this._emitAfterChanges(Yr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=ZNe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(Ht(this._observable),this._emitBeforeChanges(Yr.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(Yr.ADD),this}addMany(t,e=this._items.length){if(Ht(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(Yr.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,jU(t)),this._emitAfterChanges(Yr.ADD),this}at(t){if(Ht(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Ht(this._observable),!this.length||this._emitBeforeChanges(Yr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Yr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Ht(this._observable),this._createNewInstance({items:this._items.map(ye)})}concat(...t){Ht(this._observable);const e=t.map(jU);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Ht(this._observable),!this.length||this._emitBeforeChanges(Yr.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let n=0;n<i;n++)t.call(e,r[n],n,r);this._emitAfterChanges(Yr.REMOVE)}every(t,e){return Ht(this._observable),this._items.every(t,e)}filter(t,e){let r;return Ht(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Ht(this._observable),this._items.find(t,e)}findIndex(t,e){return Ht(this._observable),this._items.findIndex(t,e)}flatten(t,e){Ht(this._observable);const r=[];return s0e(r,this,t,e),new ng(r)}forEach(t,e){return Ht(this._observable),this._items.forEach(t,e)}getItemAt(t){return Ht(this._observable),this._items[t]}getNextIndex(t){Ht(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Ht(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Ht(this._observable),this._items.indexOf(t,e)}join(t=","){return Ht(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Ht(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Ht(this._observable);const r=this._items.map(t,e);return new ng({items:r})}reorder(t,e=this.length-1){Ht(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(Yr.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(Yr.MOVE)}return t}}pop(){if(Ht(this._observable),!this.length||this._emitBeforeChanges(Yr.REMOVE))return;const t=HU(this._splice(this.length-1,1));return this._emitAfterChanges(Yr.REMOVE),t}push(...t){return Ht(this._observable),this._emitBeforeChanges(Yr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Yr.ADD)),this.length}reduce(t,e){Ht(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Ht(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Ht(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Ht(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Yr.REMOVE))return;const e=HU(this._splice(t,1));return this._emitAfterChanges(Yr.REMOVE),e}removeMany(t){if(Ht(this._observable),!t||!t.length||this._emitBeforeChanges(Yr.REMOVE))return[];const e=t instanceof ng?t.toArray():t,r=this._items,i=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=r.indexOf(o);if(a>-1){const l=1+QNe(e,r,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),s+=l-1}}return this._emitAfterChanges(Yr.REMOVE),i}reverse(){if(Ht(this._observable),this._emitBeforeChanges(Yr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Yr.MOVE),this}shift(){if(Ht(this._observable),!this.length||this._emitBeforeChanges(Yr.REMOVE))return;const t=HU(this._splice(0,1));return this._emitAfterChanges(Yr.REMOVE),t}slice(t=0,e=this.length){return Ht(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Ht(this._observable),this._items.some(t,e)}sort(t){if(Ht(this._observable),!this.length||this._emitBeforeChanges(Yr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Yr.MOVE),this}splice(t,e,...r){Ht(this._observable);const i=(e?Yr.REMOVE:0)|(r.length?Yr.ADD:0);if(this._emitBeforeChanges(i))return[];const n=this._splice(t,e,r)||[];return this._emitAfterChanges(i),n}toArray(){return Ht(this._observable),this._items.slice()}toJSON(){return Ht(this._observable),this.toArray()}toLocaleString(){return Ht(this._observable),this._items.toLocaleString()}toString(){return Ht(this._observable),this._items.toString()}unshift(...t){return Ht(this._observable),!t.length||this._emitBeforeChanges(Yr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Yr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=pP(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Ou.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,s),t+=1,l-=1,c-=1);Ou.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Ou.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Ou.release(a)}}if(r&&r.length){if(n){const u=[];for(const d of r){const p=n.ensureType(d);p==null&&d!=null||u.push(p)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Ou.acquire();u.target=this,u.cancellable=!0;const d=Ou.acquire();d.target=this,d.cancellable=!1;for(const p of r)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),l&&(d.reset(p),this.emit("after-add",d)))):(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),d.reset(p),this.emit("after-add",d));Ou.release(d),Ou.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Ou.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Ou.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Ou.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Ou.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;y0.clear(),_0.clear(),v0.clear();for(const{added:l,removed:c}of r){if(l)if(v0.size===0&&_0.size===0)for(const u of l)y0.add(u);else for(const u of l)_0.has(u)?(v0.add(u),_0.delete(u)):v0.has(u)||y0.add(u);if(c)if(v0.size===0&&y0.size===0)for(const u of c)_0.add(u);else for(const u of c)y0.has(u)?y0.delete(u):(v0.delete(u),_0.add(u))}const i=uc.acquire();y0.forEach(l=>{i.push(l)});const n=uc.acquire();_0.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=uc.acquire();if(v0.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||n.length||a.length)){const l={target:this,added:i,removed:n,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const d=e.listeners[u];d.removed||d.callback.call(this,l)}}uc.release(i),uc.release(n),uc.release(a)}y0.clear(),_0.clear(),v0.clear()}};Yv.ofType=t=>{if(!t)return ng;if(WU.has(t))return WU.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const n=t.typeMap[i].prototype.declaredClass;e?e+=` | ${n}`:e=n}let r=class extends ng{};return h([n0e({Type:t,ensureType:typeof t=="function"?Qa(t):L_(t)})],r.prototype,"itemType",void 0),r=h([N(`esri.core.Collection<${e}>`)],r),WU.set(t,r),r},h([f()],Yv.prototype,"length",void 0),h([f()],Yv.prototype,"items",null),Yv=ng=h([N("esri.core.Collection")],Yv);const ir=Yv;function qb(t,e,r=ir){return e||(e=new r),e===t||(e.removeAll(),KNe(t)?e.addMany(t):t&&e.add(t)),e}function o0e(t){return t}function KNe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const Pte=new Set;function e4e(t,e,r=!1){r&&Pte.has(e)||(r&&Pte.add(e),t.warn(` DEPRECATED - ${e}`))}function e_(t,e,r={}){if(se("esri-deprecation-warnings")){const{moduleName:i}=r;u4(t,`Property: ${(i?i+"::":"")+e}`,r)}}function u4(t,e,r={}){if(se("esri-deprecation-warnings")){const{replacement:i,version:n,see:s,warnOnce:o}=r;let a=e;i&&(a+=`
	 Replacement: ${i}`),n&&(a+=`
	 Version: ${n}`),s&&(a+=`
	 See ${s} for more details.`),e4e(t,a,o)}}let t4e=class a0e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new a0e;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,ye(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??Qr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var n;return((n=this._values.get(i))==null?void 0:n.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===Qr.DEFAULTS){const n=this._values.get(e);if(n&&n.origin!=null&&n.origin>i)return}this._values.set(e,new r4e(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===Qr.DEFAULTS?e:Qr.USER}},r4e=class{constructor(e,r){this.value=e,this.origin=r}};function i4e(t,e,r){e.keys().forEach(n=>{r.set(n,e.get(n),Qr.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(n=>{t.internalGet(n)&&r.set(n,t.internalGet(n),Qr.DEFAULTS)})}function n4e(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&ute(i,r))return!0}else for(const n of i)if(n===e||n.includes(".")&&n.indexOf(e)===0&&ute(n,r))return!0;return!1}function s4e(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function o4e(t,e,r,i,n){let s=PV(e[r],n);s4e(s)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))s=PV(e[o],n),n4e(s,r,i)&&(t[o]=!0)}function a4e(t,e,r,i){const n=r.metadatas,s=BNe(n[e],i),o=s==null?void 0:s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const l0e={origin:"service"};function l4e(t,e,r=l0e){if(!e||typeof e!="object")return;const i=I_(t),n=i.metadatas,s={};for(const o of Object.getOwnPropertyNames(e))o4e(s,n,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(s)){const a=PV(n[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?lP(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||a4e(t,o,i,r)}i.setDefaultOrigin("user")}function yCt(t,e,r,i=l0e){var s;const n={...i,messages:[]};r(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function c4e(t,e,r,i,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,s,r,n),s}function c0e(t,e,r,i,n,s){if(!i||!i.write)return!1;const o=t.get(r);if(!n&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,s??void 0);a!==void 0&&(n=a)}if(n||(n=i.write),!n||n.enabled===!1)return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new Y("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&s&&s.messages?s.messages.push(a):a&&!s&&J.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===Qr.DEFAULTS)&&u4e(t,r,s,i,o)||!n.ignoreOrigin&&s&&s.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<yge(s.origin))}function u4e(t,e,r,i,n){const s=i.default;if(s===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,r??void 0);return Hf(o,n)}return!1}return s===n}function _Ct(t,e,r,i){const n=I_(t),s=n.metadatas,o=Jge(s[e],i);return!!o&&c0e(t,n,e,o,r,i)}function h4e(t,e,r){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return kL(e,t.toJSON(r));const i=I_(t),n=i.metadatas;for(const a in n){const l=Jge(n[a],r);if(!c0e(t,i,a,l,void 0,r))continue;const c=t.get(a),u=c4e(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(u).length>0&&(e=kL(e,u),(o=(s=r==null?void 0:r.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>kL(e,u,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:MDe(i.store.originOf(a)),newOrigin:r.origin}))}return e}const fP=t=>{let e=class extends t{constructor(...r){super(...r);const i=I_(this),n=i.store,s=new t4e;i.store=s,i4e(i,n,s)}read(r,i){l4e(this,r,i)}write(r,i){return h4e(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return d4e.call(this,r,i)}};return e=h([N("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function d4e(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let ke=class extends fP(xe){};ke=h([N("esri.core.JSONSupport")],ke);var Oy;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(Oy||(Oy={}));let p4e=class{constructor(){this._resolver=Wo(),this._status=Oy.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Oy.RESOLVED,this._cleanUp()},()=>{this._status=Oy.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===Oy.RESOLVED}isRejected(){return this._status===Oy.REJECTED}isFulfilled(){return this._status!==Oy.PENDING}abort(){this._resolver.reject(wr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Wo(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==i||Zn(n)||this._resolver.reject(n)}),e.resolve()}};const t6=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new p4e,this.addResolvingPromise(Promise.resolve())}destroy(){var r;(r=this._promiseProps)==null||r.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=h([N("esri.core.Promise")],e),e};let h4=class extends t6(xe){};h4=h([N("esri.core.Promise")],h4);const f4e="not-loaded",m4e="loading",g4e="failed",Mte="loaded",u0e=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=CX(s,l);this.destroyed&&l(new Y("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===f4e){this._set("loadStatus",m4e);const a=this._loadController=new AbortController;n({signal:a.signal}),pa(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",Mte),this._loadController=null},i=>{this._set("loadStatus",g4e),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=yu(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===Mte}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new Y("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return h([f({readOnly:!0})],e.prototype,"loaded",null),h([f({readOnly:!0})],e.prototype,"loadError",void 0),h([f({clonable:!1})],e.prototype,"loadStatus",void 0),h([f({type:[D_],readOnly:!0})],e.prototype,"loadWarnings",null),e=h([N("esri.core.Loadable")],e),e};let l3=class extends u0e(h4){};l3=h([N("esri.core.Loadable")],l3),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=u0e,t.isLoadable=e}(l3||(l3={}));const Dg=l3;function r6(t,e,r){return o1(t.map((i,n)=>e.apply(r,[i,n])))}async function y4e(t,e,r){return(await o1(t.map((i,n)=>e.apply(r,[i,n])))).map(i=>i.value)}function LX(t){return{ok:!0,value:t}}function DX(t){return{ok:!1,error:t}}function _4e(t){return t!=null&&t.ok===!0?t.value:null}function v4e(t){return t!=null&&t.ok===!1?t.error:null}async function Ng(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return LX(await t)}catch(e){return DX(e)}}async function TCt(t){try{return LX(await t)}catch(e){return Mw(e),DX(e)}}function SCt(t){if(t.ok===!0)return t.value;throw t.error}function hE(t,e){return new ey(t,e)}let ey=class extends xe{get value(){return _4e(this._result)}get error(){return v4e(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=yu(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(n=>{this._result=LX(n),this._cleanup()},n=>{this._result=DX(n),this._cleanup()}),this._abortHandle=pa(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Pi(this._abortHandle),this._abortController=null}};h([f()],ey.prototype,"value",null),h([f()],ey.prototype,"error",null),h([f()],ey.prototype,"finished",null),h([f()],ey.prototype,"promise",void 0),h([f()],ey.prototype,"_result",void 0),ey=h([N("esri.core.asyncUtils.ReactiveTask")],ey);async function h0e(t,e){return await t.load(),b4e(t,e)}async function b4e(t,e){const r=[],i=(...s)=>{for(const o of s)o!=null&&(Array.isArray(o)?i(...o):ir.isCollection(o)?o.forEach(a=>i(a)):Dg.isLoadable(o)&&r.push(o))};e(i);let n=null;if(await y4e(r,async s=>{const o=await Ng(w4e(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function w4e(t){return"loadAll"in t&&typeof t.loadAll=="function"}const x4e=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,T4e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function $te(t){const e=t==null?void 0:t.match(x4e);if(!e)return null;const[,r,i,n]=e;if(!r)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:u}=T4e;if(i)if(s=r,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function S4e(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function E4e(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}const C4e=J.getLogger("esri.core.urlUtils"),dE=Jr.request,Ite="esri/config: esriConfig.request.proxyUrl is not set.",d0e=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,p0e=/^\s*http:/i,A4e=/^\s*https:/i,O4e=/^\s*file:/i,R4e=/:\d+$/,P4e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,M4e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),$4e=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let $T=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(M4e);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match($4e),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const IM={},I4e=new $T(Jr.applicationUrl);let ja=I4e;const L4e=D4e();let NX=L4e;const FX=()=>ja,ACt=()=>NX;function D4e(){const t=ja.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${ja.scheme}://${ja.host}${ja.port!=null?`:${ja.port}`:""}`}${e}`}function Ja(t){if(!t)return null;const e={path:null,query:null},r=new $T(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=UX(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function UX(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const n=i.indexOf("=");let s,o;n<0?(s=decodeURIComponent(i),o=""):(s=decodeURIComponent(i.slice(0,n)),o=decodeURIComponent(i.slice(n+1)));let a=r[s];typeof a=="string"&&(a=r[s]=[a]),Array.isArray(a)?a.push(o):r[s]=o}return r}function Lte(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function JO(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const n=encodeURIComponent(r)+"=",s=e&&e[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map(o=>Lte(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):Lte(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function N4e(t=!1){let e,r=dE.proxyUrl;if(typeof t=="string"){e=V4e(t);const i=i6(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw C4e.warn(Ite),new Y("urlutils:proxy-not-set",Ite);return e&&IV()&&(r=GX(r)),Ja(r)}function OCt(t){const e=i6(t);let r,i;if(e){const n=kX(e.proxyUrl);r=n.path,i=n.query?UX(n.query):null}if(r){const n=Ja(t);t=r+"?"+n.path;const s=JO({...i,...n.query});s&&(t=`${t}?${s}`)}return t}const ZE={path:"",query:""};function kX(t){const e=t.indexOf("?");return e!==-1?(ZE.path=t.slice(0,e),ZE.query=t.slice(e+1)):(ZE.path=t,ZE.query=null),ZE}function f0e(t){return t=(t=p4(t=q4e(t=kX(t).path),!0)).toLowerCase()}function F4e(t){const e={proxyUrl:t.proxyUrl,urlPrefix:f0e(t.urlPrefix)},r=dE.proxyRules,i=e.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const o=r[s].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;n=s;break}o.indexOf(i)===0&&(n=s+1)}return r.splice(n,0,e),n}function i6(t){const e=dE.proxyRules,r=f0e(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function RCt(t,e){if(!t||!e)return!1;t=d4(t),e=d4(e);const r=$te(t),i=$te(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&gS(t,e,!0)}function U4e(t,e){return t=d4(t),e=d4(e),p4(t)===p4(e)}function d4(t){const e=(t=_g(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function m0e(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=dE.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function gS(t,e,r=!1){if(!t||!e)return!1;const i=DV(t),n=DV(e);return!(!r&&i.scheme!==n.scheme)&&i.host!=null&&n.host!=null&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function zX(t){if(typeof t=="string"){if(!uu(t))return!0;t=DV(t)}if(gS(t,ja))return!0;const e=dE.trustedServers||[];for(let r=0;r<e.length;r++){const i=k4e(e[r]);for(let n=0;n<i.length;n++)if(gS(t,i[n]))return!0}return!1}function k4e(t){return IM[t]||(VX(t)||Wf(t)?IM[t]=[new $T(iu(t))]:IM[t]=[new $T(`http://${t}`),new $T(`https://${t}`)]),IM[t]}function iu(t,e=NX,r){return Wf(t)?r&&r.preserveProtocolRelative?t:ja.scheme==="http"&&ja.authority===Kd(t).slice(2)?`http:${t}`:`https:${t}`:VX(t)?t:s6(t[0]==="/"?W4e(e):e,t)}function n6(t,e=NX,r){if(t==null||!uu(t))return t;const i=_g(t),n=i.toLowerCase(),s=_g(e).toLowerCase().replace(/\/+$/,""),o=r?_g(r).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(d,p,m)=>(m=d.indexOf(p,m))===-1?d.length:m;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let d=0;d<u;d++)t=`../${t}`;else t=`./${t}`;return t}function _g(t){return t=Z4e(t=Y4e(t=X4e(t=iu(t=t.trim()))))}function s6(...t){const e=t.filter(aP);if(!e||!e.length)return;const r=[];if(uu(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(r.push(n.slice(0,s+1)),j4e(e[0])&&(r[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<i.length;n++){const s=i[n];s===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!s&&n===i.length-1||s&&(s!=="."||r.length===0))&&r.push(s)}return r.join("/")}function Kd(t,e=!1){if(t==null||KO(t)||im(t))return null;let r=t.indexOf("://");if(r===-1&&Wf(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=p4(t,!0)),t}function uu(t){return Wf(t)||VX(t)}function KO(t){return t!=null&&t.slice(0,5)==="blob:"}function im(t){return t!=null&&t.slice(0,5)==="data:"}function BX(t){const e=Xb(t);return e&&e.isBase64?E4e(e.data):null}function PCt(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const z4e=/^data:(.*?)(;base64)?,(.*)$/;function Xb(t){const e=t.match(z4e);if(!e)return null;const[,r,i,n]=e;return{mediaType:r,isBase64:!!i,data:n}}function g0e(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function MCt(t){const e=BX(t);if(!e)return null;const r=Xb(t);return new Blob([e],{type:r.mediaType})}function $Ct(t,e){B4e(t,e)}function B4e(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function Wf(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function VX(t){return t!=null&&d0e.test(t)}function V4e(t){return t!=null&&A4e.test(t)||ja.scheme==="https"&&Wf(t)}function G4e(t){return t!=null&&p0e.test(t)||ja.scheme==="http"&&Wf(t)}function j4e(t){return t!=null&&O4e.test(t)}function GX(t){return Wf(t)?`https:${t}`:t.replace(p0e,"https:")}function H4e(){return ja.scheme==="http"}function IV(){return ja.scheme==="https"}function p4(t,e=!1){return Wf(t)?t.slice(2):(t=t.replace(d0e,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function W4e(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function o6(t){let e=0;if(uu(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function ICt(t,e){if(!t)return"";const r=Ja(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const n=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(n,"")}function q4e(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function y0e(t){return t.replace(/\/+$/,"")}function X4e(t){if(/^https?:\/\//i.test(t)){const e=kX(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function Y4e(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function Z4e(t){const e=dE.httpsDomains;if(!G4e(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),R4e.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return H4e()&&i===ja.authority&&!P4e.test(t)||(IV()&&i===ja.authority||e&&e.some(n=>i===n||i.endsWith(`.${n}`))||IV()&&!i6(t))&&(t=GX(t)),t}function LV(t,e,r){if(!(e&&r&&t&&uu(t)))return t;const i=t.indexOf("//"),n=t.indexOf("/",i+2),s=t.indexOf(":",i+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function DV(t){return typeof t=="string"?new $T(iu(t)):(t.scheme||(t.scheme=ja.scheme),t)}function _0e(t){return Q4e.test(t)}function v0e(t,e){const r=Ja(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function b0e(t,e,r){const i=Ja(t),n=i.query||{};return n[e]=String(r),`${i.path}?${JO(n)}`}function qU(t,e){const r=Ja(t),i=r.query||{};for(const s in e)i[s]=e[s];const n=JO(i);return n?`${r.path}?${n}`:r.path}function LCt(t){if(t==null)return null;const e=t.match(w0e);return e?e[2]:null}function Dte(t){if(t==null)return null;const e=t.match(w0e);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function DCt(t){return typeof t=="string"?Xb(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(Xb(i.result)),i.onerror=n=>r(n)})}const w0e=/([^.]*)\.([^\/]*)$/,Q4e=/(^data:image\/svg|\.svg$)/i;function xr(t,e,r){let i,n;return e===void 0?(n=t,i=[void 0]):typeof e!="string"?(n=t,i=[void 0],r=e):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of i){const c=Hge(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let zn=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,n,s)=>{const o=this.toJSON(i);o!==void 0&&Pw(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function Oc(){return function(t,e){return new zn(t,{ignoreUnknown:!0,...e})}}let jX=class{constructor(e,r,i,n){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Kt=new jX(6378137,1/298.257223563,3e5,.006694379990137799),If=new jX(3396190,1/169.8944472236118,23e4),Fg=new jX(1737400,0,0);var fh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(fh||(fh={}));let g;const $={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)$[g]=0;for(g=2056;g<=2065;g++)$[g]=0;for(g=2067;g<=2135;g++)$[g]=0;for(g=2137;g<=2154;g++)$[g]=0;for(g=2161;g<=2170;g++)$[g]=0;for(g=2172;g<=2193;g++)$[g]=0;for(g=2195;g<=2198;g++)$[g]=0;for(g=2200;g<=2203;g++)$[g]=0;for(g=2205;g<=2217;g++)$[g]=0;for(g=2222;g<=2224;g++)$[g]=1;for(g=2225;g<=2250;g++)$[g]=2;for(g=2251;g<=2253;g++)$[g]=1;for(g=2257;g<=2264;g++)$[g]=2;for(g=2274;g<=2279;g++)$[g]=2;for(g=2280;g<=2282;g++)$[g]=1;for(g=2283;g<=2289;g++)$[g]=2;for(g=2290;g<=2292;g++)$[g]=0;for(g=2308;g<=2313;g++)$[g]=0;for(g=2315;g<=2491;g++)$[g]=0;for(g=2494;g<=2866;g++)$[g]=0;for(g=2867;g<=2869;g++)$[g]=1;for(g=2870;g<=2888;g++)$[g]=2;for(g=2891;g<=2895;g++)$[g]=2;for(g=2896;g<=2898;g++)$[g]=1;for(g=2902;g<=2908;g++)$[g]=2;for(g=2915;g<=2920;g++)$[g]=2;for(g=2921;g<=2923;g++)$[g]=1;for(g=2924;g<=2930;g++)$[g]=2;for(g=2931;g<=2962;g++)$[g]=0;for(g=2964;g<=2968;g++)$[g]=2;for(g=2969;g<=2973;g++)$[g]=0;for(g=2975;g<=2991;g++)$[g]=0;for(g=2995;g<=3051;g++)$[g]=0;for(g=3054;g<=3079;g++)$[g]=0;for(g=3081;g<=3088;g++)$[g]=0;for(g=3092;g<=3101;g++)$[g]=0;for(g=3106;g<=3138;g++)$[g]=0;for(g=3146;g<=3151;g++)$[g]=0;for(g=3153;g<=3166;g++)$[g]=0;for(g=3168;g<=3172;g++)$[g]=0;for(g=3174;g<=3203;g++)$[g]=0;for(g=3294;g<=3358;g++)$[g]=0;for(g=3367;g<=3403;g++)$[g]=0;for(g=3408;g<=3416;g++)$[g]=0;for(g=3417;g<=3438;g++)$[g]=2;for(g=3441;g<=3446;g++)$[g]=2;for(g=3447;g<=3450;g++)$[g]=0;for(g=3451;g<=3459;g++)$[g]=2;for(g=3460;g<=3478;g++)$[g]=0;for(g=3554;g<=3559;g++)$[g]=0;for(g=3560;g<=3570;g++)$[g]=2;for(g=3571;g<=3581;g++)$[g]=0;for(g=3594;g<=3597;g++)$[g]=0;for(g=3601;g<=3604;g++)$[g]=0;for(g=3637;g<=3639;g++)$[g]=0;for(g=3665;g<=3667;g++)$[g]=0;for(g=3693;g<=3695;g++)$[g]=0;for(g=3701;g<=3727;g++)$[g]=0;for(g=3728;g<=3739;g++)$[g]=2;for(g=3740;g<=3751;g++)$[g]=0;for(g=3753;g<=3760;g++)$[g]=2;for(g=3761;g<=3773;g++)$[g]=0;for(g=3775;g<=3777;g++)$[g]=0;for(g=3779;g<=3781;g++)$[g]=0;for(g=3783;g<=3785;g++)$[g]=0;for(g=3788;g<=3791;g++)$[g]=0;for(g=3797;g<=3802;g++)$[g]=0;for(g=3814;g<=3816;g++)$[g]=0;for(g=3825;g<=3829;g++)$[g]=0;for(g=3832;g<=3841;g++)$[g]=0;for(g=3844;g<=3852;g++)$[g]=0;for(g=3873;g<=3885;g++)$[g]=0;for(g=3890;g<=3893;g++)$[g]=0;for(g=3907;g<=3912;g++)$[g]=0;for(g=3942;g<=3950;g++)$[g]=0;for(g=3968;g<=3970;g++)$[g]=0;for(g=3973;g<=3976;g++)$[g]=0;for(g=3986;g<=3989;g++)$[g]=0;for(g=3994;g<=3997;g++)$[g]=0;for(g=4048;g<=4051;g++)$[g]=0;for(g=4056;g<=4063;g++)$[g]=0;for(g=4093;g<=4096;g++)$[g]=0;for(g=4390;g<=4398;g++)$[g]=0;for(g=4399;g<=4413;g++)$[g]=2;for(g=4418;g<=4433;g++)$[g]=2;for(g=4455;g<=4457;g++)$[g]=2;for(g=4484;g<=4489;g++)$[g]=0;for(g=4491;g<=4554;g++)$[g]=0;for(g=4568;g<=4589;g++)$[g]=0;for(g=4652;g<=4656;g++)$[g]=0;for(g=4766;g<=4800;g++)$[g]=0;for(g=5014;g<=5016;g++)$[g]=0;for(g=5069;g<=5072;g++)$[g]=0;for(g=5105;g<=5130;g++)$[g]=0;for(g=5173;g<=5188;g++)$[g]=0;for(g=5253;g<=5259;g++)$[g]=0;for(g=5269;g<=5275;g++)$[g]=0;for(g=5292;g<=5311;g++)$[g]=0;for(g=5329;g<=5331;g++)$[g]=0;for(g=5343;g<=5349;g++)$[g]=0;for(g=5355;g<=5357;g++)$[g]=0;for(g=5387;g<=5389;g++)$[g]=0;for(g=5459;g<=5463;g++)$[g]=0;for(g=5479;g<=5482;g++)$[g]=0;for(g=5518;g<=5520;g++)$[g]=0;for(g=5530;g<=5539;g++)$[g]=0;for(g=5550;g<=5552;g++)$[g]=0;for(g=5562;g<=5583;g++)$[g]=0;for(g=5623;g<=5625;g++)$[g]=2;for(g=5631;g<=5639;g++)$[g]=0;for(g=5649;g<=5653;g++)$[g]=0;for(g=5663;g<=5680;g++)$[g]=0;for(g=5682;g<=5685;g++)$[g]=0;for(g=5875;g<=5877;g++)$[g]=0;for(g=5896;g<=5899;g++)$[g]=0;for(g=5921;g<=5940;g++)$[g]=0;for(g=6050;g<=6125;g++)$[g]=0;for(g=6244;g<=6275;g++)$[g]=0;for(g=6328;g<=6348;g++)$[g]=0;for(g=6350;g<=6356;g++)$[g]=0;for(g=6366;g<=6372;g++)$[g]=0;for(g=6381;g<=6387;g++)$[g]=0;for(g=6393;g<=6404;g++)$[g]=0;for(g=6480;g<=6483;g++)$[g]=0;for(g=6511;g<=6514;g++)$[g]=0;for(g=6579;g<=6581;g++)$[g]=0;for(g=6619;g<=6624;g++)$[g]=0;for(g=6625;g<=6627;g++)$[g]=2;for(g=6628;g<=6632;g++)$[g]=0;for(g=6634;g<=6637;g++)$[g]=0;for(g=6669;g<=6692;g++)$[g]=0;for(g=6707;g<=6709;g++)$[g]=0;for(g=6720;g<=6723;g++)$[g]=0;for(g=6732;g<=6738;g++)$[g]=0;for(g=6931;g<=6933;g++)$[g]=0;for(g=6956;g<=6959;g++)$[g]=0;for(g=7005;g<=7007;g++)$[g]=0;for(g=7057;g<=7070;g++)$[g]=2;for(g=7074;g<=7082;g++)$[g]=0;for(g=7109;g<=7118;g++)$[g]=0;for(g=7119;g<=7127;g++)$[g]=1;for(g=7374;g<=7376;g++)$[g]=0;for(g=7528;g<=7586;g++)$[g]=0;for(g=7587;g<=7645;g++)$[g]=2;for(g=7692;g<=7696;g++)$[g]=0;for(g=7755;g<=7787;g++)$[g]=0;for(g=7791;g<=7795;g++)$[g]=0;for(g=7799;g<=7801;g++)$[g]=0;for(g=7803;g<=7805;g++)$[g]=0;for(g=7825;g<=7831;g++)$[g]=0;for(g=7845;g<=7859;g++)$[g]=0;for(g=8013;g<=8032;g++)$[g]=0;for(g=8065;g<=8068;g++)$[g]=1;for(g=8518;g<=8529;g++)$[g]=2;for(g=8533;g<=8536;g++)$[g]=2;for(g=8538;g<=8540;g++)$[g]=2;for(g=8677;g<=8679;g++)$[g]=0;for(g=8836;g<=8840;g++)$[g]=0;for(g=8857;g<=8859;g++)$[g]=0;for(g=8908;g<=8910;g++)$[g]=0;for(g=9154;g<=9159;g++)$[g]=0;for(g=9205;g<=9218;g++)$[g]=0;for(g=9271;g<=9273;g++)$[g]=0;for(g=9295;g<=9297;g++)$[g]=0;for(g=9356;g<=9360;g++)$[g]=0;for(g=9404;g<=9407;g++)$[g]=0;for(g=9476;g<=9482;g++)$[g]=0;for(g=9487;g<=9494;g++)$[g]=0;for(g=9697;g<=9699;g++)$[g]=0;for(g=9821;g<=9865;g++)$[g]=0;for(g=20002;g<=20032;g++)$[g]=0;for(g=20047;g<=20049;g++)$[g]=0;for(g=20062;g<=20092;g++)$[g]=0;for(g=20135;g<=20138;g++)$[g]=0;for(g=20248;g<=20258;g++)$[g]=0;for(g=20348;g<=20358;g++)$[g]=0;for(g=20436;g<=20440;g++)$[g]=0;for(g=20822;g<=20824;g++)$[g]=0;for(g=20904;g<=20932;g++)$[g]=0;for(g=20934;g<=20936;g++)$[g]=0;for(g=21004;g<=21032;g++)$[g]=0;for(g=21035;g<=21037;g++)$[g]=0;for(g=21095;g<=21097;g++)$[g]=0;for(g=21148;g<=21150;g++)$[g]=0;for(g=21207;g<=21264;g++)$[g]=0;for(g=21307;g<=21364;g++)$[g]=0;for(g=21413;g<=21423;g++)$[g]=0;for(g=21453;g<=21463;g++)$[g]=0;for(g=21473;g<=21483;g++)$[g]=0;for(g=21780;g<=21782;g++)$[g]=0;for(g=21891;g<=21894;g++)$[g]=0;for(g=21896;g<=21899;g++)$[g]=0;for(g=22171;g<=22177;g++)$[g]=0;for(g=22181;g<=22187;g++)$[g]=0;for(g=22191;g<=22197;g++)$[g]=0;for(g=22207;g<=22222;g++)$[g]=0;for(g=22234;g<=22236;g++)$[g]=0;for(g=22243;g<=22250;g++)$[g]=0;for(g=22262;g<=22265;g++)$[g]=0;for(g=22307;g<=22322;g++)$[g]=0;for(g=22348;g<=22357;g++)$[g]=0;for(g=22407;g<=22422;g++)$[g]=0;for(g=22462;g<=22465;g++)$[g]=0;for(g=22521;g<=22525;g++)$[g]=0;for(g=22607;g<=22622;g++)$[g]=0;for(g=22641;g<=22646;g++)$[g]=0;for(g=22648;g<=22657;g++)$[g]=0;for(g=22707;g<=22722;g++)$[g]=0;for(g=22762;g<=22765;g++)$[g]=0;for(g=22991;g<=22994;g++)$[g]=0;for(g=23028;g<=23038;g++)$[g]=0;for(g=23830;g<=23853;g++)$[g]=0;for(g=23866;g<=23872;g++)$[g]=0;for(g=23877;g<=23884;g++)$[g]=0;for(g=23886;g<=23894;g++)$[g]=0;for(g=23946;g<=23948;g++)$[g]=0;for(g=24311;g<=24313;g++)$[g]=0;for(g=24342;g<=24347;g++)$[g]=0;for(g=24370;g<=24374;g++)$[g]=10;for(g=24375;g<=24381;g++)$[g]=0;for(g=24718;g<=24721;g++)$[g]=0;for(g=24817;g<=24821;g++)$[g]=0;for(g=24877;g<=24882;g++)$[g]=0;for(g=24891;g<=24893;g++)$[g]=0;for(g=25391;g<=25395;g++)$[g]=0;for(g=25828;g<=25838;g++)$[g]=0;for(g=26191;g<=26195;g++)$[g]=0;for(g=26391;g<=26393;g++)$[g]=0;for(g=26701;g<=26722;g++)$[g]=0;for(g=26729;g<=26799;g++)$[g]=2;for(g=26801;g<=26803;g++)$[g]=2;for(g=26811;g<=26813;g++)$[g]=2;for(g=26847;g<=26870;g++)$[g]=2;for(g=26891;g<=26899;g++)$[g]=0;for(g=26901;g<=26923;g++)$[g]=0;for(g=26929;g<=26946;g++)$[g]=0;for(g=26948;g<=26998;g++)$[g]=0;for(g=27037;g<=27040;g++)$[g]=0;for(g=27205;g<=27232;g++)$[g]=0;for(g=27258;g<=27260;g++)$[g]=0;for(g=27391;g<=27398;g++)$[g]=0;for(g=27561;g<=27564;g++)$[g]=0;for(g=27571;g<=27574;g++)$[g]=0;for(g=27581;g<=27584;g++)$[g]=0;for(g=27591;g<=27594;g++)$[g]=0;for(g=28191;g<=28193;g++)$[g]=0;for(g=28348;g<=28358;g++)$[g]=0;for(g=28402;g<=28432;g++)$[g]=0;for(g=28462;g<=28492;g++)$[g]=0;for(g=29118;g<=29122;g++)$[g]=0;for(g=29168;g<=29172;g++)$[g]=0;for(g=29177;g<=29185;g++)$[g]=0;for(g=29187;g<=29195;g++)$[g]=0;for(g=29900;g<=29903;g++)$[g]=0;for(g=30161;g<=30179;g++)$[g]=0;for(g=30491;g<=30494;g++)$[g]=0;for(g=30729;g<=30732;g++)$[g]=0;for(g=31251;g<=31259;g++)$[g]=0;for(g=31265;g<=31268;g++)$[g]=0;for(g=31275;g<=31279;g++)$[g]=0;for(g=31281;g<=31297;g++)$[g]=0;for(g=31461;g<=31469;g++)$[g]=0;for(g=31491;g<=31495;g++)$[g]=0;for(g=31917;g<=31922;g++)$[g]=0;for(g=31965;g<=32e3;g++)$[g]=0;for(g=32001;g<=32003;g++)$[g]=2;for(g=32005;g<=32031;g++)$[g]=2;for(g=32033;g<=32060;g++)$[g]=2;for(g=32064;g<=32067;g++)$[g]=2;for(g=32074;g<=32077;g++)$[g]=2;for(g=32081;g<=32086;g++)$[g]=0;for(g=32107;g<=32130;g++)$[g]=0;for(g=32133;g<=32159;g++)$[g]=0;for(g=32164;g<=32167;g++)$[g]=2;for(g=32180;g<=32199;g++)$[g]=0;for(g=32201;g<=32260;g++)$[g]=0;for(g=32301;g<=32360;g++)$[g]=0;for(g=32601;g<=32662;g++)$[g]=0;for(g=32664;g<=32667;g++)$[g]=2;for(g=32701;g<=32761;g++)$[g]=0;for(g=53001;g<=53004;g++)$[g]=0;for(g=53008;g<=53019;g++)$[g]=0;for(g=53021;g<=53032;g++)$[g]=0;for(g=53034;g<=53037;g++)$[g]=0;for(g=53042;g<=53046;g++)$[g]=0;for(g=53074;g<=53080;g++)$[g]=0;for(g=54001;g<=54004;g++)$[g]=0;for(g=54008;g<=54019;g++)$[g]=0;for(g=54021;g<=54032;g++)$[g]=0;for(g=54034;g<=54037;g++)$[g]=0;for(g=54042;g<=54046;g++)$[g]=0;for(g=54048;g<=54053;g++)$[g]=0;for(g=54074;g<=54080;g++)$[g]=0;for(g=54098;g<=54101;g++)$[g]=0;for(g=102001;g<=102040;g++)$[g]=0;for(g=102042;g<=102063;g++)$[g]=0;for(g=102065;g<=102067;g++)$[g]=0;for(g=102070;g<=102117;g++)$[g]=0;for(g=102122;g<=102216;g++)$[g]=0;for(g=102221;g<=102377;g++)$[g]=0;for(g=102382;g<=102388;g++)$[g]=0;for(g=102389;g<=102398;g++)$[g]=2;for(g=102399;g<=102444;g++)$[g]=0;for(g=102445;g<=102447;g++)$[g]=2;for(g=102448;g<=102458;g++)$[g]=0;for(g=102459;g<=102468;g++)$[g]=2;for(g=102469;g<=102499;g++)$[g]=0;for(g=102500;g<=102519;g++)$[g]=1;for(g=102520;g<=102524;g++)$[g]=0;for(g=102525;g<=102529;g++)$[g]=2;for(g=102530;g<=102588;g++)$[g]=0;for(g=102590;g<=102598;g++)$[g]=0;for(g=102601;g<=102603;g++)$[g]=0;for(g=102605;g<=102628;g++)$[g]=0;for(g=102629;g<=102646;g++)$[g]=2;for(g=102648;g<=102700;g++)$[g]=2;for(g=102701;g<=102703;g++)$[g]=0;for(g=102707;g<=102730;g++)$[g]=2;for(g=102733;g<=102758;g++)$[g]=2;for(g=102767;g<=102900;g++)$[g]=0;for(g=102901;g<=102933;g++)$[g]=2;for(g=102934;g<=102950;g++)$[g]=13;for(g=102951;g<=102955;g++)$[g]=0;for(g=102961;g<=102963;g++)$[g]=0;for(g=102965;g<=102969;g++)$[g]=0;for(g=102971;g<=102973;g++)$[g]=0;for(g=102975;g<=102989;g++)$[g]=0;for(g=102990;g<=102992;g++)$[g]=1;for(g=102997;g<=103002;g++)$[g]=0;for(g=103003;g<=103008;g++)$[g]=2;for(g=103009;g<=103011;g++)$[g]=0;for(g=103012;g<=103014;g++)$[g]=2;for(g=103019;g<=103021;g++)$[g]=0;for(g=103022;g<=103024;g++)$[g]=2;for(g=103029;g<=103031;g++)$[g]=0;for(g=103032;g<=103034;g++)$[g]=2;for(g=103065;g<=103068;g++)$[g]=0;for(g=103074;g<=103076;g++)$[g]=0;for(g=103077;g<=103079;g++)$[g]=1;for(g=103080;g<=103082;g++)$[g]=0;for(g=103083;g<=103085;g++)$[g]=2;for(g=103090;g<=103093;g++)$[g]=0;for(g=103097;g<=103099;g++)$[g]=0;for(g=103100;g<=103102;g++)$[g]=2;for(g=103107;g<=103109;g++)$[g]=0;for(g=103110;g<=103112;g++)$[g]=2;for(g=103113;g<=103116;g++)$[g]=0;for(g=103117;g<=103120;g++)$[g]=2;for(g=103153;g<=103157;g++)$[g]=0;for(g=103158;g<=103162;g++)$[g]=2;for(g=103163;g<=103165;g++)$[g]=0;for(g=103166;g<=103168;g++)$[g]=1;for(g=103169;g<=103171;g++)$[g]=2;for(g=103186;g<=103188;g++)$[g]=0;for(g=103189;g<=103191;g++)$[g]=2;for(g=103192;g<=103195;g++)$[g]=0;for(g=103196;g<=103199;g++)$[g]=2;for(g=103200;g<=103224;g++)$[g]=0;for(g=103225;g<=103227;g++)$[g]=1;for(g=103232;g<=103237;g++)$[g]=0;for(g=103238;g<=103243;g++)$[g]=2;for(g=103244;g<=103246;g++)$[g]=0;for(g=103247;g<=103249;g++)$[g]=2;for(g=103254;g<=103256;g++)$[g]=0;for(g=103257;g<=103259;g++)$[g]=2;for(g=103264;g<=103266;g++)$[g]=0;for(g=103267;g<=103269;g++)$[g]=2;for(g=103300;g<=103375;g++)$[g]=0;for(g=103381;g<=103383;g++)$[g]=0;for(g=103384;g<=103386;g++)$[g]=1;for(g=103387;g<=103389;g++)$[g]=0;for(g=103390;g<=103392;g++)$[g]=2;for(g=103397;g<=103399;g++)$[g]=0;for(g=103400;g<=103471;g++)$[g]=2;for(g=103476;g<=103478;g++)$[g]=0;for(g=103479;g<=103481;g++)$[g]=2;for(g=103486;g<=103488;g++)$[g]=0;for(g=103489;g<=103491;g++)$[g]=2;for(g=103492;g<=103495;g++)$[g]=0;for(g=103496;g<=103499;g++)$[g]=2;for(g=103528;g<=103543;g++)$[g]=0;for(g=103544;g<=103548;g++)$[g]=2;for(g=103549;g<=103551;g++)$[g]=0;for(g=103552;g<=103554;g++)$[g]=1;for(g=103555;g<=103557;g++)$[g]=2;for(g=103558;g<=103560;g++)$[g]=0;for(g=103571;g<=103573;g++)$[g]=0;for(g=103574;g<=103576;g++)$[g]=2;for(g=103577;g<=103580;g++)$[g]=0;for(g=103581;g<=103583;g++)$[g]=2;for(g=103595;g<=103694;g++)$[g]=0;for(g=103696;g<=103699;g++)$[g]=0;for(g=103700;g<=103793;g++)$[g]=2;for(g=103794;g<=103890;g++)$[g]=0;for(g=103891;g<=103896;g++)$[g]=2;for(g=103900;g<=103971;g++)$[g]=2;for(g=103972;g<=103977;g++)$[g]=0;for(g=112e3;g<=112101;g++)$[g]=0;const J4e={102113:!0,102100:!0,3857:!0,3785:!0},K4e={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},Nte='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',LM=[-20037508342788905e-9,20037508342788905e-9],DM=[-20037508342787e-6,20037508342787e-6],x0e={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:LM,origin:DM,dx:1e-5},102100:{wkTemplate:Nte,valid:LM,origin:DM,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:LM,origin:DM,dx:1e-5},3857:{wkTemplate:Nte,valid:LM,origin:DM,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Js(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||Yb(t)&&Yb(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function Sb(t){return ua(t)&&t.wkid&&x0e[t.wkid]||null}function T0e(t){return!!ua(t)&&(t.wkid?$[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function eR(t){return!(nm(t)||sm(t))}function tR(t){return ua(t)&&t.wkid===4326}function S0e(t){return ua(t)&&t.wkid===fh.CGCS2000}function Yb(t){return ua(t)&&t.wkid!=null&&J4e[t.wkid]===!0}function HX(t){return ua(t)&&t.wkid===32662}function WX(t){return t===fh.GCSMARS2000||t===fh.GCSMARS2000_SPHERE}function nm(t){return ua(t)&&t.wkid!=null&&WX(t.wkid)}function qX(t){return t===fh.GCSMOON2000}function sm(t){return ua(t)&&t.wkid!=null&&qX(t.wkid)}function e5e(t){return ua(t)&&t.wkid!=null&&K4e[t.wkid]===!0}function ua(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const t5e={wkid:4326,wkt:YF(x0e[4326].wkTemplate,{Central_Meridian:"0.0"})},r5e={wkid:102100,latestWkid:3857},i5e={wkid:32662};function XX(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const E0e=XX(Kt),YX=XX(If),ZX=XX(Fg),C0e={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Kt.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Mr(t){return t!=null&&(nm(t)||Js(t,YX))?If:t!=null&&(sm(t)||Js(t,ZX))?Fg:Kt}function UCt(t){return WX(t)?If:qX(t)?Fg:Kt}const QX=39.37,n5e=Kt.radius*Math.PI/200,A0e=/UNIT\[([^\]]+)\]\]$/i,Eb=$,O0e=/UNIT\[([^\]]+)\]/i,s5e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),o5e=Oc()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Ep=t=>t*t,b0=t=>t*t*t,rR={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Ep(.001)},"square-centimeters":{inBaseUnits:Ep(.01)},"square-decimeters":{inBaseUnits:Ep(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Ep(1e3)},"square-inches":{inBaseUnits:Ep(.0254)},"square-feet":{inBaseUnits:Ep(.3048)},"square-yards":{inBaseUnits:Ep(.9144)},"square-miles":{inBaseUnits:Ep(1609.344)},"square-us-feet":{inBaseUnits:Ep(1200/3937)},acres:{inBaseUnits:.0015625*Ep(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*b0(.001)},"cubic-centimeters":{inBaseUnits:1e3*b0(.01)},"cubic-decimeters":{inBaseUnits:1e3*b0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*b0(1e3)},"cubic-inches":{inBaseUnits:1e3*b0(.0254)},"cubic-feet":{inBaseUnits:1e3*b0(.3048)},"cubic-yards":{inBaseUnits:1e3*b0(.9144)},"cubic-miles":{inBaseUnits:1e3*b0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},a5e=(()=>{const t={};for(const e in rR)for(const r in rR[e].units)t[r]=e;return t})();function l5e(t,e,r){return t*rR[r].units[e].inBaseUnits}function c5e(t,e,r){return t/rR[r].units[e].inBaseUnits}const u5e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function NV(t){const e=a5e[t];if(!e)throw new Error("unknown type");return e}function Fte(t,e=null){return e=e||NV(t),rR[e].baseUnit===t}function fo(t,e,r){if(e===r)return t;const i=NV(e);if(i!==NV(r))throw new Error("incompatible units");const n=Fte(e,i)?t:l5e(t,e,i);return Fte(r,i)?n:c5e(n,r,i)}function kCt(t,e,r){switch(r){case"metric":return h5e(t,e);case"imperial":return p5e(t,e);default:return r}}function zCt(t,e,r){switch(r){case"metric":return d5e(t,e);case"imperial":return f5e(t,e);default:return r}}function h5e(t,e){const r=fo(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function d5e(t,e){const r=fo(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function p5e(t,e){const r=fo(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function f5e(t,e){const r=fo(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function BCt(t,e){const r=fo(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function VCt(t,e){const r=fo(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function m5e(t,e,r){return fo(t,e,"meters")/(r*Math.PI/180)}function R0e(t){return o5e.fromJSON(t.toLowerCase())||null}function FV(t){if(t!=null&&!eR(t))return 1;const e=el(t);return e>1e5?1:e}function g5e(t){return el(t)>=Mr(t).metersPerDegree?"meters":a6(t)}function el(t,e=Kt.metersPerDegree){return y5e(t,!0)??e}function y5e(t,e=!1){const r=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let n=null;if(r){if(WX(r))return If.metersPerDegree;if(qX(r))return Fg.metersPerDegree;n=Eb.values[Eb[r]],!n&&e&&s5e.has(r)&&(n=n5e)}else i&&($0e(i)?n=Ute(A0e.exec(i),n):M0e(i)&&(n=Ute(O0e.exec(i),n)));return n}function UV(t){return t.isGeographic?1:el(t)}function Ute(t,e){return t&&t[1]?P0e(t[1]):e}function P0e(t){return parseFloat(t.split(",")[1])}function a6(t){const e=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let i=null;if(e)i=Eb.units[Eb[e]];else if(r){const n=$0e(r)?A0e:M0e(r)?O0e:null;if(n){const s=n.exec(r);s&&s[1]&&(i=v5e(s[1]))}}return i!=null?R0e(i):null}function GCt(t){const e=a6(t);return e!=null&&u5e.includes(e)?e:null}function M0e(t){return/^GEOCCS/i.test(t)}function $0e(t){return/^PROJCS/i.test(t)}const _5e=1e-7;function v5e(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!Eb.units.includes(r)){const i=P0e(t);r=null;const n=Eb.values;for(let s=0;s<n.length;++s)if(Math.abs(i-n[s])<_5e){r=Eb.units[s];break}}return r}function jCt(t){const e=a6(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const b5e={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},w5e={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},x5e={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},HCt=Oc()(b5e),WCt=Oc()(w5e),qCt=Oc()(x5e);var Hp;let fi=Hp=class extends ke{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return Hp.WebMercator;if(t.wkid===4326)return Hp.WGS84}const e=new Hp;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return tR(this)}get isWebMercator(){return Yb(this)}get isGeographic(){return T0e(this)}get isWrappable(){return e5e(this)}get metersPerUnit(){return el(this)}get unit(){return a6(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===Hp.WGS84)return Hp.WGS84;if(this===Hp.WebMercator)return Hp.WebMercator;const t=new Hp;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ye(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||i?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):r?n.id===e&&n.referenceServiceName===r:n.id===e}return Js(this,t)}toJSON(t){return this.write(void 0,t)}};fi.GCS_NAD_1927=null,fi.WGS84=null,fi.WebMercator=null,fi.PlateCarree=null,h([f({readOnly:!0})],fi.prototype,"isWGS84",null),h([f({readOnly:!0})],fi.prototype,"isWebMercator",null),h([f({readOnly:!0})],fi.prototype,"isGeographic",null),h([f({readOnly:!0})],fi.prototype,"isWrappable",null),h([f({type:mn,json:{write:!0}})],fi.prototype,"latestWkid",void 0),h([f({readOnly:!0})],fi.prototype,"metersPerUnit",null),h([f({readOnly:!0})],fi.prototype,"unit",null),h([f({type:mn,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],fi.prototype,"wkid",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],fi.prototype,"wkt",void 0),h([xr("wkt"),xr("web-scene","wkt")],fi.prototype,"writeWkt",null),h([f({type:mn,json:{write:!0}})],fi.prototype,"vcsWkid",void 0),h([f({type:mn,json:{write:!0}})],fi.prototype,"latestVcsWkid",void 0),h([f()],fi.prototype,"imageCoordinateSystem",void 0),fi=Hp=h([N("esri.geometry.SpatialReference")],fi),fi.prototype.toJSON.isDefaultToJSON=!0,fi.GCS_NAD_1927=new fi({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),fi.WGS84=new fi(t5e),fi.WebMercator=new fi(r5e),fi.PlateCarree=new fi(i5e),Object.freeze&&(Object.freeze(fi.GCS_NAD_1927),Object.freeze(fi.WGS84),Object.freeze(fi.WebMercator));const St=fi,I0e="20230626",L0e="b81703b48e0b92e492f4cc6b739af02a9af50038",T5e="4.27";let JX=T5e;JX="4.27.6";const S5e={async request(t,e){var a,l;const{default:r}=await ce(()=>Promise.resolve().then(()=>B5e),void 0),i=t.options,n=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=n==="native"||n==="native-request-init"?"native-request-init":n&&["blob","json","text"].includes(n)&&((a=m0e(t.url))!=null&&a.after)?n:"array-buffer";const s=await r(t.url,i),o={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((l=s.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let sn;function XCt(t){sn=t}function YCt(t){const e=sn==null?void 0:sn.findCredential(t);return e!=null&&e.token?b0e(t,"token",e.token):t}se("host-webworker");const E5e=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function D0e(t){const e=Kd(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!E5e.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function N0e(t,e,r=!1,i){return new Promise((n,s)=>{if(ss(i))return void s(kte());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),n(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",s(kte())};const c=()=>{se("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),se("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function kte(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const F0e="Timeout exceeded";function C5e(){return new Error(F0e)}function ZCt(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===F0e}function A5e(t){Jr.request.crossOriginNoCorsDomains||(Jr.request.crossOriginNoCorsDomains={});const e=Jr.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[Kd(r)??""]=0:(e[Kd("http://"+r)??""]=0,e[Kd("https://"+r)??""]=0)}function O5e(t){const e=Jr.request.crossOriginNoCorsDomains;if(e){let r=Kd(t);if(r)return r=r.toLowerCase(),!gS(r,FX())&&e[r]<Date.now()-36e5}return!1}async function R5e(t){var n;const e=Jr.request.crossOriginNoCorsDomains,r=Kd(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=Ja(t);t=i.path,((n=i.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function kn(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=UX(e.query.toString().replaceAll("+"," ")));const r=im(t),i=KO(t);i||r||(t=_g(t));const n={url:t,requestOptions:{...e}};let s=m0e(t);if(s){const u=await F5e(s,n);if(u!=null)return{data:u,getHeader:KX,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(se("host-webworker")||se("host-node")))throw Lf("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw Lf("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||i)throw Lf("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await L5e(),f4)return f4.execute(t,e);const o=new AbortController;pa(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:Id.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await k5e(a);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let f4;const Id=Jr.request,U0e="FormData"in globalThis,P5e=[499,498,403,401],M5e=["COM_0056","COM_0057","SB_0008"],$5e=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],KX=()=>null,m4=Symbol();function I5e(t){const e=Kd(t);e&&!kn._corsServers.includes(e)&&kn._corsServers.push(e)}function zte(t){const e=Kd(t);return!e||e.endsWith(".arcgis.com")||kn._corsServers.includes(e)||zX(e)}function Lf(t,e,r,i){let n="Error";const s={url:r.url,requestOptions:r.requestOptions,getHeader:KX,ssl:!1};if(e instanceof Y)return e.details?(e.details=ye(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=s,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i==null?void 0:i.status,l=e.message;l&&(n=l),o&&(s.getHeader=o),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=m4 in e?e[m4]:e}return Zn(e)?wr():new Y(t,n,s)}async function L5e(){se("host-webworker")?f4||(f4=await ce(()=>import("./request-14491776.js"),[])):kn._abortableFetch||(kn._abortableFetch=globalThis.fetch.bind(globalThis))}async function kV(){sn||await ce(()=>import("./IdentityManager-47bd1e1a.js"),["assets/IdentityManager-47bd1e1a.js","assets/widget-78e8b6fe.js"])}async function D5e(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,n=r.body;let s=null,o=null;if(U0e&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in kn._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Id.priority,redirect:"follow",signal:i},(s||o)&&(t.fetchOptions.body=s||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&Jr.apiKey&&D0e(e)&&(r.query||(r.query={}),r.query.token=Jr.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!k0e(e)&&!ss(i)){let l;r.authMode==="immediate"?(await kV(),l=await sn.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await kV(),l=await sn.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):sn&&(l=sn.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function k0e(t){return $5e.some(e=>e.test(t))}async function N5e(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},n=KO(e)||im(e),s=r.responseType||"json",o=n?0:r.timeout!=null?r.timeout:Id.timeout;let a=!1;if(!n){t.useSSL&&(e=GX(e)),r.cacheBust&&i.cache==="default"&&(e=b0e(e,"request.preventCache",Date.now()));let p={...r.query};t.credentialToken&&(p.token=t.credentialToken);let m=JO(p);se("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const y=e.length+1+m.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||y>Id.maxUrlLength;const v=r.useProxy||!!i6(e);if(v){const b=N4e(e);_=b.path,!a&&_.length+1+y>Id.maxUrlLength&&(a=!0),b.query&&(p={...b.query,...p})}if(i.method==="HEAD"&&(a||v)){if(a)throw y>Id.maxUrlLength?Lf("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):Lf("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw Lf("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=qU(e,p):(i.body=JO(p),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=qU(e,p),v&&(t.useProxy=!0,e=`${_}?${e}`),p.token&&U0e&&i.body instanceof FormData&&!S4e(e)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!gS(e,FX())){if(zX(e))t.withCredentials=!0;else if(sn){const b=sn.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",O5e(e)&&await R5e(a?qU(e,p):e))}let l,c,u=0,d=!1;o>0&&(u=setTimeout(()=>{d=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||U5e(r.headers)||!n&&!t.useProxy&&Id.proxyUrl&&!zte(e)){if(l=await kn._abortableFetch(e,i),t.useProxy||I5e(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=Bte(c,"application/xml");break;case"document":c=Bte(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[s==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}s==="image"&&c instanceof Blob&&(c=await Vte(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await Vte(e,t)}catch(p){if(p.name==="AbortError")throw d?C5e():wr("Request canceled");if(!(!l&&p instanceof TypeError&&Id.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||zte(e))throw p;t.redoRequest=!0,F4e({proxyUrl:Id.proxyUrl,urlPrefix:Kd(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function F5e(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(n){r=Lf("request:interceptor",n,e)}if((i instanceof Error||i instanceof Y)&&(r=Lf("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function U5e(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function Bte(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function k5e(t){var s,o;let e,r;await D5e(t);try{do[e,r]=await N5e(t);while(!await z5e(t,e,r))}catch(a){const l=Lf("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(s=t.interceptor)!=null&&s.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!zX(i)){const a=Kd(i,!0);a&&Id.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&A5e(r.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&sn){const a=sn.findServerInfo(n.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=sn.findCredential(l,n.userId);c&&sn._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getHeader:e?a=>e==null?void 0:e.headers.get(a):KX,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function z5e(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let n,s;if(r&&(r.error?n=r.error:r.status==="error"&&Array.isArray(r.messages)&&(n={...r},n[m4]=r,n.details=r.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[m4]=r,n;let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(s===403&&(a===4||(c=n.message)!=null&&c.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&P5e.includes(s)&&!k0e(t.params.url)&&(s!==403||o&&!M5e.includes(o)&&(a==null||a===2&&t.credentialToken))){await kV();try{const u=await sn.getCredential(t.params.url,{error:Lf("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=u}}if(n)throw n;return!0}function Vte(t,e,r=!1){const i=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=Id.priority,n.src=t,N0e(n,t,r,i)}kn._abortableFetch=null,kn._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const B5e=Object.freeze(Object.defineProperty({__proto__:null,default:kn},Symbol.toStringTag,{value:"Module"}));function lr(t,e,r){let i,n;return e===void 0||Array.isArray(e)?(n=t,r=e,i=[void 0]):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;i.forEach(l=>{const c=Hge(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Wp=class extends ke{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=St.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof St)return e;if(e!=null){const i=new St;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};h([f()],Wp.prototype,"type",void 0),h([f({readOnly:!0})],Wp.prototype,"cache",null),h([f({readOnly:!0})],Wp.prototype,"extent",null),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Wp.prototype,"hasM",void 0),h([f({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Wp.prototype,"hasZ",void 0),h([f({type:St,json:{write:!0},value:St.WGS84})],Wp.prototype,"spatialReference",void 0),h([lr("spatialReference")],Wp.prototype,"readSpatialReference",null),Wp=h([N("esri.geometry.Geometry")],Wp);const Zg=Wp,V5e=Object.prototype.toString;function G5e(t){const e="__accessorMetadata__"in t?Qa(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return j5e.apply(this,r)}}function j5e(t,e,r,i){XF(t,e).cast=i}function H5e(t){return(e,r)=>{XF(e,t).cast=e[r]}}function _i(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&V5e.call(t[0])==="[object Function]"?G5e(t[0]):t.length===1&&typeof t[0]=="string"?H5e(t[0]):void 0}function W5e(t,e){const r=t.x-e.x,i=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+n*n)}const q5e=57.29577951308232,X5e=.017453292519943;function Gte(t){return t*q5e}function jte(t){return t*X5e}function Hte(t){return t/Kt.radius}function g4(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Kt.radius))}function zV(t){return t.wkid!=null||t.wkt!=null}const XU=[0,0];function y4(t,e,r,i,n){const s=t,o=n;if(o.spatialReference=r,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,XU,i);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,XU,i),[o.xmax,o.ymax]=e(s.xmax,s.ymax,XU,i);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let u=0;u<a.length;u++){const d=a[u];c=[],l.push(c);for(let p=0;p<d.length;p++)c.push(e(d[p][0],d[p][1],[0,0],i)),d[p].length>2&&c[p].push(d[p][2]),d[p].length>3&&c[p].push(d[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function T_(t,e){const r=t&&(zV(t)?t:t.spatialReference),i=e&&(zV(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!Js(i,r)||Yb(i)&&tR(r)||Yb(r)&&tR(i))}function $w(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(zV(e)?e:e.spatialReference);return T_(r,i)?Js(r,i)?ye(t):Yb(i)?y4(t,iT,St.WebMercator,!1,ye(t)):tR(i)?y4(t,zA,St.WGS84,!1,ye(t)):null:null}function iT(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=jte(e);return r[0]=jte(t)*Kt.radius,r[1]=Kt.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function zA(t,e,r=[0,0],i=!1){const n=Gte(t/Kt.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=Gte(Math.PI/2-2*Math.atan(Math.exp(-e/Kt.radius))),r}function BA(t,e=!1,r=ye(t)){return y4(t,iT,St.WebMercator,e,r)}function NM(t,e=!1,r=ye(t)){return y4(t,zA,St.WGS84,e,r)}var HL;const QE=[0,0];function Wte(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let hl=HL=class extends Zg{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],r=s[2],i=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,r=s.z,i=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new St(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)J.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)J.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=iT(s.longitude,s.latitude,QE);t=a[0],e=a[1]}}}else Wte(r)?(n=r,r=null):Wte(i)&&(n=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?J.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&J.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return zA(e,r,QE)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",iT(r,t,QE)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return zA(t,e,QE)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",iT(t,e,QE)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new HL;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return HL.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=iT(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=zA(l,c),u=s}return e===l&&r===c&&i===o&&n===a&&s.wkid===u.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=Sb(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,n=2*i;let s;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n),this._set("x",e),this}distance(t){return W5e(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],hl.prototype,"cache",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],hl.prototype,"hasM",null),h([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],hl.prototype,"hasZ",null),h([f({type:Number})],hl.prototype,"latitude",null),h([f({type:Number})],hl.prototype,"longitude",null),h([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),_i(t=>isNaN(t)?t:Ud(t))],hl.prototype,"x",void 0),h([xr("x")],hl.prototype,"writeX",null),h([lr("x")],hl.prototype,"readX",null),h([f({type:Number,json:{write:!0}})],hl.prototype,"y",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],hl.prototype,"z",void 0),h([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],hl.prototype,"m",void 0),hl=HL=h([N("esri.geometry.Point")],hl),hl.prototype.toJSON.isDefaultToJSON=!0;const ze=hl,YU=[0,0];function eY(t,e){return e!=null&&Fa(t,e.x,e.y,e.z)}function JCt(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!yS(t,r))return!1;return!0}function Y5e(t,e){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?Fa(t,r,i,n)&&Fa(t,r,o,n)&&Fa(t,s,o,n)&&Fa(t,s,i,n)&&Fa(t,r,i,a)&&Fa(t,r,o,a)&&Fa(t,s,o,a)&&Fa(t,s,i,a):Fa(t,r,i)&&Fa(t,r,o)&&Fa(t,s,o)&&Fa(t,s,i)}function yS(t,e){return Fa(t,e[0],e[1])}function Z5e(t,e){return Fa(t,e[0],e[1],e[2])}function Fa(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function Q5e(t,e){return YU[1]=e.y,YU[0]=e.x,J5e(t,YU)}function J5e(t,e){return z0e(t.rings,e)}function z0e(t,e){if(!t)return!1;if(K5e(t))return qte(!1,t,e);let r=!1;for(let i=0,n=t.length;i<n;i++)r=qte(r,t[i],e);return r}function K5e(t){return!Array.isArray(t[0][0])}function qte(t,e,r){const[i,n]=r;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[d,p]=e[o];(u<n&&p>=n||p<n&&u>=n)&&c+(n-u)/(p-u)*(d-c)<i&&(s=!s)}return s}function eFe(t,e){return eY(t,e)}function tFe(t,e){const r=t.hasZ&&e.hasZ;let i,n,s;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function rFe(t,e){const{points:r,hasZ:i}=e,n=i?Z5e:yS;for(const s of r)if(n(t,s))return!0;return!1}const Zb=[0,0],Qb=[0,0],Jb=[0,0],Kb=[0,0],iFe=[Zb,Qb,Jb,Kb],B0e=[[Jb,Zb],[Zb,Qb],[Qb,Kb],[Kb,Jb]];function nFe(t,e){return sFe(t,e.rings)}function sFe(t,e){Zb[0]=t.xmin,Zb[1]=t.ymax,Qb[0]=t.xmax,Qb[1]=t.ymax,Jb[0]=t.xmin,Jb[1]=t.ymin,Kb[0]=t.xmax,Kb[1]=t.ymin;for(const r of iFe)if(z0e(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(yS(t,i))return!0;for(let n=1;n<r.length;n++){const s=r[n];if(yS(t,s)||V0e(i,s,B0e))return!0;i=s}}return!1}function oFe(t,e){Zb[0]=t.xmin,Zb[1]=t.ymax,Qb[0]=t.xmax,Qb[1]=t.ymax,Jb[0]=t.xmin,Jb[1]=t.ymin,Kb[0]=t.xmax,Kb[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let n=i[0];if(yS(t,n))return!0;for(let s=1;s<i.length;s++){const o=i[s];if(yS(t,o)||V0e(n,o,B0e))return!0;n=o}}return!1}const Ao=[0,0];function aFe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let n=0;n<r.length-1;n++){const s=r[n],o=r[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(BV(s,o,c,u,Ao)&&!(Ao[0]===s[0]&&Ao[1]===s[1]||Ao[0]===c[0]&&Ao[1]===c[1]||Ao[0]===o[0]&&Ao[1]===o[1]||Ao[0]===u[0]&&Ao[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let n=0;n<i-3;n++){let s=i-1;n===0&&(s=i-2);const o=r[n],a=r[n+1];for(let l=n+2;l<s;l++){const c=r[l],u=r[l+1];if(BV(o,a,c,u,Ao)&&!(Ao[0]===o[0]&&Ao[1]===o[1]||Ao[0]===c[0]&&Ao[1]===c[1]||Ao[0]===a[0]&&Ao[1]===a[1]||Ao[0]===u[0]&&Ao[1]===u[1]))return!0}}}return!1}function V0e(t,e,r){for(let i=0;i<r.length;i++)if(BV(t,e,r[i][0],r[i][1]))return!0;return!1}function BV(t,e,r,i,n){const[s,o]=t,[a,l]=e,[c,u]=r,[d,p]=i,m=d-c,y=s-c,_=a-s,v=p-u,b=o-u,x=l-o,T=v*_-m*x;if(T===0)return!1;const S=(m*b-v*y)/T,A=(_*b-x*y)/T;return S>=0&&S<=1&&A>=0&&A<=1&&(n&&(n[0]=s+S*(a-s),n[1]=o+S*(l-o)),!0)}function lFe(t){switch(t){case"esriGeometryEnvelope":case"extent":return tFe;case"esriGeometryMultipoint":case"multipoint":return rFe;case"esriGeometryPoint":case"point":return eFe;case"esriGeometryPolygon":case"polygon":return nFe;case"esriGeometryPolyline":case"polyline":return oFe}}var ku;function cFe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function w0(t,e,r){return e==null?r:r==null?e:t(e,r)}let oo=ku=class extends Zg{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,n){return cFe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?St.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:n??St.WGS84}}static fromBounds(t,e){return new ku({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new ku({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new ze({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new ku;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&T_(e,r)&&(t=e.isWebMercator?BA(t):NM(t,!0)),t.type==="point"?eY(this,t):t.type==="extent"&&Y5e(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&T_(e,r)&&(t=e.isWebMercator?BA(t):NM(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!Js(e,r)&&T_(e,r)&&(t=e.isWebMercator?BA(t):NM(t,!0)),lFe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=w0(Math.min,this.zmin,t.zmin),this.zmax=w0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=w0(Math.min,this.mmin,t.mmin),this.mmax=w0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=w0(Math.max,this.zmin,t.zmin),this.zmax=w0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=w0(Math.max,this.mmin,t.mmin),this.mmax=w0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Sb(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?NM(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new St(YF((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const n=r??Sb(i);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let d=0;d<c.length;d++)c[d].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||Sb(o);const[d,p]=t.valid;u=this._normalizeX(this.xmin,t);const m=u.x,y=u.frameId;u=this._normalizeX(this.xmax,t);const _=u.x,v=u.frameId,b=m===_&&a>0;if(a>2*p){const x=new ku(l<c?m:_,n,p,s,o),T=new ku(d,n,l<c?_:m,s,o),S=new ku(0,n,p,s,o),A=new ku(d,n,0,s,o),C=[],R=[];x.contains(S)&&C.push(y),x.contains(A)&&R.push(y),T.contains(S)&&C.push(v),T.contains(A)&&R.push(v);for(let P=y+1;P<v;P++)C.push(P),R.push(P);e.push({extent:x,frameIds:[y]},{extent:T,frameIds:[v]},{extent:S,frameIds:C},{extent:A,frameIds:R})}else m>_||b?e.push({extent:new ku(m,n,p,s,o),frameIds:[y]},{extent:new ku(d,n,_,s,o),frameIds:[v]}):e.push({extent:new ku(m,n,_,s,o),frameIds:[y]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const n={};r&&(n.zmin=this.zmin,n.zmax=this.zmax),i&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[r,i]=e.valid,n=2*i;let s,o=0;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n,o=s):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n,o=-s),{x:t,frameId:o}}};h([f({readOnly:!0})],oo.prototype,"cache",null),h([f({readOnly:!0})],oo.prototype,"center",null),h([f({readOnly:!0})],oo.prototype,"extent",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],oo.prototype,"hasM",null),h([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],oo.prototype,"hasZ",null),h([f({readOnly:!0})],oo.prototype,"height",null),h([f({readOnly:!0})],oo.prototype,"width",null),h([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],oo.prototype,"xmin",void 0),h([f({type:Number,json:{write:!0}})],oo.prototype,"ymin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],oo.prototype,"mmin",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],oo.prototype,"zmin",void 0),h([f({type:Number,json:{write:!0}})],oo.prototype,"xmax",void 0),h([f({type:Number,json:{write:!0}})],oo.prototype,"ymax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],oo.prototype,"mmax",void 0),h([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],oo.prototype,"zmax",void 0),oo=ku=h([N("esri.geometry.Extent")],oo),oo.prototype.toJSON.isDefaultToJSON=!0;const Dr=oo;let VA;var Mpe,$pe;const uFe=((Mpe=globalThis.esriConfig)==null?void 0:Mpe.locale)??(($pe=globalThis.dojoConfig)==null?void 0:$pe.locale);function G0e(){var t;return uFe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function ep(){return VA===void 0&&(VA=G0e()),VA}const GA=[];function j0e(t){return GA.push(t),{remove(){GA.splice(GA.indexOf(t),1)}}}const VV=[];function tY(t){return VV.push(t),{remove(){GA.splice(VV.indexOf(t),1)}}}function hFe(){const t=G0e();VA!==t&&(VA=t,[...VV].forEach(e=>{e.call(null,t)}),[...GA].forEach(e=>{e.call(null,t)}))}var Ipe;(Ipe=globalThis.addEventListener)==null||Ipe.call(globalThis,"languagechange",hFe);let FM;function dFe(t){return FM&&!FM.destroyed||(FM=t()),FM}var GV;const pFe=new zn({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let zu=GV=class extends xe{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new GV({categories:this.categories?ye(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=$w(this.extent,St.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:r,bbox:i,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>pFe.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};h([f()],zu.prototype,"categories",void 0),h([f()],zu.prototype,"disableExtraQuery",void 0),h([f({type:Dr})],zu.prototype,"extent",void 0),h([f()],zu.prototype,"filter",void 0),h([f()],zu.prototype,"num",void 0),h([f()],zu.prototype,"query",void 0),h([f()],zu.prototype,"sortField",void 0),h([f()],zu.prototype,"sortOrder",null),h([f()],zu.prototype,"start",void 0),zu=GV=h([N("esri.portal.PortalQueryParams")],zu);const bf=zu;let ov=class extends xe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};h([f()],ov.prototype,"nextQueryParams",void 0),h([f()],ov.prototype,"queryParams",void 0),h([f()],ov.prototype,"results",void 0),h([f()],ov.prototype,"total",void 0),ov=h([N("esri.portal.PortalQueryResult")],ov);const fFe=ov;let $m=class extends ke{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new Y("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};h([f({type:Date})],$m.prototype,"created",void 0),h([f()],$m.prototype,"id",void 0),h([f()],$m.prototype,"portal",void 0),h([f()],$m.prototype,"title",void 0),h([f({readOnly:!0})],$m.prototype,"url",null),h([f()],$m.prototype,"username",void 0),$m=h([N("esri.portal.PortalFolder")],$m);const mFe=$m;let ao=class extends ke{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,r=this.thumbnail;return e&&r&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return sc(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(n=>n.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return sc(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new Y("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=Qa(bf,e);const n=sc(this.portal);return parseFloat(n.currentVersion)>5?(i=i||new bf,n.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new bf,i.query="group:"+this.id+(i.query?" "+i.query:""),n.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=sc(this.portal);return i.fetchSelf(i.authMode,!0,r).then(n=>{const s=n.contentCategorySetsGroupQuery;if(s){const o=new bf;return o.disableExtraQuery=!0,o.num=1,o.query=s,i.queryGroups(o,r)}throw new Y("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(n=>{if(n.total){const s=n.results[0],o=new bf;return o.num=1,o.query=`typekeywords:"${e}"`,s.queryItems(o,r)}throw new Y("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(n=>n.total?n.results[0].fetchData("json",r).then(s=>{const o=s&&s.categorySchema;return o&&o.length?o:[]}):[])}};h([f()],ao.prototype,"access",void 0),h([f({type:Date})],ao.prototype,"created",void 0),h([f()],ao.prototype,"description",void 0),h([f()],ao.prototype,"id",void 0),h([f()],ao.prototype,"isInvitationOnly",void 0),h([f({type:Date})],ao.prototype,"modified",void 0),h([f()],ao.prototype,"owner",void 0),h([f()],ao.prototype,"portal",void 0),h([f()],ao.prototype,"snippet",void 0),h([f()],ao.prototype,"sortField",void 0),h([f()],ao.prototype,"sortOrder",void 0),h([f()],ao.prototype,"tags",void 0),h([f()],ao.prototype,"thumbnail",void 0),h([f({readOnly:!0})],ao.prototype,"thumbnailUrl",null),h([f()],ao.prototype,"title",void 0),h([f({readOnly:!0})],ao.prototype,"url",null),ao=h([N("esri.portal.PortalGroup")],ao);const jV=ao,gFe=Object.freeze(Object.defineProperty({__proto__:null,default:jV},Symbol.toStringTag,{value:"Module"}));var HV;let cn=HV=class extends ke{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),r!=null&&(typeof r=="string"?n.query.text=r:typeof r=="object"&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+(typeof i=="string"?i:i.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const n=mFe.fromJSON(i);return n.portal=this.portal,n}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=jV.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),ce(()=>Promise.resolve().then(()=>q0e),void 0).then(({default:n})=>{r=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:s})}).then(n=>{let s;return n&&n.items?(s=n.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new jV({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new Y("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new Y("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new HV;return e.sourceJSON=t,e.read(t),e}};h([f()],cn.prototype,"access",void 0),h([f({type:Date})],cn.prototype,"created",void 0),h([f()],cn.prototype,"culture",void 0),h([f()],cn.prototype,"description",void 0),h([f()],cn.prototype,"email",void 0),h([f()],cn.prototype,"favGroupId",void 0),h([f()],cn.prototype,"fullName",void 0),h([f({type:Date})],cn.prototype,"modified",void 0),h([f()],cn.prototype,"orgId",void 0),h([f()],cn.prototype,"portal",void 0),h([f()],cn.prototype,"preferredView",void 0),h([f()],cn.prototype,"privileges",void 0),h([f()],cn.prototype,"region",void 0),h([f()],cn.prototype,"role",void 0),h([f()],cn.prototype,"roleId",void 0),h([f()],cn.prototype,"sourceJSON",void 0),h([f()],cn.prototype,"thumbnail",void 0),h([f({readOnly:!0})],cn.prototype,"thumbnailUrl",null),h([f()],cn.prototype,"units",void 0),h([f({readOnly:!0})],cn.prototype,"userContentUrl",null),h([f({readOnly:!0})],cn.prototype,"url",null),h([f()],cn.prototype,"username",void 0),h([f()],cn.prototype,"userType",void 0),cn=HV=h([N("esri.portal.PortalUser")],cn);const H0e=cn,yFe=Object.freeze(Object.defineProperty({__proto__:null,default:H0e},Symbol.toStringTag,{value:"Module"}));var Im;let UM;const Xte={PortalGroup:()=>ce(()=>Promise.resolve().then(()=>gFe),void 0),PortalItem:()=>ce(()=>Promise.resolve().then(()=>q0e),void 0),PortalUser:()=>ce(()=>Promise.resolve().then(()=>yFe),void 0)};let Pe=Im=class extends fP(Dg){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Jr.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Yte.unregister(this),this.defaultBasemap=Me(this.defaultBasemap),this.defaultDevBasemap=Me(this.defaultDevBasemap),this.defaultVectorBasemap=Me(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Pi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Jr.request.trustedServers.includes(e)||Jr.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=H0e.fromJSON(t),e.portal=this),e}load(t){const e=ce(()=>Promise.resolve().then(()=>HFe),void 0).then(({default:r})=>{Bt(t),UM=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(sn){const n=sn;this.credential=n.findCredential(this.restUrl),this.credential||this.authMode!==Im.AUTH_MODE_AUTO||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=n.on("credential-create",_Fe(new WeakRef(this))),Yte.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ce(()=>import("./ElevationLayer-61bc2d81.js"),["assets/ElevationLayer-61bc2d81.js","assets/MultiOriginJSONSupport-e4912ffd.js","assets/ArcGISCachedService-344b6262.js","assets/TileInfoTilemapCache-b3f5dda7.js","assets/TilemapCache-67ada3c3.js","assets/ArcGISService-83287338.js","assets/OperationalLayer-0e8f8b28.js","assets/commonProperties-30089b06.js","assets/PortalLayer-310c2800.js","assets/portalItemUtils-792a27e1.js"])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):ss(t)?Promise.reject(wr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new bf;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const n of e)i.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(n=>n.results)}return ss(t)?Promise.reject(wr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||ep();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||ep();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return dFe(()=>new Im)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",n={authMode:t,query:{culture:ep().toLowerCase()},...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(i,n)}queryPortal(t,e,r,i){const n=Qa(bf,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...i}).then(a=>{const l=n.clone();return l.start=a.nextStart,new fFe({nextQueryParams:l,queryParams:n,total:a.total,results:Im._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Mw(l),a)));return r&&Xte[r]?Xte[r]().then(({default:o})=>(Bt(i),s(o))):s()}signIn(){if(this.authMode===Im.AUTH_MODE_ANONYMOUS)return Promise.reject(new Y("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return sn?sn.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const n=Im._resultsToTypedArray(r,{portal:this},i);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():i)).then(()=>n,()=>n)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===Im.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:n,cacheBust:s,method:o,query:r,responseType:a,timeout:0,signal:l};return kn(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new Y("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Im({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new Y("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new bf;r.query=t||(Jr.apiKey&&D0e(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const n=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(r,e);return s.total?s.results.filter(o=>o.type==="Web Map").map(o=>new UM({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new bf({query:r,disableExtraQuery:!0}),n=await this.queryGroups(i,e);if(!n.total)return[];const s=n.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new UM({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=UM.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let n=[];if(r){const s=i!=null?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};Pe.AUTH_MODE_ANONYMOUS="anonymous",Pe.AUTH_MODE_AUTO="auto",Pe.AUTH_MODE_IMMEDIATE="immediate",h([f()],Pe.prototype,"access",void 0),h([f()],Pe.prototype,"allSSL",void 0),h([f()],Pe.prototype,"authMode",void 0),h([f()],Pe.prototype,"authorizedCrossOriginDomains",void 0),h([lr("authorizedCrossOriginDomains")],Pe.prototype,"readAuthorizedCrossOriginDomains",null),h([f()],Pe.prototype,"basemapGalleryGroupQuery",void 0),h([f({json:{name:"3DBasemapGalleryGroupQuery"}})],Pe.prototype,"basemapGalleryGroupQuery3D",void 0),h([f()],Pe.prototype,"bingKey",void 0),h([f()],Pe.prototype,"canListApps",void 0),h([f()],Pe.prototype,"canListData",void 0),h([f()],Pe.prototype,"canListPreProvisionedItems",void 0),h([f()],Pe.prototype,"canProvisionDirectPurchase",void 0),h([f()],Pe.prototype,"canSearchPublic",void 0),h([f()],Pe.prototype,"canShareBingPublic",void 0),h([f()],Pe.prototype,"canSharePublic",void 0),h([f()],Pe.prototype,"canSignInArcGIS",void 0),h([f()],Pe.prototype,"canSignInIDP",void 0),h([f()],Pe.prototype,"colorSetsGroupQuery",void 0),h([f()],Pe.prototype,"commentsEnabled",void 0),h([f({type:Date})],Pe.prototype,"created",void 0),h([f()],Pe.prototype,"credential",void 0),h([f()],Pe.prototype,"culture",void 0),h([f()],Pe.prototype,"currentVersion",void 0),h([f()],Pe.prototype,"customBaseUrl",void 0),h([f()],Pe.prototype,"defaultBasemap",void 0),h([lr("defaultBasemap")],Pe.prototype,"readDefaultBasemap",null),h([f()],Pe.prototype,"defaultDevBasemap",void 0),h([lr("defaultDevBasemap")],Pe.prototype,"readDefaultDevBasemap",null),h([f({type:Dr})],Pe.prototype,"defaultExtent",void 0),h([f()],Pe.prototype,"defaultVectorBasemap",void 0),h([lr("defaultVectorBasemap")],Pe.prototype,"readDefaultVectorBasemap",null),h([f()],Pe.prototype,"description",void 0),h([f()],Pe.prototype,"devBasemapGalleryGroupQuery",void 0),h([f()],Pe.prototype,"eueiEnabled",void 0),h([f({readOnly:!0})],Pe.prototype,"extraQuery",null),h([f()],Pe.prototype,"featuredGroups",void 0),h([f()],Pe.prototype,"featuredItemsGroupQuery",void 0),h([f()],Pe.prototype,"galleryTemplatesGroupQuery",void 0),h([f()],Pe.prototype,"livingAtlasGroupQuery",void 0),h([f()],Pe.prototype,"hasCategorySchema",void 0),h([f()],Pe.prototype,"helpBase",void 0),h([f()],Pe.prototype,"helperServices",void 0),h([f()],Pe.prototype,"helpMap",void 0),h([f()],Pe.prototype,"homePageFeaturedContent",void 0),h([f()],Pe.prototype,"homePageFeaturedContentCount",void 0),h([f()],Pe.prototype,"httpPort",void 0),h([f()],Pe.prototype,"httpsPort",void 0),h([f()],Pe.prototype,"id",void 0),h([f()],Pe.prototype,"ipCntryCode",void 0),h([f({readOnly:!0})],Pe.prototype,"isOrganization",null),h([f()],Pe.prototype,"isPortal",void 0),h([f()],Pe.prototype,"isReadOnly",void 0),h([f({readOnly:!0})],Pe.prototype,"itemPageUrl",null),h([f()],Pe.prototype,"layerTemplatesGroupQuery",void 0),h([f()],Pe.prototype,"maxTokenExpirationMinutes",void 0),h([f({type:Date})],Pe.prototype,"modified",void 0),h([f()],Pe.prototype,"name",void 0),h([f()],Pe.prototype,"portalHostname",void 0),h([f()],Pe.prototype,"portalMode",void 0),h([f()],Pe.prototype,"portalProperties",void 0),h([f()],Pe.prototype,"region",void 0),h([f({readOnly:!0})],Pe.prototype,"restUrl",null),h([f()],Pe.prototype,"rotatorPanels",void 0),h([f()],Pe.prototype,"showHomePageDescription",void 0),h([f()],Pe.prototype,"sourceJSON",void 0),h([f()],Pe.prototype,"staticImagesUrl",void 0),h([f({json:{name:"2DStylesGroupQuery"}})],Pe.prototype,"stylesGroupQuery2d",void 0),h([f({json:{name:"stylesGroupQuery"}})],Pe.prototype,"stylesGroupQuery3d",void 0),h([f()],Pe.prototype,"supportsHostedServices",void 0),h([f()],Pe.prototype,"symbolSetsGroupQuery",void 0),h([f()],Pe.prototype,"templatesGroupQuery",void 0),h([f()],Pe.prototype,"thumbnail",void 0),h([f({readOnly:!0})],Pe.prototype,"thumbnailUrl",null),h([f()],Pe.prototype,"units",void 0),h([f()],Pe.prototype,"url",void 0),h([f()],Pe.prototype,"urlKey",void 0),h([lr("urlKey")],Pe.prototype,"readUrlKey",null),h([f()],Pe.prototype,"user",void 0),h([lr("user")],Pe.prototype,"readUser",null),h([f()],Pe.prototype,"use3dBasemaps",void 0),h([f()],Pe.prototype,"useStandardizedQuery",void 0),h([f()],Pe.prototype,"useVectorBasemaps",void 0),h([f()],Pe.prototype,"vectorBasemapGalleryGroupQuery",void 0),Pe=Im=h([N("esri.portal.Portal")],Pe);const Mh=Pe,Yte=new FinalizationRegistry(t=>{t.remove()});function _Fe(t){const e=sn;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}const vFe=J.getLogger("esri.assets");function bFe(t,e){return kn(Ir(t),e)}function Ir(t){if(!Jr.assetsPath)throw vFe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new Y("assets:path-not-set","config.assetsPath is not set");return s6(Jr.assetsPath,t)}let Lm=class extends xe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&uu(e)?J.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new Y("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResource:i}=await ce(()=>import("./resourceUtils-b667b05b.js"),[]);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&uu(e)&&(e=n6(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};h([f()],Lm.prototype,"portalItem",void 0),h([f({type:String,value:null})],Lm.prototype,"path",null),h([_i("path")],Lm.prototype,"_castPath",null),h([f({type:String,readOnly:!0})],Lm.prototype,"url",null),h([f({type:String,readOnly:!0})],Lm.prototype,"cdnUrl",null),h([f({type:String,readOnly:!0})],Lm.prototype,"itemRelativeUrl",null),Lm=h([N("esri.portal.PortalItemResource")],Lm);const wFe=Lm;let c3=class extends xe{constructor(e){super(e),this.created=null,this.rating=null}};h([f()],c3.prototype,"created",void 0),h([f()],c3.prototype,"rating",void 0),c3=h([N("esri.portal.PortalRating")],c3);const ZU=c3;var av;const xFe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),TFe=new Set(["KML","GeoJson","CSV"]);let tr=av=class extends fP(Dg){static from(t){return mS(av,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(t){return t&&t.length?new Dr(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":u?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):n=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="360 vr experience"?"360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",n?Ir(r+n+i+".png"):null}get isLayer(){return this.type!=null&&xFe.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&sn&&!sn.findCredential(t)&&(t=sn._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Mh.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof ZU&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new ZU({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ye(this.applicationProxies),avgRating:this.avgRating,categories:ye(this.categories),created:ye(this.created),culture:this.culture,description:this.description,extent:ye(this.extent),groupCategories:ye(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ye(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ye(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new av({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await sc(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return sc(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await sc(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new ZU(e)):null}fetchRelatedItems(t,e){return sc(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},av)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return sc(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>sc(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new Y("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new Y("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await sc(e).signIn();const{copyResources:i,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!i,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new av({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")im(e)?i.query={data:e}:i.query={url:iu(e)},r!=null&&(i.query.filename=r);else{const n=new FormData;r!=null?n.append("file",e,r):n.append("file",e),i.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new Y("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await ce(()=>import("./resourceUtils-b667b05b.js"),[]);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await ce(()=>import("./resourceUtils-b667b05b.js"),[]);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await ce(()=>import("./resourceUtils-b667b05b.js"),[]);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new Y("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ce(()=>import("./resourceUtils-b667b05b.js"),[]);return e(this,t)}resourceFromPath(t){return new wFe({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ye(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ye(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ye(this.typeKeywords),url:this.url};return nge(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new av({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};h([f({type:["private","shared","org","public"]})],tr.prototype,"access",void 0),h([f()],tr.prototype,"accessInformation",void 0),h([f({type:String})],tr.prototype,"apiKey",void 0),h([f({json:{read:{source:"appProxies"}}})],tr.prototype,"applicationProxies",void 0),h([f()],tr.prototype,"avgRating",void 0),h([f()],tr.prototype,"categories",void 0),h([f({type:Date})],tr.prototype,"created",void 0),h([f()],tr.prototype,"culture",void 0),h([f()],tr.prototype,"description",void 0),h([f({readOnly:!0})],tr.prototype,"displayName",null),h([f({type:Dr})],tr.prototype,"extent",void 0),h([lr("extent")],tr.prototype,"readExtent",null),h([f()],tr.prototype,"groupCategories",void 0),h([f({readOnly:!0})],tr.prototype,"iconUrl",null),h([f()],tr.prototype,"id",void 0),h([f({readOnly:!0})],tr.prototype,"isLayer",null),h([f({type:Boolean,readOnly:!0})],tr.prototype,"isOrgItem",void 0),h([f()],tr.prototype,"itemControl",void 0),h([f({readOnly:!0})],tr.prototype,"itemPageUrl",null),h([f({readOnly:!0})],tr.prototype,"itemUrl",null),h([f()],tr.prototype,"licenseInfo",void 0),h([f({type:Date})],tr.prototype,"modified",void 0),h([f()],tr.prototype,"name",void 0),h([f()],tr.prototype,"numComments",void 0),h([f()],tr.prototype,"numRatings",void 0),h([f()],tr.prototype,"numViews",void 0),h([f()],tr.prototype,"owner",void 0),h([f()],tr.prototype,"ownerFolder",void 0),h([f({type:Mh})],tr.prototype,"portal",void 0),h([f()],tr.prototype,"screenshots",void 0),h([f()],tr.prototype,"size",void 0),h([f()],tr.prototype,"snippet",void 0),h([f()],tr.prototype,"sourceJSON",void 0),h([f({type:String})],tr.prototype,"sourceUrl",void 0),h([f({type:String})],tr.prototype,"spatialReference",void 0),h([f()],tr.prototype,"tags",void 0),h([f()],tr.prototype,"thumbnail",void 0),h([f({readOnly:!0})],tr.prototype,"thumbnailUrl",null),h([f()],tr.prototype,"title",void 0),h([f()],tr.prototype,"type",void 0),h([f()],tr.prototype,"typeKeywords",void 0),h([f({type:String,json:{read(t,e){var r;if(TFe.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],tr.prototype,"url",void 0),h([f({readOnly:!0})],tr.prototype,"userItemUrl",null),tr=av=h([N("esri.portal.PortalItem")],tr);const W0e=tr,q0e=Object.freeze(Object.defineProperty({__proto__:null,default:W0e},Symbol.toStringTag,{value:"Module"})),Zte=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,SFe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Qte(t){return t in SFe}const u3=[],IT=new Map;function Jte(t){for(const e of IT.keys())Y0e(t.pattern,e)&&IT.delete(e)}function EFe(t){return u3.includes(t)||(Jte(t),u3.unshift(t)),{remove(){const e=u3.indexOf(t);e>-1&&(u3.splice(e,1),Jte(t))}}}async function X0e(t){const e=ep();IT.has(t)||IT.set(t,AFe(t,e));const r=IT.get(t);return r&&await OFe.add(r),r}function CFe(t){if(!Zte.test(t))return null;const e=Zte.exec(t);if(e===null)return null;const[,r,i]=e,n=r+(i?"-"+i.toUpperCase():"");return Qte(n)?n:Qte(r)?r:null}async function AFe(t,e){const r=[];for(const i of u3)if(Y0e(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(n){r.push(n)}throw r.length?new Y("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new Y("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Y0e(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}tY(()=>{IT.clear()});const OFe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Wo())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function RFe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await X0e("esri/t9n/basemaps");return r[t]||r[e]}const WV={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Ir("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Ir("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Ir("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Ir("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Ir("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Ir("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Ir("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Ir("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Ir("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Ir("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Ir("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Ir("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Ir("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Ir("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Ir("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Ir("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function n3t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function jA(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function _S(t){return t!=null&&"type"in t&&t.type==="group"}const s3t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function PFe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function Kte(t){return(t==null?void 0:t.type)==="voxel"}function ere(t){return(t==null?void 0:t.type)==="imagery-tile"}function Z0e(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function rY(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function o3t(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function MFe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function a3t(t,e){const r=sn==null?void 0:sn.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const n=`${t.substring(0,i)}/rest/info`,s=e!=null?e.signal:null,{data:o}=await kn(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function $Fe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function IFe(t){return $Fe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function LFe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function DFe(t){return!!LFe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const NFe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),FFe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function UFe(t){return t.layerContainerType==="basemap"?NFe:t.layerContainerType==="operational-layers"?FFe:null}function kFe(t,e){if(e.restrictedWebMapWriting){const r=UFe(e);return r==null||r.has(t.type)&&!rY(t)}return!0}function zFe(t,e){if(e)if(rY(t)){const r=uP("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&tre(t,i)}else t.type!=="group"&&tre(t,e)}function tre(t,e){"maxScale"in t&&(e.maxScale=c4(t.maxScale)??void 0),"minScale"in t&&(e.minScale=c4(t.minScale)??void 0)}function BFe(t,e){if(zFe(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=c4(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(rY(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function rre(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new Y("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(kFe(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&BFe(t,e=ye(e)),e}var WL;let VFe=0;const Q0e="esri.Basemap";let Bu=WL=class extends fP(Dg){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+VFe++,this.baseLayers=new ir,this.referenceLayers=new ir;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&J.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{J.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const e=this.referenceLayers.removeAll();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",qb(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=rre(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);s!=null&&i.push(s)}),this.referenceLayers.forEach(n=>{const s=rre(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);s!=null&&(n.type!=="scene"&&(s.isReference=!0),i.push(s))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",qb(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return h0e(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>YN(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>YN(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new WL({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=ye(r);return i.url&&Wf(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&Wf(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;Bt(t);const i=[];if(e){const n=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const s=e.data.id;i.push(RFe(s).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,n=this.portalItem&&this.portalItem.portal||i&&i.portal||null,s=jFe[(i==null?void 0:i.origin)||""]??"web-map",{populateOperationalLayers:o}=await ce(()=>import("./layersCreator-738b2d23.js"),["assets/layersCreator-738b2d23.js","assets/lazyLayerLoader-8b31b2e1.js","assets/portalLayers-54553513.js","assets/layersLoader-0106cc6e.js","assets/fetchService-82a8c4d0.js","assets/jsonContext-5f3816dc.js","assets/portalItemUtils-792a27e1.js","assets/styleUtils-25825fd6.js"]),a=[];if(Bt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=p=>s==="web-scene"&&p.layerType==="ArcGISSceneServiceLayer"||p.isReference,u=o(this.baseLayers,t.baseMapLayers.filter(p=>!c(p)),l);a.push(u);const d=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(d)}await o1(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),n=Ja(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:GFe[t.type||""]??"web-map",portal:t.portal||Mh.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Mh.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=WV[t];if(!e)return null;if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),u4(J.getLogger(Q0e),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return WL.fromJSON(e)}};h([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ir}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],Bu.prototype,"baseLayers",null),h([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],Bu.prototype,"id",void 0),h([f({type:W0e})],Bu.prototype,"portalItem",void 0),h([f()],Bu.prototype,"referenceLayers",null),h([f({readOnly:!0})],Bu.prototype,"resourceInfo",void 0),h([f({type:St})],Bu.prototype,"spatialReference",void 0),h([f()],Bu.prototype,"thumbnailUrl",void 0),h([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Bu.prototype,"title",void 0),h([xr("title")],Bu.prototype,"writeTitle",null),Bu=WL=h([N(Q0e)],Bu);const GFe={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},jFe={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},iR=Bu,HFe=Object.freeze(Object.defineProperty({__proto__:null,default:iR},Symbol.toStringTag,{value:"Module"})),_4={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function J0e(t){return!!_4[t]||!!_4[t.toLowerCase()]}function iY(t){return _4[t]??_4[t.toLowerCase()]}function WFe(t){return[...iY(t)]}function QU(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function K0e(t,e,r,i=1){const n=(t%360+360)%360/360,s=r<=.5?r*(e+1):r+e-r*e,o=2*r-s;return[Math.round(255*QU(o,s,n+1/3)),Math.round(255*QU(o,s,n)),Math.round(255*QU(o,s,n-1/3)),i]}function qFe(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&i,o>>=r,a[3]=n*l/255),l=o&i,o>>=r,a[2]=n*l,l=o&i,o>>=r,a[1]=n*l,l=o&i,o>>=r,a[0]=n*l,a}function O(){return[0,0,0]}function ki(t){return[t[0],t[1],t[2]]}function Se(t,e,r){return[t,e,r]}function na(t){const e=O(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function nY(t,e){return new Float64Array(t,e,3)}function eye(){return O()}function tye(){return Se(1,1,1)}function rye(){return Se(1,0,0)}function iye(){return Se(0,1,0)}function sY(){return Se(0,0,1)}const Zs=eye(),pg=tye(),nye=rye(),sye=iye(),oY=sY();Object.freeze(Object.defineProperty({__proto__:null,ONES:pg,UNIT_X:nye,UNIT_Y:sye,UNIT_Z:oY,ZEROS:Zs,clone:ki,create:O,createView:nY,fromArray:na,fromValues:Se,ones:tye,unitX:rye,unitY:iye,unitZ:sY,zeros:eye},Symbol.toStringTag,{value:"Module"}));let aY=1e-6;function tl(){return aY}function XFe(t){aY=t}const mP=Math.random,YFe=Math.PI/180,ZFe=180/Math.PI;function l6(t){return t*YFe}function QFe(t){return t*ZFe}function JFe(t,e){return Math.abs(t-e)<=aY*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:mP,equals:JFe,getEpsilon:tl,setEpsilon:XFe,toDegree:QFe,toRadian:l6},Symbol.toStringTag,{value:"Module"}));function Te(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function re(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ne(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function oe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ae(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function c6(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function v4(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function KFe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function oye(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function b4(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function aye(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function lY(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function e6e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function t6e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function te(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function pb(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function ci(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function wo(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function la(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function fa(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function r6e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function me(t,e){const r=e[0],i=e[1],n=e[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function fe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ot(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o,t}function Lr(t,e,r,i){const n=e[0],s=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t}function i6e(t,e,r,i,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+r[0]*l+i[0]*c+n[0]*u,t[1]=e[1]*a+r[1]*l+i[1]*c+n[1]*u,t[2]=e[2]*a+r[2]*l+i[2]*c+n[2]*u,t}function n6e(t,e,r,i,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,d=3*l*o,p=l*s;return t[0]=e[0]*c+r[0]*u+i[0]*d+n[0]*p,t[1]=e[1]*c+r[1]*u+i[1]*d+n[1]*p,t[2]=e[2]*c+r[2]*u+i[2]*d+n[2]*p,t}function s6e(t,e){e=e||1;const r=mP,i=2*r()*Math.PI,n=2*r()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=n*e,t}function De(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12],t[1]=r[1]*i+r[5]*n+r[9]*s+r[13],t[2]=r[2]*i+r[6]*n+r[10]*s+r[14],t}function zo(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function Sh(t,e,r){const i=r[0],n=r[1],s=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let u=n*c-s*l,d=s*a-i*c,p=i*l-n*a,m=n*p-s*d,y=s*u-i*p,_=i*d-n*u;const v=2*o;return u*=v,d*=v,p*=v,m*=2,y*=2,_*=2,t[0]=a+u+m,t[1]=l+d+y,t[2]=c+p+_,t}function o6e(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function a6e(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function l6e(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function lye(t,e){re(kM,t),re(zM,e),me(kM,kM),me(zM,zM);const r=fe(kM,zM);return r>1?0:r<-1?Math.PI:Math.acos(r)}const kM=O(),zM=O();function c6e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Bo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function N_(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=tl();return Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function Qg(t,e,r){const i=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];let o=i*i+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Ws=ae,u6e=c6,h6e=v4,gP=ci,u6=wo,rc=Te,qV=la,ire=Object.freeze(Object.defineProperty({__proto__:null,abs:b4,add:oe,angle:lye,bezier:n6e,ceil:KFe,copy:re,cross:ot,direction:Qg,dist:gP,distance:ci,div:h6e,divide:v4,dot:fe,equals:N_,exactEquals:Bo,floor:oye,hermite:i6e,inverse:r6e,len:rc,length:Te,lerp:Lr,max:e6e,min:lY,mul:u6e,multiply:c6,negate:fa,normalize:me,random:s6e,rotateX:o6e,rotateY:a6e,rotateZ:l6e,round:t6e,scale:te,scaleAndAdd:pb,set:ne,sign:aye,sqrDist:u6,sqrLen:qV,squaredDistance:wo,squaredLength:la,str:c6e,sub:Ws,subtract:ae,transformMat3:zo,transformMat4:De,transformQuat:Sh},Symbol.toStringTag,{value:"Module"}));function vh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function gi(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function cY(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function cye(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function uye(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function hye(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function d6e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function p6e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function f6e(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function m6e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function g6e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function ew(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function y6e(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function dye(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function w4(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function uY(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function hY(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function _6e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function v6e(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function pye(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=s*o),t}function fye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function dY(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function b6e(t,e){const r=mP;let i,n,s,o,a,l;e=e||1;do i=2*r()-1,n=2*r()-1,a=i*i+n*n;while(a>=1);do s=2*r()-1,o=2*r()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function au(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}function w6e(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*s-l*n,d=c*n+l*i-o*s,p=c*s+o*n-a*i,m=-o*i-a*n-l*s;return t[0]=u*c+m*-o+d*-l-p*-a,t[1]=d*c+m*-a+p*-o-u*-l,t[2]=p*c+m*-l+u*-a-d*-o,t[3]=e[3],t}function x6e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function LT(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function x4(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=tl();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}const T6e=cye,S6e=uye,E6e=hye,C6e=dye,A6e=w4,O6e=uY,R6e=hY,mye=Object.freeze(Object.defineProperty({__proto__:null,add:cY,ceil:d6e,copy:vh,dist:C6e,distance:dye,div:E6e,divide:hye,dot:fye,equals:x4,exactEquals:LT,floor:p6e,inverse:v6e,len:O6e,length:uY,lerp:dY,max:m6e,min:f6e,mul:S6e,multiply:uye,negate:_6e,normalize:pye,random:b6e,round:g6e,scale:ew,scaleAndAdd:y6e,set:gi,sqrDist:A6e,sqrLen:R6e,squaredDistance:w4,squaredLength:hY,str:x6e,sub:T6e,subtract:cye,transformMat4:au,transformQuat:w6e},Symbol.toStringTag,{value:"Module"})),nre=new Float32Array(1);function P6e(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function ge(t,e,r){return Math.min(Math.max(t,e),r)}function tw(t){return(t&t-1)==0}function l3t(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function c3t(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function wt(t,e,r){return t+(e-t)*r}function It(t){return t*Math.PI/180}function Ka(t){return 180*t/Math.PI}function XV(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function As(t){return Math.acos(ge(t,-1,1))}function $h(t){return Math.asin(ge(t,-1,1))}function DT(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const T4=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function YV(t){return T4.setFloat64(0,t),T4.getBigInt64(0)}function M6e(t){return T4.setBigInt64(0,t),T4.getFloat64(0)}const qL=BigInt("1000000"),$6e=gye(1);function gye(t){const e=YV(t=Math.abs(t)),r=M6e(e<=qL?qL:e-qL);return Math.abs(t-r)}function u3t(t,e,r=$6e){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&gye(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=YV(t),n=YV(e);return i<0!=n<0?!1:!((i<n?n-i:i-n)>qL)}function I6e(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function L6e(t){return yye(Math.max(-ZV,Math.min(t,ZV)))}function yye(t){return nre[0]=t,nre[0]}function nR(t,e,r){const i=ge((r-t)/(e-t),0,1);return i*i*(3-2*i)}function sre(t,e){const r=Te(t),i=$h(t[2]/r),n=Math.atan2(t[1]/r,t[0]/r);return ne(e,r,i,n),e}function h3t(t,e,r){return gi(t,e[0],e[1],e[2],e[3]*r)}function d3t(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(DT(e,1)&&DT(r,1)&&DT(i,1))}const ZV=yye(34028234663852886e22);function BM(t){return ge(RX(t),0,255)}function VM(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let XL=class Jo{static blendColors(e,r,i,n=new Jo){return n.r=Math.round(e.r+(r.r-e.r)*i),n.g=Math.round(e.g+(r.g-e.g)*i),n.b=Math.round(e.b+(r.b-e.b)*i),n.a=e.a+(r.a-e.a)*i,n._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const n=i[2].split(/\s*,\s*/),s=i[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),Jo.fromArray(a,r)}return Jo.fromArray(n.map(a=>parseFloat(a)),r)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return Jo.fromArray(K0e(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),r)}return null}static fromHex(e,r=new Jo){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,n=(1<<i)-1;let s=+("0x"+e.substr(1));return isNaN(s)?null:(["b","g","r"].forEach(o=>{const a=s&n;s>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new Jo){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=J0e(e)?iY(e):null;return i&&Jo.fromArray(i,r)||Jo.fromRgb(e,r)||Jo.fromHex(e,r)}static fromJSON(e){return e&&new Jo([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Jo.fromString(e,this):Array.isArray(e)?Jo.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Jo||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Jo.AlphaMode.ALWAYS){const r=BM(this.r),i=BM(this.g),n=BM(this.b);return e===Jo.AlphaMode.ALWAYS||this.a!==1?[r,i,n,BM(255*this.a)]:[r,i,n]}clone(){return new Jo(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(VM(this.r,0,255)),this.g=Math.round(VM(this.g,0,255)),this.b=Math.round(VM(this.b,0,255)),this.a=VM(this.a,0,1),this}_set(e,r,i,n){this.r=e,this.g=r,this.b=i,this.a=n}};XL.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(XL||(XL={}));const it=XL;function p3t(t){}function D6e(t){return()=>t}function Vt(t,e={}){const r=t instanceof zn?t:new zn(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),f(i)}var QV;let YL=QV=class extends ke{constructor(t){super(t),this.type="none"}clone(){return new QV({type:this.type})}};h([Vt({none:"none",stayAbove:"stay-above"})],YL.prototype,"type",void 0),YL=QV=h([N("esri.ground.NavigationConstraint")],YL);function pY(t){const e=RX(100*(1-t));return Math.max(0,Math.min(e,100))}function fY(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var JV;let Dm=JV=class extends fP(Dg){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ir;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&J.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{Zn(t)||J.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",qb(t,this._get("layers")))}writeLayers(t,e,r,i){const n=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};D6e(s)().write(o,i)&&n.push(o)}else i&&i.messages&&i.messages.push(new Y("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return h0e(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await ce(()=>import("./ElevationQuery-6f358c3e.js"),[]);Bt(e);const i=new r,n=this.layers.filter(ore).toArray();return i.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await ce(()=>import("./ElevationQuery-6f358c3e.js"),[]);Bt(e);const i=new r,n=this.layers.filter(ore).toArray();return i.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ye(this.surfaceColor),navigationConstraint:ye(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new JV({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",n=e&&e.portal||null,s=e&&e.url||null;return ce(()=>import("./layersCreator-738b2d23.js"),["assets/layersCreator-738b2d23.js","assets/lazyLayerLoader-8b31b2e1.js","assets/portalLayers-54553513.js","assets/layersLoader-0106cc6e.js","assets/fetchService-82a8c4d0.js","assets/jsonContext-5f3816dc.js","assets/portalItemUtils-792a27e1.js","assets/styleUtils-25825fd6.js"]).then(({populateOperationalLayers:o})=>{Bt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return o1(a)}).then(()=>{})}};function N6e(t){return t&&"createElevationSampler"in t}function ore(t){return t.type==="elevation"||N6e(t)}h([f({json:{read:!1}})],Dm.prototype,"layers",null),h([xr("layers")],Dm.prototype,"writeLayers",null),h([f({readOnly:!0})],Dm.prototype,"resourceInfo",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:mn,read:{reader:fY,source:"transparency"},write:{writer:(t,e)=>{e.transparency=pY(t)},target:"transparency"}}})],Dm.prototype,"opacity",void 0),h([f({type:it,json:{type:[mn],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Dm.prototype,"surfaceColor",void 0),h([f({type:YL,json:{write:!0}})],Dm.prototype,"navigationConstraint",void 0),Dm=JV=h([N("esri.Ground")],Dm);const S4=Dm;let a2=class extends ir{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Lge(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new ir(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(n=>!!n);for(const n of r)if(n){if(i(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};h([f()],a2.prototype,"getCollections",void 0),h([f()],a2.prototype,"getChildrenFunction",void 0),h([f()],a2.prototype,"itemFilterFunction",void 0),a2=h([N("esri.core.CollectionFlattener")],a2);const sR=a2,F6e=[["binary","application/octet-stream","bin",""]];function KV(t,e){return gY(k6e(t,e))}function e7(t,e){return gY(z6e(t,e))}function m3t(t,e){return _ye(U6e(t,e))}function mY(t){return[...F6e,...t]}function U6e(t,e){return mY(e).find(r=>gY(r)===t)}function k6e(t,e){return mY(e).find(r=>_ye(r)===t)}function z6e(t,e){const r=t.toLowerCase();return mY(e).find(i=>B6e(i).some(n=>r.endsWith(n)))}function gY(t){return t==null?void 0:t[0]}function _ye(t){return t==null?void 0:t[1]}function B6e(t){return(t==null?void 0:t[2].split(","))??[]}function g3t(t){var e;return(e=t.tables)==null?void 0:e.find(r=>r.role==="assetMaps")}function V6e(t){var e,r;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((r=(e=IFe(t))==null?void 0:e.operations)!=null&&r.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!DFe(t)||t.type==="scene"&&!G6e(t))}function G6e(t){const e=t.infoFor3D;if(!e)return!0;const{supportedFormats:r,queryFormats:i}=e,n=KV("model/gltf-binary",r)??e7("glb",r);return n!=null&&i.includes(n)}const are=J.getLogger("esri.support.basemapUtils");function j6e(){return{}}function H6e(t){for(const e in t){const r=t[e];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete t[e]}}function W6e(t,e){let r;if(typeof t=="string"){if(!(t in WV)){const i=Object.entries(WV).filter(([n,s])=>Jr.apiKey&&!s.classic||!Jr.apiKey&&s.classic&&!s.deprecated).map(([n])=>`"${n}"`).join(", ");return are.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=iR.fromId(t),e&&(e[t]=r))}else r=Qa(iR,t);return r!=null&&r.destroyed&&(are.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function y3t(t,e){var r,i,n,s;return((i=(r=t.basemap)==null?void 0:r.referenceLayers)==null?void 0:i.some(o=>o.uid===e))||((s=(n=t.basemap)==null?void 0:n.baseLayers)==null?void 0:s.some(o=>o.uid===e))}function q6e(t){return new sR({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function JU(t){for(const e of t.values())e==null||e.destroy();t.clear()}const lre={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function X6e(t){let e=null;if(typeof t=="string")if(t in lre){const r=lre[t];e=new S4({resourceInfo:{data:{layers:[r]}}})}else J.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Qa(S4,t);return e}function vS(t,e,r=!1){let{hasM:i,hasZ:n}=t;Array.isArray(e)?e.length!==4||i||n?e.length===3&&r&&!i?(n=!0,i=!1):e.length===3&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=i}var t7;function cre(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function Y6e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let ty=t7=class extends Zg{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):Y6e(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new Dr,r=this.hasZ,i=this.hasM,n=r?3:2,s=t[0],o=cre(Math.min),a=cre(Math.max);let l,c,u,d,[p,m]=s,[y,_]=s;for(let v=0,b=t.length;v<b;v++){const x=t[v],[T,S]=x;if(p=o(p,T),m=o(m,S),y=a(y,T),_=a(_,S),r&&x.length>2){const A=x[2];l=o(l,A),u=a(u,A)}if(i&&x.length>n){const A=x[n];c=o(c,A),d=a(d,A)}}return e.xmin=p,e.ymin=m,e.xmax=y,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=d):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ye(this.points)}addPoint(t){return vS(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ye(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new t7(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new ze(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new ze(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(vS(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};h([f({readOnly:!0})],ty.prototype,"cache",null),h([f()],ty.prototype,"extent",null),h([f({type:[[Number]],json:{write:{isRequired:!0}}})],ty.prototype,"points",void 0),h([xr("points")],ty.prototype,"writePoints",null),ty=t7=h([N("esri.geometry.Multipoint")],ty),ty.prototype.toJSON.isDefaultToJSON=!0;const yP=ty;function _3t(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function Z6e(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function h6(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function vye(t,e,r){const i=t[0]+r*(e[0]-t[0]),n=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,n,t[2]+r*(e[2]-t[2])]:[i,n]}function v3t(t,e,r,i){const[n,s]=e,[o,a]=r[i],[l,c]=r[i+1],u=l-o,d=c-a,p=u*u+d*d,m=(n-o)*u+(s-a)*d,y=Math.min(1,Math.max(0,m/p));return t[0]=o+u*y,t[1]=a+d*y,t}function b3t(t,e,r){let i,n,s,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,n=r.y;r.nextPoint();)s=r.x,o=r.y,n>e!=o>e&&t<(s-i)*(e-n)/(o-n)+i&&(a=!a),l=Math.min(l,Q6e(t,e,i,n,s,o)),i=s,n=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function Q6e(t,e,r,i,n,s){let o=r,a=i,l=n-o,c=s-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=n,a=s):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function bye(t,e){return vye(t,e,.5)}function wye(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=h6(t[i],t[i+1]);return r}function xye(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let n=0;n<r-1;++n){const s=h6(t[n],t[n+1]);if(e-i<s){const o=(e-i)/s;return vye(t[n],t[n+1],o)}i+=s}return t[r-1]}function Tye(t,e,r){const i=t.length;let n=0,s=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let u=2;n+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(s+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&e&&(o+=l[0]*c[u]-c[0]*l[u])}return n<=0&&s<=0&&o<=0}function J6e(t){const e=t.length;return e>2&&Hf(t[0],t[e-1])}function w3t(t){if("rings"in t)for(const e of t.rings)J6e(e)||e.push(e[0].slice())}function x3t(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function Sye(t){if(!t||t.numPoints<3)return 0;let e,r,i=0;if(t.seekPathStart(),!t.nextPoint())return 0;e=t.x,r=t.y;const n=e,s=r;for(;t.nextPoint();)i+=(e-t.x)*(r+t.y),e=t.x,r=t.y;return i+=(e-n)*(r+s),-.5*i}function T3t(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function K6e(t){return t?Eye(t.rings,t.hasZ??!1):null}function Eye(t,e){if(!t||!t.length)return null;const r=[],i=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=Cye(t[s],e,n);a&&i.push(a)}if(i.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){const s=t[0]&&t[0].length?e8e(t[0],e):null;if(!s)return null;r[0]=s[0],r[1]=s[1],e&&s.length>2&&(r[2]=s[2])}return r}function Cye(t,e,r){let i=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const m=t[p],y=t[(p+1)%t.length],[_,v,b]=m,x=_-l,T=v-c,[S,A,C]=y,R=S-l,P=A-c,F=x*P-R*T;if(o+=F,i+=(x+R)*F,n+=(T+P)*F,e&&m.length>2&&y.length>2){const k=b-u,V=C-u,z=x*V-R*k;s+=(k+V)*z,a+=z}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(b<r[4]&&(r[4]=b),b>r[5]&&(r[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const d=[i/(6*o)+l,n/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(d[3]=(r[4]+r[5])/2,d[4]=0):(d[3]=s/(6*a)+u,d[4]=a)),d}function e8e(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],d=t[l+1];if(u&&d){r[0]=u[0],r[1]=u[1],i[0]=d[0],i[1]=d[1],e&&u.length>2&&d.length>2&&(r[2]=u[2],i[2]=d[2]);const p=h6(r,i);if(p){n+=p;const m=bye(u,d);s+=p*m[0],o+=p*m[1],e&&m.length>2&&(a+=p*m[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}function t8e(t){const{hasZ:e,numPaths:r}=t;if(r===0)return null;const i=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Cye(Z6e(t),t.hasZ,s);o&&n.push(o)}if(n.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),n.length&&(i[0]=n[0][0],i[1]=n[0][1],e&&(i[2]=n[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.numPoints?r8e(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function r8e(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const d=t.x,p=t.y,m=t.z;r[0]=l,r[1]=c,i[0]=d,i[1]=p,e&&(r[2]=u,i[2]=m);const y=h6(r,i);if(y){n+=y;const _=bye(r,i);s+=y*_[0],o+=y*_[1],e&&_.length>2&&(a+=y*_[2])}l=d,c=p,u=m}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.numPoints?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const i8e=1e-6;function S3t(t){let e=0;for(t.reset();t.nextPath();)e+=Sye(t);if(e<i8e){const n=t8e(t);return n?[n[0],n[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)s8e(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const n8e=1/3;function s8e(t,e,r){if(!t||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,n=r.y;r.nextPoint();let s,o=r.x-i,a=r.y-n,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-n,s=.5*n8e*(l*a-c*o),t[0]+=s*(o+l),t[1]+=s*(a+c),o=l,a=c;const u=Sye(r),d=[i,n];return d[0]-=e[0],d[1]-=e[1],d[0]*=u,d[1]*=u,t[0]+=d[0],t[1]+=d[1],t}function jt(t=c8e){return[t[0],t[1],t[2],t[3]]}function E3t(t){return[t[0],t[1],t[2],t[3]]}function Ug(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function yY(t,e,r,i,n=jt()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function Aye(t,e=jt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function d6(t,e){return new Dr({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function _Y(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function S_(t,e,r){if(e!=null)if("length"in e)n7(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else Ug(r,t)}function KU(t,e,r=t){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=n,r[1]=s,r[2]=o,r[3]=a,r}function r7(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function nu(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function lp(t){return t[1]>=t[3]?0:t[3]-t[1]}function Oye(t){return nu(t)*lp(t)}function vY(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Rye(t,e){return p6(t,e[0],e[1])}function ure(t,e){const r=e[3],i=.5*(t[0]+t[2]),n=Math.abs(e[0]-i),s=.5*(t[2]-t[0]);if(n>r+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=r*r}function C3t(t,e,r){const i=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=r,d=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,p=d(i,o),m=d(s,o),y=d(s,n),_=d(i,n);return!(p===m&&m===y&&y===_&&_===p||a<i&&c<i||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function A3t(t,e){return p6(t,e.x,e.y)}function p6(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function o8e(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function f6(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function hre(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function i7(t,e,r){if(e==null)return Ug(r,t);const i=e[0],n=e[1],s=e[2],o=e[3];return r[0]=ge(t[0],i,s),r[1]=ge(t[1],n,o),r[2]=ge(t[2],i,s),r[3]=ge(t[3],n,o),r}function a8e(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-r)-nu(t)/2,0),s=Math.max(Math.abs(e[1]-i)-lp(t)/2,0);return Math.sqrt(n*n+s*s)}function E4(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function Ih(t){return t?Ug(t,s7):jt(s7)}function n7(t){return t!=null&&t.length===4}function l8e(t){return!(nu(t)!==0&&isFinite(t[0])||lp(t)!==0&&isFinite(t[1]))}function Cb(t,e){return n7(t)&&n7(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const O3t=[-1/0,-1/0,1/0,1/0],s7=[1/0,1/0,-1/0,-1/0],c8e=[0,0,0,0];function Pye(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Mye(t){return t.points!==void 0}function $ye(t){return t.x!==void 0&&t.y!==void 0}function Iye(t){return t.paths!==void 0}function Lye(t){return t.rings!==void 0}function Dye(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const t_=Dye(Math.min),r_=Dye(Math.max);function R3t(t,e){return Iye(e)?bS(t,e.paths,!1,!1):Lye(e)?bS(t,e.rings,!1,!1):Mye(e)?bY(t,e.points,!1,!1,!1,!1):Pye(e)?Nye(t,e):($ye(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function P3t(t){let e,r,i,n;for(t.reset(),e=i=1/0,r=n=-1/0;t.nextPath();){const s=u8e(t);e=Math.min(s[0],e),i=Math.min(s[1],i),r=Math.max(s[2],r),n=Math.max(s[3],n)}return jt([e,i,r,n])}function u8e(t){let e,r,i,n;for(e=i=1/0,r=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),n=Math.max(t.y,n);return jt([e,i,r,n])}function M3t(t,e){return Iye(e)?bS(t,e.paths,!0,!1):Lye(e)?bS(t,e.rings,!0,!1):Mye(e)?bY(t,e.points,!0,!1,!0,!1):Pye(e)?Nye(t,e,!0,!1,!0,!1):($ye(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function bS(t,e,r,i){const n=r?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,u]=e[0][0],[d,p]=e[0][0];for(let m=0;m<e.length;m++){const y=e[m];for(let _=0;_<y.length;_++){const v=y[_],[b,x]=v;if(c=t_(c,b),u=t_(u,x),d=r_(d,b),p=r_(p,x),r&&v.length>2){const T=v[2];s=t_(s,T),o=r_(o,T)}if(i&&v.length>n){const T=v[n];a=t_(s,T),l=r_(o,T)}}}return r?i?(t[0]=c,t[1]=u,t[2]=s,t[3]=a,t[4]=d,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=s,t[3]=d,t[4]=p,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=u,t[2]=a,t[3]=d,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=d,t[3]=p,t.length=4,t)}function Nye(t,e,r,i,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,d=e.zmax,p=e.mmin,m=e.mmax;return n?(u=u||0,d=d||0,s?(p=p||0,m=m||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=d,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=d,t)):s?(p=p||0,m=m||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function bY(t,e,r,i,n,s){const o=r?3:2,a=i&&s,l=r&&n;if(!e.length||!e[0].length)return null;let c,u,d,p,[m,y]=e[0],[_,v]=e[0];for(let b=0;b<e.length;b++){const x=e[b],[T,S]=x;if(m=t_(m,T),y=t_(y,S),_=r_(_,T),v=r_(v,S),l&&x.length>2){const A=x[2];c=t_(c,A),u=r_(u,A)}if(a&&x.length>o){const A=x[o];d=t_(c,A),p=r_(u,A)}}return n?(c=c||0,u=u||0,s?(d=d||0,p=p||0,t[0]=m,t[1]=y,t[2]=c,t[3]=d,t[4]=_,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=m,t[1]=y,t[2]=c,t[3]=_,t[4]=v,t[5]=u,t)):s?(d=d||0,p=p||0,t[0]=m,t[1]=y,t[2]=d,t[3]=_,t[4]=v,t[5]=p,t):(t[0]=m,t[1]=y,t[2]=_,t[3]=v,t)}function h8e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function d8e(t){return t.points!==void 0}function p8e(t){return t.x!==void 0&&t.y!==void 0}function f8e(t){return t.paths!==void 0}function m8e(t){return t.rings!==void 0}const wY=[];function Fye(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function Uye(t,e,r,i,n,s){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:n,zmax:s}}function kye(t,e,r,i,n,s){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:n,mmax:s}}function zye(t,e,r,i,n,s,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:n,ymax:s,zmax:o,mmax:a}}function xY(t,e=!1,r=!1){return e?r?zye(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):Uye(t[0],t[1],t[2],t[3],t[4],t[5]):r?kye(t[0],t[1],t[2],t[3],t[4],t[5]):Fye(t[0],t[1],t[2],t[3])}function $3t(t){return t?h8e(t)?t:p8e(t)?y8e(t):m8e(t)?Bye(t):f8e(t)?Vye(t):d8e(t)?g8e(t):null:null}function g8e(t){const{hasZ:e,hasM:r,points:i}=t;return xY(bY(wY,i,e??!1,r??!1),e,r)}function y8e(t){const{x:e,y:r,z:i,m:n}=t,s=n!=null;return i!=null?s?zye(e,r,i,n,e,r,i,n):Uye(e,r,i,e,r,i):s?kye(e,r,n,e,r,n):Fye(e,r,e,r)}function Bye(t){const{hasZ:e,hasM:r,rings:i}=t,n=bS(wY,i,e??!1,r??!1);return n?xY(n,e,r):null}function Vye(t){const{hasZ:e,hasM:r,paths:i}=t,n=bS(wY,i,e??!1,r??!1);return n?xY(n,e,r):null}var ZL;function dre(t){return!Array.isArray(t[0])}let qp=ZL=class extends Zg{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,n=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(s.hasZ=!0),n&&(s.hasM=!0),new ZL(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||St.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=s.length>3):r===void 0?r=i?s.length>3:s.length>2:i===void 0&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=K6e(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new ze;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=Bye(this);if(!e)return null;const r=new Dr(e);return r.spatialReference=t,r}get isSelfIntersecting(){return aFe(this.rings)}writeRings(t,e){e.rings=ye(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(dre(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new ZL;return t.spatialReference=this.spatialReference,t.rings=ye(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([n,s,o,a],[l,c,u,d])=>n===l&&s===c&&(o==null&&u==null||o===u)&&(a==null&&d==null||a===d);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!Hf(s,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=$w(t,this.spatialReference);return Q5e(this,e??t)}isClockwise(t){let e;return e=dre(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,Tye(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new ze(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new ze(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new ze(r[0],r[1],r[2],r[3],this.spatialReference):new ze(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(vS(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new ze(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new ze(n,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(vS(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],qp.prototype,"cache",null),h([f({readOnly:!0})],qp.prototype,"centroid",null),h([f({readOnly:!0})],qp.prototype,"extent",null),h([f({readOnly:!0})],qp.prototype,"isSelfIntersecting",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],qp.prototype,"rings",void 0),h([xr("rings")],qp.prototype,"writeRings",null),qp=ZL=h([N("esri.geometry.Polygon")],qp),qp.prototype.toJSON.isDefaultToJSON=!0;const a1=qp;var o7;function _8e(t){return!Array.isArray(t[0])}let ry=o7=class extends Zg{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||St.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=!1):r===void 0?r=!i&&s.length>3:i===void 0&&(i=!r&&s.length>3)),{paths:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=Vye(this);if(!e)return null;const r=new Dr(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=ye(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(_8e(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new o7;return t.spatialReference=this.spatialReference,t.paths=ye(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new ze(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new ze(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new ze(r[0],r[1],r[2],r[3],this.spatialReference):new ze(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(vS(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new ze(n,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new ze(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(vS(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};h([f({readOnly:!0})],ry.prototype,"cache",null),h([f({readOnly:!0})],ry.prototype,"extent",null),h([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],ry.prototype,"paths",void 0),h([xr("paths")],ry.prototype,"writePaths",null),ry=o7=h([N("esri.geometry.Polyline")],ry),ry.prototype.toJSON.isDefaultToJSON=!0;const m6=ry,v8e=Oc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),I3t=Oc()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Gye(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function TY(t){return t.points!==void 0}function SY(t){return t.x!==void 0&&t.y!==void 0}function EY(t){return t.paths!==void 0}function CY(t){return t.rings!==void 0}function oR(t){return t==null?null:t instanceof Zg?t:SY(t)?ze.fromJSON(t):EY(t)?m6.fromJSON(t):CY(t)?a1.fromJSON(t):TY(t)?yP.fromJSON(t):Gye(t)?Dr.fromJSON(t):null}function AY(t){return t?SY(t)?"esriGeometryPoint":EY(t)?"esriGeometryPolyline":CY(t)?"esriGeometryPolygon":Gye(t)?"esriGeometryEnvelope":TY(t)?"esriGeometryMultipoint":null:null}const b8e={esriGeometryPoint:ze,esriGeometryPolyline:m6,esriGeometryPolygon:a1,esriGeometryEnvelope:Dr,esriGeometryMultipoint:yP};function w8e(t){return t&&b8e[t]||null}const OY={base:Zg,key:"type",typeMap:{extent:Dr,multipoint:yP,point:ze,polyline:m6,polygon:a1}};L_(OY);let jye=0;const RY=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+jye++})}};return e=h([N("esri.core.Identifiable")],e),e},L3t=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:jye++})}};return e=h([N("esri.core.NumericIdentifiable")],e),e};let pre=class extends RY(class{}){};pre=h([N("esri.core.Identifiable")],pre);async function x8e(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await ce(()=>import("./portalLayers-54553513.js"),["assets/portalLayers-54553513.js","assets/lazyLayerLoader-8b31b2e1.js","assets/layersLoader-0106cc6e.js","assets/fetchService-82a8c4d0.js","assets/jsonContext-5f3816dc.js","assets/portalItemUtils-792a27e1.js","assets/styleUtils-25825fd6.js"]);try{return await r(e)}catch(i){const n=e&&e.portalItem,s=n&&n.id||"unset",o=n&&n.portal&&n.portal.url||Jr.portalUrl;throw J.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",i),i}}let T8e=0,lo=class extends Bn.EventedMixin(RY(Dg)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Dr(-180,-90,180,90,St.WGS84),this.id=Date.now().toString(16)+"-layer-"+T8e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=St.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await ce(()=>import("./arcgisLayers-23a0b701.js"),["assets/arcgisLayers-23a0b701.js","assets/fetchService-82a8c4d0.js","assets/lazyLayerLoader-8b31b2e1.js"])).fromUrl(r)}static fromPortalItem(e){return x8e(e)}initialize(){this.when().catch(e=>{Zn(e)||J.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Ja(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await kn(e,{query:{f:"json"},responseType:"json"})).data;throw new Y("layer:no-attribution-data","Layer does not have attribution data")}};h([f({type:String})],lo.prototype,"attributionDataUrl",void 0),h([f({type:Dr})],lo.prototype,"fullExtent",void 0),h([f({readOnly:!0})],lo.prototype,"hasAttributionData",null),h([f({type:String,clonable:!1})],lo.prototype,"id",void 0),h([f({type:Boolean,nonNullable:!0})],lo.prototype,"legendEnabled",void 0),h([f({type:["show","hide","hide-children"]})],lo.prototype,"listMode",void 0),h([f({type:Number,range:{min:0,max:1},nonNullable:!0})],lo.prototype,"opacity",void 0),h([f({clonable:!1})],lo.prototype,"parent",void 0),h([f({readOnly:!0})],lo.prototype,"parsedUrl",null),h([f({type:Boolean})],lo.prototype,"popupEnabled",void 0),h([f({type:Boolean})],lo.prototype,"attributionVisible",void 0),h([f({type:St})],lo.prototype,"spatialReference",void 0),h([f({type:String})],lo.prototype,"title",void 0),h([f({readOnly:!0,json:{read:!1}})],lo.prototype,"type",void 0),h([f()],lo.prototype,"url",void 0),h([f({type:Boolean,nonNullable:!0})],lo.prototype,"visible",void 0),lo=h([N("esri.layers.Layer")],lo);const Hye=lo;function a7(t,e,r){let i,n;if(t)for(let s=0,o=t.length;s<o;s++){if(i=t.at(s),(i==null?void 0:i[e])===r)return i;if((i==null?void 0:i.type)==="group"&&(n=a7(i.layers,e,r),n))return n}}const S8e=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new ir;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||J.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",qb(r,this._get("layers")))}add(r,i){const n=this.layers;if(i=n.getNextIndex(i),r instanceof Hye){const s=r;s.parent===this?this.reorder(s,i):n.add(s,i)}else Eu(r)?r.then(s=>{this.destroyed||this.add(s,i)}):J.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const n=this.layers;let s=n.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(r){return a7(this.layers,"id",r)}findLayerByUid(r){return a7(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return h([f()],e.prototype,"layers",null),e=h([N("esri.support.LayersMixin")],e),e};function l7(t,e,r){if(t)for(let i=0,n=t.length;i<n;i++){const s=t.at(i);if(s[e]===r)return s;if((s==null?void 0:s.type)==="group"){const o=l7(s.tables,e,r);if(o)return o}}}const E8e=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new ir,this.addHandles([this.tables.on("after-add",i=>{const n=i.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&J.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",qb(r,this._get("tables")))}findTableById(r){return l7(this.tables,"id",r)}findTableByUid(r){return l7(this.tables,"uid",r)}};return h([f()],e.prototype,"tables",null),e=h([N("esri.support.TablesMixin")],e),e};let Xp=class extends E8e(S8e(Bn.EventedMixin(xe))){constructor(e){super(e),this.allLayers=new sR({getCollections:()=>{var r,i,n;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=q6e(this),this.basemap=null,this.editableLayers=new sR({getCollections:()=>[this.allLayers],itemFilterFunction:V6e}),this.ground=new S4,this._basemapCache=j6e()}destroy(){var e,r;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(r=this.basemap)==null||r.destroy(),H6e(this._basemapCache),this._basemapCache=null}castBasemap(e){return W6e(e,this._basemapCache)}castGround(e){return X6e(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};h([f({readOnly:!0,dependsOn:[]})],Xp.prototype,"allLayers",void 0),h([f({readOnly:!0})],Xp.prototype,"allTables",void 0),h([f({type:iR})],Xp.prototype,"basemap",void 0),h([_i("basemap")],Xp.prototype,"castBasemap",null),h([f({readOnly:!0})],Xp.prototype,"editableLayers",void 0),h([f({type:S4,nonNullable:!0})],Xp.prototype,"ground",void 0),h([_i("ground")],Xp.prototype,"castGround",null),Xp=h([N("esri.Map")],Xp);const Wye=Xp,Cu=t=>{let e=class extends t{clone(){var l;const r=sc(I_(this),"unable to clone instance of non-accessor class"),i=r.metadatas,n=r.store,s={},o=new Map;for(const c in i){const u=i[c],d=n==null?void 0:n.originOf(c),p=u.clonable;if(u.readOnly||p===!1||d!==Qr.USER&&d!==Qr.DEFAULTS&&d!==Qr.WEB_MAP&&d!==Qr.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof p=="function"?p(m):p==="reference"?m:mV(m),m!=null&&y==null||(d===Qr.DEFAULTS?o.set(c,y):s[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=I_(a))==null?void 0:l.store;if(c)for(const[u,d]of o)c.set(u,d,Qr.DEFAULTS)}return a}};return e=h([N("esri.core.Clonable")],e),e};let c7=class extends Cu(xe){};c7=h([N("esri.core.Clonable")],c7);let F_=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,n=0,s=!1){return(i-=n)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),s&&i===r&&(i=e),i+n}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return ge(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,n=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(n)?i:n}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function PY(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const C8e=PY(new F_(0,2*Math.PI)),U_=PY(new F_(-Math.PI,Math.PI)),MY=PY(new F_(0,360));let Nm=class extends Cu(ke){constructor(...e){super(...e),this.position=new ze([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return r!=null&&(s.heading=r),i!=null&&(s.tilt=i),n!=null&&(s.fov=n),s}return e}writePosition(e,r,i,n){const s=e.clone();s.x=Ud(e.x||0),s.y=Ud(e.y||0),s.z=e.hasZ?Ud(e.z||0):e.z,r[i]=s.write({},n)}readPosition(e,r){const i=new ze;return i.read(e,r),i.x=Ud(i.x||0),i.y=Ud(i.y||0),i.z=i.hasZ?Ud(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};h([f({type:ze,json:{write:{isRequired:!0}}})],Nm.prototype,"position",void 0),h([xr("position")],Nm.prototype,"writePosition",null),h([lr("position")],Nm.prototype,"readPosition",null),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),_i(t=>MY.normalize(Ud(t)))],Nm.prototype,"heading",void 0),h([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),_i(t=>ge(Ud(t),-180,180))],Nm.prototype,"tilt",void 0),h([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Nm.prototype,"fov",void 0),Nm=h([N("esri.Camera")],Nm);const vu=Nm;var wS;function A8e(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return wS.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return wS.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(wS||(wS={}));const O8e=J.getLogger("esri.support.arcadeOnDemand");let ek;function $Y(){return ek||(ek=(async()=>{const t=await ce(()=>import("./arcadeUtils-b902d678.js").then(e=>e.az),["assets/arcadeUtils-b902d678.js","assets/arcadeTimeUtils-e1438cc8.js","assets/executionError-c92d3b85.js","assets/FieldsIndex-f79a8f26.js","assets/number-e5825aa4.js","assets/hash-6f442295.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),ek}const R8e=(t,e,r)=>IY.create(t,e,r,null,["$feature"],[]),P8e=(t,e,r)=>IY.create(t,e,r,null,["$feature","$view"],[]),B3t=(t,e,r,i)=>IY.create(t,e,r,i,["$feature","$view"],[]);let IY=class qye{constructor(e,r,i,n,s,o,a){this.services=null,this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await $Y(),u=St.fromJSON(r);let d;try{d=a.parseScript(e,o)}catch(P){return O8e.error(new Y("arcade-bad-expression","Failed to parse arcade script",{script:e,error:P})),null}const p=s.reduce((P,F)=>({...P,[F]:null}),{});let m=null;n!=null&&(m=new c(n),m.immutable=!0,p.$config=null);const y=a.scriptUsesGeometryEngine(d),_=y&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(d)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(d),x=b&&a.enableAsyncSupport(),T={vars:p,spatialReference:u,useAsync:!!x};await Promise.all([_,v,x]);const S=new Set;await a.loadDependentModules(S,d,null,b,y);const A=new c;A.immutable=!1,A.setField("scale",0);const C=a.compileScript(d,T),R=(P,F)=>("$view"in P&&P.$view&&(A.setField("scale",typeof P.$view=="object"&&"scale"in P.$view?P.$view.scale:void 0),P.$view=A),m&&(P.$config=m),C({vars:P,spatialReference:u,services:F}));return new qye(e,a,d,R,new l,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const M8e=/^([0-9_])/,$8e=/[^a-z0-9_\u0080-\uffff]+/gi;function V3t(t){return t==null?null:t.trim().replaceAll($8e,"_").replace(M8e,"F$1")||null}const I8e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],L8e=["field","normalizationField"];function G3t(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(fre(I8e,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)fre(L8e,i,e)}}function fre(t,e,r){if(t)for(const i of t){const n=uP(i,e),s=n&&typeof n!="function"&&r.get(n);s&&Pw(i,s.name,e)}}function j3t(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),n=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const i=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const tk=new Set;function Xye(t,e){return t&&e?(tk.clear(),aR(tk,t,e),Array.from(tk).sort()):[]}function aR(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of r)rw(t,e,n);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const n of r)n!=null&&t.add(n)}}function rw(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function H3t(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function kg(t,e,r){var s;if(!r)return;const{arcadeUtils:i}=await $Y(),n=i.extractFieldNames(r,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)rw(t,e,o)}async function Yye(t,e,r){if(r&&r!=="1=1"){const{WhereClause:i}=await ce(()=>import("./WhereClause-c86b9974.js").then(s=>s.W),["assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js"]),n=i.create(r,e);if(!n.isStandardized)throw new Y("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});aR(t,e,n.fieldNames)}}function W3t({displayField:t,fields:e}){return t||(e&&e.length?rk(e,"name-or-title")||rk(e,"unique-identifier")||rk(e,"type-or-category")||D8e(e):null)}function D8e(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function rk(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function q3t(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function N8e(t,e,r){r.onStatisticExpression?kg(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function X3t(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],n=r.popupTemplate;i.push(F8e(t,e,n)),r.fields&&i.push(...r.fields.map(async s=>N8e(t,e.fieldsIndex,s))),await Promise.all(i)}async function F8e(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(s=>kg(t,e.fieldsIndex,s.expression)));const n=r==null?void 0:r.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&i.push(kg(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(i)}async function Y3t(t,e,r){e&&(e.timeInfo&&r!=null&&r.timeExtent&&aR(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&aR(t,e.fieldsIndex,[e.floorInfo.floorField]),r!=null&&r.where!=null&&await Yye(t,e.fieldsIndex,r.where))}async function Z3t(t,e,r){e&&r&&await Promise.all(r.map(i=>U8e(t,e,i)))}async function U8e(t,e,r){e&&r&&(r.valueExpression?await kg(t,e.fieldsIndex,r.valueExpression):r.field&&rw(t,e.fieldsIndex,r.field))}function Q3t(t){return t?Xye(t.fieldsIndex,Zye(t)):[]}function k8e(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?Xye(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const z8e=["oid","global-id","guid"],B8e=["oid","global-id"],V8e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function G8e(t){const e=new Set;Qye(t).forEach(i=>e.add(i)),k8e(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function Zye(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=e;return[r,i,n,s].filter(Boolean)}function Qye(t){return Zye(t).map(e=>e.toLowerCase())}function J3t(t,e){var r;return t.editable&&!z8e.includes(t.type)&&!Qye(e).includes(((r=t.name)==null?void 0:r.toLowerCase())??"")}function K3t(t,e){var i;const r=((i=t.name)==null?void 0:i.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&r===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&r===e.globalIdField.toLowerCase()||G8e(e).includes(r)||B8e.includes(t.type)||V8e.some(n=>n.test(r)))}async function eAt(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(n=>j8e(t,i,n)))}async function j8e(t,e,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if(i.type==="arcade")await kg(t,e,i.expression);else{const s=i.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{rw(t,e,o.slice(1,-1))})}await Yye(t,e,n)}function tAt(t){const e=t.defaultValue;return e!==void 0&&e_e(t,e)?e:t.nullable?null:void 0}function Jye(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function H8e(t){return t===null||Jye(t)}const LY="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function W8e(t){return t===null||LY(t)}function Kye(t){return t!=null&&typeof t=="string"}function q8e(t){return t===null||Kye(t)}function X8e(){return!0}function e_e(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?W8e:LY;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?H8e:Jye;break;case"string":case"esriFieldTypeString":r=t.nullable?q8e:Kye;break;default:r=X8e}return arguments.length===1?r:r(e)}const Y8e=["integer","small-integer","single","double"],Z8e=new Set([...Y8e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),Q8e=["date","date-only","time-only","timestamp-offset"],J8e=new Set([...Q8e,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function t_e(t){return t!=null&&Z8e.has(t.type)}function rAt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function iAt(t){return t!=null&&J8e.has(t.type)}var C4,A4;function nAt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function sAt(t,e){return t==null||t.nullable&&e===null?null:t_e(t)&&!K8e(t.type,Number(e))?C4.OUT_OF_RANGE:e_e(t,e)?t.domain?A8e(t.domain,e):null:A4.INVALID_TYPE}function K8e(t,e){const r=typeof t=="string"?r_e(t):t;if(!r)return!1;const i=r.min,n=r.max;return r.isInteger?LY(e)&&e>=i&&e<=n:e>=i&&e<=n}function r_e(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return eUe;case"esriFieldTypeInteger":case"integer":return tUe;case"esriFieldTypeBigInteger":case"big-integer":return rUe;case"esriFieldTypeSingle":case"single":return iUe;case"esriFieldTypeDouble":case"double":return nUe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(C4||(C4={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(A4||(A4={}));const eUe={min:-32768,max:32767,isInteger:!0},tUe={min:-2147483648,max:2147483647,isInteger:!0},rUe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},iUe={min:-34e37,max:12e37,isInteger:!1},nUe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function oAt(t,e,r){switch(t){case wS.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case wS.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case A4.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case C4.OUT_OF_RANGE:{const{min:i,max:n}=r_e(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${n}`}}}function aAt(t,e){return!sUe(t,e,null)}function sUe(t,e,r){if(!e||!e.attributes||!t){if(r!=null)for(const s of t??[])r.add(s);return!0}const i=e.attributes;let n=!1;for(const s of t)if(!(s in i)){if(n=!0,r==null)break;r.add(s)}return n}function lAt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let QL=class extends ke{constructor(e){super(e),this.type=null}};h([f({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],QL.prototype,"type",void 0),QL=h([N("esri.popup.content.Content")],QL);const l1=QL;var u7;let lv=u7=class extends l1{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new u7({description:this.description,displayType:this.displayType,title:this.title})}};h([f({type:String,json:{write:!0}})],lv.prototype,"description",void 0),h([f({type:["auto","preview","list"],json:{write:!0}})],lv.prototype,"displayType",void 0),h([f({type:String,json:{write:!0}})],lv.prototype,"title",void 0),h([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],lv.prototype,"type",void 0),lv=u7=h([N("esri.popup.content.AttachmentsContent")],lv);const O4=lv;var h7;let cv=h7=class extends l1{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new h7({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ye(this.outFields):null})}};h([f()],cv.prototype,"creator",void 0),h([f()],cv.prototype,"destroyer",void 0),h([f()],cv.prototype,"outFields",void 0),h([f({type:["custom"],readOnly:!0})],cv.prototype,"type",void 0),cv=h7=h([N("esri.popup.content.CustomContent")],cv);const oUe=cv;var d7;let l2=d7=class extends ke{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new d7({title:this.title,expression:this.expression})}};h([f({type:String,json:{write:!0}})],l2.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],l2.prototype,"expression",void 0),h([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],l2.prototype,"returnType",void 0),l2=d7=h([N("esri.popup.ElementExpressionInfo")],l2);const aUe=l2;var p7;let h3=p7=class extends l1{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new p7({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};h([f({type:aUe,json:{write:!0}})],h3.prototype,"expressionInfo",void 0),h([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],h3.prototype,"type",void 0),h3=p7=h([N("esri.popup.content.ExpressionContent")],h3);const DY=h3;class Iw extends Error{}class lUe extends Iw{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class cUe extends Iw{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class uUe extends Iw{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class d3 extends Iw{}class i_e extends Iw{constructor(e){super(`Invalid unit ${e}`)}}class ah extends Iw{}class x0 extends Iw{constructor(){super("Zone is an abstract class")}}const je="numeric",cp="short",hu="long",R4={year:je,month:je,day:je},n_e={year:je,month:cp,day:je},hUe={year:je,month:cp,day:je,weekday:cp},s_e={year:je,month:hu,day:je},o_e={year:je,month:hu,day:je,weekday:hu},a_e={hour:je,minute:je},l_e={hour:je,minute:je,second:je},c_e={hour:je,minute:je,second:je,timeZoneName:cp},u_e={hour:je,minute:je,second:je,timeZoneName:hu},h_e={hour:je,minute:je,hourCycle:"h23"},d_e={hour:je,minute:je,second:je,hourCycle:"h23"},p_e={hour:je,minute:je,second:je,hourCycle:"h23",timeZoneName:cp},f_e={hour:je,minute:je,second:je,hourCycle:"h23",timeZoneName:hu},m_e={year:je,month:je,day:je,hour:je,minute:je},g_e={year:je,month:je,day:je,hour:je,minute:je,second:je},y_e={year:je,month:cp,day:je,hour:je,minute:je},__e={year:je,month:cp,day:je,hour:je,minute:je,second:je},dUe={year:je,month:cp,day:je,weekday:cp,hour:je,minute:je},v_e={year:je,month:hu,day:je,hour:je,minute:je,timeZoneName:cp},b_e={year:je,month:hu,day:je,hour:je,minute:je,second:je,timeZoneName:cp},w_e={year:je,month:hu,day:je,weekday:hu,hour:je,minute:je,timeZoneName:hu},x_e={year:je,month:hu,day:je,weekday:hu,hour:je,minute:je,second:je,timeZoneName:hu};class _P{get type(){throw new x0}get name(){throw new x0}get ianaName(){return this.name}get isUniversal(){throw new x0}offsetName(e,r){throw new x0}formatOffset(e,r){throw new x0}offset(e){throw new x0}equals(e){throw new x0}get isValid(){throw new x0}}let ik=null;class g6 extends _P{static get instance(){return ik===null&&(ik=new g6),ik}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return S_e(e,r,i)}formatOffset(e,r){return WA(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let JL={};function pUe(t){return JL[t]||(JL[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),JL[t]}const fUe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function mUe(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,n,s,o,a,l,c,u]=i;return[o,n,s,a,l,c,u]}function gUe(t,e){const r=t.formatToParts(e),i=[];for(let n=0;n<r.length;n++){const{type:s,value:o}=r[n],a=fUe[s];s==="era"?i[a]=o:Zr(a)||(i[a]=parseInt(o,10))}return i}let GM={};class zg extends _P{static create(e){return GM[e]||(GM[e]=new zg(e)),GM[e]}static resetCache(){GM={},JL={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=zg.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return S_e(e,r,i,this.name)}formatOffset(e,r){return WA(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=pUe(this.name);let[n,s,o,a,l,c,u]=i.formatToParts?gUe(i,r):mUe(i,r);a==="BC"&&(n=-Math.abs(n)+1);const p=UY({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let m=+r;const y=m%1e3;return m-=y>=0?y:1e3+y,(p-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let mre={};function yUe(t,e={}){const r=JSON.stringify([t,e]);let i=mre[r];return i||(i=new Intl.ListFormat(t,e),mre[r]=i),i}let f7={};function m7(t,e={}){const r=JSON.stringify([t,e]);let i=f7[r];return i||(i=new Intl.DateTimeFormat(t,e),f7[r]=i),i}let g7={};function _Ue(t,e={}){const r=JSON.stringify([t,e]);let i=g7[r];return i||(i=new Intl.NumberFormat(t,e),g7[r]=i),i}let y7={};function vUe(t,e={}){const{base:r,...i}=e,n=JSON.stringify([t,i]);let s=y7[n];return s||(s=new Intl.RelativeTimeFormat(t,e),y7[n]=s),s}let p3=null;function bUe(){return p3||(p3=new Intl.DateTimeFormat().resolvedOptions().locale,p3)}function wUe(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,n;try{i=m7(t).resolvedOptions(),n=t}catch{const l=t.substring(0,r);i=m7(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=i;return[n,s,o]}}function xUe(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function TUe(t){const e=[];for(let r=1;r<=12;r++){const i=dr.utc(2016,r,1);e.push(t(i))}return e}function SUe(t){const e=[];for(let r=1;r<=7;r++){const i=dr.utc(2016,11,13+r);e.push(t(i))}return e}function jM(t,e,r,i,n){const s=t.listingMode(r);return s==="error"?null:s==="en"?i(e):n(e)}function EUe(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class CUe{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:n,floor:s,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=_Ue(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):FY(e,3);return Gs(r,this.padTo)}}}class AUe{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&zg.create(a).valid?(n=a,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=m7(r,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class OUe{constructor(e,r,i){this.opts={style:"long",...i},!r&&T_e()&&(this.rtf=vUe(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):HUe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class En{static fromOpts(e){return En.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,n=!1){const s=e||zs.defaultLocale,o=s||(n?"en-US":bUe()),a=r||zs.defaultNumberingSystem,l=i||zs.defaultOutputCalendar;return new En(o,a,l,s)}static resetCache(){p3=null,f7={},g7={},y7={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return En.create(e,r,i)}constructor(e,r,i,n){const[s,o,a]=wUe(e);this.locale=s,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=xUe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=EUe(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:En.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return jM(this,e,i,A_e,()=>{const n=r?{month:e,day:"numeric"}:{month:e},s=r?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=TUe(o=>this.extract(o,n,"month"))),this.monthsCache[s][e]})}weekdays(e,r=!1,i=!0){return jM(this,e,i,P_e,()=>{const n=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=r?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=SUe(o=>this.extract(o,n,"weekday"))),this.weekdaysCache[s][e]})}meridiems(e=!0){return jM(this,void 0,e,()=>M_e,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[dr.utc(2016,11,13,9),dr.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return jM(this,e,r,$_e,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[dr.utc(-40,1,1),dr.utc(2017,1,1)].map(n=>this.extract(n,i,"era"))),this.eraCache[e]})}extract(e,r,i){const n=this.dtFormatter(e,r),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new CUe(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new AUe(e,this.intl,r)}relFormatter(e={}){return new OUe(this.intl,this.isEnglish(),e)}listFormatter(e={}){return yUe(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let nk=null;class Xa extends _P{static get utcInstance(){return nk===null&&(nk=new Xa(0)),nk}static instance(e){return e===0?Xa.utcInstance:new Xa(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new Xa(_6(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${WA(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${WA(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return WA(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class RUe extends _P{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function By(t,e){if(Zr(t)||t===null)return e;if(t instanceof _P)return t;if(PUe(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?g6.instance:r==="utc"||r==="gmt"?Xa.utcInstance:Xa.parseSpecifier(r)||zg.create(t)}else return Ab(t)?Xa.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new RUe(t)}let gre=()=>Date.now(),yre="system",_re=null,vre=null,bre=null,wre=60,xre;class zs{static get now(){return gre}static set now(e){gre=e}static set defaultZone(e){yre=e}static get defaultZone(){return By(yre,g6.instance)}static get defaultLocale(){return _re}static set defaultLocale(e){_re=e}static get defaultNumberingSystem(){return vre}static set defaultNumberingSystem(e){vre=e}static get defaultOutputCalendar(){return bre}static set defaultOutputCalendar(e){bre=e}static get twoDigitCutoffYear(){return wre}static set twoDigitCutoffYear(e){wre=e%100}static get throwOnInvalid(){return xre}static set throwOnInvalid(e){xre=e}static resetCaches(){En.resetCache(),zg.resetCache()}}function Zr(t){return typeof t>"u"}function Ab(t){return typeof t=="number"}function y6(t){return typeof t=="number"&&t%1===0}function PUe(t){return typeof t=="string"}function MUe(t){return Object.prototype.toString.call(t)==="[object Date]"}function T_e(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function $Ue(t){return Array.isArray(t)?t:[t]}function Tre(t,e,r){if(t.length!==0)return t.reduce((i,n)=>{const s=[e(n),n];return i&&r(i[0],s[0])===i[0]?i:s},null)[1]}function IUe(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function xS(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function fg(t,e,r){return y6(t)&&t>=e&&t<=r}function LUe(t,e){return t-e*Math.floor(t/e)}function Gs(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function Ry(t){if(!(Zr(t)||t===null||t===""))return parseInt(t,10)}function T1(t){if(!(Zr(t)||t===null||t===""))return parseFloat(t)}function NY(t){if(!(Zr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function FY(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function vP(t){return t%4===0&&(t%100!==0||t%400===0)}function HA(t){return vP(t)?366:365}function P4(t,e){const r=LUe(e-1,12)+1,i=t+(e-r)/12;return r===2?vP(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function UY(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function M4(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function _7(t){return t>99?t:t>zs.twoDigitCutoffYear?1900+t:2e3+t}function S_e(t,e,r,i=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(r,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function _6(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,n=r<0||Object.is(r,-0)?-i:i;return r*60+n}function E_e(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new ah(`Invalid unit value ${t}`);return e}function $4(t,e){const r={};for(const i in t)if(xS(t,i)){const n=t[i];if(n==null)continue;r[e(i)]=E_e(n)}return r}function WA(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${Gs(r,2)}:${Gs(i,2)}`;case"narrow":return`${n}${r}${i>0?`:${i}`:""}`;case"techie":return`${n}${Gs(r,2)}${Gs(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function v6(t){return IUe(t,["hour","minute","second","millisecond"])}const DUe=["January","February","March","April","May","June","July","August","September","October","November","December"],C_e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],NUe=["J","F","M","A","M","J","J","A","S","O","N","D"];function A_e(t){switch(t){case"narrow":return[...NUe];case"short":return[...C_e];case"long":return[...DUe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const O_e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],R_e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],FUe=["M","T","W","T","F","S","S"];function P_e(t){switch(t){case"narrow":return[...FUe];case"short":return[...R_e];case"long":return[...O_e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const M_e=["AM","PM"],UUe=["Before Christ","Anno Domini"],kUe=["BC","AD"],zUe=["B","A"];function $_e(t){switch(t){case"narrow":return[...zUe];case"short":return[...kUe];case"long":return[...UUe];default:return null}}function BUe(t){return M_e[t.hour<12?0:1]}function VUe(t,e){return P_e(e)[t.weekday-1]}function GUe(t,e){return A_e(e)[t.month-1]}function jUe(t,e){return $_e(e)[t.year<0?0:1]}function HUe(t,e,r="always",i=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&s){const d=t==="days";switch(e){case 1:return d?"tomorrow":`next ${n[t][0]}`;case-1:return d?"yesterday":`last ${n[t][0]}`;case 0:return d?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],u=i?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Sre(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const WUe={D:R4,DD:n_e,DDD:s_e,DDDD:o_e,t:a_e,tt:l_e,ttt:c_e,tttt:u_e,T:h_e,TT:d_e,TTT:p_e,TTTT:f_e,f:m_e,ff:y_e,fff:v_e,ffff:w_e,F:g_e,FF:__e,FFF:b_e,FFFF:x_e};class Ha{static create(e,r={}){return new Ha(e,r)}static parseFormat(e){let r=null,i="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&s.push({literal:n||/^\s+$/.test(i),val:i}),r=null,i="",n=!n):n||a===r?i+=a:(i.length>0&&s.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&s.push({literal:n||/^\s+$/.test(i),val:i}),s}static macroTokenToFormatOpts(e){return WUe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return Gs(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(m,y)=>this.loc.extract(e,m,y),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>i?BUe(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>i?GUe(e,m):s(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>i?VUe(e,m):s(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),u=m=>{const y=Ha.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(e,y):m},d=m=>i?jUe(e,m):s({era:m},"era"),p=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(m)}};return Sre(Ha.parseFormat(r),p)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},s=Ha.parseFormat(r),o=s.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return Sre(s,n(a))}}class Gd{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const I_e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function pE(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function fE(...t){return e=>t.reduce(([r,i,n],s)=>{const[o,a,l]=s(e,n);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function mE(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const n=r.exec(t);if(n)return i(n)}return[null,null]}function L_e(...t){return(e,r)=>{const i={};let n;for(n=0;n<t.length;n++)i[t[n]]=Ry(e[r+n]);return[i,null,r+n]}}const D_e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,qUe=`(?:${D_e.source}?(?:\\[(${I_e.source})\\])?)?`,kY=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,N_e=RegExp(`${kY.source}${qUe}`),zY=RegExp(`(?:T${N_e.source})?`),XUe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,YUe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,ZUe=/(\d{4})-?(\d{3})/,QUe=L_e("weekYear","weekNumber","weekDay"),JUe=L_e("year","ordinal"),KUe=/(\d{4})-(\d\d)-(\d\d)/,F_e=RegExp(`${kY.source} ?(?:${D_e.source}|(${I_e.source}))?`),eke=RegExp(`(?: ${F_e.source})?`);function NT(t,e,r){const i=t[e];return Zr(i)?r:Ry(i)}function tke(t,e){return[{year:NT(t,e),month:NT(t,e+1,1),day:NT(t,e+2,1)},null,e+3]}function gE(t,e){return[{hours:NT(t,e,0),minutes:NT(t,e+1,0),seconds:NT(t,e+2,0),milliseconds:NY(t[e+3])},null,e+4]}function bP(t,e){const r=!t[e]&&!t[e+1],i=_6(t[e+1],t[e+2]),n=r?null:Xa.instance(i);return[{},n,e+3]}function wP(t,e){const r=t[e]?zg.create(t[e]):null;return[{},r,e+1]}const rke=RegExp(`^T?${kY.source}$`),ike=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function nke(t){const[e,r,i,n,s,o,a,l,c]=t,u=e[0]==="-",d=l&&l[0]==="-",p=(m,y=!1)=>m!==void 0&&(y||m&&u)?-m:m;return[{years:p(T1(r)),months:p(T1(i)),weeks:p(T1(n)),days:p(T1(s)),hours:p(T1(o)),minutes:p(T1(a)),seconds:p(T1(l),l==="-0"),milliseconds:p(NY(c),d)}]}const ske={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function BY(t,e,r,i,n,s,o){const a={year:e.length===2?_7(Ry(e)):Ry(e),month:C_e.indexOf(r)+1,day:Ry(i),hour:Ry(n),minute:Ry(s)};return o&&(a.second=Ry(o)),t&&(a.weekday=t.length>3?O_e.indexOf(t)+1:R_e.indexOf(t)+1),a}const oke=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function ake(t){const[,e,r,i,n,s,o,a,l,c,u,d]=t,p=BY(e,n,i,r,s,o,a);let m;return l?m=ske[l]:c?m=0:m=_6(u,d),[p,new Xa(m)]}function lke(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const cke=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,uke=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,hke=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Ere(t){const[,e,r,i,n,s,o,a]=t;return[BY(e,n,i,r,s,o,a),Xa.utcInstance]}function dke(t){const[,e,r,i,n,s,o,a]=t;return[BY(e,a,r,i,n,s,o),Xa.utcInstance]}const pke=pE(XUe,zY),fke=pE(YUe,zY),mke=pE(ZUe,zY),gke=pE(N_e),U_e=fE(tke,gE,bP,wP),yke=fE(QUe,gE,bP,wP),_ke=fE(JUe,gE,bP,wP),vke=fE(gE,bP,wP);function bke(t){return mE(t,[pke,U_e],[fke,yke],[mke,_ke],[gke,vke])}function wke(t){return mE(lke(t),[oke,ake])}function xke(t){return mE(t,[cke,Ere],[uke,Ere],[hke,dke])}function Tke(t){return mE(t,[ike,nke])}const Ske=fE(gE);function Eke(t){return mE(t,[rke,Ske])}const Cke=pE(KUe,eke),Ake=pE(F_e),Oke=fE(gE,bP,wP);function Rke(t){return mE(t,[Cke,U_e],[Ake,Oke])}const Pke="Invalid Duration",k_e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Mke={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...k_e},Ru=146097/400,Zw=146097/4800,$ke={years:{quarters:4,months:12,weeks:Ru/7,days:Ru,hours:Ru*24,minutes:Ru*24*60,seconds:Ru*24*60*60,milliseconds:Ru*24*60*60*1e3},quarters:{months:3,weeks:Ru/28,days:Ru/4,hours:Ru*24/4,minutes:Ru*24*60/4,seconds:Ru*24*60*60/4,milliseconds:Ru*24*60*60*1e3/4},months:{weeks:Zw/7,days:Zw,hours:Zw*24,minutes:Zw*24*60,seconds:Zw*24*60*60,milliseconds:Zw*24*60*60*1e3},...k_e},uv=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Ike=uv.slice(0).reverse();function T0(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new ni(i)}function Lke(t){return t<0?Math.floor(t):Math.ceil(t)}function z_e(t,e,r,i,n){const s=t[n][r],o=e[r]/s,a=Math.sign(o)===Math.sign(i[n]),l=!a&&i[n]!==0&&Math.abs(o)<=1?Lke(o):Math.trunc(o);i[n]+=l,e[r]-=l*s}function Dke(t,e){Ike.reduce((r,i)=>Zr(e[i])?r:(r&&z_e(t,e,r,e,i),i),null)}function Nke(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class ni{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?$ke:Mke;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||En.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return ni.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new ah(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new ni({values:$4(e,ni.normalizeUnit),loc:En.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(Ab(e))return ni.fromMillis(e);if(ni.isDuration(e))return e;if(typeof e=="object")return ni.fromObject(e);throw new ah(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=Tke(e);return i?ni.fromObject(i,r):ni.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=Eke(e);return i?ni.fromObject(i,r):ni.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new ah("need to specify a reason the Duration is invalid");const i=e instanceof Gd?e:new Gd(e,r);if(zs.throwOnInvalid)throw new uUe(i);return new ni({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new i_e(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?Ha.create(this.loc,i).formatDurationFromString(this,e):Pke}toHuman(e={}){const r=uv.map(i=>{const n=this.values[i];return Zr(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(n)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=FY(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let n=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(n+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(n+=".SSS"));let s=i.toFormat(n);return e.includePrefix&&(s="T"+s),s}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=ni.fromDurationLike(e),i={};for(const n of uv)(xS(r.values,n)||xS(this.values,n))&&(i[n]=r.get(n)+this.get(n));return T0(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=ni.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=E_e(e(this.values[i],i));return T0(this,{values:r},!0)}get(e){return this[ni.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...$4(e,ni.normalizeUnit)};return T0(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:n,conversionAccuracy:i};return T0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Dke(this.matrix,e),T0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=Nke(this.normalize().shiftToAll().toObject());return T0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>ni.normalizeUnit(o));const r={},i={},n=this.toObject();let s;for(const o of uv)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;Ab(n[o])&&(a+=n[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in n)uv.indexOf(c)>uv.indexOf(o)&&z_e(this.matrix,n,c,r,o)}else Ab(n[o])&&(i[o]=n[o]);for(const o in i)i[o]!==0&&(r[s]+=o===s?i[o]:i[o]/this.matrix[s][o]);return T0(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return T0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,n){return i===void 0||i===0?n===void 0||n===0:i===n}for(const i of uv)if(!r(this.values[i],e.values[i]))return!1;return!0}}const Qw="Invalid Interval";function Fke(t,e){return!t||!t.isValid?Kn.invalid("missing or invalid start"):!e||!e.isValid?Kn.invalid("missing or invalid end"):e<t?Kn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Kn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new ah("need to specify a reason the Interval is invalid");const i=e instanceof Gd?e:new Gd(e,r);if(zs.throwOnInvalid)throw new cUe(i);return new Kn({invalid:i})}static fromDateTimes(e,r){const i=eC(e),n=eC(r),s=Fke(i,n);return s??new Kn({start:i,end:n})}static after(e,r){const i=ni.fromDurationLike(r),n=eC(e);return Kn.fromDateTimes(n,n.plus(i))}static before(e,r){const i=ni.fromDurationLike(r),n=eC(e);return Kn.fromDateTimes(n.minus(i),n)}static fromISO(e,r){const[i,n]=(e||"").split("/",2);if(i&&n){let s,o;try{s=dr.fromISO(i,r),o=s.isValid}catch{o=!1}let a,l;try{a=dr.fromISO(n,r),l=a.isValid}catch{l=!1}if(o&&l)return Kn.fromDateTimes(s,a);if(o){const c=ni.fromISO(n,r);if(c.isValid)return Kn.after(s,c)}else if(l){const c=ni.fromISO(i,r);if(c.isValid)return Kn.before(a,c)}}return Kn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Kn.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(eC).filter(o=>this.contains(o)).sort(),i=[];let{s:n}=this,s=0;for(;n<this.e;){const o=r[s]||this.e,a=+o>+this.e?this.e:o;i.push(Kn.fromDateTimes(n,a)),n=a,s+=1}return i}splitBy(e){const r=ni.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,n=1,s;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(Kn.fromDateTimes(i,s)),i=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Kn.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Kn.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&n.push(Kn.fromDateTimes(r,l.time)),r=null);return Kn.merge(n)}difference(...e){return Kn.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:Qw}toLocaleString(e=R4,r={}){return this.isValid?Ha.create(this.s.loc.clone(r),e).formatInterval(this):Qw}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Qw}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Qw}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Qw}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:Qw}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):ni.invalid(this.invalidReason)}mapEndpoints(e){return Kn.fromDateTimes(e(this.s),e(this.e))}}class HM{static hasDST(e=zs.defaultZone){const r=dr.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return zg.isValidZone(e)}static normalizeZone(e){return By(e,zs.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||En.create(r,i,s)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||En.create(r,i,s)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||En.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||En.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return En.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return En.create(r,null,"gregory").eras(e)}static features(){return{relative:T_e()}}}function Cre(t,e){const r=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(ni.fromMillis(i).as("days"))}function Uke(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=Cre(l,c);return(u-u%7)/7}],["days",Cre]],n={},s=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n)):t=a);return[t,n,a,o]}function kke(t,e,r,i){let[n,s,o,a]=Uke(t,e,r);const l=e-n,c=r.filter(d=>["hours","minutes","seconds","milliseconds"].indexOf(d)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=ni.fromObject(s,i);return c.length>0?ni.fromMillis(l,i).shiftTo(...c).plus(u):u}const VY={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},Are={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},zke=VY.hanidec.replace(/[\[|\]]/g,"").split("");function Bke(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(VY.hanidec)!==-1)e+=zke.indexOf(t[r]);else for(const n in Are){const[s,o]=Are[n];i>=s&&i<=o&&(e+=i-s)}}return parseInt(e,10)}else return e}function Qh({numberingSystem:t},e=""){return new RegExp(`${VY[t||"latn"]}${e}`)}const Vke="missing Intl.DateTimeFormat.formatToParts support";function Ti(t,e=r=>r){return{regex:t,deser:([r])=>e(Bke(r))}}const Gke=String.fromCharCode(160),B_e=`[ ${Gke}]`,V_e=new RegExp(B_e,"g");function jke(t){return t.replace(/\./g,"\\.?").replace(V_e,B_e)}function Ore(t){return t.replace(/\./g,"").replace(V_e," ").toLowerCase()}function Jh(t,e){return t===null?null:{regex:RegExp(t.map(jke).join("|")),deser:([r])=>t.findIndex(i=>Ore(r)===Ore(i))+e}}function Rre(t,e){return{regex:t,deser:([,r,i])=>_6(r,i),groups:e}}function WM(t){return{regex:t,deser:([e])=>e}}function Hke(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Wke(t,e){const r=Qh(e),i=Qh(e,"{2}"),n=Qh(e,"{3}"),s=Qh(e,"{4}"),o=Qh(e,"{6}"),a=Qh(e,"{1,2}"),l=Qh(e,"{1,3}"),c=Qh(e,"{1,6}"),u=Qh(e,"{1,9}"),d=Qh(e,"{2,4}"),p=Qh(e,"{4,6}"),m=v=>({regex:RegExp(Hke(v.val)),deser:([b])=>b,literal:!0}),_=(v=>{if(t.literal)return m(v);switch(v.val){case"G":return Jh(e.eras("short",!1),0);case"GG":return Jh(e.eras("long",!1),0);case"y":return Ti(c);case"yy":return Ti(d,_7);case"yyyy":return Ti(s);case"yyyyy":return Ti(p);case"yyyyyy":return Ti(o);case"M":return Ti(a);case"MM":return Ti(i);case"MMM":return Jh(e.months("short",!0,!1),1);case"MMMM":return Jh(e.months("long",!0,!1),1);case"L":return Ti(a);case"LL":return Ti(i);case"LLL":return Jh(e.months("short",!1,!1),1);case"LLLL":return Jh(e.months("long",!1,!1),1);case"d":return Ti(a);case"dd":return Ti(i);case"o":return Ti(l);case"ooo":return Ti(n);case"HH":return Ti(i);case"H":return Ti(a);case"hh":return Ti(i);case"h":return Ti(a);case"mm":return Ti(i);case"m":return Ti(a);case"q":return Ti(a);case"qq":return Ti(i);case"s":return Ti(a);case"ss":return Ti(i);case"S":return Ti(l);case"SSS":return Ti(n);case"u":return WM(u);case"uu":return WM(a);case"uuu":return Ti(r);case"a":return Jh(e.meridiems(),0);case"kkkk":return Ti(s);case"kk":return Ti(d,_7);case"W":return Ti(a);case"WW":return Ti(i);case"E":case"c":return Ti(r);case"EEE":return Jh(e.weekdays("short",!1,!1),1);case"EEEE":return Jh(e.weekdays("long",!1,!1),1);case"ccc":return Jh(e.weekdays("short",!0,!1),1);case"cccc":return Jh(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Rre(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Rre(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return WM(/[a-z_+-/]{1,256}?/i);case" ":return WM(/[^\S\n\r]/);default:return m(v)}})(t)||{invalidReason:Vke};return _.token=t,_}const qke={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function Xke(t,e){const{type:r,value:i}=t;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const n=e[r];let s=qke[r];if(typeof s=="object"&&(s=s[n]),s)return{literal:!1,val:s}}function Yke(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function Zke(t,e,r){const i=t.match(e);if(i){const n={};let s=1;for(const o in r)if(xS(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(i.slice(s,s+l))),s+=l}return[i,n]}else return[i,{}]}function Qke(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Zr(t.z)||(r=zg.create(t.z)),Zr(t.Z)||(r||(r=new Xa(t.Z)),i=t.Z),Zr(t.q)||(t.M=(t.q-1)*3+1),Zr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Zr(t.u)||(t.S=NY(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),r,i]}let sk=null;function Jke(){return sk||(sk=dr.fromMillis(1555555555555)),sk}function Kke(t,e){if(t.literal)return t;const r=Ha.macroTokenToFormatOpts(t.val),i=H_e(r,e);return i==null||i.includes(void 0)?t:i}function G_e(t,e){return Array.prototype.concat(...t.map(r=>Kke(r,e)))}function j_e(t,e,r){const i=G_e(Ha.parseFormat(r),t),n=i.map(o=>Wke(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:i,invalidReason:s.invalidReason};{const[o,a]=Yke(n),l=RegExp(o,"i"),[c,u]=Zke(e,l,a),[d,p,m]=u?Qke(u):[null,null,void 0];if(xS(u,"a")&&xS(u,"H"))throw new d3("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:u,result:d,zone:p,specificOffset:m}}}function e9e(t,e,r){const{result:i,zone:n,specificOffset:s,invalidReason:o}=j_e(t,e,r);return[i,n,s,o]}function H_e(t,e){return t?Ha.create(e,t).formatDateTimeParts(Jke()).map(n=>Xke(n,t)):null}const W_e=[0,31,59,90,120,151,181,212,243,273,304,334],q_e=[0,31,60,91,121,152,182,213,244,274,305,335];function bh(t,e){return new Gd("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function X_e(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const n=i.getUTCDay();return n===0?7:n}function Y_e(t,e,r){return r+(vP(t)?q_e:W_e)[e-1]}function Z_e(t,e){const r=vP(t)?q_e:W_e,i=r.findIndex(s=>s<e),n=e-r[i];return{month:i+1,day:n}}function v7(t){const{year:e,month:r,day:i}=t,n=Y_e(e,r,i),s=X_e(e,r,i);let o=Math.floor((n-s+10)/7),a;return o<1?(a=e-1,o=M4(a)):o>M4(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:s,...v6(t)}}function Pre(t){const{weekYear:e,weekNumber:r,weekday:i}=t,n=X_e(e,1,4),s=HA(e);let o=r*7+i-n-3,a;o<1?(a=e-1,o+=HA(a)):o>s?(a=e+1,o-=HA(e)):a=e;const{month:l,day:c}=Z_e(a,o);return{year:a,month:l,day:c,...v6(t)}}function ok(t){const{year:e,month:r,day:i}=t,n=Y_e(e,r,i);return{year:e,ordinal:n,...v6(t)}}function Mre(t){const{year:e,ordinal:r}=t,{month:i,day:n}=Z_e(e,r);return{year:e,month:i,day:n,...v6(t)}}function t9e(t){const e=y6(t.weekYear),r=fg(t.weekNumber,1,M4(t.weekYear)),i=fg(t.weekday,1,7);return e?r?i?!1:bh("weekday",t.weekday):bh("week",t.week):bh("weekYear",t.weekYear)}function r9e(t){const e=y6(t.year),r=fg(t.ordinal,1,HA(t.year));return e?r?!1:bh("ordinal",t.ordinal):bh("year",t.year)}function Q_e(t){const e=y6(t.year),r=fg(t.month,1,12),i=fg(t.day,1,P4(t.year,t.month));return e?r?i?!1:bh("day",t.day):bh("month",t.month):bh("year",t.year)}function J_e(t){const{hour:e,minute:r,second:i,millisecond:n}=t,s=fg(e,0,23)||e===24&&r===0&&i===0&&n===0,o=fg(r,0,59),a=fg(i,0,59),l=fg(n,0,999);return s?o?a?l?!1:bh("millisecond",n):bh("second",i):bh("minute",r):bh("hour",e)}const ak="Invalid DateTime",$re=864e13;function qM(t){return new Gd("unsupported zone",`the zone "${t.name}" is not supported`)}function lk(t){return t.weekData===null&&(t.weekData=v7(t.c)),t.weekData}function JE(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new dr({...r,...e,old:r})}function K_e(t,e,r){let i=t-e*60*1e3;const n=r.offset(i);if(e===n)return[i,e];i-=(n-e)*60*1e3;const s=r.offset(i);return n===s?[i,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function Ire(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function KL(t,e,r){return K_e(UY(t),e,r)}function Lre(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:i,month:n,day:Math.min(t.c.day,P4(i,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=ni.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=UY(s);let[l,c]=K_e(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function KE(t,e,r,i,n,s){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=dr.fromObject(t,{...r,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return dr.invalid(new Gd("unparsable",`the input "${n}" can't be parsed as ${i}`))}function XM(t,e,r=!0){return t.isValid?Ha.create(En.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function ck(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=Gs(t.c.year,r?6:4),e?(i+="-",i+=Gs(t.c.month),i+="-",i+=Gs(t.c.day)):(i+=Gs(t.c.month),i+=Gs(t.c.day)),i}function Dre(t,e,r,i,n,s){let o=Gs(t.c.hour);return e?(o+=":",o+=Gs(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=Gs(t.c.minute),(t.c.second!==0||!r)&&(o+=Gs(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=Gs(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=Gs(Math.trunc(-t.o/60)),o+=":",o+=Gs(Math.trunc(-t.o%60))):(o+="+",o+=Gs(Math.trunc(t.o/60)),o+=":",o+=Gs(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const e1e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},i9e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},n9e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},t1e=["year","month","day","hour","minute","second","millisecond"],s9e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],o9e=["year","ordinal","hour","minute","second","millisecond"];function Nre(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new i_e(t);return e}function Fre(t,e){const r=By(e.zone,zs.defaultZone),i=En.fromObject(e),n=zs.now();let s,o;if(Zr(t.year))s=n;else{for(const c of t1e)Zr(t[c])&&(t[c]=e1e[c]);const a=Q_e(t)||J_e(t);if(a)return dr.invalid(a);const l=r.offset(n);[s,o]=KL(t,l,r)}return new dr({ts:s,zone:r,loc:i,o})}function Ure(t,e,r){const i=Zr(r.round)?!0:r.round,n=(o,a)=>(o=FY(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),s=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return n(s(r.unit),r.unit);for(const o of r.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,r.units[r.units.length-1])}function kre(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class dr{constructor(e){const r=e.zone||zs.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Gd("invalid input"):null)||(r.isValid?null:qM(r));this.ts=Zr(e.ts)?zs.now():e.ts;let n=null,s=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[n,s]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);n=Ire(this.ts,a),i=Number.isNaN(n.year)?new Gd("invalid input"):null,n=i?null:n,s=i?null:a}this._zone=r,this.loc=e.loc||En.create(),this.invalid=i,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new dr({})}static local(){const[e,r]=kre(arguments),[i,n,s,o,a,l,c]=r;return Fre({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=kre(arguments),[i,n,s,o,a,l,c]=r;return e.zone=Xa.utcInstance,Fre({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=MUe(e)?e.valueOf():NaN;if(Number.isNaN(i))return dr.invalid("invalid input");const n=By(r.zone,zs.defaultZone);return n.isValid?new dr({ts:i,zone:n,loc:En.fromObject(r)}):dr.invalid(qM(n))}static fromMillis(e,r={}){if(Ab(e))return e<-$re||e>$re?dr.invalid("Timestamp out of range"):new dr({ts:e,zone:By(r.zone,zs.defaultZone),loc:En.fromObject(r)});throw new ah(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(Ab(e))return new dr({ts:e*1e3,zone:By(r.zone,zs.defaultZone),loc:En.fromObject(r)});throw new ah("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=By(r.zone,zs.defaultZone);if(!i.isValid)return dr.invalid(qM(i));const n=zs.now(),s=Zr(r.specificOffset)?i.offset(n):r.specificOffset,o=$4(e,Nre),a=!Zr(o.ordinal),l=!Zr(o.year),c=!Zr(o.month)||!Zr(o.day),u=l||c,d=o.weekYear||o.weekNumber,p=En.fromObject(r);if((u||a)&&d)throw new d3("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new d3("Can't mix ordinal dates with month/day");const m=d||o.weekday&&!u;let y,_,v=Ire(n,s);m?(y=s9e,_=i9e,v=v7(v)):a?(y=o9e,_=n9e,v=ok(v)):(y=t1e,_=e1e);let b=!1;for(const P of y){const F=o[P];Zr(F)?b?o[P]=_[P]:o[P]=v[P]:b=!0}const x=m?t9e(o):a?r9e(o):Q_e(o),T=x||J_e(o);if(T)return dr.invalid(T);const S=m?Pre(o):a?Mre(o):o,[A,C]=KL(S,s,i),R=new dr({ts:A,zone:i,o:C,loc:p});return o.weekday&&u&&e.weekday!==R.weekday?dr.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${R.toISO()}`):R}static fromISO(e,r={}){const[i,n]=bke(e);return KE(i,n,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,n]=wke(e);return KE(i,n,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,n]=xke(e);return KE(i,n,r,"HTTP",r)}static fromFormat(e,r,i={}){if(Zr(e)||Zr(r))throw new ah("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=i,o=En.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,u]=e9e(o,e,r);return u?dr.invalid(u):KE(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return dr.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,n]=Rke(e);return KE(i,n,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new ah("need to specify a reason the DateTime is invalid");const i=e instanceof Gd?e:new Gd(e,r);if(zs.throwOnInvalid)throw new lUe(i);return new dr({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=H_e(e,En.fromObject(r));return i?i.map(n=>n?n.val:null).join(""):null}static expandFormat(e,r={}){return G_e(Ha.parseFormat(e),En.fromObject(r)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?lk(this).weekYear:NaN}get weekNumber(){return this.isValid?lk(this).weekNumber:NaN}get weekday(){return this.isValid?lk(this).weekday:NaN}get ordinal(){return this.isValid?ok(this.c).ordinal:NaN}get monthShort(){return this.isValid?HM.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?HM.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?HM.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?HM.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return vP(this.year)}get daysInMonth(){return P4(this.year,this.month)}get daysInYear(){return this.isValid?HA(this.year):NaN}get weeksInWeekYear(){return this.isValid?M4(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:n}=Ha.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:n}}toUTC(e=0,r={}){return this.setZone(Xa.instance(e),r)}toLocal(){return this.setZone(zs.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=By(e,zs.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(r||i){const s=e.offset(this.ts),o=this.toObject();[n]=KL(o,s,e)}return JE(this,{ts:n,zone:e})}else return dr.invalid(qM(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const n=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return JE(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=$4(e,Nre),i=!Zr(r.weekYear)||!Zr(r.weekNumber)||!Zr(r.weekday),n=!Zr(r.ordinal),s=!Zr(r.year),o=!Zr(r.month)||!Zr(r.day),a=s||o,l=r.weekYear||r.weekNumber;if((a||n)&&l)throw new d3("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&n)throw new d3("Can't mix ordinal dates with month/day");let c;i?c=Pre({...v7(this.c),...r}):Zr(r.ordinal)?(c={...this.toObject(),...r},Zr(r.day)&&(c.day=Math.min(P4(c.year,c.month),c.day))):c=Mre({...ok(this.c),...r});const[u,d]=KL(c,this.o,this.zone);return JE(this,{ts:u,o:d})}plus(e){if(!this.isValid)return this;const r=ni.fromDurationLike(e);return JE(this,Lre(this,r))}minus(e){if(!this.isValid)return this;const r=ni.fromDurationLike(e).negate();return JE(this,Lre(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=ni.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?Ha.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):ak}toLocaleString(e=R4,r={}){return this.isValid?Ha.create(this.loc.clone(r),e).formatDateTime(this):ak}toLocaleParts(e={}){return this.isValid?Ha.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=ck(this,o);return a+="T",a+=Dre(this,o,r,i,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?ck(this,e==="extended"):null}toISOWeekDate(){return XM(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+Dre(this,o==="extended",r,e,i,s):null}toRFC2822(){return XM(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return XM(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?ck(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(r||e)&&(i&&(n+=" "),r?n+="z":e&&(n+="ZZ")),XM(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():ak}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return ni.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...i},s=$Ue(r).map(ni.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=kke(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(dr.now(),e,r)}until(e){return this.isValid?Kn.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(r)<=i&&i<=n.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||dr.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),Ure(r,this.plus(i),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?Ure(e.base||dr.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(dr.isDateTime))throw new ah("min requires all arguments be DateTimes");return Tre(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(dr.isDateTime))throw new ah("max requires all arguments be DateTimes");return Tre(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:n=null,numberingSystem:s=null}=i,o=En.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return j_e(o,e,r)}static fromStringExplain(e,r,i={}){return dr.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return R4}static get DATE_MED(){return n_e}static get DATE_MED_WITH_WEEKDAY(){return hUe}static get DATE_FULL(){return s_e}static get DATE_HUGE(){return o_e}static get TIME_SIMPLE(){return a_e}static get TIME_WITH_SECONDS(){return l_e}static get TIME_WITH_SHORT_OFFSET(){return c_e}static get TIME_WITH_LONG_OFFSET(){return u_e}static get TIME_24_SIMPLE(){return h_e}static get TIME_24_WITH_SECONDS(){return d_e}static get TIME_24_WITH_SHORT_OFFSET(){return p_e}static get TIME_24_WITH_LONG_OFFSET(){return f_e}static get DATETIME_SHORT(){return m_e}static get DATETIME_SHORT_WITH_SECONDS(){return g_e}static get DATETIME_MED(){return y_e}static get DATETIME_MED_WITH_SECONDS(){return __e}static get DATETIME_MED_WITH_WEEKDAY(){return dUe}static get DATETIME_FULL(){return v_e}static get DATETIME_FULL_WITH_SECONDS(){return b_e}static get DATETIME_HUGE(){return w_e}static get DATETIME_HUGE_WITH_SECONDS(){return x_e}}function eC(t){if(dr.isDateTime(t))return t;if(t&&t.valueOf&&Ab(t.valueOf()))return dr.fromJSDate(t);if(t&&typeof t=="object")return dr.fromObject(t);throw new ah(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const a9e={year:void 0,month:void 0,day:void 0,weekday:void 0},l9e={hour:void 0,minute:void 0,second:void 0},c9e={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},GY={timeZone:"Etc/UTC"},Cp={year:"numeric",month:"numeric",day:"numeric"},tC={year:"numeric",month:"long",day:"numeric"},rC={year:"numeric",month:"short",day:"numeric"},iC={year:"numeric",month:"long",weekday:"long",day:"numeric"},Vu={hour:"numeric",minute:"numeric"},Kh={...Vu,second:"numeric"},yE={"short-date":Cp,"short-date-short-time":{...Cp,...Vu},"short-date-short-time-24":{...Cp,...Vu,hour12:!1},"short-date-long-time":{...Cp,...Kh},"short-date-long-time-24":{...Cp,...Kh,hour12:!1},"short-date-le":Cp,"short-date-le-short-time":{...Cp,...Vu},"short-date-le-short-time-24":{...Cp,...Vu,hour12:!1},"short-date-le-long-time":{...Cp,...Kh},"short-date-le-long-time-24":{...Cp,...Kh,hour12:!1},"long-month-day-year":tC,"long-month-day-year-short-time":{...tC,...Vu},"long-month-day-year-short-time-24":{...tC,...Vu,hour12:!1},"long-month-day-year-long-time":{...tC,...Kh},"long-month-day-year-long-time-24":{...tC,...Kh,hour12:!1},"day-short-month-year":rC,"day-short-month-year-short-time":{...rC,...Vu},"day-short-month-year-short-time-24":{...rC,...Vu,hour12:!1},"day-short-month-year-long-time":{...rC,...Kh},"day-short-month-year-long-time-24":{...rC,...Kh,hour12:!1},"long-date":iC,"long-date-short-time":{...iC,...Vu},"long-date-short-time-24":{...iC,...Vu,hour12:!1},"long-date-long-time":{...iC,...Kh},"long-date-long-time-24":{...iC,...Kh,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Vu,"long-time":Kh},u9e=Oc()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),r1e={ar:"ar-u-nu-latn-ca-gregory"};let b7=new WeakMap,i1e=yE["short-date-short-time"];function h9e(t){const e=t||i1e;let r=b7.get(e);if(!r){const i=ep(),n=r1e[i]||i;r=new Intl.DateTimeFormat(n,e),b7.set(e,r)}return r}function f3(t){return yE[t]}function k_(t,e){return h9e(e).format(t)}function d9e(t,e=yE["short-date"]){return k_(new Date(t),{...e,...GY,...l9e})}function p9e(t,e=yE["short-time"]){return k_(new Date(`1970-01-01T${t}Z`),{...e,...GY,...a9e})}function f9e(t,e=yE["short-date-short-time"]){const r=dr.fromISO(t,{setZone:!0}),i=ep(),n=r1e[i]??i;return r.toLocaleString({...c9e,...e},{locale:n})}tY(()=>{b7=new WeakMap,i1e=yE["short-date-short-time"]});const m9e={ar:"ar-u-nu-latn"};let eD=new WeakMap,n1e={};function g9e(t){const e=t||n1e;if(!eD.has(e)){const r=ep(),i=m9e[ep()]||r;eD.set(e,new Intl.NumberFormat(i,t))}return eD.get(e)}function y9e(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function TS(t,e){return Object.is(t,-0)&&(t=0),g9e(e).format(t)}tY(()=>{eD=new WeakMap,n1e={}});let c2=class extends Cu(ke){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return TS(e,y9e(this))}formatDate(e,r=!1){return this.dateFormat?k_(e,{...f3(this.dateFormat),...r&&GY}):this.formatNumber(e)}formatDateOnly(e){const r=(this.dateFormat&&f3(this.dateFormat))??void 0;return d9e(e,r)}formatTimeOnly(e){const r=(this.dateFormat&&f3(this.dateFormat))??void 0;return p9e(e,r)}formatTimestamp(e){const r=(this.dateFormat&&f3(this.dateFormat))??void 0;return f9e(e,r)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,r,i){return e&&r&&i?e.trim().split(r).map(n=>this.formatNumber(Number(n))).join(i):e}};h([Vt(u9e)],c2.prototype,"dateFormat",void 0),h([f({type:Boolean,json:{write:!0}})],c2.prototype,"digitSeparator",void 0),h([f({type:mn,json:{write:!0}})],c2.prototype,"places",void 0),c2=h([N("esri.popup.support.FieldInfoFormat")],c2);const _9e=c2;var w7;let ud=w7=class extends ke{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new w7({fieldName:this.fieldName,format:this.format?ye(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};h([f({type:String,json:{write:!0}})],ud.prototype,"fieldName",void 0),h([f({type:_9e,json:{write:!0}})],ud.prototype,"format",void 0),h([f({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],ud.prototype,"isEditable",void 0),h([f({type:String,json:{write:!0}})],ud.prototype,"label",void 0),h([Vt(new zn({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],ud.prototype,"stringFieldOption",void 0),h([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],ud.prototype,"statisticType",void 0),h([f({type:String,json:{write:!0}})],ud.prototype,"tooltip",void 0),h([f({type:Boolean,json:{write:!0}})],ud.prototype,"visible",void 0),ud=w7=h([N("esri.popup.FieldInfo")],ud);const s1e=ud;var x7;let Fm=x7=class extends l1{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new x7(ye({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};h([f({type:Object,json:{write:!0}})],Fm.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],Fm.prototype,"description",void 0),h([f({type:[s1e]})],Fm.prototype,"fieldInfos",void 0),h([xr("fieldInfos")],Fm.prototype,"writeFieldInfos",null),h([f({type:String,json:{write:!0}})],Fm.prototype,"title",void 0),h([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Fm.prototype,"type",void 0),Fm=x7=h([N("esri.popup.content.FieldsContent")],Fm);const I4=Fm;let hv=class extends ke{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};h([f({type:String,json:{write:!0}})],hv.prototype,"altText",void 0),h([f({type:String,json:{write:!0}})],hv.prototype,"caption",void 0),h([f({type:String,json:{write:!0}})],hv.prototype,"title",void 0),h([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],hv.prototype,"type",void 0),hv=h([N("esri.popup.content.mixins.MediaInfo")],hv);const jY=hv;var T7;let u2=T7=class extends xe{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new T7({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};h([f()],u2.prototype,"fieldName",void 0),h([f()],u2.prototype,"tooltip",void 0),h([f()],u2.prototype,"value",void 0),u2=T7=h([N("esri.popup.content.support.ChartMediaInfoValueSeries")],u2);const v9e=u2;var S7;let dv=S7=class extends ke{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new S7({fields:ye(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};h([f({type:[String],json:{write:!0}})],dv.prototype,"fields",void 0),h([f({type:String,json:{write:!0}})],dv.prototype,"normalizeField",void 0),h([f({type:[v9e],json:{read:!1}})],dv.prototype,"series",void 0),h([f({type:String,json:{write:!0}})],dv.prototype,"tooltipField",void 0),dv=S7=h([N("esri.popup.content.support.ChartMediaInfoValue")],dv);const b9e=dv;let m3=class extends jY{constructor(e){super(e),this.type=null,this.value=null}};h([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],m3.prototype,"type",void 0),h([f({type:b9e,json:{write:!0}})],m3.prototype,"value",void 0),m3=h([N("esri.popup.content.mixins.ChartMediaInfo")],m3);const b6=m3,w6=Oc()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var E7;let tD=E7=class extends b6{constructor(t){super(t),this.type="bar-chart"}clone(){return new E7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:w6.write}})],tD.prototype,"type",void 0),tD=E7=h([N("esri.popup.content.BarChartMediaInfo")],tD);const o1e=tD;var C7;let rD=C7=class extends b6{constructor(t){super(t),this.type="column-chart"}clone(){return new C7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:w6.write}})],rD.prototype,"type",void 0),rD=C7=h([N("esri.popup.content.ColumnChartMediaInfo")],rD);const a1e=rD;var A7;let g3=A7=class extends ke{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new A7({linkURL:this.linkURL,sourceURL:this.sourceURL})}};h([f({type:String,json:{write:!0}})],g3.prototype,"linkURL",void 0),h([f({type:String,json:{write:!0}})],g3.prototype,"sourceURL",void 0),g3=A7=h([N("esri.popup.content.support.ImageMediaInfoValue")],g3);const w9e=g3;var O7;let h2=O7=class extends jY{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new O7({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};h([f({type:Number,json:{write:!0}})],h2.prototype,"refreshInterval",void 0),h([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],h2.prototype,"type",void 0),h([f({type:w9e,json:{write:!0}})],h2.prototype,"value",void 0),h2=O7=h([N("esri.popup.content.ImageMediaInfo")],h2);const l1e=h2;var R7;let iD=R7=class extends b6{constructor(t){super(t),this.type="line-chart"}clone(){return new R7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:w6.write}})],iD.prototype,"type",void 0),iD=R7=h([N("esri.popup.content.LineChartMediaInfo")],iD);const c1e=iD;var P7;let nD=P7=class extends b6{constructor(t){super(t),this.type="pie-chart"}clone(){return new P7({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};h([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:w6.write}})],nD.prototype,"type",void 0),nD=P7=h([N("esri.popup.content.PieChartMediaInfo")],nD);const u1e=nD,h1e={base:jY,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":o1e,"column-chart":a1e,"line-chart":c1e,"pie-chart":u1e,image:l1e}};var M7;let hd=M7=class extends l1{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?l1e.fromJSON(e):e.type==="barchart"?o1e.fromJSON(e):e.type==="columnchart"?a1e.fromJSON(e):e.type==="linechart"?c1e.fromJSON(e):e.type==="piechart"?u1e.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new M7(ye({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};h([f()],hd.prototype,"activeMediaInfoIndex",void 0),h([f({type:Object,json:{write:!0}})],hd.prototype,"attributes",void 0),h([f({type:String,json:{write:!0}})],hd.prototype,"description",void 0),h([f({types:[h1e]})],hd.prototype,"mediaInfos",void 0),h([lr("mediaInfos")],hd.prototype,"readMediaInfos",null),h([xr("mediaInfos")],hd.prototype,"writeMediaInfos",null),h([f({type:String,json:{write:!0}})],hd.prototype,"title",void 0),h([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],hd.prototype,"type",void 0),hd=M7=h([N("esri.popup.content.MediaContent")],hd);const L4=hd;var $7;let y3=$7=class extends ke{constructor(t){super(t),this.field=null,this.order=null}clone(){return new $7({field:this.field,order:this.order})}};h([f({type:String,json:{write:!0}})],y3.prototype,"field",void 0),h([f({type:["asc","desc"],json:{write:!0}})],y3.prototype,"order",void 0),y3=$7=h([N("esri.popup.support.RelatedRecordsInfoFieldOrder")],y3);const d1e=y3;let Yp=class extends Cu(l1){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};h([f({type:String,json:{write:!0}})],Yp.prototype,"description",void 0),h([f({type:Number,json:{type:mn,write:!0}})],Yp.prototype,"displayCount",void 0),h([f({type:["list"],json:{write:!0}})],Yp.prototype,"displayType",void 0),h([f({type:[d1e],json:{write:!0}})],Yp.prototype,"orderByFields",void 0),h([f({type:Number,json:{type:mn,write:!0}})],Yp.prototype,"relationshipId",void 0),h([f({type:String,json:{write:!0}})],Yp.prototype,"title",void 0),h([f({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Yp.prototype,"type",void 0),Yp=h([N("esri.popup.content.RelationshipContent")],Yp);const D4=Yp;var I7;let _3=I7=class extends l1{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new I7({text:this.text})}};h([f({type:String,json:{write:!0}})],_3.prototype,"text",void 0),h([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],_3.prototype,"type",void 0),_3=I7=h([N("esri.popup.content.TextContent")],_3);const N4=_3,x9e={base:null,key:"type",typeMap:{attachment:O4,media:L4,text:N4,expression:DY,field:I4,relationship:D4}};var L7;let pv=L7=class extends ke{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new L7({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};h([f({type:String,json:{write:!0}})],pv.prototype,"name",void 0),h([f({type:String,json:{write:!0}})],pv.prototype,"title",void 0),h([f({type:String,json:{write:!0}})],pv.prototype,"expression",void 0),h([f({type:["string","number"],json:{write:!0}})],pv.prototype,"returnType",void 0),pv=L7=h([N("esri.popup.ExpressionInfo")],pv);const T9e=pv;var D7;let v3=D7=class extends ke{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new D7({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};h([f({type:Boolean,json:{write:!0}})],v3.prototype,"returnTopmostRaster",void 0),h([f({type:Boolean,json:{write:!0}})],v3.prototype,"showNoDataRecords",void 0),v3=D7=h([N("esri.popup.LayerOptions")],v3);const S9e=v3;var N7;let b3=N7=class extends ke{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new N7({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ye(this.orderByFields):null})}};h([f({type:Boolean,json:{write:!0}})],b3.prototype,"showRelatedRecords",void 0),h([f({type:[d1e],json:{write:!0}})],b3.prototype,"orderByFields",void 0),b3=N7=h([N("esri.popup.RelatedRecordsInfo")],b3);const E9e=b3;var F7;let Gu=F7=class extends RY(xe){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new F7({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};h([f()],Gu.prototype,"active",void 0),h([f()],Gu.prototype,"className",void 0),h([f()],Gu.prototype,"disabled",void 0),h([f()],Gu.prototype,"icon",void 0),h([f()],Gu.prototype,"id",void 0),h([f()],Gu.prototype,"indicator",void 0),h([f()],Gu.prototype,"title",void 0),h([f()],Gu.prototype,"type",void 0),h([f()],Gu.prototype,"visible",void 0),Gu=F7=h([N("esri.support.actions.ActionBase")],Gu);const HY=Gu;var U7;let sD=U7=class extends HY{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new U7({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};h([f()],sD.prototype,"image",void 0),sD=U7=h([N("esri.support.Action.ActionButton")],sD);const C9e=sD;var k7;let w3=k7=class extends HY{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new k7({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};h([f()],w3.prototype,"image",void 0),h([f()],w3.prototype,"value",void 0),w3=k7=h([N("esri.support.Action.ActionToggle")],w3);const A9e=w3,O9e="esri.PopupTemplate",R9e=J.getLogger(O9e),nC="relationships/",zre="expression/",P9e=ir.ofType({key:"type",defaultKeyValue:"button",base:HY,typeMap:{button:C9e,toggle:A9e}}),M9e={base:l1,key:"type",typeMap:{media:L4,custom:oUe,text:N4,attachments:O4,fields:I4,expression:DY,relationship:D4}},$9e=["attachments","fields","media","text","expression","relationship"];let co=class extends Cu(ke){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>L_(M9e,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Eu(e)?e:(R9e.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,n){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(s=>$9e.includes(s.type)).map(s=>s&&s.toJSON(n)),r.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(r):s.type==="media"?this._writeMediaContent(s,r):s.type==="text"?this._writeTextContent(s,r):s.type==="relationship"&&this._writeRelationshipContent(s,r)})):r.description=e}writeFieldInfos(e,r,i,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});r.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(n);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,n){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),aR(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ye(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(n=>{const s=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:r.fieldInfos.push(n)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var s,o;const i=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ye(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const n={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!r||n.mediaInfos||(s.mediaInfos=r,n.mediaInfos=!0),L4.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),N4.fromJSON(s)):s.type==="attachments"?O4.fromJSON(s):s.type==="fields"?I4.fromJSON(s):s.type==="expression"?DY.fromJSON(s):s.type==="relationship"?D4.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(nC)))return null;const n=r.replace(nC,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?D4.fromJSON({relationshipId:s,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:n}=e;return{field:`${nC}${r}/${n}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new N4({text:e})):s.push(new I4),Array.isArray(r)&&r.length&&s.push(L4.fromJSON({mediaInfos:r})),i&&s.push(O4.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=s,d=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&d.push(a),l&&d.push(l),d}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,n)=>[...i,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(n=>kg(e,r,n.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(nC)&&!r.startsWith(zre)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const n=/\{(\w+):.+\}/,s=i.filter(o=>!(o.indexOf(`{${nC}`)===0||o.indexOf(`{${zre}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};h([f({type:P9e})],co.prototype,"actions",void 0),h([f()],co.prototype,"content",void 0),h([_i("content")],co.prototype,"castContent",null),h([lr("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],co.prototype,"readContent",null),h([xr("content",{popupElements:{type:ir.ofType(x9e)},showAttachments:{type:Boolean},mediaInfos:{type:ir.ofType(h1e)},description:{type:String},relatedRecordsInfo:{type:E9e}})],co.prototype,"writeContent",null),h([f({type:[T9e],json:{write:!0}})],co.prototype,"expressionInfos",void 0),h([f({type:[s1e]})],co.prototype,"fieldInfos",void 0),h([xr("fieldInfos")],co.prototype,"writeFieldInfos",null),h([f({type:S9e})],co.prototype,"layerOptions",void 0),h([xr("layerOptions")],co.prototype,"writeLayerOptions",null),h([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],co.prototype,"lastEditInfoEnabled",void 0),h([f()],co.prototype,"outFields",void 0),h([f()],co.prototype,"overwriteActions",void 0),h([f()],co.prototype,"returnGeometry",void 0),h([f({json:{type:String}})],co.prototype,"title",void 0),h([xr("title")],co.prototype,"writeTitle",null),co=h([N("esri.PopupTemplate")],co);const I9e=co,Bre=new zn({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let L9e=0,d2=class extends ke{constructor(e){super(e),this.id="sym"+L9e++,this.type=null,this.color=new it([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};h([f({type:Bre.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Bre.write}}})],d2.prototype,"type",void 0),h([f({type:it,json:{write:{allowNull:!0}}})],d2.prototype,"color",void 0),h([lr("color")],d2.prototype,"readColor",null),d2=h([N("esri.symbols.Symbol")],d2);const Rc=d2;var z7;let iy=z7=class extends Rc{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const n=i.map(s=>{const o=s.valueExpressionInfo;return kg(t,e,o.expression)});await Promise.all(n)}}}clone(){return new z7({data:ye(this.data)})}hash(){return mge(JSON.stringify(this.data)).toString()}};h([f({json:{write:!1}})],iy.prototype,"color",void 0),h([f({json:{write:!0}})],iy.prototype,"data",void 0),h([lr("data",["symbol"])],iy.prototype,"readData",null),h([xr("data",{})],iy.prototype,"writeData",null),h([Vt({CIMSymbolReference:"cim"},{readOnly:!0})],iy.prototype,"type",void 0),iy=z7=h([N("esri.symbols.CIMSymbol")],iy);const xP=iy;let p2=class extends ke{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};h([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],p2.prototype,"enabled",void 0),h([xr("enabled")],p2.prototype,"writeEnabled",null),h([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],p2.prototype,"type",void 0),p2=h([N("esri.symbols.Symbol3DLayer")],p2);const om=p2,D9e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,N9e="screenUtils.toPt: input not recognized!",p1e=96;function ha(t){return t?t/72*p1e:0}function up(t){return t?72*t/p1e:0}function gn(t){if(typeof t=="string"){const e=t.match(D9e);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=i==="px"?up(r):r;return n?-s:s}return console.warn(N9e),null}return t}function Lh(t=0,e=0){return{x:t,y:e}}function Xi(t=0,e=0){return[t,e]}function f1e(t=0,e=0){return[t,e]}function Vo(t=0,e=0,r=0){return[t,e,r]}function yAt(t){return t}function _At(t){return t}function vAt(t){return t}function wf(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function F9e(t,e){const r=e.transparency!=null?fY(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new it([i[0]||0,i[1]||0,i[2]||0,r]):null}function U9e(t,e){e.color=t.toJSON().slice(0,3);const r=pY(t.a);r!==0&&(e.transparency=r)}const Jg={type:it,json:{type:[mn],default:null,read:{source:["color","transparency"],reader:F9e},write:{target:{color:{type:[mn]},transparency:{type:mn}},writer:U9e}}},qf={type:Number,cast:gn,json:{write:!0}};let fv=class extends ke{constructor(e){super(e),this.color=new it([0,0,0,1]),this.extensionLength=0,this.size=up(1)}clone(){}cloneProperties(){return{color:ye(this.color),size:this.size,extensionLength:this.extensionLength}}};h([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],fv.prototype,"type",void 0),h([f(Jg)],fv.prototype,"color",void 0),h([f({...qf,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],fv.prototype,"extensionLength",void 0),h([f(qf)],fv.prototype,"size",void 0),fv=h([N("esri.symbols.edges.Edges3D")],fv);const WY=fv;var B7;let oD=B7=class extends WY{constructor(t){super(t),this.type="sketch"}clone(){return new B7(this.cloneProperties())}};h([Vt({sketch:"sketch"},{readOnly:!0})],oD.prototype,"type",void 0),oD=B7=h([N("esri.symbols.edges.SketchEdges3D")],oD);const qY=oD;var V7;let aD=V7=class extends WY{constructor(t){super(t),this.type="solid"}clone(){return new V7(this.cloneProperties())}};h([Vt({solid:"solid"},{readOnly:!0})],aD.prototype,"type",void 0),aD=V7=h([N("esri.symbols.support.SolidEdges3D")],aD);const m1e=aD,g1e={types:{key:"type",base:WY,typeMap:{solid:m1e,sketch:qY}},json:{write:!0}};var G7;let du=G7=class extends ke{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new G7(t)}};h([f(Jg)],du.prototype,"color",void 0),du=G7=h([N("esri.symbols.support.Symbol3DMaterial")],du);var j7;let ny=j7=class extends om{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new j7({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};h([Vt({Extrude:"extrude"},{readOnly:!0})],ny.prototype,"type",void 0),h([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],ny.prototype,"size",void 0),h([f({type:du,json:{write:!0}})],ny.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ny.prototype,"castShadows",void 0),h([f(g1e)],ny.prototype,"edges",void 0),ny=j7=h([N("esri.symbols.ExtrudeSymbol3DLayer")],ny);const y1e=ny;let x3=class extends Rc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};h([Vt({esriSLS:"simple-line"},{readOnly:!0})],x3.prototype,"type",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],x3.prototype,"width",void 0),x3=h([N("esri.symbols.LineSymbol")],x3);const k9e=x3,z9e=["begin","end","begin-end"],_1e=["arrow","circle","square","diamond","cross","x"];var H7;let Zp=H7=class extends ke{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new H7({color:ye(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};h([f({type:["begin","end","begin-end"],json:{write:!0}})],Zp.prototype,"placement",void 0),h([Vt({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],Zp.prototype,"type",void 0),h([f({type:_1e})],Zp.prototype,"style",void 0),h([xr("style")],Zp.prototype,"writeStyle",null),h([f({type:it,value:null,json:{write:{allowNull:!0}}})],Zp.prototype,"color",null),h([lr("color")],Zp.prototype,"readColor",null),h([xr("color")],Zp.prototype,"writeColor",null),Zp=H7=h([N("esri.symbols.LineSymbolMarker")],Zp);const B9e=Zp;var W7;const uk=new zn({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Um=W7=class extends k9e{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=gn(r)),i!=null&&(o.cap=i),n!=null&&(o.join=n),s!=null&&(o.miterLimit=gn(s)),o}clone(){var t;return new W7({color:ye(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};h([Vt({esriSLS:"simple-line"},{readOnly:!0})],Um.prototype,"type",void 0),h([f({type:uk.apiValues,json:{read:uk.read,write:uk.write}})],Um.prototype,"style",void 0),h([f({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Um.prototype,"cap",void 0),h([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],Um.prototype,"join",void 0),h([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":B9e}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Um.prototype,"marker",void 0),h([f({type:Number,json:{read:!1,write:!1}})],Um.prototype,"miterLimit",void 0),Um=W7=h([N("esri.symbols.SimpleLineSymbol")],Um);const Lw=Um;let T3=class extends Rc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Lw}},json:{default:null,write:!0}})],T3.prototype,"outline",void 0),h([f({type:["simple-fill","picture-fill"],readOnly:!0})],T3.prototype,"type",void 0),T3=h([N("esri.symbols.FillSymbol")],T3);const v1e=T3;let lD=class extends ke{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],lD.prototype,"type",void 0),lD=h([N("esri.symbols.patterns.LinePattern3D")],lD);const b1e=lD,V9e=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var q7;const G9e=Oc()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let S3=q7=class extends b1e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new q7(t)}};h([f({type:["style"]})],S3.prototype,"type",void 0),h([Vt(G9e),f({type:V9e})],S3.prototype,"style",void 0),S3=q7=h([N("esri.symbols.patterns.LineStylePattern3D")],S3);const XY=S3;let cD=class extends ke{constructor(e){super(e)}clone(){}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],cD.prototype,"type",void 0),cD=h([N("esri.symbols.patterns.Pattern3D")],cD);const w1e=cD,j9e=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var X7;let E3=X7=class extends w1e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new X7(t)}};h([f({type:["style"]})],E3.prototype,"type",void 0),h([f({type:j9e,json:{read:!0,write:!0}})],E3.prototype,"style",void 0),E3=X7=h([N("esri.symbols.patterns.StylePattern3D")],E3);const x1e=E3,H9e={types:{key:"type",base:w1e,typeMap:{style:x1e}},json:{write:!0}},T1e={types:{key:"type",base:b1e,typeMap:{style:XY}},json:{write:!0}},qA=new it("white");new it("black");const W9e=new it([255,255,255,0]);function q9e(t){return t.r===0&&t.g===0&&t.b===0}var Y7;let XA=Y7=class extends du{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new Y7(t)}};h([Vt({multiply:"multiply",replace:"replace",tint:"tint"})],XA.prototype,"colorMixMode",void 0),XA=Y7=h([N("esri.symbols.support.Symbol3DFillMaterial")],XA);function ps(t=O1e){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function iw(t,e,r,i,n,s,o=ps()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function EAt(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new Dr(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function SS(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function X9e(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Xf(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function lu(t,e,r=0,i=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<i;u++)n=Math.min(n,e[r+3*u]),s=Math.min(s,e[r+3*u+1]),o=Math.min(o,e[r+3*u+2]),a=Math.max(a,e[r+3*u]),l=Math.max(l,e[r+3*u+1]),c=Math.max(c,e[r+3*u+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function hk(t,e,r){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let u=0;u<i;u++){const d=e[u];n=Math.min(n,d[0]),s=Math.min(s,d[1]),o=Math.min(o,d[2]),a=Math.max(a,d[0]),l=Math.max(l,d[1]),c=Math.max(c,d[2])}else for(let u=0;u<i;u++){const d=e[u];n=Math.min(n,d[0]),s=Math.min(s,d[1]),a=Math.max(a,d[0]),l=Math.max(l,d[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function Y9e(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function Dw(t){return t[0]>=t[3]?0:t[3]-t[0]}function Nw(t){return t[1]>=t[4]?0:t[4]-t[1]}function c1(t){return t[2]>=t[5]?0:t[5]-t[2]}function S1e(t){const e=Dw(t),r=c1(t),i=Nw(t);return Math.sqrt(e*e+r*r+i*i)}function jd(t,e=[0,0,0]){return e[0]=t[0]+Dw(t)/2,e[1]=t[1]+Nw(t)/2,e[2]=t[2]+c1(t)/2,e}function YM(t,e=[0,0,0]){return e[0]=Dw(t),e[1]=Nw(t),e[2]=c1(t),e}function YY(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function CAt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function Z9e(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Hd(t,e){return e==null||Z9e(t,e)}function E1e(t,e,r,i,n=t){return n[0]=t[0]+e,n[1]=t[1]+r,n[2]=t[2]+i,n[3]=t[3]+e,n[4]=t[4]+r,n[5]=t[5]+i,n}function AAt(t,e,r=t){const i=t[0]+Dw(t)/2,n=t[1]+Nw(t)/2,s=t[2]+c1(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=n+(t[1]-n)*e,r[2]=s+(t[2]-s)*e,r[3]=i+(t[3]-i)*e,r[4]=n+(t[4]-n)*e,r[5]=s+(t[5]-s)*e,r}function C1e(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function A1e(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function x6(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function vi(t){return t?x6(t,Vre):ps(Vre)}function ZY(t,e){return e||(e=jt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function OAt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function Q9e(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function Z7(t){return t.length===6}function QY(t){return Dw(t)===0&&Nw(t)===0&&c1(t)===0}function RAt(t,e,r){if(t==null||e==null)return t===e;if(!Z7(t)||!Z7(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function J9e(t,e,r,i,n,s){return iw(t,e,r,i,n,s,K9e)}const PAt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Vre=[1/0,1/0,1/0,-1/0,-1/0,-1/0],O1e=[0,0,0,0,0,0],K9e=ps();function dk(t,{isPrimitive:e,width:r,depth:i,height:n}){const s=e?10:1;if(r==null&&n==null&&i==null)return[s*t[0],s*t[1],s*t[2]];const o=Se(r,i,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const eze=iw(-.5,-.5,-.5,.5,.5,.5),tze=iw(-.5,-.5,0,.5,.5,1),rze=iw(-.5,-.5,0,.5,.5,.5);function ize(t){switch(t){case"sphere":case"cube":case"diamond":return eze;case"cylinder":case"cone":case"inverted-cone":return tze;case"tetrahedron":return rze;default:return}}const JY=["butt","square","round"],nze=[...JY,"none"],R1e=["miter","bevel","round"];var Q7;let mv=Q7=class extends ke{constructor(t){super(t),this.color=new it([0,0,0,1]),this.size=up(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new Q7(t)}};h([f(Jg)],mv.prototype,"color",void 0),h([f(qf)],mv.prototype,"size",void 0),h([f(T1e)],mv.prototype,"pattern",void 0),h([f({type:JY,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],mv.prototype,"patternCap",void 0),mv=Q7=h([N("esri.symbols.support.Symbol3DOutline")],mv);var uD;let km=uD=class extends om{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new uD(t)}static fromSimpleFillSymbol(t){var i,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new XY({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((n=t.outline)==null?void 0:n.color)??qA).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(r.patternCap=t.outline.cap),new uD({material:new XA({color:(t.color??W9e).clone()}),pattern:t.style&&t.style!=="solid"?new x1e({style:t.style}):null,outline:r})}};h([Vt({Fill:"fill"},{readOnly:!0})],km.prototype,"type",void 0),h([f({type:XA,json:{write:!0}})],km.prototype,"material",void 0),h([f(H9e)],km.prototype,"pattern",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],km.prototype,"castShadows",void 0),h([f({type:mv,json:{write:!0}})],km.prototype,"outline",void 0),h([f(g1e)],km.prototype,"edges",void 0),km=uD=h([N("esri.symbols.FillSymbol3DLayer")],km);const Fw=km,sze=["none","underline","line-through"],oze=["normal","italic","oblique"],aze=["normal","lighter","bold","bolder"],P1e={type:Number,cast:t=>{const e=Ud(t);return e===0?1:ge(e,.1,4)},nonNullable:!0},lze=["left","right","center"],cze=["baseline","top","middle","bottom"],M1e={type:lze,nonNullable:!0},$1e={type:cze,nonNullable:!0},MAt=8;var J7;let zm=J7=class extends ke{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return gn(t)}clone(){return new J7({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};h([f({type:sze,json:{default:"none",write:!0}})],zm.prototype,"decoration",void 0),h([f({type:String,json:{write:!0}})],zm.prototype,"family",void 0),h([f({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],zm.prototype,"size",void 0),h([_i("size")],zm.prototype,"castSize",null),h([f({type:oze,json:{default:"normal",write:!0}})],zm.prototype,"style",void 0),h([f({type:aze,json:{default:"normal",write:!0}})],zm.prototype,"weight",void 0),zm=J7=h([N("esri.symbols.Font")],zm);const T6=zm;function nw(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=iu(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=n6(t,e.portalItem.itemUrl);i!=null&&uze.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return K7(t,e&&e.portal)}function ES(t,e,r=lR.YES){if(t==null)return t;!uu(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=iu(t);if(e){const n=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(n){const s=K7(n,e.portal),o=K7(i,e.portal);i=n6(o,s,s),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=L1e(i,e==null?void 0:e.portal),uu(i)&&(i=_g(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!uu(i)&&!im(i)&&r===lR.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function KY(t,e,r){return nw(t,r)}function sw(t,e,r,i){const n=ES(t,i);n!==void 0&&(e[r]=n)}const I1e=/\/items\/([^\/]+)\/resources\/(.*)/,uze=/^\.\/resources\//;function hze(t){const e=(t==null?void 0:t.match(I1e))??null;return(e==null?void 0:e[1])??null}function dze(t){const e=(t==null?void 0:t.match(I1e))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=Dte(r);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=Dte(r.slice(i+1));return{prefix:r.slice(0,i),filename:n,extension:s}}function L1e(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?LV(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function K7(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=FX();return gS(i,`${i.scheme}://${r}`)?LV(t,e.portalHostname,r):LV(t,r,e.portalHostname)}var lR;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(lR||(lR={}));const $At=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return lR},ensureMainOnlineDomain:L1e,fromJSON:nw,itemIdFromResourceUrl:hze,prefixAndFilenameFromResourceUrl:dze,read:KY,toJSON:ES,write:sw},Symbol.toStringTag,{value:"Module"}));var eG;const pze=Oc()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let gv=eG=class extends ke{constructor(t){super(t)}readHref(t,e,r){return t?nw(t,r):e.dataURI}writeHref(t,e,r,i){t&&(im(t)?e.dataURI=t:(e.href=ES(t,i),uu(e.href)&&(e.href=_g(e.href))))}clone(){return new eG({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],gv.prototype,"href",void 0),h([lr("href")],gv.prototype,"readHref",null),h([xr("href",{href:{type:String},dataURI:{type:String}})],gv.prototype,"writeHref",null),h([Vt(pze)],gv.prototype,"primitive",void 0),gv=eG=h([N("esri.symbols.support.IconSymbol3DLayerResource")],gv);const fze="circle";var tG;let nT=tG=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new tG({x:this.x,y:this.y})}};h([f({type:Number})],nT.prototype,"x",void 0),h([f({type:Number})],nT.prototype,"y",void 0),nT=tG=h([N("esri.symbols.support.Symbol3DAnchorPosition2D")],nT);var rG;let C3=rG=class extends ke{constructor(t){super(t),this.color=new it([0,0,0,1]),this.size=up(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new rG(t)}};h([f(Jg)],C3.prototype,"color",void 0),h([f(qf)],C3.prototype,"size",void 0),C3=rG=h([N("esri.symbols.support.Symbol3DIconOutline")],C3);var f2;const D1e="esri.symbols.IconSymbol3DLayer";let Qp=f2=class extends om{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new f2({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||qA,r=Gre(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||qA).clone()}:null;return new f2({size:t.size,resource:{primitive:gze(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||q9e(t.color)?qA:t.color,r=Gre(t);return new f2({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new f2({resource:{href:g0e({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function Gre(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=jre(t.xoffset),n=jre(t.yoffset);return(i||n)&&e&&r?{x:-i/e,y:n/r}:null}function jre(t){return isFinite(t)?t:0}h([f({type:du,json:{write:!0}})],Qp.prototype,"material",void 0),h([f({type:gv,json:{write:!0}})],Qp.prototype,"resource",void 0),h([Vt({Icon:"icon"},{readOnly:!0})],Qp.prototype,"type",void 0),h([f(qf)],Qp.prototype,"size",void 0),h([Vt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],Qp.prototype,"anchor",void 0),h([f({type:nT,json:{type:[Number],read:{reader:t=>new nT({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Qp.prototype,"anchorPosition",void 0),h([f({type:C3,json:{write:!0}})],Qp.prototype,"outline",void 0),Qp=f2=h([N(D1e)],Qp);const mze={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function gze(t){return mze[t]||(J.getLogger(D1e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const i_=Qp;let yv=class extends Cu(ke){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};h([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],yv.prototype,"type",void 0),h([f({type:z9e,json:{default:"begin-end",write:!0}})],yv.prototype,"placement",void 0),h([f({type:_1e,json:{default:"arrow",write:!0}})],yv.prototype,"style",void 0),h([f({type:it,json:{type:[mn],default:null,write:!0}})],yv.prototype,"color",void 0),yv=h([N("esri.symbols.LineStyleMarker3D")],yv);const iG=yv;var hD;let Jp=hD=class extends om{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=up(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new hD(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??up(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new XY({style:t.style}):null,material:new du({color:(t.color||qA).clone()}),marker:t.marker?new iG({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new hD(e)}};h([f({type:du,json:{write:!0}})],Jp.prototype,"material",void 0),h([Vt({Line:"line"},{readOnly:!0})],Jp.prototype,"type",void 0),h([f({type:R1e,json:{write:!0,default:"miter"}})],Jp.prototype,"join",void 0),h([f({type:JY,json:{write:!0,default:"butt"}})],Jp.prototype,"cap",void 0),h([f(qf)],Jp.prototype,"size",void 0),h([f(T1e)],Jp.prototype,"pattern",void 0),h([f({types:{key:"type",base:iG,typeMap:{style:iG}},json:{write:!0}})],Jp.prototype,"marker",void 0),Jp=hD=h([N("esri.symbols.LineSymbol3DLayer")],Jp);const TP=Jp;var nG;const yze=Oc()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let A3=nG=class extends ke{clone(){return new nG({href:this.href,primitive:this.primitive})}};h([f({type:String,json:{read:KY,write:sw}})],A3.prototype,"href",void 0),h([Vt(yze)],A3.prototype,"primitive",void 0),A3=nG=h([N("esri.symbols.support.ObjectSymbol3DLayerResource")],A3);const N1e="sphere";var sG;let Zv=sG=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new sG({x:this.x,y:this.y,z:this.z})}};h([f({type:Number})],Zv.prototype,"x",void 0),h([f({type:Number})],Zv.prototype,"y",void 0),h([f({type:Number})],Zv.prototype,"z",void 0),Zv=sG=h([N("esri.symbols.support.Symbol3DAnchorPosition3D")],Zv);var oG;let Ra=oG=class extends om{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new oG({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};h([f({type:du,json:{write:!0}})],Ra.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ra.prototype,"castShadows",void 0),h([f({type:A3,json:{write:!0}})],Ra.prototype,"resource",void 0),h([Vt({Object:"object"},{readOnly:!0})],Ra.prototype,"type",void 0),h([f({type:Number,json:{write:!0}})],Ra.prototype,"width",void 0),h([f({type:Number,json:{write:!0}})],Ra.prototype,"height",void 0),h([f({type:Number,json:{write:!0}})],Ra.prototype,"depth",void 0),h([Vt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],Ra.prototype,"anchor",void 0),h([f({type:Zv,json:{type:[Number],read:{reader:t=>new Zv({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ra.prototype,"anchorPosition",void 0),h([f({type:Number,json:{write:!0}})],Ra.prototype,"heading",void 0),h([f({type:Number,json:{write:!0}})],Ra.prototype,"tilt",void 0),h([f({type:Number,json:{write:!0}})],Ra.prototype,"roll",void 0),h([f({readOnly:!0})],Ra.prototype,"isPrimitive",null),Ra=oG=h([N("esri.symbols.ObjectSymbol3DLayer")],Ra);const eZ=Ra;var aG;let dl=aG=class extends om{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new aG({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};h([f({type:du,json:{write:!0}})],dl.prototype,"material",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],dl.prototype,"castShadows",void 0),h([Vt({Path:"path"},{readOnly:!0})],dl.prototype,"type",void 0),h([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],dl.prototype,"profile",void 0),h([f({type:R1e,json:{write:!0,default:"miter"}})],dl.prototype,"join",void 0),h([f({type:nze,json:{write:!0,default:"butt"}})],dl.prototype,"cap",void 0),h([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],dl.prototype,"width",void 0),h([lr("width",["width","size","height"])],dl.prototype,"readWidth",null),h([f({type:Number,json:{write:!0}})],dl.prototype,"height",void 0),h([lr("height",["height","size","width"])],dl.prototype,"readHeight",null),h([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],dl.prototype,"anchor",void 0),h([f({type:["heading","all"],json:{write:!0,default:"all"}})],dl.prototype,"profileRotation",void 0),dl=aG=h([N("esri.symbols.PathSymbol3DLayer")],dl);const tZ=dl;var lG;let sT=lG=class extends ke{constructor(){super(...arguments),this.color=new it([0,0,0,1]),this.size=0}clone(){const t={color:ye(this.color),size:this.size};return new lG(t)}};h([f(Jg)],sT.prototype,"color",void 0),h([f(qf)],sT.prototype,"size",void 0),sT=lG=h([N("esri.symbols.support.Symbol3DHalo")],sT);let YA=class extends Cu(ke){constructor(e){super(e),this.color=null}};h([f(Jg)],YA.prototype,"color",void 0),YA=h([N("esri.symbols.support.Symbol3DTextBackground")],YA);var dD;let Wl=dD=class extends om{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const n={...i,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new dD({enabled:this.enabled,font:this.font&&ye(this.font),halo:this.halo&&ye(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ye(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new dD({font:t.font!=null?t.font.clone():new T6,halo:_ze(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new du({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new YA({color:t.backgroundColor.clone()}):null})}};function _ze(t,e){return t&&e!=null&&e>0?new sT({color:ye(t),size:e}):null}h([f({type:T6,json:{write:!0}})],Wl.prototype,"font",null),h([xr("font")],Wl.prototype,"writeFont",null),h([f({type:sT,json:{write:!0}})],Wl.prototype,"halo",void 0),h([f({...M1e,json:{default:"center",write:!0}})],Wl.prototype,"horizontalAlignment",void 0),h([f({...P1e,json:{default:1,write:!0}})],Wl.prototype,"lineHeight",void 0),h([f({type:du,json:{write:!0}})],Wl.prototype,"material",void 0),h([f({type:YA,json:{write:!0}})],Wl.prototype,"background",void 0),h([f(qf)],Wl.prototype,"size",null),h([f({type:String,json:{write:!0}})],Wl.prototype,"text",void 0),h([Vt({Text:"text"},{readOnly:!0})],Wl.prototype,"type",void 0),h([f({...$1e,json:{default:"baseline",write:!0}})],Wl.prototype,"verticalAlignment",void 0),Wl=dD=h([N("esri.symbols.TextSymbol3DLayer")],Wl);const Uw=Wl;var cG;let sy=cG=class extends om{constructor(t){super(t),this.color=uG.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new cG({color:ye(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};h([f({type:it,nonNullable:!0,json:{type:[mn],write:(t,e,r)=>e[r]=t.toArray(it.AlphaMode.UNLESS_OPAQUE),default:()=>uG.clone(),defaultEquals:t=>t.toCss(!0)===uG.toCss(!0)}})],sy.prototype,"color",void 0),h([Vt({Water:"water"},{readOnly:!0})],sy.prototype,"type",void 0),h([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],sy.prototype,"waterbodySize",void 0),h([f({type:Number,json:{write:!0,default:null}})],sy.prototype,"waveDirection",void 0),h([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],sy.prototype,"waveStrength",void 0),sy=cG=h([N("esri.symbols.WaterSymbol3DLayer")],sy);const uG=new it([0,119,190]),F1e=sy;var hG;let _v=hG=class extends xe{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new hG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};h([f({type:String})],_v.prototype,"name",void 0),h([f({type:String})],_v.prototype,"styleUrl",void 0),h([f({type:String})],_v.prototype,"styleName",void 0),h([f({type:Mh})],_v.prototype,"portal",void 0),_v=hG=h([N("esri.symbols.support.StyleOrigin")],_v);const cR=_v;var dG;let Ob=dG=class extends xe{constructor(){super(...arguments),this.url=""}clone(){return new dG({url:this.url})}};h([f({type:String})],Ob.prototype,"url",void 0),Ob=dG=h([N("esri.symbols.support.Thumbnail")],Ob);const U1e={icon:i_,object:eZ,line:TP,path:tZ,fill:Fw,extrude:y1e,text:Uw,water:F1e},vze=ir.ofType({base:om,key:"type",typeMap:U1e,errorContext:"symbol-layer"});let Kp=class extends Rc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||ir;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&J.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){qb(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const n=nw(e.styleUrl,i);return new cR({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new cR({portal:i&&i.portal||Mh.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new D_("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,n){if(e.styleUrl&&e.name){let s=ES(e.styleUrl,n);uu(s)&&(s=_g(s)),r.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n&&n.portal&&!U4e(e.portal.restUrl,n.portal.restUrl)?n&&n.messages&&n.messages.push(new D_("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof om||e&&U1e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};h([f({json:{read:!1,write:!1}})],Kp.prototype,"color",null),h([f({type:vze,nonNullable:!0,json:{write:!0}}),_i(o0e)],Kp.prototype,"symbolLayers",null),h([f({type:cR})],Kp.prototype,"styleOrigin",void 0),h([lr("styleOrigin")],Kp.prototype,"readStyleOrigin",null),h([xr("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Kp.prototype,"writeStyleOrigin",null),h([f({type:Ob,json:{read:!1}})],Kp.prototype,"thumbnail",void 0),h([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Kp.prototype,"type",void 0),Kp=h([N("esri.symbols.Symbol3D")],Kp);const _E=Kp;let O3=class extends ke{constructor(e){super(e),this.visible=!0}clone(){}};h([f({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],O3.prototype,"type",void 0),h([f({readOnly:!0})],O3.prototype,"visible",void 0),O3=h([N("esri.symbols.callouts.Callout3D")],O3);const k1e=O3;var pG;let pD=pG=class extends ke{constructor(){super(...arguments),this.color=new it("white")}clone(){return new pG({color:ye(this.color)})}};h([f(Jg)],pD.prototype,"color",void 0),pD=pG=h([N("esri.symbols.callouts.LineCallout3DBorder")],pD);const z1e=pD;Object.freeze(Object.defineProperty({__proto__:null,default:z1e},Symbol.toStringTag,{value:"Module"}));var fG;let oy=fG=class extends k1e{constructor(t){super(t),this.type="line",this.color=new it([0,0,0,1]),this.size=up(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new fG({color:ye(this.color),size:this.size,border:ye(this.border)})}};h([Vt({line:"line"},{readOnly:!0})],oy.prototype,"type",void 0),h([f(Jg)],oy.prototype,"color",void 0),h([f(qf)],oy.prototype,"size",void 0),h([f({type:z1e,json:{write:!0}})],oy.prototype,"border",void 0),h([f({readOnly:!0})],oy.prototype,"visible",null),oy=fG=h([N("esri.symbols.callouts.LineCallout3D")],oy);const bze=oy;function rZ(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function B1e(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!rZ(t)}function iZ(t){return t.type==="point-3d"||t.type==="label-3d"}function V1e(t){return t.horizontalAlignment==="center"}const G1e={types:{key:"type",base:k1e,typeMap:{line:bze}},json:{write:!0}};var mG;let m2=mG=class extends ke{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new mG({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};h([f(qf)],m2.prototype,"screenLength",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0,default:0}})],m2.prototype,"minWorldLength",void 0),h([f({type:Number,json:{write:!0}})],m2.prototype,"maxWorldLength",void 0),m2=mG=h([N("esri.symbols.support.Symbol3DVerticalOffset")],m2);const j1e=m2;var fD;const H1e=ir.ofType({base:null,key:"type",typeMap:{text:Uw}});let ay=fD=class extends _E{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new H1e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return B1e(this)}hasVisibleVerticalOffset(){return rZ(this)}clone(){return new fD({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail),callout:ye(this.callout),verticalOffset:ye(this.verticalOffset)})}static fromTextSymbol(t){return new fD({symbolLayers:[Uw.fromTextSymbol(t)]})}};h([f({type:j1e,json:{write:!0}})],ay.prototype,"verticalOffset",void 0),h([f(G1e)],ay.prototype,"callout",void 0),h([f({json:{read:!1,write:!1}})],ay.prototype,"styleOrigin",void 0),h([f({type:H1e})],ay.prototype,"symbolLayers",void 0),h([Vt({LabelSymbol3D:"label-3d"},{readOnly:!0})],ay.prototype,"type",void 0),ay=fD=h([N("esri.symbols.LabelSymbol3D")],ay);const S6=ay;var mD;const W1e=ir.ofType({base:null,key:"type",typeMap:{line:TP,path:tZ}}),wze=ir.ofType({base:null,key:"type",typeMap:{line:TP,path:tZ}});let R3=mD=class extends _E{constructor(t){super(t),this.symbolLayers=new W1e,this.type="line-3d"}clone(){return new mD({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleLineSymbol(t){return new mD({symbolLayers:[TP.fromSimpleLineSymbol(t)]})}};h([f({type:W1e,json:{type:wze}})],R3.prototype,"symbolLayers",void 0),h([Vt({LineSymbol3D:"line-3d"},{readOnly:!0})],R3.prototype,"type",void 0),R3=mD=h([N("esri.symbols.LineSymbol3D")],R3);const E6=R3;let ly=class extends Rc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ly.prototype,"angle",void 0),h([f({type:["simple-marker","picture-marker"],readOnly:!0})],ly.prototype,"type",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],ly.prototype,"xoffset",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],ly.prototype,"yoffset",void 0),h([f({type:Number,cast:t=>t==="auto"?t:gn(t),json:{write:!0}})],ly.prototype,"size",void 0),ly=h([N("esri.symbols.MarkerSymbol")],ly);const q1e=ly;var gD;const X1e=ir.ofType({base:null,key:"type",typeMap:{fill:Fw}});let P3=gD=class extends _E{constructor(t){super(t),this.symbolLayers=new X1e,this.type="mesh-3d"}clone(){return new gD({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleFillSymbol(t){return new gD({symbolLayers:[Fw.fromSimpleFillSymbol(t)]})}};h([f({type:X1e})],P3.prototype,"symbolLayers",void 0),h([Vt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],P3.prototype,"type",void 0),P3=gD=h([N("esri.symbols.MeshSymbol3D")],P3);const vE=P3;function xze(t,e,r){return e.imageData?g0e({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):Y1e(e.url,r)}function Y1e(t,e){var r;return Sze(e)&&!uu(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?s6(e.layer.parsedUrl.path,"images",t):nw(t,e)}function Tze(t,e,r,i){if(im(t)){const n=Xb(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,r&&r.imageData===e.imageData&&r.url&&sw(r.url,e,"url",i)}else sw(t,e,"url",i)}const Z1e={json:{read:{source:["imageData","url"],reader:xze},write:{writer(t,e,r,i){Tze(t,e,this.source,i)}}}},Q1e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=Y1e(e.url,r)),i}}}};function Sze(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var gG;let ju=gG=class extends v1e{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),r!=null&&(n.width=gn(r)),i!=null&&(n.height=gn(i)),n}clone(){const t=new gG({color:ye(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ye(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};h([Vt({esriPFS:"picture-fill"},{readOnly:!0})],ju.prototype,"type",void 0),h([f(Z1e)],ju.prototype,"url",void 0),h([f({type:Number,json:{write:!0}})],ju.prototype,"xscale",void 0),h([f({type:Number,json:{write:!0}})],ju.prototype,"yscale",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],ju.prototype,"width",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],ju.prototype,"height",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],ju.prototype,"xoffset",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],ju.prototype,"yoffset",void 0),h([f(Q1e)],ju.prototype,"source",void 0),ju=gG=h([N("esri.symbols.PictureFillSymbol")],ju);const J1e=ju;var yG;let dd=yG=class extends q1e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=gn(e)),r!=null&&(i.height=gn(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new yG({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ye(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};h([f({json:{write:!1}})],dd.prototype,"color",void 0),h([Vt({esriPMS:"picture-marker"},{readOnly:!0})],dd.prototype,"type",void 0),h([f(Z1e)],dd.prototype,"url",void 0),h([f(Q1e)],dd.prototype,"source",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],dd.prototype,"height",void 0),h([lr("height",["height","size"])],dd.prototype,"readHeight",null),h([f({type:Number,cast:gn,json:{write:!0}})],dd.prototype,"width",void 0),h([f({json:{write:!1}})],dd.prototype,"size",void 0),dd=yG=h([N("esri.symbols.PictureMarkerSymbol")],dd);const C6=dd;var vv;const K1e=ir.ofType({base:null,key:"type",typeMap:{icon:i_,object:eZ,text:Uw}});let bv=vv=class extends _E{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new K1e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return B1e(this)}hasVisibleVerticalOffset(){return rZ(this)}clone(){return new vv({verticalOffset:ye(this.verticalOffset),callout:ye(this.callout),styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new vv({symbolLayers:[i_.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new vv({symbolLayers:[i_.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var i,n;if(((n=(i=t.data)==null?void 0:i.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new vv(r!=null&&r.callout?{symbolLayers:[i_.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[i_.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new vv({symbolLayers:[Uw.fromTextSymbol(t)]})}};h([f({type:j1e,json:{write:!0}})],bv.prototype,"verticalOffset",void 0),h([f(G1e)],bv.prototype,"callout",void 0),h([f({type:K1e,json:{origins:{"web-scene":{write:!0}}}})],bv.prototype,"symbolLayers",void 0),h([Vt({PointSymbol3D:"point-3d"},{readOnly:!0})],bv.prototype,"type",void 0),bv=vv=h([N("esri.symbols.PointSymbol3D")],bv);const n_=bv;var M3;const eve=ir.ofType({base:null,key:"type",typeMap:{extrude:y1e,fill:Fw,icon:i_,line:TP,object:eZ,text:Uw,water:F1e}});let $3=M3=class extends _E{constructor(t){super(t),this.symbolLayers=new eve,this.type="polygon-3d"}clone(){return new M3({styleOrigin:ye(this.styleOrigin),symbolLayers:ye(this.symbolLayers),thumbnail:ye(this.thumbnail)})}static fromJSON(t){const e=new M3;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),i=e.symbolLayers.at(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new M3({symbolLayers:[Fw.fromSimpleFillSymbol(t)]})}};h([f({type:eve,json:{write:!0}})],$3.prototype,"symbolLayers",void 0),h([Vt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],$3.prototype,"type",void 0),$3=M3=h([N("esri.symbols.PolygonSymbol3D")],$3);const SP=$3;var _G;const pk=new zn({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let wv=_G=class extends v1e{constructor(...t){super(...t),this.color=new it([0,0,0,.25]),this.outline=new Lw,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new _G({color:ye(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};h([f()],wv.prototype,"color",void 0),h([f()],wv.prototype,"outline",void 0),h([Vt({esriSFS:"simple-fill"},{readOnly:!0})],wv.prototype,"type",void 0),h([f({type:pk.apiValues,json:{read:pk.read,write:pk.write}})],wv.prototype,"style",void 0),wv=_G=h([N("esri.symbols.SimpleFillSymbol")],wv);const nZ=wv;var vG;const fk=new zn({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let ef=vG=class extends q1e{constructor(...t){super(...t),this.color=new it([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Lw}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=gn(e)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new vG({angle:this.angle,color:ye(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};h([f()],ef.prototype,"color",void 0),h([xr("color")],ef.prototype,"writeColor",null),h([Vt({esriSMS:"simple-marker"},{readOnly:!0})],ef.prototype,"type",void 0),h([f()],ef.prototype,"size",void 0),h([f({type:fk.apiValues,json:{read:fk.read,write:fk.write}})],ef.prototype,"style",void 0),h([f({type:String,json:{write:!0}})],ef.prototype,"path",null),h([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Lw}},json:{default:null,write:!0}})],ef.prototype,"outline",void 0),ef=vG=h([N("esri.symbols.SimpleMarkerSymbol")],ef);const A6=ef;var bG;let wn=bG=class extends Rc{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new T6,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return gn(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new bG({angle:this.angle,backgroundColor:ye(this.backgroundColor),borderLineColor:ye(this.borderLineColor),borderLineSize:this.borderLineSize,color:ye(this.color),font:this.font&&this.font.clone(),haloColor:ye(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};h([f({type:it,json:{write:!0}})],wn.prototype,"backgroundColor",void 0),h([f({type:it,json:{write:!0}})],wn.prototype,"borderLineColor",void 0),h([f({type:Number,json:{write:!0},cast:gn})],wn.prototype,"borderLineSize",void 0),h([f({type:T6,json:{write:!0}})],wn.prototype,"font",void 0),h([f({...M1e,json:{write:!0}})],wn.prototype,"horizontalAlignment",void 0),h([f({type:Boolean,json:{write:!0}})],wn.prototype,"kerning",void 0),h([f({type:it,json:{write:!0}})],wn.prototype,"haloColor",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],wn.prototype,"haloSize",void 0),h([f({type:Boolean,json:{write:!0}})],wn.prototype,"rightToLeft",void 0),h([f({type:Boolean,json:{write:!0}})],wn.prototype,"rotated",void 0),h([f({type:String,json:{write:!0}})],wn.prototype,"text",void 0),h([Vt({esriTS:"text"},{readOnly:!0})],wn.prototype,"type",void 0),h([f({...$1e,json:{write:!0}})],wn.prototype,"verticalAlignment",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],wn.prototype,"xoffset",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],wn.prototype,"yoffset",void 0),h([f({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],wn.prototype,"angle",void 0),h([f({type:Number,json:{write:!0}})],wn.prototype,"width",void 0),h([f({type:Number})],wn.prototype,"lineWidth",void 0),h([xr("lineWidth")],wn.prototype,"writeLineWidth",null),h([_i("lineWidth")],wn.prototype,"castLineWidth",null),h([f(P1e)],wn.prototype,"lineHeight",void 0),h([xr("lineHeight")],wn.prototype,"writeLineHeight",null),wn=bG=h([N("esri.symbols.TextSymbol")],wn);const EP=wn;var wG;let pd=wG=class extends Rc{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Mh.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new wG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:n}=await ce(()=>Promise.resolve().then(()=>cht),void 0);Bt(e);const s=n(this,{portal:this.portal},t,e);s.catch(a=>{J.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};h([f({json:{write:!1}})],pd.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],pd.prototype,"styleName",void 0),h([f({type:Mh,json:{write:!1}})],pd.prototype,"portal",void 0),h([f({type:String,json:{read:KY,write:sw}})],pd.prototype,"styleUrl",void 0),h([f({type:Ob,json:{read:!1}})],pd.prototype,"thumbnail",void 0),h([f({type:String,json:{write:!0}})],pd.prototype,"name",void 0),h([Vt({styleSymbolReference:"web-style"},{readOnly:!0})],pd.prototype,"type",void 0),h([f()],pd.prototype,"_fetchCacheKey",null),pd=wG=h([N("esri.symbols.WebStyleSymbol")],pd);const bE=pd;function O6(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function ow(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const FT={base:Rc,key:"type",typeMap:{"simple-fill":nZ,"picture-fill":J1e,"picture-marker":C6,"simple-line":Lw,"simple-marker":A6,text:EP,"label-3d":S6,"line-3d":E6,"mesh-3d":vE,"point-3d":n_,"polygon-3d":SP,"web-style":bE,cim:xP},errorContext:"symbol"},UAt={base:Rc,key:"type",typeMap:{"picture-marker":C6,"simple-marker":A6,text:EP,"web-style":bE,cim:xP},errorContext:"symbol"},Eze=PX({types:FT}),Cze={base:Rc,key:"type",typeMap:{"simple-fill":nZ,"picture-fill":J1e,"picture-marker":C6,"simple-line":Lw,"simple-marker":A6,text:EP,"line-3d":E6,"mesh-3d":vE,"point-3d":n_,"polygon-3d":SP,"web-style":bE,cim:xP},errorContext:"symbol"},kAt={base:Rc,key:"type",typeMap:{text:EP,"label-3d":S6},errorContext:"symbol"},Hre={base:Rc,key:"type",typeMap:{"line-3d":E6,"mesh-3d":vE,"point-3d":n_,"polygon-3d":SP,"web-style":bE,cim:xP},errorContext:"symbol"},zAt={base:Rc,key:"type",typeMap:{"label-3d":S6},errorContext:"symbol"},BAt=L_(FT);var xG;function Aze(t){if(!t)return null;const e={};for(const r in t){const i=oR(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function Oze(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let ql=xG=class extends Cu(ke){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:wc(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new xG({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:Oze(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(n.action=i),t==="attributes"&&(n.attributeName=i),this.layer.graphicChanged(n)}};h([f({value:null,json:{read:Aze}})],ql.prototype,"aggregateGeometries",null),h([f({value:null})],ql.prototype,"attributes",null),h([f({value:null,types:OY,json:{read:oR}})],ql.prototype,"geometry",null),h([f({type:Boolean})],ql.prototype,"isAggregate",void 0),h([f({clonable:"reference"})],ql.prototype,"layer",void 0),h([f({type:I9e})],ql.prototype,"popupTemplate",void 0),h([f({clonable:"reference"})],ql.prototype,"sourceLayer",void 0),h([f({value:null,types:FT})],ql.prototype,"symbol",null),h([f({type:Boolean,value:!0})],ql.prototype,"visible",null),ql=xG=h([N("esri.Graphic")],ql),function(t){t.generateUID=wc}(ql||(ql={}));const z_=ql;var TG;let cy=TG=class extends ke{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new TG({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function mk(){return{enabled:!this.camera}}h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:mk}}}}})],cy.prototype,"rotation",void 0),h([_i("rotation")],cy.prototype,"castRotation",null),h([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:mk}}}}})],cy.prototype,"scale",void 0),h([f({types:OY,json:{read:oR,write:!0,origins:{"web-scene":{read:oR,write:{overridePolicy:mk}}}}})],cy.prototype,"targetGeometry",void 0),h([f({type:vu,json:{write:!0}})],cy.prototype,"camera",void 0),cy=TG=h([N("esri.Viewpoint")],cy);const hp=cy;function R6(t){return typeof t=="string"?document.getElementById(t):t??null}function tve(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function Wre(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function qre(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function ue(t,e,r={}){return sZ(t,e,r,rve)}function Dh(t,e,r={}){return sZ(t,e,r,ive)}function sZ(t,e,r={},i){let n=null;const s=r.once?(o,a)=>{i(o)&&(Pi(n),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(n=_Ne(t,s,r.sync,r.equals),r.initial){const o=t();s(o,o)}return n}function Ol(t,e,r,i={}){let n=null,s=null,o=null;function a(){var u;n&&s&&(s.remove(),(u=i.onListenerRemove)==null||u.call(i,n),n=null,s=null)}function l(u){i.once&&i.once&&Pi(o),r(u)}const c=ue(t,(u,d)=>{var p;a(),ZF(u)&&(n=u,s=dP(u,e,l),(p=i.onListenerAdd)==null||p.call(i,u))},{sync:i.sync,initial:!0});return o=Za(()=>{c.remove(),a()}),o}function uR(t,e){return Rze(t,ive,e)}function Rze(t,e,r){if(ss(r))return Promise.reject(wr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let n=null;function s(){n=Pi(n)}return new Promise((o,a)=>{n=dS([pa(r,()=>{s(),a(wr())}),sZ(t,l=>{s(),o(l)},{sync:!1,once:!0},e??rve)])})}function rve(t){return!0}function ive(t){return!!t}const Br={sync:!0},Pr={initial:!0},An={sync:!0,initial:!0};let SG=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new e6,this._items=new Set}get length(){return Ht(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Ht(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Ht(this._observable),yield*this._items}};const Pze={statsWorker:()=>ce(()=>import("./statsWorker-99ee7c16.js"),["assets/statsWorker-99ee7c16.js","assets/heatmapUtils-327ef4c5.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js"]),geometryEngineWorker:()=>ce(()=>import("./geometryEngineWorker-f6bc8d39.js"),["assets/geometryEngineWorker-f6bc8d39.js","assets/geometryEngineJSON-b173802a.js","assets/geometryEngineBase-324c1c81.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>ce(()=>import("./CSVSourceWorker-51c044a2.js"),["assets/CSVSourceWorker-51c044a2.js","assets/json-48e3ea08.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FieldsIndex-f79a8f26.js","assets/number-e5825aa4.js","assets/clientSideDefaults-ab04bd90.js","assets/defaultsJSON-59981e75.js"]),EdgeProcessingWorker:()=>ce(()=>import("./EdgeProcessingWorker-615066a5.js"),[]),ElevationSamplerWorker:()=>ce(()=>import("./ElevationSamplerWorker-d53250c9.js"),["assets/ElevationSamplerWorker-d53250c9.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js"]),FeatureServiceSnappingSourceWorker:()=>ce(()=>import("./FeatureServiceSnappingSourceWorker-19fe862a.js"),["assets/FeatureServiceSnappingSourceWorker-19fe862a.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FieldsIndex-f79a8f26.js","assets/Query-1c961d4c.js","assets/symbologySnappingCandidates-816beafe.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/query-93c6e211.js","assets/queryZScale-8f9616ff.js"]),GeoJSONSourceWorker:()=>ce(()=>import("./GeoJSONSourceWorker-555763c3.js"),["assets/GeoJSONSourceWorker-555763c3.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FieldsIndex-f79a8f26.js","assets/geojson-077f67ec.js","assets/clientSideDefaults-ab04bd90.js","assets/defaultsJSON-59981e75.js","assets/sourceUtils-e3b344c8.js"]),LercWorker:()=>ce(()=>import("./LercWorker-aac3e5c8.js"),[]),MemorySourceWorker:()=>ce(()=>import("./MemorySourceWorker-31156e3d.js"),["assets/MemorySourceWorker-31156e3d.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FieldsIndex-f79a8f26.js","assets/clientSideDefaults-ab04bd90.js","assets/defaultsJSON-59981e75.js","assets/sourceUtils-e3b344c8.js"]),PBFDecoderWorker:()=>ce(()=>import("./PBFDecoderWorker-113e9c75.js"),["assets/PBFDecoderWorker-113e9c75.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js"]),Pipeline:()=>ce(()=>import("./Pipeline-98b9d349.js").then(t=>t.P),["assets/Pipeline-98b9d349.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FieldsIndex-f79a8f26.js","assets/StreamFeatureManager-4b8ac3ac.js","assets/quickselect-e80674f5.js","assets/diffUtils-590c9088.js","assets/arcadeTimeUtils-e1438cc8.js","assets/centroid-8e8cfa47.js","assets/ogcFeatureUtils-1ccf1f8d.js","assets/geojson-077f67ec.js","assets/clientSideDefaults-ab04bd90.js","assets/defaultsJSON-59981e75.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/Query-1c961d4c.js","assets/createConnection-4b117798.js","assets/definitions-0bc08d4c.js","assets/TileInfoView-346e56d0.js","assets/number-e491b09e.js","assets/geohashUtils-77d8429b.js"]),PointCloudWorker:()=>ce(()=>import("./PointCloudWorker-68a2e657.js"),["assets/PointCloudWorker-68a2e657.js","assets/PointCloudWorkerUtil-ec4f2005.js","assets/PointCloudUniqueValueRenderer-df78a172.js","assets/I3SBinaryReader-2b8e30f7.js"]),RasterWorker:()=>ce(()=>import("./RasterWorker-cd959d79.js"),["assets/RasterWorker-cd959d79.js","assets/dataUtils-69946c3c.js","assets/colorUtils-c0f43caf.js","assets/utils-12672bd4.js","assets/rasterProjectionHelper-072edec4.js"]),SceneLayerSnappingSourceWorker:()=>ce(()=>import("./SceneLayerSnappingSourceWorker-3df2f794.js"),[]),SceneLayerWorker:()=>ce(()=>import("./SceneLayerWorker-e92c2264.js").then(t=>t.a),["assets/SceneLayerWorker-e92c2264.js","assets/I3SNode-2025159f.js"]),WFSSourceWorker:()=>ce(()=>import("./WFSSourceWorker-1db6d954.js"),["assets/WFSSourceWorker-1db6d954.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FieldsIndex-f79a8f26.js","assets/geojson-077f67ec.js","assets/sourceUtils-e3b344c8.js","assets/wfsUtils-372b3e59.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>ce(()=>import("./WorkerTileHandler-fcaca023.js"),["assets/WorkerTileHandler-fcaca023.js","assets/TileClipper-ae6eca9e.js","assets/StyleRepository-2362164f.js","assets/colorUtils-c0f43caf.js","assets/definitions-0bc08d4c.js","assets/Rect-98da58d6.js","assets/pbf-d9aa3914.js","assets/TurboLine-aac2edf4.js","assets/BidiEngine-9a40f2f4.js"])};var Lo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Lo||(Lo={}));let Mze=0;function nve(){return Mze++}function $ze(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function hR(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function oZ(t,e,r,i){if(e.type===Lo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Lo.INVOKE&&e.type!==Lo.RESPONSE)return void t.postMessage(e);let n;if($ze(r)?(n=Xre(r.transferList),e.data=r.result):(n=Xre(i),e.data=r),n){if(se("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Lo.INVOKE:throw o;case Lo.RESPONSE:return void oZ(t,{type:Lo.RESPONSE,jobId:e.jobId,error:hR(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function dR(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Xre(t){if(!t||!t.length)return null;if(se("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!Ize(r));return e.length?e:null}function Ize(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}const{CLOSE:Yre,ABORT:Zre,INVOKE:Qre,RESPONSE:sC,OPEN_PORT:Jre,ON:Lze}=Lo,Dze=2;let Nze=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Lo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},B_=class g2{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new g2(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=n),g2.clients.set(n,i),r.port2}static loadWorker(e){const r=Pze[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new Nze(n=>this._onInvokeMessage(n)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:Yre}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const n=i==null?void 0:i.signal,s=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new Y("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=nve();return new Promise((a,l)=>{if(ss(n))return this._processWork(),void l(wr());const c=pa(n,()=>{const d=this._outJobs.get(o);d&&(this._outJobs.delete(o),this._processWork(),Pi(d.abortHandle),this._post({type:Zre,jobId:o}),l(wr()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:Qre,jobId:o,methodName:e,abortable:n!=null},r,s)})}on(e,r){const i=new MessageChannel;function n(s){r(s.data)}return this._port.postMessage({type:Lo.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",n),i.port1.start(),{remove(){i.port1.postMessage({type:Lo.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",n)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Jre,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=Dze)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:n,resolver:s}=e;this.invoke(r,i,n).then(o=>s.resolve(o)).catch(o=>s.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Pi(e.abortHandle),e.reject(wr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=dR(e);if(r)switch(r.type){case sC:this._onResponseMessage(r);break;case Qre:this._invokeQueue.push(r);break;case Zre:this._onAbortMessage(r);break;case Yre:this._onCloseMessage();break;case Jre:this._onOpenPortMessage(r);break;case Lze:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&g2.clients.get(this)===e&&e.destroy(),g2.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const d=r.split(".");for(let p=0;p<d.length-1;p++)c=c[d[p]],u=c[d[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);l=u.call(c,n,{client:this,signal:o?o.signal:null})}catch(d){return void this._post({type:sC,jobId:i,error:hR(d)})}Eu(l)?(a.set(i,{controller:o,promise:l}),l.then(d=>{a.has(i)&&(a.delete(i),this._post({type:sC,jobId:i},d))},d=>{a.has(i)&&(a.delete(i),Zn(d)||this._post({type:sC,jobId:i,error:hR(d||{message:`Error encountered at method ${r}`})}))})):this._post({type:sC,jobId:i},l)}_onOpenPortMessage(e){new g2(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,s=>{r.postMessage(s)}),n=dP(e.port,"message",s=>{const o=dR(s);(o==null?void 0:o.type)===Lo.CLOSE&&(n.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs;if(!s.has(r))return;const o=s.get(r);s.delete(r),this._processWork(),Pi(o.abortHandle),i?o.reject(Y.fromJSON(JSON.parse(i))):o.resolve(n)}_post(e,r,i){return oZ(this._port,e,r,i)}};B_.kernelInfo={buildDate:I0e,fullVersion:JX,revision:L0e},B_.clients=new Map;let Fze=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new SG}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,n)=>{let s=!0;const o=a=>{Bt(r.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Eu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new B_(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new B_(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(wr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,r,i){let n;Array.isArray(i)?(J.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:i}):n=i;const s=Wo();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:n,resolver:s});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return s.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>dS(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(r[n]=s.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const sve=J.getLogger("esri.intl.substitute");function HAt(t,e,r={}){const{format:i={}}=r;return YF(t,n=>Uze(n,e,i))}function Uze(t,e,r){let i,n;const s=t.indexOf(":");if(s===-1?i=t.trim():(i=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!i)return"";const o=uP(i,e);if(o==null)return"";const a=(n?r==null?void 0:r[n]:null)??(r==null?void 0:r[i]);return a?kze(o,a):n?zze(o,n):aZ(o)}function kze(t,e){switch(e.type){case"date":return k_(t,e.intlOptions);case"number":return TS(t,e.intlOptions);default:return sve.warn("missing format descriptor for key {key}"),aZ(t)}}function zze(t,e){switch(e.toLowerCase()){case"dateformat":return k_(t);case"numberformat":return TS(t);default:return sve.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?k_(t):/^numberformat/i.test(e)?TS(t):aZ(t)}}function aZ(t){switch(typeof t){case"string":return t;case"number":return TS(t);case"boolean":return""+t;default:return t instanceof Date?k_(t):""}}async function Bze(t,e,r,i){const n=e.exec(r);if(!n)throw new Y("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=CFe(i),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let u;try{u=await Kre(t(c))}catch(d){if(c===l)throw new Y("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:d});try{u=await Kre(t(l))}catch(p){throw new Y("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function Kre(t){if(eie.fetchBundleAsset!=null)return eie.fetchBundleAsset(t);const e=await kn(t,{responseType:"text"});return JSON.parse(e.data)}let Vze=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let n;n=typeof i=="string"?s=>new URL(s,new URL(i,window.location.href)).href:i instanceof URL?s=>new URL(s,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return Bze(this.getAssetUrl,this.matcher,e,r)}};function Gze(t){return new Vze(t)}const eie={};EFe(Gze({pattern:"esri/",location:Ir}));const jze={};function Hze(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=jze.baseUrl),e}let Wze=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},yD=class{constructor(){this._dispatcher=new Wze,this._workerPostMessage({type:Lo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){pS(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){pS(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=dR(e);if(r&&r.type===Lo.OPEN){const{modulePath:i,jobId:n}=r;let s=await B_.loadWorker(i);s||(s=await ce(()=>import(i),[]));const o=B_.connect(s);this._workerPostMessage({type:Lo.OPENED,jobId:n,data:o})}}};const EG=J.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:qze}=Lo,Xze='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let ZM,QM;const tie="Failed to create Worker. Fallback to execute module in main thread";async function Yze(){if(!se("esri-workers")||(se("mozilla"),0))return rie(new yD);if(!ZM&&!QM)try{const e=Xze.split('"{CONFIGURATION}"').join(`'${Zze()}'`);ZM=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){QM=e||{}}let t;if(ZM)try{t=new Worker(ZM,{name:"esri-worker-"+Qze++})}catch{EG.warn(tie,QM),t=new yD}else EG.warn(tie,QM),t=new yD;return rie(t)}async function rie(t){return new Promise(e=>{function r(n){const s=dR(n);s&&s.type===qze&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(n){n.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),EG.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new yD).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function Zze(){let t;if(Jr.default!=null){const n={...Jr};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(Jr));t.assetsPath=iu(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?iu(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=ep(),t.has={"esri-csp-restrictions":se("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":se("esri-2d-update-debug"),"esri-2d-log-updating":se("esri-2d-log-updating"),"featurelayer-pbf":se("featurelayer-pbf"),"featurelayer-simplify-thresholds":se("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":se("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":se("featurelayer-simplify-mobile-factor"),"esri-atomics":se("esri-atomics"),"esri-shared-array-buffer":se("esri-shared-array-buffer"),"esri-tiles-debug":se("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":se("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":se("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":se("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=iu(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=iu(t.workers.workerPath):t.workers.workerPath=iu(Ir("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Jr.workers.loaderConfig,r=Hze({baseUrl:e==null?void 0:e.baseUrl,locale:ep(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:I0e,fullVersion:JX,revision:L0e}})}let Qze=0;const{ABORT:iie,INVOKE:Jze,OPEN:Kze,OPENED:eBe,RESPONSE:oC}=Lo;let tBe=class ove{static async create(e){const r=await Yze();return new ove(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),J.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,n=nve();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:CX(i,()=>{this._outJobs.delete(n),this._post({type:iie,jobId:n})})};this._outJobs.set(n,a),this._post({type:Kze,jobId:n,modulePath:e})})}_onMessage(e){const r=dR(e);if(r)switch(r.type){case eBe:this._onOpenedMessage(r);break;case oC:this._onResponseMessage(r);break;case iie:this._onAbortMessage(r);break;case Jze:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);n&&(n.controller&&n.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=S5e[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(u){return void this._post({type:oC,jobId:i,error:hR(u)})}Eu(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:oC,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),Zn(u)||this._post({type:oC,jobId:i,error:hR(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:oC,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Pi(n.abortHandle),n.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Pi(s.abortHandle),i?s.reject(Y.fromJSON(JSON.parse(i))):s.resolve(n))}_post(e,r,i){return oZ(this.worker,e,r,i)}};const nie=se("host-browser")?Math.min(navigator.hardwareConcurrency-1,se("workers-pool-size")):0;let fb=se("esri-mobile")?Math.min(nie,3):nie;fb||(fb=se("safari")&&se("mac")?7:2);let sie=0;const _D=[];function rBe(){ave()}async function JM(t,e){const r=new Fze;return await r.open(t,e),r}async function iBe(t,e={}){if(typeof t!="string")throw new Y("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(se("host-webworker")&&!se("esri-workers")&&(r="local"),r==="local"){let i=await B_.loadWorker(t);i||(i=await ce(()=>import(t),[])),Bt(e.signal);const n=e.client||i;return JM([B_.connect(i)],{...e,client:n})}if(await ave(),Bt(e.signal),r==="dedicated"){const i=sie++%fb;return JM([await _D[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,fb);if(i<fb){const n=new Array(i);for(let s=0;s<i;++s){const o=sie++%fb;n[s]=_D[o].open(t,e)}return JM(n,e)}}return JM(_D.map(i=>i.open(t,e)),e)}let KM=null;async function ave(){if(KM)return KM;new AbortController;const t=[];for(let e=0;e<fb;e++){const r=tBe.create(e).then(i=>(_D[e]=i,i));t.push(r)}return KM=Promise.all(t),KM}let Df=class extends xe{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Vi,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,ue)}addWhen(e,r,i={}){return this._installWatch(e,r,i,Dh)}addOnCollectionChange(e,r,{initial:i=!1,final:n=!1}={}){const s=++this._handleId;return this._handles.add([Ol(e,"after-changes",this._createSyncUpdatingCallback(),Br),Ol(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>r({added:[],removed:o.toArray()}):void 0})],s),Za(()=>this._handles.remove(s))}addPromise(e){if(e==null)return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(e$)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},n){const s=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,r,i);return this._handles.add(o,s),Za(()=>this._handles.remove(s))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),n=ue(e,i,{sync:!0,equals:()=>!1});return this._handles.add(n,r),n}_createSyncUpdatingCallback(){return()=>{this._handles.remove(e$),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(pP(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(e$))}),e$)}}};h([f({readOnly:!0})],Df.prototype,"updating",void 0),Df=h([N("esri.core.support.WatchUpdatingTracking")],Df);const e$=-42,P6=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new Vi,this._updatingHandles=new Df}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return h([f({readOnly:!0})],e.prototype,"handles",null),h([f({readOnly:!0})],e.prototype,"updatingHandles",null),e=h([N("esri.core.HandleOwner")],e),e};let pR=class extends P6(xe){};pR=h([N("esri.core.HandleOwner")],pR);let ZA=class extends P6(ir){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ir.ofType(this.itemType.Type))(e):new ir(e)}};function F4(t,e){return{type:t,cast:o0e,set(r){const i=qb(r,this._get(e),t);i.owner=this,this._set(e,i)}}}h([f()],ZA.prototype,"owner",null),ZA=h([N("esri.core.support.OwningCollection")],ZA);var I3;const U4=Oc()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),lve=U4.jsonValues.slice();qO(lve,"orthometric");const QA=Oc()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let fd=I3=class extends ke{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return U4.write(t,e,r)}readHeightModel(t,e,r){return U4.read(t)||(r&&r.messages&&r.messages.push(nBe(t,{context:r})),null)}readHeightUnit(t,e,r){return QA.read(t)||(r&&r.messages&&r.messages.push(oie(t,{context:r})),null)}readHeightUnitService(t,e,r){return R0e(t)||QA.read(t)||(r&&r.messages&&r.messages.push(oie(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new I3({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=g5e(e);return new I3({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new I3;return e.read(t,{origin:"web-scene"}),e}};function oie(t,e){return new D_("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function nBe(t,e){return new D_("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}h([f({type:U4.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:lve,default:"ellipsoidal"}}}})],fd.prototype,"heightModel",void 0),h([xr("web-scene","heightModel")],fd.prototype,"writeHeightModel",null),h([lr(["web-scene","service"],"heightModel")],fd.prototype,"readHeightModel",null),h([f({type:QA.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:QA.jsonValues,write:QA.write}}}})],fd.prototype,"heightUnit",void 0),h([lr("web-scene","heightUnit")],fd.prototype,"readHeightUnit",null),h([lr("service","heightUnit")],fd.prototype,"readHeightUnitService",null),h([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],fd.prototype,"vertCRS",void 0),h([lr("service","vertCRS",["vertCRS","ellipsoid","geoid"])],fd.prototype,"readVertCRS",null),fd=I3=h([N("esri.geometry.HeightModelInfo")],fd);const CP=fd;function In(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function am(t,e,r,i,n,s,o,a,l,c,u,d,p,m,y,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=p,t[12]=m,t[13]=y,t[14]=_,t[15]=v,t}function Nh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Sc(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function wE(t,e){return us(t,e)||Nh(t),t}function us(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],y=e[12],_=e[13],v=e[14],b=e[15],x=r*a-i*o,T=r*l-n*o,S=r*c-s*o,A=i*l-n*a,C=i*c-s*a,R=n*c-s*l,P=u*_-d*y,F=u*v-p*y,k=u*b-m*y,V=d*v-p*_,z=d*b-m*_,X=p*b-m*v;let q=x*X-T*z+S*V+A*k-C*F+R*P;return q?(q=1/q,t[0]=(a*X-l*z+c*V)*q,t[1]=(n*z-i*X-s*V)*q,t[2]=(_*R-v*C+b*A)*q,t[3]=(p*C-d*R-m*A)*q,t[4]=(l*k-o*X-c*F)*q,t[5]=(r*X-n*k+s*F)*q,t[6]=(v*S-y*R-b*T)*q,t[7]=(u*R-p*S+m*T)*q,t[8]=(o*z-a*k+c*P)*q,t[9]=(i*k-r*z-s*P)*q,t[10]=(y*C-_*S+b*x)*q,t[11]=(d*S-u*C-m*x)*q,t[12]=(a*F-o*V-l*P)*q,t[13]=(r*V-i*F+n*P)*q,t[14]=(_*T-y*A-v*x)*q,t[15]=(u*A-d*T+p*x)*q,t):null}function sBe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],y=e[12],_=e[13],v=e[14],b=e[15];return t[0]=a*(p*b-m*v)-d*(l*b-c*v)+_*(l*m-c*p),t[1]=-(i*(p*b-m*v)-d*(n*b-s*v)+_*(n*m-s*p)),t[2]=i*(l*b-c*v)-a*(n*b-s*v)+_*(n*c-s*l),t[3]=-(i*(l*m-c*p)-a*(n*m-s*p)+d*(n*c-s*l)),t[4]=-(o*(p*b-m*v)-u*(l*b-c*v)+y*(l*m-c*p)),t[5]=r*(p*b-m*v)-u*(n*b-s*v)+y*(n*m-s*p),t[6]=-(r*(l*b-c*v)-o*(n*b-s*v)+y*(n*c-s*l)),t[7]=r*(l*m-c*p)-o*(n*m-s*p)+u*(n*c-s*l),t[8]=o*(d*b-m*_)-u*(a*b-c*_)+y*(a*m-c*d),t[9]=-(r*(d*b-m*_)-u*(i*b-s*_)+y*(i*m-s*d)),t[10]=r*(a*b-c*_)-o*(i*b-s*_)+y*(i*c-s*a),t[11]=-(r*(a*m-c*d)-o*(i*m-s*d)+u*(i*c-s*a)),t[12]=-(o*(d*v-p*_)-u*(a*v-l*_)+y*(a*p-l*d)),t[13]=r*(d*v-p*_)-u*(i*v-n*_)+y*(i*p-n*d),t[14]=-(r*(a*v-l*_)-o*(i*v-n*_)+y*(i*l-n*a)),t[15]=r*(a*p-l*d)-o*(i*p-n*d)+u*(i*l-n*a),t}function oBe(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11],m=t[12],y=t[13],_=t[14],v=t[15];return(e*o-r*s)*(d*v-p*_)-(e*a-i*s)*(u*v-p*y)+(e*l-n*s)*(u*_-d*y)+(r*a-i*o)*(c*v-p*m)-(r*l-n*o)*(c*_-d*m)+(i*l-n*a)*(c*y-u*m)}function Vr(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],m=e[10],y=e[11],_=e[12],v=e[13],b=e[14],x=e[15];let T=r[0],S=r[1],A=r[2],C=r[3];return t[0]=T*i+S*a+A*d+C*_,t[1]=T*n+S*l+A*p+C*v,t[2]=T*s+S*c+A*m+C*b,t[3]=T*o+S*u+A*y+C*x,T=r[4],S=r[5],A=r[6],C=r[7],t[4]=T*i+S*a+A*d+C*_,t[5]=T*n+S*l+A*p+C*v,t[6]=T*s+S*c+A*m+C*b,t[7]=T*o+S*u+A*y+C*x,T=r[8],S=r[9],A=r[10],C=r[11],t[8]=T*i+S*a+A*d+C*_,t[9]=T*n+S*l+A*p+C*v,t[10]=T*s+S*c+A*m+C*b,t[11]=T*o+S*u+A*y+C*x,T=r[12],S=r[13],A=r[14],C=r[15],t[12]=T*i+S*a+A*d+C*_,t[13]=T*n+S*l+A*p+C*v,t[14]=T*s+S*c+A*m+C*b,t[15]=T*o+S*u+A*y+C*x,t}function Ml(t,e,r){const i=r[0],n=r[1],s=r[2];if(e===t)t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],d=e[5],p=e[6],m=e[7],y=e[8],_=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=d,t[6]=p,t[7]=m,t[8]=y,t[9]=_,t[10]=v,t[11]=b,t[12]=o*i+u*n+y*s+e[12],t[13]=a*i+d*n+_*s+e[13],t[14]=l*i+p*n+v*s+e[14],t[15]=c*i+m*n+b*s+e[15]}return t}function AP(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function mc(t,e,r,i){let n,s,o,a,l,c,u,d,p,m,y,_,v,b,x,T,S,A,C,R,P,F,k,V,z=i[0],X=i[1],q=i[2],G=Math.sqrt(z*z+X*X+q*q);return G<tl()?null:(G=1/G,z*=G,X*=G,q*=G,n=Math.sin(r),s=Math.cos(r),o=1-s,a=e[0],l=e[1],c=e[2],u=e[3],d=e[4],p=e[5],m=e[6],y=e[7],_=e[8],v=e[9],b=e[10],x=e[11],T=z*z*o+s,S=X*z*o+q*n,A=q*z*o-X*n,C=z*X*o-q*n,R=X*X*o+s,P=q*X*o+z*n,F=z*q*o+X*n,k=X*q*o-z*n,V=q*q*o+s,t[0]=a*T+d*S+_*A,t[1]=l*T+p*S+v*A,t[2]=c*T+m*S+b*A,t[3]=u*T+y*S+x*A,t[4]=a*C+d*R+_*P,t[5]=l*C+p*R+v*P,t[6]=c*C+m*R+b*P,t[7]=u*C+y*R+x*P,t[8]=a*F+d*k+_*V,t[9]=l*F+p*k+v*V,t[10]=c*F+m*k+b*V,t[11]=u*F+y*k+x*V,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function CS(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*i,t[5]=o*n+u*i,t[6]=a*n+d*i,t[7]=l*n+p*i,t[8]=c*n-s*i,t[9]=u*n-o*i,t[10]=d*n-a*i,t[11]=p*n-l*i,t}function M6(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],d=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*i,t[1]=o*n-u*i,t[2]=a*n-d*i,t[3]=l*n-p*i,t[8]=s*i+c*n,t[9]=o*i+u*n,t[10]=a*i+d*n,t[11]=l*i+p*n,t}function AS(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],d=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*i,t[1]=o*n+u*i,t[2]=a*n+d*i,t[3]=l*n+p*i,t[4]=c*n-s*i,t[5]=u*n-o*i,t[6]=d*n-a*i,t[7]=p*n-l*i,t}function OP(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function aBe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ec(t,e,r){if(e===0)return Nh(t);let i,n,s,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<tl()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*i,t[2]=l*o*s-a*i,t[3]=0,t[4]=o*a*s-l*i,t[5]=a*a*s+n,t[6]=l*a*s+o*i,t[7]=0,t[8]=o*l*s+a*i,t[9]=a*l*s-o*i,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function cve(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lBe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uve(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hve(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=i+i,l=n+n,c=s+s,u=i*a,d=i*l,p=i*c,m=n*l,y=n*c,_=s*c,v=o*a,b=o*l,x=o*c;return t[0]=1-(m+_),t[1]=d+x,t[2]=p-b,t[3]=0,t[4]=d-x,t[5]=1-(u+_),t[6]=y+v,t[7]=0,t[8]=p+b,t[9]=y-v,t[10]=1-(u+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function cBe(t,e){const r=uBe,i=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=i*i+n*n+s*s+o*o;return d>0?(r[0]=2*(a*o+u*i+l*s-c*n)/d,r[1]=2*(l*o+u*n+c*i-a*s)/d,r[2]=2*(c*o+u*s+a*n-l*i)/d):(r[0]=2*(a*o+u*i+l*s-c*n),r[1]=2*(l*o+u*n+c*i-a*s),r[2]=2*(c*o+u*s+a*n-l*i)),hve(t,e,r),t}const uBe=O();function CG(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function dve(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function hBe(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function pve(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,u=o+o,d=n*l,p=n*c,m=n*u,y=s*c,_=s*u,v=o*u,b=a*l,x=a*c,T=a*u,S=i[0],A=i[1],C=i[2];return t[0]=(1-(y+v))*S,t[1]=(p+T)*S,t[2]=(m-x)*S,t[3]=0,t[4]=(p-T)*A,t[5]=(1-(d+v))*A,t[6]=(_+b)*A,t[7]=0,t[8]=(m+x)*C,t[9]=(_-b)*C,t[10]=(1-(d+y))*C,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function dBe(t,e,r,i,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,u=o+o,d=a+a,p=s*c,m=s*u,y=s*d,_=o*u,v=o*d,b=a*d,x=l*c,T=l*u,S=l*d,A=i[0],C=i[1],R=i[2],P=n[0],F=n[1],k=n[2],V=(1-(_+b))*A,z=(m+S)*A,X=(y-T)*A,q=(m-S)*C,G=(1-(p+b))*C,Q=(v+x)*C,M=(y+T)*R,I=(v-x)*R,L=(1-(p+_))*R;return t[0]=V,t[1]=z,t[2]=X,t[3]=0,t[4]=q,t[5]=G,t[6]=Q,t[7]=0,t[8]=M,t[9]=I,t[10]=L,t[11]=0,t[12]=r[0]+P-(V*P+q*F+M*k),t[13]=r[1]+F-(z*P+G*F+I*k),t[14]=r[2]+k-(X*P+Q*F+L*k),t[15]=1,t}function pBe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,d=i*a,p=n*o,m=n*a,y=n*l,_=s*o,v=s*a,b=s*l;return t[0]=1-d-y,t[1]=u+b,t[2]=p-v,t[3]=0,t[4]=u-b,t[5]=1-c-y,t[6]=m+_,t[7]=0,t[8]=p+v,t[9]=m-_,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fve(t,e,r,i,n,s,o){const a=1/(r-e),l=1/(n-i),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function fBe(t,e,r,i,n){const s=1/Math.tan(e/2);let o;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t}function mBe(t,e,r,i){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function mve(t,e,r,i,n,s,o){const a=1/(e-r),l=1/(i-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*l,t[14]=(o+s)*c,t[15]=1,t}function $6(t,e,r,i){const n=e[0],s=e[1],o=e[2];let a=n-r[0],l=s-r[1],c=o-r[2];const u=tl();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void Nh(t);let d=1/Math.sqrt(a*a+l*l+c*c);a*=d,l*=d,c*=d;const p=i[0],m=i[1],y=i[2];let _=m*c-y*l,v=y*a-p*c,b=p*l-m*a;d=Math.sqrt(_*_+v*v+b*b),d?(d=1/d,_*=d,v*=d,b*=d):(_=0,v=0,b=0);let x=l*b-c*v,T=c*_-a*b,S=a*v-l*_;d=Math.sqrt(x*x+T*T+S*S),d?(d=1/d,x*=d,T*=d,S*=d):(x=0,T=0,S=0),t[0]=_,t[1]=x,t[2]=a,t[3]=0,t[4]=v,t[5]=T,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*n+v*s+b*o),t[13]=-(x*n+T*s+S*o),t[14]=-(a*n+l*s+c*o),t[15]=1}function gve(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=n-r[0],d=s-r[1],p=o-r[2],m=u*u+d*d+p*p;m>0&&(m=1/Math.sqrt(m),u*=m,d*=m,p*=m);let y=l*p-c*d,_=c*u-a*p,v=a*d-l*u;return m=y*y+_*_+v*v,m>0&&(m=1/Math.sqrt(m),y*=m,_*=m,v*=m),t[0]=y,t[1]=_,t[2]=v,t[3]=0,t[4]=d*v-p*_,t[5]=p*y-u*v,t[6]=u*_-d*y,t[7]=0,t[8]=u,t[9]=d,t[10]=p,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function gBe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function yBe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function _Be(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function yve(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function vBe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function bBe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function lZ(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function I6(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],m=t[11],y=t[12],_=t[13],v=t[14],b=t[15],x=e[0],T=e[1],S=e[2],A=e[3],C=e[4],R=e[5],P=e[6],F=e[7],k=e[8],V=e[9],z=e[10],X=e[11],q=e[12],G=e[13],Q=e[14],M=e[15],I=tl();return Math.abs(r-x)<=I*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-T)<=I*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(n-S)<=I*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-A)<=I*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(o-C)<=I*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(a-R)<=I*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-P)<=I*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(c-F)<=I*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(u-k)<=I*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(d-V)<=I*Math.max(1,Math.abs(d),Math.abs(V))&&Math.abs(p-z)<=I*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(m-X)<=I*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(y-q)<=I*Math.max(1,Math.abs(y),Math.abs(q))&&Math.abs(_-G)<=I*Math.max(1,Math.abs(_),Math.abs(G))&&Math.abs(v-Q)<=I*Math.max(1,Math.abs(v),Math.abs(Q))&&Math.abs(b-M)<=I*Math.max(1,Math.abs(b),Math.abs(M))}function cZ(t){const e=tl(),r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}function L6(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const wBe=Vr,xBe=yve;Object.freeze(Object.defineProperty({__proto__:null,add:_Be,adjoint:sBe,copy:In,determinant:oBe,equals:I6,exactEquals:lZ,frob:yBe,fromQuat:pBe,fromQuat2:cBe,fromRotation:Ec,fromRotationTranslation:hve,fromRotationTranslationScale:pve,fromRotationTranslationScaleOrigin:dBe,fromScaling:aBe,fromTranslation:OP,fromXRotation:cve,fromYRotation:lBe,fromZRotation:uve,frustum:fve,getRotation:hBe,getScaling:dve,getTranslation:CG,hasIdentityRotation:L6,identity:Nh,invert:us,invertOrIdentity:wE,isOrthoNormal:cZ,lookAt:$6,mul:wBe,multiply:Vr,multiplyScalar:vBe,multiplyScalarAndAdd:bBe,ortho:mve,perspective:fBe,perspectiveFromFieldOfView:mBe,rotate:mc,rotateX:CS,rotateY:M6,rotateZ:AS,scale:AP,set:am,str:gBe,sub:xBe,subtract:yve,targetTo:gve,translate:Ml,transpose:Sc},Symbol.toStringTag,{value:"Module"}));let gk,ee=null;function _ve(){return!!ee}function TBe(){return!!se("esri-wasm")}function vve(){return gk||(gk=ce(()=>import("./pe-wasm-5a7d91fb.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>Ir(`esri/geometry/support/${e}`)})).then(t=>{wve(t)}),gk)}var AG,Sn,OG;(function(t){function e(s,o,a){ee.ensureCache.prepare();const l=Qv(a),c=a===l,u=ee.ensureFloat64(l),d=ee._pe_geog_to_proj(ee.getPointer(s),o,u);return d&&Vy(a,o,u,c),d}function r(s,o,a,l){switch(l){case Sn.PE_TRANSFORM_P_TO_G:return i(s,o,a);case Sn.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function i(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){ee.ensureCache.prepare();const c=Qv(a),u=a===c,d=ee.ensureFloat64(c),p=ee._pe_proj_to_geog_center(ee.getPointer(s),o,d,l);return p&&Vy(a,o,d,u),p}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=n})(AG||(AG={})),function(t){function e(){t.PE_BUFFER_MAX=ee.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ee.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ee.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ee.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ee.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ee.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ee.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ee.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ee.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ee.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ee.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ee.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ee.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ee.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ee.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ee.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ee.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ee.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ee.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ee.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=ee.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ee.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ee.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ee.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ee.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ee.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ee.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ee.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ee.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ee.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Sn||(Sn={})),function(t){const e={},r={},i=m=>{if(m){const y=m.getType();switch(y){case Sn.PE_TYPE_GEOGCS:m=ee.castObject(m,ee.PeGeogcs);break;case Sn.PE_TYPE_PROJCS:m=ee.castObject(m,ee.PeProjcs);break;case Sn.PE_TYPE_GEOGTRAN:m=ee.castObject(m,ee.PeGeogtran);break;default:y&Sn.PE_TYPE_UNIT&&(m=ee.castObject(m,ee.PeUnit))}}return m};function n(){ee.PeFactory.prototype.initialize(null)}function s(m){return o(Sn.PE_TYPE_COORDSYS,m)}function o(m,y){let _=null,v=e[m];if(v||(v={},e[m]=v),v.hasOwnProperty(String(y)))_=v[y];else{const b=ee.PeFactory.prototype.factoryByType(m,y);ee.compare(b,ee.NULL)||(_=b,v[y]=_)}return _=i(_),_}function a(m,y){let _=null,v=r[m];if(v||(v={},r[m]=v),v.hasOwnProperty(y))_=v[y];else{const b=ee.PeFactory.prototype.fromString(m,y);ee.compare(b,ee.NULL)||(_=b,v[y]=_)}return _=i(_),_}function l(m){return o(Sn.PE_TYPE_GEOGCS,m)}function c(m){return o(Sn.PE_TYPE_GEOGTRAN,m)}function u(m){return ee.PeFactory.prototype.getCode(m)}function d(m){return o(Sn.PE_TYPE_PROJCS,m)}function p(m){return o(Sn.PE_TYPE_UNIT,m)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=d,t.unit=p}(OG||(OG={}));let bve=null;var k4,RG,PG,MG,z4,$G,B4,V4,IG;function wve(t){function e(s,o,a){s[o]=a(s[o])}ee=t,Sn.init(),k4.init(),z4.init(),B4.init(),V4.init(),bve=class extends ee.PeGCSExtent{destroy(){ee.destroy(this)}};const r=[ee.PeDatum,ee.PeGeogcs,ee.PeGeogtran,ee.PeObject,ee.PeParameter,ee.PePrimem,ee.PeProjcs,ee.PeSpheroid,ee.PeUnit];for(const s of r)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(Sn.PE_NAME_MAX))});for(const s of[ee.PeGeogtran,ee.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(Sn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=ee.getValue(l,"*");a[c]=u?ee.wrapPointer(u,ee.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ee.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return Vy(a,o,s.call(this)),a}),e(ee.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=ee._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!ee.compare(l,ee.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=ee.getPointer(l);for(let d=1;d<c;d++)a.push(ee.wrapPointer(u+o*d,ee.PeGTlistExtendedGTs))}}return a}});const i=ee._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!ee.compare(l,ee.NULL)){a=[l];const c=l.getNump();if(c>1){const u=ee.getPointer(l);for(let d=1;d<c;d++)a.push(ee.wrapPointer(u+i*d,ee.PeHorizon))}}return o.set(s,a),a};e(ee.PeProjcs.prototype,"horizonGcsGenerate",n),e(ee.PeProjcs.prototype,"horizonPcsGenerate",n),ee.PeObject.prototype.toString=function(s=Sn.PE_STR_OPTS_NONE){ee.ensureCache.prepare();const o=ee.getPointer(this),a=ee.ensureInt8(new Array(Sn.PE_BUFFER_MAX));return ee.UTF8ToString(ee._pe_object_to_string_ext(o,s,a))}}function fm(t){if(!t)return;const e=ee.getClass(t);if(!e)return;const r=ee.getCache(e);if(!r)return;const i=ee.getPointer(t);i&&delete r[i]}function t$(t,e){const r=[],i=new Array(e);for(let n=0;n<t;n++)r.push(ee.ensureInt8(i));return r}function Qv(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function Vy(t,e,r,i=!1){if(i)for(let n=0;n<2*e;n++)t[n]=ee.getValue(r+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=ee.getValue(r,"double"),t[s][1]=ee.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=ee.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ee._pe_getPeGTlistExtendedEntrySize()}function i(n,s,o,a,l,c){let u=null;const d=new ee.PeInteger(c);try{const p=ee.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,d);if((c=d.val)&&(u=[p],c>1)){const m=ee.getPointer(p);for(let y=1;y<c;y++)u.push(ee.wrapPointer(m+e*y,ee.PeGTlistExtendedEntry))}}finally{ee.destroy(d)}return u}t.init=r,t.getGTlist=i})(k4||(k4={})),function(t){function e(r){if(r&&r.length){for(const i of r)fm(i),i.getEntries().forEach(n=>{fm(n);const s=n.getGeogtran();fm(s),s.getParameters().forEach(fm),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{fm(o);const a=o.getDatum();fm(a),fm(a.getSpheroid()),fm(o.getPrimem()),fm(o.getUnit())})});ee.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(RG||(RG={})),function(t){function e(r,i,n,s,o){ee.ensureCache.prepare();const a=Qv(n),l=n===a,c=ee.ensureFloat64(a);let u=0;s&&(u=ee.ensureFloat64(s));const d=ee._pe_geog_to_geog(ee.getPointer(r),i,c,u,o);return d&&Vy(n,i,c,l),d}t.geogToGeog=e}(PG||(PG={})),function(t){const e=(c,u,d,p,m,y)=>{let _,v;switch(ee.ensureCache.prepare(),c){case"dd":_=ee._pe_geog_to_dd,v=Sn.PE_DD_MAX;break;case"ddm":_=ee._pe_geog_to_ddm,v=Sn.PE_DDM_MAX;break;case"dms":_=ee._pe_geog_to_dms,v=Sn.PE_DMS_MAX}let b=0;u&&(b=ee.getPointer(u));const x=Qv(p),T=ee.ensureFloat64(x),S=t$(d,v),A=_(b,d,T,m,ee.ensureInt32(S));if(A)for(let C=0;C<d;C++)y[C]=ee.UTF8ToString(S[C]);return A},r=(c,u,d,p,m)=>{let y;switch(ee.ensureCache.prepare(),c){case"dd":y=ee._pe_dd_to_geog;break;case"ddm":y=ee._pe_ddm_to_geog;break;case"dms":y=ee._pe_dms_to_geog}let _=0;u&&(_=ee.getPointer(u));const v=p.map(S=>ee.ensureString(S)),b=ee.ensureInt32(v),x=ee.ensureFloat64(new Array(2*d)),T=y(_,d,b,x);return T&&Vy(m,d,x),T};function i(c,u,d,p,m){return e("dms",c,u,d,p,m)}function n(c,u,d,p){return r("dms",c,u,d,p)}function s(c,u,d,p,m){return e("ddm",c,u,d,p,m)}function o(c,u,d,p){return r("ddm",c,u,d,p)}function a(c,u,d,p,m){return e("dd",c,u,d,p,m)}function l(c,u,d,p){return r("dd",c,u,d,p)}t.geogToDms=i,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(MG||(MG={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ee.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ee.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ee.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(n,s,o,a,l,c,u){ee.ensureCache.prepare();let d=0;n&&(d=ee.getPointer(n));const p=Qv(o),m=ee.ensureFloat64(p),y=t$(s,Sn.PE_MGRS_MAX),_=ee.ensureInt32(y),v=ee._pe_geog_to_mgrs_extended(d,s,m,a,l,c,_);if(v)for(let b=0;b<s;b++)u[b]=ee.UTF8ToString(y[b]);return v}function i(n,s,o,a,l){ee.ensureCache.prepare();let c=0;n&&(c=ee.getPointer(n));const u=o.map(y=>ee.ensureString(y)),d=ee.ensureInt32(u),p=ee.ensureFloat64(new Array(2*s)),m=ee._pe_mgrs_to_geog_extended(c,s,d,a,p);return m&&Vy(l,s,p),m}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(z4||(z4={})),function(t){function e(i,n,s,o,a,l,c){ee.ensureCache.prepare();let u=0;i&&(u=ee.getPointer(i));const d=Qv(s),p=ee.ensureFloat64(d),m=t$(n,Sn.PE_MGRS_MAX),y=ee.ensureInt32(m),_=ee._pe_geog_to_usng(u,n,p,o,a,l,y);if(_)for(let v=0;v<n;v++)c[v]=ee.UTF8ToString(m[v]);return _}function r(i,n,s,o){ee.ensureCache.prepare();let a=0;i&&(a=ee.getPointer(i));const l=s.map(p=>ee.ensureString(p)),c=ee.ensureInt32(l),u=ee.ensureFloat64(new Array(2*n)),d=ee._pe_usng_to_geog(a,n,c,u);return d&&Vy(o,n,u),d}t.geogToUsng=e,t.usngToGeog=r}($G||($G={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ee.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ee.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ee.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(n,s,o,a,l){ee.ensureCache.prepare();let c=0;n&&(c=ee.getPointer(n));const u=Qv(o),d=ee.ensureFloat64(u),p=t$(s,Sn.PE_UTM_MAX),m=ee.ensureInt32(p),y=ee._pe_geog_to_utm(c,s,d,a,m);if(y)for(let _=0;_<s;_++)l[_]=ee.UTF8ToString(p[_]);return y}function i(n,s,o,a,l){ee.ensureCache.prepare();let c=0;n&&(c=ee.getPointer(n));const u=o.map(y=>ee.ensureString(y)),d=ee.ensureInt32(u),p=ee.ensureFloat64(new Array(2*s)),m=ee._pe_utm_to_geog(c,s,d,a,p);return m&&Vy(l,s,p),m}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(B4||(B4={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=ee.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ee.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ee.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ee.PePCSInfo.prototype.PE_POLE_POINT}function i(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=ee.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=r,t.generate=i}(V4||(V4={})),function(t){function e(){return ee.PeVersion.prototype.version_string()}t.versionString=e}(IG||(IG={}));const SBe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return AG},get PeDefs(){return Sn},get PeFactory(){return OG},get PeGCSExtent(){return bve},get PeGTTransformations(){return PG},get PeGTlistExtended(){return k4},get PeGTlistExtendedEntry(){return RG},get PeNotationDms(){return MG},get PeNotationMgrs(){return z4},get PeNotationUsng(){return $G},get PeNotationUtm(){return B4},get PePCSInfo(){return V4},get PeVersion(){return IG},_init:wve,get _pe(){return ee},isLoaded:_ve,isSupported:TBe,load:vve},Symbol.toStringTag,{value:"Module"})),JAt=Math.PI/180,KAt=/SPHEROID\[([^\]]+)]/i,S0=Kt.radius,ed=Kt.eccentricitySquared,EBe={a1:S0*ed,a2:S0*ed*S0*ed,a3:S0*ed*ed/2,a4:S0*ed*S0*ed*2.5,a5:S0*ed+S0*ed*ed/2,a6:1-ed},eOt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Kt.radius,f:Kt.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Fg.radius,f:Fg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:If.radius,f:If.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:If.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let r$=0,yk=class LG{static fromGE(e){const r=new LG;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=r$++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=r$++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=r$++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=r$++}getInverse(){const e=new LG;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},G4=class L3{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new L3;let i="";for(const n of e.steps){const s=yk.fromGE(n);r.steps.push(s),i+=s.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof yk?this.steps.push(r):this.steps.push(new yk({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new L3;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[L3.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const s of this.steps)i+=s.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const n=this._cachedProjection[L3.cacheKey(e,r)];return n===void 0?null:n}};function CBe(t,e,r){if(e==null||r==null||r.vcsWkid||Js(e,r))return null;const i=FV(e)/FV(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>ABe(n,i);case"polyline":case"esriGeometryPolyline":return n=>RBe(n,i);case"polygon":case"esriGeometryPolygon":return n=>OBe(n,i);case"multipoint":case"esriGeometryMultipoint":return n=>PBe(n,i);case"extent":case"esriGeometryEnvelope":return n=>MBe(n,i);default:return null}}function ABe(t,e){t&&t.z!=null&&(t.z*=e)}function OBe(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function RBe(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function PBe(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function MBe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let tp=null,V_=null,JA=null,vD={};const xve=new e6;function D6(){return!!tp&&_ve()}function fR(t){return JA==null&&(JA=Promise.all([vve(),ce(()=>import("./geometryEngineBase-324c1c81.js"),[]).then(e=>e.g),ce(()=>import("./hydrated-c10ab4a5.js"),[])])),JA.then(([,e,{hydratedAdapter:r}])=>{Bt(t),V_=r,tp=e.default,tp._enableProjection(SBe),xve.notify()})}function xE(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:DG(V_,t,t[0].spatialReference,e,r,i):DG(V_,[t],t.spatialReference,e,r,i)[0]}function DG(t,e,r,i,n=null,s=null){if(r==null||i==null)return e;if(Bg(r,i,n))return e.map(o=>uZ(o,r,i));if(n==null){const o=G4.cacheKey(r,i);vD[o]!==void 0?n=vD[o]:((n=Sve(r,i,void 0))==null&&(n=new G4),vD[o]=n)}if(tp==null||t==null)throw new N6;return s!=null?tp._project(t,e,r,i,n,s):tp._project(t,e,r,i,n)}function $Be(t,e){const r=Tve([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function Tve(t,e){if(!D6()){for(const r of t)if(r!=null&&!Js(r.spatialReference,e)&&ua(r.spatialReference)&&ua(e)&&!Bg(r.spatialReference,e))return Ht(xve),{pending:fR(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:Js(r.spatialReference,e)?r:ua(r.spatialReference)&&ua(e)?Eve(r,e):null)}}function Sve(t,e,r=null){if(t==null||e==null)return null;if(tp==null||V_==null)throw new N6;const i=tp._getTransformation(V_,t,e,r,r==null?void 0:r.spatialReference);return i!==null?G4.fromGE(i):null}function IBe(t,e,r=null){if(tp==null||V_==null)throw new N6;const i=tp._getTransformationBySuitability(V_,t,e,r,r==null?void 0:r.spatialReference);if(i!==null){const n=[];for(const s of i)n.push(G4.fromGE(s));return n}return[]}class N6 extends Y{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var W;function LBe(){tp=null,V_=null,JA=null,vD={}}(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(W||(W={}));const DBe={get loadPromise(){return JA}};function Eve(t,e){try{const r=xE(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=CBe(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof N6))throw r;return null}}function Bg(t,e,r){return!r&&(!!Js(t,e)||ua(t)&&ua(e)&&!!fZ(t,e,gZ))}async function NBe(t,e,r,i){if(D6())return vte(i);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(!Bg(n,s,o))return fR(i)}else if(!Bg(t,e,r))return fR(i);return vte(i)}function FBe(t,e){switch(fZ(t,e,gZ)){case Si:return"copy3";case o_:return"wgs84ToSphericalECEF";case aw:return"wgs84ToWebMercator";case s_:return"wgs84ToPlateCarree";case l_:return"wgs84ToWGS84ECEF";case Rb:return"webMercatorToWGS84";case Nve:return"webMercatorToSphericalECEF";case Fve:return"webMercatorToWGS84ECEF";case Uve:return"webMercatorToPlateCarree";case c_:return"wgs84ECEFToWGS84";case Vve:return"wgs84ECEFToSphericalECEF";case Gve:return"wgs84ECEFToWebMercator";case a_:return"sphericalECEFToWGS84";case zve:return"sphericalECEFToWebMercator";case zG:return"sphericalMarsPCPFToMars2000";case kG:return"sphericalMoonPCPFToMoon2000";case Bve:return"sphericalECEFToWGS84ECEF";case UG:return"mars2000ToSphericalPCPF";case FG:return"moon2000ToSphericalPCPF";default:return null}}function uZ(t,e,r){return t?"x"in t?Ave(t,e,new ze,r,0):"xmin"in t?Mve(t,e,new Dr,r,0):"rings"in t?Pve(t,e,new a1,r,0):"paths"in t?Rve(t,e,new m6,r,0):"points"in t?Ove(t,e,new yP,r,0):null:null}function Cve(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&Ave(t,t.spatialReference,e,r,i)!=null}function Ave(t,e,r,i,n){Or[0]=t.x,Or[1]=t.y;const s=t.z;return Or[2]=s!==void 0?s:n,$i(Or,e,0,Or,i,0,1)?(r.x=Or[0],r.y=Or[1],r.spatialReference=i,s===void 0?(r.z=void 0,r.hasZ=!1):(r.z=Or[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function UBe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Ove(t,t.spatialReference,e,r,i)!=null}function Ove(t,e,r,i,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,u=[];for(const d of s)u.push(d[0],d[1],o?d[2]:n);if(!$i(u,e,0,u,i,0,c))return null;for(let d=0;d<c;++d){const p=3*d,m=u[p],y=u[p+1];o&&a?l.push([m,y,u[p+2],s[d][3]]):o?l.push([m,y,u[p+2]]):a?l.push([m,y,s[d][2]]):l.push([m,y])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function kBe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Rve(t,t.spatialReference,e,r,i)!=null}function Rve(t,e,r,i,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];return Lve(s,o??!1,a??!1,e,l,i,n)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function zBe({hasZ:t,spatialReference:e,paths:r},i,n=0){const s=Yf(e,TE),o=wh[s][W.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>ne(Or,l[0],l[1],n);for(const l of r){const c=[];for(const u of l){const d=[0,0,n];o(a(u),0,d,0),c.push(d)}i.push(c)}return!0}function BBe({hasZ:t,spatialReference:e,rings:r},i,n=0){const s=Yf(e,TE),o=wh[s][W.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>ne(Or,l[0],l[1],n);for(const l of r){const c=[];for(const u of l){const d=[0,0,n];o(a(u),0,d,0),c.push(d)}i.push(c)}return!0}function VBe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Pve(t,t.spatialReference,e,r,i)!=null}function Pve(t,e,r,i,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];return Lve(s,o??!1,a??!1,e,l,i,n)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function GBe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&Mve(t,t.spatialReference,e,r,i)!=null}function Mve(t,e,r,i,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t;return NG(s,o,c?t.zmin:n,e,Or,i)?(r.xmin=Or[0],r.ymin=Or[1],c&&(r.zmin=Or[2]),NG(a,l,c?t.zmax:n,e,Or,i)?(r.xmax=Or[0],r.ymax=Or[1],c&&(r.zmax=Or[2]),u&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function Vg(t,e,r){if(e==null||r==null)return null;const i=new ze({spatialReference:r});return $i(t,e,0,Or,r,0,1)?(i.x=Or[0],i.y=Or[1],i.z=Or[2],i):null}function hZ(t,e,r){return $i(t,e,0,Or,r.spatialReference,0,1)?(r.x=Or[0],r.y=Or[1],r.z=Or[2],r):null}function Bi(t,e,r,i=0){Or[0]=t.x,Or[1]=t.y;const n=t.z;return Or[2]=n!==void 0?n:i,$i(Or,t.spatialReference,0,e,r,0,1)}function NG(t,e,r,i,n,s){return en[0]=t,en[1]=e,en[2]=r,$i(en,i,0,n,s,0,1)}function Cs(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(en[0]=t[0],en[1]=t[1],en[2]=0,t=en),$i(t,e,0,r,i,0,1))}function $ve(t,e){Or[0]=t.x,Or[1]=t.y;const r=t.z;return Or[2]=r!==void 0?r:0,Ive(Or,t.spatialReference,e)}function Ive(t,e,r){return jBe(t,e,r)}function jBe(t,e,r){if(e==null)return!1;const i=Yf(e,TE),n=wh[i][W.WGS84_COMPARABLE_LON_LAT];return n!=null&&(n(t,0,en,0),r!==en&&(r[0]=en[0],r[1]=en[1],r.length>2&&(r[2]=en[2])),!0)}function $i(t,e,r,i,n,s,o=1){const a=fZ(e,n,gZ);if(a==null)return!1;if(a===Si){if(t===i&&r===s)return!0;const c=r+3*o;for(let u=r,d=s;u<c;u++,d++)i[d]=t[u];return!0}const l=r+3*o;for(let c=r,u=s;c<l;c+=3,u+=3)a(t,c,i,u);return!0}function HBe(t,e,r,i,n){re(Or,t),oe(i$,t,e),Cs(Or,r,Or,n),Cs(i$,r,i$,n),ae(i,i$,Or),me(i,i)}function Lve(t,e,r,i,n,s,o=0){const a=new Array;for(const c of t)for(const u of c)a.push(u[0],u[1],e?u[2]:o);if(!$i(a,i,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;for(const c of t){const u=new Array;for(const d of c)e&&r?u.push([a[l++],a[l++],a[l++],d[3]]):e?u.push([a[l++],a[l++],a[l++]]):r?(u.push([a[l++],a[l++],d[2]]),l++):(u.push([a[l++],a[l++]]),l++);n.push(u)}return!0}function WBe(t,e,r,i){if(e==null||i==null)return!1;const n=jve(e,i,eVe);if(n.projector===Si)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(n.projector==null)return!1;const{source:s,dest:o}=n;if(o.spatialReferenceId===W.WEB_MERCATOR){const a=wh[s.spatialReferenceId][W.WGS84];return a!=null&&(a(t,0,Pd,0),aw(Pd,0,r,0),r[3]=aie(Pd[1],t[2],t[3],Kt.radius),!0)}if(s.spatialReferenceId!==W.WGS84&&s.spatialReferenceId!==W.CGCS2000||o.spatialReferenceId!==W.PLATE_CARREE){n.projector(t,0,r,0);const a=s.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=wh[s.spatialReferenceId][W.SPHERICAL_ECEF],l=wh[W.SPHERICAL_ECEF][W.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=aie(t[1],t[2],t[3],Kt.radius)),n.projector(t,0,r,0),r[3]=c}return!0}function aie(t,e,r,i){const n=i+e;if(n<i/2||r>n)return Number.MAX_VALUE;const s=Math.abs(Wd*t)+Math.asin(r/n);return s>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(s)}function RP(t,e,r,i){return t!=null&&(Js(e,i)?(Ug(r,t),!0):(en[0]=t[0],en[1]=t[1],en[2]=0,!!$i(en,e,0,en,i,0,1)&&(r[0]=en[0],r[1]=en[1],en[0]=t[2],en[1]=t[3],en[2]=0,!!$i(en,e,0,en,i,0,1)&&(r[2]=en[0],r[3]=en[1],!0))))}function qBe(t,e,r,i){if(e==null||i==null)return!1;const n=Yf(e,TE),s=Yf(i,Hve);if(n===s&&n!==W.UNKNOWN||Js(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(n===W.SPHERICAL_ECEF){const o=Te(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/Kt.radius;if(s===W.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(s===W.WGS84||s===W.CGCS2000){const c=KA;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(n===W.PLATE_CARREE){if(s===W.WGS84||s===W.CGCS2000)return r[0]=KA,r[1]=KA,r[2]=1,!0;if(s===W.WEB_MERCATOR){const o=t[1]/Kt.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function ma(t,e,r,i){if(t==null||i==null)return!1;const n=Yf(t,TE),s=Yf(i,Hve);if(n===s&&!lie(s)&&(n!==W.UNKNOWN||Js(t,i)))return OP(r,e),!0;if(lie(s)){const o=wh[n][W.LON_LAT],a=wh[W.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,Pd,0),a(Pd,0,E0,0),dZ(Wd*Pd[0],Wd*Pd[1],r),r[12]=E0[0],r[13]=E0[1],r[14]=E0[2],!0)}if((s===W.WEB_MERCATOR||s===W.PLATE_CARREE)&&(n===W.WGS84||n===W.CGCS2000&&s===W.PLATE_CARREE||n===W.SPHERICAL_ECEF||n===W.WEB_MERCATOR)){const o=wh[n][W.LON_LAT],a=wh[W.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,Pd,0),a(Pd,0,E0,0),n===W.SPHERICAL_ECEF?Dve(Wd*Pd[0],Wd*Pd[1],r):Nh(r),r[12]=E0[0],r[13]=E0[1],r[14]=E0[2],!0)}return!1}function lie(t){return t===W.SPHERICAL_ECEF||t===W.SPHERICAL_MARS_PCPF||t===W.SPHERICAL_MOON_PCPF}function dZ(t,e,r){const i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Dve(t,e,r){return dZ(t,e,r),Sc(r,r),r}function Yf(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=el(t,1)),t.wkt===E0e.wkt?e.spatialReferenceId=W.SPHERICAL_ECEF:tR(t)?e.spatialReferenceId=W.WGS84:Yb(t)?e.spatialReferenceId=W.WEB_MERCATOR:HX(t)?e.spatialReferenceId=W.PLATE_CARREE:t.wkt===C0e.wkt?e.spatialReferenceId=W.WGS84_ECEF:t.wkid===fh.CGCS2000?e.spatialReferenceId=W.CGCS2000:t.wkt===YX.wkt?e.spatialReferenceId=W.SPHERICAL_MARS_PCPF:t.wkt===ZX.wkt?e.spatialReferenceId=W.SPHERICAL_MOON_PCPF:nm(t)?e.spatialReferenceId=W.GCSMARS2000:sm(t)?e.spatialReferenceId=W.GCSMOON2000:e.spatialReferenceId=W.UNKNOWN):W.UNKNOWN}function Si(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function Rb(t,e,r,i){r[i++]=OS*(t[e++]/Kt.radius),r[i++]=OS*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/Kt.radius))),r[i]=t[e]}function Nve(t,e,r,i){Rb(t,e,r,i),o_(r,i,r,i)}function Fve(t,e,r,i){Rb(t,e,r,i),l_(r,i,r,i)}function F6(t,e,r,i,n){const s=.4999999*Math.PI,o=ge(Wd*t[e+1],-s,s),a=Math.sin(o);r[i++]=Wd*t[e]*n.radius,r[i++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function aw(t,e,r,i){F6(t,e,r,i,Kt)}const cie=Kt.radius*Math.PI/180,KA=180/(Kt.radius*Math.PI);function s_(t,e,r,i){r[i]=t[e]*cie,r[i+1]=t[e+1]*cie,r[i+2]=t[e+2]}function mb(t,e,r,i){r[i]=t[e]*KA,r[i+1]=t[e+1]*KA,r[i+2]=t[e+2]}function Uve(t,e,r,i){Rb(t,e,r,i),s_(r,i,r,i)}function XBe(t,e,r,i){c_(t,e,r,i),s_(r,i,r,i)}function YBe(t,e,r,i){a_(t,e,r,i),s_(r,i,r,i)}function ZBe(t,e,r,i){mb(t,e,r,i),o_(r,i,r,i)}function QBe(t,e,r,i){mb(t,e,r,i),aw(r,i,r,i)}function JBe(t,e,r,i){mb(t,e,r,i),l_(r,i,r,i)}function G_(t){if(t==null)return!1;const e=Yf(t,TE);return!!wh[e][W.WGS84_COMPARABLE_LON_LAT]}function kve(t,e,r,i){const n=Math.cos(r);t[0]=Math.cos(e)*n*i,t[1]=Math.sin(e)*n*i,t[2]=Math.sin(r)*i}function pZ(t,e,r,i,n){const s=n+t[e+2],o=Wd*t[e+1],a=Wd*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*s,r[i++]=Math.sin(a)*l*s,r[i]=Math.sin(o)*s}function FG(t,e,r,i){pZ(t,e,r,i,Fg.radius)}function UG(t,e,r,i){pZ(t,e,r,i,If.radius)}function o_(t,e,r,i){pZ(t,e,r,i,Kt.radius)}function U6(t,e,r,i,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=$h(a/(l===0?1:l)),u=Math.atan2(o,s);r[i++]=OS*u,r[i++]=OS*c,r[i]=l-n}function kG(t,e,r,i){U6(t,e,r,i,Fg.radius)}function zG(t,e,r,i){U6(t,e,r,i,If.radius)}function a_(t,e,r,i){U6(t,e,r,i,Kt.radius)}function zve(t,e,r,i){a_(t,e,r,i),aw(r,i,r,i)}function Bve(t,e,r,i){a_(t,e,r,i),l_(r,i,r,i)}function KBe(t,e,r,i,n){const s=Wd*t[e],o=Wd*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(s),r[i++]=(u+a)*c*Math.sin(s),r[i++]=(u*(1-n.eccentricitySquared)+a)*l}function l_(t,e,r,i){KBe(t,e,r,i,Kt)}function c_(t,e,r,i){const n=EBe,s=t[e],o=t[e+1],a=t[e+2];let l,c,u,d,p,m,y,_,v,b,x,T,S,A,C,R,P,F,k,V,z;l=Math.abs(a),c=s*s+o*o,u=Math.sqrt(c),d=c+a*a,p=Math.sqrt(d),V=Math.atan2(o,s),m=a*a/d,y=c/d,A=n.a2/p,C=n.a3-n.a4/p,y>.3?(_=l/p*(1+y*(n.a1+A+m*C)/p),k=Math.asin(_),b=_*_,v=Math.sqrt(1-b)):(v=u/p*(1-m*(n.a5-A-y*C)/p),k=Math.acos(v),b=1-v*v,_=Math.sqrt(b)),x=1-Kt.eccentricitySquared*b,T=Kt.radius/Math.sqrt(x),S=n.a6*T,A=u-T*v,C=l-S*_,P=v*A+_*C,R=v*C-_*A,F=R/(S/x+P),k+=F,z=P+R*F/2,a<0&&(k=-k),r[i++]=OS*V,r[i++]=OS*k,r[i]=z}function Vve(t,e,r,i){c_(t,e,r,i),o_(r,i,r,i)}function Gve(t,e,r,i){c_(t,e,r,i),aw(r,i,r,i)}const wh={[W.WGS84]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:Si,[W.WGS84_COMPARABLE_LON_LAT]:Si,[W.SPHERICAL_ECEF]:o_,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:aw,[W.PLATE_CARREE]:s_,[W.WGS84]:Si,[W.WGS84_ECEF]:l_},[W.CGCS2000]:{[W.CGCS2000]:Si,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:Si,[W.WGS84_COMPARABLE_LON_LAT]:Si,[W.SPHERICAL_ECEF]:o_,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:s_,[W.WGS84]:null,[W.WGS84_ECEF]:l_},[W.GCSMARS2000]:{[W.CGCS2000]:null,[W.GCSMARS2000]:Si,[W.GCSMOON2000]:null,[W.LON_LAT]:Si,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:UG,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.GCSMOON2000]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:Si,[W.LON_LAT]:Si,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:FG,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.WEB_MERCATOR]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:Rb,[W.WGS84_COMPARABLE_LON_LAT]:Rb,[W.SPHERICAL_ECEF]:Nve,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:Si,[W.PLATE_CARREE]:Uve,[W.WGS84]:Rb,[W.WGS84_ECEF]:Fve},[W.WGS84_ECEF]:{[W.CGCS2000]:c_,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:c_,[W.WGS84_COMPARABLE_LON_LAT]:c_,[W.SPHERICAL_ECEF]:Vve,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:Gve,[W.PLATE_CARREE]:XBe,[W.WGS84]:c_,[W.WGS84_ECEF]:Si},[W.SPHERICAL_ECEF]:{[W.CGCS2000]:a_,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:a_,[W.WGS84_COMPARABLE_LON_LAT]:a_,[W.SPHERICAL_ECEF]:Si,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:zve,[W.PLATE_CARREE]:YBe,[W.WGS84]:a_,[W.WGS84_ECEF]:Bve},[W.SPHERICAL_MARS_PCPF]:{[W.CGCS2000]:null,[W.GCSMARS2000]:zG,[W.GCSMOON2000]:null,[W.LON_LAT]:zG,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:Si,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.SPHERICAL_MOON_PCPF]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:kG,[W.LON_LAT]:kG,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:Si,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.UNKNOWN]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:null,[W.WGS84_COMPARABLE_LON_LAT]:null,[W.SPHERICAL_ECEF]:null,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:Si,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:null,[W.WGS84]:null,[W.WGS84_ECEF]:null},[W.LON_LAT]:{[W.CGCS2000]:Si,[W.GCSMARS2000]:Si,[W.GCSMOON2000]:Si,[W.LON_LAT]:Si,[W.WGS84_COMPARABLE_LON_LAT]:Si,[W.SPHERICAL_ECEF]:o_,[W.SPHERICAL_MARS_PCPF]:UG,[W.SPHERICAL_MOON_PCPF]:FG,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:aw,[W.PLATE_CARREE]:s_,[W.WGS84]:Si,[W.WGS84_ECEF]:l_},[W.WGS84_COMPARABLE_LON_LAT]:{[W.CGCS2000]:null,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:Si,[W.WGS84_COMPARABLE_LON_LAT]:Si,[W.SPHERICAL_ECEF]:o_,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:null,[W.PLATE_CARREE]:s_,[W.WGS84]:Si,[W.WGS84_ECEF]:l_},[W.PLATE_CARREE]:{[W.CGCS2000]:mb,[W.GCSMARS2000]:null,[W.GCSMOON2000]:null,[W.LON_LAT]:mb,[W.WGS84_COMPARABLE_LON_LAT]:mb,[W.SPHERICAL_ECEF]:ZBe,[W.SPHERICAL_MARS_PCPF]:null,[W.SPHERICAL_MOON_PCPF]:null,[W.UNKNOWN]:null,[W.WEB_MERCATOR]:QBe,[W.PLATE_CARREE]:Si,[W.WGS84]:mb,[W.WGS84_ECEF]:JBe}};function fZ(t,e,r=mZ()){return t==null||e==null?null:jve(t,e,r).projector}function jve(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=Yf(t,r.source),n=Yf(e,r.dest);return i===W.UNKNOWN&&n===W.UNKNOWN?Js(t,e)?r.projector=Si:r.projector=null:r.projector=wh[i][n],r}function mZ(){return{source:{spatialReference:null,spatialReferenceId:W.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:W.UNKNOWN,metersPerUnit:1},projector:Si}}const TE={spatialReference:null,spatialReferenceId:W.UNKNOWN},Hve={spatialReference:null,spatialReferenceId:W.UNKNOWN},gZ=mZ(),eVe=mZ(),Wd=It(1),OS=Ka(1),en=O(),Pd=O(),E0=O(),Or=O(),i$=O(),tOt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:G_,canProjectWithoutEngine:Bg,computeENUToSphericalPCPFLocalRotation:dZ,computeSphericalPCPFToENULocalRotation:Dve,computeTranslationToOriginAndRotation:ma,getProjectorName:FBe,getTransformation:Sve,getTransformations:IBe,initializeProjection:NBe,isLoaded:D6,load:fR,localLinearScaleFactors:qBe,lonLatToSphericalPCPF:kve,lonLatToWebMercatorComparable:F6,project:xE,projectBoundingRect:RP,projectBoundingSphere:WBe,projectBuffer:$i,projectDirection:HBe,projectExtent:GBe,projectMany:DG,projectMultipoint:UBe,projectOrLoad:$Be,projectOrLoadMany:Tve,projectPoint:Cve,projectPointToVector:Bi,projectPointToWGS84ComparableLonLat:$ve,projectPolygon:VBe,projectPolygonToWGS84ComparableLonLat:BBe,projectPolyline:kBe,projectPolylineToWGS84ComparableLonLat:zBe,projectVectorToDehydratedPoint:hZ,projectVectorToPoint:Vg,projectVectorToVector:Cs,projectVectorToWGS84ComparableLonLat:Ive,projectWithoutEngine:uZ,projectXYZToVector:NG,sphericalPCPFtoLonLatElevation:U6,test:DBe,tryProjectWithZConversion:Eve,unload:LBe},Symbol.toStringTag,{value:"Module"}));let Kg=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&pS(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*uie);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,uie));e++)this._items.push(this._allocator())}};const uie=1024;function _e(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function RS(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function yZ(t,e,r,i,n,s,o,a,l,c,u,d,p,m,y,_){return[t,e,r,i,n,s,o,a,l,c,u,d,p,m,y,_]}function Wve(t,e){return new Float64Array(t,e,16)}const yn=_e();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:yn,clone:RS,create:_e,createView:Wve,fromValues:yZ},Symbol.toStringTag,{value:"Module"}));var gc;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(gc||(gc={}));var j4;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(j4||(j4={}));function hi(){return[1,0,0,0,1,0,0,0,1]}function qve(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function tVe(t,e,r,i,n,s,o,a,l){return[t,e,r,i,n,s,o,a,l]}function Xve(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:qve,create:hi,createView:Xve,fromValues:tVe},Symbol.toStringTag,{value:"Module"}));function Au(){return[0,0,0,1]}function rVe(t){return[t[0],t[1],t[2],t[3]]}function iVe(t,e,r,i){return[t,e,r,i]}function Yve(t,e){return new Float64Array(t,e,4)}const nVe=Au();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:nVe,clone:rVe,create:Au,createView:Yve,fromValues:iVe},Symbol.toStringTag,{value:"Module"}));function Ne(){return[0,0]}function D3(t){return[t[0],t[1]]}function or(t,e){return[t,e]}function Zve(t){const e=Ne(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Qve(t,e){return new Float64Array(t,e,2)}function Jve(){return Ne()}function Kve(){return or(1,1)}function ebe(){return or(1,0)}function tbe(){return or(0,1)}const dp=Jve(),sVe=Kve(),rbe=ebe(),oVe=tbe();Object.freeze(Object.defineProperty({__proto__:null,ONES:sVe,UNIT_X:rbe,UNIT_Y:oVe,ZEROS:dp,clone:D3,create:Ne,createView:Qve,fromArray:Zve,fromValues:or,ones:Kve,unitX:ebe,unitY:tbe,zeros:Jve},Symbol.toStringTag,{value:"Module"}));function Qt(){return[0,0,0,0]}function PP(t){return[t[0],t[1],t[2],t[3]]}function $t(t,e,r,i){return[t,e,r,i]}function _Z(t){const e=Qt(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function ibe(t,e){return new Float64Array(t,e,4)}function nbe(){return Qt()}function sbe(){return $t(1,1,1,1)}function obe(){return $t(1,0,0,0)}function abe(){return $t(0,1,0,0)}function lbe(){return $t(0,0,1,0)}function cbe(){return $t(0,0,0,1)}const Nf=nbe(),mh=sbe(),aVe=obe(),lVe=abe(),cVe=lbe(),uVe=cbe();Object.freeze(Object.defineProperty({__proto__:null,ONES:mh,UNIT_W:uVe,UNIT_X:aVe,UNIT_Y:lVe,UNIT_Z:cVe,ZEROS:Nf,clone:PP,create:Qt,createView:ibe,fromArray:_Z,fromValues:$t,ones:sbe,unitW:cbe,unitX:obe,unitY:abe,unitZ:lbe,zeros:nbe},Symbol.toStringTag,{value:"Module"}));let SE=class xv{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&pS(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Jw){return new xv(16,Qve,e)}static createVec3f64(e=Jw){return new xv(24,nY,e)}static createVec4f64(e=Jw){return new xv(32,ibe,e)}static createMat3f64(e=Jw){return new xv(72,Xve,e)}static createMat4f64(e=Jw){return new xv(128,Wve,e)}static createQuatf64(e=Jw){return new xv(32,Yve,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Jw=4*j4.KILOBYTES,iOt=SE.createVec2f64(),Ie=SE.createVec3f64(),vZ=SE.createVec4f64();SE.createMat3f64();const bZ=SE.createMat4f64(),nOt=SE.createQuatf64();function _p(t){return t?{origin:ki(t.origin),vector:ki(t.vector)}:{origin:O(),vector:O()}}function hVe(t,e){const r=pVe.get();return r.origin=t,r.vector=e,r}function sOt(t,e=_p()){return dVe(t.origin,t.vector,e)}function dVe(t,e,r=_p()){return re(r.origin,t),re(r.vector,e),r}function Pb(t,e,r=_p()){return re(r.origin,t),ae(r.vector,e,t),r}function wZ(t,e){const r=ae(Ie.get(),e,t.origin),i=fe(t.vector,r),n=fe(t.vector,t.vector),s=ge(i/n,0,1),o=ae(Ie.get(),te(Ie.get(),t.vector,s),r);return fe(o,o)}function oOt(t,e,r){return BG(t,e,0,1,r)}function aOt(t,e,r){return oe(r,t.origin,te(r,t.vector,e))}function BG(t,e,r,i,n){const{vector:s,origin:o}=t,a=ae(Ie.get(),e,o),l=fe(s,a)/la(s);return te(n,s,ge(l,r,i)),oe(n,n,t.origin)}function lOt(t,e){if(hbe(t,hVe(e.origin,e.direction),!1,H4)){const{tA:r,pB:i,distance2:n}=H4;if(r>=0&&r<=1)return n;if(r<0)return wo(t.origin,i);if(r>1)return wo(oe(Ie.get(),t.origin,t.vector),i)}return null}function ube(t,e,r){return!!hbe(t,e,!0,H4)&&(re(r,H4.pA),!0)}function hbe(t,e,r,i){const s=t.origin,o=oe(Ie.get(),s,t.vector),a=e.origin,l=oe(Ie.get(),a,e.vector),c=Ie.get(),u=Ie.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const d=Ie.get();if(d[0]=o[0]-s[0],d[1]=o[1]-s[1],d[2]=o[2]-s[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],m=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],y=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],_=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])*_-m*m;if(Math.abs(v)<1e-6)return!1;let b=(p*m-y*_)/v,x=(p+m*b)/_;r&&(b=ge(b,0,1),x=ge(x,0,1));const T=Ie.get(),S=Ie.get();return T[0]=s[0]+b*d[0],T[1]=s[1]+b*d[1],T[2]=s[2]+b*d[2],S[0]=a[0]+x*u[0],S[1]=a[1]+x*u[1],S[2]=a[2]+x*u[2],i.tA=b,i.tB=x,i.pA=T,i.pB=S,i.distance2=wo(T,S),!0}const H4={tA:0,tB:0,pA:O(),pB:O(),distance2:0},pVe=new Kg(()=>_p());function qs(t){return t?hie(ki(t.origin),ki(t.direction)):hie(O(),O())}function hie(t,e){return{origin:t,direction:e}}function cOt(t,e){return Hf(t.origin,e.origin)&&Hf(t.direction,e.direction)}function bu(t,e){const r=yVe.get();return r.origin=t,r.direction=e,r}function W4(t,e=qs()){return dbe(t.origin,t.direction,e)}function fVe(t,e,r=qs()){return re(r.origin,t),ae(r.direction,e,t),r}function dbe(t,e,r=qs()){return re(r.origin,t),re(r.direction,e),r}function mVe(t,e){const r=ot(Ie.get(),me(Ie.get(),t.direction),ae(Ie.get(),e,t.origin));return fe(r,r)}function gVe(t,e,r){const i=fe(t.direction,ae(r,e,t.origin));return oe(r,t.origin,te(r,t.direction,i)),r}const yVe=new Kg(()=>qs());function eO(t,e){return fe(t,e)/Te(t)}function k6(t,e){const r=fe(t,e)/(Te(t)*Te(e));return-As(r)}function pbe(t,e,r){me(n$,t),me(_k,e);const i=fe(n$,_k),n=As(i),s=ot(n$,n$,_k);return fe(s,r)<0?2*Math.PI-n:n}const n$=O(),_k=O(),fbe=vn();function vn(){return Qt()}function PS(t,e=vn()){return vh(e,t)}function mbe(t,e){return $t(t[0],t[1],t[2],e)}function _Ve(t){return t}function vVe(t){t[0]=t[1]=t[2]=t[3]=0}function z6(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function vg(t){return t[3]}function bVe(t){return t}function gbe(t,e,r,i){return $t(t,e,r,i)}function wVe(t,e,r){return t!==r&&re(r,t),r[3]=t[3]+e,r}function xVe(t,e,r){return J.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:PS(t,r)}function u1(t,e,r){if(e==null)return!1;const{origin:i,direction:n}=e,s=TVe;s[0]=i[0]-t[0],s[1]=i[1]-t[1],s[2]=i[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let u=(-a-c)/(2*o);const d=(-a+c)/(2*o);return(u<0||d<u&&d>0)&&(u=d),!(u<0)&&(r&&(r[0]=i[0]+n[0]*u,r[1]=i[1]+n[1]*u,r[2]=i[2]+n[2]*u),!0)}const TVe=O();function VG(t,e){return u1(t,e,null)}function SVe(t,e,r){if(u1(t,e,r))return r;const i=EE(t,e,Ie.get());return oe(r,e.origin,te(Ie.get(),e.direction,ci(e.origin,i)/Te(e.direction))),r}function EE(t,e,r){const i=Ie.get(),n=bZ.get();ot(i,e.origin,e.direction);const s=vg(t);ot(r,i,e.origin),te(r,r,1/Te(r)*s);const o=vbe(t,e.origin),a=k6(e.origin,r);return Ec(n,a+o,i),De(r,r,n),r}function EVe(t,e,r){return u1(t,e,r)?r:(gVe(e,t,r),ybe(t,r,r))}function ybe(t,e,r){const i=ae(Ie.get(),e,t),n=te(Ie.get(),i,t[3]/Te(i));return oe(r,n,t)}function _be(t,e){const r=ae(Ie.get(),e,t),i=la(r),n=t[3]*t[3];return Math.sqrt(Math.abs(i-n))}function vbe(t,e){const r=ae(Ie.get(),e,t),i=Te(r),n=vg(t),s=n+Math.abs(n-i);return As(n/s)}const vk=O();function bbe(t,e,r,i){const n=ae(vk,e,t);switch(r){case gc.X:{const s=sre(n,vk)[2];return ne(i,-Math.sin(s),Math.cos(s),0)}case gc.Y:{const s=sre(n,vk),o=s[1],a=s[2],l=Math.sin(o);return ne(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case gc.Z:return me(i,n);default:return}}function wbe(t,e){const r=ae(GG,e,t);return Te(r)-t[3]}function CVe(t,e,r,i){const n=wbe(t,e),s=bbe(t,e,gc.Z,GG),o=te(GG,s,r-n);return oe(i,e,o)}function AVe(t,e){const r=wo(t,e),i=vg(t);return r<=i*i}function OVe(t,e,r=vn()){const i=ci(t,e),n=t[3],s=e[3];return i+s<n?(vh(r,t),r):i+n<s?(vh(r,e),r):(Lr(r,t,e,(i+s-n)/(2*i)),r[3]=(i+n+s)/2,r)}const GG=O(),B6=vn(),RVe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:fbe,altitudeAt:wbe,angleToSilhouette:vbe,axisAt:bbe,clear:vVe,closestPoint:EVe,closestPointOnSilhouette:EE,containsPoint:AVe,copy:PS,create:vn,distanceToSilhouette:_be,elevate:wVe,fromCenterAndRadius:mbe,fromRadius:z6,fromValues:gbe,getCenter:bVe,getRadius:vg,intersectRay:u1,intersectRayClosestSilhouette:SVe,intersectsRay:VG,projectPoint:ybe,setAltitudeAt:CVe,setExtent:xVe,tmpSphere:B6,union:OVe,wrap:_Ve},Symbol.toStringTag,{value:"Module"}));function MS(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function PVe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return ne(t,r,i,n),t}function uOt(t,e,r){r=r||t;const i=fe(t,e);ne(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),me(r,r)}function hOt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?ne(e,0,1,0):ne(e,1,0,0),ot(r,t,e),me(e,e),ot(e,r,t),me(r,r)}function s$(t,e,r,i,n,s){const o=t+(e-t)*n;return o+(r+(i-r)*n-o)*s}function MVe(t,e,r,i=O()){const n=Te(t),s=Te(e),o=fe(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*n+r*s)/Math.sin(a),c=l/n*Math.sin((1-r)*a),u=l/s*Math.sin(r*a);return te(gb,t,c),te(yb,e,u),oe(i,gb,yb)}return Lr(i,t,e,r)}function dOt(t,e,r,i=O(),n=O()){const s=Te(t),o=Te(e),a=fe(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),d=Math.sin((1-r)*l),p=(1-r)*s+r*o;{const m=p/c,y=m/o*u;te(gb,t,m/s*d),te(yb,e,y),oe(i,gb,yb)}{const m=1/s*(-Math.cos((1-r)*l)*l*p+d*(-s+o));te(gb,t,m);const y=1/o*(Math.cos(r*l)*l*p+u*(-s+o));te(yb,e,y),oe(n,gb,yb),te(n,n,1/c)}return n}return Lr(i,t,e,r),ae(n,e,t),me(n,n),n}function bD(t,e,r){t=me(gb,t),e=me(yb,e);const i=As(fe(t,e));if(r){const n=ot($Ve,t,e);if(fe(n,r)<0)return-i}return i}function wD(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const n=t[i-1][0],s=t[i][0],o=(s-r)/(s-n);return o*t[i-1][1]+(1-o)*t[i][1]}}function pOt(t,e,r,i){ae(die,e,t),ae(pie,r,t),ot(i,die,pie),me(i,i),i[3]=-fe(t,i)}const die=O(),pie=O(),$Ve=O(),gb=O(),yb=O();function Er(t=N3){return[t[0],t[1],t[2],t[3]]}function IVe(t=N3[0],e=N3[1],r=N3[2],i=N3[3]){return xZ(t,e,r,i,vZ.get())}function V6(t,e){return xZ(e[0],e[1],e[2],e[3],t)}function xZ(t,e,r,i,n=Er()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function xbe(t,e,r){return re(r,t),r[3]=e,r}function MP(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function oa(t,e,r,i=Er()){const n=r[0]-e[0],s=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=s*c-o*l,d=o*a-n*c,p=n*l-s*a,m=u*u+d*d+p*p,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=u*y,i[1]=d*y,i[2]=p*y,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Tbe(t,e,r,i,n){const s=t.length/3;if(s<3)return!1;ne(aC,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<s-1&&!a;){const l=3*o;ne(Kw,t[l],t[l+1],t[l+2]),o++,a=!Bo(aC,Kw)}if(!a)return!1;for(o=Math.max(o,n),a=!1;o<s&&!a;){const l=3*o;ne(Jv,t[l],t[l+1],t[l+2]),o++,ae(o$,aC,Kw),me(o$,o$),ae(a$,Kw,Jv),me(a$,a$),a=!Bo(aC,Jv)&&!Bo(Kw,Jv)&&Math.abs(fe(o$,a$))<LVe}return a?(oa(aC,Kw,Jv,e),!0):(r!==0||i!==1||n!==2)&&Tbe(t,e,0,1,2)}const LVe=.99619469809,aC=O(),Kw=O(),Jv=O(),o$=O(),a$=O();function jG(t,e,r){return e!==t&&V6(t,e),t[3]=-fe(t,r),t}function HG(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function mR(t,e,r,i){return ot(Jv,e,t),MP(r,Jv,i)}function fOt(t,e,r,i){return G6(t,e,ae(Ie.get(),r,e),zVe,i)}function kw(t,e,r){return e!=null&&G6(t,e.origin,e.direction,BVe,r)}function DVe(t,e,r){return G6(t,e.origin,e.vector,Ff.NONE,r)}function NVe(t,e,r){return G6(t,e.origin,e.vector,Ff.CLAMP,r)}function Sbe(t,e){return oi(t,e)>=0}function FVe(t,e){const r=fe(t,e.ray.direction),i=-oi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function UVe(t,e){const r=fe(t,e.ray.direction),i=-oi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function kVe(t,e,r){const i=te(Ie.get(),t,-t[3]),n=WG(t,ae(Ie.get(),e,i),Ie.get());return oe(r,n,i),r}function WG(t,e,r){const i=te(Ie.get(),t,fe(t,e));return ae(r,e,i),r}function oi(t,e){return fe(t,e)+t[3]}function G6(t,e,r,i,n){const s=fe(t,r);if(s===0)return!1;let o=-(fe(t,e)+t[3])/s;return i&Ff.CLAMP&&(o=ge(o,0,1)),!(!(i&Ff.INFINITE_MIN)&&o<0||!(i&Ff.INFINITE_MAX)&&o>1)&&(oe(n,e,te(n,r,o)),!0)}function mOt(t){return t}const N3=[0,0,1,0];var Ff;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Ff||(Ff={}));const zVe=Ff.INFINITE_MIN|Ff.INFINITE_MAX,BVe=Ff.INFINITE_MAX,bk=J.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let VVe=class{constructor(){this.plane=Er(),this.origin=O(),this.basis1=O(),this.basis2=O()}};const Ebe=VVe;function e0(t=Nbe){return{plane:Er(t.plane),origin:ki(t.origin),basis1:ki(t.basis1),basis2:ki(t.basis2)}}function GVe(t,e,r){const i=t7e.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=IVe(0,0,0,0),j6(i),i}function zw(t,e=e0()){return TZ(t.origin,t.basis1,t.basis2,e)}function jVe(t,e){re(e.origin,t.origin),re(e.basis1,t.basis1),re(e.basis2,t.basis2),V6(e.plane,t.plane)}function TZ(t,e,r,i=e0()){return re(i.origin,t),re(i.basis1,e),re(i.basis2,r),j6(i),KVe(i,"fromValues()"),i}function j6(t){mR(t.basis2,t.basis1,t.origin,t.plane)}function Cbe(t,e,r){t!==r&&zw(t,r);const i=te(Ie.get(),Gg(t),e);return oe(r.origin,r.origin,i),r.plane[3]-=e,r}function HVe(t,e,r){return Abe(e,r),Cbe(r,AZ(t,t.origin),r),r}function Abe(t,e=e0()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return ne(e.origin,t[0]+r,t[1]+i,0),ne(e.basis1,r,0,0),ne(e.basis2,0,i,0),xZ(0,0,1,0,e.plane),e}function SZ(t,e,r){return!!kw(t.plane,e,r)&&Lbe(t,r)}function WVe(t,e,r){if(SZ(t,e,r))return r;const i=Obe(t,e,Ie.get());return oe(r,e.origin,te(Ie.get(),e.direction,ci(e.origin,i)/Te(e.direction))),r}function Obe(t,e,r){const i=q4.get();Dbe(t,e,i,q4.get());let n=Number.POSITIVE_INFINITY;for(const s of RZ){const o=OZ(t,s,H6.get()),a=Ie.get();if(DVe(i,o,a)){const l=Qg(Ie.get(),e.origin,a),c=Math.abs(As(fe(e.direction,l)));c<n&&(n=c,re(r,a))}}return n===Number.POSITIVE_INFINITY?Rbe(t,e,r):r}function Rbe(t,e,r){if(SZ(t,e,r))return r;const i=q4.get(),n=q4.get();Dbe(t,e,i,n);let s=Number.POSITIVE_INFINITY;for(const o of RZ){const a=OZ(t,o,H6.get()),l=Ie.get();if(NVe(i,a,l)){const c=mVe(e,l);if(!Sbe(n,l))continue;c<s&&(s=c,re(r,l))}}return EZ(t,e.origin)<s&&Pbe(t,e.origin,r),r}function Pbe(t,e,r){const i=kVe(t.plane,e,Ie.get()),n=BG(fie(t,t.basis1),i,-1,1,Ie.get()),s=BG(fie(t,t.basis2),i,-1,1,Ie.get());return ae(r,oe(Ie.get(),n,s),t.origin),r}function Mbe(t,e,r){const{origin:i,basis1:n,basis2:s}=t,o=ae(Ie.get(),e,i),a=eO(n,o),l=eO(s,o),c=eO(Gg(t),o);return ne(r,a,l,c)}function EZ(t,e){const r=Mbe(t,e,Ie.get()),{basis1:i,basis2:n}=t,s=Te(i),o=Te(n),a=Math.max(Math.abs(r[0])-s,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function qVe(t,e){return Math.sqrt(EZ(t,e))}function XVe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of RZ){const n=OZ(t,i,H6.get()),s=wZ(n,e);s>r&&(r=s)}return Math.sqrt(r)}function CZ(t,e){return Sbe(t.plane,e)&&Lbe(t,e)}function YVe(t,e,r,i){return JVe(t,r,i)}function AZ(t,e){const r=-t.plane[3];return eO(Gg(t),e)-r}function ZVe(t,e,r,i){const n=AZ(t,e),s=te(e7e,Gg(t),r-n);return oe(i,e,s),i}function $be(t,e){return Bo(t.basis1,e.basis1)&&Bo(t.basis2,e.basis2)&&Bo(t.origin,e.origin)}function Ibe(t,e,r){return t!==r&&zw(t,r),us(ex,e),Sc(ex,ex),De(r.basis1,t.basis1,ex),De(r.basis2,t.basis2,ex),De(r.plane,t.plane,ex),De(r.origin,t.origin,e),jG(r.plane,r.plane,r.origin),r}function QVe(t,e,r,i){return t!==i&&zw(t,i),Ec(wk,e,r),De(i.basis1,t.basis1,wk),De(i.basis2,t.basis2,wk),j6(i),i}function Gg(t){return t.plane}function JVe(t,e,r){switch(e){case gc.X:re(r,t.basis1),me(r,r);break;case gc.Y:re(r,t.basis2),me(r,r);break;case gc.Z:re(r,Gg(t))}return r}function Lbe(t,e){const r=ae(Ie.get(),e,t.origin),i=la(t.basis1),n=la(t.basis2),s=fe(t.basis1,r),o=fe(t.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function fie(t,e){const r=H6.get();return re(r.origin,t.origin),re(r.vector,e),r}function OZ(t,e,r){const{basis1:i,basis2:n,origin:s}=t,o=te(Ie.get(),i,e.origin[0]),a=te(Ie.get(),n,e.origin[1]);oe(r.origin,o,a),oe(r.origin,r.origin,s);const l=te(Ie.get(),i,e.direction[0]),c=te(Ie.get(),n,e.direction[1]);return te(r.vector,oe(l,l,c),2),r}function KVe(t,e){Math.abs(fe(t.basis1,t.basis2)/(Te(t.basis1)*Te(t.basis2)))>1e-6&&bk.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(fe(t.basis1,Gg(t)))>1e-6&&bk.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-fe(Gg(t),t.origin)-t.plane[3])>1e-6&&bk.warn(e,"Plane offset is not consistent with plane origin")}function Dbe(t,e,r,i){const n=Gg(t);mR(n,e.direction,e.origin,r),mR(r,n,e.origin,i)}const Nbe={plane:Er(),origin:Se(0,0,0),basis1:Se(1,0,0),basis2:Se(0,1,0)},q4=new Kg(Er),H6=new Kg(_p),e7e=O(),t7e=new Kg(()=>e0()),RZ=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ex=_e(),wk=_e(),r7e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Ebe,UP:Nbe,altitudeAt:AZ,axisAt:YVe,closestPoint:Rbe,closestPointOnSilhouette:Obe,copy:zw,copyWithoutVerify:jVe,create:e0,distance:qVe,distance2:EZ,distanceToSilhouette:XVe,elevate:Cbe,equals:$be,extrusionContainsPoint:CZ,fromAABoundingRect:Abe,fromValues:TZ,intersectRay:SZ,intersectRayClosestSilhouette:WVe,normal:Gg,projectPoint:Pbe,projectPointLocal:Mbe,rotate:QVe,setAltitudeAt:ZVe,setExtent:HVe,transform:Ibe,updateUnboundedPlane:j6,wrap:GVe},Symbol.toStringTag,{value:"Module"})),i7e=new St(E0e),mie=new St(YX),gie=new St(ZX),yOt=new St(C0e);function t0(t){return t&&(nm(t)||Js(t,mie))?mie:t&&(sm(t)||Js(t,gie))?gie:i7e}function n7e(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function s7e(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function o7e(t){return{operations:t,value:t.create()}}function Fbe(t,e,r=o7e(t)){return r.operations=t,t.copy(e,r.value),r}function a7e(t){return Fbe(RVe,gbe(0,0,0,Mr(t).radius))}const yie=2**50;function l7e(){return Fbe(r7e,TZ([0,0,0],[yie,0,0],[0,yie,0]))}function c7e(t,e,r){return t.operations.axisAt(t.value,e,gc.Z,r)}function u7e(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function h7e(t,e,r){return t.operations.intersectRay(t.value,e,r)}function d7e(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function p7e(t,e){return t.operations.altitudeAt(t.value,e)}function Ube(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function f7e(t,e,r,i){return e!==i&&In(i,e),ne(tx,i[12],i[13],i[14]),Ube(t,tx,r,tx),i[12]=tx[0],i[13]=tx[1],i[14]=tx[2],i}function xk(t,e,r){return t.operations.elevate(t.value,e,r.value)}const tx=O();function _ie(t,e,r,i,n){return n[0]=fe(t,e),n[1]=fe(t,r),n[2]=fe(t,i),n}function qG(t,e,r,i,n){re(r,t),re(l$,e),me(l$,l$),ot(i,l$,r),ot(n,i,r)}function m7e(t,e){return t?t0(e):e.isGeographic?St.PlateCarree:e}const l$=O(),PZ=96;function _Ot(t,e){const r=e||t.extent,i=t.width,n=el(r&&r.spatialReference);return r&&i?r.width/i*n*QX*PZ:0}function g7e(t,e){return t/(el(e)*QX*PZ)}function y7e(t){return t/(QX*PZ)}const _7e="OBJECTID";let $S=class extends ZA{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(J.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};$S=h([N("esri.support.AnalysesCollection")],$S);const xD={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Tk={xsmall:544,small:768,medium:992,large:1200};function v7e(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function Sk(t,e){return e?xD[t].valueToClassName[e].split(" "):[]}const b7e=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new Vi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Tk}initialize(){this._breakpointsHandles.add(ue(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Pr))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Me(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=v7e(r);if(!i){const n=JSON.stringify(Tk,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}r=i?r:Tk,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=uc.acquire(),i=uc.acquire();let n,s=!1;for(n in xD){const o=this[n],a=xD[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,Sk(n,o).forEach(l=>i.push(l)),Sk(n,a).forEach(l=>r.push(l)))}s&&(this._applyClassNameChanges(r,i),uc.release(r),uc.release(i))}_applyClassNameChanges(r,i){const n=this.container;n&&(i.forEach(s=>n.classList.remove(s)),r.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in xD)Sk(i,this[i]).forEach(n=>r.classList.remove(n))}};return h([f()],e.prototype,"breakpoints",null),h([f()],e.prototype,"orientation",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),h([f()],e.prototype,"heightBreakpoint",void 0),e=h([N("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var w7e=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Kv={exports:{}},Qn={},gR={exports:{}},Bw={};function kbe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function x7e(t,e,r){}function T7e(t,e,r){}var S7e=/javascript\s*\:/img;function E7e(t,e){return S7e.test(e)?"":e}Bw.whiteList=kbe();Bw.getDefaultWhiteList=kbe;Bw.onAttr=x7e;Bw.onIgnoreAttr=T7e;Bw.safeAttrValue=E7e;var C7e={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},lC=C7e;function A7e(t,e){t=lC.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,n=0,s=0,o="";function a(){if(!i){var u=lC.trim(t.slice(n,s)),d=u.indexOf(":");if(d!==-1){var p=lC.trim(u.slice(0,d)),m=lC.trim(u.slice(d+1));if(p){var y=e(n,o.length,p,m,u);y&&(o+=y+"; ")}}}n=s+1}for(;s<r;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return lC.trim(o)}var O7e=A7e,c$=Bw,R7e=O7e;function vie(t){return t==null}function P7e(t){var e={};for(var r in t)e[r]=t[r];return e}function zbe(t){t=P7e(t||{}),t.whiteList=t.whiteList||c$.whiteList,t.onAttr=t.onAttr||c$.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||c$.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||c$.safeAttrValue,this.options=t}zbe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onAttr,s=r.onIgnoreAttr,o=r.safeAttrValue,a=R7e(t,function(l,c,u,d,p){var m=i[u],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(d):m instanceof RegExp&&(y=m.test(d)),y!==!0&&(y=!1),d=o(u,d),!!d){var _={position:c,sourcePosition:l,source:p,isWhite:y};if(y){var v=n(u,d,_);return vie(v)?u+":"+d:v}else{var v=s(u,d,_);if(!vie(v))return v}}});return a};var M7e=zbe;(function(t,e){var r=Bw,i=M7e;function n(o,a){var l=new i(a);return l.process(o)}e=t.exports=n,e.FilterCSS=i;for(var s in r)e[s]=r[s]})(gR,gR.exports);var MZ={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},$7e=gR.exports.FilterCSS,I7e=gR.exports.getDefaultWhiteList,X4=MZ;function Bbe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Vbe=new $7e;function L7e(t,e,r){}function D7e(t,e,r){}function N7e(t,e,r){}function F7e(t,e,r){}function Gbe(t){return t.replace(k7e,"&lt;").replace(z7e,"&gt;")}function U7e(t,e,r,i){if(r=Ybe(r),e==="href"||e==="src"){if(r=X4.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(u$.lastIndex=0,u$.test(r))return""}else if(e==="style"){if(bie.lastIndex=0,bie.test(r)||(wie.lastIndex=0,wie.test(r)&&(u$.lastIndex=0,u$.test(r))))return"";i!==!1&&(i=i||Vbe,r=i.process(r))}return r=Zbe(r),r}var k7e=/</g,z7e=/>/g,B7e=/"/g,V7e=/&quot;/g,G7e=/&#([a-zA-Z0-9]*);?/gim,j7e=/&colon;?/gim,H7e=/&newline;?/gim,u$=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,bie=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,wie=/u\s*r\s*l\s*\(.*/gi;function jbe(t){return t.replace(B7e,"&quot;")}function Hbe(t){return t.replace(V7e,'"')}function Wbe(t){return t.replace(G7e,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function qbe(t){return t.replace(j7e,":").replace(H7e," ")}function Xbe(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return X4.trim(e)}function Ybe(t){return t=Hbe(t),t=Wbe(t),t=qbe(t),t=Xbe(t),t}function Zbe(t){return t=jbe(t),t=Gbe(t),t}function W7e(){return""}function q7e(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:X4.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return n.push([s!==!1?s:l.position,u]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return X4.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function X7e(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var n=t.indexOf("-->",i);if(n===-1)break;r=n+3}return e}function Y7e(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Qn.whiteList=Bbe();Qn.getDefaultWhiteList=Bbe;Qn.onTag=L7e;Qn.onIgnoreTag=D7e;Qn.onTagAttr=N7e;Qn.onIgnoreTagAttr=F7e;Qn.safeAttrValue=U7e;Qn.escapeHtml=Gbe;Qn.escapeQuote=jbe;Qn.unescapeQuote=Hbe;Qn.escapeHtmlEntities=Wbe;Qn.escapeDangerHtml5Entities=qbe;Qn.clearNonPrintableCharacter=Xbe;Qn.friendlyAttrValue=Ybe;Qn.escapeAttrValue=Zbe;Qn.onIgnoreTagStripAll=W7e;Qn.StripTagBody=q7e;Qn.stripCommentTag=X7e;Qn.stripBlankChar=Y7e;Qn.cssFilter=Vbe;Qn.getDefaultCSSWhiteList=I7e;var W6={},Py=MZ;function Z7e(t){var e=Py.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=Py.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function Q7e(t){return t.slice(0,2)==="</"}function J7e(t,e,r){var i="",n=0,s=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var d=t.charAt(a);if(s===!1){if(d==="<"){s=a;continue}}else if(o===!1){if(d==="<"){i+=r(t.slice(n,a)),s=a,n=a;continue}if(d===">"){i+=r(t.slice(n,s)),u=t.slice(s,a+1),c=Z7e(u),i+=e(s,i.length,c,u,Q7e(u)),n=a+1,s=!1;continue}if(d==='"'||d==="'")for(var p=1,m=t.charAt(a-p);m.trim()===""||m==="=";){if(m==="="){o=d;continue e}m=t.charAt(a-++p)}}else if(d===o){o=!1;continue}}return n<t.length&&(i+=r(t.substr(n))),i}var K7e=/[^a-zA-Z0-9\\_:.-]/gim;function eGe(t,e){var r=0,i=0,n=[],s=!1,o=t.length;function a(p,m){if(p=Py.trim(p),p=p.replace(K7e,"").toLowerCase(),!(p.length<1)){var y=e(p,m||"");y&&n.push(y)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,d;if(s===!1&&c==="="){s=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:rGe(t,l+1);continue}if(s!==!1&&l===i){if(d=t.indexOf(c,l+1),d===-1)break;u=Py.trim(t.slice(i+1,d)),a(s,u),s=!1,l=d,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(d=tGe(t,l),d===-1){u=Py.trim(t.slice(r,l)),a(u),s=!1,r=l+1;continue}else{l=d-1;continue}else if(d=iGe(t,l-1),d===-1){u=Py.trim(t.slice(r,l)),u=xie(u),a(s,u),s=!1,r=l+1;continue}else continue}return r<t.length&&(s===!1?a(t.slice(r)):a(s,xie(Py.trim(t.slice(r))))),Py.trim(n.join(" "))}function tGe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function rGe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function iGe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function nGe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function xie(t){return nGe(t)?t.substr(1,t.length-2):t}W6.parseTag=J7e;W6.parseAttr=eGe;var sGe=gR.exports.FilterCSS,Md=Qn,Qbe=W6,oGe=Qbe.parseTag,aGe=Qbe.parseAttr,TD=MZ;function h$(t){return t==null}function lGe(t){var e=TD.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=TD.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=TD.trim(t.slice(0,-1))),{html:t,closing:r}}function cGe(t){var e={};for(var r in t)e[r]=t[r];return e}function uGe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function Jbe(t){t=cGe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Md.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=uGe(t.whiteList||t.allowList):t.whiteList=Md.whiteList,t.onTag=t.onTag||Md.onTag,t.onTagAttr=t.onTagAttr||Md.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Md.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Md.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Md.safeAttrValue,t.escapeHtml=t.escapeHtml||Md.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new sGe(t.css))}Jbe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onTag,s=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=e.cssFilter;r.stripBlankChar&&(t=Md.stripBlankChar(t)),r.allowCommentTag||(t=Md.stripCommentTag(t));var d=!1;r.stripIgnoreTagBody&&(d=Md.StripTagBody(r.stripIgnoreTagBody,s),s=d.onIgnoreTag);var p=oGe(t,function(m,y,_,v,b){var x={sourcePosition:m,position:y,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(i,_)},T=n(_,v,x);if(!h$(T))return T;if(x.isWhite){if(x.isClosing)return"</"+_+">";var S=lGe(v),A=i[_],C=aGe(S.html,function(R,P){var F=TD.indexOf(A,R)!==-1,k=o(_,R,P,F);return h$(k)?F?(P=l(_,R,P,u),P?R+'="'+P+'"':R):(k=a(_,R,P,F),h$(k)?void 0:k):k});return v="<"+_,C&&(v+=" "+C),S.closing&&(v+=" /"),v+=">",v}else return T=s(_,v,x),h$(T)?c(v):T},c);return d&&(p=d.remove(p)),p};var hGe=Jbe;(function(t,e){var r=Qn,i=W6,n=hGe;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(Kv,Kv.exports);var dGe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?i.sanitizeUrl(a):Kv.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!r?n=e:e&&r?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new Kv.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,n=i===void 0?!0:i,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?Kv.exports.escapeAttrValue(e):!s&&!n?Kv.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,n):Kv.exports.safeAttrValue(e,r,i,n)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,n){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(n){Array.isArray(i[n])&&Array.isArray(r[n])?r[n]=r[n].concat(i[n]):r[n]=i[n]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(w7e(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],u=i.validate(c,r);return u.isValid?a[l]=c:(n=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const q6=new Map;function Kbe(){q6.clear()}function pGe(t){return q6.get(t)}function fGe(t,e){q6.set(t,e)}function Ek(t){q6.delete(t)}var lw,IS,mGe=function(t){if("WebkitTransition"in t.style)lw="webkitTransitionEnd",IS="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");lw="transitionend",IS="animationend"}},ewe=function(t){lw||mGe(t)},gGe=function(t,e){return e===void 0&&(e=t+"-active"),function(r){ewe(r);var i=!1,n=function(s){i||(i=!0,r.removeEventListener(lw,n),r.removeEventListener(IS,n),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(lw,n),r.addEventListener(IS,n),requestAnimationFrame(function(){r.classList.add(e)})}},yGe=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){ewe(r);var n=!1,s=function(o){n||(n=!0,r.removeEventListener(lw,s),r.removeEventListener(IS,s),i())};r.classList.add(t),r.addEventListener(lw,s),r.addEventListener(IS,s),requestAnimationFrame(function(){r.classList.add(e)})}};const _Ge=J.getLogger("esri.widgets.support.widgetUtils");function vGe(t){const e=uc.acquire();for(let i=0;i<arguments.length;i++){const n=arguments[i],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const r=e.join(" ");return uc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{var n;Kbe();for(const s of i)(n=t.get(s.target))==null||n(s)}),r=(i,n,s)=>(t.has(i)&&_Ge.error("Already observing element",i),t.set(i,n),e.observe(i,s),Za(()=>{e.unobserve(i),t.delete(i)}));return(i,n,s)=>{let o=null;return ue(()=>typeof i=="function"?i():i,a=>{o==null||o.remove(),a&&(o=r(a,n,s))},An)}})();function bGe(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function bOt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function wOt(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function xOt(t,e){return(t==="enter"?gGe:yGe)(e)}const wGe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],xGe=wGe.reduce((t,e)=>(t[e]=[],t),{}),TGe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],twe=new dGe({whiteList:xGe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(TGe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function SGe(t){return t==="Enter"||t===" "}const rwe="http://www.w3.org/",X6=`${rwe}2000/svg`,iwe=`${rwe}1999/xlink`;let Tie=[],$Z=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},IZ=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),nwe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},EGe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(IZ(t[i],e))return i}return-1},Ck=(t,e,r,i)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(IZ(a,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},CGe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},XG=[],YG=!1,swe=t=>{(t.children||[]).forEach(swe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Sie=()=>{YG=!1,XG.forEach(swe),XG.length=0},Eie=t=>{XG.push(t),YG||(YG=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Sie,{timeout:16}):setTimeout(Sie,16))},Cie=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Eie(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Eie(t))},AGe=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")ZG(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let d=0;d<u;d++){let p=c[d],m=l[p];m&&(nwe(m),r.styleApplyer(t,p,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(d){u.apply(this,[d]),d.target["oninput-value"]=d.target.value}}()),t[a]=l):r.namespace===X6?a==="href"?t.setAttributeNS(iwe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=twe.sanitize(l):owe(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function owe(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let Y4,OGe=(t,e,r)=>{if(e)for(let i of e)oT(i,t,void 0,r)},awe=(t,e,r)=>{OGe(t,e.children,r),e.text&&(t.textContent=e.text),AGe(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},oT=(t,e,r,i)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(n,r):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(s-1),d=o.slice(s,l);u==="."?n.classList.add(d):u==="#"?n.id=d:(d==="svg"&&(i=$Z(i,{namespace:X6})),i.namespace!==void 0?n=t.domNode=a.createElementNS(i.namespace,d):(n=t.domNode=t.domNode||a.createElement(d),d==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(n,r):n.parentNode!==e&&e.appendChild(n)),s=l+1}}awe(n,t,i)}},ZG=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},RGe=(t,e,r,i)=>{if(!r)return;let n=!1,s=Object.keys(r),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=r[l],u=e[l];if(l==="class")u!==c&&(ZG(t,u,!1),ZG(t,c,!0));else if(l==="classes"){let d=t.classList,p=Object.keys(c),m=p.length;for(let y=0;y<m;y++){let _=p[y],v=!!c[_];v!==!!u[_]&&(n=!0,v?d.add(_):d.remove(_))}}else if(l==="styles"){let d=Object.keys(c),p=d.length;for(let m=0;m<p;m++){let y=d[m],_=c[y];_!==u[y]&&(n=!0,_?(nwe(_),i.styleApplyer(t,y,_)):i.styleApplyer(t,y,""))}}else if(c||typeof u!="string"||(c=""),l==="value"){let d=t[l];d!==c&&(t["oninput-value"]?d===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(n=!0)}else if(c!==u){let d=typeof c;d==="function"&&i.eventHandlerInterceptor||(i.namespace===X6?l==="href"?t.setAttributeNS(iwe,l,c):t.setAttribute(l,c):d==="string"?l==="innerHTML"?t[l]=twe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):owe(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}return n},PGe=(t,e,r,i,n)=>{if(r===i)return!1;i=i||Tie;let s,o=(r=r||Tie).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let d=l<o?r[l]:void 0,p=i[c];if(d!==void 0&&IZ(d,p))u=Y4(d,p,n)||u,l++;else{let m=EGe(r,p,l+1);if(m>=0){for(s=l;s<m;s++)Cie(r[s]),Ck(r,s,t,"removed");u=Y4(r[m],p,n)||u,l=m+1}else oT(p,e,l<o?r[l].domNode:void 0,n),CGe(p),Ck(i,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)Cie(r[s]),Ck(r,s,t,"removed");return u};Y4=(t,e,r)=>{let i=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,n=!0,n}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=$Z(r,{namespace:X6})),t.text!==e.text&&(s=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,s=PGe(e,i,t.children,e.children,r)||s,s=RGe(i,t.properties,e.properties,r)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),n};let cC=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,Y4(i,r,e)},domNode:t.domNode});const MGe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let y2=t=>$Z(MGe,t),u_={create:(t,e)=>(e=y2(e),oT(t,document.createElement("div"),void 0,e),cC(t,e)),append:(t,e,r)=>(r=y2(r),oT(e,t,void 0,r),cC(e,r)),insertBefore:(t,e,r)=>(r=y2(r),oT(e,t.parentNode,t,r),cC(e,r)),merge:(t,e,r)=>(r=y2(r),e.domNode=t,awe(t,e,r),cC(e,r)),replace:(t,e,r)=>(r=y2(r),oT(e,t.parentNode,t,r),t.parentNode.removeChild(t),cC(e,r))},lwe,$Ge=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};lwe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let IGe=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?lwe(r.children,n=>n.domNode===i):void 0}),r},LGe=(t,e,r)=>{let i=function(n){r("domEvent",n);let s=e(),o=$Ge(n.currentTarget,s.domNode);o.reverse();let a,l=IGe(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",n),a};return(n,s,o,a)=>i},Aie=t=>{let e,r,i=y2(t),n=i.performanceLogger,s=!0,o=!1,a=[],l=[],c=(d,p,m)=>{let y,_=()=>y;i.eventHandlerInterceptor=LGe(e,_,n),y=d(p,m(),i),a.push(y),l.push(m)},u=()=>{if(r=void 0,s){s=!1,n("renderStart",void 0);for(let d=0;d<a.length;d++){let p=l[d]();n("rendered",void 0),a[d].update(p),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(d,p)=>{c(u_.append,d,p)},insertBefore:(d,p)=>{c(u_.insertBefore,d,p)},merge:(d,p)=>{c(u_.merge,d,p)},replace:(d,p)=>{c(u_.replace,d,p)},detach:d=>{for(let p=0;p<l.length;p++)if(l[p]===d)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},uy=class extends xe{constructor(){super(...arguments),this.items=new ir,this._watchUpdatingTracking=new Df,this._callbacks=new Map,this._projector=Aie(),this._hiddenProjector=Aie()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const n=()=>i.render();this._callbacks.set(i,n),this._projector.append(this.surface,n)}for(const i of r.removed){const n=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(n.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);i.append(r,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(s);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(r);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};h([f({readOnly:!0})],uy.prototype,"surface",void 0),h([f({readOnly:!0})],uy.prototype,"items",void 0),h([f({readOnly:!0})],uy.prototype,"needsRender",null),h([f({readOnly:!0})],uy.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],uy.prototype,"updating",null),uy=h([N("esri.views.overlay.ViewOverlay")],uy);const Oie=uy,Ak=[0,0];function DGe(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return Ak[0]=r.left+((e==null?void 0:e.pageXOffset)??0),Ak[1]=r.top+((e==null?void 0:e.pageYOffset)??0),Ak}function Rie(t){t&&(tve(t),t.parentNode&&t.parentNode.removeChild(t))}function NGe(t){const e=document.createElement("div");return t.appendChild(e),e}const uC=16,d$=750,FGe=512,UGe=2,kGe=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:uC,time:d$},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([ue(()=>this.cursor,i=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",i)}),ue(()=>this.navigating,i=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([ue(()=>this.ui,(r,i)=>this._handleUIChange(r,i),Pr),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Me(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),n=R6(r);if(n||typeof r!="string"||J.getLogger(this).error("#container",`element with id '${r}' not found`),i===n)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Rie(this.root),this._set("root",null)),this.userContent&&(qre(this.userContent,i),Rie(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",qre(n,s),n.appendChild(s),this._set("userContent",s);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Oie;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(ue(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=fS({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=Pi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){var r;(r=this.surface)==null||r.blur()}focus(){var r;(r=this.surface)==null||r.focus()}pageToContainer(r,i,n){const s=this.position;return r-=s?s[0]:0,i-=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}containerToPage(r,i,n){const s=this.position;return r+=s?s[0]:0,i+=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(ue(()=>this.root,n=>{r.container=n?NGe(n):null},Pr),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=uC,r.time=d$,this.addHandles([(()=>{const i=()=>{r.freq=uC,r.time=d$};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),fS({prepare:i=>{const n=this._measure(),s=this._freqInfo;if(s.time+=i.deltaTime,n&&(s.freq=uC,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?uC:Math.min(d$,s.freq*UGe),!n&&s.freq>=FGe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,n=r?r.clientHeight:0;if(i===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return i===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:i,height:n}),!0)}_position(){const r=this.container,i=this.position,n=r&&DGe(r);return!!n&&(!i||n[0]!==i[0]||n[1]!==i[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return h([f()],e.prototype,"container",null),h([f({readOnly:!0})],e.prototype,"focused",null),h([f({readOnly:!0})],e.prototype,"height",void 0),h([f({type:Oie})],e.prototype,"overlay",void 0),h([f({readOnly:!0})],e.prototype,"position",void 0),h([f({readOnly:!0})],e.prototype,"resizing",void 0),h([f({readOnly:!0})],e.prototype,"root",void 0),h([f({value:null,readOnly:!0})],e.prototype,"size",null),h([f({readOnly:!0})],e.prototype,"surface",void 0),h([f({readOnly:!0})],e.prototype,"suspended",void 0),h([f()],e.prototype,"ui",void 0),h([f({readOnly:!0})],e.prototype,"userContent",void 0),h([f({readOnly:!0})],e.prototype,"width",void 0),h([f()],e.prototype,"widthBreakpoint",void 0),e=h([N("esri.views.DOMContainer")],e),e},LZ=J.getLogger("esri.layers.support.ElevationSampler");let cwe=class{queryElevation(e){return uwe(e.clone(),this)}on(){return jGe}projectIfRequired(e,r){return hwe(e,r)}},zGe=class extends cwe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const n=e.tile.extent;this.extent=d6(n,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=el(r.spatialReference),o=r.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return p6(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,n=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return LZ.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},COt=class extends cwe{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let n;super(),typeof r=="number"?(this.noDataValue=r,n=null):(n=r,this.noDataValue=i),this.samplers=n?e.map(o=>new zGe(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=d6(jt(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return LZ.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function uwe(t,e){const r=hwe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":BGe(t,r,e);break;case"polyline":VGe(t,r,e);break;case"multipoint":GGe(t,r,e)}return t}function hwe(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=$w(t,e);return i||LZ.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function BGe(t,e,r){t.z=r.elevationAt(e.x,e.y)}function VGe(t,e,r){xf.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];xf.x=c[0],xf.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(xf.x,xf.y)}}t.hasZ=!0}function GGe(t,e,r){xf.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];xf.x=o[0],xf.y=o[1],i&&(s[3]=s[2]),s[2]=r.elevationAt(xf.x,xf.y)}t.hasZ=!0}const xf=new ze,jGe={remove(){}};var QG;let tf=QG=class extends ke{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new QG({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],tf.prototype,"cols",void 0),h([f({type:mn,json:{write:!0}})],tf.prototype,"level",void 0),h([f({type:String,json:{write:!0}})],tf.prototype,"levelValue",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],tf.prototype,"origin",void 0),h([f({type:Number,json:{write:!0}})],tf.prototype,"resolution",void 0),h([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],tf.prototype,"rows",void 0),h([f({type:Number,json:{write:!0}})],tf.prototype,"scale",void 0),tf=QG=h([N("esri.layers.support.LOD")],tf);const kd=tf;let HGe=class{constructor(e,r,i,n,s=void 0){this.id=e,this.level=r,this.row=i,this.col=n,this.extent=s}};var hy;const Pie=new zn({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Ko=hy=class extends ke{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:n=St.WebMercator,numLODs:s=24}=t;if(!ua(n)){const d=[];if(r)for(let p=0;p<r.length;p++){const m=r[p];d.push(new kd({level:p,scale:m,resolution:m}))}else{let p=5e-4;for(let m=s-1;m>=0;m--)d.unshift(new kd({level:m,scale:p,resolution:p})),p*=2}return new hy({dpi:96,lods:d,origin:new ze(0,0,n),size:[i,i],spatialReference:n})}const o=Sb(n),a=t.origin?new ze({x:t.origin.x,y:t.origin.y,spatialReference:n}):new ze(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(el(n)*39.37*l),u=[];if(r)for(let d=0;d<r.length;d++){const p=r[d],m=p*c;u.push(new kd({level:d,scale:p,resolution:m}))}else{let d=T0e(n)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(s/e);u.push(new kd({level:0,scale:d,resolution:d*c}));for(let m=1;m<p;m++){const y=d/2**e,_=y*c;u.push(new kd({level:m,scale:y,resolution:_})),d=y}}return new hy({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=Sb(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return ze.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],n=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(s=>{i.push(s.scale),e=s.scale>e?s.scale:e,r=s.scale<r?s.scale:r,n[s.level]=s})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const n=e[i],s=e[i+1];if(n<=t)return i;if(s===t)return i+1;if(n>t&&s<t)return i+Math.log(n/t)/Math.log(n/s)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=r;else if(Js(e.spatialReference,this.spatialReference))s=e.x,o=e.y,i=r;else{const c=$w(e,this.spatialReference);if(c==null)return null;s=c.x,o=c.y,i=r}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i=new HGe(null,0,0,0,jt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=hy.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===hy.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,n=r.resolution*this.size[0]/2**i,s=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=jt()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,n=i*this.size[0],s=i*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return hy.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let n=0;n<i;n++){const s=this.lods[n],o=s.resolution*e;r.push(new kd({level:s.level,scale:s.scale,resolution:o}))}return new hy({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};h([f({type:Number,json:{write:!0}})],Ko.prototype,"compressionQuality",void 0),h([f({type:Number,json:{write:!0}})],Ko.prototype,"dpi",void 0),h([f({type:String,json:{read:Pie.read,write:Pie.write,origins:{"web-scene":{read:!1,write:!1}}}})],Ko.prototype,"format",void 0),h([f({readOnly:!0})],Ko.prototype,"isWrappable",null),h([f({type:ze,json:{write:!0}})],Ko.prototype,"origin",void 0),h([lr("origin")],Ko.prototype,"readOrigin",null),h([f({type:[kd],value:null,json:{write:!0}})],Ko.prototype,"lods",null),h([f({readOnly:!0})],Ko.prototype,"scales",void 0),h([f({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],Ko.prototype,"size",void 0),h([lr("size",["rows","cols"])],Ko.prototype,"readSize",null),h([xr("size",{cols:{type:mn},rows:{type:mn}})],Ko.prototype,"writeSize",null),h([f({type:St,json:{write:!0}})],Ko.prototype,"spatialReference",void 0),Ko=hy=h([N("esri.layers.support.TileInfo")],Ko),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(Ko||(Ko={}));const SD=Ko,WGe=12;let hc=class pl{constructor(e){const r=pl.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=G_(this.spatialReference)||nm(this.spatialReference)||sm(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const n=i.lods.reduce((c,u,d)=>(u.level<c.min&&(c.min=u.level,c.minIndex=d),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),s=i.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new pl(this.toTileInfo())}toTileInfo(){return new SD({dpi:this.dpi,origin:new ze({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new kd({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+i*o,n[2]=this.origin[0]+(i+1)*o,n[3]=this.origin[1]-r*a,n[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=Hte(e[0]),r[1]=g4(e[1]),r[2]=Hte(e[2]),r[3]=g4(e[3])):this._isGCS&&(r[0]=It(e[0]),r[1]=It(e[1]),r[2]=It(e[2]),r[3]=It(e[3]))}getExtentGeometry(e,r,i,n=new Dr){return this.getExtent(e,r,i,Ap),n.spatialReference=this.spatialReference,n.xmin=Ap[0],n.ymin=Ap[1],n.xmax=Ap[2],n.ymax=Ap[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],n=i.resolution/2;this.levels.push({resolution:n,scale:i.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof pl)){if(pl.checkUnsupported(e))return!1;e=new pl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let n=.5*i;return!DT(e.origin[0],this.origin[0],n)||!DT(e.origin[1],this.origin[1],n)?!1:(n=.5*i/2**r/this.pixelSize*WGe,DT(i,e.levels[r].resolution,n))}rootTilesInExtent(e,r=null,i=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;pl.computeRowColExtent(e,s,this.origin,Ap);let o=Ap[1],a=Ap[3],l=Ap[0],c=Ap[2];const u=c-l,d=a-o;if(u*d>i){const p=Math.floor(Math.sqrt(i));d>p&&(o=o+Math.floor(.5*d)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let m=l;m<c;m++)n.push([0,p,m]);return r!=null&&(r[0]=this.origin[0]+l*s[0],r[1]=this.origin[1]-a*s[1],r[2]=this.origin[0]+c*s[0],r[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,r,i,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-i[0])/r[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-i[0])/r[0])),n[1]=Math.max(0,Math.floor((i[1]-e[3]+s)/r[1])),n[3]=Math.max(0,Math.ceil((i[1]-e[1]-s)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(n=>!I6e(n.resolution,i/2**n.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,n)=>i-n);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new Y("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?DZ():e.lods.length<1?new Y("tilingscheme:generic","Tiling scheme must have at least one level"):pl.isPowerOfTwo(e)?pl.hasGapInLevels(e)?new Y("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):pl.tileSizeSupported(e)?pl.hasOriginPerLODs(e)?new Y("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new Y("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new Y("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],n=e[3]-e[1],s=el(r),o=1.2*Math.max(i,n),a=256,l=96,c=.0254,u=new pl(new SD({size:[a,a],origin:new ze({x:e[0]-.5*(o-i),y:e[3]+.5*(o-n)}),lods:[new kd({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const r=new pl(pl.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const n=256/r,s=new pl(new SD({size:[r,r],origin:new ze({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new kd({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(i),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function DZ(){return new Y("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}hc.WebMercatorAuxiliarySphereTileInfo=new SD({size:[256,256],origin:new ze({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:St.WebMercator}),spatialReference:St.WebMercator,lods:[new kd({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),hc.WebMercatorAuxiliarySphere=hc.makeWebMercatorAuxiliarySphere(19);const Ap=jt(),aT=64,F3=512,qGe=2.5,yR=L6e(ZV/10),dwe=2,pwe=jt();hc.WebMercatorAuxiliarySphere.getExtent(0,0,0,pwe);const XGe=jt([-180,-90,180,90]),YGe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",ZGe="Surface extent is too large for tile resolution at level 0.",QGe=3;let JGe=QGe;function JG(t){return t<4?3:JGe}let dy=class extends Bn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=yR}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const r=d6(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??St.WGS84}elevationAt(e,r){var i;if(this.extent==null||!Fa(this.extent,e,r)){const n=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return J.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return uwe(e.clone(),this)}};h([f({readOnly:!0})],dy.prototype,"demResolution",void 0),h([f({readOnly:!0})],dy.prototype,"extent",null),h([f({readOnly:!0})],dy.prototype,"noDataValue",void 0),h([f()],dy.prototype,"spatialReference",null),h([f({constructOnly:!0})],dy.prototype,"view",void 0),dy=h([N("esri.views.support.GroundViewElevationSampler")],dy);const KGe=dy;let py=class extends xe{constructor(e){super(e),this.view=null,this.layerViews=new ir}initialize(){this.addHandles(Dh(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new KGe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>ue(()=>e.updating,()=>this._updateUpdating(),Br)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([f({readOnly:!0})],py.prototype,"elevationSampler",null),h([f({type:Boolean,readOnly:!0})],py.prototype,"updating",null),h([f({constructOnly:!0})],py.prototype,"view",void 0),h([f({type:ir,readOnly:!0})],py.prototype,"layerViews",void 0),h([f({readOnly:!0})],py.prototype,"suspended",null),py=h([N("esri.views.GroundView")],py);const eje=py;let jg=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const n=e[i],s=new Ege(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=Fge(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)wte(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===r;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const n of r.acquired)wte(n)?r.acquired[i++]=n:r.pool.release(n);r.acquired.length=i}}};const tje=se("mac")?"Meta":"Ctrl",Y6={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)Y6[t]=String.fromCharCode(t);for(let t=1;t<25;t++)Y6[111+t]=`F${t}`;for(let t=65;t<91;t++)Y6[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function rje(t){if(t.key!==void 0)return YDe(t);const e=Y6[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function ije(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let nje=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const Mie=J.getLogger("esri.views.input.InputHandler");let Eo=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Mie.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let n;typeof r=="function"?(i=r,n=[]):n=r||[];const s=typeof e=="string"?new nje(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const d=this._incoming[u.match.eventType];if(d){const p=d.indexOf(u);d.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new sje(s,i,{onPause:a,onRemove:a,onResume:u=>{const d=this._incoming[u.match.eventType];d&&!d.includes(u)&&(d.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new oje(e,{onEmit:(i,n,s,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,n,s,o)},onRemove:i=>{var n;delete this._outgoing[i.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Mie.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const n of r)if(n.match.matches(e)&&((i=n.callback)==null||i.call(n,e),e.shouldStopPropagation()))break}}},sje=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},oje=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},aje=class extends Eo{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n}=e;r===this._value&&this._x===i&&this._y===n||(this._value=r,this._x=i,this._y=n,this._onChange(r,i,n))}},lje=class{constructor(e,r){this._observable=new e6,this._value=e,this._equalityFunction=r}get value(){return Ht(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function _R(t,e=lge){return new lje(t,e)}let cje=class extends Eo{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=_R(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},Hu=class extends xe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=tje,this._latestPointerType="mouse",this._propertiesPool=new jg({latestPointerLocation:dje},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=E_.INTERNAL){if(this._nameToGroup[e])return void J.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void J.getLogger(this).error("Can't register a group of zero handlers");const n={name:e,handlers:r.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,d)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,d,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var n;i.removed=!0,(n=i.uninstallCallback)==null||n.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):J.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)ije(a)||r.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==r||n.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=r,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const s=r;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,n=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,n)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const n=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=r.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new aje((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new cje,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],E_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,E_.INTERNAL)}_setPointerCapture(e,r,i,n){const s=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,n){this._emitInputEvent(0,e,r,i,n)}_emitInputEvent(e,r,i,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new uje(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new SG,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:s}=e.events.pop(),o=n.data&&n.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((i=(r=e.currentHandler).eventCallback)==null||i.call(r,n)),n.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new SG;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const n of r.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let n=0;for(;n<r.length&&this._compareHandlerPriority(i,r[n])>=0;)n++;r.splice(n,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};h([f({readOnly:!0})],Hu.prototype,"hasPendingInputs",null),h([f({constructOnly:!0})],Hu.prototype,"eventSource",void 0),h([f({constructOnly:!0})],Hu.prototype,"recognizers",void 0),h([f()],Hu.prototype,"_latestPointerType",void 0),h([f()],Hu.prototype,"latestPointerType",null),h([f()],Hu.prototype,"multiTouchActive",null),h([f({readOnly:!0})],Hu.prototype,"latestPointerLocation",void 0),h([f()],Hu.prototype,"_paused",void 0),h([f({readOnly:!0})],Hu.prototype,"updating",null),Hu=h([N("esri.views.input.InputManager")],Hu);let uje=class{constructor(e,r,i,n,s){this.type=e,this.data=r,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=My.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=My.STOPPED}shouldStopPropagation(){return(this._propagationState&My.STOPPED)!=0}async(e){this._propagationState|=My.PAUSED;const r=(i,n)=>{this._propagationState&=~My.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&My.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var My;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(My||(My={}));const E_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let hje=class{};const dje=hje;function Op(t){return t!=null&&"open"in t&&"declaredClass"in t}function $ie(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const pje=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([ue(()=>[this.ui,this.popup],([r,i],n)=>{const s="popup",o="manual";if(n){const[a,l]=n;a&&Op(l)&&(l.view=null,$ie(l)&&a.remove(l,s))}r&&Op(i)&&(i.view=this,$ie(i)&&r.add(i,{key:s,position:o,internal:!0}))},Pr),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!Op(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(Op(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),Op(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},E_.WIDGET)]),uR(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ce(()=>import("./Popup-db207f4c.js").then(r=>r.a0),["assets/Popup-db207f4c.js","assets/unitFormatUtils-b70a7bff.js","assets/AttachmentInfo-cb670dd0.js","assets/AttachmentQuery-972bbd60.js","assets/widget-78e8b6fe.js","assets/jsonUtils-f73b3833.js","assets/UniqueValueRenderer-fef4204d.js","assets/diffUtils-590c9088.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/Query-1c961d4c.js","assets/executeQueryJSON-7c41ada5.js","assets/query-93c6e211.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/FeatureSet-111cb247.js","assets/RelationshipQuery-39c07195.js","assets/TopFeaturesQuery-e44d05be.js","assets/FeatureLayer-5c6d2c3b.js","assets/MultiOriginJSONSupport-e4912ffd.js","assets/sql-734ecbc5.js","assets/FeatureLayerBase-7c7dfccb.js","assets/commonProperties-30089b06.js","assets/featureLayerUtils-6cf06f83.js","assets/serviceCapabilitiesUtils-959e798a.js","assets/editsZScale-1b5a53a6.js","assets/APIKeyMixin-878a7aa7.js","assets/ArcGISService-83287338.js","assets/CustomParametersMixin-231c4be8.js","assets/EditBusLayer-d71787e9.js","assets/FeatureEffectLayer-4160946c.js","assets/FeatureEffect-86735d98.js","assets/FeatureFilter-00f4be05.js","assets/FeatureReductionLayer-4262cf54.js","assets/LabelClass-2d53c485.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/OperationalLayer-0e8f8b28.js","assets/OrderedLayer-68067459.js","assets/PortalLayer-310c2800.js","assets/portalItemUtils-792a27e1.js","assets/TemporalLayer-f17c9161.js","assets/FeatureTemplate-2a7e96c1.js","assets/FeatureType-db96032c.js","assets/fieldProperties-62c55499.js","assets/labelingInfo-144f3d9f.js","assets/versionUtils-f17daa93.js","assets/styleUtils-25825fd6.js","assets/popupUtils-82ea8abb.js"])})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){Op(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void J.getLogger(this).error(new Y("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),Op(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(s,o,i),u=c.map(d=>d.promise);return{location:n,clientOnlyGraphics:a,allGraphicsPromise:e4([l,...u]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!Op(this.popup))return this._popupSetupTask=hE(async i=>{const{default:n}=await ce(()=>import("./Popup-db207f4c.js").then(o=>o.a0),["assets/Popup-db207f4c.js","assets/unitFormatUtils-b70a7bff.js","assets/AttachmentInfo-cb670dd0.js","assets/AttachmentQuery-972bbd60.js","assets/widget-78e8b6fe.js","assets/jsonUtils-f73b3833.js","assets/UniqueValueRenderer-fef4204d.js","assets/diffUtils-590c9088.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/Query-1c961d4c.js","assets/executeQueryJSON-7c41ada5.js","assets/query-93c6e211.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/FeatureSet-111cb247.js","assets/RelationshipQuery-39c07195.js","assets/TopFeaturesQuery-e44d05be.js","assets/FeatureLayer-5c6d2c3b.js","assets/MultiOriginJSONSupport-e4912ffd.js","assets/sql-734ecbc5.js","assets/FeatureLayerBase-7c7dfccb.js","assets/commonProperties-30089b06.js","assets/featureLayerUtils-6cf06f83.js","assets/serviceCapabilitiesUtils-959e798a.js","assets/editsZScale-1b5a53a6.js","assets/APIKeyMixin-878a7aa7.js","assets/ArcGISService-83287338.js","assets/CustomParametersMixin-231c4be8.js","assets/EditBusLayer-d71787e9.js","assets/FeatureEffectLayer-4160946c.js","assets/FeatureEffect-86735d98.js","assets/FeatureFilter-00f4be05.js","assets/FeatureReductionLayer-4262cf54.js","assets/LabelClass-2d53c485.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/OperationalLayer-0e8f8b28.js","assets/OrderedLayer-68067459.js","assets/PortalLayer-310c2800.js","assets/portalItemUtils-792a27e1.js","assets/TemporalLayer-f17c9161.js","assets/FeatureTemplate-2a7e96c1.js","assets/FeatureType-db96032c.js","assets/fieldProperties-62c55499.js","assets/labelingInfo-144f3d9f.js","assets/versionUtils-f17daa93.js","assets/styleUtils-25825fd6.js","assets/popupUtils-82ea8abb.js"]);if(Bt(i),!this.popup||Op(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new n(s)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,n){return i.map(({layerView:s,graphics:o})=>{const a={clientGraphics:o,event:n!=null?n.event:void 0,signal:n!=null?n.signal:void 0,defaultPopupTemplateEnabled:n!=null&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(r,a);return{layerView:s,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:n,queryArea:s,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:o}}async _popupHitTestGraphics(r,i){const n=await this.popupHitTest(r),s=n.results,o=n.mapPoint,a=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const n=[],s=new Map,o=i.map(a=>{const l=[];return"layer"in a?s.set(a.layer,l):s.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=s.get(a.layer)||s.get(a.sourceLayer)||null;l?l.push(a):n.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:n}}};return h([f({cast(r){return!r||Op(r)||typeof r=="object"&&(r.open=i=>(u4(J.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(u4(J.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),h([f()],e.prototype,"popupEnabled",void 0),e=h([N("esri.views.PopupView")],e),e},Iie={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},fje={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function mje(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function Ok(t,e,r){const i=new Date(t.getTime());if(e&&r){const n=fje[r],{getter:s,setter:o,multiplier:a}=n;if(r==="months"){const l=mje(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[s]()+e*a)}return i}function Lie(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function VOt(t,e,r){return t===0?0:t*Iie[e]/Iie[r]}var md;let Wc=md=class extends ke{static get allTime(){return Die}static get empty(){return gje}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(md.allTime)}get isEmpty(){return this.equals(md.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new md({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=t.start!=null?t.start.getTime():t.start,n=t.end!=null?t.end.getTime():t.end;return e===i&&r===n}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=_h(this.start,i=>Lie(i,t)),r=_h(this.end,i=>{const n=Lie(i,t);return i.getTime()===n.getTime()?n:Ok(n,1,t)});return new md({start:e,end:r})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return md.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,n=((u=t.end)==null?void 0:u.getTime())??1/0;let s,o;if(i>=e&&i<=r?s=i:e>=i&&e<=n&&(s=e),r>=i&&r<=n?o=r:n>=e&&n<=r&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const d=new md;return d.start=s===-1/0?null:new Date(s),d.end=o===1/0?null:new Date(o),d}return md.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new md,{start:i,end:n}=this;return i!=null&&(r.start=Ok(i,t,e)),n!=null&&(r.end=Ok(n,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Die.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new md({start:e,end:r})}};h([f({type:Date,json:{write:{allowNull:!0}}})],Wc.prototype,"end",void 0),h([lr("end")],Wc.prototype,"readEnd",null),h([xr("end")],Wc.prototype,"writeEnd",null),h([f({readOnly:!0,json:{read:!1}})],Wc.prototype,"isAllTime",null),h([f({readOnly:!0,json:{read:!1}})],Wc.prototype,"isEmpty",null),h([f({type:Date,json:{write:{allowNull:!0}}})],Wc.prototype,"start",void 0),h([lr("start")],Wc.prototype,"readStart",null),h([xr("start")],Wc.prototype,"writeStart",null),Wc=md=h([N("esri.TimeExtent")],Wc);const Die=new Wc,gje=new Wc({start:void 0,end:void 0}),yje=Wc;let Mb=class extends ZA{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};h([n0e({Type:z_,ensureType:Qa(z_)})],Mb.prototype,"itemType",void 0),Mb=h([N("esri.support.GraphicsCollection")],Mb);const Nie=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function _je(t,e="system"){if(!t||!Nie.has(t.timeZone))return e;const r=Nie.get(t.timeZone);return bje(t.timeZone)||t.respectsDaylightSaving?r:vje(r)}function vje(t){const e=dr.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${Xa.instance(-r).formatOffset(0,"narrow")}`}function bje(t){return t.startsWith("UTC")}let fy=class extends Cu(ke){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:n}=r;return{timeZone:i,respectsDaylightSaving:n}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:_je(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};h([f()],fy.prototype,"legacy",void 0),h([lr("legacy",["timeZone"])],fy.prototype,"readLegacy",null),h([f({type:String,nonNullable:!0})],fy.prototype,"timeZone",void 0),h([lr("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],fy.prototype,"readTimeZone",null),h([xr("timeZone")],fy.prototype,"writeTimeZone",null),fy=h([N("esri.time.TimeReference")],fy);const fwe=fy;let my=class extends xe{constructor(e){super(e),this.view=null,this.baseLayerViews=new ir,this.referenceLayerViews=new ir,this._loadingHandle=ue(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},Pr)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};h([f({constructOnly:!0})],my.prototype,"view",void 0),h([f({readOnly:!0})],my.prototype,"baseLayerViews",void 0),h([f({readOnly:!0})],my.prototype,"referenceLayerViews",void 0),h([f({readOnly:!0})],my.prototype,"suspended",null),h([f({type:Boolean,readOnly:!0})],my.prototype,"updating",null),my=h([N("esri.views.BasemapView")],my);function wje(t){return"tryRecycleWith"in t}let xje=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=Wo(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,pa(this._controller.signal,()=>{const n=new Y("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!wje(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==r)continue;const o=this.layerView.tryRecycleWith(s,{signal:i});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Bt(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>pa(this._controller.signal,()=>u(wr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var n,s,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:e}),"prefetchResources"in r&&await((n=r.prefetchResources)==null?void 0:n.call(r,{signal:e})),Sje(r))a=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new Y("layer:view-not-supported","No layerview implementation was found");const d=await this.layerViewImporter.importLayerView(r);Bt(e),a="default"in d?new d.default({layer:r,view:i}):new d({layer:r,view:i})}const c=()=>{l=Pi(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=pa(e,c),Bt(e);try{await a.when()}catch(d){throw c(),d}if(!((o=(s=this._map)==null?void 0:s.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new Y("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new Y("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}},Wu=class extends xe{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Df,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const n of r)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Wo(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(pP(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,n=[],s=this.view.ready,o=d=>{if(d!=null){for(const p of d)if(p){i.add(p);const m=this._layerLayerViewInfoMap.get(p);m&&s?m.start():m||this._recyclingInfoMap.has(p)||n.push(p),"layers"in p&&p.layers&&o(p.layers)}}};for(const d of this._rootCollectionNames)o(this.get(d));for(const[d,p]of this._layerLayerViewInfoMap)if(!i.has(d)){this._layerLayerViewInfoMap.delete(p.layer);const m=p.tryRecycle(n);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(p.layer,p),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[d,p]of this._recyclingInfoMap)i.has(d)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy());for(const d of n)this._createLayerView(d);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(u=r==null?void 0:r.basemap)==null?void 0:u.referenceLayers,r==null?void 0:r.layers].filter(d=>!!d);i.forEach(d=>"layers"in d&&a.push(d.layers)),this.addHandles(a.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([Ol(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ue(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),An)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),JU(this._recyclingInfoMap),JU(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(wr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Do(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(JU(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new Y("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=s,a.parent=i,r.at(n)!==a&&r.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<r.length&&r.splice(n,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new xje(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(Zn(i)||i.name==="cancelled:layerview-create")||J.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};h([f()],Wu.prototype,"_workPromise",void 0),h([f({readOnly:!0})],Wu.prototype,"_watchUpdatingTracking",void 0),h([f({readOnly:!0})],Wu.prototype,"_layersToLayerViews",null),h([f({readOnly:!0})],Wu.prototype,"_rootCollectionNames",null),h([f()],Wu.prototype,"layerViewImporter",void 0),h([f()],Wu.prototype,"supportsGround",void 0),h([f({readOnly:!0})],Wu.prototype,"updating",null),h([f({readOnly:!0})],Wu.prototype,"updatingRemaining",null),h([f({constructOnly:!0})],Wu.prototype,"view",void 0),Wu=h([N("esri.views.LayerViewManager")],Wu);const Tje=Wu;function Sje(t){return"createLayerView"in t&&t.createLayerView!=null}let zc=class extends xe{constructor(e){super(e),this.factor=1.5,this.offset=Lh(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};h([f({type:Number})],zc.prototype,"factor",void 0),h([f({nonNullable:!0})],zc.prototype,"offset",void 0),h([f()],zc.prototype,"position",void 0),h([f({type:Number,range:{min:0}})],zc.prototype,"size",void 0),h([f()],zc.prototype,"maskUrl",void 0),h([f()],zc.prototype,"maskEnabled",void 0),h([f()],zc.prototype,"overlayUrl",void 0),h([f()],zc.prototype,"overlayEnabled",void 0),h([f({readOnly:!0})],zc.prototype,"version",null),h([f({type:Boolean})],zc.prototype,"visible",void 0),zc=h([N("esri.views.Magnifier")],zc);const mwe=zc;let Eje=class{constructor(){this._tasks=new Array,this._running=_R(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((n,s)=>this._tasks.push(new Fie(n,s,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((n,s)=>this._tasks.unshift(new Fie(n,s,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const n=ss(r.signal);if(n&&!r.abortCallback)r.reject(wr());else{const s=n?(i=r.abortCallback)==null?void 0:i.call(r,wr()):r.callback(e);Eu(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(n){r.reject(n)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=wr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},Fie=class{constructor(e,r,i,n=void 0,s=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=n,this.abortCallback=s}},U3=class extends xe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};h([f()],U3.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),h([f()],U3.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),U3=h([N("esri.views.support.DebugFlags")],U3);const Cje=new U3;var Cr;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Cr||(Cr={}));function Aje(){return new Z4.Scheduler}var Ho,dt;(function(t){t[t.YIELD=1]="YIELD"})(Ho||(Ho={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(dt||(dt={}));const gf=0,Uie=new Map([[dt.RESOURCE_CONTROLLER_IMMEDIATE,gf],[dt.RESOURCE_CONTROLLER,4],[dt.SLIDE,gf],[dt.STREAM_DATA_LOADER,gf],[dt.ELEVATION_QUERY,gf],[dt.TERRAIN_SURFACE,1],[dt.SURFACE_GEOMETRY_UPDATES,1],[dt.LOD_RENDERER,2],[dt.GRAPHICS_CORE,2],[dt.I3S_CONTROLLER,2],[dt.POINT_CLOUD_LAYER,2],[dt.FEATURE_TILE_FETCHER,2],[dt.OVERLAY,4],[dt.STAGE,4],[dt.GRAPHICS_DECONFLICTOR,4],[dt.FILTER_VISIBILITY,4],[dt.SCALE_VISIBILITY,4],[dt.FRUSTUM_VISIBILITY,4],[dt.CLOUDS_GENERATOR,4],[dt.POINT_OF_INTEREST_FREQUENT,6],[dt.POINT_OF_INTEREST_INFREQUENT,30],[dt.LABELER,8],[dt.FEATURE_QUERY_ENGINE,8],[dt.FEATURE_TILE_TREE,16],[dt.FEATURE_TILE_TREE_ACTIVE,gf],[dt.ELEVATION_ALIGNMENT,12],[dt.TEXT_TEXTURE_ATLAS,12],[dt.TEXTURE_UNLOAD,12],[dt.LINE_OF_SIGHT_TOOL,16],[dt.LINE_OF_SIGHT_TOOL_INTERACTIVE,gf],[dt.SNAPPING,gf],[dt.SHADOW_ACCUMULATOR,30]]);function kie(t){return Uie.has(t)?Uie.get(t):typeof t=="number"?t:1}const zie=6.5,Bie=1,Oje=30,Vie=1e3/30,Gie=100,jie=.9;var Z4,S1;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=_R(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new dg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Cr.INTERACTING,this._tasks=new Nt,this._runQueue=new Nt,this._load=0,this._idleStateCallbacks=new Nt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=ue(()=>Cje.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Pr);for(const o of Object.keys(dt))this.performanceInfo.tasks.set(dt[o],new dg(dt[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:zie,INTERACTING_BUDGET:Vie,IDLE_BUDGET:Gie,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Pi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=kie(s),l=new r(this,s,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new dg(s)),l}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Cr.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Cr.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Cr.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=zie,a=s.frameDuration,l=Bie;switch(this.state){case Cr.IDLE:o=0,a=Math.max(Gie,s.frameDuration),l=Oje;break;case Cr.INTERACTING:a=Math.max(Vie,s.frameDuration);case Cr.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Cr.IDLE&&a<Bie&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Cr.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Cr.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return S1.SCHEDULED;let o=S1.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=S1.READY:o!==S1.READY&&(o=S1.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*jie+s*(1-jie)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===gf&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==gf&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Ho.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){J.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,dt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(dt))this._frameTaskTimes.set(dt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,o,a,l){this._scheduler=s,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new Eje,this._handles=new Vi,this.schedulePriority=this._basePriority,this._task=_R(a??this._queue),this._handles.add(Dh(()=>this.task.running,c=>s.taskRunningChanged(c)))}remove(){this.processQueue(Wa),this._scheduler.removeTask(this),this.schedule=LS.schedule,this.reschedule=LS.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const o=kie(s);this._basePriority!==gf&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){this._queue.runTask(s)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Cr.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(Z4||(Z4={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(S1||(S1={}));const Wa=(()=>{const t=new Z4.Budget;return t.enabled=!1,t})();let Rje=class{remove(){}processQueue(){}schedule(e,r,i){try{if(ss(r)){const n=wr();return i?Promise.resolve(i(n)):Promise.reject(n)}return vV(e(Wa))}catch(n){return Promise.reject(n)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const LS=new Rje;let lT=class extends xe{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(dt.TEXTURE_UNLOAD))??LS}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(n=>this._releaseTextureRequest(n)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){var o,a;const n=this.makeUid(e);let s=this._textureRequests.get(n);if(!s){const l=new gwe(i);l.texture=r(),(o=this._stage)==null||o.add(l.texture),(a=this._stage)==null||a.loadImmediate(l.texture),this._textureRequests.set(n,l),s=l}return s.referenceCount++,{uid:n,texture:s.texture,release:()=>this._release(n)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.onRemove&&e.onRemove(),e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};h([f()],lT.prototype,"_frameTask",void 0),h([f()],lT.prototype,"updating",null),lT=h([N("esri.views.3d.support.TextureCollection")],lT);let gwe=class{constructor(e){this.onRemove=e,this.referenceCount=0}};var Hie;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Hie||(Hie={}));const ywe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],_we={};function vwe(t){return!!_we[t]}function Pje(t){for(const e of t)if(!vwe(e))return!1;return!0}ywe.forEach(t=>{_we[t]=!0});let Mje=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,n){const s=Array.isArray(e)?e:e.split(",");if(!Pje(s))return s.some(vwe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:n=i,n=n??E_.DEFAULT;const l=this._createUniqueGroupName(),c=new $je(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const u of s){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),{remove:()=>this._removeHandler(l,s)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const n=this._handlerCounts.get(i);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):n===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},$je=class extends Eo{constructor(e,r,i,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of r)switch(s){case"click":this.registerIncoming("click",i,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,screenPoint:Lh(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Lh(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:n}=r.center,{action:s,pointerType:o,button:a}=r;if(s==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:d}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:p,pointerType:o,button:a,buttons:c,radius:r.radius,angle:Ka(r.angle),native:l,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:d,timestamp:p}=e;return{type:r,x:i,y:n,pointerId:c,pointerType:u,button:s,buttons:o,native:a,timestamp:p,eventId:l,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:p,timestamp:m}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:n,action:u,origin:d,native:s,timestamp:m,eventId:o,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:n,timestamp:o,action:r,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var vR,Wie,qie;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(vR||(vR={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Wie||(Wie={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(qie||(qie={}));function Ije(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return J.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function KG(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(vR.USER)&&t.getEditableFlag(vR.MANAGER)}function rf(t){return Lh(t.x,t.y)}function iRt(t){return Xi(t.x,t.y)}function bwe(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?Lh(e.clientX-r.left,e.clientY-r.top):Lh(0,0)}function Xie(t,e){return e instanceof Event?bwe(t,e):rf(e)}function Yie(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Lje=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Zie(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Qie(e))break;const n=rf(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!Qie(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=_h(n,({manipulator:u})=>u),o=_h(n,({tool:u})=>u);if(s==null||o==null)break;const a=rf(e);a.x=ge(a.x,0,r.view.width),a.y=ge(a.y,0,r.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const n=rf(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(Dje(e)||r.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const n=rf(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const n=rf(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const n=rf(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:rf(r)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=_h(this._grabbedManipulators.get(e.pointerId),({manipulator:n})=>n);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:rf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return Do(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:n})=>{r.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{i.add(n)}),e(n=>{n.hasGrabbedManipulators=r.has(n),n.hasHoveredManipulators=i.has(n);const s=this._grabbedManipulators.values(),o=iDe(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},n=!0,s){const o=(a,l)=>a===e&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let n=null;return i(s=>{if(s.manipulators==null||!KG(s))return!1;const o=s.manipulators.intersect(e,r);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Lh(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Zie(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(rf(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,n){let s=this._intersect(e,i,n);const o=_h(this._hoveredManipulators.get(r),({manipulator:a})=>a);s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(r,s)):this._hoveredManipulators.delete(r),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Zie(t){return t==="mouse"}function Qie(t){return t.pointerType!=="mouse"||t.button===0}function Dje(t){return!!t.native.shiftKey}const Jie="attached",Rk="tools",Nje=1e3;let gd=class extends pR{constructor(e){super(e),this._clock=hP,this._manipulatorState=new Lje,this.tools=new ir,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(ywe,e=>{this._handleInputEvent(e)},E_.TOOL),...Ije(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void J.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const n=KG(i);this.activeTool!=null&&n||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=Pi(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,Nje)}attach(){var e;this.view.type==="3d"?(this._set("textures",new lT(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ue(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r))),Za(()=>this._set("textures",Me(this.textures)))],Jie)):this.handles.add(ue(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(Jie),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(n=>{!r&&n.visible&&n.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(Rk),this._forEachTool(e=>{if(e instanceof xe){const r=ue(()=>[e.cursor,e.visible,e.editable],()=>{KG(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,Rk)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],Rk)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,vR.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){return{setClock:e=>this._clock=e}}};h([f({constructOnly:!0,nonNullable:!0})],gd.prototype,"view",void 0),h([f({readOnly:!0,nonNullable:!0})],gd.prototype,"textures",void 0),h([f({value:null})],gd.prototype,"activeTool",null),h([f({readOnly:!0,type:ir})],gd.prototype,"tools",void 0),h([f({readOnly:!0})],gd.prototype,"cursor",void 0),h([f({readOnly:!0})],gd.prototype,"updating",null),h([f()],gd.prototype,"_interacting",void 0),h([f({readOnly:!0})],gd.prototype,"interacting",null),gd=h([N("esri.views.ToolViewManager")],gd);let _2=class extends xe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Fje.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Uje[this.deviceType]}};h([f({nonNullable:!0,readOnly:!0})],_2.prototype,"nativeIndex",void 0),h([f({type:String,readOnly:!0})],_2.prototype,"deviceType",null),h([f({type:Number,readOnly:!0})],_2.prototype,"axisThreshold",null),_2=h([N("esri.views.input.gamepad.GamepadInputDevice")],_2);const Fje=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Uje={standard:.15,spacemouse:.025,unknown:0},NZ=_2;let k3=class extends xe{constructor(...e){super(...e),this.devices=new ir,this.enabledFocusMode="document"}};h([f({type:ir.ofType(NZ),readOnly:!0})],k3.prototype,"devices",void 0),h([f({type:["document","view","none"]})],k3.prototype,"enabledFocusMode",void 0),k3=h([N("esri.views.input.gamepad.GamepadSettings")],k3);const kje=k3;let ED=class extends xe{constructor(){super(...arguments),this.gamepad=new kje}};h([f({readOnly:!0})],ED.prototype,"gamepad",void 0),ED=h([N("esri.views.input.Input")],ED);const zje=ED;let gy=class extends xe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};h([f({type:Boolean,nonNullable:!0})],gy.prototype,"enabled",void 0),h([f({type:NZ})],gy.prototype,"device",void 0),h([f({type:["pan","zoom"],nonNullable:!0})],gy.prototype,"mode",void 0),h([f({type:["forward-down","forward-up"],nonNullable:!0})],gy.prototype,"tiltDirection",void 0),h([f({type:Number,nonNullable:!0})],gy.prototype,"velocityFactor",void 0),gy=h([N("esri.views.navigation.gamepad.GamepadSettings")],gy);const wwe=gy;let Tv=class extends xe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new wwe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};h([f({type:Boolean})],Tv.prototype,"browserTouchPanEnabled",void 0),h([f({type:wwe,nonNullable:!0})],Tv.prototype,"gamepad",void 0),h([f({type:Boolean})],Tv.prototype,"momentumEnabled",void 0),h([f({type:Boolean})],Tv.prototype,"mouseWheelZoomEnabled",void 0),Tv=h([N("esri.views.navigation.Navigation")],Tv);const xwe=Tv,Twe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},Swe=Object.values(Twe),Ewe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${Swe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Bje=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${Swe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Vje=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function hRt(t){return!!Ewe.test(t)}function FZ(t){if(t==null)return null;const e=Ja(t),r=e.path.match(Ewe)||e.path.match(Bje);if(!r)return null;const[,i,n,s,o]=r,a=n.indexOf("/");return{title:Cwe(a!==-1?n.slice(a+1):n),serverType:Twe[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function Gje(t){const e=Ja(t).path.match(Vje);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function Cwe(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function dRt(t,e){const r=[];if(t){const i=FZ(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=Cwe(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function pRt(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(n);return s&&o}function fRt(t,e){return t&&y0e(v0e(t,e))}function mRt(t){let{url:e}=t;if(!e)return{url:e};e=v0e(e,t.logger);const r=Ja(e),i=FZ(r.path);let n;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(n=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const s=Gje(r.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:y0e(e),layerId:n}}function gRt(t,e,r,i,n){sw(e,i,"url",n),i.url&&t.layerId!=null&&(i.url=s6(i.url,r,t.layerId.toString()))}function yRt(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return r&&(i||n||s)}function _Rt(t,e,r){const i=Awe(t),n=e,s=jje(i,n,r);if(i){const o=CP.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new Y("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new Y("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!Hje(t)||s===ic.Unsupported)return new Y("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(s){case ic.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new Y("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case ic.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new Y("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case ic.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new Y("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}}return null}function jje(t,e,r){if(!Kie(t)||!Kie(e))return ic.Unsupported;if(t==null||e==null)return ic.Ok;if(!r&&t.heightUnit!==e.heightUnit)return ic.Units;if(t.heightModel!==e.heightModel)return ic.HeightModel;switch(t.heightModel){case"gravity-related-height":return ic.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?ic.Ok:ic.CRS;default:return ic.Unsupported}}var ic;function Kie(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function Hje(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!Pwe(t)}function Awe(t){var i;const e=t.url?FZ(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&Owe(t)&&t.heightModelInfo?t.heightModelInfo:Pwe(t)?CP.deriveUnitFromSR(qje,t.spatialReference):null}function Owe(t){return"heightModelInfo"in t}function Rwe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function Pwe(t){return Rwe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):Mwe(t)}function Wje(t){return t.layers!=null||Mwe(t)||Rwe(t)||Owe(t)}function Mwe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(ic||(ic={}));const qje=new CP({heightModel:"gravity-related-height"});var $e;function ene(t){return t==="global"?$e.Global:$e.Local}function Pk(t){return t===$e.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})($e||($e={}));let ej,Mk=null;async function Xje(t){Mk||(Mk=ce(()=>Promise.resolve().then(()=>wft),void 0).then(e=>ej=e)),await Mk,Bt(t)}async function $we(t,e,r,i){if(!t)return null;const n=t.spatialReference;return D6()||Bg(n,e)?xE(t,e):ej?ej.projectGeometry(t,e,r,i):(await Promise.race([Xje(i),fR(i)]),$we(t,e,r,i))}let Di=class extends xe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=yu(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,n,s,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(i);return{spatialReference:n!=null?n.spatialReference:null,viewingMode:n!=null?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,n,s,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(n=(i=this.map)==null?void 0:i.call(this))==null?void 0:n.basemap,layers:(a=(o=(s=this.map)==null?void 0:s.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,n,s;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(Wje(o)){const a=Awe(o);if(a)return{heightModelInfo:a,vcsWkid:(n=o.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=o.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)i.push({extent:l,layer:n})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),n=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=yu(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:n.clone(),task:hE(async s=>{try{const o=await $we(i.extent,n,"portalItem"in i.layer?i.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(ss(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],n=(s,o)=>s!=null?o!=null?s===o&&s:s:o;for(const s of e)for(const o of r){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:s.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==$e.Local)&&(e=e.filter(({viewingMode:i})=>i!==$e.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const n of r){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(s!=null){const o=s.constraints!=null?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new Yje;for(const n of e)if(this._collectCollection(n,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{Zn(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};h([f()],Di.prototype,"required",void 0),h([f({constructOnly:!0})],Di.prototype,"map",void 0),h([f({constructOnly:!0})],Di.prototype,"getSpatialReferenceSupport",void 0),h([f()],Di.prototype,"defaultSpatialReference",void 0),h([f()],Di.prototype,"userSpatialReference",void 0),h([f()],Di.prototype,"sourcePreloadCount",void 0),h([f()],Di.prototype,"priorityCollection",void 0),h([f()],Di.prototype,"requiresExtentInSpatialReference",void 0),h([f()],Di.prototype,"suspended",void 0),h([f({readOnly:!0})],Di.prototype,"ready",null),h([f({readOnly:!0})],Di.prototype,"heightModelInfoReady",null),h([f({readOnly:!0})],Di.prototype,"spatialReference",null),h([f({readOnly:!0})],Di.prototype,"extent",null),h([f({readOnly:!0})],Di.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Di.prototype,"vcsWkid",null),h([f({readOnly:!0})],Di.prototype,"latestVcsWkid",null),h([f({readOnly:!0})],Di.prototype,"viewingMode",null),h([f({readOnly:!0})],Di.prototype,"tileInfo",null),h([f({readOnly:!0})],Di.prototype,"mapCollections",null),h([f({readOnly:!0})],Di.prototype,"_allLayers",null),h([f({readOnly:!0})],Di.prototype,"_spatialReferenceTask",null),h([f({readOnly:!0})],Di.prototype,"_tileInfoTask",null),h([f({readOnly:!0})],Di.prototype,"_heightModelInfoTask",null),h([f({readOnly:!0})],Di.prototype,"_extentCandidatesTask",null),h([f()],Di.prototype,"_extentTask",null),h([f()],Di.prototype,"_projectExtentTask",void 0),Di=h([N("esri.views.support.DefaultsFromMap")],Di);let Yje=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var z3;let Rt=z3=class extends P6(Bn.EventedMixin(t6(xe))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new sR({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:Qje}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new Mb,this.analyses=new $S,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ir,this.magnifier=new mwe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new fwe,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new zje,this.navigation=new xwe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Mje(this),this.persistableViewModels=new ir,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(ue(()=>this.preconditionsReady,e=>{var r,i;e?(this._currentSpatialReference=this.spatialReference,z3.views.add(this)):(this._currentSpatialReference=null,z3.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Br))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,uR(()=>this.ready)))),this.basemapView=new my({view:this}),this.layerViewManager=new Tje({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new gd({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ue(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),ue(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),ue(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([ue(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const n=Za(()=>t=yu(t));t=hE(async s=>{try{await XO(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}J.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(n,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(z3.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Me(this.graphics),this.analyses=Me(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Me(this.analysisViewManager),this.toolViewManager=Me(this.toolViewManager),this.layerViewManager=Me(this.layerViewManager),this.basemapView=Me(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=Me(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return J.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Di({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Dg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(J.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Dg.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!Js(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new Y("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&J.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Dh(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Rt.views=new ir,h([f()],Rt.prototype,"_userSpatialReference",void 0),h([f()],Rt.prototype,"activeTool",null),h([f({readOnly:!0})],Rt.prototype,"allLayerViews",void 0),h([f()],Rt.prototype,"groundView",void 0),h([f()],Rt.prototype,"animation",null),h([f()],Rt.prototype,"basemapView",void 0),h([f()],Rt.prototype,"center",null),h([f({readOnly:!0})],Rt.prototype,"_defaultsFromMapSettings",null),h([f()],Rt.prototype,"defaultsFromMap",null),h([f()],Rt.prototype,"fatalError",void 0),h([f({type:Dr})],Rt.prototype,"extent",null),h([f(F4(Mb,"graphics"))],Rt.prototype,"graphics",void 0),h([f(F4($S,"analyses"))],Rt.prototype,"analyses",void 0),h([f({readOnly:!0,type:CP})],Rt.prototype,"heightModelInfo",null),h([f({readOnly:!0})],Rt.prototype,"interacting",null),h([f({readOnly:!0})],Rt.prototype,"navigating",null),h([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Rt.prototype,"preconditionsReady",null),h([f({readOnly:!0})],Rt.prototype,"typeSpecificPreconditionsReady",void 0),h([f({type:ir,readOnly:!0})],Rt.prototype,"layerViews",void 0),h([f()],Rt.prototype,"resolution",null),h([f({type:mwe})],Rt.prototype,"magnifier",void 0),h([f({value:null,type:Wye})],Rt.prototype,"map",null),h([f()],Rt.prototype,"padding",void 0),h([f({readOnly:!0})],Rt.prototype,"ready",void 0),h([f({type:St})],Rt.prototype,"spatialReference",null),h([f()],Rt.prototype,"spatialReferenceWarningDelay",void 0),h([f()],Rt.prototype,"stationary",null),h([f({readOnly:!0})],Rt.prototype,"supportsGround",void 0),h([f({type:yje})],Rt.prototype,"timeExtent",void 0),h([f({type:fwe,nonNullable:!0})],Rt.prototype,"timeReference",void 0),h([f()],Rt.prototype,"tools",null),h([f()],Rt.prototype,"toolViewManager",void 0),h([f({readOnly:!0})],Rt.prototype,"type",void 0),h([f({type:Number})],Rt.prototype,"scale",void 0),h([f({readOnly:!0})],Rt.prototype,"updating",void 0),h([f({readOnly:!0})],Rt.prototype,"initialExtentRequired",void 0),h([f({readOnly:!0})],Rt.prototype,"initialExtent",null),h([f()],Rt.prototype,"cursor",null),h([f({readOnly:!0})],Rt.prototype,"input",void 0),h([f({type:xwe,nonNullable:!0})],Rt.prototype,"navigation",void 0),h([f()],Rt.prototype,"layerViewManager",void 0),h([f()],Rt.prototype,"analysisViewManager",void 0),h([f()],Rt.prototype,"width",void 0),h([f()],Rt.prototype,"height",void 0),h([f({readOnly:!0})],Rt.prototype,"resizing",void 0),h([f({value:null,readOnly:!0})],Rt.prototype,"size",null),h([f({readOnly:!0})],Rt.prototype,"suspended",void 0),h([f({readOnly:!0})],Rt.prototype,"viewEvents",void 0),h([f({readOnly:!0})],Rt.prototype,"persistableViewModels",void 0),h([f()],Rt.prototype,"_isValid",void 0),h([f()],Rt.prototype,"_readyCycleForced",void 0),h([f()],Rt.prototype,"_currentSpatialReference",void 0),Rt=z3=h([N("esri.views.View")],Rt);const Zje=Rt;function Qje(t){return t.layerViews}let yy=class extends h4{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Wo(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new Y("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=Eu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};h([f({readOnly:!0})],yy.prototype,"done",null),h([f({readOnly:!0,type:String})],yy.prototype,"state",void 0),h([f()],yy.prototype,"target",void 0),yy=h([N("esri.views.ViewAnimation")],yy),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(yy||(yy={}));const DS=yy,hC=()=>ce(()=>import("./TileLayerView3D-844ae299.js"),["assets/TileLayerView3D-844ae299.js","assets/LayerView3D-ffd35809.js","assets/TiledLayerView3D-a11f8026.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/MapServiceLayerViewHelper-fdadc63a.js","assets/floorFilterUtils-080a7cd2.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/sql-734ecbc5.js","assets/sublayerUtils-1269bca6.js","assets/popupUtils-f04ec9a9.js","assets/drapedUtils-909caa2b.js"]),tne=()=>ce(()=>import("./ElevationLayerView3D-eeaaa8c4.js"),["assets/ElevationLayerView3D-eeaaa8c4.js","assets/LayerView3D-ffd35809.js","assets/TiledLayerView3D-a11f8026.js","assets/LayerView-448bc5ea.js"]),rne={"base-dynamic":()=>ce(()=>import("./BaseDynamicLayerView3D-83fabc6e.js"),["assets/BaseDynamicLayerView3D-83fabc6e.js","assets/DynamicLayerView3D-b48678f2.js","assets/LayerView3D-ffd35809.js","assets/projectExtentUtils-efa4cddd.js","assets/ImageMaterial-5c48df66.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js"]),"base-elevation":tne,"base-tile":hC,"bing-maps":hC,"building-scene":()=>ce(()=>import("./BuildingSceneLayerView3D-15511316.js"),["assets/BuildingSceneLayerView3D-15511316.js","assets/BuildingGroupSublayer-d6113346.js","assets/BuildingComponentSublayer-5d49e5f9.js","assets/UniqueValueRenderer-fef4204d.js","assets/diffUtils-590c9088.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/FeatureLayer-5c6d2c3b.js","assets/MultiOriginJSONSupport-e4912ffd.js","assets/sql-734ecbc5.js","assets/FeatureLayerBase-7c7dfccb.js","assets/commonProperties-30089b06.js","assets/featureLayerUtils-6cf06f83.js","assets/AttachmentQuery-972bbd60.js","assets/Query-1c961d4c.js","assets/RelationshipQuery-39c07195.js","assets/serviceCapabilitiesUtils-959e798a.js","assets/editsZScale-1b5a53a6.js","assets/queryZScale-8f9616ff.js","assets/FeatureSet-111cb247.js","assets/APIKeyMixin-878a7aa7.js","assets/ArcGISService-83287338.js","assets/CustomParametersMixin-231c4be8.js","assets/EditBusLayer-d71787e9.js","assets/FeatureEffectLayer-4160946c.js","assets/FeatureEffect-86735d98.js","assets/FeatureFilter-00f4be05.js","assets/FeatureReductionLayer-4262cf54.js","assets/LabelClass-2d53c485.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/OperationalLayer-0e8f8b28.js","assets/OrderedLayer-68067459.js","assets/PortalLayer-310c2800.js","assets/portalItemUtils-792a27e1.js","assets/TemporalLayer-f17c9161.js","assets/FeatureTemplate-2a7e96c1.js","assets/FeatureType-db96032c.js","assets/fieldProperties-62c55499.js","assets/labelingInfo-144f3d9f.js","assets/versionUtils-f17daa93.js","assets/styleUtils-25825fd6.js","assets/TopFeaturesQuery-e44d05be.js","assets/popupUtils-82ea8abb.js","assets/capabilities-5d185925.js","assets/I3SIndexInfo-445e6968.js","assets/I3SLayerDefinitions-ffdb3821.js","assets/I3SUtil-2c288808.js","assets/I3SBinaryReader-2b8e30f7.js","assets/popupUtils-f04ec9a9.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/I3SMeshView3D-86f2c945.js","assets/I3SOverrides-96f73e2b.js","assets/I3SNode-2025159f.js","assets/meshFeatureSet-8442b8e6.js","assets/FeatureLayerView3D-7e7e2653.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/EventedSet-d13fada5.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/SceneModification-2715f58a.js","assets/persistable-ca976a2c.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-91e7c3ce.js","assets/SceneLayerWorker-e92c2264.js","assets/I3SQueryFeatureStore-0cfa6ebc.js","assets/DefinitionExpressionSceneLayerView-66b62d34.js"]),csv:()=>ce(()=>import("./CSVLayerView3D-f68a6513.js"),["assets/CSVLayerView3D-f68a6513.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/Query-1c961d4c.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureSet-111cb247.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js"]),dimension:()=>ce(()=>import("./DimensionLayerView3D-9f833e6e.js"),["assets/DimensionLayerView3D-9f833e6e.js","assets/LayerView3D-ffd35809.js","assets/LayerView-448bc5ea.js"]),elevation:tne,feature:()=>ce(()=>import("./FeatureLayerView3D-7e7e2653.js"),["assets/FeatureLayerView3D-7e7e2653.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/Query-1c961d4c.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureSet-111cb247.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js"]),geojson:()=>ce(()=>import("./GeoJSONLayerView3D-be497a18.js"),["assets/GeoJSONLayerView3D-be497a18.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/Query-1c961d4c.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureSet-111cb247.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js"]),graphics:()=>ce(()=>import("./GraphicsLayerView3D-f93de954.js"),["assets/GraphicsLayerView3D-f93de954.js","assets/LayerView3D-ffd35809.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/GraphicsProcessor-750d4e2b.js","assets/diffUtils-590c9088.js","assets/Query-1c961d4c.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView-448bc5ea.js"]),group:()=>ce(()=>import("./GroupLayerView-c93dbf5e.js"),["assets/GroupLayerView-c93dbf5e.js","assets/LayerView-448bc5ea.js"]),imagery:()=>ce(()=>import("./ImageryLayerView3D-b65487bb.js"),["assets/ImageryLayerView3D-b65487bb.js","assets/DynamicLayerView3D-b48678f2.js","assets/LayerView3D-ffd35809.js","assets/projectExtentUtils-efa4cddd.js","assets/ImageMaterial-5c48df66.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/commonProperties-30089b06.js","assets/Query-1c961d4c.js","assets/popupUtils-f04ec9a9.js"]),"integrated-mesh":()=>ce(()=>import("./IntegratedMeshLayerView3D-9c474b52.js"),["assets/IntegratedMeshLayerView3D-9c474b52.js","assets/I3SMeshView3D-86f2c945.js","assets/I3SOverrides-96f73e2b.js","assets/I3SNode-2025159f.js","assets/I3SUtil-2c288808.js","assets/Query-1c961d4c.js","assets/I3SBinaryReader-2b8e30f7.js","assets/meshFeatureSet-8442b8e6.js","assets/FeatureSet-111cb247.js","assets/FeatureLayerView3D-7e7e2653.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/SceneModification-2715f58a.js","assets/persistable-ca976a2c.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-91e7c3ce.js","assets/SceneLayerWorker-e92c2264.js"]),"line-of-sight":()=>ce(()=>import("./LineOfSightLayerView3D-75d7761d.js"),["assets/LineOfSightLayerView3D-75d7761d.js","assets/LayerView3D-ffd35809.js","assets/LayerView-448bc5ea.js"]),"map-image":()=>ce(()=>import("./MapImageLayerView3D-5536e520.js"),["assets/MapImageLayerView3D-5536e520.js","assets/DynamicLayerView3D-b48678f2.js","assets/LayerView3D-ffd35809.js","assets/projectExtentUtils-efa4cddd.js","assets/ImageMaterial-5c48df66.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/commonProperties-30089b06.js","assets/ExportImageParameters-649a2637.js","assets/sql-734ecbc5.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-1269bca6.js","assets/MapServiceLayerViewHelper-fdadc63a.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/popupUtils-f04ec9a9.js","assets/drapedUtils-909caa2b.js"]),media:()=>ce(()=>import("./MediaLayerView3D-69d89f9a.js"),["assets/MediaLayerView3D-69d89f9a.js","assets/MediaElementView-dc36bc9f.js","assets/normalizeUtilsSync-6be8435f.js","assets/normalizeUtilsCommon-500064b3.js","assets/LayerView3D-ffd35809.js","assets/ImageMaterial-5c48df66.js","assets/LayerView-448bc5ea.js"]),"ogc-feature":()=>ce(()=>import("./OGCFeatureLayerView3D-dbd9812b.js"),["assets/OGCFeatureLayerView3D-dbd9812b.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/Query-1c961d4c.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureSet-111cb247.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js"]),"open-street-map":hC,"oriented-imagery":()=>ce(()=>import("./FeatureLayerView3D-7e7e2653.js"),["assets/FeatureLayerView3D-7e7e2653.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/Query-1c961d4c.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureSet-111cb247.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js"]),"point-cloud":()=>ce(()=>import("./PointCloudLayerView3D-35572558.js").then(t=>t.P),["assets/PointCloudLayerView3D-35572558.js","assets/LayerView3D-ffd35809.js","assets/I3SUtil-2c288808.js","assets/Query-1c961d4c.js","assets/I3SBinaryReader-2b8e30f7.js","assets/PointCloudWorkerUtil-ec4f2005.js","assets/PointCloudUniqueValueRenderer-df78a172.js","assets/PopupSceneLayerView-c49dd096.js","assets/popupUtils-f04ec9a9.js","assets/LayerView-448bc5ea.js"]),voxel:()=>ce(()=>import("./VoxelLayerView3D-a9ee300f.js"),["assets/VoxelLayerView3D-a9ee300f.js","assets/LayerView3D-ffd35809.js","assets/PopupSceneLayerView-c49dd096.js","assets/popupUtils-f04ec9a9.js","assets/LayerView-448bc5ea.js"]),route:()=>ce(()=>import("./RouteLayerView3D-0557987b.js"),["assets/RouteLayerView3D-0557987b.js","assets/Stop-9d81fe58.js","assets/LayerView3D-ffd35809.js","assets/GraphicsProcessor-750d4e2b.js","assets/diffUtils-590c9088.js","assets/Query-1c961d4c.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/projectExtentUtils-efa4cddd.js","assets/EventedSet-d13fada5.js","assets/LayerView-448bc5ea.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ce(()=>import("./SceneLayerView3D-ef96402b.js"),["assets/SceneLayerView3D-ef96402b.js","assets/I3SOverrides-96f73e2b.js","assets/I3SNode-2025159f.js","assets/I3SUtil-2c288808.js","assets/Query-1c961d4c.js","assets/I3SBinaryReader-2b8e30f7.js","assets/meshFeatureSet-8442b8e6.js","assets/FeatureSet-111cb247.js","assets/FeatureLayerView3D-7e7e2653.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/I3SMeshView3D-86f2c945.js","assets/SceneModification-2715f58a.js","assets/persistable-ca976a2c.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-91e7c3ce.js","assets/SceneLayerWorker-e92c2264.js","assets/SceneLayerView-b7d3fe23.js","assets/DefinitionExpressionSceneLayerView-66b62d34.js","assets/I3SQueryFeatureStore-0cfa6ebc.js","assets/PopupSceneLayerView-c49dd096.js"]):ce(()=>import("./SceneLayerGraphicsView3D-8d7d0182.js"),["assets/SceneLayerGraphicsView3D-8d7d0182.js","assets/I3SOverrides-96f73e2b.js","assets/I3SNode-2025159f.js","assets/I3SUtil-2c288808.js","assets/Query-1c961d4c.js","assets/I3SBinaryReader-2b8e30f7.js","assets/meshFeatureSet-8442b8e6.js","assets/FeatureSet-111cb247.js","assets/FeatureLayerView3D-7e7e2653.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/SceneLayerView-b7d3fe23.js","assets/DefinitionExpressionSceneLayerView-66b62d34.js","assets/PopupSceneLayerView-c49dd096.js"]),stream:()=>ce(()=>import("./StreamLayerView3D-9f3bc35d.js"),["assets/StreamLayerView3D-9f3bc35d.js","assets/StreamFeatureManager-4b8ac3ac.js","assets/createConnection-4b117798.js","assets/query-93c6e211.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/Query-1c961d4c.js","assets/EventedSet-d13fada5.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureSet-111cb247.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/LayerView-448bc5ea.js"]),tile:hC,"imagery-tile":()=>ce(()=>import("./ImageryTileLayerView3D-7bc4c9c1.js"),["assets/ImageryTileLayerView3D-7bc4c9c1.js","assets/LayerView3D-ffd35809.js","assets/TiledLayerView3D-a11f8026.js","assets/commonProperties-30089b06.js","assets/rasterProjectionHelper-072edec4.js","assets/popupUtils-f04ec9a9.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/drapedUtils-909caa2b.js"]),"vector-tile":()=>ce(()=>import("./VectorTileLayerView3D-617343b6.js"),["assets/VectorTileLayerView3D-617343b6.js","assets/Rect-98da58d6.js","assets/pbf-d9aa3914.js","assets/rasterizingUtils-4df93c6e.js","assets/TileInfoView-346e56d0.js","assets/definitions-0bc08d4c.js","assets/number-e491b09e.js","assets/GeometryUtils-0258f920.js","assets/StyleRepository-2362164f.js","assets/colorUtils-c0f43caf.js","assets/TileClipper-ae6eca9e.js","assets/LayerView3D-ffd35809.js","assets/TiledLayerView3D-a11f8026.js","assets/LayerView-448bc5ea.js"]),wcs:()=>ce(()=>import("./ImageryTileLayerView3D-7bc4c9c1.js"),["assets/ImageryTileLayerView3D-7bc4c9c1.js","assets/LayerView3D-ffd35809.js","assets/TiledLayerView3D-a11f8026.js","assets/commonProperties-30089b06.js","assets/rasterProjectionHelper-072edec4.js","assets/popupUtils-f04ec9a9.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/drapedUtils-909caa2b.js"]),"web-tile":hC,wfs:()=>ce(()=>import("./WFSLayerView3D-37f84843.js"),["assets/WFSLayerView3D-37f84843.js","assets/FeatureLayerViewBase3D-8474587e.js","assets/FeatureLikeLayerView3D-2e3185ce.js","assets/Query-1c961d4c.js","assets/dehydratedFeatureComparison-a3375a3e.js","assets/queryForSymbologySnapping-0264f2b5.js","assets/elevationInfoUtils-4fd79d95.js","assets/hash-6f442295.js","assets/diffUtils-590c9088.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js","assets/FeatureFilter-00f4be05.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-19eda5ff.js","assets/normalizeUtils-cf8b8053.js","assets/normalizeUtilsCommon-500064b3.js","assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-42e44ded.js","assets/utils-2fe9d339.js","assets/generateRendererUtils-1e52a587.js","assets/FeatureSet-111cb247.js","assets/FeatureStore-f0e312fc.js","assets/BoundsStore-b6bd3c14.js","assets/projectExtentUtils-efa4cddd.js","assets/LayerView3D-ffd35809.js","assets/query-93c6e211.js","assets/pbfQueryUtils-26a87215.js","assets/pbf-d9aa3914.js","assets/queryZScale-8f9616ff.js","assets/EventedSet-d13fada5.js","assets/commonProperties-30089b06.js","assets/FeatureEffect-86735d98.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js"]),wms:()=>ce(()=>import("./WMSLayerView3D-4330be5d.js"),["assets/WMSLayerView3D-4330be5d.js","assets/DynamicLayerView3D-b48678f2.js","assets/LayerView3D-ffd35809.js","assets/projectExtentUtils-efa4cddd.js","assets/ImageMaterial-5c48df66.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js","assets/commonProperties-30089b06.js","assets/ExportWMSImageParameters-d63354ac.js"]),wmts:()=>ce(()=>import("./WMTSLayerView3D-b2043cf0.js"),["assets/WMTSLayerView3D-b2043cf0.js","assets/LayerView3D-ffd35809.js","assets/TiledLayerView3D-a11f8026.js","assets/LayerView-448bc5ea.js","assets/RefreshableLayerView-915e7f53.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function Jje(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Y(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const ine={hasLayerViewModule:t=>rne[t.type]!=null,importLayerView:t=>{const e=rne[t.type];if(e==null)throw Jje(t);return e(t)}},nne="analyses-owner-handles";var cT,eb;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(cT||(cT={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(eb||(eb={}));let Sv=class extends pR{constructor(e){super(e),this._allAnalysisViews=new ir,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=sne(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(wr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(wr()),this._attachedToViewResolver=sne()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===eb.REMOVED)throw new Y("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),nne)}_disconnectOwners(){this.handles.remove(nne),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const r=e.on("after-add",n=>this._addAnalysis(n.item)),i=e.on("after-remove",n=>this._removeAnalysis(n.item));return{remove:()=>{r.remove(),i.remove();for(const n of e)this._removeAnalysis(n)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:cT.PENDING,list:eb.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=hE(n=>this._createAnalysisViewPromise(i,n))}else r.state.list=eb.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=eb.REMOVED,this._scheduleUpdate()):J.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=pP(()=>this._update()))}_update(){this._scheduledUpdateHandle=Pi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===eb.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case cT.PENDING:e.createAnalysisViewTask=yu(e.createAnalysisViewTask);break;case cT.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Me(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,n=i.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(ss(r))throw this._creatingViewCount-=1,wr("AnalysisView creation aborted");const o=new s.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(ss(r))throw this._creatingViewCount-=1,o.destroy(),wr("AnalysisView creation aborted");return e.view=o,e.state.view=cT.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ce(()=>import("./AreaMeasurementAnalysisView3D-26f7cb40.js").then(r=>r.A),["assets/AreaMeasurementAnalysisView3D-26f7cb40.js","assets/UnitNormalizer-818a6664.js","assets/Segment-50129b50.js","assets/unitFormatUtils-b70a7bff.js","assets/LineVisualElement-b605d10c.js","assets/elevationInfoUtils-4fd79d95.js","assets/geometryEngine-5a631b21.js","assets/geometryEngineBase-324c1c81.js","assets/hydrated-c10ab4a5.js","assets/EditGeometryOperations-0ec3f5b5.js"]);case"dimension":return ce(()=>import("./DimensionAnalysisView3D-4f55aca1.js").then(r=>r.D),["assets/DimensionAnalysisView3D-4f55aca1.js","assets/LineVisualElement-b605d10c.js","assets/LengthDimension-92faee98.js","assets/Segment-50129b50.js","assets/unitFormatUtils-b70a7bff.js","assets/elevationInfoUtils-4fd79d95.js","assets/analysisViewUtils-68ab721d.js","assets/ImageMaterial-5c48df66.js","assets/Factory-8e329f4b.js","assets/RightAngleQuadVisualElement-8daf0594.js","assets/VisualElementResources-e52972a5.js","assets/PointVisualElement-2a56e55d.js","assets/EditGeometryOperations-0ec3f5b5.js","assets/dehydratedFeatureComparison-a3375a3e.js"]);case"direct-line-measurement":return ce(()=>import("./DirectLineMeasurementAnalysisView3D-f383b6d8.js").then(r=>r.D),["assets/DirectLineMeasurementAnalysisView3D-f383b6d8.js","assets/UnitNormalizer-818a6664.js","assets/Segment-50129b50.js","assets/unitFormatUtils-b70a7bff.js","assets/LineVisualElement-b605d10c.js","assets/elevationInfoUtils-4fd79d95.js","assets/geometryEngine-5a631b21.js","assets/geometryEngineBase-324c1c81.js","assets/hydrated-c10ab4a5.js","assets/RightAngleQuadVisualElement-8daf0594.js","assets/VisualElementResources-e52972a5.js"]);case"line-of-sight":return ce(()=>import("./LineOfSightAnalysisView3D-ccdd2ae5.js"),["assets/LineOfSightAnalysisView3D-ccdd2ae5.js","assets/LineVisualElement-b605d10c.js","assets/LineOfSightAnalysisTarget-7f5e80d1.js","assets/persistable-ca976a2c.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-91e7c3ce.js","assets/elevationInfoUtils-4fd79d95.js","assets/analysisViewUtils-68ab721d.js","assets/ImageMaterial-5c48df66.js","assets/PointVisualElement-2a56e55d.js","assets/VisualElementResources-e52972a5.js"]);case"slice":return ce(()=>import("./SliceAnalysisView3D-63c25320.js").then(r=>r.S),["assets/SliceAnalysisView3D-63c25320.js","assets/LineVisualElement-b605d10c.js","assets/persistable-ca976a2c.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-91e7c3ce.js","assets/BuildingComponentSublayer-5d49e5f9.js","assets/UniqueValueRenderer-fef4204d.js","assets/diffUtils-590c9088.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/FeatureLayer-5c6d2c3b.js","assets/MultiOriginJSONSupport-e4912ffd.js","assets/sql-734ecbc5.js","assets/FeatureLayerBase-7c7dfccb.js","assets/commonProperties-30089b06.js","assets/featureLayerUtils-6cf06f83.js","assets/AttachmentQuery-972bbd60.js","assets/Query-1c961d4c.js","assets/RelationshipQuery-39c07195.js","assets/serviceCapabilitiesUtils-959e798a.js","assets/editsZScale-1b5a53a6.js","assets/queryZScale-8f9616ff.js","assets/FeatureSet-111cb247.js","assets/APIKeyMixin-878a7aa7.js","assets/ArcGISService-83287338.js","assets/CustomParametersMixin-231c4be8.js","assets/EditBusLayer-d71787e9.js","assets/FeatureEffectLayer-4160946c.js","assets/FeatureEffect-86735d98.js","assets/FeatureFilter-00f4be05.js","assets/FeatureReductionLayer-4262cf54.js","assets/LabelClass-2d53c485.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/OperationalLayer-0e8f8b28.js","assets/OrderedLayer-68067459.js","assets/PortalLayer-310c2800.js","assets/portalItemUtils-792a27e1.js","assets/TemporalLayer-f17c9161.js","assets/FeatureTemplate-2a7e96c1.js","assets/FeatureType-db96032c.js","assets/fieldProperties-62c55499.js","assets/labelingInfo-144f3d9f.js","assets/versionUtils-f17daa93.js","assets/styleUtils-25825fd6.js","assets/TopFeaturesQuery-e44d05be.js","assets/popupUtils-82ea8abb.js","assets/capabilities-5d185925.js","assets/I3SIndexInfo-445e6968.js","assets/I3SLayerDefinitions-ffdb3821.js","assets/I3SUtil-2c288808.js","assets/I3SBinaryReader-2b8e30f7.js","assets/popupUtils-f04ec9a9.js","assets/analysisViewUtils-68ab721d.js","assets/ImageMaterial-5c48df66.js","assets/Factory-8e329f4b.js"])}}};function sne(){const t=Wo();return t.promise.catch(()=>{}),t}h([f()],Sv.prototype,"updating",null),h([f({constructOnly:!0})],Sv.prototype,"view",void 0),h([f()],Sv.prototype,"_allAnalysisViews",void 0),h([f()],Sv.prototype,"_creatingViewCount",void 0),Sv=h([N("esri.views.3d.analysis.AnalysisViewManager3D")],Sv);const Kje=Sv;let Bm=class extends xe{constructor(e){super(e),this.collision=new B3,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===$e.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==$e.Local?this._set("altitude",e):J.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?ge(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return ge(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===$e.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=$k)=>(i.min=$o.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?wD([[4e3,$o.max],[1e4,It(88)],[6e6,It(88)]]):()=>$o.max;return(r,i=$k)=>(i.min=$o.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?wD([[4e3,$o.max],[5e4,It(88)],[6e6,It(88)],[2e7,$o.min]]):wD([[3e5,$o.max],[3e6,It(88)],[6e6,It(88)],[2e7,$o.min]]);return(r,i=$k)=>(i.min=$o.min,i.max=e(r),i)}};function eHe(t){return{min:-2e5,max:4*t.radius}}h([f()],Bm.prototype,"altitude",null),h([f({readOnly:!0})],Bm.prototype,"collision",void 0),h([f()],Bm.prototype,"distance",void 0),h([f({readOnly:!0})],Bm.prototype,"minimumPoiDistance",void 0),h([f()],Bm.prototype,"tilt",void 0),h([f({constructOnly:!0})],Bm.prototype,"mode",void 0),Bm=h([N("esri.views.3d.state.Constraints")],Bm);const one=eHe(Kt),$o={min:It(.5),max:It(179.5)},$k={min:0,max:0};let B3=class extends xe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([f({type:Boolean})],B3.prototype,"enabled",void 0),h([f({type:Number})],B3.prototype,"elevationMargin",void 0),B3=h([N("esri.views.3d.state.Constraints.CollisionConstraint")],B3);let uT=class extends xe{constructor(){super(...arguments),this.min=one.min,this.max=one.max}};h([f({type:Number})],uT.prototype,"min",void 0),h([f({type:Number})],uT.prototype,"max",void 0),uT=h([N("esri.views.3d.constraints.AltitudeConstraint")],uT);let eg=class extends xe{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};h([f({type:Number,value:1e-8})],eg.prototype,"near",null),h([_i("near")],eg.prototype,"castNear",null),h([f({type:Number,value:1e-8})],eg.prototype,"far",null),h([_i("far")],eg.prototype,"castFar",null),h([f({type:["auto","manual"]})],eg.prototype,"mode",void 0),eg=h([N("esri.views.3d.constraints.ClipDistanceConstraint")],eg);const tj={min:Ka($o.min),max:Ka($o.max)};let tb=class extends xe{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return ge(e,tj.min,tj.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([f({type:["auto","manual"]})],tb.prototype,"mode",void 0),h([f({type:Number,value:tj.max})],tb.prototype,"max",null),h([_i("max")],tb.prototype,"castMax",null),tb=h([N("esri.views.3d.constraints.TiltConstraint")],tb);let rb=class extends xe{constructor(){super(...arguments),this.tilt=new tb,this.altitude=new uT,this.clipDistance=new eg}};h([f({type:tb})],rb.prototype,"tilt",void 0),h([f({type:uT})],rb.prototype,"altitude",void 0),h([f({type:eg})],rb.prototype,"clipDistance",void 0),rb=h([N("esri.views.3d.constraints.Constraints")],rb);var rj;let qu=rj=class extends ke{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new rj(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};h([f({readOnly:!0,type:["sun"],json:{write:!0}})],qu.prototype,"type",void 0),h([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],qu.prototype,"date",void 0),h([lr("date",["datetime"])],qu.prototype,"readDate",null),h([xr("date")],qu.prototype,"writeDate",null),h([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],qu.prototype,"directShadowsEnabled",void 0),h([lr("directShadowsEnabled",["directShadows"])],qu.prototype,"readDirectShadowsEnabled",null),h([xr("directShadowsEnabled")],qu.prototype,"writedirectShadowsEnabled",null),h([f({type:Number,json:{write:!0}})],qu.prototype,"displayUTCOffset",void 0),h([xr("displayUTCOffset")],qu.prototype,"writeDisplayUTCOffset",null),qu=rj=h([N("esri.webscene.SunLighting")],qu);const bR=qu;var v2;const Iwe="esri.views.3d.environment.SunLighting",p$=J.getLogger(Iwe);let nf=v2=class extends Bn.EventedMixin(bR){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return e_(p$,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){e_(p$,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return e_(p$,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){e_(p$,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new v2(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=v2.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=v2.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==n&&(f$.target=this,f$.timezoneOffset=n,this.emit("timezone-will-change",f$),f$.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new v2({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],nf.prototype,"cameraTrackingEnabled",void 0),h([f({type:Boolean})],nf.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],nf.prototype,"waterReflectionEnabled",null),h([f({type:Date})],nf.prototype,"defaultDate",null),h([f({type:Date})],nf.prototype,"date",null),nf=v2=h([N(Iwe)],nf),function(t){function e({hours:r,minutes:i,seconds:n}){return Math.round(r+i/60+n/3600)}t.calculateTimezoneOffset=e}(nf||(nf={}));const f$={target:null,timezoneOffset:0},_y=nf;var ij;let V3=ij=class extends ke{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new ij(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};h([f({readOnly:!0,type:["virtual"],json:{write:!0}})],V3.prototype,"type",void 0),h([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],V3.prototype,"directShadowsEnabled",void 0),V3=ij=h([N("esri.webscene.VirtualLighting")],V3);const Z6=V3;var CD;const Lwe="esri.views.3d.environment.VirtualLighting",m$=J.getLogger(Lwe);let b2=CD=class extends Bn.EventedMixin(Z6){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return e_(m$,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){e_(m$,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return e_(m$,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){e_(m$,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new CD({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new CD(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([f({type:Boolean})],b2.prototype,"ambientOcclusionEnabled",null),h([f({type:Boolean})],b2.prototype,"waterReflectionEnabled",null),h([f({type:Boolean})],b2.prototype,"cameraTrackingEnabled",void 0),b2=CD=h([N(Lwe)],b2);const G3=b2,tHe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:_y,virtual:G3}};var nj;let tO=nj=class extends xe{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new nj({quality:this.quality})}};h([f({type:["low","high"],value:"low"})],tO.prototype,"quality",null),tO=nj=h([N("esri.views.3d.environment.SceneViewAtmosphere")],tO);var sj;let j3=sj=class extends ke{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new sj({cloudCover:this.cloudCover})}};h([Vt({sunny:"sunny"})],j3.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],j3.prototype,"cloudCover",void 0),j3=sj=h([N("esri.views.3d.environment.SunnyWeather")],j3);const Q4=j3;var oj;let H3=oj=class extends ke{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new oj({cloudCover:this.cloudCover})}};h([Vt({cloudy:"cloudy"})],H3.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],H3.prototype,"cloudCover",void 0),H3=oj=h([N("esri.views.3d.environment.CloudyWeather")],H3);const Dwe=H3;var aj;let W3=aj=class extends ke{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new aj({fogStrength:this.fogStrength})}};h([Vt({foggy:"foggy"})],W3.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],W3.prototype,"fogStrength",void 0),W3=aj=h([N("esri.views.3d.environment.FoggyWeather")],W3);const Nwe=W3;var lj;let w2=lj=class extends ke{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new lj({cloudCover:this.cloudCover,precipitation:this.precipitation})}};h([Vt({rainy:"rainy"})],w2.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w2.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w2.prototype,"precipitation",void 0),w2=lj=h([N("esri.views.3d.environment.RainyWeather")],w2);const Fwe=w2;var cj;let Ev=cj=class extends ke{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new cj({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};h([Vt({snowy:"snowy"})],Ev.prototype,"type",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ev.prototype,"cloudCover",void 0),h([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ev.prototype,"precipitation",void 0),h([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Ev.prototype,"snowCover",void 0),Ev=cj=h([N("esri.views.3d.environment.SnowyWeather")],Ev);const Uwe=Ev,kwe={key:"type",base:Q4,typeMap:{sunny:Q4,cloudy:Dwe,rainy:Fwe,snowy:Uwe,foggy:Nwe}},rHe=Object.keys(kwe.typeMap);function iHe(t,e){return!!rHe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const yf=1e4,nHe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:bR,virtual:Z6}};let AD=class extends ke{constructor(e){super(e)}clone(){}};h([f({readOnly:!0,json:{read:!1}})],AD.prototype,"type",void 0),AD=h([N("esri.webscene.background.Background")],AD);const zwe=AD;var uj;const sHe={...Jg,nonNullable:!0};let q3=uj=class extends zwe{constructor(t){super(t),this.type="color",this.color=new it([0,0,0,1])}clone(){return new uj(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};h([Vt({color:"color"},{readOnly:!0})],q3.prototype,"type",void 0),h([f(sHe)],q3.prototype,"color",void 0),q3=uj=h([N("esri.webscene.background.ColorBackground")],q3);const Bwe=q3,ane={base:zwe,key:"type",typeMap:{color:Bwe}};function oHe(t){return(e,r,i)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,i),s}}}const aHe={types:ane,json:{read:oHe(ane),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var hj;const Vwe="esri.webscene.Environment",lHe=J.getLogger(Vwe),lne=(t,e,r)=>({enabled:!r||!r.isPresentation});let vy=hj=class extends ke{constructor(t){super(t),this.lighting=new bR,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){iHe(t==null?void 0:t.type,lHe)&&this._set("weather",t)}clone(){return new hj(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Z6.prototype.clone.call(this.lighting):bR.prototype.clone.call(this.lighting),background:ye(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};h([f({types:nHe,nonNullable:!0,json:{write:!0}})],vy.prototype,"lighting",void 0),h([f(aHe)],vy.prototype,"background",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:lne}}})],vy.prototype,"atmosphereEnabled",void 0),h([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:lne}}})],vy.prototype,"starsEnabled",void 0),h([f({types:kwe,nonNullable:!0,json:{write:!0},value:new Q4})],vy.prototype,"weather",null),vy=hj=h([N(Vwe)],vy);const Gwe=vy;var X3;let x2=X3=class extends Gwe{constructor(t){super(t),this.atmosphere=new tO,this.lighting=new _y,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new X3({...e,lighting:e.lighting?e.lighting.type==="virtual"?G3.fromWebsceneLighting(e.lighting):_y.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,r;return t?t instanceof _y||t instanceof G3?t:t instanceof bR?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new _y({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof Z6?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new G3({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):L_(tHe,t):new _y}clone(){return new X3({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background)})}cloneWithWebsceneEnvironment(t){return new X3({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ye(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):_y.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):G3.fromWebsceneLighting(t.lighting);default:return t.lighting,_y.fromWebsceneLighting(t.lighting)}}};h([f({type:tO,json:{read:!1},nonNullable:!0})],x2.prototype,"atmosphere",void 0),h([f({nonNullable:!0})],x2.prototype,"lighting",void 0),h([_i("lighting")],x2.prototype,"castLighting",null),x2=X3=h([N("esri.views.3d.environment.SceneViewEnvironment")],x2);const T2=x2;var ra;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(ra||(ra={}));function fs(t,e){return t[0]=e[0],t[1]=e[1],t}function er(t,e,r){return t[0]=e,t[1]=r,t}function Ld(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Tf(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function UZ(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function jwe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function cHe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function uHe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function hHe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function dHe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function pHe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function dc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function fHe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function cw(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function J4(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function kZ(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Hwe(t){const e=t[0],r=t[1];return e*e+r*r}function zZ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Wwe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function wR(t,e){const r=e[0],i=e[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function es(t,e){return t[0]*e[0]+t[1]*e[1]}function mHe(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function lh(t,e,r,i){const n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function gHe(t,e){e=e||1;const r=2*mP()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function qwe(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function Cv(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function yHe(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function _He(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function vHe(t,e,r,i){const n=e[0]-r[0],s=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=n*a-s*o+r[0],t[1]=n*o+s*a+r[1],t}function bHe(t,e){const r=t[0],i=t[1],n=e[0],s=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*n+i*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function wHe(t){return"vec2("+t[0]+", "+t[1]+")"}function Xwe(t,e){return t[0]===e[0]&&t[1]===e[1]}function Ywe(t,e){const r=t[0],i=t[1],n=e[0],s=e[1],o=tl();return Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))}function xHe(t,e,r,i,n){let s=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*s+i[1]*o)*(n-1);return s=i[0]*a,o=i[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const THe=kZ,Zwe=Tf,SHe=UZ,EHe=jwe,Qwe=cw,CHe=J4,AHe=Hwe;Object.freeze(Object.defineProperty({__proto__:null,add:Ld,angle:bHe,ceil:cHe,copy:fs,cross:mHe,dist:Qwe,distance:cw,div:EHe,divide:jwe,dot:es,equals:Ywe,exactEquals:Xwe,floor:uHe,inverse:Wwe,len:THe,length:kZ,lerp:lh,max:dHe,min:hHe,mul:SHe,multiply:UZ,negate:zZ,normalize:wR,projectAndScale:xHe,random:gHe,rotate:vHe,round:pHe,scale:dc,scaleAndAdd:fHe,set:er,sqrDist:CHe,sqrLen:AHe,squaredDistance:J4,squaredLength:Hwe,str:wHe,sub:Zwe,subtract:Tf,transformMat2:qwe,transformMat2d:Cv,transformMat3:yHe,transformMat4:_He},Symbol.toStringTag,{value:"Module"}));function BZ(t){return ge((t-1e5)/(1e6-1e5),0,1)}const dj=1e4,OHe=.085,$y=1e5;let RHe=class{};const Wr=RHe;function w(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(w||(w={}));var E;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(E||(E={}));var Pn;function Uf(t,e){switch(e.textureCoordinateType){case Pn.Default:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(w`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Pn.Compressed:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(w`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Pn.Atlas:return t.attributes.add(E.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(E.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(w`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Pn.None:return void t.vertex.code.add(w`void forwardTextureCoordinates() {}`);case Pn.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Pn||(Pn={}));function Pc(t){t.code.add(w`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function wu(t){t.include(Pc),t.code.add(w`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function Q6(t){t.fragment.code.add(w`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var jr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(jr||(jr={}));let ln=class{constructor(e,r,i,n,s=null){this.name=e,this.type=r,this.arraySize=s,this.bind={[jr.Pass]:null,[jr.Draw]:null},i!=null&&n!=null&&(this.bind[i]=n)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Lt=class extends ln{constructor(e,r){super(e,"vec3",jr.Pass,(i,n,s)=>i.setUniform3fv(e,r(n,s)))}};function r0(t){t.uniforms.add(new Lt("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function lm(t){t.uniforms.add(new Lt("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function K4(t){r0(t.fragment),lm(t.fragment),t.fragment.code.add(w`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let yr=class extends ln{constructor(e,r){super(e,"vec2",jr.Pass,(i,n,s)=>i.setUniform2fv(e,r(n,s)))}},Jt=class extends ln{constructor(e,r){super(e,"vec4",jr.Pass,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}},Ce=class extends ln{constructor(e,r){super(e,"float",jr.Pass,(i,n,s)=>i.setUniform1f(e,r(n,s)))}},Mi=class extends ln{constructor(e,r){super(e,"mat4",jr.Pass,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};const Ea=Qt();let PHe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function Je(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new PHe(`${e} at ${r}`)}}function rx(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function cne(t,e,r,i){let n,s=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function g$(t,e,r,i,n,s=Ne()){const o=(i[n]-r[n])*(e[0]-t[0])-(i[0]-r[0])*(e[n]-t[n]),a=(i[0]-r[0])*(t[n]-r[n])-(i[n]-r[n])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function une(t,e,r,i,n){Ea[0]=t[0],Ea[1]=t[1],Ea[2]=t[2],Ea[3]=1,au(Ea,Ea,e),n.length>2&&(n[2]=-Ea[2]),au(Ea,Ea,r),Je(Ea[3]!==0),n[0]=Ea[0]/Ea[3],n[1]=Ea[1]/Ea[3],n[2]=Ea[2]/Ea[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function MHe(t,e){return Math.log(t)/Math.log(e)}function $He(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function Jwe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Kwe=J.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let exe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){Kwe.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(i))i[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))i[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${i[s]} new ${e[s]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},mr=class extends exe{constructor(){super(...arguments),this.vertex=new hne,this.fragment=new hne,this.attributes=new DHe,this.varyings=new NHe,this.extensions=new pj,this.constants=new txe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?UHe:FHe,c=this.constants.generateSource().concat(s.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${n.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)});const n=Array.from(i.values()),s=n.length;return(o,a,l)=>{for(let c=0;c<s;++c)n[c](r,o,a,l)}}},IHe=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new Y(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Kwe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},LHe=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},hne=class extends exe{constructor(){super(...arguments),this.uniforms=new IHe,this.code=new LHe,this.constants=new txe}get builder(){return this}},DHe=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},NHe=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&Je(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,n)=>r.push(e==="vertex"?`out ${i} ${n};`:`in ${i} ${n};`)),r}},pj=class fj{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?fj.ALLOWLIST_VERTEX:fj.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};pj.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],pj.ALLOWLIST_VERTEX=[];let txe=class Jn{constructor(){this._entries=new Set}add(e,r,i){let n="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":n=Jn._numberToFloatStr(i);break;case"int":n=Jn._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${Jn._numberToFloatStr(i[0])},                            ${Jn._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${Jn._numberToFloatStr(i[0])},                            ${Jn._numberToFloatStr(i[1])},                            ${Jn._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${Jn._numberToFloatStr(i[0])},                            ${Jn._numberToFloatStr(i[1])},                            ${Jn._numberToFloatStr(i[2])},                            ${Jn._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${Jn._numberToIntStr(i[0])},                             ${Jn._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${Jn._numberToIntStr(i[0])},                             ${Jn._numberToIntStr(i[1])},                             ${Jn._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${Jn._numberToIntStr(i[0])},                             ${Jn._numberToIntStr(i[1])},                             ${Jn._numberToIntStr(i[2])},                             ${Jn._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${r}(${Array.prototype.map.call(i,s=>Jn._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const FHe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,UHe=`precision highp float;
precision highp sampler2D;`;let Ye=class extends ln{constructor(e,r){super(e,"sampler2D",jr.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};const rO=Se(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),Ik=3,Lk=Se(Ik*parseFloat(65e-8.toFixed(6)),Ik*parseFloat(1881e-9.toFixed(6)),Ik*parseFloat(85e-9.toFixed(6))),kHe=3996e-9,zHe=Se(parseFloat(Number(rO[0]+Lk[0]).toFixed(6)),parseFloat(Number(rO[1]+Lk[1]).toFixed(6)),parseFloat(Number(rO[2]+Lk[2]).toFixed(6)));function BHe(t){const e=new mr;e.attributes.add(E.POSITION,"vec2"),e.include(Uf,{textureCoordinateType:Pn.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new Mi("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new Mi("inverseViewMatrix",(n,s)=>wE(VHe,s.camera.viewMatrix))),r.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Lt("backgroundColor",n=>n.backgroundColor),new yr("radii",n=>n.radii),new Lt("cameraPosition",(n,s)=>s.camera.eye),new Jt("heightParameters",n=>n.heightParameters),new Ce("innerFadeDistance",n=>n.innerFadeDistance),new Ce("altitudeFade",n=>n.altitudeFade),new Ye("depthTexture",n=>n.depthTexture),new Ce("hazeStrength",n=>n.hazeStrength)),i.constants.add("betaRayleigh","vec3",rO),i.constants.add("betaCombined","vec3",zHe),i.constants.add("betaMie","float",kHe),i.constants.add("scaleHeight","float",OHe*$y),r0(i),e.include(Q6),t.haze&&(i.include(wu),i.uniforms.add(new yr("nearFar",(n,s)=>s.camera.nearFar))),i.code.add(w`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(w`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(w`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(w`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?w`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":w`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":w`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?w`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:w`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":w`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?w`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?w`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?w`cameraSpaceRay *= -textureBilinear(vuv0);`:w`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:w`${t.reduced?"":w`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?w`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:w`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":w`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const VHe=_e(),GHe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:rO,build:BHe},Symbol.toStringTag,{value:"Module"}));let _r=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var yi,Et,ve,Zf,bt,qd,NS,Qe,Hr,_n,At,Pt,nn,Tt,qe,Un,jn,gr,tu,mo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(yi||(yi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Et||(Et={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(ve||(ve={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Zf||(Zf={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(bt||(bt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(qd||(qd={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(NS||(NS={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(Qe||(Qe={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Hr||(Hr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(_n||(_n={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(At||(At={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Pt||(Pt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(nn||(nn={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Tt||(Tt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(qe||(qe={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Un||(Un={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(jn||(jn={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(gr||(gr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(tu||(tu={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(mo||(mo={}));const Dk=33984;var Es,qc;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(Es||(Es={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(qc||(qc={}));const dne=33306;var un,pne,fne,mne,e5,mj,gne;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(un||(un={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(pne||(pne={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(fne||(fne={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(mne||(mne={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(e5||(e5={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(mj||(mj={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(gne||(gne={}));let Tr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=Le(this._program),this._pipeline=this._configuration=null}reload(e){Le(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Et.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const fr=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.UV0,2],[E.COLOR,3],[E.COLORFEATUREATTRIBUTE,3],[E.SIZE,4],[E.TANGENT,4],[E.AUXPOS1,5],[E.SYMBOLCOLOR,5],[E.AUXPOS2,6],[E.FEATUREATTRIBUTE,6],[E.INSTANCEFEATUREATTRIBUTE,6],[E.INSTANCECOLOR,7],[E.OBJECTANDLAYERIDCOLOR,7],[E.INSTANCEOBJECTANDLAYERIDCOLOR,7],[E.MODEL,8],[E.MODELNORMAL,12],[E.MODELORIGINHI,11],[E.MODELORIGINLO,15]]),jHe=J.getLogger("esri.views.webgl.checkWebGLError");function HHe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const rxe=!!se("enable-feature:webgl-debug");function eh(){return rxe}function gj(){return rxe}function Gy(t){if(eh()){const e=t.getError();if(e){const r=HHe(t,e),i=new Error().stack;jHe.error(new Y("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let vr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Nt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(jr.Pass,this),this.bindDraw=r.generateBind(jr.Draw,this),this._fragmentUniforms=eh()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(r==null||r.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var ui,uw,dn,bg,Rl,Hg,FS,Gr,hw,wg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(ui||(ui={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(uw||(uw={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(dn||(dn={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(bg||(bg={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Rl||(Rl={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(Hg||(Hg={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(FS||(FS={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Gr||(Gr={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(hw||(hw={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(wg||(wg={}));function Cc(t,e,r=Zf.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function So(t,e,r,i,n=Zf.ADD,s=Zf.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const VZ={face:qd.BACK,mode:NS.CCW},ixe={face:qd.FRONT,mode:NS.CCW},J6=t=>t===ui.Back?VZ:t===ui.Front?ixe:null,$l={zNear:0,zFar:1},Ft={r:!0,g:!0,b:!0,a:!0};function WHe(t){return eWe.intern(t)}function qHe(t){return tWe.intern(t)}function XHe(t){return rWe.intern(t)}function YHe(t){return iWe.intern(t)}function ZHe(t){return nWe.intern(t)}function QHe(t){return sWe.intern(t)}function JHe(t){return oWe.intern(t)}function KHe(t){return aWe.intern(t)}function Ot(t){return lWe.intern(t)}let i0=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function n0(t){return"["+t.join(",")+"]"}const eWe=new i0(nxe,t=>({__tag:"Blending",...t}));function nxe(t){return t?n0([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const tWe=new i0(sxe,t=>({__tag:"Culling",...t}));function sxe(t){return t?n0([t.face,t.mode]):null}const rWe=new i0(oxe,t=>({__tag:"PolygonOffset",...t}));function oxe(t){return t?n0([t.factor,t.units]):null}const iWe=new i0(axe,t=>({__tag:"DepthTest",...t}));function axe(t){return t?n0([t.func]):null}const nWe=new i0(lxe,t=>({__tag:"StencilTest",...t}));function lxe(t){return t?n0([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const sWe=new i0(cxe,t=>({__tag:"DepthWrite",...t}));function cxe(t){return t?n0([t.zNear,t.zFar]):null}const oWe=new i0(uxe,t=>({__tag:"ColorWrite",...t}));function uxe(t){return t?n0([t.r,t.g,t.b,t.a]):null}const aWe=new i0(hxe,t=>({__tag:"StencilWrite",...t}));function hxe(t){return t?n0([t.mask]):null}const lWe=new i0(cWe,t=>({blending:WHe(t.blending),culling:qHe(t.culling),polygonOffset:XHe(t.polygonOffset),depthTest:YHe(t.depthTest),stencilTest:ZHe(t.stencilTest),depthWrite:QHe(t.depthWrite),colorWrite:JHe(t.colorWrite),stencilWrite:KHe(t.stencilWrite)}));function cWe(t){return t?n0([nxe(t.blending),sxe(t.culling),oxe(t.polygonOffset),axe(t.depthTest),lxe(t.stencilTest),cxe(t.depthWrite),uxe(t.colorWrite),hxe(t.stencilWrite)]):null}let uWe=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,n){return(i||e!==r)&&(n(e),this._pipelineInvalid=!0),e}},hWe=class extends Wr{constructor(){super(...arguments),this.heightParameters=Qt(),this.radii=Ne(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Ne(),this.backgroundColor=O()}},Y3=class dxe extends Tr{initializeProgram(e){return new vr(e.rctx,dxe.shader.get().build(this.configuration),fr)}initializePipeline(){return this.configuration.reduced?Ot({blending:Cc(ve.ONE,ve.ZERO),depthTest:{func:Hr.ALWAYS},colorWrite:Ft}):this.configuration.haze?Ot({blending:So(ve.ONE,ve.ZERO,ve.ONE_MINUS_SRC_COLOR,ve.ONE),colorWrite:Ft}):Ot({blending:Cc(ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.LEQUAL},colorWrite:Ft})}};Y3.shader=new _r(GHe,()=>ce(()=>import("./ChapmanAtmosphere.glsl-badaea29.js"),[]));let va=class extends Wr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function U(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}let t5=class extends va{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};h([U()],t5.prototype,"haze",void 0),h([U()],t5.prototype,"reduced",void 0);let xo=class{constructor(e,r,i,n,s,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new xo(E.POSITION,3,Qe.FLOAT,0,12);new xo(E.POSITION,3,Qe.FLOAT,0,20),new xo(E.UV0,2,Qe.FLOAT,12,20);new xo(E.POSITION,3,Qe.FLOAT,0,32),new xo(E.NORMAL,3,Qe.FLOAT,12,32),new xo(E.UV0,2,Qe.FLOAT,24,32);new xo(E.POSITION,3,Qe.FLOAT,0,16),new xo(E.COLOR,4,Qe.UNSIGNED_BYTE,12,16);const GZ=[new xo(E.POSITION,2,Qe.FLOAT,0,8)],$P=[new xo(E.POSITION,2,Qe.FLOAT,0,16),new xo(E.UV0,2,Qe.FLOAT,8,16)];function yne(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function No(t,e){return t.vertexBuffers[e].byteLength/dWe(t.layout[e])}function dWe(t){return t[0].stride}function jZ(t,e,r,i,n=0){const s=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)s.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)s.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function HZ(t,e,r,i){const n=t.gl,s=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)n.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(bt.ARRAY_BUFFER)}function WZ(t){switch(t){case Tt.ALPHA:case Tt.LUMINANCE:case Tt.RED:case Tt.RED_INTEGER:case qe.R8:case qe.R8I:case qe.R8UI:case qe.R8_SNORM:case jn.STENCIL_INDEX8:return 1;case Tt.LUMINANCE_ALPHA:case Tt.RG:case Tt.RG_INTEGER:case qe.RGBA4:case qe.R16F:case qe.R16I:case qe.R16UI:case qe.RG8:case qe.RG8I:case qe.RG8UI:case qe.RG8_SNORM:case qe.RGB565:case qe.RGB5_A1:case jn.DEPTH_COMPONENT16:return 2;case Tt.DEPTH_COMPONENT:case Tt.RGB:case Tt.RGB_INTEGER:case qe.RGB8:case qe.RGB8I:case qe.RGB8UI:case qe.RGB8_SNORM:case qe.SRGB8:case jn.DEPTH_COMPONENT24:return 3;case Tt.DEPTH_STENCIL:case Tt.DEPTH24_STENCIL8:case Tt.RGBA:case Tt.RGBA_INTEGER:case qe.RGBA8:case qe.R32F:case qe.R11F_G11F_B10F:case qe.RG16F:case qe.R32I:case qe.R32UI:case qe.RG16I:case qe.RG16UI:case qe.RGBA8I:case qe.RGBA8UI:case qe.RGBA8_SNORM:case qe.SRGB8_ALPHA8:case qe.RGB9_E5:case qe.RGB10_A2UI:case qe.RGB10_A2:case jn.DEPTH_STENCIL:case jn.DEPTH_COMPONENT32F:case jn.DEPTH24_STENCIL8:return 4;case jn.DEPTH32F_STENCIL8:return 5;case qe.RGB16F:case qe.RGB16I:case qe.RGB16UI:return 6;case qe.RG32F:case qe.RG32I:case qe.RG32UI:case qe.RGBA16F:case qe.RGBA16I:case qe.RGBA16UI:return 8;case qe.RGB32F:case qe.RGB32I:case qe.RGB32UI:return 12;case qe.RGBA32F:case qe.RGBA32I:case qe.RGBA32UI:return 16;case un.COMPRESSED_RGB_S3TC_DXT1_EXT:case un.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case un.COMPRESSED_RGBA_S3TC_DXT3_EXT:case un.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case un.COMPRESSED_R11_EAC:case un.COMPRESSED_SIGNED_R11_EAC:case un.COMPRESSED_RGB8_ETC2:case un.COMPRESSED_SRGB8_ETC2:case un.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case un.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case un.COMPRESSED_RG11_EAC:case un.COMPRESSED_SIGNED_RG11_EAC:case un.COMPRESSED_RGBA8_ETC2_EAC:case un.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const ix=J.getLogger("esri.views.webgl.VertexArrayObject");let Fh=class{constructor(e,r,i,n,s=null){this._context=e,this._locations=r,this._layout=i,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Es.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*ige}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const r in this._buffers)(e=this._buffers[r])==null||e.dispose(),delete this._buffers[r];this._indexBuffer=Le(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&ix.warn("Leaked WebGL VAO")}disposeVAOOnly(){var e,r;this._glName&&(((r=(e=this._context)==null?void 0:e.capabilities)==null?void 0:r.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(Es.VertexArrayObject,this),this._context=lE(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||ix.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||ix.error("Vertex buffer is uninitialized!");const a=r[s];a||ix.error("Vertex element descriptor is empty!"),jZ(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||ix.error("Vertex buffer dictionary is empty!");for(const i in e){const n=e[i];n||ix.error("Vertex buffer is uninitialized!");const s=r[i];HZ(this._context,this._locations,n,s)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},vp=class extends Fh{};var rr;function yj(t,e,r={}){const i=e===rr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const n of i){const s=t.getContext(n,r);if(s)return s}return null}function pWe(t,e,r={}){const i=pxe(t);for(const n of i){const s=yj(e,n,r);if(s)return s}return null}function pxe(t){if(t==="3d")return[rr.WEBGL2];const e=se("esri-force-webgl");return e===rr.WEBGL1||e===rr.WEBGL2?[e]:se("mac")&&se("chrome")?[rr.WEBGL1,rr.WEBGL2]:[rr.WEBGL2,rr.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(rr||(rr={}));const Rp=J.getLogger("esri.views.webgl.BufferObject");let Ar=class S2{static createIndex(e,r,i){return new S2(e,bt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new S2(e,bt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==rr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new S2(e,bt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=gr.STREAM_READ,i){if(e.type!==rr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new S2(e,bt.PIXEL_PACK_BUFFER,r);return i&&n.setSize(i),n}static createPixelUnpack(e,r=gr.STREAM_DRAW,i){if(e.type!==rr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new S2(e,bt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,n){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Es.BufferObject,this),this._glName=this._context.gl.createBuffer(),Gy(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===bt.ELEMENT_ARRAY_BUFFER?this._indexType===Qe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===bt.ELEMENT_ARRAY_BUFFER||this.bufferType===bt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Es.BufferObject,this),this._context=lE(this._context)):this._glName&&Rp.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&Rp.error("Buffer size needs to be positive!"),this.bufferType===bt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case Qe.UNSIGNED_SHORT:e*=2;break;case Qe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===bt.ELEMENT_ARRAY_BUFFER&&(WF(e)&&(r/=2,this._indexType=Qe.UNSIGNED_SHORT),qF(e)&&(r/=4,this._indexType=Qe.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;r!=null?n.bufferData(this.bufferType,r,this.usage):n.bufferData(this.bufferType,e,this.usage),Gy(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,n){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteLength)&&Rp.error("offset is out of range!"),i>=n&&Rp.error("end must be bigger than start!"),(r+(n-i))*e.BYTES_PER_ELEMENT>this.byteLength&&Rp.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===rr.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,n-i);else{const a=i===0&&n===e.length?e:e.subarray(i,n);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}Gy(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,r=0,i,n){if(this._context.type!==rr.WEBGL2)return void Rp.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||n<0)return void Rp.error("Problem getting subdata: offset and length were less than zero!");const s=fWe(e)?e.BYTES_PER_ELEMENT:1;if(s*((i??0)+(n??0))>e.byteLength)return void Rp.error("Problem getting subdata: offset and length exceeded destination size!");r+s*(n??0)>this.byteLength&&Rp.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,bt.COPY_READ_BUFFER),o.getBufferSubData(bt.COPY_READ_BUFFER,r,e,i,n),this._context.unbindBuffer(bt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,n){this._context.type===rr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,n)):Rp.error("Get buffer subdata is supported in WebGL2 only!")}};function fWe(t){return lDe(t)}var j_;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(j_||(j_={}));let pr=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=nn.TEXTURE_2D,this.pixelFormat=Tt.RGBA,this.dataType=Un.UNSIGNED_BYTE,this.samplingMode=At.LINEAR,this.wrapMode=Pt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function mWe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*(t.hasMipmap?4/3:1)*WZ(t.internalFormat)}let gWe=class fxe extends pr{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case qe.R16F:case qe.R16I:case qe.R16UI:case qe.R32F:case qe.R32I:case qe.R32UI:case qe.R8_SNORM:case qe.R8:case qe.R8I:case qe.R8UI:this.pixelFormat=Tt.RED}}static validate(e,r){return new fxe(e,r)}};const _ne=4;let Ct=class{constructor(e,r=null,i=null){if(this.type=j_.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const n=gWe.validate(e,r);if(!n)throw new Y("Texture descriptor invalid");this._descriptor=n}if(this._descriptor.context.instanceCounter.increment(Es.Texture,this),this._descriptor.context.type!==rr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),Av(this._descriptor.target)))throw new Y("3D and array textures are not supported in WebGL1");this._descriptor.target===nn.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return wWe.delete(this),mWe(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(Es.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new Y("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===nn.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=nn.TEXTURE_CUBE_MAP_POSITIVE_X;r<=nn.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._descriptor.context||!this._descriptor.context.gl)return;const i=this._descriptor.context.gl;Gy(i),this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const n=this._descriptor,s=r??n.target,o=Av(s);e===null&&(n.width=n.width||_ne,n.height=n.height||_ne,o&&(n.depth=n.depth??1));const a=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),Nk(this._descriptor.context,n),this._configurePixelStorage(),Gy(i);const l=this._deriveInternalFormat();if(Fk(e)){let c=e.width,u=e.height;const d=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,u=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,u,d),this._texImage(s,0,l,c,u,d,e),Gy(i),n.hasMipmap&&this.generateMipmap(),n.width||(n.width=c),n.height||(n.height=u),o&&!n.depth&&(n.depth=d)}else{const{width:c,height:u,depth:d}=n;if(c==null||u==null)throw new Y("Width and height must be specified!");if(o&&d==null)throw new Y("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,u,d),OD(e)){const p=e.levels,m=wne(s,c,u,d),y=Math.min(m-1,p.length-1);this._descriptor.context.gl2!=null?i.texParameteri(n.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,y):n.hasMipmap=n.hasMipmap&&m===p.length;const _=l;if(!vWe(_))throw new Y("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((v,b,x,T)=>{const S=p[Math.min(v,p.length-1)];this._compressedTexImage(s,v,_,b,x,T,S)},y)}else this._texImage(s,0,l,c,u,d,e),Gy(i),n.hasMipmap&&this.generateMipmap()}vne(i,this._descriptor),bne(i,this._descriptor),yWe(this._descriptor.context,this._descriptor),Gy(i),this._descriptor.context.bindTexture(a,Ct.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,u=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:p,dataType:m,target:y,isImmutable:_}=u;if(_&&!this._wasImmutablyAllocated)throw new Y("Cannot update immutable texture before allocation!");const v=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||n>u.width||s>u.height||r+n>u.width||i+s>u.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(Fk(o)?c?c.texSubImage2D(y,e,r,i,n,s,p,m,o):l.texSubImage2D(y,e,r,i,p,m,o):OD(o)?l.compressedTexSubImage2D(y,e,r,i,n,s,d,o.levels[e]):l.texSubImage2D(y,e,r,i,n,s,p,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(v,Ct.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new Y("3D textures are not supported in WebGL1");const u=this._descriptor,d=this._deriveInternalFormat(),{pixelFormat:p,dataType:m,isImmutable:y,target:_}=u;if(y&&!this._wasImmutablyAllocated)throw new Y("Cannot update immutable texture before allocation!");Av(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||n<0||s>u.width||o>u.height||a>u.depth||r+s>u.width||i+o>u.height||n+a>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),OD(l))l=l.levels[e],c.compressedTexSubImage3D(_,e,r,i,n,s,o,a,d,l);else{const b=l;c.texSubImage3D(_,e,r,i,n,s,o,a,p,m,b)}this._descriptor.context.bindTexture(v,Ct.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new Y("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,Nk(this._descriptor.context,e)}e.samplingMode===At.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=At.LINEAR_MIPMAP_NEAREST):e.samplingMode===At.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=At.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Ct.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Ct.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,Nk(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(vne(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(bne(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===rr.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Tt.DEPTH_STENCIL&&(this._descriptor.internalFormat=Tt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Un.FLOAT:switch(this._descriptor.pixelFormat){case Tt.RGBA:return this._descriptor.internalFormat=qe.RGBA32F;case Tt.RGB:return this._descriptor.internalFormat=qe.RGB32F;default:throw new Y("Unable to derive format")}case Un.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Tt.RGBA:return this._descriptor.internalFormat=qe.RGBA8;case Tt.RGB:return this._descriptor.internalFormat=qe.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Tt.DEPTH_STENCIL?Tt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,r,i,n,s,o){const a=this._descriptor.context.gl2;if(a==null)throw new Y("Immutable textures are not supported in WebGL1");if(!_We(r))throw new Y("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?wne(e,n,s,o):1;if(Av(e)){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,n,s,o)}else a.texStorage2D(e,l,r,n,s);this._wasImmutablyAllocated=!0}_texImage(e,r,i,n,s,o,a){const l=this._descriptor.context.gl,c=Av(e),{isImmutable:u,pixelFormat:d,dataType:p}=this._descriptor,m=this._descriptor.context.type===rr.WEBGL2,y=m?l:null;if(m||!Fk(a))if(u){if(a!=null){const _=a;if(c){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");y.texSubImage3D(e,r,0,0,0,n,s,o,d,p,_)}else l.texSubImage2D(e,r,0,0,n,s,d,p,_)}}else{const _=a;if(c){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");y.texImage3D(e,r,i,n,s,o,0,d,p,_)}else l.texImage2D(e,r,i,n,s,0,d,p,_)}else l.texImage2D(e,0,i,d,p,a)}_compressedTexImage(e,r,i,n,s,o,a){const l=this._descriptor.context.gl;let c=null;const u=Av(e),d=this._descriptor.isImmutable;if(u){if(this._descriptor.context.type!==rr.WEBGL2)throw new Y("3D textures are not supported in WebGL1");c=l}if(d){if(a!=null)if(u){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,n,s,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,n,s,i,a)}else if(u){if(o==null)throw new Y("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,n,s,o,0,a)}else l.compressedTexImage2D(e,r,i,n,s,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===nn.TEXTURE_3D;if(i==null||n==null||l&&s==null)throw new Y("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,n,s),o&&(i!==1||n!==1||l&&s!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}};function Nk(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===rr.WEBGL2;r||!e.isImmutable&&!Av(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&tw(e.width)&&e.height!=null&&tw(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Pt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Pt.CLAMP_TO_EDGE&&e.wrapMode.t===Pt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function vne(t,e){let r=e.samplingMode,i=e.samplingMode;r===At.LINEAR_MIPMAP_NEAREST||r===At.LINEAR_MIPMAP_LINEAR?(r=At.LINEAR,e.hasMipmap||(i=At.LINEAR)):r!==At.NEAREST_MIPMAP_NEAREST&&r!==At.NEAREST_MIPMAP_LINEAR||(r=At.NEAREST,e.hasMipmap||(i=At.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function bne(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function yWe(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function _We(t){return t in qe}function vWe(t){return t in un}function OD(t){return t!=null&&"type"in t&&t.type==="compressed"}function bWe(t){return t!=null&&"byteLength"in t}function Fk(t){return t!=null&&!OD(t)&&!bWe(t)}function Av(t){return t===nn.TEXTURE_3D||t===nn.TEXTURE_2D_ARRAY}function wne(t,e,r,i=1){let n=Math.max(e,r);return t===nn.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}Ct.TEXTURE_UNIT_FOR_UPDATES=0;const wWe=new Map;function Dl(t,e=GZ,r=fr,i=-1,n=1){let s=null;return e===$P?s=new Float32Array([i,i,0,0,n,i,1,0,i,n,0,1,n,n,1,1]):s=new Float32Array([i,i,n,i,i,n,n,n]),new vp(t,r,{geometry:e},{geometry:Ar.createVertex(t,gr.STATIC_DRAW,s)})}function xWe(t,e=GZ,r=fr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new vp(t,r,{geometry:e},{geometry:Ar.createVertex(t,gr.STATIC_DRAW,i)})}const mxe=4;function gxe(t,e=mxe){const r=new pr;return r.samplingMode=At.NEAREST,r.width=r.height=e,new Ct(t,r)}function TWe(t,e,r=mxe){const i=new Uint8Array(r*r*4);for(let s=0;s<i.length;s+=4)i[s]=255*e[0],i[s+1]=255*e[1],i[s+2]=255*e[2],i[s+3]=255*e[3];const n=new pr;return n.samplingMode=At.NEAREST,n.width=n.height=r,new Ct(t,n,i)}function yxe(t){const e=new pr;return e.samplingMode=At.NEAREST,e.width=e.height=1,new Ct(t,e,new Uint8Array([255,255,255,255]))}let xne=class{constructor(e,r){this._view=e,this.type=ra.Realistic,this._handles=new Vi,this._passParameters=new hWe,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Kt.radius,this._fadeHaze=0,this._tmpScale=Ne(),this._updateRadius(Kt.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([ue(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateRootTileElevationBounds():null}),ue(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateVisibleElevationBounds():null})]);const n=new t5;n.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(Y3,n),n.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(Y3,n),n.reduced=!0,n.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(Y3,n),n.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(Y3,n),this._vao=Dl(i,$P)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(e,r,i,n,s){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=o.background.color;ne(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(n)o.renderDepthDetached(()=>this._renderCommon(l,e));else{const c=e.rctx.getViewport(),u=Te(e.bindParameters.camera.eye)-Kt.radius;let d;if(u<$y){const y=Math.min(1,Math.max(0,u/$y));d=s?wt(.4,.5,y):wt(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(u-$y)/(15*$y)));d=s?wt(.5,1,y):wt(.3,.6,y)}const p=Math.floor(d*e.bindParameters.camera.fullViewport[2]),m=Math.floor(d*e.bindParameters.camera.fullViewport[3]);e.rctx.setViewport(0,0,p,m),o.renderToTargets(()=>this._renderCommon(l,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(c.x,c.y,c.width,c.height),er(this._tmpScale,p/e.bindParameters.camera.fullViewport[2],m/e.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(e.bindParameters,s,i,this._tmpScale)}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(Et.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Kt.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Kt.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,er(this._passParameters.radii,e,e+$y),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-dj)*dj)}_update(e){if(!e)return;const r=la(e.eye),i=Math.sqrt(r),n=r-this._passParameters.radii[1]*this._passParameters.radii[1],s=ge((i-this._passParameters.radii[0])/$y,0,1);gi(this._passParameters.heightParameters,i,r,n,s),this._passParameters.altitudeFade=BZ(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=wt(wt(.6,1,nR(9500,10500,i-Kt.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function _xe(t){t.fragment.code.add(w`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function qZ(t,e){switch(t.include(Uf,e),e.textureCoordinateType){case Pn.Default:case Pn.Compressed:return void t.fragment.code.add(w`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Pn.Atlas:return t.include(_xe),void t.fragment.code.add(w`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Pn.None:case Pn.COUNT:return}}let pu=class extends ln{constructor(e,r){super(e,"vec3",jr.Draw,(i,n,s,o)=>i.setUniform3fv(e,r(n,s,o)))}},Eh=class extends ln{constructor(e,r){super(e,"sampler2D",jr.Draw,(i,n,s)=>i.bindTexture(e,r(n,s)))}},h1=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return bg.LOADED}},XZ=class extends h1{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Fi(this._texture),this._textureNormal=Fi(this._textureNormal),this._textureEmissive=Fi(this._textureEmissive),this._textureOcclusion=Fi(this._textureOcclusion),this._textureMetallicRoughness=Fi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?bg.LOADED:bg.LOADING}get textureBindParameters(){return new vxe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=Fi(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(Eu(i))return++this._numLoading,void i.then(n=>{if(this._disposed)return Fi(n),void r(null);r(n)}).finally(()=>--this._numLoading);r(i)}},vxe=class extends Wr{constructor(e=null,r=null,i=null,n=null,s=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=n,this.textureMetallicRoughness=s}};var et;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(et||(et={}));function YZ(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===et.Normal&&i&&t.include(qZ,e),e.pbrMode!==et.Schematic)if(e.pbrMode!==et.Disabled){if(e.pbrMode===et.Normal){r.code.add(w`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(n===jr.Pass?new Ye("texMetallicRoughness",s=>s.textureMetallicRoughness):new Eh("texMetallicRoughness",s=>s.textureMetallicRoughness)),r.code.add(w`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(n===jr.Pass?new Ye("texEmission",s=>s.textureEmissive):new Eh("texEmission",s=>s.textureEmissive)),r.code.add(w`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(n===jr.Pass?new Ye("texOcclusion",s=>s.textureOcclusion):new Eh("texOcclusion",s=>s.textureOcclusion)),r.code.add(w`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(w`float getBakedOcclusion() { return 1.0; }`),n===jr.Pass?r.uniforms.add(new Lt("emissionFactor",s=>s.emissiveFactor),new Lt("mrrFactors",s=>s.mrrFactors)):r.uniforms.add(new pu("emissionFactor",s=>s.emissiveFactor),new pu("mrrFactors",s=>s.mrrFactors)),r.code.add(w`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?w`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?w`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?w`applyEmission(${e.hasEmissiveTextureTransform?w`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?w`applyOcclusion(${e.hasOcclusionTextureTransform?w`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(w`float getBakedOcclusion() { return 1.0; }`);else r.code.add(w`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function ZZ(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Lt("lightingAmbientSH0",(n,s)=>ne(Tne,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new Jt("lightingAmbientSH_R",(n,s)=>gi(mm,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new Jt("lightingAmbientSH_G",(n,s)=>gi(mm,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new Jt("lightingAmbientSH_B",(n,s)=>gi(mm,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new Lt("lightingAmbientSH0",(n,s)=>ne(Tne,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new Jt("lightingAmbientSH_R1",(n,s)=>gi(mm,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new Jt("lightingAmbientSH_G1",(n,s)=>gi(mm,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new Jt("lightingAmbientSH_B1",(n,s)=>gi(mm,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new Jt("lightingAmbientSH_R2",(n,s)=>gi(mm,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new Jt("lightingAmbientSH_G2",(n,s)=>gi(mm,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new Jt("lightingAmbientSH_B2",(n,s)=>gi(mm,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),r.code.add(w`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==et.Normal&&e.pbrMode!==et.Schematic||r.code.add(w`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Tne=O(),mm=Qt();function IP(t){t.vertex.code.add(w`const float PI = 3.141592653589793;`),t.fragment.code.add(w`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var On,dw;function SWe(t){return(t==null?void 0:t.cubeMap)!=null}function QZ(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(On||(On={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(dw||(dw={}));let EWe=class{constructor(){this.readChannels=dw.RG,this.renderingStage=On.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=O(),this.isCameraPositionFinal=!0,this.parallax=new Sne,this.parallaxNew=new Sne,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:ys.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:oc.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:H_.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===ys.FADE_OUT||this.fadeInOut.stage===ys.FADE_IN||this.fadeIn.stage===oc.FADE_IN||this.fadeInOutHeight.stage!==H_.FINISHED||this.renderingStage===On.FADING_TEXTURE_CHANNELS}};var oc,ys,H_;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(oc||(oc={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(ys||(ys={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(H_||(H_={}));let Sne=class{constructor(){this.anchorPointClouds=O(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=_e()}},kf=class extends ln{constructor(e,r){super(e,"bool",jr.Pass,(i,n,s)=>i.setUniform1b(e,r(n,s)))}},CWe=class extends ln{constructor(e,r){super(e,"samplerCube",jr.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function bxe(t){const e=t.fragment;e.uniforms.add(new Mi("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new Mi("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Lt("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Lt("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Ce("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Ce("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ce("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===ys.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Ce("crossFadeAnchorFactor",(r,i)=>ge(i.cloudsFade.crossFade.factor,0,1)),new CWe("cubeMap",(r,i)=>{var n;return(n=i.cloudsFade.data)!=null&&n.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null}),new kf("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new kf("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===dw.RG),new kf("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===On.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",Kt.radius),e.code.add(w`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(w`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(w`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),r0(e),lm(e),e.code.add(w`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(w`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(w`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(w`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(w`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function cm(t){t.code.add(w`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function AWe(){const t=new mr;t.attributes.add(E.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Mi("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new Mi("inverseViewMatrix",(i,n)=>wE(OWe,n.camera.viewMatrix))),e.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(cm),r.include(Pc),t.include(ZZ,{pbrMode:et.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(IP),t.include(Q6),t.include(K4),t.include(bxe,{instancedDoublePrecision:!1}),r.uniforms.add(new Lt("cameraPosition",(i,n)=>n.camera.eye)),r.code.add(w`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const OWe=_e(),RWe=Object.freeze(Object.defineProperty({__proto__:null,build:AWe},Symbol.toStringTag,{value:"Module"}));let wxe=class xxe extends Tr{constructor(e){super(e,new va,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,xxe.shader.get().build(),fr)}initializePipeline(){return Ot({blending:So(ve.ONE,ve.ZERO,ve.SRC_ALPHA,ve.ONE),depthTest:{func:Hr.LEQUAL},colorWrite:Ft})}};wxe.shader=new _r(RWe,()=>ce(()=>import("./CloudsComposition.glsl-e9072d6f.js"),[]));let Ov=class extends xe{constructor(e){super(e),this._technique=new wxe(e),this._vao=Dl(e.rctx)}destroy(){this._technique=Fi(this._technique),this._vao=Le(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,PWe,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Et.TRIANGLE_STRIP,0,4)}};h([f({constructOnly:!0})],Ov.prototype,"rctx",void 0),h([f({constructOnly:!0})],Ov.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],Ov.prototype,"planetRadius",void 0),h([f({constructOnly:!0})],Ov.prototype,"requestRender",void 0),Ov=h([N("esri.views.3d.environment.CloudsComposition")],Ov);const PWe=new Wr;function Ac(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function MWe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function JZ(t,e,r,i,n,s,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function KZ(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Uh(t,e){if(t===e){const r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Vw(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,p=-u*s+a*l,m=c*s-o*l;let y=r*d+i*p+n*m;return y?(y=1/y,t[0]=d*y,t[1]=(-u*i+n*c)*y,t[2]=(a*i-n*o)*y,t[3]=p*y,t[4]=(u*r-n*l)*y,t[5]=(-a*r+n*s)*y,t[6]=m*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*s)*y,t):null}function $We(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=n*c-i*u,t[2]=i*a-n*o,t[3]=a*l-s*u,t[4]=r*u-n*l,t[5]=n*s-r*a,t[6]=s*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*s,t}function IWe(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)}function US(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],m=r[1],y=r[2],_=r[3],v=r[4],b=r[5],x=r[6],T=r[7],S=r[8];return t[0]=p*i+m*o+y*c,t[1]=p*n+m*a+y*u,t[2]=p*s+m*l+y*d,t[3]=_*i+v*o+b*c,t[4]=_*n+v*a+b*u,t[5]=_*s+v*l+b*d,t[6]=x*i+T*o+S*c,t[7]=x*n+T*a+S*u,t[8]=x*s+T*l+S*d,t}function r5(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],m=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=p*i+m*o+c,t[7]=p*n+m*a+u,t[8]=p*s+m*l+d,t}function eQ(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=Math.sin(r),m=Math.cos(r);return t[0]=m*i+p*o,t[1]=m*n+p*a,t[2]=m*s+p*l,t[3]=m*o-p*i,t[4]=m*a-p*n,t[5]=m*l-p*s,t[6]=c,t[7]=u,t[8]=d,t}function tQ(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function LWe(t,e,r){const i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function DWe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function NWe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function FWe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function UWe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function rQ(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,d=i*a,p=n*o,m=n*a,y=n*l,_=s*o,v=s*a,b=s*l;return t[0]=1-d-y,t[3]=u-b,t[6]=p+v,t[1]=u+b,t[4]=1-c-y,t[7]=m-_,t[2]=p-v,t[5]=m+_,t[8]=1-c-d,t}function Txe(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],d=u*o-a*c,p=-u*s+a*l,m=c*s-o*l,y=r*d+i*p+n*m;if(!y)return null;const _=1/y;return t[0]=d*_,t[1]=(-u*i+n*c)*_,t[2]=(a*i-n*o)*_,t[3]=p*_,t[4]=(u*r-n*l)*_,t[5]=(-a*r+n*s)*_,t[6]=m*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*s)*_,t}function Qf(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],y=e[12],_=e[13],v=e[14],b=e[15],x=r*a-i*o,T=r*l-n*o,S=r*c-s*o,A=i*l-n*a,C=i*c-s*a,R=n*c-s*l,P=u*_-d*y,F=u*v-p*y,k=u*b-m*y,V=d*v-p*_,z=d*b-m*_,X=p*b-m*v;let q=x*X-T*z+S*V+A*k-C*F+R*P;return q?(q=1/q,t[0]=(a*X-l*z+c*V)*q,t[1]=(l*k-o*X-c*F)*q,t[2]=(o*z-a*k+c*P)*q,t[3]=(n*z-i*X-s*V)*q,t[4]=(r*X-n*k+s*F)*q,t[5]=(i*k-r*z-s*P)*q,t[6]=(_*R-v*C+b*A)*q,t[7]=(v*S-y*R-b*T)*q,t[8]=(y*C-_*S+b*x)*q,t):null}function kWe(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function zWe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function BWe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function VWe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function Sxe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function GWe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function jWe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function HWe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function WWe(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=e[0],p=e[1],m=e[2],y=e[3],_=e[4],v=e[5],b=e[6],x=e[7],T=e[8],S=tl();return Math.abs(r-d)<=S*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-p)<=S*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(n-m)<=S*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-y)<=S*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-x)<=S*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-T)<=S*Math.max(1,Math.abs(u),Math.abs(T))}function iQ(t){const e=tl(),r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}const qWe=US,XWe=Sxe;Object.freeze(Object.defineProperty({__proto__:null,add:VWe,adjoint:$We,copy:MWe,determinant:IWe,equals:WWe,exactEquals:HWe,frob:BWe,fromMat2d:UWe,fromMat4:Ac,fromQuat:rQ,fromRotation:NWe,fromScaling:FWe,fromTranslation:DWe,identity:KZ,invert:Vw,isOrthoNormal:iQ,mul:qWe,multiply:US,multiplyScalar:GWe,multiplyScalarAndAdd:jWe,normalFromMat4:Qf,normalFromMat4Legacy:Txe,projection:kWe,rotate:eQ,scale:tQ,scaleByVec2:LWe,set:JZ,str:zWe,sub:XWe,subtract:Sxe,translate:r5,transpose:Uh},Symbol.toStringTag,{value:"Module"}));function rn(){return new Float32Array(3)}function i5(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function zr(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function Exe(t,e){return new Float32Array(t,e,3)}function nQ(){return rn()}function Cxe(){return zr(1,1,1)}function Axe(){return zr(1,0,0)}function Oxe(){return zr(0,1,0)}function Rxe(){return zr(0,0,1)}const YWe=nQ(),ZWe=Cxe(),QWe=Axe(),JWe=Oxe(),KWe=Rxe();Object.freeze(Object.defineProperty({__proto__:null,ONES:ZWe,UNIT_X:QWe,UNIT_Y:JWe,UNIT_Z:KWe,ZEROS:YWe,clone:i5,create:rn,createView:Exe,fromValues:zr,ones:Cxe,unitX:Axe,unitY:Oxe,unitZ:Rxe,zeros:nQ},Symbol.toStringTag,{value:"Module"}));var El;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(El||(El={}));let RD=class extends va{constructor(){super(...arguments),this.steps=El.SIXTEEN,this.writeTextureChannels=dw.RG}};h([U({count:El.COUNT})],RD.prototype,"steps",void 0),h([U({constValue:se("esri-mobile")?1024:2048})],RD.prototype,"cubeMapSize",void 0),h([U()],RD.prototype,"writeTextureChannels",void 0);let Z3=class{constructor(e,r,i,n,s,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Ene=new Z3([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],El.SIXTEEN),ea={sunny:Ene,cloudy:new Z3([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],El.TWOHUNDRED,.6),rainy:new Z3([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],El.TWOHUNDRED,.4),snowy:new Z3([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],El.HUNDRED,.65),foggy:new Z3([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],El.SIXTEEN),default:Ene},nh=se("esri-mobile")?64:128,eqe=nh/128,Ad=Math.ceil(Math.sqrt(nh)),C_=(nh+2)*Ad,tqe=1e5,Uk=128,rqe=C_/1560;function Vh(t,e=!0){t.attributes.add(E.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(w`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?w`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let xR=class extends ln{constructor(e,r){super(e,"mat3",jr.Draw,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}},Pxe=class extends Wr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=ea.default.raymarchingSteps,this.weatherTile=Ne()}},Mxe=class extends Wr{constructor(){super(...arguments),this.viewMatrix=hi()}};function iqe(t){const e=new mr;e.include(Vh,!1);const r=e.fragment;return r.uniforms.add(new Ce("cloudRadius",i=>i.cloudRadius),new Ce("power",i=>wt(35,120,i.absorption)),new Ce("sigmaE",i=>1+i.absorption),new Ce("density",i=>wt(0,.3,i.density)),new Ce("cloudSize",i=>wt(0,.02,Math.max(.01,1-i.cloudSize))),new Ce("detailSize",i=>wt(0,.2,Math.max(.01,1-i.detailSize))),new Ce("smoothness",i=>wt(0,.5,1-i.smoothness)),new Ce("cloudHeight",i=>wt(0,1500,i.cloudHeight)),new Ce("coverage",i=>i.coverage),new xR("view",i=>i.viewMatrix),new Ye("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new yr("cloudVariables",i=>er(nqe,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(w`
    const int STEPS = ${t.steps===El.SIXTEEN?w`16`:t.steps===El.HUNDRED?w`100`:w`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(w`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${w.float(C_)};
      const float dataWidth = ${w.float(C_)};
      const float tileRows = ${w.float(Ad)};
      const vec3 atlasDimensions = vec3(${w.float(nh)}, ${w.float(nh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${w.float(eqe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${w.float(rqe)} * p) / ${w.float(C_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(w`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(w`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(w`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(w`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(w`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const nqe=Ne(),sqe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:Mxe,CloudsPassParameters:Pxe,build:iqe},Symbol.toStringTag,{value:"Module"}));let $xe=class Ixe extends Tr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,Ixe.shader.get().build(this.configuration),fr)}initializePipeline(){return Ot({blending:Cc(ve.CONSTANT_COLOR,ve.ONE_MINUS_CONSTANT_COLOR,Zf.ADD,this.configuration.writeTextureChannels===dw.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Hr.LEQUAL},colorWrite:Ft})}};$xe.shader=new _r(sqe,()=>ce(()=>import("./Clouds.glsl-918fa9c8.js"),[]));var su;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(su||(su={}));let _j=class extends va{constructor(){super(...arguments),this.mode=su.Full}};h([U({count:su.COUNT})],_j.prototype,"mode",void 0);let Lxe=class extends Wr{constructor(){super(...arguments),this.weatherTile=or(0,0)}};function oqe(t){const e=new mr;return e.include(Vh,!1),e.fragment.code.add(w`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===su.Full&&e.fragment.code.add(w`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${w.float(Ad)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${w.float(8)});

      float worley0 = worley(p, ${w.float(2)} * 2.0);
      float worley1 = worley(p, ${w.float(2)} * 8.0);
      float worley2 = worley(p, ${w.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${w.float(2)});
      float worley1 = worley(p, ${w.float(2)} * 2.0);
      float worley2 = worley(p, ${w.float(2)} * 4.0);
      float worley3 = worley(p, ${w.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new yr("weatherTile",r=>r.weatherTile)),e.fragment.code.add(w`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${w.float(Uk)});

      // Get global coordinates of p
      p += weatherTile * ${w.float(Uk)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${w.float(tqe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(w`void main() {`),t.mode===su.Full&&e.fragment.code.add(w`
        float padWidth = 1.0;
        float paddedSize = ${w.float(nh)} + 2.0 * padWidth;
        float tileCount = ${w.float(Ad)} * ${w.float(Ad)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${w.float(nh)};
          }

          if (startPadY) {
            pixel.y += ${w.float(nh)};
          }

          if (endPadX) {
            pixel.x -= ${w.float(nh)};
          }

          if (endPadY) {
            pixel.y -= ${w.float(nh)};
          }

          uv = vec2(pixel.xy / ${w.float(nh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${w.float(nh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${w.float(Ad)} * ${w.float(Ad)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${w.float(Ad)} * ${w.float(Ad)});
        p = p_;
        p.z /= (${w.float(Ad)} * ${w.float(Ad)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(w`
      vec2 mapUV = ${w.float(Uk)} * (gl_FragCoord.xy / ${w.float(C_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===su.Full?w`fragColor.ba = vec2(0.0, map);`:w`fragColor = vec4(map);`};
    }
  `),e}const aqe=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:Lxe,build:oqe},Symbol.toStringTag,{value:"Module"}));let vj=class Dxe extends Tr{initializeProgram(e){return new vr(e.rctx,Dxe.shader.get().build(this.configuration),fr)}initializePipeline(){return Ot({blending:this.configuration.mode===su.Full?Cc(ve.ONE,ve.ZERO):So(ve.ZERO,ve.ONE,ve.ONE,ve.ZERO),depthTest:{func:Hr.ALWAYS},colorWrite:Ft})}};vj.shader=new _r(aqe,()=>ce(()=>import("./NoiseTextureAtlas.glsl-655df1b4.js"),[]));let n5=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function lqe(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*WZ(t.internalFormat)}let cqe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=j_.RenderBuffer,this._context.instanceCounter.increment(Es.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==rr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,n,s)}else i.renderbufferStorage(i.RENDERBUFFER,o,n,s)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get gpuMemoryUsage(){return lqe(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Es.Renderbuffer,this),this._context=lE(this._context))}};const uqe=J.getLogger("esri.views.webgl.FramebufferObject");let hs=class E2{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Es.FramebufferObject,this);const n=PD(r)?r:new Ct(this._context,r);if(this._colorAttachments.set(qc.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(qc.COLOR_ATTACHMENT0),i!=null)if(dqe(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=PD(i)?i:new Ct(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=hqe(i)?i:new cqe(this._context,i),o=s.descriptor;o.internalFormat===jn.STENCIL_INDEX8?this._stencilBuffer=s:this._depthBuffer=s,this._validateRenderBufferDescriptor(o)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((n,s)=>{var o;return(o=this.detachColorTexture(s))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Es.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(qc.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(qc.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(qc.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get gpuMemoryUsage(){var e;return[...this._colorAttachments].reduce((r,[i,n])=>r+n.gpuMemoryUsage,((e=this.depthStencilAttachment)==null?void 0:e.gpuMemoryUsage)??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&PD(r)?r:null}attachColorTexture(e,r=qc.COLOR_ATTACHMENT0){var n;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(n=this.detachColorTexture(r))==null||n.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=qc.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}setColorTextureTarget(e,r=qc.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case j_.Texture:return this._attachDepthStencilTexture(e);case j_.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==Tt.DEPTH_STENCIL&&r.pixelFormat!==Tt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Un.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,dne)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,dne)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){var i;if(e==null)return;const r=e.descriptor;if(r.internalFormat!==jn.DEPTH_STENCIL&&r.internalFormat!==jn.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const n=this._context.gl,s=this._getGLAttachmentPoint(r);n.framebufferRenderbuffer(mo.FRAMEBUFFER,s,n.RENDERBUFFER,e.glName)}(i=this._depthBuffer)==null||i.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(mo.FRAMEBUFFER,i,r.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,r,i,n,s,o,a){(e<0||r<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==nn.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+n>this.height||s+i>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Ct.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Ct.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(nn.TEXTURE_2D,0,s,o,e,r,i,n),c.bindTexture(u,Ct.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,n,s,o,a){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,n,s,o,a)}async readPixelsAsync(e,r,i,n,s,o,a){if(this._context.type!==rr.WEBGL2)return eh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,n,s,o,a);const l=this._context.gl,c=Ar.createPixelPack(this._context,gr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,n,s,o,0),this._context.unbindBuffer(bt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var n,s,o;if(this.width===e&&this.height===r)return;const i={width:e,height:r};_b(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(a=>a.resize(i.width,i.height)),(n=this._depthStencilTexture)==null||n.resize(i.width,i.height),this._initialized&&(_b(i,this._context.parameters.maxRenderbufferSize),(s=this._depthBuffer)==null||s.resize(i.width,i.height),(o=this._stencilBuffer)==null||o.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=mo.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(e,i),this._colorAttachments.forEach((s,o)=>this._framebufferTexture2D(s.glName,o,Cne(s),e));const n=this._depthBuffer||this._stencilBuffer;if(n){const s=this._getGLAttachmentPoint(n.descriptor);r.framebufferRenderbuffer(e,s,r.RENDERBUFFER,n.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Cne(this._depthStencilTexture),e);eh()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=qc.COLOR_ATTACHMENT0,i=nn.TEXTURE_2D,n=mo.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,r,i,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(mo.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthBuffer=Le(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(mo.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=Le(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=Le(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==nn.TEXTURE_2D&&e.target!==nn.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),_b(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){_b(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case jn.DEPTH_COMPONENT16:case jn.DEPTH_COMPONENT24:case jn.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case jn.DEPTH24_STENCIL8:case jn.DEPTH32F_STENCIL8:case jn.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case jn.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(E2._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const n=this._context.gl;E2._MAX_COLOR_ATTACHMENTS=n.getParameter(i.MAX_COLOR_ATTACHMENTS)}else E2._MAX_COLOR_ATTACHMENTS=1}const r=e-qc.COLOR_ATTACHMENT0;r+1>E2._MAX_COLOR_ATTACHMENTS&&J.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${E2._MAX_COLOR_ATTACHMENTS} color attachments`)}};function PD(t){return t!=null&&"type"in t&&t.type===j_.Texture}function hqe(t){return t!=null&&"type"in t&&t.type===j_.RenderBuffer}function dqe(t){return PD(t)||t!=null&&"pixelFormat"in t}function _b(t,e){const r=Math.max(t.width,t.height);if(r>e){uqe.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function Cne(t){return t.descriptor.target===nn.TEXTURE_CUBE_MAP?nn.TEXTURE_CUBE_MAP_POSITIVE_X:nn.TEXTURE_2D}hs._MAX_COLOR_ATTACHMENTS=-1;let Q3=class extends xe{constructor(e){super(e),this._needsRender=!0,this._passParameters=new Lxe,this._frameBuffer=new hs(e.context.renderContext.rctx,new pr(C_)),this._vao=Dl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(su.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(su.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(fs(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Fi(this._fullTechniqueCached),this._weatherMapTechniqueCached=Fi(this._weatherMapTechniqueCached),this._frameBuffer=Le(this._frameBuffer),this._vao=Le(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new _j;e.mode=su.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(vj,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new _j;e.mode=su.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(vj,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===su.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,n=i.getViewport();i.setViewport(0,0,C_,C_),i.bindFramebuffer(this._frameBuffer);const s=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};h([f({constructOnly:!0})],Q3.prototype,"context",void 0),h([f({readOnly:!0})],Q3.prototype,"_techniqueRepository",null),Q3=h([N("esri.views.3d.environment.NoiseTextureAtlas")],Q3);function Nxe(t){t.include(wu),t.uniforms.add(new Ye("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new yr("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(w`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let pqe=class{constructor(){this.enabled=!1}};function xu(t,e){e.hasMultipassTerrain&&(t.fragment.include(wu),t.fragment.uniforms.add(new Ye("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new yr("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new yr("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(w`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let fqe=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function mqe(t,e){const r=t.fragment;r.include(wu),r.uniforms.add(new yr("nearFar",(i,n)=>n.camera.nearFar)),r.uniforms.add(new Ye("depthMap",(i,n)=>n.linearDepthTexture)),r.uniforms.add(new Mi("proj",(i,n)=>n.ssr.camera.projectionMatrix)),r.uniforms.add(new Ce("invResolutionHeight",(i,n)=>1/n.ssr.camera.height)),r.uniforms.add(new Mi("reprojectionMatrix",(i,n)=>n.ssr.reprojectionMatrix)),r.code.add(w`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let gqe=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=_e()}};function K6(t){return t?{ray:qs(t.ray),c0:t.c0,c1:t.c1}:{ray:qs(),c0:0,c1:Number.MAX_VALUE}}function yqe(t,e=K6()){return W4(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function _qe(t,e,r=K6()){const i=Te(t.vector);return dbe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function RPt(t,e){return Fxe(t,t.c0,e)}function PPt(t,e){return Fxe(t,t.c1,e)}function Fxe(t,e,r){return oe(r,t.ray.origin,te(r,t.ray.direction,e))}new Kg(()=>K6());function TR(t){return t?[Er(t[0]),Er(t[1]),Er(t[2]),Er(t[3]),Er(t[4]),Er(t[5])]:[Er(),Er(),Er(),Er(),Er(),Er()]}function Uxe(){return[O(),O(),O(),O(),O(),O(),O(),O()]}function s5(t,e){for(let r=0;r<CE;r++)V6(t[r],e[r])}function kxe(t,e,r,i=Sqe){const n=Vr(bZ.get(),e,t);us(n,n);for(let s=0;s<xqe;++s){const o=au(vZ.get(),Tqe[s],n);ne(i[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}zxe(r,i)}function zxe(t,e){oa(e[Xe.FAR_BOTTOM_LEFT],e[Xe.NEAR_BOTTOM_LEFT],e[Xe.NEAR_TOP_LEFT],t[si.LEFT]),oa(e[Xe.NEAR_BOTTOM_RIGHT],e[Xe.FAR_BOTTOM_RIGHT],e[Xe.FAR_TOP_RIGHT],t[si.RIGHT]),oa(e[Xe.FAR_BOTTOM_LEFT],e[Xe.FAR_BOTTOM_RIGHT],e[Xe.NEAR_BOTTOM_RIGHT],t[si.BOTTOM]),oa(e[Xe.NEAR_TOP_LEFT],e[Xe.NEAR_TOP_RIGHT],e[Xe.FAR_TOP_RIGHT],t[si.TOP]),oa(e[Xe.NEAR_BOTTOM_LEFT],e[Xe.NEAR_BOTTOM_RIGHT],e[Xe.NEAR_TOP_RIGHT],t[si.NEAR]),oa(e[Xe.FAR_BOTTOM_RIGHT],e[Xe.FAR_BOTTOM_LEFT],e[Xe.FAR_TOP_LEFT],t[si.FAR])}function h_(t,e){for(let r=0;r<CE;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function vqe(t,e){return Vxe(t,yqe(e,Gxe.get()))}function MPt(t,e){for(let r=0;r<CE;r++){const i=t[r];if(!UVe(i,e))return!1}return!0}function bqe(t,e,r){return Vxe(t,_qe(e,r,Gxe.get()))}function Bxe(t,e){for(let r=0;r<CE;r++)if(oi(t[r],e)>0)return!1;return!0}function Vxe(t,e){for(let r=0;r<CE;r++)if(!FVe(t[r],e))return!1;return!0}var si,Xe;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(si||(si={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Xe||(Xe={}));const wqe={bottom:[Xe.FAR_BOTTOM_RIGHT,Xe.NEAR_BOTTOM_RIGHT,Xe.NEAR_BOTTOM_LEFT,Xe.FAR_BOTTOM_LEFT],near:[Xe.NEAR_BOTTOM_LEFT,Xe.NEAR_BOTTOM_RIGHT,Xe.NEAR_TOP_RIGHT,Xe.NEAR_TOP_LEFT],far:[Xe.FAR_BOTTOM_RIGHT,Xe.FAR_BOTTOM_LEFT,Xe.FAR_TOP_LEFT,Xe.FAR_TOP_RIGHT],right:[Xe.NEAR_BOTTOM_RIGHT,Xe.FAR_BOTTOM_RIGHT,Xe.FAR_TOP_RIGHT,Xe.NEAR_TOP_RIGHT],left:[Xe.FAR_BOTTOM_LEFT,Xe.NEAR_BOTTOM_LEFT,Xe.NEAR_TOP_LEFT,Xe.FAR_TOP_LEFT],top:[Xe.FAR_TOP_LEFT,Xe.NEAR_TOP_LEFT,Xe.NEAR_TOP_RIGHT,Xe.FAR_TOP_RIGHT]},CE=6,xqe=8,Tqe=[$t(-1,-1,-1,1),$t(1,-1,-1,1),$t(1,1,-1,1),$t(-1,1,-1,1),$t(-1,-1,1,1),$t(1,-1,1,1),$t(1,1,1,1),$t(-1,1,1,1)],Gxe=new Kg(K6),Sqe=Uxe();function Eqe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function Cqe(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function Aqe(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function Oqe(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var bj;let lt=bj=class extends xe{constructor(t={}){super(t),this._center=O(),this._up=O(),this._viewUp=O(),this._viewForward=O(),this._viewRight=O(),this._ray=qs(),this._viewport=$t(0,0,1,1),this._padding=$t(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=or(1,1e3),this._viewDirty=!0,this._viewMatrix=_e(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=_e(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=_e(),this._frustumDirty=!0,this._frustum=TR(),this._fullViewport=Qt(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ae(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){In(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=ew(Qt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&x4(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=ew(Qt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&x4(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[Yt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[Yt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Yt.RIGHT]+this._padding[Yt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Yt.RIGHT]+this._padding[Yt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Yt.TOP]+this._padding[Yt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Yt.TOP]+this._padding[Yt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Yt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Yt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){LT(this._padding,t)||(this._viewport[0]+=t[Yt.LEFT]-this._padding[Yt.LEFT],this._viewport[1]+=t[Yt.BOTTOM]-this._padding[Yt.BOTTOM],this._viewport[2]-=t[Yt.RIGHT]+t[Yt.LEFT]-(this._padding[Yt.RIGHT]+this._padding[Yt.LEFT]),this._viewport[3]-=t[Yt.TOP]+t[Yt.BOTTOM]-(this._padding[Yt.TOP]+this._padding[Yt.BOTTOM]),vh(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Vr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,n=fve(_e(),-i*(1+2*this._padding[Yt.LEFT]/t),i*(1+2*this._padding[Yt.RIGHT]/t),-r*(1+2*this._padding[Yt.BOTTOM]/e),r*(1+2*this._padding[Yt.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&I6(s,n)?s:n}get inverseProjectionMatrix(){return us(_e(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||_e()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Aqe(this._fov,this.width,this.height)}set fovX(t){this._fov=Eqe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Oqe(this._fov,this.width,this.height)}set fovY(t){this._fov=Cqe(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return ci(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(us(this._viewInverseTransposeMatrix,this.viewMatrix),Sc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){re(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,vh(this._viewport,t.viewport),this.notifyChange("_viewport"),vh(this._padding,t.padding),this.notifyChange("_padding"),fs(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(In(this._viewMatrix,t.viewMatrix),re(this._viewRight,t.viewRight),re(this._viewUp,t.viewUp),re(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(s5(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(In(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),vh(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new bj().copyFrom(this)}equals(t){return Bo(this.eye,t.eye)&&Bo(this.center,t.center)&&Bo(this.up,t.up)&&LT(this._viewport,t.viewport)&&LT(this._padding,t.padding)&&Xwe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||w4(t.screenPadding,this.screenPadding)>=1||w4(this.screenViewport,t.screenViewport)>=1)return!1;Ws(Xo,t.eye,t.center),Ws(kk,this.eye,this.center);const e=fe(Xo,kk),r=qV(Xo),i=qV(kk),n=5e-4;return e*e>=(1-1e-10)*r*i&&u6(t.eye,this.eye)<Math.max(r,i)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(eO(this.viewForward,ae(Xo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Xi()){return t[0]=(this.padding[Yt.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Yt.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[Yt.LEFT]+this.width*e,t[1]=this.padding[Yt.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Xt&&re(Xt,t),Xt[3]=1,au(Xt,Xt,this.projectionMatrix);const r=Math.abs(Xt[3]);te(Xt,Xt,1/r);const i=this.fullViewport;e[0]=wt(0,i[0]+i[2],.5+.5*Xt[0]),e[1]=wt(0,i[1]+i[3],.5+.5*Xt[1]),e[2]=.5*(Xt[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Xt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Xt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Xt[2]=(2*t[2]-1)*t[3],Xt[3]=t[3],this.inverseProjectionMatrix!=null&&(au(Xt,Xt,this.inverseProjectionMatrix),e[0]=Xt[0],e[1]=Xt[1],e[2]=Xt[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,zk),this.renderToScreen(zk,e),e}projectToRenderScreen(t,e){if(Xt[0]=t[0],Xt[1]=t[1],Xt[2]=t[2],Xt[3]=1,au(Xt,Xt,this.viewProjectionMatrix),Xt[3]===0)return null;te(Xt,Xt,1/Math.abs(Xt[3]));const r=this.fullViewport;return"x"in e?(e.x=wt(0,r[0]+r[2],.5+.5*Xt[0]),e.y=wt(0,r[1]+r[3],.5+.5*Xt[1])):(e[0]=wt(0,r[0]+r[2],.5+.5*Xt[0]),e[1]=wt(0,r[1]+r[3],.5+.5*Xt[1]),e.length>2&&(e[2]=.5*(Xt[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,zk),e)}unprojectFromRenderScreen(t,e){if(Vr(y$,this.projectionMatrix,this.viewMatrix),!us(y$,y$))return null;const r=this.fullViewport;return Xt[0]=2*(t[0]-r[0])/r[2]-1,Xt[1]=2*(t[1]-r[1])/r[3]-1,Xt[2]=2*t[2]-1,Xt[3]=1,au(Xt,Xt,y$),Xt[3]===0?null:(e[0]=Xt[0]/Xt[3],e[1]=Xt[1]/Xt[3],e[2]=Xt[2]/Xt[3],e)}constrainWindowSize(t,e,r,i){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-n-r/2,0),i-c- -Math.min(s-i/2,0)]}computeUp(t){t===$e.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){ae(Xo,this.center,this.eye);const t=Te(this.center);t<1?(ne(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(fe(Xo,this.center))>.9999*Te(Xo)*t||(ot(this._up,Xo,this.center),ot(this._up,this._up,Xo),me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){Qg(Xo,this.eye,this.center),Math.abs(Xo[2])<=.9999&&(te(Xo,Xo,Xo[2]),ne(this._up,-Xo[0],-Xo[1],1-Xo[2]),me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Bo(t,e)||(re(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):J.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(kxe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&($6(this._viewMatrix,this.eye,this.center,this.up),ne(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ne(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ne(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};h([f()],lt.prototype,"_center",void 0),h([f()],lt.prototype,"_up",void 0),h([f()],lt.prototype,"_viewport",void 0),h([f()],lt.prototype,"_padding",void 0),h([f()],lt.prototype,"_fov",void 0),h([f()],lt.prototype,"_nearFar",void 0),h([f()],lt.prototype,"_pixelRatio",void 0),h([f()],lt.prototype,"pixelRatio",null),h([f()],lt.prototype,"eye",null),h([f()],lt.prototype,"center",null),h([f()],lt.prototype,"up",null),h([f({readOnly:!0})],lt.prototype,"nearFar",null),h([f()],lt.prototype,"near",null),h([f()],lt.prototype,"far",null),h([f()],lt.prototype,"viewport",null),h([f({readOnly:!0})],lt.prototype,"screenViewport",null),h([f({readOnly:!0})],lt.prototype,"screenPadding",null),h([f()],lt.prototype,"x",null),h([f()],lt.prototype,"y",null),h([f()],lt.prototype,"width",null),h([f()],lt.prototype,"height",null),h([f()],lt.prototype,"fullWidth",null),h([f()],lt.prototype,"fullHeight",null),h([f({readOnly:!0})],lt.prototype,"_aspect",null),h([f()],lt.prototype,"padding",null),h([f({readOnly:!0})],lt.prototype,"projectionMatrix",null),h([f({readOnly:!0})],lt.prototype,"inverseProjectionMatrix",null),h([f()],lt.prototype,"fov",null),h([f()],lt.prototype,"fovX",null),h([f()],lt.prototype,"fovY",null),lt=bj=h([N("esri.views.3d.webgl-engine.lib.Camera")],lt);const Xt=Qt(),y$=_e(),Xo=O(),kk=O(),zk=Vo();var Yt;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(Yt||(Yt={}));var le;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(le||(le={}));var rt;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(rt||(rt={}));let sQ=class{constructor(e=O()){this.intensity=e}},jxe=class{constructor(e=O(),r=Se(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},o5=class{constructor(e=O(),r=Se(.57735,.57735,.57735),i=!0,n=1,s=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=n,this.environmentStrength=s}},Hxe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Rqe(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function Bk(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function UT(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function Wxe(t){return(t+1)*(t+1)}function Pqe(t){return ge(Math.floor(Math.sqrt(t)-1),0,2)}function qxe(t,e,r){const i=t[0],n=t[1],s=t[2],o=r||[];return o.length=Wxe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function Mqe(t,e){const r=Wxe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function $qe(t,e){const r=Pqe(e.r.length);for(const i of t)fa(wj,i.direction),qxe(wj,r,lg),Rqe(lg,MD),Bk(lg,i.intensity[0],nx),UT(e.r,nx),Bk(lg,i.intensity[1],nx),UT(e.g,nx),Bk(lg,i.intensity[2],nx),UT(e.b,nx);return e}function Iqe(t,e){qxe(wj,0,lg);for(const r of t)e.r[0]+=lg[0]*MD[0]*r.intensity[0]*4*Math.PI,e.g[0]+=lg[0]*MD[0]*r.intensity[1]*4*Math.PI,e.b[0]+=lg[0]*MD[0]*r.intensity[2]*4*Math.PI;return e}function Lqe(t,e,r,i){Mqe(e,i),ne(r.intensity,0,0,0);let n=!1;const s=Dqe,o=Nqe,a=Fqe;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof o5&&!n?(re(r.direction,l.direction),re(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,n=!0):l instanceof o5||l instanceof jxe?s.push(l):l instanceof sQ?o.push(l):l instanceof Hxe&&a.push(l);$qe(s,i),Iqe(o,i);for(const l of a)UT(i.r,l.r),UT(i.g,l.g),UT(i.b,l.b)}const Dqe=[],Nqe=[],Fqe=[],lg=[0],nx=[0],wj=O(),MD=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Ane=class{constructor(){this.color=O(),this.intensity=1}},Uqe=class{constructor(){this.direction=O(),this.ambient=new Ane,this.diffuse=new Ane}};const Xxe=.4;let Vk=class{constructor(){this._shOrder=2,this._legacy=new Uqe,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new Hxe,this._mainLight=new o5(O(),Se(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Lqe(e,this._shOrder,this._mainLight,this._sphericalHarmonics),re(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,te(this._legacy.diffuse.color,this._mainLight.intensity,r),re(_$,this._legacy.diffuse.color),te(_$,_$,Xxe*this.globalFactor),oe(this._legacy.ambient.color,this._legacy.ambient.color,_$)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),re(this._mainLight.direction,e.mainLight.direction),re(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(Lr(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=wt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=wt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),re(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=wt(e.globalFactor,r.globalFactor,i),this.noonFactor=wt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=wt(e.sh.r[n],r.sh.r[n],i),this._sphericalHarmonics.g[n]=wt(e.sh.g[n],r.sh.g[n],i),this._sphericalHarmonics.b[n]=wt(e.sh.b[n],r.sh.b[n],i);else for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=r.sh.r[n],this._sphericalHarmonics.g[n]=r.sh.g[n],this._sphericalHarmonics.b[n]=r.sh.b[n]}};const _$=O();let e8=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=le.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=rt.NONE,this.alignPixelEnabled=!1,this._camera=new lt,this._inverseViewport=Ne(),this.oldLighting=new Vk,this.newLighting=new Vk,this._fadedLighting=new Vk,this._lighting=this.newLighting,this.ssr=new gqe,this.multipassTerrain=new fqe,this.multipassGeometry=new pqe,this.overlays=[],this.cloudsFade=new EWe}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},fl=class extends xe{constructor(e){super(e),this._handles=new Vi,this._techniques=new Array,this._techniqueConfiguration=new RD,this._bindParameters=new e8(null,null,null),this._passParameters=new Pxe,this._drawParameters=new Mxe,this._weatherTile=Ne(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=wt(ea.default.coverage[0],ea.default.coverage[1],.5),this.density=wt(ea.default.density[0],ea.default.density[1],.5),this.absorption=wt(ea.default.absorption[0],ea.default.absorption[1],.5),this.cloudSize=wt(ea.default.cloudSize[0],ea.default.cloudSize[1],.5),this.detailSize=wt(ea.default.detailSize[0],ea.default.detailSize[1],.5),this.smoothness=wt(ea.default.smoothness[0],ea.default.smoothness[1],.5),this.cloudHeight=wt(ea.default.cloudHeight[0],ea.default.cloudHeight[1],.5),this.raymarchingSteps=ea.default.raymarchingSteps,this._viewMatrix=_e(),this._dirty=!1,this.running=!1,this._vao=Dl(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===dw.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new $xe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;er(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let n=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),Ywe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Mr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(dt.CLOUDS_GENERATOR,this),ue(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),Pr)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Fi(e)),this._frameBufferCube=Le(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Me(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case El.SIXTEEN:return 1;case El.HUNDRED:return 4;case El.COUNT:case El.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new Q3({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new pr(e);r.target=nn.TEXTURE_CUBE_MAP,r.wrapMode=Pt.CLAMP_TO_EDGE,this._frameBufferCube=new hs(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=Le(this._frameBufferCube)}applyPreset(e,r){const i=e.median,n=s=>{const o=wt(s[0],s[1],i);return r<.5?wt(s[0],o,2*r):wt(o,s[1],2*(r-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),fs(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return Ho.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=On.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,n=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const u=kqe[this._faceIndex],d=zqe[this._faceIndex];gve(this._viewMatrix,Bqe,u,d),Ac(this._drawParameters.viewMatrix,this._viewMatrix);const p=nn.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(p),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=On.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Ho.YIELD}};h([f({constructOnly:!0})],fl.prototype,"context",void 0),h([f({constructOnly:!0})],fl.prototype,"view",void 0),h([f({constructOnly:!0})],fl.prototype,"requestRender",void 0),h([f()],fl.prototype,"coverage",void 0),h([f()],fl.prototype,"density",void 0),h([f()],fl.prototype,"absorption",void 0),h([f()],fl.prototype,"cloudSize",void 0),h([f()],fl.prototype,"detailSize",void 0),h([f()],fl.prototype,"smoothness",void 0),h([f()],fl.prototype,"cloudHeight",void 0),h([f()],fl.prototype,"raymarchingSteps",void 0),h([f()],fl.prototype,"running",void 0),fl=h([N("esri.views.3d.environment.CloudsGenerator")],fl);const kqe=[zr(1,0,0),zr(-1,0,0),zr(0,1,0),zr(0,-1,0),zr(0,0,1)],zqe=[zr(0,1,0),zr(0,1,0),zr(0,0,-1),zr(0,0,1),zr(0,1,0)],Bqe=nQ();let Yxe=class extends Wr{constructor(){super(...arguments),this.fogColor=O(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function Vqe(){const t=new mr;t.attributes.add(E.POSITION,"vec2"),t.include(Uf,{textureCoordinateType:Pn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new Mi("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new Mi("inverseViewMatrix",(i,n)=>wE(Gqe,n.camera.viewMatrix))),e.code.add(w`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ce("atmosphereC",i=>i.atmosphereC),new Lt("cameraPosition",(i,n)=>n.camera.eye),new yr("nearFar",(i,n)=>n.camera.nearFar),new Ye("depthTexture",i=>i.depthTexture),new Ce("fogStrength",i=>i.fogStrength),new Ce("fogAmount",i=>i.fogAmount),new Lt("fogColor",i=>i.fogColor)),t.include(Q6),r.include(wu),r.code.add(w`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(w`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(w`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const Gqe=_e(),jqe=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Yxe,build:Vqe},Symbol.toStringTag,{value:"Module"}));let Zxe=class Qxe extends Tr{constructor(e){super(e,new va,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,Qxe.shader.get().build(),fr)}initializePipeline(){return Ot({blending:So(ve.SRC_ALPHA,ve.ZERO,ve.ONE_MINUS_SRC_ALPHA,ve.ONE),colorWrite:Ft})}};Zxe.shader=new _r(jqe,()=>ce(()=>import("./Fog.glsl-332cff80.js"),[]));const Hqe=.95,Wqe=1;let Rv=class extends xe{constructor(e){super(e),this._passParameters=new Yxe;const r=e.context.renderContext.rctx;this._vao=Dl(r,$P),this._technique=new Zxe(e);const i=Mr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+$y}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Et.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;me(One,i.eye);const n=Math.max(0,fe(One,e.bindParameters.lighting.mainLight.direction)),s=r.color;te(Rne,s,.1),Lr(this._passParameters.fogColor,Rne,s,n);const o=Te(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-nR(Hqe*yf,Wqe*yf,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};h([f({constructOnly:!0})],Rv.prototype,"context",void 0),h([f({constructOnly:!0})],Rv.prototype,"view",void 0),h([f({constructOnly:!0})],Rv.prototype,"rctx",void 0),h([f({constructOnly:!0})],Rv.prototype,"viewingMode",void 0),Rv=h([N("esri.views.3d.environment.Fog")],Rv);let qqe=class{constructor(){this.color=O(),this.strength=0,this.amount=0}};const One=O(),Rne=O();let Fo=class extends va{};h([U({constValue:!0})],Fo.prototype,"hasSliceHighlight",void 0),h([U({constValue:!1})],Fo.prototype,"hasSliceInVertexProgram",void 0),h([U({constValue:!1})],Fo.prototype,"instancedDoublePrecision",void 0),h([U({constValue:!1})],Fo.prototype,"hasModelTransformation",void 0),h([U({constValue:jr.Pass})],Fo.prototype,"pbrTextureBindType",void 0);var Jf;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Jf||(Jf={}));let oQ=class extends Fo{constructor(){super(...arguments),this.geometry=Jf.Cone}};h([U({count:Jf.COUNT})],oQ.prototype,"geometry",void 0);var D;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(D||(D={}));function LP(t){t.attributes.add(E.POSITION,"vec3"),t.vertex.code.add(w`vec3 positionModel() { return position; }`)}function a5({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(w`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(w`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Gh=class extends ln{constructor(e,r){super(e,"mat3",jr.Pass,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}};function kT(t,e){t.include(LP);const r=t.vertex;r.include(a5,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new Lt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Lt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Gh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Mi("transformProjFromView",i=>i.transformProjFromView),new xR("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new pu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new pu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(w`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(w`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?w`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:w`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Lt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(w`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(w`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let Jxe=class extends Wr{constructor(){super(...arguments),this.transformWorldFromViewTH=O(),this.transformWorldFromViewTL=O(),this.transformViewFromCameraRelativeRS=hi(),this.transformProjFromView=_e()}},Kxe=class extends Wr{constructor(){super(...arguments),this.transformWorldFromModelRS=hi(),this.transformWorldFromModelTH=O(),this.transformWorldFromModelTL=O()}};function W_(t){t.varyings.add("linearDepth","float")}function pw(t){t.vertex.uniforms.add(new yr("nearFar",(e,r)=>r.camera.nearFar))}function t8(t){t.vertex.code.add(w`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function AE(t,e){const{vertex:r}=t;switch(e.output){case D.Color:if(e.receiveShadows)return W_(t),void r.code.add(w`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case D.Depth:case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:return t.include(kT,e),W_(t),pw(t),t8(t),void r.code.add(w`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(w`void forwardLinearDepth() {}`)}function Cl(t){t8(t),t.vertex.code.add(w`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(w`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let aQ=class extends Wr{constructor(){super(...arguments),this.texV=Ne(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new e2e}},e2e=class{constructor(){this.center=O(),this.v1=O(),this.v2=O()}};function Xqe(t){const e=new mr,{vertex:r,fragment:i}=e;if(r0(r),t.geometry===Jf.Underground)e.attributes.add(E.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new Lt("cameraPosition",(n,s)=>s.camera.eye),new Ce("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),r.code.add(w`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(w`void main() {
fragColor = color;
}`);else{e.include(Cl,t),e.attributes.add(E.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===Jf.Cylinder;r.uniforms.add(new Mi("proj",(a,l)=>l.camera.projectionMatrix),new Mi("view",(a,l)=>l.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Lt("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Lt("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Lt("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new yr("texV",a=>a.texV)),r.uniforms.add(new Ce("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;r.code.add(w`
		void main(void) {
      ${n?w`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:w`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${w.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${w.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Ye("tex",a=>a.texture)),n||i.uniforms.add(new Ce("altitudeFade",a=>a.altitudeFade)),i.code.add(w`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?w`fragColor = atmosphereColor;`:w`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const Yqe=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:e2e,SimpleAtmospherePassParameters:aQ,build:Xqe},Symbol.toStringTag,{value:"Module"}));let l5=class t2e extends Tr{initializeProgram(e){return new vr(e.rctx,t2e.shader.get().build(this.configuration),fr)}initializePipeline(){return this.configuration.geometry===Jf.Cylinder?Ot({blending:So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),culling:VZ,depthTest:{func:Hr.LEQUAL},colorWrite:Ft}):Ot({blending:So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.LEQUAL},colorWrite:Ft})}};l5.shader=new _r(Yqe,()=>ce(()=>import("./SimpleAtmosphere.glsl-137a19b0.js"),[]));const Zqe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Mc(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).filter(i=>{var s;const n=(s=t.fields.get(i))==null?void 0:s.optional;return!(n&&n.glPadding)}).map(i=>{const n=t.fields.get(i),s=n.constructor.ElementCount,o=Qqe(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new xo(i,s,o,a,r,l,e)})}function Qqe(t){const e=Jqe[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const Jqe={u8:Qe.UNSIGNED_BYTE,u16:Qe.UNSIGNED_SHORT,u32:Qe.UNSIGNED_INT,i8:Qe.BYTE,i16:Qe.SHORT,i32:Qe.INT,f32:Qe.FLOAT};let lQ=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};lQ.ElementCount=9;let cQ=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};cQ.ElementCount=16;let s0=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};s0.ElementCount=1;let o0=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,er(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};o0.ElementCount=2;let a0=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,ne(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};a0.ElementCount=3;let l0=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,gi(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};l0.ElementCount=4;let r8=class r2e extends s0{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}static fromTypedArray(e,r){return new r2e(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};r8.ElementType="f32";let d1=class xj extends o0{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(xj,e,r)}static fromTypedArray(e,r){return new xj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};d1.ElementType="f32";let ds=class Tj extends a0{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Tj,e,r)}static fromTypedArray(e,r){return new Tj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ds.ElementType="f32";let pp=class Sj extends l0{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Sj,e,r)}static fromTypedArray(e,r){return new Sj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pp.ElementType="f32";let q_=class Ej extends lQ{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Ej,e,r)}static fromTypedArray(e,r){return new Ej(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};q_.ElementType="f32";let uQ=class Cj extends lQ{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Cj,e,r)}static fromTypedArray(e,r){return new Cj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uQ.ElementType="f64";let hQ=class Aj extends cQ{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Aj,e,r)}static fromTypedArray(e,r){return new Aj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hQ.ElementType="f32";let SR=class Oj extends cQ{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Oj,e,r)}static fromTypedArray(e,r){return new Oj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};SR.ElementType="f64";let dQ=class Rj extends s0{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Rj,e,r)}static fromTypedArray(e,r){return new Rj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dQ.ElementType="f64";let pQ=class Pj extends o0{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Pj,e,r)}static fromTypedArray(e,r){return new Pj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pQ.ElementType="f64";let kh=class Mj extends a0{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Mj,e,r)}static fromTypedArray(e,r){return new Mj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kh.ElementType="f64";let i8=class $j extends l0{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer($j,e,r)}static fromTypedArray(e,r){return new $j(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};i8.ElementType="f64";let kS=class Ij extends s0{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Ij,e,r)}static fromTypedArray(e,r){return new Ij(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kS.ElementType="u8";let n8=class Lj extends o0{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Lj,e,r)}static fromTypedArray(e,r){return new Lj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};n8.ElementType="u8";let s8=class Dj extends a0{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Dj,e,r)}static fromTypedArray(e,r){return new Dj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};s8.ElementType="u8";let ya=class Nj extends l0{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Nj,e,r)}static fromTypedArray(e,r){return new Nj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ya.ElementType="u8";let o8=class Fj extends s0{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Fj,e,r)}static fromTypedArray(e,r){return new Fj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};o8.ElementType="u16";let fQ=class Uj extends o0{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Uj,e,r)}static fromTypedArray(e,r){return new Uj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fQ.ElementType="u16";let a8=class kj extends a0{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(kj,e,r)}static fromTypedArray(e,r){return new kj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};a8.ElementType="u16";let DP=class zj extends l0{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(zj,e,r)}static fromTypedArray(e,r){return new zj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};DP.ElementType="u16";let l8=class Bj extends s0{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Bj,e,r)}static fromTypedArray(e,r){return new Bj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};l8.ElementType="u32";let mQ=class Vj extends o0{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Vj,e,r)}static fromTypedArray(e,r){return new Vj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};mQ.ElementType="u32";let i2e=class Gj extends a0{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(Gj,e,r)}static fromTypedArray(e,r){return new Gj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};i2e.ElementType="u32";let n2e=class jj extends l0{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(jj,e,r)}static fromTypedArray(e,r){return new jj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};n2e.ElementType="u32";let gQ=class Hj extends s0{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Hj,e,r)}static fromTypedArray(e,r){return new Hj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gQ.ElementType="i8";let c8=class Wj extends o0{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Wj,e,r)}static fromTypedArray(e,r){return new Wj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};c8.ElementType="i8";let s2e=class qj extends a0{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(qj,e,r)}static fromTypedArray(e,r){return new qj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};s2e.ElementType="i8";let o2e=class Xj extends l0{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(Xj,e,r)}static fromTypedArray(e,r){return new Xj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};o2e.ElementType="i8";let a2e=class Yj extends s0{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(Yj,e,r)}static fromTypedArray(e,r){return new Yj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};a2e.ElementType="i16";let NP=class Zj extends o0{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(Zj,e,r)}static fromTypedArray(e,r){return new Zj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};NP.ElementType="i16";let l2e=class Qj extends a0{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(Qj,e,r)}static fromTypedArray(e,r){return new Qj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};l2e.ElementType="i16";let c2e=class Jj extends l0{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(Jj,e,r)}static fromTypedArray(e,r){return new Jj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};c2e.ElementType="i16";let u2e=class Kj extends s0{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(Kj,e,r)}static fromTypedArray(e,r){return new Kj(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};u2e.ElementType="i32";let h2e=class eH extends o0{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(eH,e,r)}static fromTypedArray(e,r){return new eH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};h2e.ElementType="i32";let d2e=class tH extends a0{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(tH,e,r)}static fromTypedArray(e,r){return new tH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};d2e.ElementType="i32";let p2e=class rH extends l0{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(rH,e,r)}static fromTypedArray(e,r){return new rH(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};p2e.ElementType="i32";function Pne(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Mne=class f2e{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const n=e.fields.get(i);this[i]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new f2e(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,n=e.count){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,r*s,n*s/4);new Uint32Array(this.buffer,i*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,r*s,n*s);new Uint8Array(this.buffer,i*s,n*s).set(o)}return this}},m2e=class g2e{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:tXe(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,d1,r),this}vec2f64(e,r){return this._appendField(e,pQ,r),this}vec3f(e,r){return this._appendField(e,ds,r),this}vec3f64(e,r){return this._appendField(e,kh,r),this}vec4f(e,r){return this._appendField(e,pp,r),this}vec4f64(e,r){return this._appendField(e,i8,r),this}mat3f(e,r){return this._appendField(e,q_,r),this}mat3f64(e,r){return this._appendField(e,uQ,r),this}mat4f(e,r){return this._appendField(e,hQ,r),this}mat4f64(e,r){return this._appendField(e,SR,r),this}vec4u8(e,r){return this._appendField(e,ya,r),this}f32(e,r){return this._appendField(e,r8,r),this}f64(e,r){return this._appendField(e,dQ,r),this}u8(e,r){return this._appendField(e,kS,r),this}u16(e,r){return this._appendField(e,o8,r),this}i8(e,r){return this._appendField(e,gQ,r),this}vec2i8(e,r){return this._appendField(e,c8,r),this}vec2i16(e,r){return this._appendField(e,NP,r),this}vec2u8(e,r){return this._appendField(e,n8,r),this}vec4u16(e,r){return this._appendField(e,DP,r),this}u32(e,r){return this._appendField(e,l8,r),this}_appendField(e,r,i){if(this._fields.has(e))return void Je(!1,`${e} already added to vertex buffer layout`);const n=r.ElementCount*Pne(r.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:r,offset:s,optional:i})}createBuffer(e){return new Mne(this,e)}createView(e){return new Mne(this,e)}clone(){const e=new g2e;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,Pne(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Gi(){return new m2e}let Kqe=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const n={...r,constructor:y2e(r.constructor)};this.fields.push([i,n])}),this.stride=e.stride}};const eXe=[r8,d1,ds,pp,q_,hQ,dQ,pQ,kh,i8,uQ,SR,kS,n8,s8,ya,o8,fQ,a8,DP,l8,mQ,i2e,n2e,gQ,c8,s2e,o2e,a2e,NP,l2e,c2e,u2e,h2e,d2e,p2e];function y2e(t){return`${t.ElementType}_${t.ElementCount}`}function tXe(t){return _2e.get(t)}const _2e=new Map;eXe.forEach(t=>_2e.set(y2e(t),t));function Ys(t,e=!1){return t<=_u?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function v2e(t){return(ap(t)?t.length:t.byteLength/8)<=_u?Array.from(t):new Float64Array(t)}function Ch(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function rXe(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function nMt(t){return Array.isArray(t)?new Float64Array(t):t}function Yi(t,e=!1){return t<=_u?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function sMt(t){return ap(t)?t.length<_u?t:new Float32Array(t):t.length<_u?Array.from(t):t}function $ne(t){return(ap(t)?t.length:t.byteLength/8)<=_u?Array.from(t):new Float32Array(t)}function c5(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function zf(t){return ap(t)?t.length<_u?t:Ine(t):t.length<_u?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:Ine(t)}function Ine(t){let e=!0;for(const r of t){if(r>=65536)return ap(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function u5(t){return t<=_u?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function iXe(t){return t<=_u?new Array(t):new Uint32Array(t)}let sx=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const b2e=[0],Gk=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function zS(t){if(t===1)return b2e;if(t<_u)return Array.from(new Uint16Array(Gk.buffer,0,t));if(t<Gk.length)return new Uint16Array(Gk.buffer,0,t);if(t>sx.length){const e=Math.max(2*sx.length,t);sx=new Uint32Array(e);for(let r=0;r<sx.length;r++)sx[r]=r}return new Uint32Array(sx.buffer,0,t)}let v$=new Uint8Array(65536);function OE(t){if(t===1)return b2e;if(t<_u)return new Array(t).fill(0);if(t>v$.length){const e=Math.max(2*v$.length,t);v$=new Uint8Array(e)}return new Uint8Array(v$.buffer,0,t)}let Ue=class{constructor(e,r,i=!1,n=r){this.data=e,this.size=r,this.exclusive=i,this.stride=n}};var iH;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],d=1/Math.sqrt(l*l+c*c+u*u);o[a]*=d,o[a+1]*=d,o[a+2]*=d}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]+l[c],u[d+1]=o[a+1]+l[c+1],u[d+2]=o[a+2]+l[c+2]}function s(o,a,l,c,u,d=a){(u=u||o)[d]=o[a]-l[c],u[d+1]=o[a+1]-l[c+1],u[d+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=n,t.subtract=s})(iH||(iH={}));var on;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(on||(on={}));function nXe(t){if(t.length<_u)return Array.from(t);if(ap(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return WF(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let w2e=class x2e{constructor(e,r,i,n){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=n,this._children=void 0,Je(e.length>=1),Je(i.length%this._numIndexPerPrimitive==0),Je(i.length>=e.length*this._numIndexPerPrimitive),Je(n.size===3||n.size===4);const{data:s,size:o}=n,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];E1.clear(),E1.push(l);const c=Se(s[l],s[l+1],s[l+2]),u=ki(c);for(let m=0;m<a;++m){const y=this._numIndexPerPrimitive*e[m];for(let _=0;_<this._numIndexPerPrimitive;++_){l=o*i[y+_],E1.push(l);let v=s[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=s[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=s[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const d=Lr(O(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let m=0;m<E1.length;++m){l=E1.at(m);const y=s[l]-d[0],_=s[l+1]-d[1],v=s[l+2]-d[2],b=y*y+_*_+v*v;if(b<=p)continue;const x=Math.sqrt(b),T=.5*(x-this.radius);this.radius=this.radius+T,p=this.radius*this.radius;const S=T/x;d[0]+=y*S,d[1]+=_*S,d[2]+=v*S}this.center=d,E1.clear()}getChildren(){if(this._children||wo(this.bbMin,this.bbMax)<=1)return this._children;const e=Lr(O(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),n=new Array(8);for(let c=0;c<8;++c)n[c]=0;const{data:s,size:o}=this.position;for(let c=0;c<r;++c){let u=0;const d=this._numIndexPerPrimitive*this.primitiveIndices[c];let p=o*this.indices[d],m=s[p],y=s[p+1],_=s[p+2];for(let v=1;v<this._numIndexPerPrimitive;++v){p=o*this.indices[d+v];const b=s[p],x=s[p+1],T=s[p+2];b<m&&(m=b),x<y&&(y=x),T<_&&(_=T)}m<e[0]&&(u|=1),y<e[1]&&(u|=2),_<e[2]&&(u|=4),i[c]=u,++n[u]}let a=0;for(let c=0;c<8;++c)n[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=n[c]>0?new Uint32Array(n[c]):void 0;for(let c=0;c<8;++c)n[c]=0;for(let c=0;c<r;++c){const u=i[c];l[u][n[u]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new x2e(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){E1.prune()}};const E1=new Nt({deallocator:null});let FP=class{constructor(){this.id=wc()}unload(){}};function sXe(t){return t?{p0:ki(t.p0),p1:ki(t.p1),p2:ki(t.p2)}:{p0:O(),p1:O(),p2:O()}}function Lne(t,e,r){const i=e[0]-t[0],n=e[1]-t[1],s=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-n*s)}function oXe(t,e,r){return ae(jk,e,t),ae(Dne,r,t),Te(ot(jk,jk,Dne))/2}new Kg(_p);new Kg(()=>sXe());const jk=O(),Dne=O();function aXe(t,e,r){if(!t||!e)return!1;const{size:i,data:n}=t;ne(r,0,0,0),ne(th,0,0,0);let s=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*i,c=e[a+1]*i,u=e[a+2]*i;ne(Bs,n[l],n[l+1],n[l+2]),ne(cg,n[c],n[c+1],n[c+2]),ne(b$,n[u],n[u+1],n[u+2]);const d=oXe(Bs,cg,b$);d?(oe(Bs,Bs,cg),oe(Bs,Bs,b$),te(Bs,Bs,1/3*d),oe(r,r,Bs),s+=d):(oe(th,th,Bs),oe(th,th,cg),oe(th,th,b$),o+=3)}return(o!==0||s!==0)&&(s!==0?(te(r,r,1/s),!0):o!==0&&(te(r,th,1/o),!0))}function lXe(t,e,r){if(!t||!e)return!1;const{size:i,data:n}=t;ne(r,0,0,0);let s=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;s!==l&&(r[0]+=n[l],r[1]+=n[l+1],r[2]+=n[l+2],o++),s=l}return o>1&&te(r,r,1/o),o>0}function cXe(t,e,r,i){if(!t)return!1;ne(i,0,0,0),ne(th,0,0,0);let n=0,s=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let u=0;u<c;u+=2){const d=u<l?u:l,p=u<l?u+1:0,m=(e?e[d]:d)*o,y=(e?e[p]:p)*o;Bs[0]=a[m],Bs[1]=a[m+1],Bs[2]=a[m+2],cg[0]=a[y],cg[1]=a[y+1],cg[2]=a[y+2],te(Bs,oe(Bs,Bs,cg),.5);const _=gP(Bs,cg);_>0?(oe(i,i,te(Bs,Bs,_)),n+=_):n===0&&(oe(th,th,Bs),s++)}return n!==0?(te(i,i,1/n),!0):s!==0&&(te(i,th,1/s),!0)}const Bs=O(),cg=O(),b$=O(),th=O();let h5=class{constructor(e){this.channel=e,this.id=wc()}};function nH(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function uXe(t,e){const r=t.length;for(let i=0;i<r;++i)hT[0]=t[i],e[i]=hT[0];return e}function hXe(t,e){const r=t.length;for(let i=0;i<r;++i)hT[0]=t[i],hT[1]=t[i]-hT[0],e[i]=hT[1];return e}const hT=new Float32Array(2);function sH(t,e){return t==null&&(t=[]),t.push(e),t}function oH(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function dXe(t,e,r,i,n){w$[0]=t.get(e,0),w$[1]=t.get(e,1),w$[2]=t.get(e,2),nH(w$,C1,3),r.set(n,0,C1[0]),i.set(n,0,C1[1]),r.set(n,1,C1[2]),i.set(n,1,C1[3]),r.set(n,2,C1[4]),i.set(n,2,C1[5])}const w$=O(),C1=new Float32Array(6);let Xn=class T2e extends FP{constructor(e,r,i=[],n=null,s=on.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=n,this.type=s,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=pXe(this._vertexAttributes),c=zS(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const u of this._vertexAttributes.keys())this._indices.set(u,c)}else for(const[l,c]of i)c&&(this._indices.set(l,zf(c)),l===E.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new T2e(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,n)=>{i.exclusive=!1,r._vertexAttributes.set(n,i)}),this._indices.forEach((i,n)=>r._indices.set(n,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:nXe(r.data)},this._vertexAttributes.set(e,r)),r}setAttributeData(e,r){const i=this._vertexAttributes.get(e);i&&this._vertexAttributes.set(e,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===on.Mesh?this._computeAttachmentOriginTriangles(e):this.type===on.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&De(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return aXe(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(E.POSITION),i=this.indices.get(E.POSITION);return cXe(r,i,i&&fXe(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(E.POSITION),i=this.vertexAttributes.get(E.POSITION);return lXe(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(E.POSITION),r=this.vertexAttributes.get(E.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===on.Mesh?3:1;Je(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const n=zS(e.length/i);return new w2e(n,i,e,r)}get transformation(){return this._transformation??yn}set transformation(e){this._transformation=e&&e!==yn?RS(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new h5(Hg.Highlight);return this.highlights=sH(this.highlights,e),e}removeHighlight(e){this.highlights=oH(this.highlights,e)}};function pXe(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function fXe(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const ox=iH,Hk=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],mXe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],gXe=[0,0,1,0,1,1,0,1],yXe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],S2e=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)S2e[6*t+e]=t;const Pv=new Array(36);for(let t=0;t<6;t++)Pv[6*t]=0,Pv[6*t+1]=1,Pv[6*t+2]=2,Pv[6*t+3]=2,Pv[6*t+4]=3,Pv[6*t+5]=0;function _Xe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=Hk[i][0]*e[0],r[3*i+1]=Hk[i][1]*e[1],r[3*i+2]=Hk[i][2]*e[2];return new Xn(t,[[E.POSITION,new Ue(r,3,!0)],[E.NORMAL,new Ue(mXe,3)],[E.UV0,new Ue(gXe,2)]],[[E.POSITION,yXe],[E.NORMAL,S2e],[E.UV0,Pv]])}const Wk=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],vXe=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],bXe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],wXe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function xXe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=Wk[i][0]*e[0],r[3*i+1]=Wk[i][1]*e[1],r[3*i+2]=Wk[i][2]*e[2];return new Xn(t,[[E.POSITION,new Ue(r,3,!0)],[E.NORMAL,new Ue(vXe,3)]],[[E.POSITION,bXe],[E.NORMAL,wXe]])}const $D=zr(-.5,0,-.5),ID=zr(.5,0,-.5),LD=zr(0,0,.5),DD=zr(0,.5,0),ax=rn(),lx=rn(),zT=rn(),BT=rn(),VT=rn();ae(ax,$D,DD),ae(lx,$D,ID),ot(zT,ax,lx),me(zT,zT),ae(ax,ID,DD),ae(lx,ID,LD),ot(BT,ax,lx),me(BT,BT),ae(ax,LD,DD),ae(lx,LD,$D),ot(VT,ax,lx),me(VT,VT);const qk=[$D,ID,LD,DD],TXe=[0,-1,0,zT[0],zT[1],zT[2],BT[0],BT[1],BT[2],VT[0],VT[1],VT[2]],SXe=[0,1,2,3,1,0,3,2,1,3,0,2],EXe=[0,0,0,1,1,1,2,2,2,3,3,3];function CXe(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=qk[i][0]*e[0],r[3*i+1]=qk[i][1]*e[1],r[3*i+2]=qk[i][2]*e[2];return new Xn(t,[[E.POSITION,new Ue(r,3,!0)],[E.NORMAL,new Ue(TXe,3)]],[[E.POSITION,SXe],[E.NORMAL,EXe]])}function cMt(t,e,r,i,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),d=(c+1)*(u+1),p=Yi(3*d),m=Yi(3*d),y=Yi(2*d),_=[];let v=0;for(let S=0;S<=u;S++){const A=[],C=S/u,R=a+C*l,P=Math.cos(R);for(let F=0;F<=c;F++){const k=F/c,V=s+k*o,z=Math.cos(V)*P,X=Math.sin(R),q=-Math.sin(V)*P;p[3*v]=z*e,p[3*v+1]=X*e,p[3*v+2]=q*e,m[3*v]=z,m[3*v+1]=X,m[3*v+2]=q,y[2*v]=k,y[2*v+1]=C,A.push(v),++v}_.push(A)}const b=new Array;for(let S=0;S<u;S++)for(let A=0;A<c;A++){const C=_[S][A],R=_[S][A+1],P=_[S+1][A+1],F=_[S+1][A];S===0?(b.push(C),b.push(P),b.push(F)):S===u-1?(b.push(C),b.push(R),b.push(P)):(b.push(C),b.push(R),b.push(P),b.push(P),b.push(F),b.push(C))}const x=[[E.POSITION,b],[E.NORMAL,b]],T=[[E.POSITION,new Ue(p,3,!0)],[E.NORMAL,new Ue(m,3,!0)]];return n.uv&&(T.push([E.UV0,new Ue(y,2,!0)]),x.push([E.UV0,b])),n.offset&&(x[0][0]=E.OFFSET,T[0][0]=E.OFFSET,x.push([E.POSITION,OE(b.length)]),T.push([E.POSITION,new Ue(Float64Array.from(n.offset),3,!0)])),new Xn(t,T,x)}function AXe(t,e,r,i){const{vertexAttributes:n,indices:s}=E2e(e,r,i);return new Xn(t,n,s)}function E2e(t,e,r){const i=t;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const u=i*(1+Math.sqrt(5))/2;n=[-i,u,0,i,u,0,-i,-u,0,i,-u,0,0,-i,u,0,i,u,0,-i,-u,0,i,-u,u,0,-i,u,0,i,-u,0,-i,-u,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let u=0;u<n.length;u+=3)ox.scale(n,u,t/ox.length(n,u));let o={};function a(u,d){u>d&&([u,d]=[d,u]);const p=u.toString()+"."+d.toString();if(o[p])return o[p];let m=n.length;return n.length+=3,ox.add(n,3*u,n,3*d,n,m),ox.scale(n,m,t/ox.length(n,m)),m/=3,o[p]=m,m}for(let u=0;u<e;u++){const d=s.length,p=new Array(4*d);for(let m=0;m<d;m+=3){const y=s[m],_=s[m+1],v=s[m+2],b=a(y,_),x=a(_,v),T=a(v,y),S=4*m;p[S]=y,p[S+1]=b,p[S+2]=T,p[S+3]=_,p[S+4]=x,p[S+5]=b,p[S+6]=v,p[S+7]=T,p[S+8]=x,p[S+9]=b,p[S+10]=x,p[S+11]=T}s=p,o={}}const l=$ne(n);for(let u=0;u<l.length;u+=3)ox.normalize(l,u);const c=[[E.POSITION,s],[E.NORMAL,s]];return{vertexAttributes:[[E.POSITION,new Ue($ne(n),3,!0)],[E.NORMAL,new Ue(l,3,!0)]],indices:c}}function aH(t,e,r,i,n,s,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],u=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const d=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],p=n!=null&&n.length===2?n:[1,1],m=[[E.POSITION,new Ue(c,3,!0)],[E.NORMAL,new Ue(u,3,!0)],[E.UV0,new Ue(o,o.length)],[E.COLOR,new Ue(d,4,!0)],[E.SIZE,new Ue(p,2)]];if(s!=null){const y=[s[0],s[1],s[2],s[3]];m.push([E.AUXPOS1,new Ue(y,4)])}if(a!=null){const y=[a[0],a[1],a[2],a[3]];m.push([E.AUXPOS2,new Ue(y,4)])}return new Xn(t,m,null,null,on.Point,l)}const OXe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function uMt(t,e=OXe){const r=new Array(12);for(let u=0;u<4;u++)for(let d=0;d<3;d++)r[3*u+d]=e[u][d];const i=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[E.POSITION,i],[E.NORMAL,s],[E.UV0,i],[E.COLOR,s]],c=[[E.POSITION,new Ue(r,3,!0)],[E.NORMAL,new Ue(n,3,!0)],[E.UV0,new Ue(o,2,!0)],[E.COLOR,new Ue(a,4,!0)]];return new Xn(t,c,l)}function Nne(t,e,r,i,n,s=!0,o=!0){let a=0;const l=r,c=e;let u=zr(0,a,0),d=zr(0,a+c,0),p=zr(0,-1,0),m=zr(0,1,0);n&&(a=c,d=zr(0,0,0),u=zr(0,a,0),p=zr(0,1,0),m=zr(0,-1,0));const y=[d,u],_=[p,m],v=i+2,b=Math.sqrt(c*c+l*l);if(n)for(let P=i-1;P>=0;P--){const F=P*(2*Math.PI/i),k=zr(Math.cos(F)*l,a,Math.sin(F)*l);y.push(k);const V=zr(c*Math.cos(F)/b,-l/b,c*Math.sin(F)/b);_.push(V)}else for(let P=0;P<i;P++){const F=P*(2*Math.PI/i),k=zr(Math.cos(F)*l,a,Math.sin(F)*l);y.push(k);const V=zr(c*Math.cos(F)/b,l/b,c*Math.sin(F)/b);_.push(V)}const x=new Array,T=new Array;if(s){for(let P=3;P<y.length;P++)x.push(1),x.push(P-1),x.push(P),T.push(0),T.push(0),T.push(0);x.push(y.length-1),x.push(2),x.push(1),T.push(0),T.push(0),T.push(0)}if(o){for(let P=3;P<y.length;P++)x.push(P),x.push(P-1),x.push(0),T.push(P),T.push(P-1),T.push(1);x.push(0),x.push(2),x.push(y.length-1),T.push(1),T.push(2),T.push(_.length-1)}const S=Yi(3*v);for(let P=0;P<v;P++)S[3*P]=y[P][0],S[3*P+1]=y[P][1],S[3*P+2]=y[P][2];const A=Yi(3*v);for(let P=0;P<v;P++)A[3*P]=_[P][0],A[3*P+1]=_[P][1],A[3*P+2]=_[P][2];const C=[[E.POSITION,x],[E.NORMAL,T]],R=[[E.POSITION,new Ue(S,3,!0)],[E.NORMAL,new Ue(A,3,!0)]];return new Xn(t,R,C)}function RXe(t,e,r,i,n,s,o){const a=n?i5(n):zr(1,0,0),l=s?i5(s):zr(0,0,0);o??(o=!0);const c=rn();me(c,a);const u=rn();te(u,c,Math.abs(e));const d=rn();te(d,u,-.5),oe(d,d,l);const p=zr(0,1,0);Math.abs(1-fe(c,p))<.2&&ne(p,0,0,1);const m=rn();ot(m,c,p),me(m,m),ot(p,m,c);const y=2*i+(o?2:0),_=i+(o?2:0),v=Yi(3*y),b=Yi(3*_),x=Yi(2*y),T=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(y-2)]=d[0],v[3*(y-2)+1]=d[1],v[3*(y-2)+2]=d[2],x[2*(y-2)]=0,x[2*(y-2)+1]=0,v[3*(y-1)]=v[3*(y-2)]+u[0],v[3*(y-1)+1]=v[3*(y-2)+1]+u[1],v[3*(y-1)+2]=v[3*(y-2)+2]+u[2],x[2*(y-1)]=1,x[2*(y-1)+1]=1,b[3*(_-2)]=-c[0],b[3*(_-2)+1]=-c[1],b[3*(_-2)+2]=-c[2],b[3*(_-1)]=c[0],b[3*(_-1)+1]=c[1],b[3*(_-1)+2]=c[2]);const A=(V,z,X)=>{T[V]=z,S[V]=X};let C=0;const R=rn(),P=rn();for(let V=0;V<i;V++){const z=V*(2*Math.PI/i);te(R,p,Math.sin(z)),te(P,m,Math.cos(z)),oe(R,R,P),b[3*V]=R[0],b[3*V+1]=R[1],b[3*V+2]=R[2],te(R,R,r),oe(R,R,d),v[3*V]=R[0],v[3*V+1]=R[1],v[3*V+2]=R[2],x[2*V]=V/i,x[2*V+1]=0,v[3*(V+i)]=v[3*V]+u[0],v[3*(V+i)+1]=v[3*V+1]+u[1],v[3*(V+i)+2]=v[3*V+2]+u[2],x[2*(V+i)]=V/i,x[2*V+1]=1;const X=(V+1)%i;A(C++,V,V),A(C++,V+i,V),A(C++,X,X),A(C++,X,X),A(C++,V+i,V),A(C++,X+i,X)}if(o){for(let V=0;V<i;V++){const z=(V+1)%i;A(C++,y-2,_-2),A(C++,V,_-2),A(C++,z,_-2)}for(let V=0;V<i;V++){const z=(V+1)%i;A(C++,V+i,_-1),A(C++,y-1,_-1),A(C++,z+i,_-1)}}const F=[[E.POSITION,T],[E.NORMAL,S],[E.UV0,T]],k=[[E.POSITION,new Ue(v,3,!0)],[E.NORMAL,new Ue(b,3,!0)],[E.UV0,new Ue(x,2,!0)]];return new Xn(t,k,F)}function hMt(t,e,r,i,n,s,o=zr(0,0,0)){const a=e.length,l=Yi(r.length*a*3+(6*i.length||0)),c=Yi(r.length*a*3+(i?6:0)),u=new Array,d=new Array;let p=0,m=0;const y=rn(),_=rn(),v=rn(),b=rn(),x=rn(),T=rn(),S=rn(),A=O(),C=rn(),R=rn(),P=rn(),F=rn(),k=rn(),V=Er();ne(C,0,1,0),ae(_,r[1],r[0]),me(_,_),s?(oe(A,r[0],o),me(v,A)):ne(v,0,0,1),d5(_,v,C,C,x,v,Fne),re(b,v),re(F,x);for(let L=0;L<i.length;L++)te(T,x,i[L][0]),te(A,v,i[L][2]),oe(T,T,A),oe(T,T,r[0]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];c[m++]=-_[0],c[m++]=-_[1],c[m++]=-_[2];for(let L=0;L<n.length;L++)u.push(n[L][0]>0?n[L][0]:-n[L][0]-1+i.length),u.push(n[L][1]>0?n[L][1]:-n[L][1]-1+i.length),u.push(n[L][2]>0?n[L][2]:-n[L][2]-1+i.length),d.push(0),d.push(0),d.push(0);let z=i.length;const X=i.length-1;for(let L=0;L<r.length;L++){let B=!1;L>0&&(re(y,_),L<r.length-1?(ae(_,r[L+1],r[L]),me(_,_)):B=!0,oe(R,y,_),me(R,R),oe(P,r[L-1],b),MP(r[L],R,V),kw(V,bu(P,y),A)?(ae(A,A,r[L]),me(v,A),ot(x,R,v),me(x,x)):d5(R,b,F,C,x,v,Fne),re(b,v),re(F,x)),s&&(oe(A,r[L],o),me(k,A));for(let H=0;H<a;H++)if(te(T,x,e[H][0]),te(A,v,e[H][1]),oe(T,T,A),me(S,T),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],oe(T,T,r[L]),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2],!B){const Z=(H+1)%a;u.push(z+H),u.push(z+a+H),u.push(z+Z),u.push(z+Z),u.push(z+a+H),u.push(z+a+Z);for(let K=0;K<6;K++){const de=u.length-6;d.push(u[de+K]-X)}}z+=a}const q=r[r.length-1];for(let L=0;L<i.length;L++)te(T,x,i[L][0]),te(A,v,i[L][1]),oe(T,T,A),oe(T,T,q),l[p++]=T[0],l[p++]=T[1],l[p++]=T[2];const G=m/3;c[m++]=_[0],c[m++]=_[1],c[m++]=_[2];const Q=z-a;for(let L=0;L<n.length;L++)u.push(n[L][0]>=0?z+n[L][0]:-n[L][0]-1+Q),u.push(n[L][2]>=0?z+n[L][2]:-n[L][2]-1+Q),u.push(n[L][1]>=0?z+n[L][1]:-n[L][1]-1+Q),d.push(G),d.push(G),d.push(G);const M=[[E.POSITION,u],[E.NORMAL,d]],I=[[E.POSITION,new Ue(l,3,!0)],[E.NORMAL,new Ue(c,3,!0)]];return new Xn(t,I,M)}function dMt(t,e,r,i){Je(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Je(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Je(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),Je(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const n=Ys(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let u=0;u<e.length;u++){for(let d=0;d<3;d++)n[o++]=e[u][d];u>0&&(s[a++]=u-1,s[a++]=u)}const l=[],c=[];if(l.push([E.POSITION,s]),c.push([E.POSITION,new Ue(n,3,!0)]),r){const u=Yi(3*r.length);let d=0;for(let p=0;p<e.length;p++)for(let m=0;m<3;m++)u[d++]=r[p][m];l.push([E.NORMAL,s]),c.push([E.NORMAL,new Ue(u,3,!0)])}return i&&(c.push([E.COLOR,new Ue(i,4)]),l.push([E.COLOR,zS(i.length/4)])),new Xn(t,c,l,null,on.Line)}function PXe(t,e=t){const r=t.vertexAttributes,i=r.get(E.POSITION).data,n=r.get(E.NORMAL).data;if(n){const s=e.getMutableAttribute(E.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(i){const s=e.getMutableAttribute(E.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];s[o+1]=-i[o+2],s[o+2]=a}}}function Xk(t,e,r,i,n){return!(Math.abs(fe(e,t))>n)&&(ot(r,t,e),me(r,r),ot(i,r,t),me(i,i),!0)}function d5(t,e,r,i,n,s,o){return Xk(t,e,n,s,o)||Xk(t,r,n,s,o)||Xk(t,i,n,s,o)}const Fne=.99619469809;let MXe=class{constructor(e,r){this.type=ra.Local,this._configuration=new oQ,this._passParameters=new aQ,this._configuration.geometry=Jf.Cylinder,this._technique=r.techniqueRepository.acquire(l5,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=No(this._vao,"geometry");const n=new pr;n.wrapMode=Pt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Ct(i,n,Zqe)}destroy(){this._passParameters.texture=Le(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);$Xe(Une,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",Une),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Et.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=E2e(1,2,!1),i=r.indices[0][1],n=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const s=n.data,o=kne.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,s[c]),a.set(l,1,s[c+1]),a.set(l,2,s[c+2])}return new vp(e,fr,{geometry:Mc(kne)},{geometry:Ar.createVertex(e,gr.STATIC_DRAW,o.buffer)})}};function $Xe(t,e){In(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const Une=_e(),kne=Gi().vec3f(E.POSITION),IXe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),x$=128,zne=-dj,Bne=0,Yk=50,LXe=()=>1-511/512,DXe=wD([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let NXe=class{constructor(e,r){this.view=e,this.type=ra.Mars,this._passParameters=new aQ,this._vaoCount=0,this._texV1=1;const i=Mr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+zne)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Bne)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Bne/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const n=r.renderContext.rctx;this._cameraChangeHandle=ue(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),An),this._vao=this._createRibbon(n),this._vaoCount=No(this._vao,"geometry"),this._fadeVao=Dl(n),this._fadeVaoCount=No(this._fadeVao,"geometry");const s=new pr;s.wrapMode=Pt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Ct(n,s,IXe);const o=new oQ;o.geometry=Jf.Cone,this._coneTechnique=this._techniqueRepository.acquire(l5,o),o.geometry=Jf.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(l5,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=Le(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(Et.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(Et.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=O(),i=this._planetRadius,n=Te(e.eye),s=n-i;if(s<0){const m=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(Yk,s),a=i+zne;this._passParameters.innerScale=FXe(i+o,i,a)-1,this._passParameters.altitudeFade=BZ(s),te(r,e.eye,(i+Yk)/n),Vne(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=LXe(),u=DXe(s);let d=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(s>Yk){Vne(e.eye,e.center,e.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),y=ge((m-1.5)/(l-1.5),0,1);d=this._texV0+y*c*this._texVScale,p=this._texV0+wt(this._texV1,l*u,y)*this._texVScale}er(this._passParameters.texV,d,p)}_createRibbon(e){const r=Yi(3+3*x$*3),i=new Uint32Array(3*x$*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<x$;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===x$-1?1:l+3,u=15*o;i[u]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const n=Gne.createBuffer(i.length),s=n.position;for(let o=0;o<i.length;++o){const a=3*i[o];s.set(o,0,r[a]),s.set(o,1,r[a+1]),s.set(o,2,r[a+2])}return new vp(e,fr,{geometry:Mc(Gne)},{geometry:Ar.createVertex(e,gr.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,r,i,n){return oe(cx,n.center,n.v2),te(T$,cx,this._outerRimFactor),$6(Zk,r,cx,i),une(cx,Zk,e.projectionMatrix,e.viewport,cx),une(T$,Zk,e.projectionMatrix,e.viewport,T$),ci(cx,T$)/e.height}};function Vne(t,e,r,i,n){const s=Te(t),o=i*Math.sqrt(s*s-i*i)/s,a=Math.sqrt(i*i-o*o),l=n.v1,c=n.v2;return te(n.center,t,a/s),ot(l,t,e),la(l)<1&&ot(l,t,r),te(l,l,o/Te(l)),ot(c,l,t),te(c,c,o/Te(c)),o}const Zk=_e(),cx=O(),T$=O();function FXe(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const Gne=Gi().vec3f(E.POSITION);var Wg;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Wg||(Wg={}));let lH=class extends va{constructor(){super(...arguments),this.type=Wg.Rain}};h([U({count:Wg.COUNT})],lH.prototype,"type",void 0);function UXe(t){const e=new mr;return e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Lt("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Lt("offset",(r,i)=>kXe(r,i))),e.vertex.uniforms.add(new Ce("width",r=>r.width)),e.vertex.uniforms.add(new Mi("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new Mi("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Ce("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(w`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Wg.Rain?w`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:w`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Ce("opacity",r=>r.opacity),new Lt("particleColor",(r,i)=>zXe(i,t))),e.fragment.code.add(w`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Wg.Rain?w`d = 0.35 * smoothstep(0.5, 0.0, d);`:w`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function kXe(t,e){const r=e.camera.eye,i=.5*t.width,n=1/t.width,s=oye(cH,ne(cH,(r[0]+i)*n,(r[1]+i)*n,(r[2]+i)*n));return Ws(s,r,te(s,s,t.width))}function zXe(t,e){const r=e.type===Wg.Rain?VXe:BXe,i=te(cH,r,GXe),n=t.camera.eye;me(jne,n);const s=Math.max(0,fe(jne,t.lighting.mainLight.direction));return Lr(i,i,r,s)}const cH=O(),jne=O(),BXe=Se(1,1,1),VXe=Se(.85,.85,.85),GXe=.7,jXe=Object.freeze(Object.defineProperty({__proto__:null,build:UXe},Symbol.toStringTag,{value:"Module"}));let HXe=class extends Wr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},uH=class C2e extends Tr{initializeProgram(e){return new vr(e.rctx,C2e.shader.get().build(this.configuration),ND)}initializePipeline(){return Ot({blending:So(ve.ONE,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.LEQUAL},colorWrite:Ft})}};uH.shader=new _r(jXe,()=>ce(()=>import("./Precipitation.glsl-5b05b6be.js"),[]));const ND=new Map([[E.POSITION,0],[E.INSTANCEFEATUREATTRIBUTE,1]]);let A2e=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},WXe=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},Mv=class extends xe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new HXe,this._animation=new A2e,this._updatingTracking=new Df,this._passParameters.time=0,this._passParameters.radius=Mr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Fi(this._snowTechniqueCached),this._rainTechniqueCached=Fi(this._rainTechniqueCached),this._vao=Le(this._vao),this._instanceIdBuffer=Le(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new lH;e.type=Wg.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(uH,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new lH;e.type=Wg.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(uH,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){var l;const n=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),n==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?wt(0,o,2*r):wt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*OX(this._animation.time)%1e5;const a=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),jZ(s,ND,this._instanceIdBuffer,Hne,0),(l=s.capabilities.instancing)==null||l.drawArraysInstanced(Et.TRIANGLES,0,3,this._numParticles*r),HZ(s,ND,this._instanceIdBuffer,Hne)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Ar.createVertex(e,gr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new vp(e,ND,{geometry:Mc(qXe)},{geometry:Ar.createVertex(e,gr.STATIC_DRAW,r)})}};h([f({constructOnly:!0})],Mv.prototype,"context",void 0),h([f({constructOnly:!0})],Mv.prototype,"view",void 0),h([f({readOnly:!0})],Mv.prototype,"updating",null),h([f()],Mv.prototype,"_updatingTracking",void 0),Mv=h([N("esri.views.3d.environment.Precipitation")],Mv);const qXe=Gi().vec3f(E.POSITION),Hne=Mc(Gi().f32(E.INSTANCEFEATUREATTRIBUTE),1);function XXe(){const t=new mr;return t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.COLOR,"vec4"),t.attributes.add(E.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new Mi("transform",(e,r)=>YXe(e,r)),new Jt("viewport",(e,r)=>r.camera.fullViewport),new Ce("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(w`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(w`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function YXe(t,e){return In(C0,e.camera.projectionMatrix),C0[10]=24e-8-1,C0[11]=-1,C0[14]=(24e-8-2)*e.camera.near,Vr(C0,C0,e.camera.viewMatrix),Vr(C0,C0,t.modelMatrix)}const C0=_e(),ZXe=Object.freeze(Object.defineProperty({__proto__:null,build:XXe},Symbol.toStringTag,{value:"Module"}));let QXe=class extends Wr{constructor(){super(...arguments),this.modelMatrix=_e()}},O2e=class R2e extends Tr{constructor(e){super(e,new va,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,R2e.shader.get().build(),fr)}initializePipeline(){return Ot({blending:So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.LEQUAL},colorWrite:Ft})}};O2e.shader=new _r(ZXe,()=>ce(()=>import("./Stars.glsl-0c573990.js"),[]));let by=class extends xe{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new QXe,this._updatingTracking=new Df}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=yu(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Fi(this._technique),this._vao=Le(this._vao),A1=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Et.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||A1==null)return;this._technique=new O2e({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=A1.byteLength/Wne;const r=new Float32Array(A1,0,2*this._numPoints),i=new Uint8Array(A1,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),Pr)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),n=In(this._renderParameter.modelMatrix,eYe);AS(n,n,-i*Math.PI),Vr(n,KXe,n),AS(n,n,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,n){const s=qne.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const u=r[2*c],d=r[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(d)),o.set(c,1,-Math.sin(u)*Math.sin(d)),o.set(c,2,-Math.cos(d));const p=this._unpackUint8Attributes(i[c]),m=this._hexToRGB(JXe[p[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,p[0])}return new vp(e,fr,{geometry:Mc(qne)},{geometry:Ar.createVertex(e,gr.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(A1!=null)return null;const e=hE(async r=>{const{data:i}=await bFe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),A1=i});return e.promise.catch(r=>{Zn(r)||J.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new Y("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/Wne;if(r%1!=0||r>5e4||r<5e3)throw new Y("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};h([f({constructOnly:!0})],by.prototype,"view",void 0),h([f({constructOnly:!0})],by.prototype,"requestRender",void 0),h([f({readOnly:!0})],by.prototype,"updating",null),h([f()],by.prototype,"_loadDataTask",void 0),h([f()],by.prototype,"_updatingTracking",void 0),by=h([N("esri.views.3d.environment.Stars")],by);const JXe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],KXe=yZ(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),eYe=yZ(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Wne=9,qne=Gi().vec3f(E.POSITION).vec4u8(E.COLOR).f32(E.SIZE);let A1=null;function tYe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function ER(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function yQ(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>tl()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function _Q(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+o*a+n*c-s*l,t[1]=n*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-n*a,t[3]=o*u-i*a-n*l-s*c,t}function rYe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-i*a,t}function iYe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-s*a,t[1]=n*l+o*a,t[2]=s*l+i*a,t[3]=o*l-n*a,t}function nYe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=n*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function sYe(t,e){const r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function FD(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,u,d,p,m=r[0],y=r[1],_=r[2],v=r[3];return c=n*m+s*y+o*_+a*v,c<0&&(c=-c,m=-m,y=-y,_=-_,v=-v),1-c>tl()?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(d=1-i,p=i),t[0]=d*n+p*m,t[1]=d*s+p*y,t[2]=d*o+p*_,t[3]=d*a+p*v,t}function oYe(t){const e=mP,r=e(),i=e(),n=e(),s=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function aYe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=s*a,t}function X_(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function P2e(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*s+o]-e[3*o+s])*i,t[s]=(e[3*s+n]+e[3*n+s])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}function lYe(t,e,r,i){const n=.5*Math.PI/180;e*=n,r*=n,i*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=s*l*u-o*a*c,t[1]=o*a*u+s*l*c,t[2]=o*l*c-s*a*u,t[3]=o*l*u+s*a*c,t}function cYe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const vQ=vh,uYe=gi,hYe=cY,dYe=_Q,pYe=ew,fYe=fye,mYe=dY,M2e=uY,gYe=M2e,$2e=hY,yYe=$2e,bQ=pye,_Ye=LT,vYe=x4;function bYe(t,e,r){const i=fe(e,r);return i<-.999999?(ot(Pp,wYe,e),rc(Pp)<1e-6&&ot(Pp,xYe,e),me(Pp,Pp),ER(t,Pp,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ot(Pp,e,r),t[0]=Pp[0],t[1]=Pp[1],t[2]=Pp[2],t[3]=1+i,bQ(t,t))}const Pp=O(),wYe=Se(1,0,0),xYe=Se(0,1,0);function TYe(t,e,r,i,n,s){return FD(Xne,e,n,s),FD(Yne,r,i,s),FD(t,Xne,Yne,2*s*(1-s)),t}const Xne=Au(),Yne=Au();function SYe(t,e,r,i){const n=EYe;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],bQ(t,P2e(t,n))}const EYe=hi();Object.freeze(Object.defineProperty({__proto__:null,add:hYe,calculateW:sYe,conjugate:X_,copy:vQ,dot:fYe,equals:vYe,exactEquals:_Ye,fromEuler:lYe,fromMat3:P2e,getAxisAngle:yQ,identity:tYe,invert:aYe,len:gYe,length:M2e,lerp:mYe,mul:dYe,multiply:_Q,normalize:bQ,random:oYe,rotateX:rYe,rotateY:iYe,rotateZ:nYe,rotationTo:bYe,scale:pYe,set:uYe,setAxes:SYe,setAxisAngle:ER,slerp:FD,sqlerp:TYe,sqrLen:yYe,squaredLength:$2e,str:cYe},Symbol.toStringTag,{value:"Module"}));function jh(t=I2e){return[t[0],t[1],t[2],t[3]]}function UD(t,e,r=jh()){return re(r,t),r[3]=e,r}function Zne(t,e,r=jh()){return ot(r,t,e),me(r,r),r[3]=-lye(t,e),r}function hH(t,e,r=jh()){return ER(S$,t,p5(t)),ER(Qne,e,p5(e)),_Q(S$,Qne,S$),OYe(r,Ka(yQ(r,S$)))}function CYe(t,e,r,i=jh()){return UD(nye,t,E$),UD(sye,e,Jne),UD(oY,r,Kne),hH(E$,Jne,E$),hH(E$,Kne,i),i}function AYe(t){return t[3]}function p5(t){return It(t[3])}function OYe(t,e){return t[3]=e,t}const I2e=[0,0,1,0],S$=Au(),Qne=Au();jh();const E$=jh(),Jne=jh(),Kne=jh();function RYe(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===oc.FINISHED&&(t.fadeIn.factor=0,re(i,Sf),t.fadeIn.stage=oc.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=ys.FINISHED),t.fadeIn.stage===oc.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(QZ(t.data)&&t.renderingStage!==On.RENDERING||t.renderingStage===On.FADING_TEXTURE_CHANNELS)&&(re(i,Sf),t.fadeIn.stage=oc.FADE_IN,t.startTime=e,t.renderingStage===On.FADING_TEXTURE_CHANNELS&&(t.renderingStage=On.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===oc.FADE_IN?t.fadeIn.factor=r?ge((e-t.startTime)/(L2e*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===oc.FADE_IN&&(t.fadeIn.stage=oc.FINISHED,t.fadeIn.factor=1)}function PYe(t,e,r){const{fadeInOut:i,crossFade:n}=t;i.stage===ys.FINISHED&&(t.startTime=e,i.factor=1,i.stage=ys.FADE_OUT),i.factor>0&&i.stage===ys.FADE_OUT?i.factor=r?1-ge((e-t.startTime)/(DYe*r),0,1):0:(i.factor<=0&&i.stage===ys.FADE_OUT&&(i.factor=0,re(t.parallax.anchorPointClouds,Sf)),i.factor<=0&&i.stage===ys.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=ys.SWITCH,t.crossFade.enabled=!1,n.factor=1),i.stage===ys.SWITCH&&(QZ(t.data)&&t.renderingStage!==On.RENDERING||t.renderingStage===On.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=ys.FADE_IN,re(t.parallax.anchorPointClouds,Sf),t.crossFade.enabled=!1,n.factor=1,t.renderingStage===On.FADING_TEXTURE_CHANNELS&&(t.renderingStage=On.SWITCH_CHANNELS)),i.factor<1&&i.stage===ys.FADE_IN?i.factor=r?ge((e-t.startTime)/(L2e*r),0,1):1:i.factor>=1&&i.stage===ys.FADE_IN&&(i.stage=ys.FINISHED,i.factor=1))}function MYe(t,e,r,i){const{crossFade:n}=t,s=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(re(t.parallaxNew.anchorPointClouds,Sf),t.startTime=e,n.factor=0,t.crossFade.enabled=!0),n.factor<1&&t.crossFade.enabled?n.factor=r?ge((e-t.startTime)/(NYe*r),0,1):1:n.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,n.factor=1,re(s,t.parallaxNew.anchorPointClouds),t.renderingStage===On.FADING_TEXTURE_CHANNELS&&(t.renderingStage=On.SWITCH_CHANNELS))}function ese(t,e,r,i){const n=t.fadeInOutHeight,s=n.stage===H_.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-s)/(FYe*i);n.factor+=e?-o:o}else n.factor=e?0:1;t.startTimeHeightFade=r,n.factor=ge(n.factor,0,1),n.stage=H_.HEIGHT_FADE}function $Ye(t,e,r,i,n){t.renderingStage===On.FINISHED_RENDERING&&(t.renderingStage=On.FADING_TEXTURE_CHANNELS);const s=Te(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=s-Kt.radius>yf?1:0),t.isCameraPositionFinal=N_(t.cameraPositionLastFrame,e.eye),me(Sf,e.eye),te(Sf,Sf,Kt.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&re(o.anchorPointClouds,Sf);const a=Te(ae(LYe,o.anchorPointClouds,Sf));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==oc.FINISHED?RYe(t,i,n):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==ys.FINISHED?PYe(t,i,n):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===On.FADING_TEXTURE_CHANNELS?MYe(t,i,n,(r!==Cr.IDLE||!QZ(t.data))&&t.renderingStage!==On.FADING_TEXTURE_CHANNELS):l=!1;const c=s-Kt.radius;if((c>1.7*yf||c<-yf)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>yf||c<-.35*yf)&&t.fadeInOutHeight.factor<1?ese(t,!1,i,n):c<yf&&c>-.35*yf&&t.fadeInOutHeight.factor>0?ese(t,!0,i,n):t.fadeInOutHeight.stage=H_.FINISHED,t.renderingStage===On.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=On.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(s*s-Kt.radius*Kt.radius,0))/s,Zne(tse,o.anchorPointClouds,ux),mc(o.transform,yn,ux[3],ux),l){const{parallaxNew:u}=t;Zne(tse,u.anchorPointClouds,ux),mc(u.transform,yn,ux[3],ux)}re(t.cameraPositionLastFrame,e.eye)}function IYe(t){return t.crossFade.enabled||t.fadeInOut.stage!==ys.FINISHED||t.fadeIn.stage!==oc.FINISHED||t.fadeInOutHeight.stage!==H_.FINISHED||t.renderingStage!==On.FINISHED}const tse=Se(0,0,1),ux=jh(),Sf=O(),LYe=O(),L2e=1,DYe=.5,NYe=1.3,FYe=1;let RE=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const n=this._outer.get(e);n?n.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Hn;function rse(t=!se("disable-feature:high-quality-idle"),e=null){const r=new RE;return t?(r.set(Cr.IDLE,Hn.Antialiasing,e!=="low"),r.set(Cr.IDLE,Hn.HighResolutionAtmosphere,e!=="low"),r.set(Cr.IDLE,Hn.HighQualityTransparency,!0),r.set(Cr.IDLE,Hn.SSAO,!0),r.set(Cr.IDLE,Hn.WaterReflection,!0),r.set(Cr.IDLE,Hn.PhysicalPixelRendering,!se("esri-mobile"))):(r.set(Cr.ANIMATING,Hn.HighResolutionShadows,!0),r.set(Cr.INTERACTING,Hn.HighResolutionShadows,!0)),r.set(Cr.IDLE,Hn.HighResolutionShadows,!0),r.set(Cr.IDLE,Hn.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Hn||(Hn={}));var GT;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(GT||(GT={}));var J3;const UYe=[le.POSTPROCESSING_ENVIRONMENT_OPAQUE,le.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Oo=J3=class extends xe{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new Qk,this._newWeatherParameters=new Qk,this._fadedWeatherParameters=new Qk,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(UYe,this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:ra.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===ra.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Te(this.view.state.camera.eye)-Mr(this.view.spatialReference).radius<=yf}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new by({view:t,requestRender:()=>this._setNeedsRender()}):(Me(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Me(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Me(t),new Mv({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Me(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Me(t),new fl({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Me(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Mr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Me(t),new Ov({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Me(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new Rv({context:r,view:e,rctx:i,viewingMode:n})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([ue(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),An),ue(()=>this._stars,e),ue(()=>this._precipitation,e),ue(()=>this._clouds,()=>this._updateWeather(),Pr),ue(()=>this._fog,()=>this._updateFogHaze(),Pr),ue(()=>this.view.state.mode,()=>{this._setNeedsRender()},Br),ue(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},An)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Me(this._atmosphere),this._set("_stars",Me(this._stars)),this._set("_precipitation",Me(this._precipitation)),this._set("_clouds",Me(this._clouds)),this._set("_cloudsComposition",Me(this._cloudsComposition)),this._set("_fog",Me(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=SWe(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&($Ye(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===On.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){var e,r,i,n,s,o,a,l,c;if(t.output===D.Color)switch(t.bindParameters.slot){case le.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,((e=this.view)==null?void 0:e.qualitySettings.highResolutionAtmosphere)||((n=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer)==null?void 0:n.isFeatureEnabled(Hn.HighResolutionAtmosphere))),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),IYe(t.bindParameters.cloudsFade)&&this._context!=null&&((s=t.bindParameters.cloudsFade.data)==null?void 0:s.cubeMap)!=null&&this._context.requestRender());break;case le.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,((o=this.view)==null?void 0:o.qualitySettings.highResolutionAtmosphere)||((c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.isFeatureEnabled(Hn.HighResolutionAtmosphere))),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const u=this.view.environment.weather;u.type!=="rainy"&&u.type!=="snowy"||this._precipitation.render(t,u.precipitation,u.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(t),i===GT.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===oc.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===ys.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(ea[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=wt(3e-5,.005,t.weatherAdjustment**3),re(this._newWeatherParameters.fog.color,ise),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=wt(4e-6,2e-4,(t.effect??0)**3),re(this._newWeatherParameters.fog.color,kYe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=wt(4e-6,2e-4,(t.effect??0)**3),re(this._newWeatherParameters.fog.color,ise),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==ra.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Me(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Me(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case ra.Realistic:return xne;case ra.Local:return MXe;case ra.Mars:return NXe;default:case ra.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||sm(this.view.spatialReference)?ra.None:r===$e.Local?ra.Local:this._context!=null&&xne.isSupported(this._context)&&eR(this.view.spatialReference)?ra.Realistic:nm(this.view.spatialReference)?ra.Mars:ra.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{nse=J3.prototype._getAtmosphereClass,J3.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{J3.prototype._getAtmosphereClass=nse}}}};h([f({constructOnly:!0})],Oo.prototype,"view",void 0),h([f({readOnly:!0})],Oo.prototype,"atmosphere",null),h([f({readOnly:!0})],Oo.prototype,"_atmosphereType",null),h([f({type:Boolean,readOnly:!0})],Oo.prototype,"updating",null),h([f({readOnly:!0})],Oo.prototype,"weatherVisible",null),h([f()],Oo.prototype,"_context",void 0),h([f()],Oo.prototype,"_atmosphere",void 0),h([f({readOnly:!0})],Oo.prototype,"_stars",null),h([f({readOnly:!0})],Oo.prototype,"_precipitation",null),h([f({readOnly:!0})],Oo.prototype,"_clouds",null),h([f({readOnly:!0})],Oo.prototype,"_cloudsComposition",null),h([f({readOnly:!0})],Oo.prototype,"_fog",null),h([f({readOnly:!0})],Oo.prototype,"weatherEnabled",null),h([f({readOnly:!0})],Oo.prototype,"_precipitationEnabled",null),h([f({readOnly:!0})],Oo.prototype,"_weatherUpdateParameters",null),Oo=J3=h([N("esri.views.3d.environment.EnvironmentRenderer")],Oo);let Qk=class{constructor(){this.fog=new qqe,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,re(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=wt(e.fog.amount,r.fog.amount,i),this.hazeAmount=wt(e.hazeAmount,r.hazeAmount,i),this.fog.strength=wt(e.fog.strength,r.fog.strength,i),Lr(this.fog.color,e.fog.color,r.fog.color,i)}};const kYe=Se(.5,.5,.5),ise=Se(1.5,1.5,1.5);let nse;function sse(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return zYe(t,e.longitude,e.latitude,r.longitude,r.latitude)}function zYe(t,e,r,i,n){const s=It(r),o=It(n),a=s-o,l=It(e)-It(i),c=Math.sin(a/2),u=Math.sin(l/2),d=2*$h(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*u*u))*t;return Math.round(1e4*d)/1e4}function BYe(t,e,r){const i=e.spatialReference,n=Mr(i),s=new ze(e.x,t.y,i),o=new ze(r.x,t.y,i),a=new ze(t.x,e.y,i),l=new ze(t.x,r.y,i);return{lon:sse(n.radius,s,o),lat:sse(n.radius,a,l)}}function VYe(t,e,r){const i=e/r,n=It(t),s=Math.sin(i/2),o=Math.cos(n),a=2*$h(Math.sqrt(s*s/(o*o)));return Ka(a)}function GYe(t,e){let r=t/15;return e||(r=Math.round(r)),r}function ose(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=GYe(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}var SMt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function UP(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ase,lse,cse,dH={exports:{}};dH.exports,ase=dH,lse=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,d={dec:0,ra:0};function p(M){return M.valueOf()/l-.5+c}function m(M){return new Date((M+.5-c)*l)}function y(M){return p(M)-u}var _=23.4397*a;function v(M,I){return s(e(M)*r(_)-i(I)*e(_),r(M))}function b(M,I){return n(e(I)*r(_)+r(I)*e(_)*e(M))}function x(M,I,L){return s(e(M),r(M)*e(I)-i(L)*r(I))}function T(M,I,L){return n(e(I)*e(L)+r(I)*r(L)*r(M))}function S(M,I){return a*(280.16+360.9856235*M)-I}function A(M){return a*(357.5291+.98560028*M)}function C(M){return a*(1.9148*e(M)+.02*e(2*M)+3e-4*e(3*M))}function R(M,I){return M+I+102.9372*a+t}function P(M,I){var L=A(M),B=R(L,C(L));return I||(I={dec:0,ra:0}),I.dec=b(B,0),I.ra=v(B,0),I}var F={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(M,I,L,B){var H=a*-L,Z=a*I,K=y(M),de=P(K,d),Re=S(K,H)-de.ra;return B||(B={azimuth:0,altitude:0}),B.azimuth=x(Re,Z,de.dec),B.altitude=T(Re,Z,de.dec),B}},k=[[-.83,"sunrise","sunset"]];F.addTime=function(M,I,L){k.push([M,I,L])};var V=9e-4;function z(M,I){return Math.round(M-V-I/(2*t))}function X(M,I,L){return V+(M+I)/(2*t)+L}function q(M,I,L){return u+M+.0053*e(I)-.0069*e(2*L)}function G(M,I,L){return o((e(M)-e(I)*e(L))/(r(I)*r(L)))}function Q(M){var I=a*(134.963+13.064993*M),L=a*(93.272+13.22935*M),B=a*(218.316+13.176396*M)+6.289*a*e(I),H=5.128*a*e(L),Z=385001-20905*r(I);return{ra:v(B,H),dec:b(B,H),dist:Z}}return F.getTimes=function(M,I,L){var B=a*-L,H=a*I,Z=z(y(M),B),K=X(0,B,Z),de=A(K),Re=C(de),Ke=R(de,Re),_t=b(Ke,0),at=q(K,de,Ke);function yt(pt){return q(X(G(pt,H,_t),B,Z),de,Ke)}function Fe(pt){var ut=(e(pt)-e(H)*e(_t))/(r(H)*r(_t));return ut<-1?F.PolarException.MIDNIGHT_SUN:ut>1?F.PolarException.POLAR_NIGHT:F.PolarException.NORMAL}var pe,xt,vt,Ee,Be,Ve={solarNoon:m(at),nadir:m(at-.5),polarException:F.PolarException.NORMAL};for(pe=0,xt=k.length;pe<xt;pe+=1)Be=at-((Ee=yt((vt=k[pe])[0]*a))-at),Ve[vt[1]]=m(Be),Ve[vt[2]]=m(Ee);return Ve.polarException=Fe(k[0][0]*a),Ve},F.getMoonPosition=function(M,I,L){var B=a*-L,H=a*I,Z=y(M),K=Q(Z),de=S(Z,B)-K.ra,Re=T(de,H,K.dec);return Re+=.017*a/i(Re+10.26*a/(Re+5.1*a)),{azimuth:x(de,H,K.dec),altitude:Re,distance:K.dist}},F.getMoonFraction=function(M){var I=y(M),L=P(I),B=Q(I),H=149598e3,Z=o(e(L.dec)*e(B.dec)+r(L.dec)*r(B.dec)*r(L.ra-B.ra)),K=s(H*e(Z),B.dist-H*r(Z));return(1+r(K))/2},F},(cse=lse())!==void 0&&(ase.exports=cse);const fw=UP(dH.exports),Va={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let C$=class{constructor(e,r){this.direct=e,this.ambient=r}};function jYe(t,e,r,i,n,s){ne(s.ambient.color,1,1,1),s.ambient.intensity=Va.global.ambient,ne(s.direct.color,1,1,1),s.direct.intensity=Va.global.direct;const o=e[2],a=ge((Math.abs(o)-Va.local.altitude)/(Va.global.altitude-Va.local.altitude),0,1);let l;if(s.globalFactor=a,t!=null&&(l=fw.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=QYe(t,l,i);else{const u=F2e(i);c={direct:{intensity:Va.local.directAtNoon*u.direct,color:Se(1,1,1)},ambient:{intensity:Va.local.ambientAtNoon*u.ambient,color:Se(1,1,1)},timeOfDay:"early afternoon"}}Lr(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=wt(c.ambient.intensity,s.ambient.intensity,a),Lr(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=wt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,s.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}s.noonFactor=t!=null?ZYe(t,l):1,t!=null?HYe(t,e,r,s.direct.directionToLightSource):D2e(n,r,s.direct.directionToLightSource)}function D2e(t,e,r){e===$e.Global?me(t9,t.eye):ne(t9,0,0,1),te(r9,t.viewForward,-1);const i=bD(r9,t9),n=Math.max(i-2*i9,0),s=.85*n/(n+1),o=Math.max(i9,i-i9-s);Ec(bse,-o,t.viewRight),De(r,r9,bse),oe(r,r,te(JYe,t.viewRight,KYe)),me(r,r)}function HYe(t,e,r,i){const n=YYe,s=Nh(XYe);if(r===$e.Global)fw.getPosition(t,0,0,n),ne(i,0,0,-1),CS(s,s,-n.azimuth),M6(s,s,-n.altitude),De(i,i,s);else{const o=Va.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=ge(c,0,1),c<1?(fw.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),ne(i,0,-1,0),AS(s,s,-n.azimuth),CS(s,s,-n.altitude),De(i,i,s)}}function WYe(t,e){if(e===$e.Global)return!0;const r=Va.planarDirection;return Math.abs(t)<r.localAltitude}const qYe=Se(.5773502691896258,-.5773502691896258,.5773502691896258);let N2e=class{constructor(){this.ambient={color:Se(1,1,1),intensity:.55},this.direct={color:Se(1,1,1),intensity:.55,directionToLightSource:ki(qYe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const XYe=_e(),YYe={azimuth:0,altitude:0};function ZYe(t,e){const r=t.valueOf();let i,n;e.polarException===fw.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=i+432e6):e.polarException===fw.PolarException.POLAR_NIGHT?(i=r-2,n=r-1):(i=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=i+(n-i)/2;return 1-ge(Math.abs(r-s)/432e5,0,1)}function F2e(t){switch(t){case"disabled":case"sunny":case"cloudy":return new C$(1,1);case"rainy":return new C$(.4,1.2);case"snowy":return new C$(.5,1.3);case"foggy":return new C$(.2,1.6)}}function use(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const Jk=Se(.01,.01,.01),pH=Se(1,.6,.5),fH=Se(1,.98,.98),hse=Se(1,1,1),Kk=Se(.8,.8,1),mH=Se(.8,.8,1),gH=Se(.98,.98,1),dse=Se(1,1,1),e9=or(.01,Va.local.ambientAtNight),yH=or(Va.local.directAtTwilight,Va.local.ambientAtTwilight),_H=or(.9*Va.local.directAtNoon,Va.local.ambientAtNoon),pse=or(Va.local.directAtNoon,Va.local.ambientAtNoon),fse=_H,mse=fH,gse=gH,yse=yH,_se=pH,vse=mH;function QYe(t,e,r){const i=t.valueOf();let n,s;e.polarException===fw.PolarException.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===fw.PolarException.POLAR_NIGHT?(n=i-2,s=i-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,d=.06*o,p=n-d/2,m=n+d/2,y=s-d/2,_=s+d/2,v=Ne(),b=O(),x=O();let T="";if(i<p||i>_)fs(v,e9),re(b,Jk),re(x,Kk),T="night";else if(i<m){const C=(i-p)/(m-p);lh(v,e9,yH,C),Lr(b,Jk,pH,C),Lr(x,Kk,mH,C),T="sun rising"}else if(i<c){const C=(i-m)/(c-m);lh(v,yH,_H,C),Lr(b,pH,fH,C),Lr(x,mH,gH,C),T="early morning"}else if(i<a){const C=(i-c)/(a-c);lh(v,_H,pse,C),Lr(b,fH,hse,C),Lr(x,gH,dse,C),T="late morning"}else if(i<u){const C=(i-a)/(u-a);lh(v,pse,fse,C),Lr(b,hse,mse,C),Lr(x,dse,gse,C),T="early afternoon"}else if(i<y){const C=(i-u)/(y-u);lh(v,fse,yse,C),Lr(b,mse,_se,C),Lr(x,gse,vse,C),T="late afternoon"}else if(i<_){const C=(i-y)/(_-y);lh(v,yse,e9,C),Lr(b,_se,Jk,C),Lr(x,vse,Kk,C),T="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(use(b,S),use(x,S));const A=F2e(r);return{direct:{intensity:v[0]*A.direct,color:b},ambient:{intensity:v[1]*A.ambient,color:x},timeOfDay:T}}const bse=_e(),t9=O(),r9=O(),JYe=O(),i9=.25,KYe=.2;let yd=class extends Bn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Vi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new o5,this._ambientLight=new sQ,this._moonLight=new jxe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===$e.Global&&eR(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Oo({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([ue(()=>e.environment.lighting,n=>this._updateLightingHandler(n),Br),ue(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),Br),ue(()=>e.stationary,()=>this._interactingStationaryHandler()),ue(()=>e.environment.lighting.directShadowsEnabled,r,Br),ue(()=>e.qualitySettings.ambientOcclusion,r,Br),ue(()=>e.qualitySettings.reflections,r,Br),ue(()=>{var n;return(n=e.environment.background)==null?void 0:n.color},r,Br),ue(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Br),ue(()=>e.environment.weather.type,()=>this._updateLighting(null,GT.Faded),Br),ue(()=>this.weatherEnabled,()=>this._updateLighting(null,GT.Faded),Br),ue(()=>e.viewingMode,()=>this._resetReferencePosition(!0),An),ue(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),An),ue(()=>e.state.camera,i,An),ue(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Me(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!G_(i)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const n=ose(this._referencePosWGS84Comparable,wse);n!=null&&(r.autoUpdate(null,n),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=eR(this._view.spatialReference);if(i&&!G_(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=O()),i?$ve(n,this._referencePosWGS84Comparable):ne(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=GT.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=n!=null?eZe:tZe,o=this.weatherVisible?i.environment.weather.type:"disabled";n!=null?jYe(e,n,i.state.viewingMode,o,i.state.camera,s):i.environment.lighting.type==="virtual"&&D2e(i.state.camera,i.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;te(a.intensity,l.color,l.intensity*Math.PI),re(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;te(c.intensity,s.ambient.color,s.ambient.intensity);const u=this._moonLight;Lr(u.intensity,iZe,nZe,s.globalFactor);const d=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));te(u.intensity,u.intensity,d),re(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],s.noonFactor,s.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=rZe;i.setTime((r||this._view.environment.lighting.date).getTime());const n=ose(e,wse);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=i.getUTCHours()-(n.hours-s.hours),a=i.getUTCMinutes()-(n.minutes-s.minutes),l=i.getUTCSeconds()-(n.seconds-s.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||WYe(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),i=this._view.environment.background,n=i instanceof Bwe?{type:"color",color:_Z(it.toUnitRGBA(i.color))}:{type:"color",color:$t(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:n,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=XO(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=XO(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};h([f({type:Boolean,readOnly:!0})],yd.prototype,"updating",null),h([f()],yd.prototype,"disableQueries",void 0),h([f()],yd.prototype,"_disableWeather",void 0),h([f()],yd.prototype,"weatherEnabled",null),h([f()],yd.prototype,"weatherVisible",null),h([f()],yd.prototype,"referencePositionWGS84Comparable",null),h([f()],yd.prototype,"_renderer",void 0),h([f()],yd.prototype,"_referencePosWGS84Comparable",void 0),yd=h([N("esri.views.3d.environment.SceneViewEnvironmentManager")],yd);const eZe=new N2e,tZe=new N2e,rZe=new Date,wse={hours:0,minutes:0,seconds:0},iZe=Se(.22,.22,.33),nZe=Se(.22,.22,.22);var Ci;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Ci||(Ci={}));var Wt;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(Wt||(Wt={}));var Qs;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(Qs||(Qs={}));function CR(t,e){return(t&e)!=0}function f5(t,e,r,i,n,s){t!==0&&(r?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):i!=null?(s.min-=Math.max(0,(e-s.min)*(1-i)),s.max+=Math.max(0,(e-s.max)*(1-i))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const Y_={selection:Ci.NONE,interactionType:Wt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Qs.TUMBLE};function U2e(t,e,r,i){return e=e||t.viewForward,re(i,e),te(i,i,Math.sign(fe(e,r))),i}function sZe(t,e,r,i){return uZe(t,e,r,lZe(i,e,r,!0))}function oZe(t,e,r,i){const n=fe(r,ae(t,i,e));return oe(t,e,te(t,r,n))}const aZe={dir:O(),len:0,clip:Ne()};function lZe(t,e,r,i){const n=aZe;return t?(r&&i&&(n.len=ci(e,r)),re(n.dir,t)):i?(n.len=ci(e,r),ae(n.dir,r,e),te(n.dir,n.dir,1/n.len)):(ae(n.dir,r,e),me(n.dir,n.dir)),n}function cZe(t,e,r){const i=fe(t,r.dir),n=-oi(t,e);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;const s=n/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function uZe(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!cZe(t[n],e,i))return!1;return!0}function hZe(t,e,r=Y_){const i=wQ(t,e,r);if(i===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+i,o=U2e(e,r.interactionDirection,fZe(t,e,Math.sign(i),_Ze),yZe),a=re(vZe,e.viewForward),l=n.intersectInfiniteManifold(bu(e.eye,o),s,n9);return e.eye=l??n.setAltitude(n9,s,e.eye),e.center=oZe(n9,e.eye,a,e.center),!0}function wQ(t,e,r=Y_){if(!dZe(t,r)||!t.state.constraints.altitude)return 0;const i=mZe(t.state.constraints.altitude,gZe);pZe(t,r,i);const n=t.renderCoordsHelper.getAltitude(e.eye),s=ge(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}function dZe(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==Wt.TUMBLE||!CR(e.selection,Ci.TILT))}function pZe(t,e,r){const i=e.interactionType;if(i===Wt.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Wt.TUMBLE||i===Wt.ZOOM,c=wQ(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=n,r.max=s,f5(c,u,l,a,.05*u,r)}function fZe(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),te(i,i,r),i}function mZe(t,e){return e.min=t.min,e.max=t.max,e}const gZe={min:0,max:0},yZe=O(),_Ze=O(),vZe=O(),n9=O();function xQ(t,e,r=Y_){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;A$.min=0,A$.max=i,wZe(t,r,A$);const n=TQ(t,e),s=A$.max-n;return s>=-1e-6?0:s}function bZe(t,e,r=Y_){const i=xQ(t,e,r);if(i===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=TQ(t,e)+i,o=re(TZe,e.eye),a=U2e(e,r.interactionDirection,xZe(e,n.renderLocation,CZe),EZe);if(!u1(mbe(n.renderLocation,s),bu(e.eye,a),O$))return!1;e.eye=O$;const l=ae(SZe,e.eye,o);e.center=oe(O$,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,O$);return u!=null&&(e.center=u),!0}function wZe(t,e,r){const i=e.interactionType;if(i===Wt.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===Wt.ZOOM||i===Wt.PAN,c=xQ(t,o),u=c===0?0:TQ(t,o);r.min=n,r.max=s,f5(c,u,l,a,.05*u,r)}function TQ(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?ci(e.eye,r.renderLocation):0}function xZe(t,e,r){return Qg(r,t.eye,e)}const A$={min:0,max:0},TZe=O(),SZe=O(),EZe=O(),CZe=O(),O$=O();var Ui,To;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Ui||(Ui={}));let AZe=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=To.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(To||(To={}));let OZe=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},RZe=class extends OZe{constructor(e,r,i,n){super(e,r,i),this.center=n!=null?ki(n):null}},k2e=class{constructor(e){this.layerUid=e}},u8=class extends k2e{constructor(e,r){super(e),this.graphicUid=r}};function bp(t){return t!=null&&t.dist!=null}function xse(t){return(e,r,i)=>(Lr(Tse,e,r,i),!CZ(t,Tse))}function h8(t){return bp(t)&&t.intersector===Ui.OBJECT&&!!t.target}function d8(t){return bp(t)&&t.intersector===Ui.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const Tse=O();let PZe=class{constructor(){this._transform=_e(),this._transformInverse=new R$({value:this._transform},us,_e),this._transformInverseTranspose=new R$(this._transformInverse,Sc,_e),this._transformTranspose=new R$({value:this._transform},Sc,_e),this._transformInverseRotation=new R$({value:this._transform},Txe,hi)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){In(this._transform,e)}multiplyTransform(e){Vr(this._transform,this._transform,e)}set(e){In(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},R$=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},MZe=class{constructor(e=0){this.offset=e,this.tmpVertex=O()}applyToVertex(e,r,i){const n=e+this.localOrigin[0],s=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(n*n+s*s+o*o);return this.tmpVertex[0]=e+n*a,this.tmpVertex[1]=r+s*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let s=0;s<3;++s)A0[s]=e[0+s]+this.localOrigin[s],P$[s]=e[3+s]+this.localOrigin[s],dC[s]=A0[s];const r=this.applyToVertex(A0[0],A0[1],A0[2]);for(let s=0;s<3;++s)e[s]=r[s],e[s+3]=r[s];const i=s=>{const o=this.applyToVertex(s[0],s[1],s[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let s=1;s<8;++s){for(let o=0;o<3;++o)dC[o]=s&1<<o?P$[o]:A0[o];i(dC)}let n=0;for(let s=0;s<3;++s)A0[s]*P$[s]<0&&(n|=1<<s);if(n!==0&&n!==7){for(let s=0;s<8;++s)if(!(n&s)){for(let o=0;o<3;++o)dC[o]=n&1<<o?0:s&1<<o?A0[o]:P$[o];i(dC)}}for(let s=0;s<3;++s)e[s]-=this.localOrigin[s],e[s+3]-=this.localOrigin[s];return e}};const A0=O(),P$=O(),dC=O();let $Ze=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=O(),this._mbs=vn(),this._obb={center:O(),halfSize:rn(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const n=e,s=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(n*n+s*s+o*o);return this._tmpVertex[0]=e+n*a,this._tmpVertex[1]=r+s*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],n=e[2]+this.componentLocalOriginLength,s=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*s<0?0:Math.min(Math.abs(r),Math.abs(s)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),u=n*a<0?0:Math.min(Math.abs(n),Math.abs(a)),d=Math.sqrt(l*l+c*c+u*u);if(d<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=n<0?this._totalOffset:0,e[3]+=s>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const p=Math.max(Math.abs(r),Math.abs(s)),m=Math.max(Math.abs(i),Math.abs(o)),y=Math.max(Math.abs(n),Math.abs(a)),_=Math.sqrt(p*p+m*m+y*y),v=this._totalOffset/_,b=this._totalOffset/d;return e[0]+=r*(r>0?v:b),e[1]+=i*(i>0?v:b),e[2]+=n*(n>0?v:b),e[3]+=s*(s<0?v:b),e[4]+=o*(o<0?v:b),e[5]+=a*(a<0?v:b),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,Sh(this._obb.halfSize,e.halfSize,e.quaternion),oe(this._obb.halfSize,this._obb.halfSize,e.center);const n=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*n,this._obb.halfSize[1]+=this._obb.halfSize[1]*n,this._obb.halfSize[2]+=this._obb.halfSize[2]*n,ae(this._obb.halfSize,this._obb.halfSize,e.center),X_(Ase,e.quaternion),Sh(this._obb.halfSize,this._obb.halfSize,Ase),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},IZe=class{constructor(e=0){this.offset=e,this.sphere=vn(),this.tmpVertex=O()}applyToVertex(e,r,i){const n=this.objectTransform.transform;let s=n[0]*e+n[4]*r+n[8]*i+n[12],o=n[1]*e+n[5]*r+n[9]*i+n[13],a=n[2]*e+n[6]*r+n[10]*i+n[14];const l=this.offset/Math.sqrt(s*s+o*o+a*a);s+=s*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*s+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*s+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*s+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const n=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*n,r[1]+=r[1]*n,r[2]+=r[2]*n}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const Sse=new IZe;function vH(t){return t!=null?(Sse.offset=t,Sse):null}const Ese=new $Ze;function LZe(t){return t!=null?(Ese.offset=t,Ese):null}const Cse=new MZe;function DZe(t){return t!=null?(Cse.offset=t,Cse):null}const jy="terrain",Ase=Au(),BS=1e-5;let NZe=class{constructor(e){this.options=new AZe,this._results=new FZe,this.transform=new PZe,this.tolerance=BS,this.verticalOffset=null,this._ray=qs(),this._rayEnd=O(),this._rayBeginTransformed=O(),this._rayEndTransformed=O(),this.viewingMode=e??$e.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(fVe(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&W4(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===$e.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,oe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,n,s){this.point=r,this.filterPredicate=n,this.tolerance=i??BS;const o=vH(this.verticalOffset);if(e&&e.length>0){const a=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.shaderTransformation,n=vH(this.verticalOffset);for(const s of r){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(i,s.shaderTransformation),De(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),De(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;n!=null&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,d,p,m,y)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=p?this._results.hud:this._results,v=p?b=>{const x=new RZe(e,a,d,y);b.set(Ui.HUD,x,c,u,yn,m)}:b=>b.set(Ui.OBJECT,{object:e,geometryId:a,triangleNr:d},c,u,l,m);if((_.min.drapedLayerOrder==null||m>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==To.MIN&&(_.max.drapedLayerOrder==null||m<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===To.ALL)if(p){const b=new bH(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new jT(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function zh(t){return new NZe(t)}let FZe=class{constructor(){this.min=new jT(qs()),this.max=new jT(qs()),this.hud={min:new bH(qs()),max:new bH(qs()),all:new Array},this.ground=new jT(qs()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},jT=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(te(M$,this.ray.direction,this.dist),Te(M$)):null}getIntersectionPoint(e){return!!bp(this)&&(te(M$,this.ray.direction,this.dist),oe(e,this.ray.origin,M$),!0)}getTransformedNormal(e){return re(pC,this.normal),pC[3]=0,au(pC,pC,this.transformation),re(e,pC),me(e,e)}constructor(e){this.intersector=Ui.OBJECT,this.normal=O(),this.transformation=_e(),this._ray=qs(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Ui.OBJECT,W4(e,this._ray)}set(e,r,i,n,s,o,a){this.intersector=e,this.dist=i,re(this.normal,n??oY),In(this.transformation,s??yn),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){W4(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,re(this.normal,e.normal),In(this.transformation,e.transformation)}},bH=class extends jT{constructor(){super(...arguments),this.intersector=Ui.HUD}};function SQ(t){return new jT(t)}const M$=O(),pC=Qt();function z2e(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,m5,i)!=null&&Rye(r,m5)}function p8(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Gw(t,e,r,i){const n=t.state.camera.clone();e&&r&&i&&(n.eye=e,n.center=r,n.up=i),UZe(t,n.ray,O0)||re(O0,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(wo(n.eye,O0)<o){const a=s.collision.enabled;re(O1,n.viewForward),te(O1,O1,o),a?n.eye=ae(m5,O0,O1):oe(O0,n.eye,O1);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),u=s.collision.elevationMargin;a&&c<u&&(ae(O1,O0,n.eye),n.eye=l.setAltitude(m5,u,n.eye),oe(O0,n.eye,O1))}return n.center=O0,n}function Ose(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=p8(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,r,t.renderDataExtent,i,zZe),o=s*s;return wo(e,r)>o}function UZe(t,e,r){let i=Rse[t.viewingMode];i||(i=zh(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,Rse[t.viewingMode]=i);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||Ose(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||Ose(t,e.origin,r))||!!n&&kZe(e,r,Mr(t.spatialReference).radius)}function kZe(t,e,r){const i=fe(t.origin,t.origin)-r*r,n=i>0?Math.sqrt(i)/3:1;return te(e,t.direction,n/Te(t.direction)),oe(e,e,t.origin),!0}const Rse={},m5=O(),O0=O(),O1=O(),zZe={near:0,far:0};function PE(t,e,r=xh.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const n=p8(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+i.collision.elevationMargin;if(s>=o)return!1;const a=Te(e.eye);if(ae($$,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(BZe,o,e.eye),r===xh.EYE_AND_CENTER)e.center=oe($$,e.eye,$$);else if(r===xh.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=te($$,e.center,l)}return!0}var xh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(xh||(xh={}));const $$=O(),BZe=O();function Z_(t,e,r){t.worldUpAtPosition(e,Pse),ae(s9,r,e);const i=Te(s9);return i===0?0:As(fe(s9,Pse)/i)}const Pse=O(),s9=O();function B2e(t,e,r=Y_,i=!0){fC.eyeCenterDistance=0,fC.requiresTwoSteps=!1;const n=EQ(t,e,r,void 0,fC);if(n===0)return!1;switch(Ec(I$,-n,e.viewRight),r.tiltMode){case Qs.LOOK_AROUND:De(R0,e.viewForward,I$),te(R0,R0,fC.eyeCenterDistance),e.center=oe(Hy,e.eye,R0);break;case Qs.TUMBLE:ae(R0,e.center,e.eye),De(R0,R0,I$),e.eye=ae(Hy,e.center,R0);break;default:r.tiltMode}return e.up=De(Hy,e.up,I$),!fC.requiresTwoSteps||!i||B2e(t,e,r,!1)}function EQ(t,e,r=Y_,i=Y_,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,QZe);return ZZe(t,r,o),i.interactionType===Wt.TUMBLE&&CR(i.selection,Ci.ALTITUDE)&&V2e(t,i.interactionStartCamera,o),r.tiltMode===Qs.LOOK_AROUND||i.tiltMode===Qs.LOOK_AROUND?GZe(t,e,o,n):VZe(t,e,o)}function VZe(t,e,r){const i=Z_(t.renderCoordsHelper,e.center,e.eye),n=i-ge(i,r.min,r.max);return AR(n)?n:0}function GZe(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return HZe(t,e,r,i);case"local":return jZe(t,e,r,i)}}function jZe(t,e,r,i){const n=Z_(t.renderCoordsHelper,e.center,e.eye),s=ge(n,r.min,r.max),o=n-s;if(!AR(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function HZe(t,e,r,i){const n=WZe(t,e,JZe),s=ge(n.tiltAtCenter,r.min,r.max);if(!AR(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=qZe(n),a=XZe(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=YZe(n,o)),i&&(i.eyeCenterDistance=wH(n,o)),a}function WZe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+Mr(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,i,Hy);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,s!=null?(r.eyeCenterDistance=ci(e.eye,s),r.tiltAtCenter=Z_(t.renderCoordsHelper,s,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=Z_(t.renderCoordsHelper,e.center,e.eye):(EE(z6(B6,n),e.ray,Hy),r.eyeCenterDistance=ci(e.eye,Hy),r.tiltAtCenter=As(-fe(e.viewForward,me(Hy,Hy)))),r.radius=n,r.eyeRadius=Te(e.eye),r.constraints=t.state.constraints,r}function AR(t){return Math.abs(t)>1e-9}function qZe(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let n=i,s=e.clampTilt(r,i);const o=wH(t,s);if(e.clampTilt(o,i)===s)return s;let a=0;for(;a<10&&AR(s-n);){const l=(n+s)/2,c=wH(t,l);AR(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function wH(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-ge(e,0,Math.PI),i=$h(t.radius/t.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return s*t.eyeRadius}function XZe(t,e){const r=$h(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=$h(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function YZe(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function ZZe(t,e,r){if(e.interactionType===Wt.NONE)return;const{interactionStartCamera:i,interactionFactor:n}=e;if(!i)return;const{min:s,max:o}=r,a=EQ(t,i,Y_,e),l=a===0?0:Z_(t.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=o,e.interactionType===Wt.TUMBLE?(CR(e.selection,Ci.ALTITUDE)&&V2e(t,i,r),f5(a,l,!0,n,Mse,r)):f5(a,l,!1,n,Mse,r)}function V2e(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const n=la(e.center),s=Math.sqrt(n),o=e.distance,a=Mr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),d=(c*c-o*o-n)/(-2*s*o);r.min=Math.max(r.min,Math.min(Math.PI-As(d),r.max)),r.max=Math.min(r.max,Math.PI-As(u))}const R0=O(),I$=_e(),Hy=O(),Mse=It(5),QZe={min:0,max:0},JZe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},fC={eyeCenterDistance:0,requiresTwoSteps:!1};function KZe(t){return t}const f8=t=>t*t,CQ=t=>1-f8(1-t),eQe=t=>t<.5?f8(2*t)/2:(CQ(2*(t-.5))+1)/2,AQ=t=>t*t*t,G2e=t=>1-AQ(1-t),j2e=t=>t<.5?AQ(2*t)/2:(G2e(2*(t-.5))+1)/2,OQ=t=>t*t*t*t,H2e=t=>1-OQ(1-t),tQe=t=>t<.5?OQ(2*t)/2:(H2e(2*(t-.5))+1)/2,RQ=t=>t*t*t*t*t,W2e=t=>1-RQ(1-t),rQe=t=>t<.5?RQ(2*t)/2:(W2e(2*(t-.5))+1)/2,PQ=t=>1-Math.cos(t*Math.PI/2),q2e=t=>1-PQ(1-t),iQe=t=>t<.5?PQ(2*t)/2:(q2e(2*(t-.5))+1)/2,MQ=t=>2**(10*(t-1)),kP=t=>1-MQ(1-t),nQe=t=>t<.5?MQ(2*t)/2:(kP(2*(t-.5))+1)/2,$Q=t=>-(Math.sqrt(1-t*t)-1),X2e=t=>1-$Q(1-t),sQe=t=>t<.5?$Q(2*t)/2:(X2e(2*(t-.5))+1)/2;function Hh(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Wh(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const oQe=Wh(Hh(1),1),aQe=Wh(Hh(1),0),Y2e=Wh(Hh(1),.5),lQe=Wh(Hh(2),1),cQe=Wh(Hh(2),0),uQe=Wh(Hh(2),.5),hQe=Wh(Hh(3),1),dQe=Wh(Hh(3),0),pQe=Wh(Hh(3),.5),fQe=Wh(Hh(4),1),mQe=Wh(Hh(4),0),gQe=Wh(Hh(4),.5),yQe={linear:KZe,"in-quad":f8,"out-quad":CQ,"in-out-quad":eQe,"in-coast-quad":oQe,"out-coast-quad":aQe,"in-out-coast-quad":Y2e,"in-cubic":AQ,"out-cubic":G2e,"in-out-cubic":j2e,"in-coast-cubic":lQe,"out-coast-cubic":cQe,"in-out-coast-cubic":uQe,"in-quart":OQ,"out-quart":H2e,"in-out-quart":tQe,"in-coast-quart":hQe,"out-coast-quart":dQe,"in-out-coast-quart":pQe,"in-quint":RQ,"out-quint":W2e,"in-out-quint":rQe,"in-coast-quint":fQe,"out-coast-quint":mQe,"in-out-coast-quint":gQe,"in-sine":PQ,"out-sine":q2e,"in-out-sine":iQe,"in-expo":MQ,"out-expo":kP,"in-out-expo":nQe,"in-circ":$Q,"out-circ":X2e,"in-out-circ":sQe};function Rn(t,e,r=wQe,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<xQe;a++){let l=0;for(const c of bQe)if(CR(r.selection,c.type)){const u=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(n=!0,l+=u)}if(l===0)break}const s=CR(r.selection,Ci.COLLISION),o=_Qe(r.interactionType,t);return s&&PE(t,i,o)&&(n=!0),n&&i.computeUp(t.state.viewingMode),n}function _Qe(t,e){switch(t){case Wt.PAN:return xh.EYE_AND_CENTER;case Wt.ASCEND:return e.state.isGlobal?xh.EYE_AND_CENTER_SCALE:xh.EYE_AND_CENTER;default:return xh.EYE}}function zd(t){const e=Math.min(1,t/150);return j2e(e)}function vQe(t,e,r){return EQ(t,e,r)*e.distance}const bQe=[{type:Ci.TILT,error:vQe,apply:B2e},{type:Ci.ALTITUDE,error:wQ,apply:hZe},{type:Ci.DISTANCE,error:xQ,apply:bZe}],wQe={selection:Ci.ALL,interactionType:Wt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Qs.TUMBLE},xQe=5,$c=O(),Ul=O(),P0=O(),Yo=O(),R1=O(),TQe=O(),Ic={upward:Se(0,0,1),forward:Se(0,1,0),sideway:Se(1,0,0)},$se=hi();let Ise=class{constructor(e=$e.Global){this.viewingMode=e,this.center=O(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=ki(Ic.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===$e.Global){const s=(Te(this.center)+Te(e.center))/2;r.pan=bD(this.center,e.center)*s}else r.pan=ci(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const n=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,n),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===$e.Global?MVe(e.center,r.center,i.pan,this.center):Lr(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?wt(e.distance,r.distance,i.zoom):e.distance,this.pitch=wt(e.pitch,r.pitch,i.rotate);let n=e.yaw;const s=r.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=wt(n,s,i.rotate)}copyFrom(e){re(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,re(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,$se);re(this.center,e.center),ae(Yo,e.center,e.eye),zo(Yo,Yo,r),zo(R1,e.up,r),this.distance=Te(Yo),this.distance!==0&&(Yo[0]/=this.distance,Yo[1]/=this.distance,Yo[2]/=this.distance),this.pitch=this._eyeUpToPitch(Yo),this.yaw=this._eyeUpToYaw(Yo,R1),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,$se);Uh(r,r),this._axisAngleVec3(Ic.sideway,this.pitch-Math.PI/2,Ic.forward,Yo),this._axisAngleVec3(Ic.upward,this.yaw,Yo),this._axisAngleVec3(Ic.sideway,this.pitch-Math.PI/2,Ic.upward,R1),this._axisAngleVec3(Ic.upward,this.yaw,R1),te(Yo,Yo,this.distance),zo(Yo,Yo,r),zo(R1,R1,r),e.center=this.center,e.eye=ae(Yo,this.center,Yo),e.up=R1}_axisAngleVec3(e,r,i,n=i){const s=Math.cos(r),o=Math.sin(r);return te($c,i,s),ot(Ul,e,i),te(Ul,Ul,o),te(P0,e,(1-s)*fe(e,i)),oe(n,oe(n,$c,Ul),P0)}_lookAtOrientation(e,r=hi()){return this._upAtLookAt(e,P0),ot($c,this.lookAtDirection,P0),me($c,$c),$c[0]===0&&$c[1]===0&&$c[2]===0&&re($c,Ic.sideway),ot(Ul,P0,$c),me(Ul,Ul),r[0]=$c[0],r[1]=Ul[0],r[2]=P0[0],r[3]=$c[1],r[4]=Ul[1],r[5]=P0[1],r[6]=$c[2],r[7]=Ul[2],r[8]=P0[2],r}_upAtLookAt(e,r){return this.viewingMode===$e.Local?re(r,Ic.upward):me(r,e)}_eyeUpToPitch(e){return Math.PI-bD(Ic.upward,e)}_eyeUpToYaw(e,r){const i=TQe;return Math.abs(r[2])<.5?(re(i,r),e[2]>0&&te(i,i,-1)):re(i,e),ot(Ul,i,Ic.upward),me(Ul,Ul),bD(Ic.sideway,Ul,Ic.upward)}};const g5={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let SQe=class Z2e{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:g5.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Z2e(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:g5.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},EQe=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),s.hasPan&&!isNaN(r.pan)&&isFinite(s.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/s.compared.pan:r.pan=1,s.hasRotate&&!isNaN(r.rotate)&&isFinite(s.compared.rotate)?r.rotate=(n+l.compared.rotate*r.rotate)/s.compared.rotate:r.rotate=1,s.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-u)/(d-u)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},o9=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,n=r.targetZoom;this._zoomSign=i>n?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const s=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=r.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;i&&(n&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else n?this._panPixelFlow=l:i?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:i?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=n,r.rotate=s):r={zoom:i,pan:n,rotate:s},r}};function CQe(t,e,r){const i=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function AQe(t,e,r){const i=1/e,n=Math.log(t.compared.sourceZoom*i),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function OQe(t,e,r){const i=e-t.compared.sourceZoom,n=1/i,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function RQe(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function PQe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function MQe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function $Qe(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function IQe(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function LQe(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function DQe(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function NQe(t,e,r){const i=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*n*s*a+t.halfWindowSize*i*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function FQe(t,e,r){const i=e-t.compared.targetZoom,n=1/i,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function UQe(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function kQe(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function zQe(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function BQe(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-i):n*(e+i)}function VQe(t,e){let r=GQe(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=i.ascensionFactor===0,s=i.descensionFactor===0,o=n?RQe:CQe,a=n?PQe:AQe,l=n?MQe:OQe,c=s?UQe:DQe,u=s?kQe:NQe,d=s?zQe:FQe,p=S=>o(t,S,i)+$Qe(t,S,i)+c(t,S,i),m=S=>a(t,S,i)+IQe(t,S,i)+u(t,S,i),y=S=>l(t,S,i)+LQe(t,S,i)+d(t,S,i);let _=p(r);const v=BQe(t);let b;const x=e.maximumIterations||20,T=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<x;b++){const A=(m(r)+1e-6)/y(r);if(isNaN(A)||r>=T&&A<0){if(!isFinite(T))return null;r=T,_=p(r);break}if(r-=A,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const C=p(r);if(Math.abs(C-_)/_<=.005)break;_=C}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function GQe(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let jQe=class extends EQe{constructor(e,r){super(),this._preallocSegments=[new o9,new o9,new o9],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=VQe(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=CQ(i.zoom):e===this._descensionSegment&&(i.zoom=f8(i.zoom)),i}_updateWithApex(e,r){const[i,n,s]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const HQe={zoom:0,pan:0,rotate:0};let WQe=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new SQe(e),this.path=new jQe}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(Oge(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?Y2e:kP)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,HQe);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const n=r.minDuration!=null?r.minDuration:g5.minDuration/i,s=r.maxDuration!=null?r.maxDuration:g5.maxDuration/i;return Math.min(Math.max(n,e),s)}};const qQe=O();let XQe=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new WQe(()=>new Ise(e)),this._current=new Ise(e)}update(e,r,i){const n=this._animation.definition.source,s=this._animation.definition.target,o=ae(qQe,r.center,e.center),a=Te(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),re(n.lookAtDirection,o),re(s.lookAtDirection,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(r),this._current.copyFrom(n),this._animation.update(n,s,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new lt,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+Oge(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var Wi;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(Wi||(Wi={}));let sg=class extends xe{constructor(e){super(e),this.state=Wi.Ready}get active(){return this.state===Wi.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Wi.Stopped,!0)}finishController(){this.state=Wi.Finished}get steppingFinished(){return!1}};h([f({constructOnly:!0})],sg.prototype,"view",void 0),h([f({readOnly:!0})],sg.prototype,"active",null),h([f()],sg.prototype,"state",void 0),h([f({readOnly:!0})],sg.prototype,"isInteractive",null),sg=h([N("esri.views.3d.state.controllers.CameraController")],sg);let OR=class extends sg{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(wr()),this._asyncResult=null),this.state===Wi.Finished||this.state===Wi.Stopped?(GF(e),this.state===Wi.Finished?e.resolve():e.reject(wr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Wi.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==Wi.Ready&&this.state!==Wi.Running||(this.viewAnimation.state===DS.State.FINISHED?this.finish():this.viewAnimation.state===DS.State.STOPPED&&(this.state=Wi.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===Wi.Finished?this.viewAnimation.finish():this.state===Wi.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Wi.Finished?this._asyncResult.resolve():this._asyncResult.reject(wr()))}finish(){this.finishController()}};OR=h([N("esri.views.3d.state.controllers.AnimationController")],OR);let mg=class extends OR{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new XQe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new DS}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);L$.copyFrom(this.view.state.camera);const n=zh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(L$.ray,n,Lse)&&(L$.center=Lse),this.animation.update(L$,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?yQe[e.easing]:e.easing}}};h([f({constructOnly:!0})],mg.prototype,"mode",void 0),h([f({readOnly:!0})],mg.prototype,"isInteractive",null),mg=h([N("esri.views.3d.state.controllers.PointToPointAnimationController")],mg);const L$=new lt,Lse=O();function m8(t=ZQe){return[t[0],t[1],t[2],t[3]]}function RR(t,e){return YQe(t[0],t[1],t[2],e,vZ.get())}function YQe(t,e,r,i,n=m8()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function IQ(t,e,r){return ot(r,t,e),me(r,r),r[3]=k6(t,e),r}const ZQe=[0,0,1,0];function Q2e(t,e,r){return QQe(t,t.screenToRender(e,Ie.get()),r)}function QQe(t,e,r){const i=fs(Ie.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const n=fs(Ie.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,Ie.get());return s==null?null:(ae(r.direction,s,r.origin),r)}function ME(t,e,r){return LQ(t,t.screenToRender(e,Ie.get()),r)}function LQ(t,e,r){re(r.origin,t.eye);const i=ne(Ie.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(i,Ie.get());return n==null?null:(ae(r.direction,n,r.origin),r)}function DQ(t,e,r,i){const n=ME(e,r,JQe);return u1(t,n,i)}const JQe=qs();var VS;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(VS||(VS={}));const J2e=30,y5=[1,3e8],g8=80,K2e=8,eTe=200,tTe=1508e5,rTe=5,iTe=50,KQe=5,eJe=10,a9=90,jw={exclude:new Set([jy])};function $b(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function xH(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function Q_(t,e,r){const i=Ec(bZ.get(),r[3],r);i==null||lZ(i,yn)||(ae(kr,t.eye,e),De(kr,kr,i),t.eye=oe(kr,kr,e),ae(kr,t.center,e),De(kr,kr,i),t.center=oe(kr,kr,e),t.up=De(kr,t.up,i))}function tJe(t,e,r,i){return kw(t,Q2e(e,r,UQ),i)}function TH(t,e,r,i){return kw(t,ME(e,r,UQ),i)}function NQ(t,e,r,i){const n=Ie.get();let s=1-r;ae(n,e,t.eye);const o=Te(n);let a=o*(1-s);s>=0&&a<i&&(a=i,s=-(a-o)/o),Math.abs(o-a)<1e-6||(te(n,n,s),t.eye=oe(kr,t.eye,n),t.center=Lr(kr,t.center,e,s))}function nTe(t,e,r){e.getScreenCenter(Dse),DQ(t,e,Dse,kr)&&(e.center=kr);const i=e.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=te(Ie.get(),e.viewForward,n);e.eye=ae(kr,e.center,s)}const Dse=Xi();function l9(t,e){ne(e,0,0,0);for(const r of t)oe(e,e,r);te(e,e,1/t.length)}function kD(t,e,r,i){return Math.sin(t/Te(e))*(r+i.radius)}function Nse(t,e,r,i){return kD(Math.PI/2,e,r,i)+(t-Math.PI/2)}var Xs;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(Xs||(Xs={}));const Fse={Elevation:3e4,Angle:It(16)},D$={Pole:.95,Angle:It(18),Tilt:45},sTe=It(80);function oTe(t,e,r,i,n,s){const o=O(),a=vn();let l=!0,c=!0;return t.intersectScreen(r,o,s)?a[3]=Te(o):(c=!1,e.aboveGround&&n!==VS.Ellipsoid?a[3]=Math.max(Te(e.center),.9*i.radius):a[3]=Te(e.eye)-e.relativeElevation,n===VS.Silhouette?PR(a,e,r,o):l=DQ(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function y8(t,e,r){return Te(t.eye)-r.radius>Fse.Elevation?Xs.Horizontal:(ME(t,e,Hse),-Math.sign(t.relativeElevation)*(.5*Math.PI+k6(t.eye,Hse.direction))<Fse.Angle?Xs.Vertical:Xs.Horizontal)}function aTe(t,e,r){ae(c9,r,e),t.eye=ae(kr,t.eye,c9),t.center=ae(kr,t.center,c9)}const c9=O();function PR(t,e,r,i){const n=ME(e,r,UQ);return n!=null&&(EE(t,n,N$),u1(t,n,i)?!(wo(N$,n.origin)<wo(i,n.origin))||(re(i,N$),!1):(ae(hx,e.eye,e.center),me(hx,hx),xbe(hx,-fe(me(hx,hx),N$),Use),kw(Use,n,i),!1))}const N$=O(),hx=O(),Use=Er();function lTe(t,e,r,i,n,s){let o=0;if(ot(b5,t,e),ae(z$,t,e),Te(t)<=n||!i.aboveGround){ot(r,z$,i.eye);const a=fe(t,e)/(Te(t)*Te(e));if(a<.9999)o=As(a);else{const c=Te(ot(O(),t,e))/(Te(t)*Te(e));o=$h(c)}const l=Math.cos(ge(U_.normalize(It(s)),0,sTe));o=-o-Math.max(0,Te(e)-n)/(l*n)}else ae(kse,i.eye,i.center),ot(r,z$,kse),o=-Te(z$)/n;return me(r,r),te(r,r,Te(b5)),o}const kse=O();function zse(t,e,r,i){let n,s;const o=Math.cos(ge(U_.normalize(It(i)),0,sTe));return n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):As(e/r),s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):As(t/r),(s-n)*r}function rJe(t,e,r,i,n,s,o,a,l,c){const u=zse(t[2],e[2],s[3],a),d=l?zse(t[0],e[0],s[3],180):e[0]-t[0],p=Math.sin(o)*d-Math.cos(o)*u,m=Math.cos(o)*d+Math.sin(o)*u;me(kr,n);const y=l?p/Math.sqrt(Math.abs(s[3]**2-fe(r,kr)**2)):p/s[3],_=m/Math.sqrt(Math.abs(s[3]**2-fe(r,i)**2));er(c,y,_)}function cTe(t,e,r,i,n,s,o,a,l,c){ot(b5,t,e),qG(s.up,s.eye,F$,U$,k$),qG([0,0,1],s.eye,xg,A_,pTe),re(r,A_),re(i,xg),me(r,r),te(r,r,Te(b5)),_ie(t,me(U$,U$),me(k$,k$),me(F$,F$),Bse),_ie(e,U$,k$,F$,Vse),rJe(Bse,Vse,t,xg,A_,o,a,l,c,n)}function iJe(t,e,r,i,n,s,o){Ec(_5,n,i),Ec(v5,o,s),Vr(dT,_5,v5),ae(e,t,r),De(e,e,dT),oe(e,e,r)}function uTe(t,e,r,i,n,s){Ec(_5,i,r),Ec(v5,s,n),Vr(dT,_5,v5),ae(kr,t.eye,e),De(kr,kr,dT),t.eye=oe(kr,kr,e),ae(kr,t.center,e),De(kr,kr,dT),t.center=oe(kr,kr,e),ae(kr,t.up,e),De(kr,kr,dT),t.up=oe(kr,kr,e)}function FQ(t,e,r,i,n,s){return(Math.abs(i)>Math.PI-D$.Angle||Math.abs(i)<D$.Angle)&&(Math.abs(t[2])<r*D$.Pole||Math.abs(e)>r)&&s.aboveGround&&n<D$.Tilt}function hTe(t,e,r,i,n,s){if(s)IQ(r,i,Gse),Q_(e,t,Gse);else{const o=lTe(r,i,jse,e,t[3],n);Q_(e,t,RR(jse,o))}}function dTe(t,e,r,i,n,s,o){const a=o?20:1,l=1e-12;let c,u;re(P1,i),B$.copyFrom(e);for(let d=0;d<a&&wo(r,P1)>l&&(c=wo(r,P1),cTe(r,P1,A_,xg,mC,B$,t,n,s,o),uTe(B$,t,xg,mC[1],A_,mC[0]),iJe(P1,P1,t,xg,mC[1],A_,mC[0]),u=wo(r,P1),u<c||d===0);d++)e.copyFrom(B$)}function nJe(t,e,r,i,n,s,o){FQ(r,fe(e.up,r),t[3],-U_.normalize(It(n)),s,e)?dTe(t,e,r,i,-U_.normalize(It(n)),s,o):hTe(t,e,r,i,s,o)}function sJe(t,e,r,i,n,s){const{eye:o}=t;qG([0,0,1],o,xg,A_,pTe);const a=e.translation[0]*r.pan,l=n.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-fe(t.center,xg)**2/Te(t.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,d=-Math.cos(s)*l+Math.sin(s)*a;switch(mc(i.pan.matrix,i.pan.matrix,u,xg),i.pan.enabled=!0,n.mode){case"pan":mc(i.pan.matrix,i.pan.matrix,d,A_),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function oJe(t,e,r,i,n){const{eye:s,viewRight:o}=t,a=ot(Ie.get(),o,s),l=e.translation[0]*r.pan;switch(l!==0&&(mc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(mc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function aJe(t,e,r,i,n,s,o,a,l){FQ(t.center,fe(t.up,t.center),Te(t.center),-U_.normalize(It(s)),o,e)?sJe(e,r,i,a,l,-U_.normalize(It(n))):oJe(e,r,i,a,l)}const xg=O(),A_=O(),pTe=O(),F$=O(),U$=O(),k$=O(),Bse=O(),Vse=O(),mC=Ne(),Gse=m8(),_5=_e(),v5=_e(),dT=_e(),P1=O(),kr=O(),z$=O(),B$=new lt,b5=O(),jse=O(),UQ={origin:O(),direction:O()},Hse={origin:O(),direction:O()},Wse=.6,u9=4,lJe=60;let w5=class extends mg{constructor(){super(...arguments),this._zoomLocation=O(),this._tmpCamera=new lt,this._tmpViewDir=O(),this._tmpRayDir={origin:O(),direction:O()},this._targetOnSphere=O(),this._tmpCenter=O(),this._constraintOptions={selection:Ci.ALL_EXCEPT_COLLISION,interactionType:Wt.ZOOM,interactionFactor:null,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Qs.TUMBLE},this._sphere=vn()}initialize(){this._intersector=zh(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(i.camera):this.animation.cameraAt(1,n));let s=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?jw:{})&&(s=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:kP}}_updateCamera(e,r,i,n,s){const o=Mr(this.view.spatialReference),a=y8(e,n,o),l=Math.abs(this.view.camera.position.z);me(G$,e.eye),te(G$,G$,-1),ME(e,n,this._tmpRayDir),me(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=ge(Math.min(K2e,1/Math.abs(fe(G$,this._tmpRayDir.direction)))*l,eTe,tTe);if(a===Xs.Horizontal){let u=Wse**r;this._sphere[3]=Te(i),ae(this._tmpViewDir,e.center,e.eye);const d=Math.min(Te(this._tmpViewDir),c);let p=d*u;if(u<=1&&p<u9&&(p=u9,u=p/d),Math.abs(d-p)<1e-6)return;const m=Te(e.center);if(this._sphere[3]!==m){const y=this._sphere[3]+u*(m-this._sphere[3]);e.center=te(V$,e.center,y/m)}te(this._tmpViewDir,this._tmpViewDir,-u),e.eye=oe(V$,e.center,this._tmpViewDir),Rn(this.view,e,this._constraintOptions),wo(i,e.center)>1e-12&&DQ(this._sphere,e,n,this._targetOnSphere)&&nJe(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=Wse**Math.abs(r);const d=r>0?1:-1;ae(this._tmpViewDir,i,e.eye);const p=Te(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,lJe);let y=m??c;y=s&&r>0?Math.min(y,p):y,te(this._tmpRayDir.direction,this._tmpRayDir.direction,y),oe(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=y*u;const v=Math.max(u9,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,u=_/y),Math.abs(y-_)<1e-6)return;te(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-u)),e.eye=oe(V$,e.eye,this._tmpRayDir.direction),e.center=oe(V$,e.center,this._tmpRayDir.direction)}PE(this.view,e)}};w5=h([N("esri.views.3d.state.controllers.global.ZoomStepController")],w5);const V$=O(),G$=O(),cJe=.6,uJe=4,hJe=60;let x5=class extends mg{constructor(){super(...arguments),this._zoomLocation=O(),this._tmpCamera=new lt,this._tmpRayDir=O(),this._tmpCenter=O(),this._constraintOptions={selection:Ci.ALL,interactionType:Wt.ZOOM,interactionFactor:null,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Qs.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(i.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(i.camera);const s=zh(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?jw:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:re(this._zoomLocation,this._tmpCamera.center);const a=cJe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,hJe);ae(j$,this._tmpCamera.eye,this._zoomLocation),me(j$,j$);const c=ge(Math.min(K2e,1/Math.abs(fe(dJe,j$)))*Math.abs(this.view.camera.position.z),eTe,tTe);if(l=l??c,l){const u=O();ae(u,this._zoomLocation,this._tmpCamera.eye),(l<Te(u)||!o)&&(me(u,u),oe(this._zoomLocation,this._tmpCamera.eye,te(u,u,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:kP}}_updateCamera(e,r,i){ae(this._tmpRayDir,i,e.eye);const n=Te(this._tmpRayDir);let s=n*r;const o=r<=1,a=Math.max(uJe,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,r=s/n),Math.abs(n-s)<1e-6||(te(this._tmpRayDir,this._tmpRayDir,r),e.eye=ae(qse,i,this._tmpRayDir),e.center=Lr(qse,e.center,i,1-r),Rn(this.view,e,this._constraintOptions)))}};x5=h([N("esri.views.3d.state.controllers.local.ZoomStepController")],x5);const qse=O(),dJe=Se(0,0,1),j$=O();function pJe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function kQ(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let fJe=class extends Eo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(pJe(r,"primary")){const i=this._view.state.isGlobal?new w5({view:this._view,mode:"animation"}):new x5({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Xi(r.x,r.y)),e.stopPropagation()}}};function mJe(t,e,r){return t===$e.Global?new yJe(r):new gJe(e,r)}let gJe=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Mr(r),this._unitInMeters=el(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,n,s){var T;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=(T=this._elevationProvider)==null?void 0:T.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=i??new Dr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},d=Math.max(u.x,u.y,u.z);ae(M1,r,e),dx[0]=M1[0]>0?i.xmax:i.xmin,dx[1]=M1[1]>0?i.ymax:i.ymin,dx[2]=M1[2]>0?d/2:-d/2,ae(dx,dx,e),me(M1,M1);const p=1.1*fe(dx,M1)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=y*bJe*this._unitInMeters,v=y*wJe*this._unitInMeters,b=ge((o-v)/(_-v),0,1)**3,x=Math.min(wt(m,p,b),m)*Math.max(Math.log(Math.abs(l)),1);return fTe(Math.min(x,Math.max(34064e4,d))/this._unitInMeters,_Je,this._unitInMeters,s)}},yJe=class{constructor(e){this._referenceEllipsoid=Mr(e)}compute(e,r,i,n,s){s||(s={near:0,far:0});const o=Te(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),u=Math.max(c,Math.abs(a)),d=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return fTe(1.2*wt(d,p,BZ(u)),ge(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function fTe(t,e,r,i){const n=vJe/r;return t/e>n?(i.far=t,i.near=i.far/e):(i.near=n,i.far=i.near*e),i}const _Je=2e4,vJe=2,bJe=.001,wJe=1e-4,dx=O(),M1=O();let zD=class extends xe{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&z2e(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>PE(this.view,e,xh.EYE_AND_CENTER))}};h([f({constructOnly:!0})],zD.prototype,"view",void 0),zD=h([N("esri.views.3d.state.ElevationCollisionConstraint")],zD);let K3=class extends xe{constructor(e){super(e),this.nearFarHeuristic=mJe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([ue(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(n=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),ue(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Br),ue(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(n=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),Br),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),Br),ue(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),Br),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Br),ue(()=>{var e,r,i,n,s,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Br)]),this.view.state.isLocal&&this.addHandles(ue(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Pr)),this._updateNearFar(),this.view.state.viewingMode!==$e.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new zD({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,p8(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Ci.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==$e.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(It(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(Ka(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,n=3*r/Math.atan(i.camera.fov/2);n!==i.constraints.distance&&(i.constraints.distance=n)}_reapplyConstraints(e=Ci.ALL){this.view.state.updateCamera(r=>Rn(this.view,r,{selection:e,interactionType:Wt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Qs.TUMBLE}))}};h([f({constructOnly:!0})],K3.prototype,"view",void 0),h([f({readOnly:!0})],K3.prototype,"surfaceCollisionConstraint",void 0),K3=h([N("esri.views.3d.state.ConstraintsManager")],K3);let Wy=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=TR(),this._points=Uxe(),this.lines=new Array(12),this._origin=O(),this._direction=O(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:O(),endpoint:null}}update(e){kxe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),re(this._origin,e.eye),re(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)re(this._points[r],e[r]);zxe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return h_(this.frustum,e)}intersectsRay(e){return vqe(this.frustum,e)}intersectsLineSegment(e,r){return bqe(this.frustum,e,r)}intersectsPoint(e){return Bxe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;h9(this.lines[r],e[r],e[i]),h9(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),h9(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function h9(t,e,r){t.origin=e,t.endpoint=r,Qg(t.direction,e,r)}Wy.planePointIndices=wqe,Wy.nearFarLineIndices=[[Xe.NEAR_BOTTOM_LEFT,Xe.FAR_BOTTOM_LEFT],[Xe.NEAR_BOTTOM_RIGHT,Xe.FAR_BOTTOM_RIGHT],[Xe.NEAR_TOP_RIGHT,Xe.FAR_TOP_RIGHT],[Xe.NEAR_TOP_LEFT,Xe.FAR_TOP_LEFT]];let iO=class extends sg{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Wi.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||z2e(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),PE(this.view,e,xh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Wi.Stopped)})}};h([f({constructOnly:!0})],iO.prototype,"desiredCamera",null),iO=h([N("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],iO);const xJe=O(),H$=O();function zQ(){return{direction:O(),up:O()}}function mTe(t,e,r,i,n){let s=me(xJe,t),o=fe(s,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(fe(e,i)),o<.99?(re(s,e),a&&te(s,s,-1)):s=null);let l=0;if(s){te(H$,i,fe(i,s)),ae(s,s,H$);const u=fe(s,n)/(Te(s)*Te(n));ot(H$,s,n),l=(fe(H$,i)>0?1:-1)*Ka(As(u))}const c=Ka(As(-fe(i,t)/Te(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const gTe=Se(0,1,0),yTe=Se(0,0,1),gC=_e(),gm=O(),ym=O();function _Te(t,e,r,i=zQ()){const{direction:n,up:s}=i;return uve(gC,-It(e)),CS(gC,gC,It(r)),De(n,yTe,gC),te(n,n,-1),De(s,gTe,gC),i}function TJe(t,e,r,i){return mTe(e,r,i,yTe,gTe)}function SJe(t,e,r,i){const n=_Te(t,r,i),s=O();return te(s,n.direction,-e),oe(s,s,t),{up:n.up,eye:s,heading:r,tilt:i}}function EJe(t){return Ka(t)}function CJe(t){return It(t)}function vTe(t,e,r,i,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Bi(e,gm,s),Bi(e,ym,s),gm[0]-=r/2,ym[0]+=r/2,gm[1]-=i/2,ym[1]+=i/2,Cs(gm,s,gm,o),Cs(ym,s,ym,o),n?(n.xmin=gm[0],n.ymin=gm[1],n.xmax=ym[0],n.ymax=ym[1],n.spatialReference=o):n=new Dr(gm[0],gm[1],ym[0],ym[1],o),n}const AJe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:TJe,eyeForCenterWithHeadingTilt:SJe,eyeTiltToLookAtTilt:CJe,headingTiltToDirectionUp:_Te,lookAtTiltToEyeTilt:EJe,toExtent:vTe},Symbol.toStringTag,{value:"Module"})),bTe=Se(0,0,1),wTe=me(O(),Se(1,1,1)),OJe=new F_(-180,180),yC=_e(),Iy=O(),px=O();function xTe(t,e,r,i=zQ()){ot(Iy,t,bTe),fe(Iy,Iy)===0&&ot(Iy,t,wTe),Ec(yC,-It(e),t),mc(yC,yC,-It(r),Iy);const{up:n,direction:s}=i;return ot(n,Iy,t),me(n,n),De(n,n,yC),me(s,t),fa(s,s),De(s,s,yC),i}function RJe(t,e,r,i){const n=Iy,s=px;return me(n,t),ot(px,n,bTe),fe(px,px)===0&&ot(px,n,wTe),ot(s,px,n),mTe(e,r,i,n,s)}function PJe(t,e,r,i){const n={eye:O(),up:null,tilt:i,heading:r},s=Iy;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=It(r),l=It(i),c=Math.sin(a),u=Math.cos(a),d=Math.sin(l),p=Math.cos(l),m=Te(s);let y;if(Math.abs(l)<1e-8)y=o+m;else{const Q=m/d,M=$h(o/Q),I=Math.PI-l-M;y=Q*Math.sin(I)}const _=p*o,v=o*o*(d*d),b=u*u*v,x=y-_,T=x*x,S=b*(b+T-s[1]*s[1]);if(S<0)return te(n.eye,s,y/m),n.tilt=0,W$(n,t);const A=Math.sqrt(S),C=s[1]*x,R=b+T;let P;if(P=u>0?-A+C:A+C,Math.abs(R)<1e-8)return m<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):te(n.eye,s,y/m),n.tilt=0,d9(n.eye),W$(n,t);n.eye[1]=P/R;const F=c*c*v,k=d*o,V=u*k*n.eye[1],z=n.eye[1]*n.eye[1],X=1-z,q=Math.sqrt(X),G=b*z+F-2*V*q*x+X*T;return Math.abs(G)<1e-8?(te(n.eye,s,y/m),n.tilt=0,d9(n.eye),W$(n,t)):(n.eye[0]=(X*(y*s[0]-_*s[0])-k*q*(s[0]*n.eye[1]*u+s[2]*c))/G,n.eye[2]=(X*(y*s[2]-_*s[2])-k*q*(s[2]*n.eye[1]*u-s[0]*c))/G,te(n.eye,n.eye,y),d9(n.eye),W$(n,t))}function d9(t){const e=t[1];t[1]=-t[2],t[2]=e}function W$(t,e){const r=xTe(e,t.heading,t.tilt);return t.up=r.up,t}function MJe(t,e,r){const i=Te(e),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),s=$h(r/(n/Math.sin(t)));return Ka(t-s)}function $Je(t,e,r){const i=It(t),n=Te(e);return $h(r/(n/Math.sin(i)))+i}function TTe(t,e,r,i,n){let s,o,a,l;const c=e.latitude,u=Mr(t.spatialReference).radius,d=e.longitude,p=VYe(c,r,u)/2;s=d-p,o=d+p;const m=It(c),y=(1+Math.sin(m))/(1-Math.sin(m)),_=(y+1)*Math.tan(i/u/2),v=_*_;function b(T){const S=Math.PI/2;return(T=C8e.normalize(T,-S))>S&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*y+v))),l=a+i/u,a=b(a),l=b(l),l<a){const T=l;l=a,a=T}if(a=Math.max(Ka(a),-90),l=Math.min(Ka(l),90),o=OJe.monotonic(s,o),o-s>180){const T=(o-s-180)/2;s+=T,o-=T}const x=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:St.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=x):n=new Dr(s,a,o,l,x),t.spatialReference&&t.spatialReference.isWebMercator&&BA(n,!1,n),n}const IJe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:RJe,eyeForCenterWithHeadingTilt:PJe,eyeTiltToLookAtTilt:$Je,headingTiltToDirectionUp:xTe,lookAtTiltToEyeTilt:MJe,toExtent:TTe},Symbol.toStringTag,{value:"Module"}));function T5(t){return t.type==="point"}let BQ=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function STe(t){return"array"in t}function Af(t,e,r="ground"){if(T5(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(STe(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function SH(t,e){return t!=null&&(e==null||(e===$e.Local?!t.isGeographic||t.isWGS84||t.wkid===fh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===fh.CGCS2000||t.wkid===fh.GCSMARS2000||t.wkid===fh.GCSMARS2000_SPHERE||t.wkid===fh.GCSMOON2000))}const ETe=J.getLogger("esri.views.3d.support.cameraUtils"),CTe=39.37,ATe=96,EH=1,LJe=8,DJe=5,OTe=1,Xse=O(),NJe={heading:0,tilt:0},qy=new ze,FJe=new F_(-20037508342788905e-9,20037508342788905e-9),UJe=new F_(-180,180);var Go;function zP(t){return t.spatialReference||St.WGS84}function $E(t){return t.viewingMode==="global"?IJe:AJe}function kJe(t,e,r,i,n){return $E(t).headingTiltToDirectionUp(e,r,i,n)}function tg(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=$E(t).headingTiltToDirectionUp,n=O();if(!Bi(e.position,n,r))return null;const s=i(n,e.heading,e.tilt);te(s.direction,s.direction,t.state.camera.distance),oe(s.direction,s.direction,n);const o=Gw(t,n,s.direction,s.up);return o.fov=It(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(Go||(Go={}));const fx=O();function GS(t,e,r){const i=t.renderSpatialReference,n=_8(t,e.eye,e.viewForward,e.up,NJe);let s=zP(t);return Cs(e.eye,i,fx,s)||(s=St.WGS84,Cs(e.eye,i,fx,s)),r==null?new vu(new ze(fx,s),n.heading,n.tilt,Ka(e.fov)):(r.position.x=fx[0],r.position.y=fx[1],r.position.z=fx[2],r.position.spatialReference=s,r.heading=n.heading,r.tilt=n.tilt,r.fov=Ka(e.fov),r)}function VQ(t,e,r){const i=t.state.camera,n=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===$e.Global&&r!=null&&(e*=Math.cos(It(r))),e/=t.renderCoordsHelper.unitInMeters,n/(ATe*CTe/e)/Math.tan(i.fovX/2)}function mw(t,e,r){const i=t.state.camera,n=e*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;let o=ATe*CTe/(s/n);return t.renderCoordsHelper.viewingMode===$e.Global&&r!=null&&(o/=Math.cos(It(r))),o*t.renderCoordsHelper.unitInMeters}function RTe(t,e,r,i,n,s){return PTe(t,e,VQ(t,r,e.latitude),i,n,s)}function PTe(t,e,r,i,n,s){if(Ib(s)){const a=new IE(s.signal);return MR(t,i.heading,i.tilt,e,r,n,a),void a.resolver.promise.then(l=>{const c=E5(t,l,i.fov);if(c!=null)return s.resolver.resolve(c);s.resolver.reject()},l=>s.resolver.reject(l))}const o=MR(t,i.heading,i.tilt,e,r,n);return E5(t,o,i.fov,s)}function _8(t,e,r,i,n){return $E(t).directionToHeadingTilt(e,r,i,n)}function zJe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,qy,t.spatialReference)&&t.elevationProvider&&(Af(t.elevationProvider,qy)??0)>(qy.z??0)-OTe)}async function BJe(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,qy,t.spatialReference)||!t.elevationProvider)return!1;const i=qy.z??0;return(await t.elevationProvider.queryElevation(qy.x,qy.y,i,qy.spatialReference,"ground",r)??0)>i-OTe}async function VJe(t,e,r){const i=O();if(e)if(e instanceof ze){if(Bi(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const n=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return n!=null&&t.renderCoordsHelper.setAltitude(i,n),i}}else re(i,e);else re(i,t.state.camera.center);return i}function GJe(t,e){const r=O();if(e&&e instanceof ze){if(Bi(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=Af(t.elevationProvider,e);i!=null&&t.renderCoordsHelper.setAltitude(r,i)}}else re(r,e||t.state.camera.center);return r}function MR(t,e,r,i,n,s,o){const a=i&&i instanceof ze?i:null;if(Ib(o))return VJe(t,i,o.signal).then(c=>{CH(t,e,r,a,c,n,s,o)},c=>o.resolver.reject(c)),null;const l=GJe(t,i);return CH(t,e,r,a,l,n,s,o)}function CH(t,e,r,i,n,s,o,a){if(i==null){const d=t.renderSpatialReference;if((i=Vg(n,d,zP(t)))==null)return null}s=Math.max(s,t.state.constraints.minimumPoiDistance);const l=WJe(t,e,r,n,s,o),c=(0,$E(t).eyeForCenterWithHeadingTilt)(n,s,l.heading,l.tilt);if(o===Go.ADJUST&&t.viewingMode==="global"&&r>0){const d=()=>{const m=MTe(t,n,s,XJe(t,s,r,n));return o=r-m<1?Go.LOCKED:Go.ADJUST,CH(t,e,m,i,n,s,o,a)},p=t.map.ground.navigationConstraint;if(!p||p.type==="stay-above"){if(zJe(t,c.eye))return d();if(Ib(a))return BJe(t,c.eye,a.signal).then(m=>m?d():(a.resolver.resolve({eye:c.eye,up:c.up,center:ki(n),heading:c.heading,tilt:c.tilt}),null)),null}}const u=!a||Ib(a)?{center:O(),eye:O(),up:O(),tilt:0,heading:0}:a;return u.eye=c.eye,u.up=c.up,u.center=ki(n),u.heading=c.heading,u.tilt=c.tilt,Ib(a)&&a.resolver.resolve(u),u}function nO(t,e,r,i,n,s=null){let o,a,l;if(t.state.isGlobal){if(!SH(e.spatialReference,$e.Global))return Ib(s)&&s.resolver.reject(),null;const v=new ze(e.xmin,e.ymin,e.spatialReference),b=new ze(e.xmax,e.ymax,e.spatialReference),x=e.spatialReference.isGeographic?UJe:FJe;o=new ze({x:x.center(v.x,b.x),y:(b.y+v.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const T=Mr(e.spatialReference),S=BYe(o,v,b);a=S.lon,l=S.lat,x.diff(v.x,b.x)>x.range/2&&(a+=T.halfCircumference),a=Math.min(a,T.halfCircumference),l=Math.min(l,T.halfCircumference)}else{const v=t.renderSpatialReference??e.spatialReference;v.equals(e.spatialReference)||(e=xE(e,v)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const b=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new ze({x:e.xmin+.5*a,y:e.ymin+.5*l,z:b,spatialReference:v})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,u=t.state.camera,d=1/Math.tan(u.fovX/2),p=1/Math.tan(u.fovY/2),m=1/Math.tan(u.fov/2),y=Math.max(.5*a*d,.5*l*p,.5*c*m)/EH;if(Ib(s)){const v=new IE(s.signal);return MR(t,r,i,o,y,n,v),void v.resolver.promise.then(b=>{const x=E5(t,b,t.camera.fov);if(x!=null)return s.resolver.resolve(x);s.resolver.reject()},b=>s.resolver.reject(b))}const _=MR(t,r,i,o,y,n);return E5(t,_,t.camera.fov,s)}function jJe(t,e,r){const i=t.renderSpatialReference,n=Vg(r,i,zP(t));if(n==null)return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=gP(e.eye,r),l=2*a*s*EH,c=2*a*o*EH;return t.viewingMode==="global"?TTe(t,n,l,c):vTe(t,n,l,c)}function HJe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>LJe)return!0;const n=t.renderSpatialReference,s=zP(t),o=Vg(e,n,s),a=Vg(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>DJe}function WJe(t,e,r,i,n,s){let o=0;return s===Go.ADJUST&&HJe(t,i,n)?(e=0,o=qJe(t,n,r,i)):o=GQ(t,i,n,r),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:r=MTe(t,i,n,o)}}const S5=.7;function qJe(t,e,r,i){const n=GQ(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-S5)+s.max*S5;return Math.min(n,o)}function XJe(t,e,r,i){let n=GQ(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-S5)+n*S5}function MTe(t,e,r,i){return $E(t).lookAtTiltToEyeTilt(i,e,r)}function GQ(t,e,r,i){return $E(t).eyeTiltToLookAtTilt(i,e,r)}function E5(t,e,r,i){if(e==null)return null;const n=t.renderSpatialReference,s=Vg(e.eye,n,zP(t));return s==null?null:i!=null?(i.position=s,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new vu(s,e.heading,e.tilt,r)}function YJe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);ETe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function $Te(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);ETe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function ITe(t,e){return Cs(e.center,t.renderSpatialReference,Xse,St.WGS84),mw(t,e.distance,Xse[1])}let IE=class{constructor(e){this.signal=e,this.resolver=Wo()}};function Ib(t){return t&&"resolver"in t}const ZJe=.66;function LTe(t){return 360-MY.normalize(t)}function v8(t){return MY.normalize(360-t)}function _C(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function QJe(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function DTe(t,e,r,i=null){if(!e)return _C(i);const n=t.spatialReference||St.WGS84;if(e.camera!=null){const c=$w(e.camera.position,n);if(c==null)return _C(i);const u=e.camera.clone();return u.position=c.clone(),QJe(i,u)}if(e.targetGeometry==null)return _C(i);const s=e.get("targetGeometry.spatialReference");if(s&&!T_(s,n))return _C(i);const o=GS(t,t.state.camera);let a=Go.ADJUST;if(e.rotation!=null&&(o.heading=LTe(e.rotation),a=Go.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let u;const d=e.targetGeometry.clone();return u=e.scale!=null?VQ(t,e.scale,c.latitude):t.state.camera.distance,PTe(t,d,u,o,a,i)}const l=e.targetGeometry.extent;return l?nO(t,l,o.heading,o.tilt,a,i):_C(i)}function JJe(t,e,r=null){return r==null&&(r=new hp),WQ(t,null,e.clone(),r)}async function KJe(t,e,r){const i=cKe(t,e);if(!i)throw new Y("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new vu({fov:t.camera.fov}),s=new hp({camera:n});if(i.target instanceof hp)return $1(await rKe(t,i.target,i,r,s));if(i.target instanceof vu)return $1(FTe(t,i.target,s));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof Dr){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return $1(o||c?await AH(t,i,i.target.center,n,r,s):await oKe(t,i,i.target,n,r,s))}const a={boundingBox:vi(),hasZ:!1,screenSpaceObjects:[]},l=o?eKe(t,i):void 0;if(await NTe(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(jd(a.boundingBox,Cn),Yc.x=Cn[0],Yc.y=Cn[1],Yc.z=Cn[2],Yc.spatialReference=t.spatialReference,isFinite(Yc.z)&&a.hasZ?c=QY(a.boundingBox):(Yc.z=void 0,c=l8e(ZY(a.boundingBox,hKe))),o||c)return $1(await AH(t,i,Yc,n,r,s));const u=uKe(t,a.screenSpaceObjects);return $1(await lKe(t,i,Yc,a.boundingBox,u,n,r,s))}return i.position?$1(nKe(t,i,n,s)):$1(await sKe(t,i,n,r,s))}function jQ(t,e){return e.scale==null&&e.zoom!=null?$Te(t,e.zoom):e.scale}function eKe(t,e){const r=jQ(t,e);return r?y7e(r):void 0}function HQ(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=LTe(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function WQ(t,e,r,i){const n=t.spatialReference||St.WGS84;return(e=e??tg(t,r))==null||(i.targetGeometry=Vg(e.center,t.renderSpatialReference,n),i.scale=ITe(t,e),i.rotation=v8(r.heading),i.camera=r),i}function C5(t,e,r){var a,l;const i=()=>new Y("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!T_(e.spatialReference,t.spatialReference))throw new Y("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const n=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&t.basemapTerrain.spatialReference!=null&&T_(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?Cn[2]=Af(t.elevationProvider,c)??0:Cn[2]=0}(0,dKe[e.type])(e,c=>{n.push(c[0],c[1],c[2])},Cn);const s=n.length/3;if(s===0)throw i();const o=new Array(n.length);if($i(n,e.spatialReference,0,o,t.spatialReference,0,s)){e.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(Cn[0]=o[c],Cn[1]=o[c+1],Cn[2]=o[c+2]):(Cn[0]=o[c],Cn[1]=o[c+1]),Xf(r.boundingBox,Cn)}}async function tKe(t,e,r,i){const n=await Ng(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void C5(t,e.geometry,i);const s=n.value,o=await Ng(s.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void C5(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;SS(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function NTe(t,e,r,i){var n;if(Array.isArray(e)&&e.length===2){const s=e[0],o=e[1];if(typeof s=="number"&&typeof o=="number")return Yc.x=s,Yc.y=o,Yc.z=void 0,Yc.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:St.WGS84,void C5(t,Yc,i)}e&&"map"in e&&typeof e.map=="function"?await o1(e.map(s=>NTe(t,s,r,i))):e instanceof Zg?C5(t,e,i):e instanceof z_&&await tKe(t,e,r,i)}async function rKe(t,e,r,i,n){if(e.camera!=null)return FTe(t,e.camera,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,r.heading!=null?n.rotation=v8(r.heading):r.rotation!=null&&(n.rotation=r.rotation);const s=jQ(t,r);s!=null&&(n.scale=s);const o=new IE(i);return DTe(t,n,r.tilt,o),n.camera=await o.resolver.promise,n}function FTe(t,e,r){const i=t.spatialReference,n=$w(e.position,i);return n==null?null:((e=e.clone()).fov=t.camera.fov,e.position=n,WQ(t,null,e,r))}function iKe(t,e,r,i,n,s){const o=t.renderSpatialReference;return Bi(r,X$,o),Bi(e,p9,o),s.targetGeometry=new ze(e),n.position=new ze(r),ae(A5,p9,X$),_8(t,X$,A5,i.up,n),s.scale=mw(t,ci(X$,p9),s.targetGeometry.latitude),s.rotation=v8(n.heading),s.camera=n,s}async function AH(t,e,r,i,n,s){if(r==null)throw new Y("createfromcenter","invalid point");s.targetGeometry=r.clone();const o=Gw(t);if(e.position)return iKe(t,s.targetGeometry,e.position,o,i,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=te(Cn,o.viewForward,-l);o.eye=oe(Cn,o.center,c),s.scale=mw(t,l,r.latitude)}GS(t,o,i);const a=HQ(i,e)?Go.LOCKED:Go.ADJUST;if(!e.zoomFactor){const l=jQ(t,e);l==null?(Bi(r,Cn,t.renderSpatialReference),Bxe(o.frustum,Cn)?s.scale=mw(t,ci(o.eye,Cn),r.latitude):s.scale=ITe(t,o)):s.scale=l;const c=new IE(n);RTe(t,s.targetGeometry,s.scale,i,a,c),s.camera=await c.resolver.promise}return s}function nKe(t,e,r,i){const n=Gw(t);return re(A5,n.viewForward),_8(t,n.eye,A5,n.up,f9),r.position=new ze(e.position),r.heading=e.heading!=null?e.heading:f9.heading,r.tilt=e.tilt!=null?e.tilt:f9.tilt,WQ(t,null,r,i)}async function sKe(t,e,r,i,n){const s=Gw(t);return AH(t,e,Vg(s.center,t.renderSpatialReference,t.spatialReference),r,i,n)}async function oKe(t,e,r,i,n,s){s.targetGeometry=r.clone();const o=Gw(t);GS(t,o,i);const a=HQ(i,e)?Go.LOCKED:Go.ADJUST,l=new IE(n);return nO(t,r,i.heading,i.tilt,a,l),s.camera=await l.resolver.promise,s}function aKe(t,e,r,i,n){let s=0;r.z!=null?s=r.z:t.basemapTerrain&&t.elevationProvider&&(s=Af(t.elevationProvider,r)),ne(Cn,r.x,r.y,s),ma(t.spatialReference,Cn,Yse,t.renderSpatialReference),Ac(q$,Yse),Uh(q$,q$),vi(vC);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const _=o[y];let v=i[_[2]];isFinite(v)||(v=s),ne(Cn,i[_[0]],i[_[1]],v),Cs(Cn,t.spatialReference,Cn,t.renderSpatialReference),Xf(vC,zo(Cn,Cn,q$))}const a=Dw(vC),l=c1(vC),c=Nw(vC),u=1/Math.tan(e.fovX/2),d=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(d,u)+.5*l,m=.5*l*d+.5*Math.max(a,c);return Math.max(p,m)/n}async function lKe(t,e,r,i,n,s,o,a){a.targetGeometry=r.clone();const l=Gw(t),c=aKe(t,l,r,i,n);GS(t,l,s);const u=HQ(s,e)?Go.LOCKED:Go.ADJUST;a.scale=mw(t,c,a.targetGeometry.latitude);const d=new IE(o);return RTe(t,a.targetGeometry,a.scale,s,u,d),a.camera=await d.resolver.promise,a}function cKe(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function $1(t){return t&&t.camera!=null&&(t.rotation=v8(t.camera.heading)),t}function uKe(t,e){const r=ZJe;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return r-i/Math.min(t.width,t.height)*2}const Cn=O(),Yse=_e(),q$=hi(),vC=ps(),hKe=jt(),A5=O(),X$=O(),p9=O(),f9={heading:0,tilt:0},Yc=new ze,dKe={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,n=t.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(ne(r,t.xmin,t.ymin,t.zmin)),e(ne(r,t.xmax,t.ymin,t.zmin)),e(ne(r,t.xmin,t.ymax,t.zmin)),e(ne(r,t.xmax,t.ymax,t.zmin)),e(ne(r,t.xmin,t.ymin,t.zmax)),e(ne(r,t.xmax,t.ymin,t.zmax)),e(ne(r,t.xmin,t.ymax,t.zmax)),e(ne(r,t.xmax,t.ymax,t.zmax))):(e(ne(r,t.xmin,t.ymin,r[2])),e(ne(r,t.xmax,t.ymin,r[2])),e(ne(r,t.xmin,t.ymax,r[2])),e(ne(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let n=0;n<i.length;n+=3)e(ne(r,i[n],i[n+1],i[n+2]))}};let pKe=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;this.options.signal!=null&&pa(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(wr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await uR(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,KJe(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var s;const r=!!(this.target instanceof hp&&this.target.camera||this.target instanceof vu),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this.reject(new Y("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const n=tg(this.view,i);return n==null?(this.reject(new Y("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new Y("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let n;e.isFullySpecified?(n=new iO({view:this.view,desiredCamera:e.camera}),PE(this.view,e.camera,xh.EYE_AND_CENTER)):Rn(this.view,e.camera),r.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof mg&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(r.state){case Wi.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Wi.Ready:case Wi.Rejected:case Wi.Running:case Wi.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(s,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof mg&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new mg({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new Y("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},gs=class extends xe{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=GS(this.view,this.view.state.camera,m9);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(tg(this.view,e),{applyConstraints:!1})||J.getLogger(this).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=GS(this.view,this.view.state.contentCamera,m9);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=tg(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(g9),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,n=na(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([ue(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(g9),this.test.contentCameraResetState.clear())}),ue(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),ue(()=>this.view.state.camera,o=>{const a=wo(n,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],g9),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():J.getLogger(this).error("#center=","Invalid center",e):J.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):J.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=jJe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#extent=","Invalid extent",e):J.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):J.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return mw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,n=this._get("padding"),s=Math.round(r[Yt.TOP]/i),o=Math.round(r[Yt.RIGHT]/i),a=Math.round(r[Yt.BOTTOM]/i),l=Math.round(r[Yt.LEFT]/i);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,Y$),this.view.state.updateCamera(r=>r.padding=Y$))}_paddingToArray(e,r,i){e?gi(i,e.top||0,e.right||0,e.bottom||0,e.left||0):gi(i,0,0,0,0);for(let n=0;n<4;n++)i[n]=Math.round(i[n]*r)}get screenCenter(){const e=this.padding;return Lh((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?JJe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||J.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,n=i!=null&&i.spatialReference;J.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else J.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?YJe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||J.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return _b(this._tmpCanvasSize,i)?this._tmpCanvasSize.pixelRatio=r:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(Hn.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(Hn.PhysicalPixelRendering,Cr.IDLE)||e.isFeatureEnabled(Hn.PhysicalPixelRendering,Cr.INTERACTING)||e.isFeatureEnabled(Hn.PhysicalPixelRendering,Cr.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new jg({frustum:Wy},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new fKe}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Ol(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),Br)]),Dh(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([fS({prepare:()=>this._prepareFrame()}),ue(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(Z$)}),Ol(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Me(this._propertiesPool)}init(){this.constraintsManager=new K3({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===$e.Local&&this.addHandles(Dh(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(Z$),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),Z$)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(Z$),this.constraintsManager=Me(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new pKe(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Gw(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(n=>i.stepController(e,n)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:n}of gKe){const s=e.has(i),o=this._isOverridden(i);!s&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||o)&&n.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof vu)return void this.setStateCamera(tg(this.view,e),{applyConstraints:!1});if(e instanceof hp){if(e.targetGeometry instanceof Dr){const s=nO(this.view,e.targetGeometry,0,.5,Go.LOCKED);return void(s!=null&&this.setStateCamera(tg(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,i)}const r=nO(this.view,e,0,.5,Go.LOCKED);r!=null&&this.setStateCamera(tg(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&mKe.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof hp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof vu?this.isCompatible(e.position):e.spatialReference&&T_(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=yKe){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=M0){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=MR(this.view,n,s,e,r,Go.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),n=nO(this.view,e,r,i,Go.ADJUST,m9);return n?tg(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,n=r.location.latitude;if(n==null)return null;const s=VQ(this.view,e,n);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera($Te(this.view,e))}_viewpointToCamera(e){return tg(this.view,DTe(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&Rn(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new iO({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===i.width&&n.fullHeight===i.height&&n.pixelRatio===i.pixelRatio||(M0.copyFrom(n),M0.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,Y$),M0.padding=Y$),M0.fullWidth=i.width,M0.fullHeight=i.height,M0.pixelRatio=i.pixelRatio,this.view.state.camera=M0),this._updateViewState()}}_updateElevation(e){var s;const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=((s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))??0,n=r?p8(this.view,e.eye):0;e.relativeElevation=i-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Cr.ANIMATING:this.view.interacting?this.view.state.mode=Cr.INTERACTING:(this.view.state.mode===Cr.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=_Ke?this.view.state.mode=Cr.INTERACTING:this.view.state.mode=Cr.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([f({type:vu,dependsOn:["view.state.camera","ready"]})],gs.prototype,"camera",null),h([f({type:vu,dependsOn:["view.state.contentCamera","ready"]})],gs.prototype,"contentCamera",null),h([f({type:ze})],gs.prototype,"center",null),h([f({type:Dr})],gs.prototype,"extent",null),h([f({readOnly:!0})],gs.prototype,"frustum",null),h([f({readOnly:!0})],gs.prototype,"hasInitialView",null),h([f({readOnly:!0,type:Boolean})],gs.prototype,"ready",void 0),h([f({type:Number})],gs.prototype,"scale",null),h([f()],gs.prototype,"padding",null),h([f({readOnly:!0})],gs.prototype,"screenCenter",null),h([f({constructOnly:!0})],gs.prototype,"view",void 0),h([f({type:hp})],gs.prototype,"viewpoint",null),h([f({type:Number})],gs.prototype,"zoom",null),h([f({readOnly:!0})],gs.prototype,"_rasterPixelRatio",null),h([f({readOnly:!0})],gs.prototype,"_usePhysicalPixelRendering",null),h([f({readOnly:!0})],gs.prototype,"_usePhysicalPixelRenderingAny",null),h([f()],gs.prototype,"_windowDevicePixelRatio",void 0),h([f()],gs.prototype,"_devicePixelRatioOverride",void 0),gs=h([N("esri.views.3d.state.ViewStateManager")],gs);let fKe=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const mKe=["camera","viewpoint","extent","scale","center","zoom"],gKe=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],yKe={heading:0,tilt:0},m9=new vu,M0=new lt,Y$=Qt(),Z$="pending-initial-view",g9="content-camera-reset",_Ke=300,Zse=100;let Of=class extends sg{constructor(){super(...arguments),this.startCamera=new lt,this.currentCamera=new lt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Zse}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=Wi.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Zse),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([f({readOnly:!0})],Of.prototype,"isInteractive",null),h([f()],Of.prototype,"_lastInteraction",void 0),Of=h([N("esri.views.3d.state.controllers.InteractiveController")],Of);var nc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(nc||(nc={}));let sO=class extends Of{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=nc.CENTER,this._rotScale=0,this._lastPoint=Ne(),this._tmpWorldUp=O(),this._tmpViewDir=O(),this._tmpRotCurPoint=Ne(),this._tmpTransf=_e(),this._tmpAxis=O(),this._tmpPivotPoint=O(),this._pivotPos=O(),this._constraintOptions={selection:Ci.ALL,interactionType:Wt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Qs.TUMBLE}}initialize(){this._rotScale=this.pivot===nc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case nc.EYE:re(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Wt.LOOK_AROUND,this._constraintOptions.tiltMode=Qs.LOOK_AROUND,this._constraintOptions.selection=Ci.NONE;break;case nc.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?jw:{});r||re(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Wt.TUMBLE,this._constraintOptions.tiltMode=Qs.TUMBLE,this._constraintOptions.selection=Ci.ALL&~Ci.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,$b(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,n=O();ae(n,this._pivotPos,i.eye);const s=Te(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Qse);let a=Math.max(Math.min(KQe,1/Math.abs(fe(Qse,i.viewForward)))*o,eJe);r&&(a=Math.min(s,a));const l=Mr(this.view.spatialReference),c=Xi(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),u=y8(this.startCamera,c,l);let d=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*a9,a9),p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,a9);d==null&&p==null||(d=d??p??0,p=p==null||u===Xs.Horizontal?d:p,a=d>p?p:d,a=r?Math.min(a,s):a),me(n,n),re(this._pivotPos,oe(this._tmpPivotPoint,i.eye,te(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case nc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case nc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Rn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),$b(e,r,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ae(this._tmpViewDir,i,n);const a=Te(this._tmpViewDir),l=As(fe(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===nc.EYE){s*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;s=c-Math.max(-u,Math.min(u,c+s))}return s=ge(s+l,$o.min,$o.max)-l,ot(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===nc.CENTER&&(o=-o),Ec(this._tmpTransf,o,this._tmpWorldUp),mc(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),De(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=De(y9,e.up,this._tmpTransf),oe(y9,n,this._tmpViewDir),fs(this._lastPoint,this._tmpRotCurPoint),y9}};h([f()],sO.prototype,"pivot",void 0),sO=h([N("esri.views.3d.state.controllers.RotateController")],sO);const y9=O(),Qse=O();let _9=class extends Eo{constructor(e,r,i,n){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!kQ(e.data,this.pointerAction))return;const i=Xi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new sO({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},OH=class extends Of{constructor(){super(...arguments),this._pickPoint=O(),this._tmpP0=Ne(),this._panAxisAngle=m8(),this._tmpRayDir=O(),this._tmpRayDirPick=O(),this._targetOnSphere=O(),this._navMode=Xs.Horizontal,this._tmpRay={origin:O(),direction:O()},this.dragBeginPoint=Xi(),this._normalizedAnchorPoint=Ne(),this._constraintOptions={selection:Ci.ALL_EXCEPT_COLLISION,interactionType:Wt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Qs.TUMBLE},this._sphere=vn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;fs(this.dragBeginPoint,e),$b(this.startCamera,e,this._normalizedAnchorPoint);const r=Mr(this.view.spatialReference),i=oTe(this._intersectionHelper,this.startCamera,e,r,VS.Ellipsoid,this.view.map.ground.opacity===0?jw:{});if(this._navMode=y8(this.startCamera,e,r),this._navMode===Xs.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let n;ME(this.startCamera,e,this._tmpRay),me(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(ae(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),n=Te(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Jse);let o=ge(Math.min(J2e,1/Math.abs(fe(Jse,this._tmpRay.direction)))*s,y5[0],y5[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,g8);o=a??o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,te(this._tmpRay.direction,this._tmpRay.direction,o),oe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===Xs.Horizontal){ae(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Te(this._tmpRayDir);$b(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;if(this._hasPickPoint&&n<r){const o=1-(1-n/r)*(1-this._sphere[3]/Te(this.currentCamera.center));this.currentCamera.center=te(Q$,this.currentCamera.center,o)}te(this._tmpRayDir,this._tmpRayDir,-n/r),this.currentCamera.eye=oe(Q$,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=zd(cw(this.dragBeginPoint,e)),Rn(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(PR(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),IQ(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Q_(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Te(this._tmpRay.direction);$b(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;te(this._tmpRayDir,this._tmpRay.direction,1-n/r),this.currentCamera.eye=oe(Q$,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=oe(Q$,this.currentCamera.center,this._tmpRayDir)}PE(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};OH=h([N("esri.views.3d.state.controllers.global.ZoomController")],OH);const Q$=O(),Jse=O();let RH=class extends Of{constructor(){super(...arguments),this._tmpP=O(),this._tmpDir=O(),this._tmpN=O(),this._tmpP0=Ne(),this._tmpPoi=O(),this._tmpRayDir=O(),this.dragBeginPoint=Xi(),this._normalizedAnchorPoint=Ne(),this._constraintOptions={selection:Ci.ALL,interactionType:Wt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:O(),tiltMode:Qs.TUMBLE},this._plane=Er()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;fs(this.dragBeginPoint,e),$b(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?jw:{});ae(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Te(this._tmpDir);me(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=ge(Math.min(J2e,1/Math.abs(fe(vKe,this._tmpDir)))*n,y5[0],y5[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,g8);s=o??s,s=r?Math.min(s,i):s,te(this._tmpDir,this._tmpDir,s),oe(this._tmpP,this.startCamera.eye,this._tmpDir),ae(this._tmpN,this.startCamera.eye,this.startCamera.center),me(this._tmpN,this._tmpN),this._tmpN[1]<0&&fa(this._tmpN,this._tmpN),MP(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;tJe(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||re(this._tmpPoi,this.currentCamera.center),$b(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);fs(this._normalizedAnchorPoint,this._tmpP0),ae(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Te(this._tmpRayDir);let n=i*(1-r);this._constraintOptions.interactionDirection&&(re(this._constraintOptions.interactionDirection,this._tmpRayDir),te(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const s=this.view.state.constraints.minimumPoiDistance;r>=0&&n<s&&(n=s,r=-(n-i)/i),Math.abs(i-n)<1e-6||(te(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=oe(I1,this.currentCamera.eye,this._tmpRayDir),Lr(I1,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?I1[2]=Math.max(this.startCamera.center[2],I1[2]):I1[2]=Math.min(this.startCamera.center[2],I1[2]),this.currentCamera.center=I1,this._constraintOptions.interactionFactor=zd(cw(this.dragBeginPoint,e)),Rn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};RH=h([N("esri.views.3d.state.controllers.local.ZoomController")],RH);const I1=O(),vKe=Se(0,0,1);let bKe=class extends Eo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!kQ(e.data,this.pointerAction))return;const i=Xi(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new OH({view:this._view}):this._cameraController=new RH({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function td(t){let e=t*t;return t<0&&(e*=-1),e}function Kse(t,e,r){const i=r,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(i.translation[0]=td(n.axes[0]),i.translation[1]=td(n.axes[1]),i.translation[2]=td(n.buttons[7])-td(n.buttons[6]),i.heading=td(n.axes[2]),i.tilt=td(n.axes[3])):s.deviceType==="spacemouse"&&(i.translation[0]=1.2*td(n.axes[0]),i.translation[1]=1.2*td(n.axes[1]),i.translation[2]=2*-td(n.axes[2]),i.heading=1.2*td(n.axes[5]),i.tilt=1.2*td(n.axes[3])),i.tilt*=o,te(i.translation,i.translation,a),i}function eoe(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function v9(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let vb=class extends Of{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new lt,this._headingStart=0,this._constraintOptions={selection:Ci.ALL,interactionType:Wt.NONE,interactionStartCamera:new lt,interactionFactor:0,interactionDirection:null,tiltMode:Qs.LOOK_AROUND}}handleEventGamepad(e){const r=Kse(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||v9(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,eoe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=eoe(this._keysButtonState,this._transformation);v9(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,L1),this._applyDisabledMovementTypes(L1),this._applyPan(L1.pan),this._applyRotate(L1.rotate),this._applyZoom(L1.zoom),this._applyAscend(L1.ascend),this._constraintOptions.interactionType=Wt.NONE,this._constraintOptions.selection=Ci.COLLISION,Rn(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;ae(nl,r.center,r.eye),De(nl,nl,e.matrix),r.center=oe(nl,nl,r.eye),r.up=De(nl,r.up,e.matrix),this._constraintOptions.interactionType=Wt.LOOK_AROUND,this._constraintOptions.selection=Ci.ALL_EXCEPT_COLLISION,Rn(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=De(nl,r.eye,e.matrix),r.center=De(nl,r.center,e.matrix),this.view.state.isGlobal&&(r.up=De(nl,r.up,e.matrix)),this._constraintOptions.interactionType=Wt.PAN,this._constraintOptions.selection=Ci.ALL,Rn(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=oe(nl,this.currentCamera.eye,te(Ie.get(),r,e)),re(bC,r),fa(bC,bC),this._constraintOptions.interactionDirection=bC,this._constraintOptions.interactionType=Wt.ZOOM,this._constraintOptions.selection=Ci.ALL_EXCEPT_COLLISION,Rn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ie.get());if(this._constraintOptions.interactionDirection=re(bC,r),this.view.state.isGlobal){const i=Te(this.currentCamera.eye),n=(i+e)/i;this.currentCamera.eye=te(nl,this.currentCamera.eye,n),this.currentCamera.center=te(nl,this.currentCamera.center,n)}else{const i=te(Ie.get(),r,e);this.currentCamera.eye=oe(nl,this.currentCamera.eye,i),this.currentCamera.center=oe(nl,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=Wt.ASCEND,this._constraintOptions.selection=Ci.COLLISION,Rn(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Ci.ALL_EXCEPT_COLLISION,Rn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){AKe(i);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,r,i):this._calculateControlTransformationGlobal(n,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,nl)}_calculateControlTransformationLocal(e,r,i){const{viewRight:n,viewForward:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=ne(Ie.get(),s[0],s[1],0);me(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=te(Ie.get(),n,c);Ml(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=te(Ie.get(),l,_);Ml(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;i.ascend=u;const d=-o.heading*e.rotate;d!==0&&(mc(i.rotate.matrix,i.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Ie.get())),i.rotate.enabled=!0);const p=o.tilt*e.rotate,m=Z_(this.view.renderCoordsHelper,r.center,r.eye),y=ge(m+p,$o.min,$o.max)-m;y&&(mc(i.rotate.matrix,i.rotate.matrix,y,n),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:n,viewRight:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=ot(Ie.get(),s,n);me(l,l),fa(l,l),aJe(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(L1.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;i.ascend=u;const d=-o.heading*e.rotate;d!==0&&(mc(i.rotate.matrix,i.rotate.matrix,d,this._tmpCamera.eye),i.rotate.enabled=!0);const p=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(p,r.ray,c);m!==0&&(mc(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const n=Mr(this.view.spatialReference),s=kD($o.min,r.origin,i,n);let o=0,a=0;const l=Ie.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=Z_(this.view.renderCoordsHelper,l,r.origin);o=kD(c,r.origin,i,n),a=kD($o.max,r.origin,i,n)}else{EE(z6(B6,i+n.radius),r,l);const c=Math.PI+k6(r.direction,l);o=Nse(c,r.origin,i,n),a=Nse($o.max,r.origin,i,n)}return ge(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=r+Math.abs(s-r);return n.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:n}=this.view.state,{direction:s}=kJe(this.view,r,0,UTe,CKe),o=i.intersectManifoldClosestSilhouette(bu(r,s),e,Ie.get()),a=ci(r,o),l=i.intersectManifoldClosestSilhouette(bu(r,Qg(Ie.get(),r,n.center)),e,Ie.get()),c=ci(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:n,isGlobal:s}=i,o=r.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,Ie.get());if(s){const a=ae(Ie.get(),e,o),l=Te(a);te(a,a,1/l);const c=me(Ie.get(),e),u=As(fe(c,a));return l*Math.sin(Math.min(xKe,u))}{const a=re(Ie.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),ci(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:TKe}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Mr(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=Ie.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=n.width/2,u=toe*n.width,d=toe*n.width,p=l*Math.tan(.5*n.fovX)/c,m=p/i,y=p/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(s?m:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*_-_),zoom:2**(u*e/c)*l-l,rotate:ge(y*d,SKe,EKe)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Nh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Nh(e.rotate.matrix))}static activatesFor(e,r){const i=Kse(r,e.navigation.gamepad,wKe);return!(r.action==="end"||v9(i))}};h([f({constructOnly:!0})],vb.prototype,"gamepadDevice",void 0),h([f({constructOnly:!0})],vb.prototype,"disableMovements",void 0),vb=h([N("esri.views.3d.state.controllers.GamepadKeyboardController")],vb);const wKe={translation:[0,0,0],heading:0,tilt:0,zoom:0},UTe=80,xKe=It(UTe),toe=.75,TKe=5,SKe=It(30),EKe=It(80),L1={zoom:0,ascend:0,pan:{enabled:!1,matrix:_e()},rotate:{enabled:!1,matrix:_e()}},nl=O(),bC=O(),CKe=zQ();function AKe(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Nh(t.pan.matrix),t.rotate.enabled=!1,Nh(t.rotate.matrix)}let OKe=class extends Eo{constructor(e){super(!0),this._view=e,this._watchHandles=new Vi,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([ue(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},Pr),ue(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||vb.activatesFor(this._view,e.data)){if(!i){const n=new vb({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Ql;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Ql||(Ql={}));let RKe=class extends Eo{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:$e.Local},this._keyToNumber={[r.left]:Ql.LEFT,[r.right]:Ql.RIGHT,[r.forward]:Ql.FORWARD,[r.backward]:Ql.BACKWARD,[r.up]:Ql.UP,[r.down]:Ql.DOWN,[r.headingLeft]:Ql.HEADINGLEFT,[r.headingRight]:Ql.HEADINGRIGHT,[r.tiltUp]:Ql.TILTUP,[r.tiltDown]:Ql.TILTDOWN,[r.zoomIn]:Ql.ZOOMIN,[r.zoomOut]:Ql.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new vb({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},PKe=class extends Eo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new w5({view:this._view,mode:"interaction"}):new x5({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Xi(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},O5=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},gw=class extends OR{constructor(){super(...arguments),this._beginCamera=new lt,this._elapsedTimeSec=0,this.constraintOptions={selection:Ci.ALL,interactionType:Wt.PAN,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Qs.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new DS}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),Rn(this.view,r,this.constraintOptions)}};gw=h([N("esri.views.3d.state.controllers.momentum.MomentumController")],gw);let oO=class extends gw{constructor(e){super(e),this.interactionType=Wt.PAN,this._tmpPan=O()}momentumStep(e,r){const i=this.momentum.value(e);te(this._tmpPan,this.momentum.direction,i),r.eye=ae(roe,r.eye,this._tmpPan),r.center=ae(roe,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([f({constructOnly:!0})],oO.prototype,"momentum",void 0),oO=h([N("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],oO);const roe=O(),MKe=O(),J$=O();let BD=class extends gw{constructor(e){super(e),this.interactionType=Wt.PAN}momentumStep(e,r){const i=this.momentum.value1(e),n=this.momentum.value2(e);re(J$,r.eye),me(J$,J$),ot(this.momentum.axis2,J$,this.momentum.axis1),uTe(r,MKe,this.momentum.axis1,i,this.momentum.axis2,n)}};h([f({constructOnly:!0})],BD.prototype,"momentum",void 0),BD=h([N("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],BD);let ib=class extends gw{set center(e){this._set("center",ki(e))}set axis(e){this._set("axis",ki(e))}constructor(e){super(e),this.interactionType=Wt.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);Q_(r,this.center,RR(this.axis,i))}};h([f({constructOnly:!0})],ib.prototype,"momentum",void 0),h([f({constructOnly:!0})],ib.prototype,"center",null),h([f({constructOnly:!0})],ib.prototype,"axis",null),ib=h([N("esri.views.3d.state.controllers.momentum.MomentumController")],ib);let pT=class extends gw{set zoomCenter(e){this._set("zoomCenter",ki(e))}constructor(e){super(e),this.interactionType=Wt.ZOOM,this.constraintOptions.interactionDirection=O()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;re(i,r.eye);const n=this.momentum.valueDelta(0,e);NQ(r,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),Qg(i,r.eye,i)}};h([f({constructOnly:!0})],pT.prototype,"momentum",void 0),h([f({constructOnly:!0})],pT.prototype,"zoomCenter",null),pT=h([N("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],pT);let $v=class extends gw{set screenCenter(e){this._set("screenCenter",Xi(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",ki(e))}constructor(e){super(e),this.interactionType=Wt.ZOOM,this.radius=0,this._tmpSceneCenter=O(),this._tmpZoomAxisAngle=m8(),this._sphere=vn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);nTe(this._sphere,r,i),this.constraintOptions.interactionType=Wt.ZOOM,Rn(this.view,r,this.constraintOptions),PR(this._sphere,r,this.screenCenter,this._tmpSceneCenter),IQ(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Q_(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Wt.PAN}};h([f({constructOnly:!0})],$v.prototype,"momentum",void 0),h([f({constructOnly:!0})],$v.prototype,"screenCenter",null),h([f({constructOnly:!0})],$v.prototype,"sceneCenter",null),h([f({constructOnly:!0})],$v.prototype,"radius",void 0),$v=h([N("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],$v);let Bd=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},b8=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},$Ke=class extends b8{constructor(e,r,i,n,s){super(e,r,i),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},kTe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Bd(.6),this._screen=[new Bd(.4),new Bd(.4)],this._scene=[new Bd(.6),new Bd(.6),new Bd(.6)],this._tmpDirection=O()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=n==null||i==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){ne(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=Te(this._tmpDirection);n>0&&te(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new $Ke(e,r,i,s==null?0:n/s,this._tmpDirection)}},ioe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const noe=1e-5;let IKe=class extends b8{constructor(e,r,i,n,s,o=0,a){super(e,r,i),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},LKe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=O(),this._tmpAxis2=O(),this._tmpAngles=Ne(),this._time=new Bd(.3),this._screen=[new Bd(.4),new Bd(.4)],this._angle1=new ioe(.6),this._angle2=new ioe(.6),this._axis1=O(),this._axis2=O(),this._lastScene=O()}addMomentumDirectRotation(e,r,i,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=lTe(this._lastScene,r,this._tmpAxis2,n,s,o);this._angle2.update(0),la(this._tmpAxis2)<noe?a=0:me(this._axis1,this._tmpAxis2),this._angle1.update(a),re(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;cTe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),la(this._tmpAxis2)<noe?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),me(this._axis1,this._tmpAxis1),me(this._axis2,this._tmpAxis2)),re(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=i==null||n==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new IKe(e,r,i,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},zTe=class{constructor(e=2.5,r=.01,i=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=n,this.enabled=!0,this.value=new Bd(.8),this.time=new Bd(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=ge(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new b8(e,r,i)}},BTe=class extends zTe{constructor(e=3,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){const i=this.value.lastValue;if(i!=null){let n=e-i;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=i+n}super.add(e,r)}},DKe=class extends b8{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),n=super.value(e+r)-i;return Math.exp(n)}},VTe=class extends zTe{constructor(e=2.5,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new DKe(e,r,i)}},PH=class extends Of{constructor(){super(...arguments),this._smoothRotation=new O5(.05),this._rotationAxis=O(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Er(),this._beginRadius=0,this._smoothScaling=new O5(.05),this._zoomCenterScreen=Xi(),this._zoomMomentumEstimator=new VTe,this._rotationMomentumEstimator=new BTe,this._panSphericalMomentumEstimator=new LKe,this._panPlanarMomentumEstimator=new kTe,this._adjustedSphere=vn(),this._tmp3d=O(),this._tmpScreenPointArray=Xi(),this._beginScreenPoint=Xi(),this._beginScenePoint=O(),this._screenPickPoint=Xi(),this._scenePickPoint=O(),this._mode=Xs.Horizontal,this._sphere=vn(),this._pointerCount=0,this._tmpInteractionDirection=O(),this._constraintOptions={selection:Ci.ALL,interactionType:Wt.NONE,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Qs.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var s;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-U_.normalize(It(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),wf(e.center,this._screenPickPoint),fs(this._beginScreenPoint,this._screenPickPoint);const i=Mr(this.view.spatialReference),n=oTe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,VS.Silhouette,this.view.map.ground.opacity===0?jw:{});n.scenePickPoint!=null&&(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,re(this._beginScenePoint,this._scenePickPoint),this._mode=y8(this.startCamera,this._screenPickPoint,i),this._mode===Xs.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),(s=this._constraintOptions.interactionStartCamera)==null||s.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===Xs.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===Xs.Horizontal?new $v({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new pT({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new ib({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===Xs.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new BD({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new oO({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,r){const i=fa(this._tmp3d,this.startCamera.viewForward);MP(this._scenePickPoint,i,this._panningPlane);const n=Xi(this._screenPickPoint[0],0),s=O(),o=Te(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],PR(this._adjustedSphere,this.startCamera,n,s);const a=Vo();this.startCamera.projectToRenderScreen(s,a);const l=O(),c=O(),u=O();ae(l,this._scenePickPoint,this.currentCamera.eye);const d=Te(l);me(l,l);const p=rTe*Math.max(Math.abs(this.view.camera.position.z),iTe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,g8);let y=m??p;y=r?Math.min(y,d):y,re(u,oe(c,this.currentCamera.eye,te(c,l,y))),this._panningPlane[3]=-fe(this._panningPlane,u),this.startCamera.center=oe(c,this.startCamera.eye,te(c,this.startCamera.viewForward,y));const _=wf(e.center,this._tmpScreenPointArray);TH(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),nTe(this._sphere,this.currentCamera,this._smoothScaling.value),wf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Wt.ZOOM,this._constraintOptions.interactionFactor=zd(e.radius-this._beginRadius),Rn(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=wf(e.center,this._tmpScreenPointArray);PR(this._sphere,this.currentCamera,r,this._tmp3d),FQ(this._beginScenePoint,fe(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(dTe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(hTe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Wt.PAN,this._constraintOptions.interactionFactor=zd(cw(this._screenPickPoint,r)),Rn(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){me(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||fa(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+xH(e.angle-r),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(i);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),Q_(this.currentCamera,this._sphere,RR(this._rotationAxis,s)),this._constraintOptions.interactionType=Wt.TUMBLE,this._constraintOptions.interactionFactor=zd(e.radius*i),Rn(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=wf(e.center,this._tmpScreenPointArray);TH(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(aTe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Wt.PAN,this._constraintOptions.interactionFactor=zd(cw(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Rn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),NQ(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Wt.ZOOM,this._constraintOptions.interactionFactor=zd(e.radius-this._beginRadius),Rn(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){re(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||fa(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=xH(i);const n=r+i,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),Q_(this.currentCamera,this._sphere,RR(this._rotationAxis,o)),this._constraintOptions.interactionType=Wt.TUMBLE,this._constraintOptions.interactionFactor=zd(e.radius*o),Rn(this.view,this.currentCamera,this._constraintOptions)}};PH=h([N("esri.views.3d.state.controllers.global.PinchAndPanController")],PH);const soe=Se(0,0,1),NKe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let MH=class extends Of{constructor(){super(...arguments),this._rotationValueSmooth=new O5(.05),this._scalingValueSmooth=new O5(.05),this._planeHorizontal=Er(),this._planeVertical=Er(),this._rotationMomentumEstimator=new BTe,this._panMomentumEstimator=new kTe(300,12,.9),this._zoomMomentumEstimator=new VTe,this._beginRadius=0,this._beginCenter=O(),this._beginAngle=0,this._tmpPoints=[],this._panMode=Xs.Horizontal,this._beginCenterScreen=Xi(),this._tmpCentroid3d=O(),this._tmpCentroid2d=Xi(),this._tmp2d=Xi(),this._pointerCount=0,this._constraintOptions={selection:Ci.ALL,interactionType:Wt.NONE,interactionFactor:0,interactionStartCamera:new lt,interactionDirection:null,tiltMode:Qs.TUMBLE}}begin(e){var y;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),wf(e.center,this._beginCenterScreen),xbe(soe,0,this._planeHorizontal);const i=O(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?jw:{}),s=O();fa(s,this.startCamera.viewForward);const o=O();re(o,soe);const a=fe(s,o),l=$h(a<0?-a:a);this._panMode=l>=NKe.ANGLE_THRESHOLD?Xs.Horizontal:Xs.Vertical;const c=Math.min(rTe,1/Math.abs(fe(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),iTe);jG(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||HG(this._planeHorizontal,this._planeHorizontal);const u=O(),d=O(),p=O();ae(u,i,this.currentCamera.eye);const m=Te(u);if(me(u,u),this._panMode===Xs.Vertical){te(o,o,a),ae(this._planeVertical,s,o),me(this._planeVertical,this._planeVertical),jG(this._planeVertical,this._planeVertical,i);const _=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,g8);let v=_??c;v=n?Math.min(v,m):v,re(p,oe(d,this.currentCamera.eye,te(d,u,v))),this._planeVertical[3]=-fe(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),l9(this._tmpPoints,this._beginCenter)}else{const _=n?m:c;re(p,oe(d,this.currentCamera.eye,te(d,u,_))),this._planeHorizontal[3]=-fe(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),l9(this._tmpPoints,this._beginCenter)}(y=this._constraintOptions.interactionStartCamera)==null||y.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===Xs.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(r){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),NQ(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Wt.ZOOM,this._constraintOptions.interactionFactor=zd(Math.abs(e.radius-this._beginRadius)),Rn(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),l9(this._tmpPoints,this._tmpCentroid3d),wf(e.center,this._tmpCentroid2d),aTe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Wt.PAN,this._constraintOptions.interactionFactor=zd(cw(this._beginCenterScreen,this._tmpCentroid2d)),Rn(this.view,this.currentCamera,this._constraintOptions),r){const s=this._planeHorizontal,o=n,a=this._rotationValueSmooth.value,l=a+xH(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const u=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(u,.001*e.timestamp),Q_(this.currentCamera,o,RR(s,u)),this._constraintOptions.interactionType=Wt.TUMBLE,this._constraintOptions.interactionFactor=zd(Math.abs(e.radius*u)),Rn(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new pT({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new ib({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new oO({view:this.view,momentum:n}):null}_computePlanePoints(e,r,i,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=O()),TH(r,i,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};MH=h([N("esri.views.3d.state.controllers.local.PinchAndPanController")],MH);let ooe=class extends Eo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!kQ(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,n=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new PH({view:this._view}):new MH({view:this._view})}},FKe=class extends Eo{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},GTe=class extends Eo{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},UKe=class extends GTe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},kKe=class extends GTe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},zKe=class extends Eo{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var n,s,o;const r=this._invert?-1:1,i=Xi(0,e.data.delta*r);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new sO({view:this._view,pivot:nc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(s=this._cameraController)==null||s.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function aoe(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>GKe(r,t.axisThreshold))}:{buttons:[],axes:[]}}function BKe(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function VKe(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function GKe(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let jKe=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,aoe(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new NZ(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=fS({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=aoe(s),l=i||VKe(a);o&&(o.timestamp===n.timestamp||!o.active&&l||BKe(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const n=r[i];this._validate(n)&&e(n)}}_emitGamepadEvent(e,r,i){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const o=!s&&i?"start":s&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const loe=se("edge"),HKe=se("chrome"),WKe=se("ff"),qKe=se("safari"),coe="esri-view-surface",mx={touchNone:`${coe}--touch-none`,touchPan:`${coe}--touch-pan`};let jTe=class HTe{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new jKe(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Me(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(b9[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&b9[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(b9[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?mx.touchNone:mx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?mx.touchPan:mx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(mx.touchNone),this._element.classList.remove(mx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=bwe(this._element,e);return HTe.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=rje(r);i&&e==="key-up"&&this._keyDownState.delete(i);const n={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:loe&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}loe?i*=.7:HKe||qKe?i*=.6:WKe&&(i*=1.375);const n=100,s=Math.abs(i);s>n&&(i=i/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};jTe.test={disableSubpixelCoordinates:!1};const b9={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let XKe=class extends Eo{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function WTe(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function YKe(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function ZKe(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Lh()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[T,S]=t,[A,C]=[S.x-T.x,S.y-T.y];return e.radius=Math.sqrt(A*A+C*C)/2,e.center.x=(T.x+S.x)/2,e.center.y=(T.y+S.y)/2,e}let r=0,i=0;for(let T=0;T<t.length;T++)r+=t[T].x,i+=t[T].y;r/=t.length,i/=t.length;const n=t.map(T=>T.x-r),s=t.map(T=>T.y-i);let o=0,a=0,l=0,c=0,u=0,d=0,p=0;for(let T=0;T<n.length;T++){const S=n[T],A=s[T],C=S*S,R=A*A;o+=C,a+=R,l+=S*A,c+=C*S,u+=R*A,d+=S*R,p+=A*C}const m=.5*(c+d),y=.5*(u+p),_=o*a-l*l,v=(m*a-y*l)/_,b=(o*y-l*m)/_,x=Lh(v+r,b+i);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:x}}function aO(t){const{native:e}=t,{pointerId:r,button:i,pointerType:n}=e;return n==="mouse"?`${r}:${i}`:`${n}`}let QKe=class extends Eo{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:n,pointers:JKe(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=K$(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,n);const s=VD(n,qTe(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=K$(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=K$(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=VD(i,r)-e,i.lastAngle=VD(i,r)-e})}_emitEvent(e,r,i){const n=K$(this._activePointerMap);this._drag.emit(this._createPayload(e,r,n,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,n=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,n)):(this._addPointer(i),this._emitEvent("added",i,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function qTe(t){const e=[];return t.forEach(r=>{e.push(Lh(r.event.x,r.event.y))}),ZKe(e)}function K$(t){const e=qTe(t);let r=0;return t.forEach(i=>{let n=VD(i,e),s=n-i.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=i.lastAngle+s,i.lastAngle=n;const o=n-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function JKe(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function VD(t,e){const r=t.event,i=r.x-e.center.x,n=r.y-e.center.y;return Math.atan2(n,i)}var uoe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(uoe||(uoe={}));const d_={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let KKe=class extends Eo{constructor(e=d_.maximumDoubleClickDelay,r=d_.maximumDoubleClickDistance,i=d_.maximumDoubleTouchDelay,n=d_.maximumDoubleTouchDistance,s=hP){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Pi(e.doubleClickTimer))}get hasPendingInputs(){return Do(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=Pi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:n}=e.native;return i==="mouse"?`${r}:${n}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,n=this._getPointerId(r);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;WTe(o,r)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=aO(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,n=aO(r),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),a=1;this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},eet=class extends Eo{constructor(e=d_.maximumDoubleClickDelay,r=d_.maximumDoubleClickDistance,i=d_.maximumDoubleTouchDelay,n=d_.maximumDoubleTouchDistance,s=hP){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=aO(r);if(!this._pointerState.has(i)){const n={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,n),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=aO(r),n=this._pointerState.get(i);if(n&&n.downButton===r.native.button){const s=n.immediateDoubleClick;if(s){s.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;WTe(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=aO(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const wC={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let tet=class extends Eo{constructor(e=wC.maximumClickDelay,r=wC.movementUntilMouseDrag,i=wC.movementUntilPenDrag,n=wC.movementUntilTouchDrag,s=wC.holdDelay,o=hP){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Pi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,r),void 0,n.modifiers):YKe(r,n.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),n.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,r)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,r==="pointer-up"?i:s.previousEvent),void 0,s.modifiers):r==="pointer-up"&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},ret=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},iet=class extends Eo{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new ret({start:(i,n)=>this._observeStart(i,n),update:(i,n,s)=>this._observeUpdate(i,n,s),end:(i,n)=>this._observeEnd(n)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),n=Math.min(n,_),s=Math.max(s,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),u=Math.min(u,v);const d=i-n,p=s-o,m=a-l,y=c-u;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(m-d)<=this._maxDelta&&Math.abs(y-p)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((n,s)=>{const o=r.pointers.get(s);i=Math.min(i,Math.abs(n.y-o.y))}),i>=this._threshold}},_d=class extends xe{constructor(){super(...arguments),this._handles=new Vi}destroy(){this._handles=Me(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Me(this._inputManager)}connect(){const e=this.view;this._source=new jTe(this.view.surface,e.input);const r=[new eet,new tet,new KKe,new QKe(this.view.navigation),new iet],i=new Hu({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new XKe],E_.INTERNAL),this._modeDragPan=new ooe(e,"primary"),this._modeDragRotate=new _9(e,"secondary",nc.CENTER),this._modeDragZoom=new bKe(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new FKe(e),new fJe(e),new OKe(e),new RKe(e,n.pan),new PKe(e),new kKe(e,n.resetTilt),new UKe(e,n.resetHeading),new _9(e,"primary",nc.EYE,[n.lookAround]),new _9(e,"secondary",nc.CENTER,[n.lookAround]),new ooe(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new zKe(e)],E_.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ue(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Pr))}_updateMode(){var n;const e=this.mode,r=this.primaryDragAction,i=(n=$H.get(e))==null?void 0:n.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};h([f()],_d.prototype,"view",void 0),h([f({value:"pan"})],_d.prototype,"primaryDragAction",null),h([f({value:"default"})],_d.prototype,"mode",null),h([f({readOnly:!0})],_d.prototype,"updating",null),h([f()],_d.prototype,"latestPointerType",null),h([f()],_d.prototype,"latestPointerLocation",null),h([f()],_d.prototype,"multiTouchActive",null),h([f()],_d.prototype,"_inputManager",void 0),_d=h([N("esri.views.3d.input.SceneInputManager")],_d);const $H=new Map,w9=new Map,x9=new Map;w9.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),w9.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),x9.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),x9.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),$H.set("default",w9),$H.set("pro",x9);const net=_d;let xn=class extends xe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};h([f()],xn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),h([f()],xn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),h([f()],xn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),h([f()],xn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),h([f()],xn.prototype,"LABELS_SHOW_BORDER",void 0),h([f()],xn.prototype,"TEXT_SHOW_BASELINE",void 0),h([f()],xn.prototype,"TEXT_SHOW_BORDER",void 0),h([f()],xn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),h([f()],xn.prototype,"OVERLAY_SHOW_CENTER",void 0),h([f()],xn.prototype,"SHOW_POI",void 0),h([f()],xn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),h([f()],xn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),h([f()],xn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),h([f()],xn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),h([f()],xn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),h([f()],xn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),h([f()],xn.prototype,"I3S_TREE_SHOW_TILES",void 0),h([f()],xn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),h([f()],xn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),h([f()],xn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),h([f()],xn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),h([f()],xn.prototype,"LINE_WIREFRAMES",void 0),xn=h([N("esri.views.3d.support.DebugFlags")],xn);const Kr=new xn;let Zc,HT,IH=!1,LH=!1,DH=!1,NH=!1,lO=null;function set(t,e){if(!LH||!HT)return;XTe();const r=HT;let i=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];i+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,u=(s+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),YTe(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function oet(t){DH=Kr.DECONFLICTOR_SHOW_VISIBLE,NH=Kr.DECONFLICTOR_SHOW_INVISIBLE,IH=DH||NH,LH=Kr.DECONFLICTOR_SHOW_GRID,lO=null,IH||LH?lO=()=>aet(t):Zc&&(Zc.parentElement.removeChild(Zc),Zc=null)}function XTe(){lO&&(lO(),lO=null)}function aet(t){Zc==null&&(Zc=document.createElement("canvas"),Zc.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Zc));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:n,height:s}=r,o=n*i,a=s*i;Zc.setAttribute("width",`${o}px`),Zc.setAttribute("height",`${a}px`),Zc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),HT=Zc.getContext("2d"),HT.clearRect(0,0,n,s),HT.font="12px Arial"}function YTe(t,e,r,i,n){XTe();const s=Zc.height,o=HT;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-r),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.closePath()}function cet(t,e){IH&&(e&&DH||!e&&NH)&&YTe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Uo,js;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Uo||(Uo={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(js||(js={}));function ZTe(t,e){return new eSe(t,rSe,e)}function uet(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=rSe;return new eSe(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:T9.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:T9.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:T9.minPixelSize},e)}function het(t){return Math.abs(t*t*t)}function QTe(t,e,r){const i=r.parameters,n=r.paddingPixelsOverride;return xC.scale=Math.min(i.divisor/(e-i.offset),1),xC.factor=het(t),xC.minPixelSize=i.minPixelSize,xC.paddingPixels=n,xC}function JTe(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function qQ(t,e){return Math.max(wt(t*e.scale,t,e.factor),JTe(t,e))}function det(t,e,r){const i=QTe(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,qQ(1,i)}function hoe(t,e,r,i){i.scale=det(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function KTe(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,JTe(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function pet(t,e,r,i){return qQ(t,QTe(e,r,i))}let eSe=class tSe{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,n=fet(),s){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=n,this._paddingPixelsOverride=s,this._viewingMode===$e.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new tSe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:n,scaleFallOffRange:s,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),u=this._coverageCompensation(e,r,c),{tiltAngle:d,scaleFallOffFactor:p}=c,m=Math.sin(d)*l,y=.5*Math.PI-d-a*(.5-n*u),_=m/Math.cos(y),v=y+a*s*u,b=(_-p*(m/Math.cos(v)))/(1-p);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=b,i.divisor=_-b,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=doe){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=doe){const n=this._description.curvatureDependent,s=1+e.distance/r,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=ge((o-a)/(l-a),0,1),[u,d]=[n.min,n.max];return i.tiltAngle=wt(u.tiltAngle,d.tiltAngle,c),i.scaleFallOffFactor=wt(u.scaleFallOffFactor,d.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const n=r*r,s=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-n);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(s)))+.5*o)/o}};const rSe={curvatureDependent:{min:{curvature:It(10),tiltAngle:It(12),scaleFallOffFactor:.5},max:{curvature:It(70),tiltAngle:It(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},T9={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function fet(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const xC={scale:0,factor:0,minPixelSize:0,paddingPixels:0},doe={tiltAngle:0,scaleFallOffFactor:0};function met(t){return t instanceof Float32Array&&t.length>=16}function get(t){return Array.isArray(t)&&t.length>=16}function yet(t){return met(t)||get(t)}function XQ(t){t.vertex.code.add(w`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(w`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(w`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(w`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(w`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(w`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(w`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function _et(t){t.uniforms.add(new Jt("screenSizePerspective",e=>iSe(e.screenSizePerspective)))}function w8(t){t.uniforms.add(new Jt("screenSizePerspectiveAlignment",e=>iSe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function iSe(t){return gi(vet,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const vet=Qt();var Oi,ch,cO,tn,ns;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Oi||(Oi={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(ch||(ch={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(cO||(cO={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(tn||(tn={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(ns||(ns={}));let bet=class{constructor(e,r){this.vec3=e,this.id=r}};function R5(t,e,r,i){return new bet(Se(t,e,r),i)}var za;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(za||(za={}));const YQ=1.3;let poe=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=jt(),this.resolution=0,this.renderLocalOrigin=R5(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new wet,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===za.ColorAndWater?this.renderTargets.getTarget(tn.Color):e===za.Highlight?this.renderTargets.getTarget(tn.Highlight):e===za.ObjectAndLayerIdColor?this.renderTargets.getTarget(tn.ObjectAndLayerIdColor):this.renderTargets.getTarget(tn.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(tn.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(tn.Color):null}getNormalTexture(e){const r=e===za.ColorAndWater?this.renderTargets.getTarget(tn.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const n of this.renderTargets.renderTargets)n.type!==tn.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[n.type]=e.drawTarget(this,n,r):this.validTargets[n.type]=!1;return i^this.computeRenderTargetValidityBitfield()?FS.CHANGED:FS.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[tn.Color]|+e[tn.ColorNoRasterImage]<<1|+e[tn.Highlight]<<2|+e[tn.Water]<<3|+e[tn.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];E4(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];E4(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Ug(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===Oi.INNER?0:this.resolution,0,this.resolution,this.resolution)}},wet=class{constructor(){this.extents=[jt(),jt(),jt()],this.numViews=0}},nSe=class extends ln{constructor(e,r){super(e,"mat4",jr.Draw,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};function fp(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Zs):t.uniforms.add(new pu("cameraPosition",(r,i)=>ne(sSe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function xc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new Mi("proj",(i,n)=>n.camera.projectionMatrix),new nSe("view",(i,n)=>Ml(foe,n.camera.viewMatrix,i.origin)),new pu("localOrigin",i=>i.origin));const r=i=>ne(sSe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new Mi("proj",(i,n)=>n.camera.projectionMatrix),new Mi("view",(i,n)=>Ml(foe,n.camera.viewMatrix,r(n))),new Lt("localOrigin",(i,n)=>r(n)))}const foe=_e(),sSe=O();function jS(t){t.uniforms.add(new Mi("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function LE(t,e){t.uniforms.add(new Ce("pixelRatio",(r,i)=>i.camera.pixelRatio/(e.draped?YQ:1)))}function oSe(t,e){const r=t.vertex;e.hasVerticalOffset?(aSe(r),e.hasScreenSizePerspective&&(t.include(XQ),w8(r),fp(t.vertex,e)),r.code.add(w`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?w`vec3 worldNormal = normalize(worldPos + localOrigin);`:w`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?w`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:w`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(w`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const xet=Qt();function aSe(t){t.uniforms.add(new Jt("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return gi(xet,s*a,o,i,n)}))}function x8(t){t.uniforms.add(new kf("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(w`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(w`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var tc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(tc||(tc={}));var Tl;function lSe(t,e){t.include(XQ),t.attributes.add(E.POSITION,"vec3"),t.attributes.add(E.NORMAL,"vec3"),t.attributes.add(E.AUXPOS1,"vec4");const r=t.vertex;xc(r,e),fp(r,e),r.uniforms.add(new Jt("viewport",(i,n)=>n.camera.fullViewport),new Ce("polygonOffset",i=>i.shaderPolygonOffset),new Ce("cameraGroundRelative",(i,n)=>n.camera.aboveGround?1:-1),new Ce("renderTransparentlyOccludedHUD",(i,n)=>n.renderTransparentlyOccludedHUD===tc.Occluded?1:n.renderTransparentlyOccludedHUD===tc.NotOccluded?0:.75),new Ye("hudVisibilityTexture",(i,n)=>n.hudVisibilityTexture)),e.hasVerticalOffset&&aSe(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(w`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(w`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.draped&&!e.hasVerticalOffset||jS(r),e.draped||(r.uniforms.add(new Ce("perDistancePixelRatio",(i,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),r.code.add(w`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===Tl.Screen&&LE(r,e),e.hasScreenSizePerspective&&w8(r),r.code.add(w`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===Tl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?w`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==Tl.Screen?w`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===Tl.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===Tl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(x8),r.code.add(w`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(Tl||(Tl={}));const eI=ps();function cSe(t,e,r,i,n,s){if(t.visible)if(t.boundingInfo){Je(t.type===on.Mesh);const o=e.tolerance;uSe(t.boundingInfo,r,i,o,n,s)}else{const o=t.indices.get(E.POSITION),a=t.vertexAttributes.get(E.POSITION);BP(r,i,0,o.length/3,o,a,void 0,n,s)}}const Tet=O();function uSe(t,e,r,i,n,s){if(t==null)return;const o=dSe(e,r,Tet);if(C1e(eI,t.bbMin),A1e(eI,t.bbMax),n!=null&&n.applyToAabb(eI),QQ(eI,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,u=a?a.length:l.length/3;if(u>Oet){const d=t.getChildren();if(d!==void 0){for(const p of d)uSe(p,e,r,i,n,s);return}}BP(e,r,0,u,l,c,a,n,s)}}const hSe=O();function BP(t,e,r,i,n,s,o,a,l){if(o)return Eet(t,e,r,i,n,s,o,a,l);const{data:c,stride:u}=s,d=t[0],p=t[1],m=t[2],y=e[0]-d,_=e[1]-p,v=e[2]-m;for(let b=r,x=3*r;b<i;++b){let T=u*n[x++],S=c[T++],A=c[T++],C=c[T];T=u*n[x++];let R=c[T++],P=c[T++],F=c[T];T=u*n[x++];let k=c[T++],V=c[T++],z=c[T];a!=null&&([S,A,C]=a.applyToVertex(S,A,C,b),[R,P,F]=a.applyToVertex(R,P,F,b),[k,V,z]=a.applyToVertex(k,V,z,b));const X=R-S,q=P-A,G=F-C,Q=k-S,M=V-A,I=z-C,L=_*I-M*v,B=v*Q-I*y,H=y*M-Q*_,Z=X*L+q*B+G*H;if(Math.abs(Z)<=Number.EPSILON)continue;const K=d-S,de=p-A,Re=m-C,Ke=K*L+de*B+Re*H;if(Z>0){if(Ke<0||Ke>Z)continue}else if(Ke>0||Ke<Z)continue;const _t=de*G-q*Re,at=Re*X-G*K,yt=K*q-X*de,Fe=y*_t+_*at+v*yt;if(Z>0){if(Fe<0||Ke+Fe>Z)continue}else if(Fe>0||Ke+Fe<Z)continue;const pe=(Q*_t+M*at+I*yt)/Z;pe>=0&&l(pe,ZQ(X,q,G,Q,M,I,hSe),b,!1)}}function Eet(t,e,r,i,n,s,o,a,l){const{data:c,stride:u}=s,d=t[0],p=t[1],m=t[2],y=e[0]-d,_=e[1]-p,v=e[2]-m;for(let b=r;b<i;++b){const x=o[b];let T=3*x,S=u*n[T++],A=c[S++],C=c[S++],R=c[S];S=u*n[T++];let P=c[S++],F=c[S++],k=c[S];S=u*n[T];let V=c[S++],z=c[S++],X=c[S];a!=null&&([A,C,R]=a.applyToVertex(A,C,R,b),[P,F,k]=a.applyToVertex(P,F,k,b),[V,z,X]=a.applyToVertex(V,z,X,b));const q=P-A,G=F-C,Q=k-R,M=V-A,I=z-C,L=X-R,B=_*L-I*v,H=v*M-L*y,Z=y*I-M*_,K=q*B+G*H+Q*Z;if(Math.abs(K)<=Number.EPSILON)continue;const de=d-A,Re=p-C,Ke=m-R,_t=de*B+Re*H+Ke*Z;if(K>0){if(_t<0||_t>K)continue}else if(_t>0||_t<K)continue;const at=Re*Q-G*Ke,yt=Ke*q-Q*de,Fe=de*G-q*Re,pe=y*at+_*yt+v*Fe;if(K>0){if(pe<0||_t+pe>K)continue}else if(pe>0||_t+pe<K)continue;const xt=(M*at+I*yt+L*Fe)/K;xt>=0&&l(xt,ZQ(q,G,Q,M,I,L,hSe),x,!1)}}const moe=O(),goe=O();function ZQ(t,e,r,i,n,s,o){return ne(moe,t,e,r),ne(goe,i,n,s),ot(o,moe,goe),me(o,o),o}function dSe(t,e,r){return ne(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function QQ(t,e,r,i){return JQ(t,e,r,i,1/0)}function JQ(t,e,r,i,n){const s=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-i-e[1])*r[1],u=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const d=(t[2]-i-e[2])*r[2],p=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<n)}function pSe(t,e,r,i,n){let s=(r.screenLength||0)*t.pixelRatio;n!=null&&(s=pet(s,i,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return ge(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function fSe(t,e){const r=e?fSe(e):{};for(const i in t){let n=t[i];n&&n.forEach&&(n=Aet(n)),n==null&&i in r||(r[i]=n)}return r}function Cet(t,e){let r=!1;for(const i in e){const n=e[i];n!==void 0&&(Array.isArray(n)?t[i]===null?(t[i]=n.slice(),r=!0):_X(t[i],n)&&(r=!0):t[i]!==n&&(r=!0,t[i]=n))}return r}function Aet(t){const e=[];return t.forEach(r=>e.push(r)),e}const mSe={multiply:1,ignore:2,replace:3,tint:4},Oet=1e3;let p1=class extends FP{constructor(e,r){super(),this.type=on.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=fr,this._pp0=Se(0,0,1),this._pp1=Se(0,0,0),this._parameters=fSe(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){Cet(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,r,i,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,r,i,this._pp0,this._pp1,s)}},gSe=class extends WXe{constructor(e,r,i){super(r,i),this.camera=e}};var Ri;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Ri||(Ri={}));let KQ=class extends Wr{constructor(){super(...arguments),this.renderOccluded=Ri.Occlude}},ySe=class{constructor(){this.factor=new yoe,this.factorAlignment=new yoe}},yoe=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function dIt(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n===1)for(let l=0;l<a;++l)s[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let u=0;u<n;u++)s[i]=c,i+=o}}function _oe(t,e,r,i){const n=r.typedBuffer,s=r.typedBufferStride,o=t.length;i*=s;for(let a=0;a<o;++a){const l=2*t[a];n[i]=e[l],n[i+1]=e[l+1],i+=s}}function _Se(t,e,r,i,n){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n==null||n===1)for(let l=0;l<a;++l){const c=3*t[l];s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let u=0;u<n;++u)s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],i+=o}}function HS(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n===1)for(let l=0;l<a;++l){const c=4*t[l];s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],s[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let u=0;u<n;++u)s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],s[i+3]=e[c+3],i+=o}}function voe(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<r;++s)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=n}function eJ(t,e,r,i,n,s=1){if(!r)return void _Se(t,e,i,n,s);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],u=r[1],d=r[2],p=r[4],m=r[5],y=r[6],_=r[8],v=r[9],b=r[10],x=r[12],T=r[13],S=r[14];n*=a;let A=0,C=0,R=0;const P=L6(r)?F=>{A=e[F]+x,C=e[F+1]+T,R=e[F+2]+S}:F=>{const k=e[F],V=e[F+1],z=e[F+2];A=c*k+p*V+_*z+x,C=u*k+m*V+v*z+T,R=d*k+y*V+b*z+S};if(s===1)for(let F=0;F<l;++F)P(3*t[F]),o[n]=A,o[n+1]=C,o[n+2]=R,n+=a;else for(let F=0;F<l;++F){P(3*t[F]);for(let k=0;k<s;++k)o[n]=A,o[n+1]=C,o[n+2]=R,n+=a}}function tJ(t,e,r,i,n,s=1){if(!r)return void _Se(t,e,i,n,s);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,u=o[0],d=o[1],p=o[2],m=o[4],y=o[5],_=o[6],v=o[8],b=o[9],x=o[10],T=!cZ(o),S=1e-6,A=1-S;n*=l;let C=0,R=0,P=0;const F=L6(o)?k=>{C=e[k],R=e[k+1],P=e[k+2]}:k=>{const V=e[k],z=e[k+1],X=e[k+2];C=u*V+m*z+v*X,R=d*V+y*z+b*X,P=p*V+_*z+x*X};if(s===1)if(T)for(let k=0;k<c;++k){F(3*t[k]);const V=C*C+R*R+P*P;if(V<A&&V>S){const z=1/Math.sqrt(V);a[n]=C*z,a[n+1]=R*z,a[n+2]=P*z}else a[n]=C,a[n+1]=R,a[n+2]=P;n+=l}else for(let k=0;k<c;++k)F(3*t[k]),a[n]=C,a[n+1]=R,a[n+2]=P,n+=l;else for(let k=0;k<c;++k){if(F(3*t[k]),T){const V=C*C+R*R+P*P;if(V<A&&V>S){const z=1/Math.sqrt(V);C*=z,R*=z,P*=z}}for(let V=0;V<s;++V)a[n]=C,a[n+1]=R,a[n+2]=P,n+=l}}function Ret(t,e,r,i,n,s=1){if(!r)return void HS(t,e,i,n,s);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,u=o[0],d=o[1],p=o[2],m=o[4],y=o[5],_=o[6],v=o[8],b=o[9],x=o[10],T=!cZ(o),S=1e-6,A=1-S;if(n*=l,s===1)for(let C=0;C<c;++C){const R=4*t[C],P=e[R],F=e[R+1],k=e[R+2],V=e[R+3];let z=u*P+m*F+v*k,X=d*P+y*F+b*k,q=p*P+_*F+x*k;if(T){const G=z*z+X*X+q*q;if(G<A&&G>S){const Q=1/Math.sqrt(G);z*=Q,X*=Q,q*=Q}}a[n]=z,a[n+1]=X,a[n+2]=q,a[n+3]=V,n+=l}else for(let C=0;C<c;++C){const R=4*t[C],P=e[R],F=e[R+1],k=e[R+2],V=e[R+3];let z=u*P+m*F+v*k,X=d*P+y*F+b*k,q=p*P+_*F+x*k;if(T){const G=z*z+X*X+q*q;if(G<A&&G>S){const Q=1/Math.sqrt(G);z*=Q,X*=Q,q*=Q}}for(let G=0;G<s;++G)a[n]=z,a[n+1]=X,a[n+2]=q,a[n+3]=V,n+=l}}function vSe(t,e,r,i,n,s=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(n*=a,r!==e.length||r!==4)if(s!==1)if(r!==4)for(let c=0;c<l;++c){const u=3*t[c];for(let d=0;d<s;++d)o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=255,n+=a}else for(let c=0;c<l;++c){const u=4*t[c];for(let d=0;d<s;++d)o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=e[u+3],n+=a}else{if(r===4){for(let c=0;c<l;++c){const u=4*t[c];o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=e[u+3],n+=a}return}for(let c=0;c<l;++c){const u=3*t[c];o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=255,n+=a}}else{o[n]=e[0],o[n+1]=e[1],o[n+2]=e[2],o[n+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),u=a/4,d=c[n/=4];n+=u;const p=l*s;for(let m=1;m<p;++m)c[n]=d,n+=u}}function Pet(t,e,r,i){const n=r.typedBuffer,s=r.typedBufferStride,o=t.length,a=e[0];i*=s;for(let l=0;l<o;++l)n[i]=a,i+=s}function bSe(t,e,r,i,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(i*=o,n===1)for(let a=0;a<r;++a)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<n;++l)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o}function wSe(t,e,r,i,n,s){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)xSe(o,a,l,r,i,n,s);else if(o===E.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(E.POSITION);if(Je(!!c,`No buffer view for ${o}`),c){const u=c.length,d=n.getField(o,ya);bSe(t.objectAndLayerIdColor,d,u,s)}}}}function xSe(t,e,r,i,n,s,o){switch(t){case E.POSITION:{Je(e.size===3);const a=s.getField(t,ds);Je(!!a,`No buffer view for ${t}`),a&&eJ(r,e.data,i,a,o);break}case E.NORMAL:{Je(e.size===3);const a=s.getField(t,ds);Je(!!a,`No buffer view for ${t}`),a&&tJ(r,e.data,n,a,o);break}case E.NORMALCOMPRESSED:{Je(e.size===2);const a=s.getField(t,NP);Je(!!a,`No buffer view for ${t}`),a&&_oe(r,e.data,a,o);break}case E.UV0:{Je(e.size===2);const a=s.getField(t,d1);Je(!!a,`No buffer view for ${t}`),a&&_oe(r,e.data,a,o);break}case E.COLOR:case E.SYMBOLCOLOR:{const a=s.getField(t,ya);Je(!!a,`No buffer view for ${t}`),Je(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||vSe(r,e.data,e.size,a,o);break}case E.COLORFEATUREATTRIBUTE:{const a=s.getField(t,r8);Je(!!a,`No buffer view for ${t}`),Je(e.size===1),a&&e.size===1&&Pet(r,e.data,a,o);break}case E.TANGENT:{Je(e.size===4);const a=s.getField(t,pp);Je(!!a,`No buffer view for ${t}`),a&&Ret(r,e.data,n,a,o);break}case E.PROFILERIGHT:case E.PROFILEUP:case E.PROFILEVERTEXANDNORMAL:case E.FEATUREVALUE:{Je(e.size===4);const a=s.getField(t,pp);Je(!!a,`No buffer view for ${t}`),a&&HS(r,e.data,a,o)}}}function $R(t,e,r=0){const i=ge(t,0,Iet);for(let n=0;n<4;n++)e[r+n]=Math.floor(256*Let(i*Met[n]))}function rJ(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*$et[i];return r}const Met=[1,256,65536,16777216],$et=[1/256,1/65536,1/16777216,1/4294967296],Iet=rJ(new Uint8ClampedArray([255,255,255,255]));function Let(t){return t-Math.floor(t)}async function qg(t,e){const{data:r}=await kn(t,{responseType:"image",...e});return r}function Det(){if(S9==null){const t=e=>Ir(`esri/libs/basisu/${e}`);S9=ce(()=>import("./basis_transcoder-bff818ce.js"),[]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return S9}let S9;var nb;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(nb||(nb={}));let rp=null,tI=null;async function TSe(){return tI==null&&(tI=Det(),rp=await tI),tI}function Net(t,e){if(rp==null)return t.byteLength;const r=new rp.BasisFile(new Uint8Array(t)),i=ESe(r)?SSe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function Fet(t,e){if(rp==null)return t.byteLength;const r=new rp.KTX2File(new Uint8Array(t)),i=CSe(r)?SSe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function SSe(t,e,r,i,n){const s=WZ(e?un.COMPRESSED_RGBA8_ETC2_EAC:un.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*s*o)}function ESe(t){return t.getNumImages()>=1&&!t.isUASTC()}function CSe(t){return t.getFaces()>=1&&t.isETC1S()}async function Uet(t,e,r){rp==null&&(rp=await TSe());const i=new rp.BasisFile(new Uint8Array(r));if(!ESe(i))return null;i.startTranscoding();const n=ASe(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(s,o)=>i.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>i.transcodeImage(a,0,s,o,0,0));return i.close(),i.delete(),n}async function ket(t,e,r){rp==null&&(rp=await TSe());const i=new rp.KTX2File(new Uint8Array(r));if(!CSe(i))return null;i.startTranscoding();const n=ASe(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(s,o)=>i.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>i.transcodeImage(a,s,0,0,o,0,-1,-1));return i.close(),i.delete(),n}function ASe(t,e,r,i,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,d]=l?i?[nb.ETC2_RGBA,un.COMPRESSED_RGBA8_ETC2_EAC]:[nb.ETC1_RGB,un.COMPRESSED_RGB8_ETC2]:c?i?[nb.BC3_RGBA,un.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[nb.BC1_RGB,un.COMPRESSED_RGB_S3TC_DXT1_EXT]:[nb.RGBA32,Tt.RGBA],p=e.hasMipmap?r:Math.min(1,r),m=[];for(let y=0;y<p;y++)m.push(new Uint8Array(o(y,u))),a(y,u,m[y]);return e.internalFormat=d,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,e.width=n,e.height=s,new Ct(t,e,{type:"compressed",levels:m})}const rI=J.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),zet=542327876,Bet=131072,Vet=4;function iJ(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Get(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const jet=iJ("DXT1"),Het=iJ("DXT3"),Wet=iJ("DXT5"),qet=31,Xet=0,Yet=1,Zet=2,Qet=3,Jet=4,Ket=7,ett=20,ttt=21;function rtt(t,e,r){const i=itt(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=i;return e.samplingMode=n.levels.length>1?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=o,e.height=a,new Ct(t,e,n)}function itt(t,e){const r=new Int32Array(t,0,qet);if(r[Xet]!==zet)return rI.error("Invalid magic number in DDS header"),null;if(!(r[ett]&Vet))return rI.error("Unsupported format, must contain a FourCC code"),null;const i=r[ttt];let n,s;switch(i){case jet:n=8,s=un.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Het:n=16,s=un.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Wet:n=16,s=un.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return rI.error("Unsupported FourCC code:",Get(i)),null}let o=1,a=r[Jet],l=r[Qet];!(3&a)&&!(3&l)||(rI.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let d,p;r[Zet]&Bet&&e!==!1&&(o=Math.max(1,r[Ket]));let m=r[Yet]+4;const y=[];for(let _=0;_<o;++_)p=(a+3>>2)*(l+3>>2)*n,d=new Uint8Array(t,m,p),y.push(d),m+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:s,width:c,height:u}}let Hw=class extends FP{constructor(e,r){super(),this._data=e,this.type=on.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Bn,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:Pt.REPEAT,t:Pt.REPEAT},this._startPreload(e)}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(KO(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){im(e.src)||KO(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}dispose(){this._data=void 0}_createDescriptor(e){const r=new pr;return r.wrapMode=this.parameters.wrap??Pt.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?At.LINEAR_MIPMAP_LINEAR:At.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.gpuMemoryUsage)||ntt(this._data,this.parameters)}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Ct(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(o3(r)||Jy(r))&&this.parameters.encoding===wg.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(o3(r)||Jy(r))&&this.parameters.encoding===wg.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(o3(r)||Jy(r))&&this.parameters.encoding===wg.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):Jy(r)?this._loadFromPixelData(e,r):o3(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<uO.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,r){return this._glTexture=rtt(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>ket(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>Uet(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){Je(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.parameters.components===1?Tt.LUMINANCE:this.parameters.components===3?Tt.RGB:Tt.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new Ct(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const n=await qg(r,{signal:i});return Bt(i),this._loadFromImage(e,n)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const n=await N0e(r,r.src,!1,i);return Bt(i),this._loadFromImage(e,n)})}_loadFromVideoElement(e,r){return r.readyState>=uO.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((n,s)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),Pi(c)},a=()=>{r.readyState>=uO.HAVE_CURRENT_DATA&&(o(),n(this._loadFromImage(e,r)))},l=u=>{o(),s(u||new Y("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=pa(i,()=>l(wr()))}))}_loadFromImage(e,r){const i=OSe(r);this.parameters.width=i.width,this.parameters.height=i.height;const n=this._createDescriptor(e);return n.pixelFormat=this.parameters.components===3?Tt.RGB:Tt.RGBA,n.width=i.width,n.height=i.height,this._glTexture=new Ct(e,n,r),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const n=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(n,n),i}unload(){if(this._glTexture=Le(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function ntt(t,e){if(t==null)return 0;if(o3(t)||Jy(t))return e.encoding===wg.KTX2_ENCODING?Fet(t,!!e.mipmap):e.encoding===wg.BASIS_ENCODING?Net(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?OSe(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function OSe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var uO;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(uO||(uO={}));const IR=128,nJ=.5;function stt(t,e=IR,r=e*nJ,i=0){const n=RSe(t,e,r,i);return new Hw(n,{mipmap:!1,wrap:{s:Pt.CLAMP_TO_EDGE,t:Pt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function RSe(t,e=IR,r=e*nJ,i=0){switch(t){case"circle":default:return ott(e,r);case"square":return att(e,r);case"cross":return ctt(e,r,i);case"x":return utt(e,r,i);case"kite":return ltt(e,r);case"triangle":return htt(e,r);case"arrow":return dtt(e,r)}}function ott(t,e){const r=t/2-.5;return VP(t,$Se(r,r,e/2))}function att(t,e){return PSe(t,e,!1)}function ltt(t,e){return PSe(t,e,!0)}function ctt(t,e,r=0){return MSe(t,e,!1,r)}function utt(t,e,r=0){return MSe(t,e,!0,r)}function htt(t,e){return VP(t,ISe(t/2,e,e/2))}function dtt(t,e){const r=e,i=e/2,n=t/2,s=.8*r,o=$Se(n,(t-e)/2-s,Math.sqrt(s*s+i*i)),a=ISe(n,r,i);return VP(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function PSe(t,e,r){return r&&(e/=Math.SQRT2),VP(t,(i,n)=>{let s=i-.5*t+.25,o=.5*t-n-.75;if(r){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function MSe(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const n=.5*e;return VP(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=i/2,a})}function $Se(t,e,r){return(i,n)=>{const s=i-t,o=n-e;return Math.sqrt(s*s+o*o)-r}}function ISe(t,e,r){const i=Math.sqrt(e*e+r*r);return(n,s)=>{const o=Math.abs(n-t)-r,a=s-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function VP(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let n=0;n<t;n++){const s=n+t*i;let o=e(n,i);o=o/t+.5,$R(o,r,4*s)}return r}let fIt=class extends Wr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function ptt(t,e){LSe(t,e,new Lt("slicePlaneOrigin",(r,i)=>USe(e,r,i)),new Lt("slicePlaneBasis1",(r,i)=>{var n;return P5(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new Lt("slicePlaneBasis2",(r,i)=>{var n;return P5(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)}))}function fn(t,e){LSe(t,e,new pu("slicePlaneOrigin",(r,i)=>USe(e,r,i)),new pu("slicePlaneBasis1",(r,i)=>{var n;return P5(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new pu("slicePlaneBasis2",(r,i)=>{var n;return P5(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)}))}function LSe(t,e,...r){if(!e.hasSlicePlane){const o=w`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=w`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=w`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?w`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:w`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(s)}function DSe(t,e,r){return t.instancedDoublePrecision?ne(ftt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function NSe(t,e){return t!=null?ae(M5,e.origin,t):e.origin}function FSe(t,e,r){return t.hasSliceTranslatedView?e!=null?Ml(mtt,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function USe(t,e,r){if(r.slicePlane==null)return Zs;const i=DSe(t,e,r),n=NSe(i,r.slicePlane),s=FSe(t,i,r);return s!=null?De(M5,n,s):n}function P5(t,e,r,i){if(i==null||r.slicePlane==null)return Zs;const n=DSe(t,e,r),s=NSe(n,r.slicePlane),o=FSe(t,n,r);return o!=null?(oe(TC,i,s),De(M5,s,o),De(TC,TC,o),ae(TC,TC,M5)):i}const ftt=O(),M5=O(),TC=O(),mtt=_e();function GP(t,e){const r=e.output===D.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(E.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(E.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(w`
     void forwardObjectAndLayerIdColor() {
      ${r?i?w`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:w`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:w``} }`),t.fragment.code.add(w`
      void outputObjectAndLayerIdColor() {
        ${r?w`fragColor = objectAndLayerIdColorVarying;`:w``} }`)}function gtt(t,e){const{vertex:r,fragment:i}=t;r.include(x8),e.hasMultipassGeometry&&r.include(Nxe),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(w`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?w`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(wu),e.hasMultipassTerrain&&i.uniforms.add(new Ye("terrainDepthTexture",(n,s)=>s.multipassTerrain.linearDepthTexture),new yr("nearFar",(n,s)=>s.camera.nearFar)),i.include(Pc),i.code.add(w`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?w`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const ytt=$t(1,1,0,1),kSe=$t(1,0,1,1);function c0(t){t.fragment.uniforms.add(new Ye("depthTexture",(e,r)=>r.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",ytt).add("unoccludedHighlightFlag","vec4",kSe),t.fragment.code.add(w`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let zSe=class extends ln{constructor(e,r,i){super(e,"vec4",jr.Pass,(n,s,o)=>n.setUniform4fv(e,r(s,o)),i)}},Sl=class extends ln{constructor(e,r,i){super(e,"float",jr.Pass,(n,s,o)=>n.setUniform1fv(e,r(s,o)),i)}};const WS={unknown:1,inches:fo(1,"meters","inches"),feet:fo(1,"meters","feet"),"us-feet":fo(1,"meters","us-feet"),yards:fo(1,"meters","yards"),miles:fo(1,"meters","miles"),"nautical-miles":fo(1,"meters","nautical-miles"),millimeters:fo(1,"meters","millimeters"),centimeters:fo(1,"meters","centimeters"),decimeters:fo(1,"meters","decimeters"),meters:fo(1,"meters","meters"),kilometers:fo(1,"meters","kilometers"),"decimal-degrees":1/m5e(1,"meters",Kt.radius)};var aa,boe;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(aa||(aa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(boe||(boe={}));let sJ=class{constructor(e){this.field=e}},_tt=class extends sJ{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[aa.Undefined,aa.Undefined,aa.Undefined]}},vtt=class extends sJ{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},btt=class extends sJ{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},wtt=class{};function SC(t){return t!=null}function gx(t){return typeof t=="number"}function T8(t){return typeof t=="string"}function xtt(t){return t==null||T8(t)}function os(t,e){t&&t.push(e)}function Ttt(t,e,r,i=_e()){const n=t||0,s=e||0,o=r||0;return n!==0&&AS(i,i,-n/180*Math.PI),s!==0&&CS(i,i,s/180*Math.PI),o!==0&&M6(i,i,o/180*Math.PI),i}function $0(t,e,r,i,n){const s=t.minSize,o=t.maxSize;if(t.expression)return os(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=aa.DefinedSize,!0}if(SC(t.field))return SC(t.stops)?t.stops.length===2&&gx(t.stops[0].size)&&gx(t.stops[1].size)?(woe(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=aa.DefinedSize,!0):(os(n,"Could not convert size info: stops only supported with 2 elements"),!1):gx(s)&&gx(o)&&SC(t.minDataValue)&&SC(t.maxDataValue)?(woe(s,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=aa.DefinedSize,!0):t.valueUnit==="unknown"?(os(n,"Could not convert size info: proportional size not supported"),!1):WS[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/WS[t.valueUnit],e.type[r]=aa.DefinedSize,!0):(os(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!SC(t.field)){if(t.stops&&t.stops[0]&&gx(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=aa.DefinedSize,!0;if(gx(s))return e.minSize[r]=s,e.maxSize[r]=s,e.offset[r]=s,e.factor[r]=0,e.type[r]=aa.DefinedSize,!0}return os(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function woe(t,e,r,i,n,s){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-r*o,n.factor[s]=o}function Stt(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return os(i,"Could not convert size info: unsupported property"),null;if(!xtt(t.field))return os(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return os(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new _tt(t.field);let n;switch(t.axis){case"width":return n=$0(t,e.size,0,r,i),n?e:null;case"height":return n=$0(t,e.size,2,r,i),n?e:null;case"depth":return n=$0(t,e.size,1,r,i),n?e:null;case"width-and-depth":return n=$0(t,e.size,0,r,i),n&&$0(t,e.size,1,r,i),n?e:null;case null:case void 0:case"all":return n=$0(t,e.size,0,r,i),n=n&&$0(t,e.size,1,r,i),n=n&&$0(t,e.size,2,r,i),n?e:null;default:return os(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function Ett(t,e,r){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===aa.DefinedSize&&(s*=e.modelSize[n],t.type[n]=aa.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let i;if(t.type[0]!==aa.Undefined)i=0;else if(t.type[1]!==aa.Undefined)i=1;else{if(t.type[2]===aa.Undefined)return os(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)t.type[n]===aa.Undefined&&(t.minSize[n]=t.minSize[i],t.maxSize[n]=t.maxSize[i],t.offset[n]=t.offset[i],t.factor[n]=t.factor[i],t.type[n]=t.type[i]);return!0}function xoe(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function Ctt(t,e,r){if(t.normalizationField)return os(r,"Could not convert color info: unsupported property"),null;if(T8(t.field)){if(!t.stops)return os(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return os(r,"Could not convert color info: too many color stops"),null;e.color=new vtt(t.field);const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.color.values[n]=s.value,xoe(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return os(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,xoe(e.color.colors,n,i)}}return e}function Att(t,e,r){if(t.normalizationField)return os(r,"Could not convert opacity info: unsupported property"),null;if(T8(t.field)){if(!t.stops)return os(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return os(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new btt(t.field);const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return os(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=i}}return e}function E9(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function Ott(t,e,r){if(!T8(t.field))return os(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return os(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return E9(t,e.rotation,0),e;case"roll":return E9(t,e.rotation,1),e;case null:case void 0:case"heading":return E9(t,e.rotation,2),e;default:return os(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let jP=class{constructor(e,r=[1,1,1],i=[1,1,1],n=1,s=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=n,this.anchor=s,this.scale=o,this.rotation=a}};function BSe(t,e,r){if(!t)return null;const i=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return os(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return e.supports.size?Stt(s,n,e,r):n;case"color":return e.supports.color?Ctt(s,n,r):n;case"opacity":return e.supports.opacity?Att(s,n,r):null;case"rotation":return e.supports.rotation?Ott(s,n,r):n;default:return null}},new wtt);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!Ett(i.size,e,r)?null:i:null}let Rtt=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function qS(t,e){if(!t||Kr.TESTS_DISABLE_FAST_UPDATES)return null;const r=BSe(t.visualVariables,e);return r?new Rtt(r,GSe(r,e),!!r.size):null}function XS(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,n=BSe(e.visualVariables,r);return!!n&&!!(iI(i.size,n.size,"size")&&iI(i.color,n.color,"color")&&iI(i.rotation,n.rotation,"rotation")&&iI(i.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=GSe(n,r),t.requiresShaderTransformation=!!n.size,!0)}function iI(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,n=e;for(let s=0;s<3;s++)if(i.type[s]!==n.type[s]||i.offset[s]!==n.offset[s]||i.factor[s]!==n.factor[s])return!1}return!0}let VSe=class extends Wr{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function GSe(t,e){const r=new VSe(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,Nh(hO),Ttt(e.rotation[2],e.rotation[0],e.rotation[1],hO),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||hi(),Ac(r.vvSymbolRotationMatrix,hO)),r}function FH(t,e,r){if(!t.vvSize)return r;In(I0,r);const i=t.vvSymbolRotationMatrix;am(hO,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),Vr(I0,I0,hO);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];Toe[n]=ge(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return AP(I0,I0,Toe),Ml(I0,I0,t.vvSymbolAnchor),I0}function Ptt(t,e,r){if(e.vvSize)for(let i=0;i<3;++i){const n=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=ge(n,e.vvSize.minSize[i],e.vvSize.maxSize[i])}else ne(t,1,1,1)}function ip(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const I0=_e(),Toe=O(),hO=_e();let HP=class extends VSe{constructor(){super(...arguments),this.renderOccluded=Ri.Occlude}};const WT=8;function Tg(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(E.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new Lt("vvSizeMinSize",n=>n.vvSize.minSize)),r.uniforms.add(new Lt("vvSizeMaxSize",n=>n.vvSize.maxSize)),r.uniforms.add(new Lt("vvSizeOffset",n=>n.vvSize.offset)),r.uniforms.add(new Lt("vvSizeFactor",n=>n.vvSize.factor)),r.uniforms.add(new Gh("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),r.uniforms.add(new Lt("vvSymbolAnchor",n=>n.vvSymbolAnchor)),r.code.add(w`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(w`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?w`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(w`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",WT),r.uniforms.add(new Sl("vvColorValues",n=>n.vvColor.values,WT),new zSe("vvColorColors",n=>n.vvColor.colors,WT)),r.code.add(w`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?w`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(w`vec4 vvColor() { return vec4(1.0); }`)}const $5=.1,vo=.001;function Mtt(t){const e=new mr,r=t.signedDistanceFieldEnabled;if(e.include(lSe,t),e.include(fn,t),t.occlusionPass)return e.include(gtt,t),e;const{vertex:i,fragment:n}=e;e.include(XQ),n.include(Pc),n.include(cm),e.include(Tg,t),e.include(GP,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add(new Jt("viewport",(c,u)=>u.camera.fullViewport),new yr("screenOffset",(c,u)=>er(jSe,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new yr("anchorPosition",c=>I5(c)),new Jt("materialColor",c=>c.color)),LE(i,t),r&&(i.uniforms.add(new Jt("outlineColor",c=>c.outlineColor)),n.uniforms.add(new Jt("outlineColor",c=>Soe(c)?c.outlineColor:Nf),new Ce("outlineSize",c=>Soe(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(_et(i),w8(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.COLOR,"vec4"),e.attributes.add(E.SIZE,"vec2"),e.attributes.add(E.AUXPOS2,"vec4"),i.code.add(w`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?w`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:w`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const s=w`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&i.include(x8);const o=t.pixelSnappingEnabled?r?w`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:w`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:w`posProj += quadOffset;`;i.code.add(w`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===D.ObjectAndLayerIdColor?w`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${w.float(vo)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${w.float(vo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?w`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new Ye("tex",c=>c.texture));const a=t.debugDrawLabelBorder?w`(isBorder > 0.0 ? 0.0 : ${w.float($5)})`:w.float($5),l=w`
    ${t.debugDrawLabelBorder?w`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?w`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${w.float(IR)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${w.float(vo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:w`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?w`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===D.Alpha&&n.code.add(w`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===D.ObjectAndLayerIdColor&&n.code.add(w`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===D.Color&&n.code.add(w`
    void main() {
      ${l}
      ${t.transparencyPassType===rt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===D.Highlight&&(e.include(c0,t),n.code.add(w`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?w`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function Soe(t){return t.outlineColor[3]>0&&t.outlineSize>0}function I5(t,e=jSe){return t.textureIsSignedDistanceField?$tt(t.anchorPosition,t.distanceFieldBoundingBox,e):fs(e,t.anchorPosition),e}function $tt(t,e,r){e!=null?er(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):er(r,0,0)}const jSe=Ne(),Itt=Object.freeze(Object.defineProperty({__proto__:null,build:Mtt,calculateAnchorPosForRendering:I5},Symbol.toStringTag,{value:"Module"})),fu=So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),Ltt=Cc(ve.ONE,ve.ONE),HSe=Cc(ve.ZERO,ve.ONE_MINUS_SRC_ALPHA);function u0(t){return t===rt.FrontFace?null:t===rt.Alpha?HSe:Ltt}function S8(t){return t===rt.FrontFace?$l:null}const E8=5e5,C8={factor:-1,units:-2};function A8(t){return t?C8:null}function f1(t,e=Hr.LESS){return t===rt.NONE||t===rt.FrontFace?e:Hr.LEQUAL}let WSe=class qSe extends Tr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global}initializeProgram(e){return new vr(e.rctx,qSe.shader.get().build(this.configuration),fr)}_setPipelineState(e){const r=this.configuration,i=e===rt.NONE,n=e===rt.FrontFace,s=this.configuration.hasPolygonOffset?Dtt:null,o=(i||n)&&r.output!==D.Highlight&&(r.depthEnabled||r.occlusionPass)?$l:null;return Ot({blending:r.output===D.Color||r.output===D.Alpha||r.output===D.Highlight?i?Ntt:u0(e):null,depthTest:{func:Hr.LEQUAL},depthWrite:o,colorWrite:Ft,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Et.POINTS:Et.TRIANGLES}};WSe.shader=new _r(Itt,()=>ce(()=>import("./HUDMaterial.glsl-6c800f3a.js"),[]));const Dtt={factor:0,units:-4},Ntt=Cc(ve.ONE,ve.ONE_MINUS_SRC_ALPHA);let Tn=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.screenCenterOffsetUnitsEnabled=Tl.World,this.transparencyPassType=rt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};h([U({count:D.COUNT})],Tn.prototype,"output",void 0),h([U({count:Tl.COUNT})],Tn.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([U({count:rt.COUNT})],Tn.prototype,"transparencyPassType",void 0),h([U()],Tn.prototype,"spherical",void 0),h([U()],Tn.prototype,"occlusionTestEnabled",void 0),h([U()],Tn.prototype,"signedDistanceFieldEnabled",void 0),h([U()],Tn.prototype,"vvSize",void 0),h([U()],Tn.prototype,"vvColor",void 0),h([U()],Tn.prototype,"hasVerticalOffset",void 0),h([U()],Tn.prototype,"hasScreenSizePerspective",void 0),h([U()],Tn.prototype,"debugDrawLabelBorder",void 0),h([U()],Tn.prototype,"binaryHighlightOcclusionEnabled",void 0),h([U()],Tn.prototype,"hasSlicePlane",void 0),h([U()],Tn.prototype,"hasPolygonOffset",void 0),h([U()],Tn.prototype,"depthEnabled",void 0),h([U()],Tn.prototype,"pixelSnappingEnabled",void 0),h([U()],Tn.prototype,"draped",void 0),h([U()],Tn.prototype,"hasMultipassGeometry",void 0),h([U()],Tn.prototype,"hasMultipassTerrain",void 0),h([U()],Tn.prototype,"cullAboveGround",void 0),h([U()],Tn.prototype,"occlusionPass",void 0),h([U()],Tn.prototype,"objectAndLayerIdColorInstanced",void 0),h([U({constValue:!0})],Tn.prototype,"hasSliceInVertexProgram",void 0),h([U({constValue:!1})],Tn.prototype,"hasVvInstancing",void 0);let YS=class extends p1{constructor(e){super(e,new Wtt),this._configuration=new Tn}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Tl.Screen:Tl.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===le.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===D.Color||e===D.Alpha),e===D.Color&&(this._configuration.debugDrawLabelBorder=!!Kr.LABELS_SHOW_BORDER),e===D.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(Ac(A9,r),e.shaderTransformer!=null){const x=e.shaderTransformer(Aoe);l=x[0],c=x[5],ktt(A9)}const u=e.vertexAttributes.get(E.POSITION),d=e.vertexAttributes.get(E.SIZE),p=e.vertexAttributes.get(E.NORMAL),m=e.vertexAttributes.get(E.AUXPOS1);Je(u.size>=3);const y=i.point,_=i.camera,v=I5(a);l*=_.pixelRatio,c*=_.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<u.data.length/u.size;x++){const T=x*u.size;ne(Zo,u.data[T],u.data[T+1],u.data[T+2]),De(Zo,Zo,r);const S=x*d.size;L0[0]=d.data[S]*l,L0[1]=d.data[S+1]*c,De(Zo,Zo,_.viewMatrix);const A=x*m.size;if(ne(Lc,m.data[A],m.data[A+1],m.data[A+2]),!b&&(Zo[0]+=Lc[0],Zo[1]+=Lc[1],Lc[2]!==0)){const R=Lc[2];me(Lc,Zo),ae(Zo,Zo,te(Lc,Lc,R))}const C=x*p.size;if(ne(EC,p.data[C],p.data[C+1],p.data[C+2]),this._normalAndViewAngle(EC,A9,_,O9),this._applyVerticalOffsetTransformationView(Zo,O9,_,C9),_.applyProjection(Zo,Ca),Ca[0]>-1){Ca[0]=Math.floor(Ca[0]),Ca[1]=Math.floor(Ca[1]),b&&(Lc[0]||Lc[1])&&(Ca[0]+=Lc[0],Lc[1]!==0&&(Ca[1]+=qQ(Lc[1],C9.factorAlignment)),_.unapplyProjection(Ca,Zo)),Ca[0]+=this.parameters.screenOffset[0],Ca[1]+=this.parameters.screenOffset[1],KTe(L0,C9.factor,L0);const R=Gtt*_.pixelRatio;let P=0;if(a.textureIsSignedDistanceField&&(P=a.outlineSize*_.pixelRatio/2),y&&Eoe(y,Ca[0],Ca[1],L0,R,P,a,v)){const F=i.ray;if(De(Coe,Zo,us(Vtt,_.viewMatrix)),Ca[0]=y[0],Ca[1]=y[1],_.unprojectFromRenderScreen(Ca,Zo)){const k=O();re(k,F.direction);const V=1/Te(k);te(k,k,V),o(ci(F.origin,Zo)*V,k,-1,!0,1,Coe)}}}}}intersectDraped(e,r,i,n,s,o){const a=e.vertexAttributes.get(E.POSITION),l=e.vertexAttributes.get(E.SIZE),c=this.parameters,u=I5(c);let d=1,p=1;if(e.shaderTransformer!=null){const y=e.shaderTransformer(Aoe);d=y[0],p=y[5]}d*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const m=jtt*e.screenToWorldRatio;for(let y=0;y<a.data.length/a.size;y++){const _=y*a.size,v=a.data[_],b=a.data[_+1],x=y*l.size;L0[0]=l.data[x]*d,L0[1]=l.data[x+1]*p;let T=0;c.textureIsSignedDistanceField&&(T=c.outlineSize*e.screenToWorldRatio/2),Eoe(n,v,b,L0,m,T,c,u)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new Xtt(this)}_normalAndViewAngle(e,r,i,n){return yet(r)&&(r=Ac(Btt,r)),zo(n.normal,e,r),De(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=fe(XSe,Htt),n}_updateScaleInfo(e,r,i){const n=this.parameters;n.screenSizePerspective!=null?hoe(i,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment!=null?hoe(i,r,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,n,s,o,a){const l=this._normalAndViewAngle(r,i,s,O9);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,r,i,n,s){return this._applyCenterOffsetNDC(e,r,i,n),s!=null&&re(s,n),this._applyPolygonOffsetNDC(n,r,i,n),n}_applyPolygonOffsetView(e,r,i,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return re(s,e);const c=ge(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return te(s,e,l>0?u:1/u),s}_applyVerticalGroundOffsetView(e,r,i,n){const s=Te(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(s),l=te(Zo,r.normal,o*a);return oe(n,e,l),n}_applyVerticalOffsetTransformationView(e,r,i,n){const s=this.parameters;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=Te(e);this._updateScaleInfo(n,c,r.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=Te(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,l=pSe(i,o,s.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(n,o,r.cosAngle),te(r.normal,r.normal,l),oe(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const n=this.parameters.centerOffsetUnits!=="screen";return i!==e&&re(i,e),n&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(me(EC,i),oe(i,i,te(EC,EC,r[2])))),i}_applyCenterOffsetNDC(e,r,i,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&re(n,e),s||(n[0]+=r[0]/i.fullWidth*2,n[1]+=r[1]/i.fullHeight*2),n}_applyPolygonOffsetNDC(e,r,i,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&re(n,e),s){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);n[2]-=(a||o)*s}return n}requiresSlot(e,r){if(r===D.Color||r===D.Alpha||r===D.Highlight||r===D.ObjectAndLayerIdColor){if(e===le.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:n}=this.parameters;return e===(i?le.LABEL_MATERIAL:le.HUD_MATERIAL)||n&&e===le.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new Ftt(e)}calculateRelativeScreenBounds(e,r,i=jt()){return Utt(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},Ftt=class extends XZ{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(WSe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function Utt(t,e,r,i=ztt){return fs(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function ktt(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+r*r+i*i),d=1/Math.sqrt(n*n+s*s+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=n*d,t[4]=s*d,t[5]=o*d,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function Eoe(t,e,r,i,n,s,o,a){let l=e-n-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*n,u=r-n-(a[1]>0?i[1]*a[1]:0),d=u+i[1]+2*n;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),d-=i[1]*(1-p[3]),l-=s,c+=s,u-=s,d+=s),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<d}const C9=new ySe,ztt=Ne(),Zo=O(),EC=O(),Ca=Qt(),XSe=O(),Coe=O(),A9=hi(),Btt=hi(),Vtt=_e(),Lc=O(),O9={normal:XSe,cosAngle:0},Aoe=_e(),Gtt=1,jtt=2,L0=[0,0],Htt=Se(0,0,1);let Wtt=class extends vxe{constructor(){super(...arguments),this.renderOccluded=Ri.Occlude,this.color=$t(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=or(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=$t(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const YSe=Gi().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4u8(E.COLOR).vec2f(E.SIZE).vec4f(E.AUXPOS1).vec4f(E.AUXPOS2),qtt=YSe.clone().vec4u8(E.OBJECTANDLAYERIDCOLOR);let Xtt=class{constructor(e){this._material=e,this.vertexBufferLayout=se("enable-feature:objectAndLayerId-rendering")?qtt:YSe}elementCount(e){return 6*e.indices.get(E.POSITION).length}write(e,r,i,n,s){eJ(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,e,n.position,s,6),tJ(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,n.normal,s,6);const o=i.vertexAttributes.get(E.UV0).data;let a,l,c,u;if(o==null||o.length<4){const b=this._material.parameters;a=0,l=0,c=b.texCoordScale[0],u=b.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let d=i.indices.get(E.POSITION).length,p=s;const m=n.uv0;for(let b=0;b<d;++b)m.set(p,0,a),m.set(p,1,l),p+=1,m.set(p,0,c),m.set(p,1,l),p+=1,m.set(p,0,c),m.set(p,1,u),p+=1,m.set(p,0,c),m.set(p,1,u),p+=1,m.set(p,0,a),m.set(p,1,u),p+=1,m.set(p,0,a),m.set(p,1,l),p+=1;vSe(i.indices.get(E.COLOR),i.vertexAttributes.get(E.COLOR).data,4,n.color,s,6);const y=i.indices.get(E.SIZE),_=i.vertexAttributes.get(E.SIZE).data;d=y.length;const v=n.size;p=s;for(let b=0;b<d;++b){const x=_[2*y[b]],T=_[2*y[b]+1];for(let S=0;S<6;++S)v.set(p,0,x),v.set(p,1,T),p+=1}if(i.indices.get(E.AUXPOS1)&&i.vertexAttributes.get(E.AUXPOS1)?HS(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,n.auxpos1,s,6):voe(n.auxpos1,s,6*d),i.indices.get(E.AUXPOS2)&&i.vertexAttributes.get(E.AUXPOS2)?HS(i.indices.get(E.AUXPOS2),i.vertexAttributes.get(E.AUXPOS2).data,n.auxpos2,s,6):voe(n.auxpos2,s,6*d),i.objectAndLayerIdColor!=null&&i.indices.get(E.POSITION)){const b=i.indices.get(E.POSITION).length,x=n.getField(E.OBJECTANDLAYERIDCOLOR,ya);bSe(i.objectAndLayerIdColor,x,b,s,6)}}};const Mp=O(),yx=Qt(),CC=Qt(),R9=O(),Ytt=_e(),Ztt=vn(),P9=qs(),Qtt=O(),Jtt=jt();class Ktt{constructor(){this.aabr=jt(),this.distance=0,this.culled=!1,this.visible=!1}}class ert{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var ec;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(ec||(ec={}));class ZSe{constructor(){this.camera=new lt,this.slicePlane=e0(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),zw(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let fT=class extends xe{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new ZSe,this._state=ec.Idle,this._active=new Map,this._visible=new Map,this._iterators=new nrt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==ec.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/ec.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case ec.Idle:this._startUpdate(),t.madeProgress();case ec.Process:if(this._state=ec.Process,!this._processActiveGraphics(t))return;case ec.Sort:if(this._state=ec.Sort,!this._sortVisibleGraphics(t))return;case ec.Deconflict:if(this._state=ec.Deconflict,!this._deconflictVisibleGraphics(t))return;default:set(this,this._visible),this._state=ec.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof YS}_startUpdate(){oet(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new Ktt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),trt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=wE(Ytt,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Ztt:null;let n=0;for(i!=null&&(De(i,Zs,this._runningViewState.camera.viewMatrix),i[3]=Mr(this.view.spatialReference).radius,n=_be(i,Zs));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===js.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled)continue;const o=n.graphics3DGraphic,a=!r||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),cet(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Ooe(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Ooe(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=rrt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(js.GRAPHIC,Uo.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);Ih(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=art,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Mp)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(s.culled=!0);this._expandBoundingRect(s,l,c,a)}a==null?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;De(Mp,a,i.viewMatrix);const l=s.vertexAttributes,c=l.get(E.NORMAL).data,u=l.get(E.AUXPOS1).data;o.applyShaderOffsetsView(Mp,c,n.transformation,u,i,r.scaleInfo,Mp),gi(yx,Mp[0],Mp[1],Mp[2],1),au(CC,yx,i.projectionMatrix),te(r.positionNDC,CC,1/CC[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,R9),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(R9[2]),r.distance=R9[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),gi(CC,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),au(yx,CC,e),ew(yx,yx,1/yx[3]),ne(r.positionView,Mp[0],Mp[1],Mp[2])}_isCulledByHorizon(t,e,r){return re(P9.direction,t.positionView),ne(P9.origin,0,0,0),!!u1(e,P9,Qtt)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&CZ(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:n}){const s=this._runningViewState.camera,o=e.getScreenSize(srt);KTe(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=E4(r.calculateRelativeScreenBounds(o,n.factorAlignment.scale,Jtt),wt(0,s.fullWidth,.5+.5*i[0]),wt(0,s.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(nu(a),lp(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}S_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let n=Math.floor(r.aabr[1]/this._accBinsSizeY);n<=Math.floor(r.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;const s=this._accBins[i][n];for(let o=0;o<s.length;o++){const a=s.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,f6(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)i.push(new Nt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,Uo.DECONFLICTION,e),this.visibilityGroup===js.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function trt(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,Uo.DECONFLICTION,!0)}function*Ooe(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*rrt(t,e,r){e.clear(),t.forEach((n,s)=>{const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(r,Uo.DECONFLICTION);const a=n.info&&n.info[r];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=i.next();!n.done;n=i.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}h([f({constructOnly:!0})],fT.prototype,"view",void 0),h([f({type:Boolean,readOnly:!0})],fT.prototype,"updating",null),fT=h([N("esri.views.3d.layers.graphics.Deconflictor")],fT);class irt{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class nrt{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Nt({allocator:n=>n||new irt})}}const srt=Ne();class ort{constructor(){this.positionView=O(),this.positionNDC=O(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new ySe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const art=new ort,lrt=2e3;let GD=class extends fT{constructor(e){super(e),this.visibilityGroup=js.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Ho.YIELD;const r=performance.now();if(e.state!==Cr.IDLE&&r-this._lastDeconfliction<lrt)return Ho.YIELD;super.runTask(e),this.state===ec.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([f({constructOnly:!0})],GD.prototype,"parent",void 0),GD=h([N("esri.views.3d.layers.graphics.LabelDeconflictor")],GD);let UH=class extends fT{constructor(){super(...arguments),this._handles=new Vi,this._contexts=new Map,this._viewState=new ZSe,this.visibilityGroup=js.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ue(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),ue(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),ue(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Pr)]),this._frameTask=this.view.resourceController.scheduler.registerTask(dt.GRAPHICS_DECONFLICTOR,this),this._labels=new GD({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&M9(e));r.setVisibilityFlag(js.GRAPHIC,Uo.DECONFLICTION,i)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&Ibe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Do(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const n=i.graphic.uid,s=new ert(i,e.symbolCreationContext.slicePlaneEnabled);r.set(n,s),M9(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,r){const i=r.graphic.uid,n=e.get(i);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=M9(e);i||crt(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(n=>n.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function M9(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function crt(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(js.GRAPHIC,Uo.DECONFLICTION,!0))}UH=h([N("esri.views.3d.layers.graphics.GraphicsDeconflictor")],UH);function QSe(t){return 32+t.length}function JSe(t){return 16}function KSe(t){if(!t)return 0;let e=rEe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=QSe(i);break;case"number":e+=JSe();break;case"boolean":e+=4}}return e}function eEe(t){if(!t)return 0;if(Array.isArray(t))return urt(t);let e=rEe;for(const r in t)t.hasOwnProperty(r)&&(e+=tEe(t[r]));return e}function urt(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=iEe;for(let i=0;i<e;i++)r+=tEe(t[i]);return r}function tEe(t){switch(typeof t){case"object":return eEe(t);case"string":return QSe(t);case"number":return JSe();case"boolean":return 4;default:return 8}}function LIt(t,e){return iEe+t.length*e}const rEe=32,iEe=32,oJ=(t,e,r)=>[e,r],ZS=(t,e,r)=>[e,r,t[2]],aJ=(t,e,r)=>[e,r,t[2],t[3]];function DIt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function hrt({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function drt({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function nEe({scale:t,translate:e},r){return r*t[0]+e[0]}function sEe({scale:t,translate:e},r){return e[1]-r*t[1]}function oEe(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=t.scale;let o=nEe(t,r[0][0]),a=sEe(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*n,a-=c[1]*s,i[l]=e(c,o,a)}return i}function aEe(t,e,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=oEe(t,e,r[n]);return i}function prt(t,e,r,i){return oEe(t,r?i?aJ:ZS:i?ZS:oJ,e)}function frt(t,e,r,i){return aEe(t,r?i?aJ:ZS:i?ZS:oJ,e)}function mrt(t,e,r,i){return aEe(t,r?i?aJ:ZS:i?ZS:oJ,e)}function NIt(t,e,r,i,n){return e.x=hrt(t,r.x),e.y=drt(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m)),e}function lEe(t,e,r,i,n){return r!=null&&(e.points=prt(t,r.points,i,n)),e}function cEe(t,e,r,i,n){return r==null||(e.x=nEe(t,r.x),e.y=sEe(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m))),e}function uEe(t,e,r,i,n){return r!=null&&(e.rings=mrt(t,r.rings,i,n)),e}function hEe(t,e,r,i,n){return r!=null&&(e.paths=frt(t,r.paths,i,n)),e}var kH;let eA=kH=class extends ke{constructor(t){super(t),this.name=null,this.code=null}clone(){return new kH({name:this.name,code:this.code})}};h([f({type:String,json:{write:!0}})],eA.prototype,"name",void 0),h([f({type:[String,Number],json:{write:!0}})],eA.prototype,"code",void 0),eA=kH=h([N("esri.layers.support.CodedValue")],eA);const grt=new zn({inherited:"inherited",codedValue:"coded-value",range:"range"});let tA=class extends ke{constructor(e){super(e),this.name=null,this.type=null}};h([f({type:String,json:{write:!0}})],tA.prototype,"name",void 0),h([Vt(grt)],tA.prototype,"type",void 0),tA=h([N("esri.layers.support.Domain")],tA);const O8=tA;var zH;let rA=zH=class extends O8{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new zH({codedValues:ye(this.codedValues),name:this.name})}};h([f({type:[eA],json:{write:!0}})],rA.prototype,"codedValues",void 0),h([Vt({codedValue:"coded-value"})],rA.prototype,"type",void 0),rA=zH=h([N("esri.layers.support.CodedValueDomain")],rA);const dEe=rA;var BH;let jD=BH=class extends O8{constructor(t){super(t),this.type="inherited"}clone(){return new BH}};h([Vt({inherited:"inherited"})],jD.prototype,"type",void 0),jD=BH=h([N("esri.layers.support.InheritedDomain")],jD);const pEe=jD;var VH;let C2=VH=class extends O8{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new VH({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};h([f({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],C2.prototype,"maxValue",void 0),h([f({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],C2.prototype,"minValue",void 0),h([Vt({range:"range"})],C2.prototype,"type",void 0),C2=VH=h([N("esri.layers.support.RangeDomain")],C2);const fEe=C2,yrt={key:"type",base:O8,typeMap:{range:fEe,"coded-value":dEe,inherited:pEe}};function _rt(t){if(!t||!t.type)return null;switch(t.type){case"range":return fEe.fromJSON(t);case"codedValue":return dEe.fromJSON(t);case"inherited":return pEe.fromJSON(t)}return null}const vrt=new zn({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var GH;const brt=new zn({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Pa=GH=class extends ke{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?brt.fromJSON(r.fieldValueType):null}clone(){return new GH({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};h([f({type:String,json:{write:!0}})],Pa.prototype,"alias",void 0),h([f({type:[String,Number],json:{write:{allowNull:!0}}})],Pa.prototype,"defaultValue",void 0),h([f()],Pa.prototype,"description",void 0),h([lr("description")],Pa.prototype,"readDescription",null),h([f({types:yrt,json:{read:{reader:_rt},write:!0}})],Pa.prototype,"domain",void 0),h([f({type:Boolean,json:{write:!0}})],Pa.prototype,"editable",void 0),h([f({type:mn,json:{write:!0}})],Pa.prototype,"length",void 0),h([f({type:String,json:{write:!0}})],Pa.prototype,"name",void 0),h([f({type:Boolean,json:{write:!0}})],Pa.prototype,"nullable",void 0),h([Vt(vrt)],Pa.prototype,"type",void 0),h([f()],Pa.prototype,"valueType",void 0),h([lr("valueType",["description"])],Pa.prototype,"readValueType",null),h([f({type:Boolean,json:{read:!1}})],Pa.prototype,"visible",void 0),Pa=GH=h([N("esri.layers.support.Field")],Pa);const wrt=Pa;let UIt=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function zIt(t){return t.geometry!=null}let BIt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function GIt(t){var s;const e=v8e.fromJSON(t.geometryType),r=St.fromJSON(t.spatialReference),i=t.transform,n=t.features.map(o=>{const a=xrt(o,e,r,t.objectIdFieldName),l=a.geometry;if(l!=null&&i)switch(l.type){case"point":a.geometry=cEe(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=lEe(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=uEe(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=hEe(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:n,spatialReference:r,fields:((s=t.fields)==null?void 0:s.map(o=>wrt.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function xrt(t,e,r,i){return{uid:wc(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:Trt(t.geometry,e,r),visible:!0}}function Trt(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function Ww(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function Srt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)r+=s.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(n.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=Ky(t.vertexAttributes.position),e+=Ky(t.vertexAttributes.normal),e+=Ky(t.vertexAttributes.uv),e+=Ky(t.vertexAttributes.tangent)}return e}function jIt(t){let e=32;return e+=KSe(t.attributes),e+=3,e+=8+Srt(t.geometry),e}function Ert(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function HIt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function WIt(t,e){switch(vi(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)hk(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)hk(e,t.rings[r],!!t.hasZ);break;case"multipoint":hk(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function Crt(t,e){switch(Ih(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)KU(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)KU(e,t.rings[r]);break;case"multipoint":KU(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function qIt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function mEe(t){return"declaredClass"in t}function Roe(t){return"declaredClass"in t}function Art(t){return"declaredClass"in t}function Ort(t,e){return t?Art(t)?t:new z_({layer:e,sourceLayer:e,visible:t.visible,symbol:ye(t.symbol),attributes:ye(t.attributes),geometry:gEe(t.geometry)}):null}function gEe(t){return t==null?null:mEe(t)?t:oR(Rrt(t))}function Rrt(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,n={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:s,y:o,z:a,m:l}=t;return{x:s,y:o,z:a,m:l,spatialReference:n}}case"polygon":{const{rings:s,hasZ:o,hasM:a}=t;return{rings:Poe(s),hasZ:o,hasM:a,spatialReference:n}}case"polyline":{const{paths:s,hasZ:o,hasM:a}=t;return{paths:Poe(s),hasZ:o,hasM:a,spatialReference:n}}case"extent":{const{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:d,mmax:p,hasZ:m,hasM:y}=t;return{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:d,mmax:p,hasZ:m,hasM:y,spatialReference:n}}case"multipoint":{const{points:s,hasZ:o,hasM:a}=t;return{points:_Ee(s)?yEe(s):s,hasZ:o,hasM:a,spatialReference:n}}default:return}}function Poe(t){return Prt(t)?t.map(e=>yEe(e)):t}function yEe(t){return t.map(e=>Array.from(e))}function Prt(t){for(const e of t)if(e.length!==0)return _Ee(e);return!1}function _Ee(t){return t.length>0&&(cE(t[0])||uE(t[0]))}function Mrt(t,e){if(!t)return null;let r;if(Roe(t)){if(e==null)return t.clone();if(Roe(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=Ww(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function XIt(t){const{wkid:e,wkt:r,latestWkid:i}=t,n={wkid:e,wkt:r,latestWkid:i};return St.fromJSON(n)}const lJ="__begin__",cJ="__end__",$rt=new RegExp(lJ,"ig"),Irt=new RegExp(cJ,"ig"),Moe=new RegExp("^"+lJ,"i"),$oe=new RegExp(cJ+"$","i"),L5='"',Lrt=L5+" + ",Drt=" + "+L5;function Nrt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function YIt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function uJ(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Nrt(t.labelExpression),e.type="conventional"),e}function ZIt(t){const e=uJ(t);if(!e)return null;switch(e.type){case"conventional":return Frt(e.expression);case"arcade":return e.expression}return null}function QIt(t){const e=uJ(t);if(!e)return null;switch(e.type){case"conventional":return krt(e.expression);case"arcade":return vEe(e.expression)}return null}function Frt(t){let e;return t?(e=YF(t,r=>lJ+'$feature["'+r+'"]'+cJ),e=Moe.test(e)?e.replace(Moe,""):L5+e,e=$oe.test(e)?e.replace($oe,""):e+L5,e=e.replaceAll($rt,Lrt).replaceAll(Irt,Drt)):e='""',e}const Urt=/^\s*\{([^}]+)\}\s*$/i;function krt(t){const e=t==null?void 0:t.match(Urt);return e&&e[1].trim()||null}const zrt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Brt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Vrt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function vEe(t){if(!t)return null;let e=zrt.exec(t)||Brt.exec(t);return e?e[1]||e[3]:(e=Vrt.exec(t),e?e[2]:null)}const $9=J.getLogger("esri.layers.support.labelFormatUtils"),I9={type:"simple",evaluate:()=>null},Grt={getAttribute:(t,e)=>t.field(e)};async function bEe(t,e,r){if(!t||!t.symbol||!e)return I9;const i=t.where,n=uJ(t),s=i?await ce(()=>import("./WhereClause-c86b9974.js").then(a=>a.W),["assets/WhereClause-c86b9974.js","assets/executionError-c92d3b85.js"]):null;let o;if(n.type==="arcade"){const a=await R8e(n.expression,r,e);if(a==null)return I9;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){$9.error(new Y("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:n}))}return null},needsHydrationToEvaluate:()=>vEe(n.expression)==null}}else o={type:"simple",evaluate:a=>n.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),u=e.get(c);if(!u)return l;let d=null;return"attributes"in a?a&&a.attributes&&(d=a.attributes[u.name]):d=a.field(u.name),d==null?"":wEe(d,u)})};if(i){let a;try{a=s.WhereClause.create(i,e)}catch(c){return $9.error(new Y("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),I9}const l=o.evaluate;o.evaluate=c=>{const u="attributes"in c?void 0:Grt;try{if(a.testFeature(c,u))return l(c)}catch(d){$9.error(new Y("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:d}))}return null}}return o}function wEe(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const n=t;for(const s of r.codedValues)if(s.code===n)return s.name}else if(r.type==="range"){const n=+t,s="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(s<=n&&n<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=k_(i,f3("short-date")):t_e(e)&&(i=TS(+i)),i||""}const JIt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:bEe,formatField:wEe},Symbol.toStringTag,{value:"Module"}));let xEe=class{constructor(e=null,r="center",i="center",n=null,s=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",u=0,d=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=n,this.translation=s,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=u,this.displayHeight=d}};function hJ(t,e){if(t.type==="point")return D0(t,e,!1);if(mEe(t))switch(t.type){case"extent":return D0(t.center,e,!1);case"polygon":return D0(t.centroid,e,!1);case"polyline":return D0(Ioe(t),e,!0);case"mesh":return D0(t.origin,e,!1)}else switch(t.type){case"extent":return D0(jrt(t),e,!0);case"polygon":return D0(Hrt(t),e,!0);case"polyline":return D0(Ioe(t),e,!0)}}function Ioe(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=xye(e,wye(e)/2);return Ww(r[0],r[1],r[2],t.spatialReference)}function jrt(t){return Ww(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Hrt(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=Eye(t.rings,!!t.hasZ);return Ww(r[0],r[1],r[2],t.spatialReference)}function D0(t,e,r){const i=r?t:Mrt(t);return e&&t?Cve(t,i,e)?i:null:i}function eLt(t,e,r,i=0){if(t){e||(e=jt());const n=t;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),gi(e,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),e}return null}function TEe(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(E.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function dO(t,e,r=null){const i=PP(mh);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function tLt(t,e,r,i,n,s=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?s[o]=t[o]:r!=null&&r[o]!=null?s[o]=r[o]:s[o]=n[o];return s[3]=e??i??n[3],s}function Loe(t=pg,e,r,i=1){const n=new Array(3);if(e==null||r==null)n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,d=a===0&&!s&&!u,p=r[a];l==="symbol-value"||d?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=i;return na(n)}function Wrt(t){return t.isPrimitive!=null}function R8(t){return jH(Wrt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function jH(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function qrt(t,e,r,i=_e()){return t&&AS(i,i,-t/180*Math.PI),e&&CS(i,i,e/180*Math.PI),r&&M6(i,i,r/180*Math.PI),i}function dJ(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=el(e),n=Dw(t)*i,s=Nw(t)*i,o=c1(t)*(e.isGeographic?1:i);return n===0&&s===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(n,s,o)}function SEe(t,e,r,i,n,s,o,a,l,c,u){const d=tit[u.mode];let p,m,y=0;if($i(t,e,r,i,l.spatialReference,n,a))return d.requiresAlignment(u)?(y=d.applyElevationAlignmentBuffer(i,n,s,o,a,l,c,u),p=s,m=o):(p=i,m=n),$i(p,l.spatialReference,m,s,c.spatialReference,o,a)?y:void 0}function J_(t,e,r,i,n){const s=(T5(t)?t.z:STe(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=Af(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=Af(e,t,"ground")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=Af(e,t,"scene")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(s,i),a=Af(e,t,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function Xrt(t,e,r,i){return J_(t,e,r,i,mT),mT.z}function WP(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?an.UPDATE:t.onTheGroundChanged}function Bh(t){return t==="relative-to-ground"||t==="relative-to-scene"}function K_(t){return t!=="absolute-height"}function Yrt(t,e,r,i,n){J_(e,r,n,i,mT),TEe(t,mT.verticalDistanceToGround);const s=mT.sampledElevation,o=In(rit,t.transformation);return nI[0]=e.x,nI[1]=e.y,nI[2]=mT.z,ma(e.spatialReference,nI,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function Zrt(t,e,r,i,n,s){let o=0;const a=s.spatialReference;e*=3,i*=3;for(let l=0;l<n;++l){const c=t[e],u=t[e+1],d=t[e+2],p=s.getElevation(c,u,d,a,"ground")??0;o+=p,r[i]=c,r[i+1]=u,r[i+2]=p,e+=3,i+=3}return o/n}function Qrt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=s.spatialReference;e*=3,i*=3;for(let p=0;p<n;++p){const m=t[e],y=t[e+1],_=t[e+2],v=s.getElevation(m,y,_,d,"ground")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/n}function Jrt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,d=s.spatialReference;e*=3,i*=3;for(let p=0;p<n;++p){const m=t[e],y=t[e+1],_=t[e+2],v=s.getElevation(m,y,_,d,"scene")??0;l+=v,r[i]=m,r[i+1]=y,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/n}function Krt(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function eit(t,e,r,i,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let u=0;u<n;++u){const d=t[e],p=t[e+1],m=t[e+2];r[i]=d,r[i+1]=p,r[i+2]=c==null?m+l:l,e+=3,i+=3}return 0}let qP=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var an;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(an||(an={}));const tit={"absolute-height":{applyElevationAlignmentBuffer:eit,requiresAlignment:Krt},"on-the-ground":{applyElevationAlignmentBuffer:Zrt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Qrt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Jrt,requiresAlignment:()=>!0}},rit=_e(),mT=new qP,nI=O();function pJ(t){return t.mapPositions!=null}function EEe(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!pJ(l))continue;const{update:c,averageGeometrySampledElevation:u}=AEe(l,e,r,i,n);a+=u,c&&s.geometryVertexAttrsUpdated(l)}return a/o.length}function Lb(t,e,r,i,n,s){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,xl),TEe(o,xl.verticalDistanceToGround),l=xl.sampledElevation):(i(a,xl),e.mode!=="absolute-height"&&(l=xl.sampledElevation));const c=In(iit,s??o.transformation),u=ne(CEe,c[12],c[13],c[14]);Kr.TESTS_DISABLE_OPTIMIZATIONS?(wl[0]=a.x,wl[1]=a.y,wl[2]=xl.z,ma(a.spatialReference,wl,c,n.spatialReference)&&(s?In(s,c):o.transformation=c)):n.setAltitudeOfTransformation(xl.z,c);const d=fJ/n.unitInMeters;return(Math.abs(c[12]-u[0])>=d||Math.abs(c[13]-u[1])>=d||Math.abs(c[14]-u[2])>=d)&&(s?In(s,c):o.transformation=c),l}const iit=_e();function nit(t,e,r,i,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const o=e.centerPointInElevationSR;i(o,xl);const a=e.mode!=="absolute-height"?xl.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,u=oit;l.getGlobalTransform(c,u);const d=ne(CEe,u[12],u[13],u[14]);Kr.TESTS_DISABLE_OPTIMIZATIONS?(wl[0]=o.x,wl[1]=o.y,wl[2]=xl.z,ma(o.spatialReference,wl,u,n.spatialReference)&&l.setGlobalTransform(c,u)):n.setAltitudeOfTransformation(xl.z,u);const p=fJ/n.unitInMeters;return(Kr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-d[0])>=p||Math.abs(u[13]-d[1])>=p||Math.abs(u[14]-d[2])>=p)&&l.setGlobalTransform(c,u),a}function sit(t,e,r,i,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const d of o){if(!pJ(d))continue;const p=d.vertexAttributes.get(E.POSITION);if(p!==l){const{update:m,averageGeometrySampledElevation:y}=AEe(d,e,r,i,n);c=y,l=p,u=m}u&&s.geometryVertexAttrsUpdated(d),a+=c}return a/o.length}const fJ=.01,wl=O(),Pu=O(),_x=O(),oit=_e(),CEe=O(),xl=new qP;function AEe(t,e,r,i,n){let s=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;Pu[0]=o[12],Pu[1]=o[13],Pu[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(E.POSITION),c=l.data,u=l.size,d=c.length/u,p=new BQ(t.mapPositions,r);let m=0,y=0;for(let _=0;_<d;_++){if(_x[0]=c[m],_x[1]=c[m+1],_x[2]=c[m+2],i(p,xl),a&&(y+=xl.sampledElevation),Kr.TESTS_DISABLE_OPTIMIZATIONS)c[m]=p.array[p.offset],c[m+1]=p.array[p.offset+1],c[m+2]=xl.z,$i(c,r,m,c,n.spatialReference,m,1),c[m]-=Pu[0],c[m+1]-=Pu[1],c[m+2]-=Pu[2],s=!0;else{wl[0]=c[m]+Pu[0],wl[1]=c[m+1]+Pu[1],wl[2]=c[m+2]+Pu[2],n.setAltitude(wl,xl.z),c[m]=wl[0]-Pu[0],c[m+1]=wl[1]-Pu[1],c[m+2]=wl[2]-Pu[2];const v=fJ/n.unitInMeters;(Math.abs(_x[0]-c[m])>=v||Math.abs(_x[1]-c[m+1])>=v||Math.abs(_x[2]-c[m+2])>=v)&&(s=!0)}m+=u,p.offset+=3}return y/=d,{update:s,averageGeometrySampledElevation:y}}function ait(t){return!!t&&WS[t]!=null}function lit(t){return 1/(WS[t]||1)}function cit(){const t=Object.keys(WS);return t.sort(),t}const uit=cit(),hit=J.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function dit(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function iLt(t){const e=t&&t.expression;if(typeof e=="string"){const r=PEe(e);if(r!=null)return{cachedResult:r}}return null}async function nLt(t,e,r,i){const n=t&&t.expression;if(typeof n!="string")return null;const s=PEe(n);if(s!=null)return{cachedResult:s};const o=await $Y();Bt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function OEe(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function P8(t,e){if(t!=null&&!REe(t)){if(!e||!t.arcade)return void hit.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=gEe(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function pit(t){if(t!=null){if(REe(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function sLt(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const fit={cachedResult:0};function REe(t){return t.cachedResult!=null}function PEe(t){return t==="0"?0:null}let wp=class MEe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=lit(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=pit(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=ait(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&r!=null&&i!=null?(this._featureExpressionInfoContext=dit(e),P8(this._featureExpressionInfoContext,OEe(n.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new MEe;return e!=null&&r.setFromElevationInfo(e),r}},mit=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var zt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(zt||(zt={}));let git=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},um=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=Doe(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==i&&(s.objectTransparency=i,n=!0);n&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,n){if(this.elevationAligner==null)return;i!=null&&P8(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>J_(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,r,i){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=O()){return re(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=ps()){const r=this.stageObject.boundingVolumeObjectSpace;return C1e(e,r.min),A1e(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.shaderTransformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(_m)&&(De(_m,_m,this.stageObject.shaderTransformation),oe(e.render.origin,e.render.origin,_m),e.render.num++)}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=yit,l=QY(o)?1:a.length;for(let u=0;u<l;u++){const d=a[u];N0[0]=o[d[0]],N0[1]=o[d[1]],N0[2]=o[d[2]],De(N0,N0,this.stageObject.transformation),D1[3*u]=N0[0],D1[3*u+1]=N0[1],D1[3*u+2]=N0[2]}if(!e(D1,0,l))return null;vi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],D1[u+d]),o[d+3]=Math.max(o[d+3],D1[u+d]);c&&i.push({location:D1.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){jd(o,_m);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let d=0;if(r.useViewElevation)d=r.service.getElevation(_m[0],_m[1],u)??0;else try{const p=dJ(o,r.service.spatialReference,r);d=await r.service.queryElevation(_m[0],_m[1],n,p,u)??0}catch{}E1e(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(e,r){e===Hg.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===Hg.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const n=Doe(i.baseMaterial);for(const s of i.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function Doe(t){return t.isVisible()?t.parameters.transparent?zt.TRANSPARENT:zt.OPAQUE:zt.INVISIBLE}const D1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],N0=O(),_m=O(),yit=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let $Ee=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};var $n;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})($n||($n={}));let mJ=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=eu.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===eu.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===eu.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=eu.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=eu.FAILED,!Zn(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=yu(this._abortController):this._loadStatus===eu.LOADING&&(this._loadStatus=eu.FAILED),this._loader=null}};var eu;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(eu||(eu={}));const IEe=3,HH=3,LEe=10;let DEe=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function sI(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),HF(e)}function Noe(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})}),HF(e)}function NEe(t){const e=t.components.map(r=>r.geometry);return HF(e)}function Foe(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),HF(e)}function _it(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function FEe(t,e){const r=(i,n,s=!1)=>({levels:i.map(o=>{const a=n(o.tesselation);return s&&PXe(a),{components:[new DEe(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>AXe(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>_Xe(e,1));case"cone":return r(L9,i=>Nne(e,1,.5,i,!1),!0);case"inverted-cone":return r(L9,i=>Nne(e,1,.5,i,!0),!0);case"cylinder":return r(L9,i=>RXe(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>CXe(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>xXe(e,1),!0);default:return}}const L9=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function vit(t){return t.type==="fill"}function bit(t){return t.type==="extrude"}function wit(t){return t&&t.enabled&&(bit(t)||vit(t))&&t.edges!=null}function xit(t){return t&&t.enabled&&t.edges||null}function UEe(t,e){return Tit(xit(t),e)}function Tit(t,e){if(t==null)return null;const r=t.color!=null?_Z(it.toUnitRGBA(t.color)):$t(0,0,0,0),i=ha(t.size),n=ha(t.extensionLength);switch(t.type){case"solid":return Sit({color:r,size:i,extensionLength:n,...e});case"sketch":return Eit({color:r,size:i,extensionLength:n,...e});default:return}}function Sit(t){return{...Cit,...t,type:"solid"}}function Eit(t){return{...Ait,...t,type:"sketch"}}const Cit={color:$t(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:zt.OPAQUE,hasSlicePlane:!1},Ait={color:$t(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:zt.OPAQUE,hasSlicePlane:!1},gJ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function dLt(t){return t.type==="web-style"?gJ:yJ(t.symbolLayers.toArray().map(e=>kEe(t,e)))}function yJ(t){let e=0,r=0,i=0,n=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,n=n||a.estimated,++s);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:n,memory:o,numComplexities:s}}function pLt(t){const e=yJ(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const Uoe={};function kEe(t,e){var n;const r=zEe(t,e),i=wit(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return(n=e.resource)!=null&&n.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...Oit(e.resource&&e.resource.primitive||N1e),memory:r};case"path":{let s=0,o=0;switch(e.profile){case"circle":s=LEe;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":o=IEe;break;case"miter":case"bevel":o=1;break;default:return}const a=2*s,l=s*o*2;let c=-2*l-a;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(s-1);break;case"round":c+=2*(s*(HH-1)*2+s);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:l+a,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function zEe(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?sl.EXTRUDE_EDGES:sl.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?sl.FILL_OUTLINE:sl.FILL;case"water":return sl.FILL;case"line":return e.join==="round"?sl.LINE_ROUND:sl.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return sl.PATH_ROUND_CIRCLE;case"quad":return sl.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return sl.PATH_MITER_CIRCLE;case"quad":return sl.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?sl.OBJECT_POINT:sl.OBJECT_POLYGON;case"icon":case"text":return r?sl.ICON_POINT:sl.ICON_POLYGON;default:return}}function Oit(t){let e=Uoe[t];if(e)return e;const r=FEe(t,null);return e={primitivesPerFeature:NEe(r.levels[0]).reduce((i,n)=>i+n.indices.get(E.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Uoe[t]=e,e}const sl={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},vx=J.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let hm=class extends mJ{constructor(e,r,i,n){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=vx,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new wp,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=koe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=koe(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(r,i,n)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&vx.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const n=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(vx.warnOncePerTick(`${n} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(vx.warnOncePerTick(`${n} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return vx.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Rit}_defaultElevationInfoZ(){return Pit}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,n=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,r.mode=this.getGeometryElevationMode(i,n),r.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";s&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=s?fit:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=zoe){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=zoe){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return dO(null,i);const n=e!=null?it.toUnitRGB(e):pg;return dO(n,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=dO(i,n);return r&&(s[0]*=r,s[1]*=r,s[2]*=r,s[3]*=r),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return kEe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,n)!==an.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let n=an.UPDATE;return e.forEach(s=>{const o=r(s);if(o!=null){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else n=an.RECREATE}),n}applyRendererDiff(e,r){return $n.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?ip(r.size.field,e):0,n=r.color?ip(r.color.field,e):0,s=r.opacity?ip(r.opacity.field,e):0;return $t(i,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&vx.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,n,s,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((s=(n=this._fastUpdates)==null?void 0:n.visualVariables.color)==null?void 0:s.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function koe(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const n=r.stops[i].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const Rit={mode:"on-the-ground",offset:0,unit:"meters"},Pit={mode:"absolute-height",offset:0,unit:"meters"},zoe={hasIntrinsicColor:!1};let h0=class extends FP{get geometries(){return this._geometries}get transformation(){return this._transformation??yn}set transformation(e){this._transformation=In(this._transformation??_e(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(e){this._shaderTransformation=In(this._shaderTransformation??_e(),e),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(e={}){super(),this.type=on.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new BEe),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Je(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new h5(Hg.MaskOccludee);for(const r of this._geometries)r.occludees=sH(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=oH(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new h5(Hg.Highlight);for(const r of this._geometries)r.highlights=sH(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=oH(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return Vr(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=_e()){return Vr(r,this.shaderTransformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new Boe,this._validateBoundingVolume(this._bvWorldSpace,pO.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new Boe,this._validateBoundingVolume(this._bvObjectSpace,pO.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===pO.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&Mit(s,e,i?n.shaderTransformation:this.getCombinedShaderTransformation(n))}Lr(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const o=i?n.shaderTransformation:this.getCombinedShaderTransformation(n),a=MS(o);De(Voe,s.center,o);const l=ci(Voe,e.bounds),c=s.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},BEe=class{constructor(){this.min=Se(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Se(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Boe=class extends BEe{constructor(){super(...arguments),this.bounds=vn()}};function Mit(t,e,r){const i=t.bbMin,n=t.bbMax;if(L6(r)){const s=ne($it,r[12],r[13],r[14]);oe(Dc,i,s),oe(rd,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Dc[o]),e.max[o]=Math.max(e.max[o],rd[o])}else if(De(Dc,i,r),Bo(i,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],Dc[s]),e.max[s]=Math.max(e.max[s],Dc[s]);else{De(rd,n,r);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],Dc[s],rd[s]),e.max[s]=Math.max(e.max[s],Dc[s],rd[s]);for(let s=0;s<3;++s){re(Dc,i),re(rd,n),Dc[s]=n[s],rd[s]=i[s],De(Dc,Dc,r),De(rd,rd,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Dc[o],rd[o]),e.max[o]=Math.max(e.max[o],Dc[o],rd[o])}}}const $it=O(),Dc=O(),rd=O(),Voe=O();var pO;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(pO||(pO={}));function _J(t,e,r,i,n,s){const o=t.clippingExtent;if(Bi(e,p_,t.elevationProvider.spatialReference),o!=null&&!YY(o,p_))return null;Bi(e,p_,t.renderCoordsHelper.spatialReference),r.shaderTransformer=s,r.localOrigin=t.localOriginFactory.getOrigin(p_);const a=new h0({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:Yrt(a,e,t.elevationProvider,t.renderCoordsHelper,i)}}function LR(t,e,r){const i=t.elevationContext,n=r.spatialReference;Bi(e,p_,n),i.centerPointInElevationSR=Ww(p_[0],p_[1],e.hasZ?p_[2]:0,n??null)}function DR(t){switch(t.type){case"point":return t;case"polygon":case"extent":return hJ(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=xye(e,wye(e)/2);return Ww(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const p_=O();function VEe(){return new Float32Array(2)}function Iit(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function uh(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function Lit(t,e){return new Float32Array(t,e,2)}function GEe(){return VEe()}function jEe(){return uh(1,1)}function HEe(){return uh(1,0)}function WEe(){return uh(0,1)}const qEe=GEe(),XEe=jEe(),Dit=HEe(),Nit=WEe();Object.freeze(Object.defineProperty({__proto__:null,ONES:XEe,UNIT_X:Dit,UNIT_Y:Nit,ZEROS:qEe,clone:Iit,create:VEe,createView:Lit,fromValues:uh,ones:jEe,unitX:HEe,unitY:WEe,zeros:GEe},Symbol.toStringTag,{value:"Module"}));function Fit(t){const e=new mr,{vertex:r,fragment:i}=e;return r.include(x8),e.include(lSe,t),e.include(fn,t),e.attributes.add(E.UV0,"vec2"),r.uniforms.add(new Jt("viewport",(n,s)=>s.camera.fullViewport),new Ce("lineSize",(n,s)=>n.size>0?Math.max(1,n.size)*s.camera.pixelRatio:0),new yr("pixelToNDC",(n,s)=>er(joe,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Ce("borderSize",(n,s)=>n.borderColor!=null?s.camera.pixelRatio:0),new yr("screenOffset",(n,s)=>er(joe,n.screenOffset[0]*s.camera.pixelRatio,n.screenOffset[1]*s.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&w8(r),r.code.add(w`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?w`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?w`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:w`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?w`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:w`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?w`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:w`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new Jt("uColor",n=>Goe(n.color)),new Jt("borderColor",n=>Goe(n.borderColor))),t.hasMultipassGeometry&&(i.include(Nxe,t),i.uniforms.add(new yr("inverseViewport",(n,s)=>s.inverseViewport))),i.code.add(w`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?w`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:w`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function Goe(t){return t??Nf}const joe=Ne(),Uit=Object.freeze(Object.defineProperty({__proto__:null,build:Fit},Symbol.toStringTag,{value:"Module"}));let YEe=class ZEe extends Tr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global}initializeProgram(e){return new vr(e.rctx,ZEe.shader.get().build(this.configuration),fr)}setPipelineState(e){const r=e?Hr.ALWAYS:Hr.LESS;return this.configuration.depthHudEnabled?Ot({depthTest:{func:r},depthWrite:$l}):Ot({blending:So(ve.ONE,ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Ft})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};YEe.shader=new _r(Uit,()=>ce(()=>import("./LineCallout.glsl-cb1ab83b.js"),[]));let Xu=class extends Fo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Tl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};h([U({count:Tl.COUNT})],Xu.prototype,"screenCenterOffsetUnitsEnabled",void 0),h([U()],Xu.prototype,"spherical",void 0),h([U()],Xu.prototype,"occlusionTestEnabled",void 0),h([U()],Xu.prototype,"hasVerticalOffset",void 0),h([U()],Xu.prototype,"hasScreenSizePerspective",void 0),h([U()],Xu.prototype,"depthHudEnabled",void 0),h([U()],Xu.prototype,"depthHudAlignStartEnabled",void 0),h([U()],Xu.prototype,"hasSlicePlane",void 0),h([U()],Xu.prototype,"hasMultipassGeometry",void 0),h([U({constValue:!0})],Xu.prototype,"hasSliceInVertexProgram",void 0),h([U({constValue:!1})],Xu.prototype,"draped",void 0);let oI=class WH extends p1{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new QEe),this._configuration=new Xu,this._uniqueMaterialIdentifier=WH.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==le.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Tl.Screen:Tl.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===D.Color)switch(e){case le.LINE_CALLOUTS:case le.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new kit(e)}createBufferWriter(){return new Bit}validateParameters(e){const r=WH.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},kit=class extends h1{beginSlot(e){return this.ensureTechnique(YEe,e)}},QEe=class extends KQ{constructor(){super(...arguments),this.screenOffset=dp,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const zit=Gi().vec3f(E.POSITION).vec3f(E.NORMAL).vec2f(E.UV0).vec4f(E.AUXPOS1),Hoe=[uh(0,0),uh(1,0),uh(0,1),uh(1,0),uh(1,1),uh(0,1)];let Bit=class{constructor(){this.vertexBufferLayout=zit}elementCount(e){return 6*e.indices.get(E.POSITION).length}write(e,r,i,n,s){eJ(i.indices.get(E.POSITION),i.vertexAttributes.get(E.POSITION).data,e,n.position,s,6),tJ(i.indices.get(E.NORMAL),i.vertexAttributes.get(E.NORMAL).data,r,n.normal,s,6),HS(i.indices.get(E.AUXPOS1),i.vertexAttributes.get(E.AUXPOS1).data,n.auxpos1,s,6);for(let o=0;o<Hoe.length;++o)n.uv0.setVec(s+o,Hoe[o])}},JEe=class KEe extends hm{constructor(e,r){super(e,null,r,jit),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new oI(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||dp,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new QEe,r=this.symbol,i=r.callout;if(e.color=i.color!=null?it.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=ha(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:ha(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=i.border!=null&&i.border.color!=null?it.toUnitRGBA(i.border.color):null;const n=r.symbolLayers.at(0).type==="object",s=r.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return Git}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,n=this.setGraphicElevationContext(i,new wp,r.elevationOffset||0),s=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!V1e(l)))return null;const a=hJ(i.geometry);return a==null?null:this._createAs3DShape(a,n,r,i.uid)}layerOpacityChanged(){var e;(e=this._material)==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=WP(KEe.elevationModeChangeTypes,i,n);return s!==an.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){var e;return(e=this._material)==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){const n=super.setGraphicElevationContext(e,r);return n.addOffsetRenderUnits(i),n}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Bh(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:gJ.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,n=new Ue(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),s=new Ue(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[E.POSITION,n],[E.NORMAL,new Ue([0,0,1],3,!0)],[E.AUXPOS1,s]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=oI.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(i);return n==null&&(n=new oI(r),e.materialCollection.add(i,n)),{material:n,isUnique:!1}}return{material:new oI(r),isUnique:!0}}_createAs3DShape(e,r,i,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(i),l=new Xn(a.material,this._createVertexData(i),Vit,null,on.Point,o),c=_J(this._context,e,l,r,n);if(c==null)return null;const u=new um(this,c.object,[l],a.isUnique?[a.material]:null,null,Lb,r);return u.metadata=new $Ee(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=Bh(r.mode),LR(u,e,this._context.elevationProvider),u}};JEe.elevationModeChangeTypes={definedChanged:an.UPDATE,staysOnTheGround:an.UPDATE,onTheGroundChanged:an.RECREATE};const D9=[0],Vit=[[E.POSITION,D9],[E.NORMAL,D9],[E.AUXPOS1,D9]],Git={mode:"relative-to-ground",offset:0},jit={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let Hit=class{constructor(e,r,i=O(),n=Qt(),s=Ne(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=n,this.screenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},Wit=class extends mit{};const Woe=J.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function qit(t,e){if(!iZ(t))return Woe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=Xit[t.callout.type];return r?new r(t,e):(Woe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const Xit={line:JEe};let yw=class eCe{constructor(e=null,r={},i,n){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new eCe(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function SLt(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let ELt=class extends yw{},Yit=class tCe{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new tCe;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},e1=class HD{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,n,s]=e,o=n-r,a=s-i;return new HD([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let s=0;s<n;s++)e(this.coords[2*(s+r)],this.coords[2*(s+r)+1]);r+=n}}clone(e){return e?(e.set(this.coords),new HD(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new HD(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function _a(t,e){return t?e?4:3:e?3:2}const XP=J.getLogger("esri.layers.graphics.featureConversionUtils"),rCe={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},Zit=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s},qoe=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2]},Qit=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+3]},Jit=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2],t[r+3]=e[i+3]};function vJ(t,e,r,i){if(t){if(r)return e&&i?Jit:qoe;if(e&&i)return Qit}else if(e&&i)return qoe;return Zit}function N9({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function F9({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function U9({scale:t,translate:e},r,i){return r*t[i]+e[i]}function ALt(t,e,r){return t?e?r?xJ(t):bJ(t):r?wJ(t):M8(t):null}function M8(t){const e=t.coords;return{x:e[0],y:e[1]}}function iCe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function bJ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Kit(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function wJ(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function ent(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function xJ(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function tnt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function rnt(t,e,r,i){let n=M8;r&&i?n=xJ:r?n=bJ:i&&(n=wJ);for(const s of e){const{geometry:o,attributes:a}=s,l=o!=null?n(o):null;t.push({attributes:a,geometry:l})}return t}function TJ(t,e){return t&&e?tnt:t?Kit:e?ent:iCe}function int(t,e,r,i,n){const s=TJ(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?s(new e1,o):null;t.push(new yw(l,a,null,n?a[n]:void 0))}return t}function OLt(t,e,r=TJ(e.z!=null,e.m!=null)){return r(t,e)}function nnt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?nCe(n,r,i):null});return t}function nCe(t,e,r){if(t==null)return null;const i=_a(e,r),n=[];for(let s=0;s<t.coords.length;s+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[s+a]);n.push(o)}return e?r?{points:n,hasZ:e,hasM:r}:{points:n,hasZ:e}:r?{points:n,hasM:r}:{points:n}}function snt(t,e,r,i,n){const s=_a(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?sCe(new e1,o,s):null;t.push(new yw(l,a,null,n?a[n]:void 0))}return t}function sCe(t,e,r=_a(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let n=0;for(const s of e.points)for(let o=0;o<r;o++)i[n++]=s[o];return t}function ont(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?oCe(n,r,i):null});return t}function oCe(t,e,r){if(!t)return null;const i=_a(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(n[a++]);c.push(d)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function ant(t,e,r,i,n){const s=_a(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?aCe(new e1,o,s):null;t.push(new yw(l,a,null,n?a[n]:void 0))}return t}function aCe(t,e,r=_a(e.hasZ,e.hasM)){const{lengths:i,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)n[s++]=a[l];i.push(o.length)}return t}function lnt(t,e,r,i){for(const{geometry:n,attributes:s,centroid:o}of e){const a=n!=null?lCe(n,r,i):null;if(o!=null){const l=M8(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function lCe(t,e,r){if(!t)return null;const i=_a(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const d=[];for(let p=0;p<i;p++)d.push(n[a++]);c.push(d)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function cnt(t,e,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=s!=null?cCe(new e1,s,r,i):null,c=n?a[n]:void 0;o!=null?t.push(new yw(l,a,iCe(new e1,o),c)):t.push(new yw(l,a,null,c))}return t}function cCe(t,e,r=e.hasZ,i=e.hasM){return unt(t,e.rings,r,i)}function unt(t,e,r,i){const n=_a(r,i),{lengths:s,coords:o}=t;let a=0;Sg(t);for(const l of e){for(const c of l)for(let u=0;u<n;u++)o[a++]=c[u];s.push(l.length)}return t}const qT=[],fO=[];function RLt(t,e,r,i,n){qT[0]=t;const[s]=uCe(fO,qT,e,r,i,n);return mp(qT),mp(fO),s}function uCe(t,e,r,i,n,s){if(mp(t),!r){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new yw(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return int(t,e,i,n,s);case"esriGeometryMultipoint":return snt(t,e,i,n,s);case"esriGeometryPolyline":return ant(t,e,i,n,s);case"esriGeometryPolygon":return cnt(t,e,i,n,s);default:XP.error("convertToFeatureSet:unknown-geometry",new Y(`Unable to parse unknown geometry type '${r}'`)),mp(t)}return t}function PLt(t,e,r,i){fO[0]=t,hCe(qT,fO,e,r,i);const n=qT[0];return mp(qT),mp(fO),n}function hnt(t,e,r){if(t==null)return null;const i=new e1;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),SY(t)?TJ(e??t.z!=null,r??t.m!=null)(i,t):CY(t)?cCe(i,t,e,r):EY(t)?aCe(i,t,_a(e,r)):TY(t)?sCe(i,t,_a(e,r)):void XP.error("convertFromGeometry:unknown-geometry",new Y(`Unable to parse unknown geometry type '${t}'`))}function dnt(t,e,r,i){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=M8;return r&&i?s=xJ:r?s=bJ:i&&(s=wJ),s(n)}case"esriGeometryMultipoint":return nCe(n,r,i);case"esriGeometryPolyline":return oCe(n,r,i);case"esriGeometryPolygon":return lCe(n,r,i);default:return XP.error("convertToGeometry:unknown-geometry",new Y(`Unable to parse unknown geometry type '${e}'`)),null}}function pnt(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function hCe(t,e,r,i,n){if(mp(t),r==null)return pnt(t,e);switch(r){case"esriGeometryPoint":return rnt(t,e,i,n);case"esriGeometryMultipoint":return nnt(t,e,i,n);case"esriGeometryPolyline":return ont(t,e,i,n);case"esriGeometryPolygon":return lnt(t,e,i,n);default:XP.error("convertToFeatureSet:unknown-geometry",new Y(`Unable to parse unknown geometry type '${r}'`))}return t}function MLt(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:d,queryGeometryType:p}=t,m={features:hCe([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:u,queryGeometry:dnt(d,p,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),s&&(m.hasM=s),o&&(m.hasZ=o),m}function $Lt(t,e){const r=new Yit,{hasM:i,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:d}=t;return d&&(r.fields=d),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(s&&uCe(r.features,s,l,n,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),n&&(r.hasZ=n),u&&(r.transform=u),r):(XP.error(new Y("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function ILt(t){const{transform:e,features:r,hasM:i,hasZ:n}=t;if(!e)return t;for(const s of r)s.geometry!=null&&Yoe(s.geometry,s.geometry,i,n,e),s.centroid!=null&&Yoe(s.centroid,s.centroid,i,n,e);return t.transform=null,t}function LLt(t,e){const{geometryType:r,features:i,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new e1,Xoe(l.geometry,a.geometry,n,s,r,t),a.centroid&&(l.centroid=new e1,Xoe(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function Xoe(t,e,r,i,n,s,o=r,a=i){if(Sg(t),e==null||!e.coords.length)return null;const l=rCe[n],{coords:c,lengths:u}=e,d=_a(r,i),p=_a(r&&o,i&&a),m=vJ(r,i,o,a);if(!u.length)return m(t.coords,c,0,0,N9(s,c[0]),F9(s,c[1])),Sg(t,d,0),t;let y,_,v,b,x=0,T=0,S=T;for(const A of u){if(A<l)continue;let C=0;T=S,v=y=N9(s,c[x]),b=_=F9(s,c[x+1]),m(t.coords,c,T,x,v,b),C++,x+=d,T+=p;for(let R=1;R<A;R++,x+=d)v=N9(s,c[x]),b=F9(s,c[x+1]),v===y&&b===_||(m(t.coords,c,T,x,v-y,b-_),T+=p,C++,y=v,_=b);C>=l&&(t.lengths.push(C),S=T)}return mp(t.coords,S),t.coords.length?t:null}function DLt(t,e,r,i,n,s,o=r,a=i){if(Sg(t),!e||!e.coords.length)return null;const l=rCe[n],{coords:c,lengths:u}=e,d=_a(r,i),p=_a(r&&o,i&&a),m=vJ(r,i,o,a);if(!u.length)return m(t.coords,c,0,0,c[0],c[1]),Sg(t,d,0),t;let y=0;const _=s*s;for(const v of u){if(v<l){y+=v*d;continue}const b=t.coords.length/p,x=y,T=y+(v-1)*d;m(t.coords,c,t.coords.length,x,c[x],c[x+1]),qH(t.coords,c,d,_,m,x,T),m(t.coords,c,t.coords.length,T,c[T],c[T+1]);const S=t.coords.length/p-b;S>=l?t.lengths.push(S):mp(t.coords,b*p),y+=v*d}return t.coords.length?t:null}function fnt(t,e,r,i){const n=t[e],s=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let u=o,d=a,p=l-u,m=c-d;if(p!==0||m!==0){const y=((n-u)*p+(s-d)*m)/(p*p+m*m);y>1?(u=l,d=c):y>0&&(u+=p*y,d+=m*y)}return p=n-u,m=s-d,p*p+m*m}function qH(t,e,r,i,n,s,o){let a,l=i,c=0;for(let u=s+r;u<o;u+=r)a=fnt(e,u,s,o),a>l&&(c=u,l=a);l>i&&(c-s>r&&qH(t,e,r,i,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>r&&qH(t,e,r,i,n,c,o))}function NLt(t,e,r,i){if(e==null||!e.coords||!e.coords.length)return null;const n=_a(r,i);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let u=0;u<c.length;u+=n){const d=c[u],p=c[u+1];s=Math.min(s,d),a=Math.max(a,d),o=Math.min(o,p),l=Math.max(l,p)}}return Z7(t)?Q9e(t,s,o,a,l):yY(s,o,a,l,t),t}function Yoe(t,e,r,i,n){const{coords:s,lengths:o}=e,a=_a(r,i);if(!s.length)return t!==e&&Sg(t),t;GF(n);const{originPosition:l,scale:c,translate:u}=n,d=gnt;d.originPosition=l;const p=d.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const m=d.translate;if(m[0]=u[0]??0,m[1]=u[1]??0,m[2]=u[2]??0,m[3]=u[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=U9(d,s[_],_);return t!==e&&Sg(t,a,0),t}let y=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let T=0;T<a;++T)t.coords[y+T]=U9(d,s[y+T],T);let b=t.coords[y],x=t.coords[y+1];y+=a;for(let T=1;T<v;T++,y+=a){b+=s[y]*p[0],x+=s[y+1]*p[1],t.coords[y]=b,t.coords[y+1]=x;for(let S=2;S<a;++S)t.coords[y+S]=U9(d,s[y+S],S)}}return t!==e&&Sg(t,s.length,o.length),t}function FLt(t,e,r,i,n,s){if(Sg(t),t.lengths.push(...e.lengths),r===n&&i===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=_a(r,i),a=vJ(r,i,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function mnt(t,e,r,i){let n=0,s=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=s+t[i*(e+a)],c=o+t[i*(e+a)+1],u=(l-s)*(c+o);s=l,o=c,n+=u}return .5*n}function ULt(t,e){const{coords:r,lengths:i}=t;let n=0,s=0;for(let o=0;o<i.length;o++){const a=i[o];s+=mnt(r,n,a,e),n+=a}return Math.abs(s)}function Sg(t,e=0,r=0){mp(t.lengths,r),mp(t.coords,e)}function mp(t,e=0){t.length!==e&&(t.length=e)}const gnt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Zoe=new ko(Array,t=>x6(t,O1e),null,10,5),ynt=jt();let _nt=class{get labelLayers(){return this._labelLayers||mDe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,n,s){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=Uo.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=s?OEe(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(js.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=js.GRAPHIC,r){const i=r?this._visibleFlags|r|js.LABEL*r:this._visibleFlags;return e===js.GRAPHIC?(i&Uo.ALL_GRAPHIC)===Uo.ALL_GRAPHIC:(i&Uo.ALL_LABEL)===Uo.ALL_LABEL}setVisibilityFlag(e,r,i){const n=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const s=this.isVisible(e);if(n===s)return!1;if(e===js.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(js.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=jt(),Crt(r,this._extent);const i=r.spatialReference;if(!Js(i,e)&&!RP(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=a1.fromExtent(n.type==="mesh"?n.extent:n)),hnt(n,r,i)}get usedMemory(){let e=KSe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const n=r.type==="draped"?i.memory.draped:i.memory;e+=n.bytesPerFeature,n.bytesPerCoordinate&&(e+=Ert(this.graphic.geometry)*n.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:O(),num:0},draped:{origin:Ne(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&te(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&dc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?vi(s.boundingBox):s.boundingBox=vi(),s.requiresDrapedElevation=!1,await r6(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=Zoe.acquire(),c=await o.getProjectedBoundingBox(a,i,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&SS(s.boundingBox,l),Zoe.release(l)}),Y9e(s.boundingBox)||r7(ZY(s.boundingBox,ynt))?s:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},zLt=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},vnt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Qoe,Joe,Koe,XH={exports:{}};XH.exports,Qoe=XH,Joe=function(){function t(M,I,L){L=L||2;var B,H,Z,K,de,Re,Ke,_t=I&&I.length,at=_t?I[0]*L:M.length,yt=e(M,0,at,L,!0),Fe=[];if(!yt||yt.next===yt.prev)return Fe;if(_t&&(yt=l(M,I,yt,L)),M.length>80*L){B=Z=M[0],H=K=M[1];for(var pe=L;pe<at;pe+=L)(de=M[pe])<B&&(B=de),(Re=M[pe+1])<H&&(H=Re),de>Z&&(Z=de),Re>K&&(K=Re);Ke=(Ke=Math.max(Z-B,K-H))!==0?1/Ke:0}return i(yt,Fe,L,B,H,Ke),Fe}function e(M,I,L,B,H){var Z,K;if(H===Q(M,I,L,B)>0)for(Z=I;Z<L;Z+=B)K=X(Z,M[Z],M[Z+1],K);else for(Z=L-B;Z>=I;Z-=B)K=X(Z,M[Z],M[Z+1],K);if(K&&A(K,K.next)){var de=K.next;q(K),K=de}return K}function r(M,I){if(!M)return M;I||(I=M);var L,B=M;do if(L=!1,B.steiner||!A(B,B.next)&&S(B.prev,B,B.next)!==0)B=B.next;else{var H=B.prev;if(q(B),(B=I=H)===B.next)break;L=!0}while(L||B!==I);return I}function i(M,I,L,B,H,Z,K){if(M){!K&&Z&&y(M,B,H,Z);for(var de,Re,Ke=M;M.prev!==M.next;)if(de=M.prev,Re=M.next,Z?s(M,B,H,Z):n(M))I.push(de.i/L),I.push(M.i/L),I.push(Re.i/L),q(M),M=Re.next,Ke=Re.next;else if((M=Re)===Ke){K?K===1?i(M=o(r(M),I,L),I,L,B,H,Z,2):K===2&&a(M,I,L,B,H,Z):i(r(M),I,L,B,H,Z,1);break}}}function n(M){var I=M.prev,L=M,B=M.next;if(S(I,L,B)>=0)return!1;for(var H=M.next.next;H!==M.prev;){if(x(I.x,I.y,L.x,L.y,B.x,B.y,H.x,H.y)&&S(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function s(M,I,L,B){var H=M.prev,Z=M,K=M.next;if(S(H,Z,K)>=0)return!1;for(var de=H.x<Z.x?H.x<K.x?H.x:K.x:Z.x<K.x?Z.x:K.x,Re=H.y<Z.y?H.y<K.y?H.y:K.y:Z.y<K.y?Z.y:K.y,Ke=H.x>Z.x?H.x>K.x?H.x:K.x:Z.x>K.x?Z.x:K.x,_t=H.y>Z.y?H.y>K.y?H.y:K.y:Z.y>K.y?Z.y:K.y,at=v(de,Re,I,L,B),yt=v(Ke,_t,I,L,B),Fe=M.prevZ,pe=M.nextZ;Fe&&Fe.z>=at&&pe&&pe.z<=yt;){if(Fe!==M.prev&&Fe!==M.next&&x(H.x,H.y,Z.x,Z.y,K.x,K.y,Fe.x,Fe.y)&&S(Fe.prev,Fe,Fe.next)>=0||(Fe=Fe.prevZ,pe!==M.prev&&pe!==M.next&&x(H.x,H.y,Z.x,Z.y,K.x,K.y,pe.x,pe.y)&&S(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;Fe&&Fe.z>=at;){if(Fe!==M.prev&&Fe!==M.next&&x(H.x,H.y,Z.x,Z.y,K.x,K.y,Fe.x,Fe.y)&&S(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.prevZ}for(;pe&&pe.z<=yt;){if(pe!==M.prev&&pe!==M.next&&x(H.x,H.y,Z.x,Z.y,K.x,K.y,pe.x,pe.y)&&S(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function o(M,I,L){var B=M;do{var H=B.prev,Z=B.next.next;!A(H,Z)&&C(H,B,B.next,Z)&&k(H,Z)&&k(Z,H)&&(I.push(H.i/L),I.push(B.i/L),I.push(Z.i/L),q(B),q(B.next),B=M=Z),B=B.next}while(B!==M);return r(B)}function a(M,I,L,B,H,Z){var K=M;do{for(var de=K.next.next;de!==K.prev;){if(K.i!==de.i&&T(K,de)){var Re=z(K,de);return K=r(K,K.next),Re=r(Re,Re.next),i(K,I,L,B,H,Z),void i(Re,I,L,B,H,Z)}de=de.next}K=K.next}while(K!==M)}function l(M,I,L,B){var H,Z,K,de=[];for(H=0,Z=I.length;H<Z;H++)(K=e(M,I[H]*B,H<Z-1?I[H+1]*B:M.length,B,!1))===K.next&&(K.steiner=!0),de.push(b(K));for(de.sort(c),H=0;H<de.length;H++)L=r(L=d(de[H],L),L.next);return L}function c(M,I){return M.x-I.x}function u(M){if(M.next.prev===M)return M;let I=M;for(;;){const L=I.next;if(L.prev===I||L===I||L===M)break;I=L}return I}function d(M,I){var L=p(M,I);if(!L)return I;var B=z(L,M),H=r(L,L.next);let Z=u(B);return r(Z,Z.next),H=u(H),u(I===L?H:I)}function p(M,I){var L,B=I,H=M.x,Z=M.y,K=-1/0;do{if(Z<=B.y&&Z>=B.next.y&&B.next.y!==B.y){var de=B.x+(Z-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(de<=H&&de>K){if(K=de,de===H){if(Z===B.y)return B;if(Z===B.next.y)return B.next}L=B.x<B.next.x?B:B.next}}B=B.next}while(B!==I);if(!L)return null;if(H===K)return L;var Re,Ke=L,_t=L.x,at=L.y,yt=1/0;B=L;do H>=B.x&&B.x>=_t&&H!==B.x&&x(Z<at?H:K,Z,_t,at,Z<at?K:H,Z,B.x,B.y)&&(Re=Math.abs(Z-B.y)/(H-B.x),k(B,M)&&(Re<yt||Re===yt&&(B.x>L.x||B.x===L.x&&m(L,B)))&&(L=B,yt=Re)),B=B.next;while(B!==Ke);return L}function m(M,I){return S(M.prev,M,I.prev)<0&&S(I.next,M,M.next)<0}function y(M,I,L,B){var H=M;do H.z===null&&(H.z=v(H.x,H.y,I,L,B)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==M);H.prevZ.nextZ=null,H.prevZ=null,_(H)}function _(M){var I,L,B,H,Z,K,de,Re,Ke=1;do{for(L=M,M=null,Z=null,K=0;L;){for(K++,B=L,de=0,I=0;I<Ke&&(de++,B=B.nextZ);I++);for(Re=Ke;de>0||Re>0&&B;)de!==0&&(Re===0||!B||L.z<=B.z)?(H=L,L=L.nextZ,de--):(H=B,B=B.nextZ,Re--),Z?Z.nextZ=H:M=H,H.prevZ=Z,Z=H;L=B}Z.nextZ=null,Ke*=2}while(K>1);return M}function v(M,I,L,B,H){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M=32767*(M-L)*H)|M<<8))|M<<4))|M<<2))|M<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-B)*H)|I<<8))|I<<4))|I<<2))|I<<1))<<1}function b(M){var I=M,L=M;do(I.x<L.x||I.x===L.x&&I.y<L.y)&&(L=I),I=I.next;while(I!==M);return L}function x(M,I,L,B,H,Z,K,de){return(H-K)*(I-de)-(M-K)*(Z-de)>=0&&(M-K)*(B-de)-(L-K)*(I-de)>=0&&(L-K)*(Z-de)-(H-K)*(B-de)>=0}function T(M,I){return M.next.i!==I.i&&M.prev.i!==I.i&&!F(M,I)&&(k(M,I)&&k(I,M)&&V(M,I)&&(S(M.prev,M,I.prev)||S(M,I.prev,I))||A(M,I)&&S(M.prev,M,M.next)>0&&S(I.prev,I,I.next)>0)}function S(M,I,L){return(I.y-M.y)*(L.x-I.x)-(I.x-M.x)*(L.y-I.y)}function A(M,I){return M.x===I.x&&M.y===I.y}function C(M,I,L,B){var H=P(S(M,I,L)),Z=P(S(M,I,B)),K=P(S(L,B,M)),de=P(S(L,B,I));return H!==Z&&K!==de||!(H!==0||!R(M,L,I))||!(Z!==0||!R(M,B,I))||!(K!==0||!R(L,M,B))||!(de!==0||!R(L,I,B))}function R(M,I,L){return I.x<=Math.max(M.x,L.x)&&I.x>=Math.min(M.x,L.x)&&I.y<=Math.max(M.y,L.y)&&I.y>=Math.min(M.y,L.y)}function P(M){return M>0?1:M<0?-1:0}function F(M,I){var L=M;do{if(L.i!==M.i&&L.next.i!==M.i&&L.i!==I.i&&L.next.i!==I.i&&C(L,L.next,M,I))return!0;L=L.next}while(L!==M);return!1}function k(M,I){return S(M.prev,M,M.next)<0?S(M,I,M.next)>=0&&S(M,M.prev,I)>=0:S(M,I,M.prev)<0||S(M,M.next,I)<0}function V(M,I){var L=M,B=!1,H=(M.x+I.x)/2,Z=(M.y+I.y)/2;do L.y>Z!=L.next.y>Z&&L.next.y!==L.y&&H<(L.next.x-L.x)*(Z-L.y)/(L.next.y-L.y)+L.x&&(B=!B),L=L.next;while(L!==M);return B}function z(M,I){var L=new G(M.i,M.x,M.y),B=new G(I.i,I.x,I.y),H=M.next,Z=I.prev;return M.next=I,I.prev=M,L.next=H,H.prev=L,B.next=L,L.prev=B,Z.next=B,B.prev=Z,B}function X(M,I,L,B){var H=new G(M,I,L);return B?(H.next=B.next,H.prev=B,B.next.prev=H,B.next=H):(H.prev=H,H.next=H),H}function q(M){M.next.prev=M.prev,M.prev.next=M.next,M.prevZ&&(M.prevZ.nextZ=M.nextZ),M.nextZ&&(M.nextZ.prevZ=M.prevZ)}function G(M,I,L){this.i=M,this.x=I,this.y=L,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Q(M,I,L,B){for(var H=0,Z=I,K=L-B;Z<L;Z+=B)H+=(M[K]-M[Z])*(M[Z+1]+M[K+1]),K=Z;return H}return t.deviation=function(M,I,L,B){var H=I&&I.length,Z=H?I[0]*L:M.length,K=Math.abs(Q(M,0,Z,L));if(H)for(var de=0,Re=I.length;de<Re;de++){var Ke=I[de]*L,_t=de<Re-1?I[de+1]*L:M.length;K-=Math.abs(Q(M,Ke,_t,L))}var at=0;for(de=0;de<B.length;de+=3){var yt=B[de]*L,Fe=B[de+1]*L,pe=B[de+2]*L;at+=Math.abs((M[yt]-M[pe])*(M[Fe+1]-M[yt+1])-(M[yt]-M[Fe])*(M[pe+1]-M[yt+1]))}return K===0&&at===0?0:Math.abs((at-K)/K)},t.flatten=function(M){for(var I=M[0][0].length,L={vertices:[],holes:[],dimensions:I},B=0,H=0;H<M.length;H++){for(var Z=0;Z<M[H].length;Z++)for(var K=0;K<I;K++)L.vertices.push(M[H][Z][K]);H>0&&(B+=M[H-1].length,L.holes.push(B))}return L},t},(Koe=Joe())!==void 0&&(Qoe.exports=Koe);const QS=UP(XH.exports),$8=J.getLogger("esri.views.3d.support.buffer.math");function bnt(t,e,r){gp(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function gp(t,e,r,i=3,n=i){if(t.length/i!==Math.ceil(e.length/n))return $8.error("source and destination buffers need to have the same number of elements"),t;const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],d=r[6],p=r[8],m=r[9],y=r[10],_=r[12],v=r[13],b=r[14];let x=0,T=0;for(let S=0;S<s;S++){const A=e[x],C=e[x+1],R=e[x+2];t[T]=o*A+c*C+p*R+_,t[T+1]=a*A+u*C+m*R+v,t[T+2]=l*A+d*C+y*R+b,x+=n,T+=i}return t}function dCe(t,e,r){yp(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function yp(t,e,r,i=3,n=i){if(t.length/i!==Math.ceil(e.length/n))return void $8.error("source and destination buffers need to have the same number of elements");const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],d=r[5],p=r[6],m=r[7],y=r[8];let _=0,v=0;for(let b=0;b<s;b++){const x=e[_],T=e[_+1],S=e[_+2];t[v]=o*x+c*T+p*S,t[v+1]=a*x+u*T+m*S,t[v+2]=l*x+d*T+y*S,_+=n,v+=i}}function wnt(t,e,r){D5(t.typedBuffer,e,r,t.typedBufferStride)}function D5(t,e,r,i=3){const n=Math.min(t.length/i,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=r*s[a],t[l+1]=r*s[a+1],t[l+2]=r*s[a+2],a+=o,l+=i}function xnt(t,e){I8(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function I8(t,e,r=3,i=r){const n=Math.min(t.length/r,e.length/i);let s=0,o=0;for(let a=0;a<n;a++){const l=e[s],c=e[s+1],u=e[s+2],d=l*l+c*c+u*u;if(d>0){const p=1/Math.sqrt(d);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}s+=i,o+=r}}function Tnt(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)n[c]=o[l]>>r,n[c+1]=o[l+1]>>r,n[c+2]=o[l+2]>>r,l+=a,c+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:I8,normalizeView:xnt,scale:D5,scaleView:wnt,shiftRight:Tnt,transformMat3:yp,transformMat3View:dCe,transformMat4:gp,transformMat4View:bnt},Symbol.toStringTag,{value:"Module"}));function Snt(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function eae(t,e,r,i,n,s=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:n,draped:s}}var Eg,yo;function gT(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function NR(t){return t!=null&&!isNaN(t)&&isFinite(t)}function pCe(t){return t.valueExpression?Eg.Expression:t.field&&typeof t.field=="string"?Eg.Field:Eg.Unknown}function Ent(t,e){const r=e||pCe(t),i=t.valueUnit||"unknown";return r===Eg.Unknown?yo.Constant:t.stops?yo.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?yo.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?yo.Proportional:yo.Additive:yo.Identity:yo.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(Eg||(Eg={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(yo||(yo={}));const t1=J.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),tae=new z_,WD=Math.PI,fCe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function mCe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void t1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const y=i.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(u){if(r==null||r.arcade==null)return void t1.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),b=_.createExecContext(s,v);if(!d){const x=_.createSyntaxTree(i.valueExpression);d=_.createFunction(x),i.cache.compiledFunc=d}a=_.executeFunction(d,b)}else o&&(a=o[l]);const p=i.normalizationField,m=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const y=EJ(a,c);if(y){const _=y[0],v=y[1],b=_===v?i.stops[_].color:it.blendColors(i.stops[_].color,i.stops[v].color,y[2],r!=null?r.color:void 0);return new it(b)}}}function gCe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void t1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let d=i.cache.compiledFunc;if(!l&&!u){const y=i.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(u){if(r==null||r.arcade==null)return void t1.error("Use of arcade expressions requires an arcade context");const y={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(y),b=_.createExecContext(s,v);if(!d){const x=_.createSyntaxTree(i.valueExpression);d=_.createFunction(x),i.cache.compiledFunc=d}a=_.executeFunction(d,b)}else o&&(a=o[l]);const p=i.normalizationField,m=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const y=EJ(a,c);if(y){const _=y[0],v=y[1];if(_===v)return i.stops[_].opacity;{const b=i.stops[_].opacity;return b+(i.stops[v].opacity-b)*y[2]}}}}function yCe(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void t1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",s=n==="heading"&&i.rotationType==="arithmetic"?90:0,o=n==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:u}=i.cache;let d=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if(r==null||r.arcade==null)return void t1.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(m),v=y.createExecContext(a,_);if(!d){const b=y.createSyntaxTree(i.valueExpression);d=y.createFunction(b),i.cache.compiledFunc=d}p=y.executeFunction(d,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:s+o*p,p}function Cnt(t,e,r){const i=typeof e=="number",n=i?null:e,s=n&&n.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=r!=null?r.scale:void 0,d=r!=null?r.view:void 0;o=u==null||d==="3d"?Ant(t):u}else if(!i)switch(t.inputValueType){case Eg.Expression:{if(r==null||r.arcade==null)return void t1.error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},d=r.arcade.arcadeUtils,p=d.getViewInfo(u),m=d.createExecContext(n,p);if(!l){const y=d.createSyntaxTree(t.valueExpression);l=d.createFunction(y),t.cache.compiledFunc=l}o=d.executeFunction(l,m);break}case Eg.Field:s&&(o=s[t.field]);break;case Eg.Unknown:o=null}if(!NR(o))return null;if(i||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return NR(c)&&c!==0?o/c:null}function Ant(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function L8(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void t1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=vCe(Cnt(i,e,r),i,e,r,i.cache.ipData);return n==null||isNaN(n)?0:n}function Tc(t,e,r){return t==null?null:gT(t)?L8(t,e,r):NR(t)?t:null}function _Ce(t,e,r){return NR(r)&&t>r?r:NR(e)&&t<e?e:t}function Ont(t,e,r,i){return t+((Tc(e.minSize,r,i)||e.minDataValue)??0)}function Rnt(t,e,r){const i=t.stops;let n=i&&i.length&&i[0].size;return n==null&&(n=t.minSize),Tc(n,e,r)}function Pnt(t,e,r,i){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=Tc(e.minSize,r,i),o=Tc(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?WD*(s/2)**2:s*s,u=c+n*((l?WD*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/WD):Math.sqrt(u)}return s+n*(o-s)}function Mnt(t,e,r,i){const n=i!=null?i.shape:void 0,s=t/e.minDataValue,o=Tc(e.minSize,r,i),a=Tc(e.maxSize,r,i);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,_Ce(l,o,a)}function $nt(t,e,r,i,n){var l,c,u;const[s,o,a]=EJ(t,n);if(s===o)return Tc((l=e.stops)==null?void 0:l[s].size,r,i);{const d=Tc((c=e.stops)==null?void 0:c[s].size,r,i);return d+(Tc((u=e.stops)==null?void 0:u[o].size,r,i)-d)*a}}function Int(t,e,r,i){const n=(i!=null&&i.resolution?i.resolution:1)*WS[e.valueUnit],s=Tc(e.minSize,r,i),o=Tc(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/WD)/n:a==="radius"||a==="distance"?2*t/n:t/n,_Ce(l,s,o)}function vCe(t,e,r,i,n){switch(e.transformationType){case yo.Additive:return Ont(t,e,r,i);case yo.Constant:return Rnt(e,r,i);case yo.ClampedLinear:return Pnt(t,e,r,i);case yo.Proportional:return Mnt(t,e,r,i);case yo.Stops:return $nt(t,e,r,i,n);case yo.RealWorldSize:return Int(t,e,r,i);case yo.Identity:return t;case yo.Unknown:return null}}function Lnt(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const n={scale:e,view:r};let s=Tc(t.minSize,tae,n),o=Tc(t.maxSize,tae,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function SJ(t,e,r){if(!t.visualVariables)return;const i=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=mCe(l,e,r);i.push({variable:l,value:c})}),s.forEach(l=>{const c=gCe(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=yCe(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=L8(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function EJ(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((n,s)=>t<n?(i=s,!0):(r=s,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function Dnt(t,e,r){const i=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":L8(n,e,r);switch(n.axis){case"width":i[0]=s;break;case"depth":i[1]=s;break;case"height":i[2]=s;break;case"width-and-depth":i[0]=s,i[1]=s;break;case"all":case void 0:case null:i[0]=s,i[1]=s,i[2]=s;break;default:n.axis}}return i}const GLt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Dnt,getColor:mCe,getOpacity:gCe,getRotationAngle:yCe,getSize:L8,getSizeForValue:vCe,getSizeFromNumberOrVariable:Tc,getSizeRangeAtScale:Lnt,getVisualVariableValues:SJ,viewScaleRE:fCe},Symbol.toStringTag,{value:"Module"}));function D8(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function Nnt(t,e){if(t.symbol!=null)return t.symbol;const r=D8(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function jLt(t,e){const r=D8(t,e),i=Nnt(t,e);if(i==null)return null;const n={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return n;const s=SJ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function Fnt(t,e){if(t.symbol!=null)return t.symbol;const r=D8(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function HLt(t,e){const r=D8(t,e),i=await Fnt(t,e);if(!i)return null;const n={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return n;const s=SJ(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=it.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function Unt(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function knt(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function rae(t){const e=[[E.POSITION,t.indices]],r=[[E.POSITION,new Ue(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(r.push([E.COLORFEATUREATTRIBUTE,new Ue([t.attributeData.colorFeature],1,!0)]),e.push([E.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(r.push([E.COLOR,new Ue(t.attributeData.color,4,!0)]),e.push([E.COLOR,OE(t.indices.length)])),t.attributeData.uvMapSpace&&(r.push([E.UVMAPSPACE,new Ue(t.attributeData.uvMapSpace,4,!0)]),e.push([E.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(r.push([E.BOUNDINGRECT,new Ue(t.attributeData.boundingRect,9,!0)]),e.push([E.BOUNDINGRECT,t.indices])),new Xn(t.material,r,e,t.mapPositions,on.Mesh,t.attributeData.objectAndLayerIdColor)}function iae(t,e=null){const r=[[E.POSITION,t.indices],[E.UV0,t.indices]],i=[[E.POSITION,new Ue(t.attributeData.position,3,!0)],[E.UV0,new Ue(t.attributeData.uv0,2,!0)]];return new Xn(t.material,i,r,t.mapPositions,on.Mesh,e)}function FR(t){switch(t.type){case"extent":if(t instanceof Dr)return a1.fromExtent(t);break;case"polygon":return t}return null}let N8=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function YH(t,e,r){const i=Array.isArray(t),n=i?t.length/e:t.byteLength/(4*e),s=i?t:new Uint32Array(t,0,n*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let C=0;C<c.length-1;C++){const R=c[C+1]-c[C];R>u&&(u=R)}else u=n;const d=Math.floor(1.1*u)+1;($p==null||$p.length<2*d)&&($p=new Uint32Array(P6e(2*d)));for(let C=0;C<2*d;C++)$p[C]=0;let p=0;const m=!!c&&!!a,y=m?l:n;let _=u5(n);const v=new Uint32Array(l),b=1.96;let x=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):y,T=1,S=c?c[1]:y;for(let C=0;C<y;C++){if(C===x){const z=1-p/C;if(z+b*Math.sqrt(z*(1-z)/C)<o)return null;x*=2}if(C===S){for(let z=0;z<2*d;z++)$p[z]=0;if(a)for(let z=c[T-1];z<c[T];z++)v[z]=_[a[z]];S=c[++T]}const R=m?a[C]:C,P=R*e,F=Vnt(s,P,e);let k=F%d,V=p;for(;$p[2*k+1]!==0;){if($p[2*k]===F){const z=$p[2*k+1]-1;if(znt(s,P,z*e,e)){V=_[z];break}}k++,k>=d&&(k-=d)}V===p&&($p[2*k]=F,$p[2*k+1]=R+1,p++),_[R]=V}if(o!==0&&1-p/n<o)return null;if(m){for(let C=c[T-1];C<v.length;C++)v[C]=_[a[C]];_=zf(v)}const A=i?new Array(p):new Uint32Array(p*e);p=0;for(let C=0;C<y;C++)_[C]===p&&(Bnt(s,(m?a[C]:C)*e,A,p*e,e),p++);if(a&&!m){const C=new Uint32Array(l);for(let R=0;R<C.length;R++)C[R]=_[a[R]];_=zf(C)}return{buffer:Array.isArray(A)?A:A.buffer,indices:_,uniqueCount:p}}function znt(t,e,r,i){for(let n=0;n<i;n++)if(t[e+n]!==t[r+n])return!1;return!0}function Bnt(t,e,r,i,n){for(let s=0;s<n;s++)r[i+s]=t[e+s]}function Vnt(t,e,r){let i=0;for(let n=0;n<r;n++)i=t[e+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let $p=null;function Gnt(t){const e=YP(t.rings,t.hasZ,Kf.CCW_IS_HOLE),r=new Array;let i=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Ch(e.position,3*c,3*l),d=a.holeIndices.map(m=>m-c),p=zf(QS(u,d,3));r.push({position:u,faces:p}),i+=u.length,n+=p.length}const s=jnt(r,i,n),o=Array.isArray(s.position)?YH(s.position,3,{originalIndices:s.faces}):YH(s.position.buffer,6,{originalIndices:s.faces});return s.position=v2e(new Float64Array(o.buffer)),s.faces=o.indices,s}function jnt(t,e,r){if(t.length===1)return t[0];const i=Ys(e),n=new Array(r);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[s++]=l.position[c];for(const c of l.faces)n[o++]=c+a;a=s/3}return{position:i,faces:zf(n)}}function YP(t,e,r){const i=t.length,n=new Array(i),s=new Array(i),o=new Array(i);let a=0,l=0,c=0,u=0;for(let m=0;m<i;++m)u+=t[m].length;const d=Ys(3*u);let p=0;for(let m=i-1;m>=0;m--){const y=t[m],_=r===Kf.CCW_IS_HOLE&&Hnt(y);if(_&&i!==1)n[a++]=y;else{let v=y.length;for(let x=0;x<a;++x)v+=n[x].length;const b={index:p,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};b.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:p,count:y.length}),p=_?aI(y,y.length-1,-1,d,p,y.length,e):aI(y,0,1,d,p,y.length,e);for(let x=0;x<a;++x){const T=n[x];b.holeIndices[x]=p,b.pathLengths[x+1]=T.length,T.length>0&&(o[c++]={index:p,count:T.length}),p=aI(T,0,1,d,p,T.length,e)}a=0,b.count>0&&(s[l++]=b)}}for(let m=0;m<a;++m){const y=n[m];y.length>0&&(o[c++]={index:p,count:y.length}),p=aI(y,0,1,d,p,y.length,e)}return s.length=l,o.length=c,{position:d,polygons:s,outlines:o}}function aI(t,e,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];i[n++]=l[0],i[n++]=l[1],i[n++]=o?l[2]:0,e+=r}return n/3}function Hnt(t){return!Tye(t,!1,!1)}var Kf;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Kf||(Kf={}));var mO,N5,ZH;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(mO||(mO={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(N5||(N5={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(ZH||(ZH={}));let bCe=class{constructor(e,r){this._fbo=null;const i=new pr;i.wrapMode=Pt.CLAMP_TO_EDGE,i.samplingMode=At.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new hs(e,i)}dispose(){this._fbo=Le(this._fbo)}getTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}isValid(){return this._fbo!=null}resize(e,r){var i;(i=this._fbo)==null||i.resize(e,r)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){var r;const e=(r=this._fbo)==null?void 0:r.colorTexture;e!=null&&e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},bx=class{constructor(e,r,i,n=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new bCe(e,n)}},Wnt=class{constructor(e){this.renderTargets=[new bx(e,D.Color,tn.Color),new bx(e,D.Color,tn.ColorNoRasterImage),new bx(e,D.Highlight,tn.Highlight,!1),new bx(e,D.Normal,tn.Water),new bx(e,D.Color,tn.Occluded)],se("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new bx(e,D.ObjectAndLayerIdColor,tn.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){return e?(r.lastUsed=i,!1):i-r.lastUsed>qnt?(r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0,!1):r.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const qnt=1e3;let wCe=class extends Wr{constructor(){super(...arguments),this.color=$t(1,1,1,1)}};function Xnt(){const t=new mr;return t.include(Vh),t.fragment.uniforms.add(new Ye("tex",e=>e.texture),new Jt("uColor",e=>e.color)),t.fragment.code.add(w`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const Ynt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:wCe,build:Xnt},Symbol.toStringTag,{value:"Module"}));let xCe=class{constructor(e){this._context=e,this._perConstructorInstances=new RE,this._frameCounter=0,this._keepAliveFrameCount=nae}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=Qnt){const i=r.key;let n=this._perConstructorInstances.get(e,i);if(n==null){const s=new e(this._context,r,()=>this.release(s));n=new Znt(s),this._perConstructorInstances.set(e,i,n)}return++n.refCount,n.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==nae&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,n)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(r,i))}),await Promise.all(e)}},Znt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const nae=-1,Qnt=new va;let TCe=class{constructor(e,r,i,n){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=n,this._id2glMaterialRef=new RE}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let n=this._id2glMaterialRef.get(i,e.id);if(n==null){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});n=new Jnt(s),this._id2glMaterialRef.set(i,e.id,n)}return n.ref(),n.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(Le(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&J.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},Jnt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Je(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Knt={orderedRepackingEnabled:!1},est=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let QH=class qD{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Us,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Us.clearPool(),JH[0]=null,N1.prune(),Iv.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Us.acquire();for(let n=0;n<r;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(i.init(this._root),this._add(s,i))}Us.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Us.acquire();for(const n of e){const s=r??PS(this.objectToBoundingSphere(n),sst);iA(s[3])?(i.init(this._root),this._remove(n,s,i)):this._degenerateObjects.delete(n)}Us.release(i),this._shrink()}update(e,r){if(!iA(r[3])&&this._isDegenerate(e))return;const i=nst(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const n=bu(e,r);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,n){const s=bu(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=k9(e,r),u=d=>{if(--s,!n(d))return;const p=this.objectToBoundingSphere(d);if(!h_(i,p))return;const m=Ly(e,r,p),y=m-p[3],_=m+p[3];y<o&&(o=y,a=_,l=d)};return this._forEachNodeDepthOrdered(this._root,d=>{if(s<=0||!h_(i,d.bounds)||(te(Mu,c,d.halfSize),oe(Mu,Mu,d.bounds),Ly(e,r,Mu)>a))return!1;const p=d.node;return p.terminals.forAll(m=>u(m)),p.residents!==null&&p.residents.forAll(m=>u(m)),!0},e,r),l}forEachInDepthRange(e,r,i,n,s,o,a){let l=-1/0,c=1/0;const u={setRange:_=>{i===qD.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};u.setRange(n);const d=Ly(r,i,e),p=k9(r,i),m=k9(r,-i),y=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),b=v,x=Ly(r,i,b)-d,T=x-v[3],S=x+v[3];T>c||S<l||!h_(o,v)||s(_,u)};this._forEachNodeDepthOrdered(this._root,_=>{if(!h_(o,_.bounds)||(te(Mu,p,_.halfSize),oe(Mu,Mu,_.bounds),Ly(r,i,Mu)-d>c)||(te(Mu,m,_.halfSize),oe(Mu,Mu,_.bounds),Ly(r,i,Mu)-d<l))return!1;const v=_.node;return v.terminals.forAll(b=>y(b)),v.residents!==null&&v.residents.forAll(b=>y(b)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=vg(r),n=r,s=l=>{const c=this.objectToBoundingSphere(l),u=vg(c),d=i+u;return!(wo(c,n)-d*d<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=vg(l.bounds),u=i+c;if(wo(l.bounds,n)-u*u>0)return!1;const d=l.node;return d.terminals.forAll(a),o&&d.residents!==null&&d.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return lI(r.bounds,2*-r.halfSize,Qc),lI(r.bounds,2*r.halfSize,Jc),cne(e.origin,e.direction,Qc,Jc)}_intersectsNodeWithOffset(e,r,i){return lI(r.bounds,2*-r.halfSize,Qc),lI(r.bounds,2*r.halfSize,Jc),i.applyToMinMax(Qc,Jc),cne(e.origin,e.direction,Qc,Jc)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||VG(i,e)}_intersectsObjectWithOffset(e,r,i){const n=this.objectToBoundingSphere(r);return!(n[3]>0)||VG(i.applyToBoundingSphere(n),e)}_forEachNode(e,r){let i=Us.acquire().init(e);const n=[i];for(;n.length!==0;){if(i=n.pop(),r(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&n.push(Us.acquire().init(i).advance(s));Us.release(i)}}_forEachNodeDepthOrdered(e,r,i,n=qD.DepthOrder.FRONT_TO_BACK){let s=Us.acquire().init(e);const o=[s];for(ist(i,n,aae);o.length!==0;){if(s=o.pop(),r(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=aae[a];s.node.children[l]&&o.push(Us.acquire().init(s).advance(l))}Us.release(s)}}_remove(e,r,i){N1.clear();const n=i.advanceTo(r,(s,o)=>{N1.push(s.node),N1.push(o)})?i.node.terminals:i.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=N1.length-2;s>=0;s-=2){const o=N1.data[s],a=N1.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Nt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const n=Us.acquire().init(e);this._add(r.at(i),n),Us.release(n)}}_grow(e,r){if(r!==0&&(sae(e,r,i=>this.objectToBoundingSphere(i),vm),iA(vm[3])&&!this._fitsInsideTree(vm)))if(this._nodeIsEmpty(this._root.node))PS(vm,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(vm);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(vm,i):this._growRootAsSubNode(i),Us.release(i)}}_rebuildTree(e,r){re(B9,r.bounds),B9[3]=r.halfSize,sae([e,B9],2,n=>n,V9);const i=Us.acquire().init(this._root);this._root.initFrom(null,V9,V9[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),Us.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,n=>(i=Math.max(i,n.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(i[l]-r),u=i[l]+r-(s[l]+o),d=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,m=2**Math.ceil(Math.log(d+p)*Math.LOG2E);n=Math.max(n,m),cI[l].min=d,cI[l].max=p}for(let l=0;l<3;l++){let c=cI[l].min,u=cI[l].max;const d=(n-(c+u))/2;c+=Math.ceil(d),u+=Math.floor(d);const p=s[l]-o-c*o*2;z9[l]=p+(u+c)*o}const a=n*o;return z9[3]=a*ECe,Us.acquire().initFrom(null,z9,a,0)}_growRootAsSubNode(e){const r=this._root.node;re(vm,this._root.bounds),vm[3]=this._root.halfSize,this._root.init(e),e.advanceTo(vm,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,n=0;for(;n<r.length&&e==null;)i=n++,e=r[i];for(;n<r.length;)if(r[n++])return-1;return i}_isDegenerate(e){return!iA(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){var s,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(s=e.residents)==null?void 0:s.map(a=>this.objectToBoundingSphere(a)),n=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:n}}static fromJSON(e){const r=new qD(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},Us=class A2{constructor(){this.bounds=vn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,n=this.depth){return this.node=e??A2.createEmptyNode(),r!=null&&PS(r,this.bounds),this.halfSize=i,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*ECe}advance(e){let r=this.node.children[e];r||(r=A2.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=SCe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);r&&r(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Nt({shrink:!0}),residents:new Nt({shrink:!0})}}static acquire(){return A2._pool.acquire()}static release(e){A2._pool.release(e)}static clearPool(){A2._pool.prune()}};function tst(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function rst(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function lI(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function sae(t,e,r,i){if(e===1){const n=r(t[0]);PS(n,i)}else{Qc[0]=1/0,Qc[1]=1/0,Qc[2]=1/0,Jc[0]=-1/0,Jc[1]=-1/0,Jc[2]=-1/0;for(let n=0;n<e;n++){const s=r(t[n]);iA(s[3])&&(tst(Qc,s),rst(Jc,s))}Lr(i,Qc,Jc,.5),i[3]=Math.max(Jc[0]-Qc[0],Jc[1]-Qc[1],Jc[2]-Qc[2])/2}}function ist(t,e,r){if(!Iv.length)for(let i=0;i<8;++i)Iv.push({index:0,distance:0});for(let i=0;i<8;++i){const n=SCe[i];Iv.data[i].index=i,Iv.data[i].distance=Ly(t,e,n)}Iv.sort((i,n)=>i.distance-n.distance);for(let i=0;i<8;++i)r[i]=Iv.data[i].index}function k9(t,e){let r,i=1/0;for(let n=0;n<8;++n){const s=Ly(t,e,oae[n]);s<i&&(i=s,r=oae[n])}return r}function Ly(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function iA(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Us._pool=new ko(Us),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(QH||(QH={}));const SCe=[Se(-1,-1,-1),Se(1,-1,-1),Se(-1,1,-1),Se(1,1,-1),Se(-1,-1,1),Se(1,-1,1),Se(-1,1,1),Se(1,1,1)],oae=[Se(-1,-1,-1),Se(-1,-1,1),Se(-1,1,-1),Se(-1,1,1),Se(1,-1,-1),Se(1,-1,1),Se(1,1,-1),Se(1,1,1)],ECe=Math.sqrt(3),JH=[null];function nst(t){return JH[0]=t,JH}const z9=vn(),Mu=O(),Qc=O(),Jc=O(),N1=new Nt,sst=vn(),vm=vn(),B9=vn(),V9=vn(),cI=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Iv=new Nt,aae=[0,0,0,0,0,0,0,0],Xd=QH;var O_;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(O_||(O_={}));let CCe=class extends FP{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=on.Layer,this.events=new Bn,this.sliceable=!1,this._objects=new Nt,this._objectsAdded=new Nt,this._handles=new Vi,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??O_.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const n of est)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==O_.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Xd(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Me(this._octree),this._objectsAdded.clear()}};function F5(t){return t!=null&&t.type===on.Layer}var mu,_w;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(mu||(mu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(_w||(_w={}));let uo=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.transparencyPassType=rt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=mu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=_w.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===mu.Draped}};h([U({count:D.COUNT})],uo.prototype,"output",void 0),h([U({count:rt.COUNT})],uo.prototype,"transparencyPassType",void 0),h([U()],uo.prototype,"occluder",void 0),h([U()],uo.prototype,"hasSlicePlane",void 0),h([U()],uo.prototype,"writeDepth",void 0),h([U({count:mu.COUNT})],uo.prototype,"space",void 0),h([U()],uo.prototype,"hideOnShortSegments",void 0),h([U()],uo.prototype,"hasCap",void 0),h([U({count:_w.COUNT})],uo.prototype,"anchor",void 0),h([U()],uo.prototype,"hasTip",void 0),h([U()],uo.prototype,"vvSize",void 0),h([U()],uo.prototype,"vvColor",void 0),h([U()],uo.prototype,"vvOpacity",void 0),h([U()],uo.prototype,"hasOccludees",void 0),h([U()],uo.prototype,"hasMultipassTerrain",void 0),h([U()],uo.prototype,"cullAboveGround",void 0),h([U({constValue:!0})],uo.prototype,"hasVvInstancing",void 0),h([U({constValue:!0})],uo.prototype,"hasSliceTranslatedView",void 0);const lae=8;function ACe(t,e){const r=t.vertex;r.uniforms.add(new Ce("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(E.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Lt("vvSizeMinSize",i=>i.vvSize.minSize),new Lt("vvSizeMaxSize",i=>i.vvSize.maxSize),new Lt("vvSizeOffset",i=>i.vvSize.offset),new Lt("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(w`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(E.SIZE,"float"),r.code.add(w`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(E.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new Sl("vvOpacityValues",i=>i.vvOpacity.values,lae),new Sl("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,lae)),r.code.add(w`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(w`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(Tg,e),t.attributes.add(E.COLORFEATUREATTRIBUTE,"float"),r.code.add(w`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(E.COLOR,"vec4"),r.code.add(w`vec4 getColor(){
return applyOpacity(color);
}`))}function Xg(t,e){switch(t.fragment.include(Pc),e.output){case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:t.fragment.code.add(w`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case D.Depth:t.fragment.code.add(w`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let OCe=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${wc()}`,n=>n.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:n}=i,s=n.gpuMemoryUsage;this._orphanCache.put(r,n,s)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const n=this._orphanCache.pop(r)??this._createTexture(e),s=new ost(n);return this._repository.set(r,s),n}},ost=class{constructor(e){this.texture=e,this.refCount=1}};function ast(t,e){return new OCe(r=>{const{encodedData:i,paddedPixels:n}=lst(r),s=new pr;return s.internalFormat=Tt.RGBA,s.width=n,s.height=1,s.wrapMode=Pt.CLAMP_TO_EDGE,new Ct(t,s,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function lst(t){const e=CJ(t),r=1/t.pixelRatio,i=RCe(t),n=PCe(t),s=(Math.floor(.5*(n-1))+.5)*r,o=[];let a=1;for(const m of e){for(let y=0;y<m;y++){const _=a*(Math.min(y,m-1-y)+.5)*r/s*.5+.5;o.push(_)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=i+MCe,d=new Uint8Array(4*u);let p=4;for(const m of c)$R(m,d,p),p+=4;return d.copyWithin(0,p-4,p),d.copyWithin(p,4,8),{encodedData:d,paddedPixels:u}}function CJ(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function RCe(t){if(t==null)return 1;const e=CJ(t);return Math.floor(e.reduce((r,i)=>r+i))}function PCe(t){return CJ(t).reduce((e,r)=>Math.max(e,r))}const MCe=2;function cst(t){return t==null?Nf:t.length===4?t:gi(ust,t[0],t[1],t[2],1)}const ust=Qt();function $Ce(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?hst(t,e):dst(t)}function hst(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:n}=t;n.include(Pc),e.draped||(fp(i,e),i.uniforms.add(new Ce("worldToScreenPerDistanceRatio",(s,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(w`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(w`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${fst};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(w`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(w`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),LE(i,e),i.code.add(w`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?w`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),n.constants.add("stippleTexturePadding","float",MCe),n.uniforms.add(new Ye("stipplePatternTexture",s=>s.stippleTexture),new Ce("stipplePatternSDFNormalizer",s=>pst(s.stipplePattern)),new Ce("stipplePatternPixelSizeInv",s=>1/AJ(s))),n.code.add(w`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),n.code.add(w`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?w`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:w`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?w`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?w`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:w`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?w`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:w`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(n.uniforms.add(new Jt("stippleOffColor",s=>cst(s.stippleOffColor))),n.code.add(w`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(w`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function dst(t){t.fragment.code.add(w`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function pst(t){return t?(Math.floor(.5*(PCe(t)-1))+.5)/t.pixelRatio:1}function AJ(t){const e=t.stipplePattern;return e?RCe(t.stipplePattern)/e.pixelRatio:1}const fst=w.float(.4),Db=64,OJ=Db/2,ICe=OJ/5,mst=Db/ICe,gst=.25;function yst(t,e){const r=RSe(t,Db,OJ,ICe),i=new pr;return i.internalFormat=Tt.RGBA,i.width=Db,i.height=Db,i.wrapMode=Pt.CLAMP_TO_EDGE,new Ct(e,i,r)}function LCe(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",mst),LE(r,e),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(w`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===mu.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Ce("perRenderPixelRatio",(n,s)=>s.camera.perRenderPixelRatio)),r.code.add(w`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Ah;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Ah||(Ah={}));let Ni=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.capType=Ah.BUTT,this.transparencyPassType=rt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};h([U({count:D.COUNT})],Ni.prototype,"output",void 0),h([U({count:Ah.COUNT})],Ni.prototype,"capType",void 0),h([U({count:rt.COUNT})],Ni.prototype,"transparencyPassType",void 0),h([U()],Ni.prototype,"occluder",void 0),h([U()],Ni.prototype,"hasSlicePlane",void 0),h([U()],Ni.prototype,"hasPolygonOffset",void 0),h([U()],Ni.prototype,"writeDepth",void 0),h([U()],Ni.prototype,"draped",void 0),h([U()],Ni.prototype,"stippleEnabled",void 0),h([U()],Ni.prototype,"stippleOffColorEnabled",void 0),h([U()],Ni.prototype,"stippleScaleWithLineWidth",void 0),h([U()],Ni.prototype,"stipplePreferContinuous",void 0),h([U()],Ni.prototype,"roundJoins",void 0),h([U()],Ni.prototype,"applyMarkerOffset",void 0),h([U()],Ni.prototype,"vvSize",void 0),h([U()],Ni.prototype,"vvColor",void 0),h([U()],Ni.prototype,"vvOpacity",void 0),h([U()],Ni.prototype,"falloffEnabled",void 0),h([U()],Ni.prototype,"innerColorEnabled",void 0),h([U()],Ni.prototype,"hasOccludees",void 0),h([U()],Ni.prototype,"hasMultipassTerrain",void 0),h([U()],Ni.prototype,"cullAboveGround",void 0),h([U()],Ni.prototype,"wireframe",void 0),h([U({constValue:!0})],Ni.prototype,"stippleRequiresClamp",void 0),h([U({constValue:!0})],Ni.prototype,"stippleRequiresStretchMeasure",void 0),h([U({constValue:!0})],Ni.prototype,"hasVvInstancing",void 0),h([U({constValue:!0})],Ni.prototype,"hasSliceTranslatedView",void 0),h([U()],Ni.prototype,"objectAndLayerIdColorInstanced",void 0);const U5=1;function _st(t){const e=new mr,{vertex:r,fragment:i}=e,n=t.hasMultipassTerrain&&(t.output===D.Color||t.output===D.Alpha);e.include(IP),e.include(ACe,t),e.include($Ce,t);const s=t.applyMarkerOffset&&!t.draped;s&&(r.uniforms.add(new Ce("markerScale",m=>m.markerScale)),e.include(LCe,{space:mu.World,draped:!1})),t.output===D.Depth&&e.include(Xg,t),e.include(GP,t),xc(r,t),r.uniforms.add(new Mi("inverseProjectionMatrix",(m,y)=>y.camera.inverseProjectionMatrix),new yr("nearFar",(m,y)=>y.camera.nearFar),new Ce("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new Jt("viewport",(m,y)=>y.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.SUBDIVISIONFACTOR,"float"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),e.attributes.add(E.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),W_(e),n&&e.varyings.add("depth","float");const o=t.stippleEnabled&&t.stippleScaleWithLineWidth;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===Ah.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const u=t.stippleEnabled&&a,d=t.falloffEnabled||u;d&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(w`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(w`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),t8(e),r.code.add(w`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),LE(r,t),r.code.add(w`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?w`vLineWidth = lineWidth;`:""}
      ${o?w`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&r.code.add(w`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(w`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&r.code.add(w`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?w`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(w`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(w`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?w`min(1.0, subdivisionFactor * ${w.float((U5+2)/(U5+1))})`:w`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(w`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=t.capType!==Ah.BUTT;return r.code.add(w`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?w`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(w`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${d||c?w`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?w`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${d?w`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(w`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Ce("worldToScreenRatio",(m,y)=>1/y.screenToPCSRatio)):r.code.add(w`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(w`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(w`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(w`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ce("stipplePatternPixelSize",m=>AJ(m))),r.code.add(w`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(w`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(xu,t),e.include(fn,t),i.include(cm),i.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(w`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(w`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${w.float(vo)}) {
        discard;
      }
    `),u?i.code.add(w`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${w.float(vo)}, stippleCoverage);
      `):i.code.add(w`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new Jt("intrinsicColor",m=>m.color)),t.output!==D.ObjectAndLayerIdColor&&i.code.add(w`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(w`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new Jt("innerColor",m=>m.innerColor??m.color),new Ce("innerWidth",(m,y)=>m.innerWidth*y.camera.pixelRatio)),i.code.add(w`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(w`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Ce("falloff",m=>m.falloff)),i.code.add(w`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(w`
    ${t.output===D.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${w.float(vo)}) {
      discard;
    }

    ${t.output===D.Alpha?w`fragColor = vec4(finalColor.a);`:""}
    ${t.output===D.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===D.Color&&t.transparencyPassType===rt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===D.Highlight?w`fragColor = vec4(1.0);`:""}
    ${t.output===D.Depth?w`outputDepth(linearDepth);`:""}
    ${t.output===D.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const vst=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:U5,build:_st},Symbol.toStringTag,{value:"Module"})),RJ={func:Hr.LESS},k5={func:Hr.ALWAYS},em={mask:255},DCe={mask:0},bst=t=>({function:{func:Hr.NOTEQUAL,ref:t,mask:t},operation:{fail:_n.KEEP,zFail:_n.KEEP,zPass:_n.KEEP}}),wst=t=>({function:{func:Hr.ALWAYS,ref:t,mask:t},operation:{fail:_n.KEEP,zFail:_n.KEEP,zPass:_n.REPLACE}}),m1={function:{func:Hr.ALWAYS,ref:Rl.OutlineVisualElementMask,mask:Rl.OutlineVisualElementMask},operation:{fail:_n.KEEP,zFail:_n.KEEP,zPass:_n.ZERO}},r1={function:{func:Hr.ALWAYS,ref:Rl.OutlineVisualElementMask,mask:Rl.OutlineVisualElementMask},operation:{fail:_n.KEEP,zFail:_n.KEEP,zPass:_n.REPLACE}},NCe={function:{func:Hr.EQUAL,ref:Rl.OutlineVisualElementMask,mask:Rl.OutlineVisualElementMask},operation:{fail:_n.KEEP,zFail:_n.KEEP,zPass:_n.KEEP}},FCe={function:{func:Hr.NOTEQUAL,ref:Rl.OutlineVisualElementMask,mask:Rl.OutlineVisualElementMask},operation:{fail:_n.KEEP,zFail:_n.KEEP,zPass:_n.KEEP}},UCe=new Map([[E.POSITION,0],[E.SUBDIVISIONFACTOR,1],[E.UV0,2],[E.AUXPOS1,3],[E.AUXPOS2,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7],[E.OBJECTANDLAYERIDCOLOR,8]]);let kCe=class zCe extends Tr{initializeProgram(e){return new vr(e.rctx,zCe.shader.get().build(this.configuration),UCe)}_makePipelineState(e,r){const i=this.configuration,n=e===rt.NONE,s=e===rt.FrontFace;return Ot({blending:i.output===D.Color||i.output===D.Alpha?n?fu:u0(e):null,depthTest:{func:f1(e)},depthWrite:n?i.writeDepth?$l:null:S8(e),colorWrite:Ft,stencilWrite:i.hasOccludees?em:null,stencilTest:i.hasOccludees?r?r1:m1:null,polygonOffset:n||s?i.hasPolygonOffset?cae:null:C8})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?cae:null;this._occluderPipelineTransparent=Ot({blending:fu,polygonOffset:r,depthTest:k5,depthWrite:null,colorWrite:Ft,stencilWrite:null,stencilTest:FCe}),this._occluderPipelineOpaque=Ot({blending:fu,polygonOffset:r,depthTest:k5,depthWrite:null,colorWrite:Ft,stencilWrite:DCe,stencilTest:NCe}),this._occluderPipelineMaskWrite=Ot({blending:null,polygonOffset:r,depthTest:RJ,depthWrite:null,colorWrite:null,stencilWrite:em,stencilTest:r1})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Et.LINES:Et.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===le.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===le.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};kCe.shader=new _r(vst,()=>ce(()=>import("./RibbonLine.glsl-0c86e4e2.js"),[]));const cae={factor:0,units:-4};var Jl;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Jl||(Jl={}));let yT=class extends p1{constructor(e){super(e,new Tst),this._configuration=new Ni,this._vertexAttributeLocations=UCe}isClosed(e,r){return VCe(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===le.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==D.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&Est(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ri.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(E.POSITION).data,l=e.vertexAttributes.get(E.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=ge(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=n[0],d=n[1],p=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],x=u-v,T=d-b,S=a[_+3]-v,A=a[_+4]-b,C=ge((S*x+A*T)/(S*S+A*A),0,1),R=S*C-x,P=A*C-T,F=R*R+P*P;F<m&&(m=F,y=_/3)}m<p*p&&s(o.dist,o.normal,y,!1)}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!Jwe(r))return void J.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(E.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const x=a.get(E.SIZEFEATUREATTRIBUTE).data[0];c*=ge(this.parameters.vvSize.offset[0]+x*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(E.SIZE)&&(c*=a.get(E.SIZE).data[0]);const u=i.camera,d=Cst;fs(d,i.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;ne(AC[0],d[0]-p,d[1]+p,0),ne(AC[1],d[0]+p,d[1]+p,0),ne(AC[2],d[0]+p,d[1]-p,0),ne(AC[3],d[0]-p,d[1]-p,0);for(let x=0;x<4;x++)if(!u.unprojectFromRenderScreen(AC[x],bm[x]))return;oa(u.eye,bm[0],bm[1],j9),oa(u.eye,bm[1],bm[2],H9),oa(u.eye,bm[2],bm[3],W9),oa(u.eye,bm[3],bm[0],q9);let m=Number.MAX_VALUE,y=0;const _=BCe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let x=0;x<_;x+=3){ol[0]=l[x]+r[12],ol[1]=l[x+1]+r[13],ol[2]=l[x+2]+r[14];const T=(x+3)%l.length;if(al[0]=l[T]+r[12],al[1]=l[T+1]+r[13],al[2]=l[T+2]+r[14],oi(j9,ol)<0&&oi(j9,al)<0||oi(H9,ol)<0&&oi(H9,al)<0||oi(W9,ol)<0&&oi(W9,al)<0||oi(q9,ol)<0&&oi(q9,al)<0)continue;if(u.projectToRenderScreen(ol,U1),u.projectToRenderScreen(al,k1),U1[2]<0&&k1[2]>0){ae(Ip,ol,al);const A=u.frustum,C=-oi(A[si.NEAR],ol)/fe(Ip,A[si.NEAR]);te(Ip,Ip,C),oe(ol,ol,Ip),u.projectToRenderScreen(ol,U1)}else if(U1[2]>0&&k1[2]<0){ae(Ip,al,ol);const A=u.frustum,C=-oi(A[si.NEAR],al)/fe(Ip,A[si.NEAR]);te(Ip,Ip,C),oe(al,al,Ip),u.projectToRenderScreen(al,k1)}else if(U1[2]<0&&k1[2]<0)continue;U1[2]=0,k1[2]=0;const S=wZ(Pb(U1,k1,dae),d);S<m&&(m=S,re(uae,ol),re(hae,al),y=x/3)}const v=i.rayBegin,b=i.rayEnd;if(m<p*p){let x=Number.MAX_VALUE;if(ube(Pb(uae,hae,dae),Pb(v,b,Ast),F1)){ae(F1,F1,v);const T=Te(F1);te(F1,F1,1/T),x=T/ci(v,b)}o(x,F1,y,!1)}}get _layout(){const e=Gi().vec3f(E.POSITION).f32(E.SUBDIVISIONFACTOR).vec2f(E.UV0).vec3f(E.AUXPOS1).vec3f(E.AUXPOS2);return this.parameters.vvSize?e.f32(E.SIZEFEATUREATTRIBUTE):e.f32(E.SIZE),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4f(E.COLOR),this.parameters.vvOpacity&&e.f32(E.OPACITYFEATUREATTRIBUTE),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new Sst(this._layout,this.parameters)}requiresSlot(e,r){return r===D.Color||r===D.Alpha||r===D.Highlight||r===D.Depth||r===D.ObjectAndLayerIdColor?e===le.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ri.OccludeAndTransparentStencil?e===le.OPAQUE_MATERIAL||e===le.OCCLUDER_MATERIAL||e===le.TRANSPARENT_OCCLUDER_MATERIAL:r===D.Color||r===D.Alpha?e===(this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===le.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new xst(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},xst=class extends h1{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==D.Color&&this._output!==D.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(kCe,e)}},Tst=class extends HP{constructor(){super(...arguments),this.width=0,this.color=mh,this.join="miter",this.cap=Ah.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},Sst=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=U5+i}}_isClosed(e){return BCe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(E.POSITION).length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?i:i-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,r,i,n,s){var G;const o=Ost,a=Rst,l=Pst,c=i.vertexAttributes.get(E.POSITION).data,u=i.indices&&i.indices.get(E.POSITION),d=(G=i.vertexAttributes.get(E.DISTANCETOSTART))==null?void 0:G.data;u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,m=0;this._parameters.vvSize?m=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(p=i.vertexAttributes.get(E.SIZE).data[0]);let y=[1,1,1,1],_=0;this._parameters.vvColor?_=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(y=i.vertexAttributes.get(E.COLOR).data);const v=se("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let b=0;this._parameters.vvOpacity&&(b=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const x=c.length/3,T=new Float32Array(n.buffer),S=se("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,A=this.vertexBufferLayout.stride/4;let C=s*A;const R=C;let P=0;const F=d?(Q,M,I)=>P=d[I]:(Q,M,I)=>P+=ci(Q,M),k=se("enable-feature:objectAndLayerId-rendering"),V=(Q,M,I,L,B,H,Z)=>{if(T[C++]=M[0],T[C++]=M[1],T[C++]=M[2],T[C++]=L,T[C++]=Z,T[C++]=B,T[C++]=Q[0],T[C++]=Q[1],T[C++]=Q[2],T[C++]=I[0],T[C++]=I[1],T[C++]=I[2],T[C++]=this._parameters.vvSize?m:p,this._parameters.vvColor)T[C++]=_;else{const K=Math.min(4*H,y.length-4);T[C++]=y[K],T[C++]=y[K+1],T[C++]=y[K+2],T[C++]=y[K+3]}this._parameters.vvOpacity&&(T[C++]=b),k&&(v!=null&&(S[4*C]=v[0],S[4*C+1]=v[1],S[4*C+2]=v[2],S[4*C+3]=v[3]),C++)};C+=A,ne(a,c[0],c[1],c[2]),e&&De(a,a,e);const z=this._isClosed(i);if(z){const Q=c.length-3;ne(o,c[Q],c[Q+1],c[Q+2]),e&&De(o,o,e)}else ne(l,c[3],c[4],c[5]),e&&De(l,l,e),V(a,a,l,1,Jl.LEFT_CAP_START,0,0),V(a,a,l,1,Jl.RIGHT_CAP_START,0,0),re(o,a),re(a,l);const X=z?0:1,q=z?x:x-1;for(let Q=X;Q<q;Q++){const M=(Q+1)%x*3;ne(l,c[M],c[M+1],c[M+2]),e&&De(l,l,e),F(o,a,Q),V(o,a,l,0,Jl.LEFT_JOIN_END,Q,P),V(o,a,l,0,Jl.RIGHT_JOIN_END,Q,P);const I=this.numJoinSubdivisions;for(let L=0;L<I;++L){const B=(L+1)/(I+1);V(o,a,l,B,Jl.LEFT_JOIN_END,Q,P),V(o,a,l,B,Jl.RIGHT_JOIN_END,Q,P)}V(o,a,l,1,Jl.LEFT_JOIN_START,Q,P),V(o,a,l,1,Jl.RIGHT_JOIN_START,Q,P),re(o,a),re(a,l)}z?(ne(l,c[3],c[4],c[5]),e&&De(l,l,e),P=F(o,a,q),V(o,a,l,0,Jl.LEFT_JOIN_END,X,P),V(o,a,l,0,Jl.RIGHT_JOIN_END,X,P)):(P=F(o,a,q),V(o,a,a,0,Jl.LEFT_CAP_END,q,P),V(o,a,a,0,Jl.RIGHT_CAP_END,q,P)),G9(T,R+A,T,R,A),C=G9(T,C-A,T,C,A),this._parameters.wireframe&&this._addWireframeVertices(n,R,C,A)}_addWireframeVertices(e,r,i,n){const s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=G9(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function G9(t,e,r,i,n){for(let s=0;s<n;s++)r[i++]=t[e++];return i}function BCe(t,e,r){return VCe(t,e.get(E.POSITION).data,r?r.get(E.POSITION):null)}function VCe(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function Est(t){return t.anchor===_w.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const ol=O(),al=O(),Ip=O(),F1=O(),Cst=O(),U1=Vo(),k1=Vo(),uae=O(),hae=O(),dae=_p(),Ast=_p(),Ost=O(),Rst=O(),Pst=O(),AC=[Vo(),Vo(),Vo(),Vo()],bm=[O(),O(),O(),O()],j9=Er(),H9=Er(),W9=Er(),q9=Er();let PJ=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+wc()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const u=R5(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const i=this._gridSize,n=Math.round(e[0]/i),s=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ae(io,e,r.vec3),io[0]=Math.abs(io[0]),io[1]=Math.abs(io[1]),io[2]=Math.abs(io[2]),io[0]<c&&io[1]<c&&io[2]<c){if(l){const u=Math.max(...io);if(ae(io,e,l.vec3),io[0]=Math.abs(io[0]),io[1]=Math.abs(io[1]),io[2]=Math.abs(io[2]),Math.max(...io)<u)return l}return r}return l||(l=R5(n*i,s*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=$t(1,1,0,1)){const i=window.view,n=i._stage,s=r.toString();if(!this._objects.has(s)){this._material=new yT({width:2,color:r}),n.add(this._material);const m=new CCe(n,{pickable:!1}),y=new h0({castShadow:!1});n.add(y),m.add(y),this._objects.set(s,y)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,d=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?d:-d),c[3*m+1]=e[1]+(2&a[m]?d:-d),c[3*m+2]=e[2]+(4&a[m]?d:-d),m>0&&u.push(m-1,m);$i(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new Xn(this._material,[[E.POSITION,new Ue(c,3,!0)]],[[E.POSITION,u]],null,on.Line);n.add(p),o.addGeometry(p)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const io=O();let GCe=class{constructor(e,r,i,n=null){this.rctx=e,this.sliceHelper=n,this.lastFrameCamera=new lt,this.output=D.Color,this.renderOccludedMask=pae,this.bindParameters=new e8(r,i,n!=null?n.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=pae}},Mst=class extends GCe{constructor(e,r,i,n,s){super(e,i,n,s),this.offscreenRenderingHelper=r,this.sliceHelper=s,this.time=0}};const pae=Ri.Occlude|Ri.OccludeAndTransparent|Ri.OccludeAndTransparentStencil;let nA=class extends lt{constructor(){super(...arguments),this._projectionMatrix=_e()}get projectionMatrix(){return this._projectionMatrix}};h([f()],nA.prototype,"_projectionMatrix",void 0),h([f({readOnly:!0})],nA.prototype,"projectionMatrix",null),nA=h([N("esri.views.3d.webgl-engine.lib.CascadeCamera")],nA);const fae=16;function MJ(t){return Math.ceil(t/fae)*fae}var JS;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(JS||(JS={}));let uI=class{constructor(){this.camera=new nA,this.lightMat=_e()}},$st=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},$J=class{get depthTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return gi(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new $st,this._projectionView=_e(),this._projectionViewInverse=_e(),this._modelViewLight=_e(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Qt(),this._cascades=[new uI,new uI,new uI,new uI],this._lastOrigin=null,this._maxTextureSize=Math.min(se("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=Le(this._fbo),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=ge(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Y9[e]=this._cascades[e];return Y9.length=this._numCascades,Y9}start(e,r,i,n,s){Je(this.enabled),this._textureSize=this._computeTextureSize(e,s,n),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,o,n),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,r);this._lastOrigin=null,this.clear()}finish(e){Je(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!Bo(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||O(),re(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){Ml(bae,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)wae[16*r+i]=bae[i]}}return wae}takeCascadeSnapshotTo(e,r){Je(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const n=this._rctx,s=n.bindTexture(i,Ct.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(nn.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),n.bindTexture(s,Ct.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(yi.COLOR_BUFFER_BIT|yi.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r,i){const n=Math.min(window.devicePixelRatio,r)/e.pixelRatio,s=Math.max(e.fullWidth,e.fullHeight)*n,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,MJ((this.numCascades===1?1:2)*s*o)))}_ensureDepthTexture(){var r,i;if(((r=this._fbo)==null?void 0:r.width)===this._textureSize)return;const e=new pr(this._textureSize);e.wrapMode=Pt.CLAMP_TO_EDGE,e.samplingMode=At.NEAREST,(i=this._fbo)==null||i.dispose(),this._fbo=new hs(this._rctx,e,new n5(jn.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let r=this._snapshots[e];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i=new pr;return i.wrapMode=Pt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new Ct(this._rctx,i),this._snapshots[e]=r,r}_discardSnapshot(e){this._snapshots[e]=Le(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);Je(l<c);for(let m=0;m<8;++m){gi(mae,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const y=rh[m];au(y,mae,this._projectionViewInverse),y[0]/=y[3],y[1]/=y[3],y[2]/=y[3]}fa(X9,rh[0]),s.camera.viewMatrix=Ml(Ist,this._modelViewLight,X9);for(let m=0;m<8;++m)De(rh[m],rh[m],s.camera.viewMatrix);let u=rh[0][2],d=rh[0][2];for(let m=1;m<8;++m)u=Math.min(u,rh[m][2]),d=Math.max(d,rh[m][2]);u-=200,d+=200,s.camera.near=-d,s.camera.far=-u,Fst(i,n,u,d,s.camera),Vr(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const p=this._textureSize/(this.numCascades===1?1:2);s.camera.viewport=[e%2==0?0:p,Math.floor(e/2)===0?0:p,p,p]}_setupMatrices(e,r){Vr(this._projectionView,e.projectionMatrix,e.viewMatrix),us(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===$e.Global?e.eye:ne(X9,0,0,1);$6(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const n=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(MHe(e/r,4)),n);const s=(e-r)/this._numCascades,o=(e/r)**(1/this._numCascades);let a=r,l=r;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=wt(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get gpuMemoryUsage(){var e;return this._snapshots.reduce((r,i)=>r+((i==null?void 0:i.gpuMemoryUsage)??0),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const Ist=_e(),mae=Qt(),rh=[];for(let t=0;t<8;++t)rh.push(Qt());const gae=Ne(),yae=Ne(),Lst=Ne(),_ae=Ne(),vae=Ne(),X9=O(),Y9=[],bae=_e(),wae=new Array(64),Nc=Ne(),wx=Ne(),z1=[Ne(),Ne(),Ne(),Ne()],ms=Ne(),Z9=Ne(),F0=Ne(),OC=Ne(),xx=Ne(),Tx=Ne(),hI=Ne();function Dst(t,e,r,i,n,s,o,a){er(Nc,0,0);for(let A=0;A<4;++A)Ld(Nc,Nc,t[A]);dc(Nc,Nc,.25),er(wx,0,0);for(let A=4;A<8;++A)Ld(wx,wx,t[A]);dc(wx,wx,.25),lh(z1[0],t[4],t[5],.5),lh(z1[1],t[5],t[6],.5),lh(z1[2],t[6],t[7],.5),lh(z1[3],t[7],t[4],.5);let l=0,c=J4(z1[0],Nc);for(let A=1;A<4;++A){const C=J4(z1[A],Nc);C<c&&(c=C,l=A)}Tf(ms,z1[l],t[l+4]);const u=ms[0];let d,p;ms[0]=-ms[1],ms[1]=u,Tf(Z9,wx,Nc),es(Z9,ms)<0&&zZ(ms,ms),lh(ms,ms,Z9,r),wR(ms,ms),d=p=es(Tf(F0,t[0],Nc),ms);for(let A=1;A<8;++A){const C=es(Tf(F0,t[A],Nc),ms);C<d?d=C:C>p&&(p=C)}fs(i,Nc),dc(F0,ms,d-e),Ld(i,i,F0);let m=-1,y=1,_=0,v=0;for(let A=0;A<8;++A){Tf(OC,t[A],i),wR(OC,OC);const C=ms[0]*OC[1]-ms[1]*OC[0];C>0?C>m&&(m=C,_=A):C<y&&(y=C,v=A)}rx(m>0,"leftArea"),rx(y<0,"rightArea"),dc(xx,ms,d),Ld(xx,xx,Nc),dc(Tx,ms,p),Ld(Tx,Tx,Nc),hI[0]=-ms[1],hI[1]=ms[0];const b=g$(i,t[v],Tx,Ld(F0,Tx,hI),1,n),x=g$(i,t[_],Tx,F0,1,s),T=g$(i,t[_],xx,Ld(F0,xx,hI),1,o),S=g$(i,t[v],xx,F0,1,a);rx(b,"rayRay"),rx(x,"rayRay"),rx(T,"rayRay"),rx(S,"rayRay")}function hr(t,e){return 3*e+t}const xae=Ne();function kl(t,e){return er(xae,t[e],t[e+3]),xae}const ll=Ne(),He=hi();function Nst(t,e,r,i,n){Tf(ll,r,i),dc(ll,ll,.5),He[0]=ll[0],He[1]=ll[1],He[2]=0,He[3]=ll[1],He[4]=-ll[0],He[5]=0,He[6]=ll[0]*ll[0]+ll[1]*ll[1],He[7]=ll[0]*ll[1]-ll[1]*ll[0],He[8]=1,He[hr(0,2)]=-es(kl(He,0),t),He[hr(1,2)]=-es(kl(He,1),t);let s=es(kl(He,0),r)+He[hr(0,2)],o=es(kl(He,1),r)+He[hr(1,2)],a=es(kl(He,0),i)+He[hr(0,2)],l=es(kl(He,1),i)+He[hr(1,2)];s=-(s+a)/(o+l),He[hr(0,0)]+=He[hr(1,0)]*s,He[hr(0,1)]+=He[hr(1,1)]*s,He[hr(0,2)]+=He[hr(1,2)]*s,s=1/(es(kl(He,0),r)+He[hr(0,2)]),o=1/(es(kl(He,1),r)+He[hr(1,2)]),He[hr(0,0)]*=s,He[hr(0,1)]*=s,He[hr(0,2)]*=s,He[hr(1,0)]*=o,He[hr(1,1)]*=o,He[hr(1,2)]*=o,He[hr(2,0)]=He[hr(1,0)],He[hr(2,1)]=He[hr(1,1)],He[hr(2,2)]=He[hr(1,2)],He[hr(1,2)]+=1,s=es(kl(He,1),e)+He[hr(1,2)],o=es(kl(He,2),e)+He[hr(2,2)],a=es(kl(He,1),r)+He[hr(1,2)],l=es(kl(He,2),r)+He[hr(2,2)],s=-.5*(s/o+a/l),He[hr(1,0)]+=He[hr(2,0)]*s,He[hr(1,1)]+=He[hr(2,1)]*s,He[hr(1,2)]+=He[hr(2,2)]*s,s=es(kl(He,1),e)+He[hr(1,2)],o=es(kl(He,2),e)+He[hr(2,2)],a=-o/s,He[hr(1,0)]*=a,He[hr(1,1)]*=a,He[hr(1,2)]*=a,n[0]=He[0],n[1]=He[1],n[2]=0,n[3]=He[2],n[4]=He[3],n[5]=He[4],n[6]=0,n[7]=He[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=He[6],n[13]=He[7],n[14]=0,n[15]=He[8]}function Fst(t,e,r,i,n){const s=1/rh[0][3],o=1/rh[4][3];Je(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(As(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Dst(rh,a,l,gae,yae,Lst,_ae,vae),Nst(gae,yae,_ae,vae,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}function Ust(t){return bp(t)&&t.intersector===Ui.TERRAIN&&!!t.target}let kst=class extends u8{constructor(e,r,i){super(e,r),this.triangleNr=i}};function jCe(t){return bp(t)&&t.intersector===Ui.OVERLAY&&!!t.target}let KH=class{constructor(){this.adds=new Nt,this.removes=new Nt,this.updates=new Nt({allocator:e=>e||new zst,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},zst=class{},Bst=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var Hi,bs;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(Hi||(Hi={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(bs||(bs={}));function HCe(t){const e=new Map,r=i=>{let n=e.get(i);return n||(n=new Bst,e.set(i,n)),n};return t.removes.forAll(i=>{Q9(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{Q9(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{Q9(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function Q9(t){return t.geometry.indexCount>=1}let WCe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const n=this._map.get(i);if(n!=null){if(n.ensureResources(e)===bg.LOADED)return n;this._repository.requestRender()}return null}};function ZP(t,e){switch(e.normalType){case br.Compressed:t.attributes.add(E.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(w`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case br.Attribute:t.attributes.add(E.NORMAL,"vec3"),t.vertex.code.add(w`vec3 normalModel() {
return normal;
}`);break;case br.ScreenDerivative:t.fragment.code.add(w`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case br.COUNT:case br.Ground:}}var br;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(br||(br={}));function F8(t,e){switch(e.normalType){case br.Attribute:case br.Compressed:t.include(ZP,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new xR("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new Gh("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(w`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case br.Ground:t.include(kT,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(w`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?w`normalize(vPositionWorldCameraRelative);`:w`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case br.ScreenDerivative:t.vertex.code.add(w`void forwardNormal() {}`);break;default:e.normalType;case br.COUNT:}}let qCe=class extends Jxe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=hi()}},XCe=class extends Kxe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=hi(),this.toMapSpace=Qt()}},eW=class extends XCe{constructor(e=O()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},DE=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(E.POSITION).length}write(e,r,i,n,s){wSe(i,this.vertexBufferLayout,e,r,n,s)}};const Vst=Gi().vec3f(E.POSITION),Gst=Gi().vec3f(E.POSITION).vec2f(E.UV0),jst=Gi().vec3f(E.POSITION).vec4u8(E.COLOR);Gi().vec3f(E.POSITION).vec4u8(E.OBJECTANDLAYERIDCOLOR);const Hst=Gi().vec3f(E.POSITION).vec2f(E.UV0).vec4u8(E.OBJECTANDLAYERIDCOLOR);Gi().vec3f(E.POSITION).vec4u8(E.COLOR).vec4u8(E.OBJECTANDLAYERIDCOLOR);let IJ=class extends p1{intersect(e,r,i,n,s,o){return cSe(e,i,n,s,void 0,o)}};function Wst(t){t.fragment.code.add(w`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function qst(t){t.fragment.code.add(w`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}let QP=class extends ln{constructor(e,r){super(e,"int",jr.Pass,(i,n,s)=>i.setUniform1i(e,r(n,s)))}},Xst=class extends ln{constructor(e,r,i){super(e,"mat4",jr.Draw,(n,s,o,a)=>n.setUniformMatrix4fv(e,r(s,o,a)),i)}},Yst=class extends ln{constructor(e,r,i){super(e,"mat4",jr.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,r(s,o)),i)}},Zst=class extends Wr{constructor(){super(...arguments),this.origin=O()}},Qst=class extends Zst{},Jst=class extends Wr{constructor(){super(...arguments),this.modelTransformation=yn}},LJ=class extends Jst{constructor(){super(...arguments),this.origin=O()}};function U8(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Yst("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),YCe(t))}function vw(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Xst("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),YCe(t))}function YCe(t){const e=t.fragment;e.include(Pc),e.uniforms.add(new Ye("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new QP("numCascades",(r,i)=>i.shadowMap.numCascades),new Jt("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(w`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function Tae(t){t.fragment.uniforms.add(new Ye("texWaveNormal",e=>e.waveNormal),new Ye("texWavePerturbation",e=>e.wavePertubation),new Jt("waveParams",e=>gi(Kst,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new yr("waveDirection",e=>er(eot,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(Wst),t.fragment.code.add(w`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Kst=Qt(),eot=Ne();function UR(t,e){e.spherical?t.vertex.code.add(w`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(w`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(w`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(w`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function tot(t){const e=t.fragment.code;e.add(w`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(w`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(w`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function DJ(t,e){const r=t.fragment.code;t.include(IP),e.pbrMode!==et.Normal&&e.pbrMode!==et.Schematic&&e.pbrMode!==et.Terrain&&e.pbrMode!==et.TerrainWithWater||(r.add(w`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(w`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==et.Normal&&e.pbrMode!==et.Schematic||(t.include(tot),r.add(w`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(w`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(w`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(w`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function rot(t,e){const r=t.fragment.code;t.include(IP),r.add(w`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(w`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(w`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(w`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(w`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function ZCe(t,e){t.include(rot,e),t.include(Q6),t.include(qst),e.hasCloudsReflections&&t.include(bxe,e),e.hasScreenSpaceReflections&&t.include(mqe,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(w`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Ce("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new Ce("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)),r.code.add(w`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(w`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new Mi("view",(i,n)=>n.ssr.camera.viewMatrix),new Ye("lastFrameColorTexture",(i,n)=>n.ssr.lastFrameColorTexture),new Ce("fadeFactorSSR",(i,n)=>n.ssr.fadeFactor)),r.code.add(w`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(w`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(w`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(w`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(w`return waterRenderedColor;
}`)}function iot(t){const e=new mr,{vertex:r,fragment:i}=e;xc(r,t),e.include(Cl,t),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.UV0,"vec2");const n=new Jt("waterColor",s=>s.color);if(t.output===D.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(w`
        void main(void) {
          if (waterColor.a < ${w.float(vo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(n),i.code.add(w`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==D.Color&&t.output!==D.Alpha||(e.include(UR,t),e.include(AE,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(n),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(vo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===D.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(xu,t),t.output){case D.Alpha:e.include(fn,t),i.uniforms.add(n),i.code.add(w`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case D.Color:e.include(K4),e.include(ZZ,{pbrMode:et.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Tae),e.include(fn,t),e.include(vw,t),e.include(ZCe,t),i.uniforms.add(n,new Ce("timeElapsed",s=>s.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),fp(i,t),i.include(cm),r0(i),lm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?w`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===rt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case D.Normal:e.include(UR,t),e.include(Tae,t),e.include(fn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(n),r.code.add(w`
        void main(void) {
          if (waterColor.a < ${w.float(vo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Ce("timeElapsed",s=>s.timeElapsed)),i.code.add(w`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case D.Highlight:e.include(c0,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(vo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(fn,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case D.ObjectAndLayerIdColor:e.include(GP,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(w`
      void main(void) {
        if (waterColor.a < ${w.float(vo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(fn,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const not=Object.freeze(Object.defineProperty({__proto__:null,build:iot},Symbol.toStringTag,{value:"Module"}));let QCe=class JCe extends Tr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new vr(e.rctx,JCe.shader.get().build(this.configuration),fr)}_setPipelineState(e){const r=this.configuration,i=e===rt.NONE,n=e===rt.FrontFace;return Ot({blending:r.output!==D.Normal&&r.output!==D.Highlight&&r.output!==D.ObjectAndLayerIdColor&&r.transparent?i?fu:u0(e):null,depthTest:{func:f1(e)},depthWrite:i?r.writeDepth?$l:null:S8(e),colorWrite:Ft,polygonOffset:i||n?null:A8(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};QCe.shader=new _r(not,()=>ce(()=>import("./WaterSurface.glsl-a424eae6.js"),[]));let $s=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.transparencyPassType=rt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};h([U({count:D.COUNT})],$s.prototype,"output",void 0),h([U({count:rt.COUNT})],$s.prototype,"transparencyPassType",void 0),h([U()],$s.prototype,"spherical",void 0),h([U()],$s.prototype,"receiveShadows",void 0),h([U()],$s.prototype,"hasSlicePlane",void 0),h([U()],$s.prototype,"transparent",void 0),h([U()],$s.prototype,"enableOffset",void 0),h([U()],$s.prototype,"writeDepth",void 0),h([U()],$s.prototype,"hasScreenSpaceReflections",void 0),h([U()],$s.prototype,"doublePrecisionRequiresObfuscation",void 0),h([U()],$s.prototype,"hasCloudsReflections",void 0),h([U()],$s.prototype,"objectAndLayerIdColorInstanced",void 0),h([U()],$s.prototype,"isDraped",void 0),h([U()],$s.prototype,"hasMultipassTerrain",void 0),h([U()],$s.prototype,"cullAboveGround",void 0),h([U({constValue:et.Water})],$s.prototype,"pbrMode",void 0),h([U({constValue:!0})],$s.prototype,"useCustomDTRExponentForWater",void 0),h([U({constValue:!0})],$s.prototype,"highStepCount",void 0),h([U({constValue:!1})],$s.prototype,"useFillLights",void 0);let sot=class extends h1{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===D.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(QCe,e)}},KCe=class extends IJ{constructor(e){super(e,new e3e),this._configuration=new $s,this.animation=new A2e}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<E8,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<oot;const i=this.animation.advance(e);return this.setParameters({timeElapsed:OX(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case D.Normal:return e===le.DRAPED_WATER;case D.Color:if(this.parameters.isDraped)return e===le.DRAPED_MATERIAL;break;case D.Alpha:break;case D.Highlight:case D.ObjectAndLayerIdColor:return e===le.OPAQUE_MATERIAL||e===le.DRAPED_MATERIAL;default:return!1}let i=le.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new sot(e)}createBufferWriter(){return new DE(se("enable-feature:objectAndLayerId-rendering")?Hst:Gst)}},e3e=class extends KQ{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=or(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=$t(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=O(),this.modelTransformation=null}};const oot=35e3;let NJ=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function Sae(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const n=e.get(i.to);n&&(i.to=n.to,e.delete(n.from),t.removeUnordered(n),r=!0)})}let Eae=class extends NJ{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},aot=class{constructor(){this.first=0,this.count=0}},lot=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Nt({allocator:e=>e||new NJ,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=dI(),this.drawCommandsHighlight=dI(),this.drawCommandsOccludees=dI(),this.drawCommandsShadowHighlightRest=dI()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=r,n.to=i,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=n.from)):(i.first=1/0,i.count=0,this._instances.forEach(s=>{i.first=Math.min(i.first,s.from),i.count=Math.max(i.count,s.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,n)=>i.from===n.from?i.to-n.to:i.from-n.from);for(const i of r)i.isVisible&&(Cae(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),Cae(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function cot(t){return t.vao!=null}function dI(){return new Nt({allocator:t=>t||new aot,deallocator:t=>t})}function Cae(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(uot(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function uot(t,e){return t.first+t.count>=e.from}let hot=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const XD=-3;var og;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(og||(og={}));let dot=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=pot+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,r,i,n=0){this._storage.put(this,e,r,i,n)}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},t3e=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Nt,this._users=new Nt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,r,i,n,s){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,og.ALL)),n>this._maxSize)return void this._notifyRemove(r,i,og.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return void console.warn("Refusing to cache entry with invalid size "+n);const a=1+Math.max(s,XD)-XD;this._db.set(r,{entry:i,size:n,lifetime:a,lives:a}),this._size+=n,e.size+=n,this._checkSizeLimits()}updateSize(e,r,i,n){r=e.id+r;const s=this._db.get(r);if(s&&s.entry===i){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const o=this._notifyRemove(r,i,og.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);n=o}s.size=n,this._size+=n,e.size+=n,this._checkSizeLimits()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:d}=c;if(a.startsWith(u)){const p=r[d]||0;r[d]=p+o.size}})});const n={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(r);s.sort((o,a)=>r[a]-r[o]),s.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+n[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+XD-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,n)=>{n.startsWith(r)&&(this._size-=i.size,this._db.delete(n),this._notifyRemove(n,i.entry,og.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,og.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const o=s[1](r,i);return typeof o=="number"&&(n=o),!0}return!1}),n}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,r]of this._db)if(this._purgeItem(e,r),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[r,i]of this._db)if(r.startsWith(e.id)&&(this._purgeItem(r,i,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,r,i=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const n=this._notifyRemove(e,r.entry,og.SOME);n!=null&&n>0&&(this._size+=n,i&&(i.size+=n),r.lives=r.lifetime,r.size=n,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},pot=0;const fot=XD+1;let mot=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache("VaoCache",got)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(i!=null){const s=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,fot),s}const n=new vp(this._rctx,this._locations,{geometry:this._layout},{geometry:Ar.createVertex(this._rctx,gr.STATIC_DRAW)});return n.vertexBuffers.geometry.setSize(e),n}deleteVao(e){if(e==null)return null;const r=e.byteSize,i=r.toString(),n=this._cache.pop(i);return n!=null?(n.push(e),this._cache.put(i,n,r*n.length,-1)):this._cache.put(i,[e],r,-1),null}};function got(t,e){if(e===og.ALL)return void t.forEach(n=>n.dispose());const r=t.pop(),i=t.length*r.byteSize;return r.dispose(),i}let r3e=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new WCe(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new mot(e,i.vertexAttributeLocations,Mc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof KCe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Ri.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,n)=>i+n.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,o=this._dataByOrigin.get(s.localOrigin.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)return;const l=a.instances.get(s.id);if(n.updateType&(bs.GEOMETRY|bs.TRANSFORMATION)){const c=gI(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),yI()}n.updateType&(bs.HIGHLIGHT|bs.OCCLUDEE|bs.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new RE;for(const n of e){const s=n.localOrigin;if(s==null)continue;let o=i.get(s.id,null);o==null&&(o=new Aae(s.vec3),i.set(s.id,null,o)),o.changes.push(n)}for(const n of r){const s=n.localOrigin;if(s==null)continue;const o=this._dataByOrigin.get(s.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)continue;let l=i.get(s.id,a);l==null&&(l=new Aae(s.vec3),i.set(s.id,a,l)),l.changes.push(n)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:n}=this,s=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let d=n.get(l);if(a.forEach((p,m)=>{if(o.delete(l,m),m==null)return void Je(!1,"No VAO for removed geometries");if(m.instances.size===p.changes.length)return this._vaoCache.deleteVao(m.vao),qO(d.buffers,m),void(d.buffers.length===0&&u.length===0&&n.delete(l));const y=m.numElements,_=m.vao.byteSize/4,v=u.reduce((S,A)=>S+i.elementCount(A.geometry),0),b=p.changes.reduce((S,A)=>S+i.elementCount(A.geometry),0),x=Math.min((y+v-b)*s,mI),T=x>_;x>z5&&x<_/2?(p.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(m.vao),qO(d.buffers,m)):T?this._applyAndRebuild(m,u,p):this._applyRemoves(m,p)}),u.length>0)for(d==null&&(d=new hot(c.origin),n.set(l,d)),d.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)d.buffers.push(this._applyAndRebuild(new lot,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,Do(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const y of i.changes)e.deleteInstance(y.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(mI/o);let l=e.numElements;for(;r.length>0;){const y=r.pop(),_=n.elementCount(y.geometry);if(l+_>a&&l>0){r.push(y);break}l+=_;const v=new Eae(y,0,0);Je(e.instances.get(y.id)==null),e.addInstance(y.id,v)}const c=l*o,u=gI(c),d=n.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((y,_)=>{this._writeGeometry(y.geometry,d,p);const v=p;p+=n.elementCount(y.geometry.geometry),e.updateInstance(_,v,p),e.updateDrawState(y)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Pae(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),yI(),e.holes.clear();const m=e.holes.pushNew();return m.from=p,m.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Lp.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const d=Lp.pushNew();d.from=c.from,d.to=c.to}Sae(Lp);const i=this._bufferWriter.vertexBufferLayout.stride/4,n=Lp.reduce((a,l)=>Math.max(a,l.numElements),0)*i,s=gI(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;Lp.forAll(a=>o.setSubData(s,a.from*i,0,a.numElements*i)),yI(),e.holes.pushArray(Lp.data,Lp.length),Lp.forAll((a,l)=>Lp.data[l]=null),Lp.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!cot(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,s=e.numElements,o=r.reduce((b,x)=>b+i.elementCount(x.geometry),0),a=Math.min((s+o)*n,mI),l=4*a;if(e.vao.byteSize<Pae(mI-z5)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);Sae(e.holes);const c=new Array;for(const b of r){const x=i.elementCount(b.geometry),T=yot(e.holes,x);c.push(T)}const u=e.vao.vertexBuffers.geometry;let d=0,p=0,m=0;const y=gI(a),_=i.vertexBufferLayout.createView(y.buffer);r.forEach((b,x)=>{const T=c[x];if(T==null)return;if(m!==T){const C=m-p;C>0&&u.setSubData(y,p*n,0,C*n),p=T,d=0}const S=i.elementCount(b.geometry);this._writeGeometry(b,_,d),d+=S,m=T+S;const A=new Eae(b,T,T+S);Je(e.instances.get(b.id)==null),e.addInstance(b.id,A),e.drawCommandsDirty=!0});const v=m-p;v>0&&u.setSubData(y,p*n,0,v*n),pDe(r,(b,x)=>c[x]==null),yI()}_writeGeometry(e,r,i){const n=e.localOrigin.vec3;$He(Oae,-n[0],-n[1],-n[2]);const s=Vr(_ot,Oae,e.transformation);us(pI,s),Sc(pI,pI),this._bufferWriter.write(s,pI,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}prepareTechnique(e){const{output:r,bindParameters:i}=e;if(!this.requiresSlot(i.slot,r))return null;const n=r===D.Highlight||r===D.ShadowHighlight;if(n&&!this._hasHighlights)return null;const s=r===D.ShadowExcludeHighlight,o=!(n||s);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(n&&!l.hasHighlights)continue;const c=(n?l.drawCommandsHighlight:s&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,u=o&&l.drawCommandsOccludees||null;if(c!=null&&c.length||u!=null&&u.length){const d=this._glMaterials.load(e.rctx,i.slot,r),p=d!=null?d.beginSlot(i):null;if(p!=null)return p}}return null}render(e,r){var c;const{output:i,bindParameters:n}=e,s=i===D.Highlight||i===D.ShadowHighlight,o=i===D.ShadowExcludeHighlight,a=!(s||o),l=this._rctx;(c=l.appleAmdDriverHelper)==null||c.resetIndicesType(),l.bindTechnique(r,this.material.parameters,n);for(const u of this._dataByOrigin.values())for(const d of u.buffers){if(s&&!d.hasHighlights)continue;const p=(s?d.drawCommandsHighlight:o&&d.needsMultipleCommands()?d.drawCommandsShadowHighlightRest:d.drawCommandsDefault)||null,m=a&&d.drawCommandsOccludees||null;(p!=null&&p.length||m!=null&&m.length)&&(r.program.bindDraw(new eW(u.origin),n,this.material.parameters),r.ensureAttributeLocations(d.vao),l.bindVAO(d.vao),p!=null&&p.length&&(r.bindPipelineState(l,n.slot,!1),p.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))),m!=null&&m.length&&(r.bindPipelineState(l,n.slot,!0),m.forAll(y=>l.drawArrays(r.primitiveType,y.first,y.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},Aae=class{constructor(e){this.origin=e,this.changes=new Array}};function yot(t,e){let r;if(!t.some(n=>!(n.numElements<e)&&(r=n,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const Oae=_e(),_ot=_e(),pI=_e(),Lp=new Nt({allocator:t=>t||new NJ,deallocator:null}),z5=65536,fI=4*z5,Rae=1024,i3e=16777216,mI=i3e/4;let YD=new Float32Array(z5);function gI(t){return YD.length<t&&(YD=new Float32Array(t)),YD}function Pae(t){const e=4*t;return e<=Rae?Rae:e<fI?fI:Math.max(Math.min(Math.ceil(1.5*e/fI)*fI,i3e),e)}function yI(){YD=new Float32Array(2)}let Hc=class extends xe{constructor(e){super(e),this._pending=new vot,this._changes=new KH,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Nt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Do(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=HCe(this._changes);let r=!1,i=!1,n=!1;return e.forEach((s,o)=>{let a=this._materialRenderers.get(o);if(!a&&s.adds.length>0&&(a=new r3e(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,n=!0),!a)return;const l=i||a.hasHighlights,c=n||a.hasWater;a.modify(s),i=i||l!==a.hasHighlights,n=n||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Do(this._materialRenderers,s=>s.hasHighlights)),n&&(this._hasWater=Do(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of i)this._pending.adds.add(s);n&&this.notifyChange("updating"),r===Hi.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===Hi.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case bs.TRANSFORMATION:case bs.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case bs.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{if(r.material.shouldRender(e)){const i=r.prepareTechnique(e);i!=null&&r.render(e,i)}})}intersect(e,r,i,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,i,r,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const n=i.material.renderPriority-r.material.renderPriority;return n!==0?n:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],J9[0]=i[0]-n,J9[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,J9,(l,c,u)=>{bot(r,u,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const n=i.graphicUid;n!=null&&n!==r&&(this.drapeSource.notifyGraphicGeometryChanged(n),r=n)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const n=i.graphicUid;n!=null&&n!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(n),r=n)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};h([f()],Hc.prototype,"drapeSource",void 0),h([f()],Hc.prototype,"updating",null),h([f()],Hc.prototype,"rctx",null),h([f()],Hc.prototype,"rendererContext",void 0),h([f()],Hc.prototype,"_materialRepository",null),h([f()],Hc.prototype,"_localOriginFactory",null),h([f({readOnly:!0})],Hc.prototype,"isEmpty",null),h([f()],Hc.prototype,"_materialRenderers",void 0),h([f()],Hc.prototype,"_geometries",void 0),Hc=h([N("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Hc);let vot=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function bot(t,e,r,i,n,s,o){const a=new kst(s,o,e),l=c=>{c.set(Ui.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((n.results.min.drapedLayerOrder==null||r>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==To.MIN&&(n.results.max.drapedLayerOrder==null||r<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===To.ALL){const c=SQ(n.ray);l(c),n.results.all.push(c)}}const J9=Ne();let FJ=class extends ln{constructor(e,r){super(e,"vec2",jr.Draw,(i,n,s,o)=>i.setUniform2fv(e,r(n,s,o)))}};const K9=4;function wot(){const t=new mr,e=t.fragment;t.include(Vh);const r=(K9+1)/2,i=1/(2*r*r);return e.include(wu),e.uniforms.add(new Ye("depthMap",n=>n.depthTexture),new Eh("tex",n=>n.colorTexture),new FJ("blurSize",n=>n.blurSize),new Ce("projScale",(n,s)=>{const o=ci(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new yr("nearFar",(n,s)=>s.camera.nearFar)),e.code.add(w`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${w.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(w`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${w.int(K9)}; r <= ${w.int(K9)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const xot=Object.freeze(Object.defineProperty({__proto__:null,build:wot},Symbol.toStringTag,{value:"Module"}));let n3e=class s3e extends Tr{initializeProgram(e){return new vr(e.rctx,s3e.shader.get().build(),fr)}initializePipeline(){return Ot({colorWrite:Ft})}};n3e.shader=new _r(xot,()=>ce(()=>import("./SSAOBlur.glsl-1cf88496.js"),[]));const Tot="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function k8(t){t.fragment.uniforms.add(new Jt("projInfo",(e,r)=>Sot(r))),t.fragment.uniforms.add(new yr("zScale",(e,r)=>o3e(r))),t.fragment.code.add(w`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Sot(t){const e=t.camera.projectionMatrix;return e[11]===0?gi(Mae,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):gi(Mae,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Mae=Qt();function o3e(t){return t.camera.projectionMatrix[11]===0?er($ae,0,1):er($ae,1,0)}const $ae=Ne(),Iae=16;function Eot(){const t=new mr,e=t.fragment;return t.include(Vh),e.include(wu),t.include(k8),e.uniforms.add(new Ce("radius",(r,i)=>UJ(i.camera))),e.code.add(w`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(w`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new yr("nearFar",(r,i)=>i.camera.nearFar),new Ye("normalMap",r=>r.normalTexture),new Ye("depthMap",r=>r.depthTexture),new yr("zScale",(r,i)=>o3e(i)),new Ce("projScale",r=>r.projScale),new Ye("rnm",r=>r.noiseTexture),new yr("rnmScale",(r,i)=>er(Lae,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Ce("intensity",r=>r.intensity),new yr("screenSize",(r,i)=>er(Lae,i.camera.fullWidth,i.camera.fullHeight))),e.code.add(w`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${w.int(Iae)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${w.int(Iae)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function UJ(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const Lae=Ne(),Cot=Object.freeze(Object.defineProperty({__proto__:null,build:Eot,getRadius:UJ},Symbol.toStringTag,{value:"Module"}));let a3e=class l3e extends Tr{initializeProgram(e){return new vr(e.rctx,l3e.shader.get().build(),fr)}initializePipeline(){return Ot({colorWrite:Ft})}};a3e.shader=new _r(Cot,()=>ce(()=>import("./SSAO.glsl-8e275b51.js"),[]));let Aot=class extends Wr{constructor(){super(...arguments),this.projScale=1}},Oot=class extends Aot{constructor(){super(...arguments),this.intensity=1}},Rot=class extends Wr{},Pot=class extends Rot{constructor(){super(...arguments),this.blurSize=Ne()}};const sA=2;let c3e=class{constructor(e,r,i,n){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=n,this._quadVAO=null,this._passParameters=new Oot,this._drawParameters=new Pot}dispose(){this.enabled=!1,this._quadVAO=Le(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){var e,r;(e=this._ssaoFBO)==null||e.resize(0,0),(r=this._blurFBO)==null||r.resize(0,0)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){var e;return(e=this._ssaoFBO)==null?void 0:e.colorTexture}render(e,r,i,n){if(this._enableTime==null||i==null||n==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const s=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=n,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*Mot/UJ(o)**6*l;const c=o.fullViewport,u=c[2],d=c[3],p=u/sA,m=d/sA;this._ssaoFBO.resize(u,d),this._blurFBO.resize(p,m),this._quadVAO==null&&(this._quadVAO=Dl(this._rctx)),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,u,d),s.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),s.bindVAO(this._quadVAO);const y=No(this._quadVAO,"geometry");s.drawArrays(Et.TRIANGLE_STRIP,0,y);const _=s.bindTechnique(this._blurTechnique,this._passParameters,e);s.setViewport(0,0,p,m),s.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,er(this._drawParameters.blurSize,0,sA/d),_.bindDraw(this._drawParameters,e,this._passParameters),s.setViewport(0,0,p,m),s.drawArrays(Et.TRIANGLE_STRIP,0,y),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,u,d),s.setClearColor(1,1,1,0),s.clear(yi.COLOR_BUFFER_BIT),s.setViewport(0,0,p,m),this._drawParameters.colorTexture=this._blurFBO.colorTexture,er(this._drawParameters.blurSize,sA/u,0),_.bindDraw(this._drawParameters,e,this._passParameters),s.drawArrays(Et.TRIANGLE_STRIP,0,y),s.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new pr;e.wrapMode=Pt.CLAMP_TO_EDGE,this._ssaoFBO=new hs(this._rctx,e),this._blurFBO=new hs(this._rctx,e);const r=Uint8Array.from(atob(Tot),i=>i.charCodeAt(0));e.pixelFormat=Tt.RGB,e.wrapMode=Pt.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new Ct(this._rctx,e,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(a3e)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(n3e)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=Le(this._passParameters.noiseTexture),this._blurFBO=Le(this._blurFBO),this._ssaoFBO=Le(this._ssaoFBO)}get gpuMemoryUsage(){var e,r;return(((e=this._blurFBO)==null?void 0:e.gpuMemoryUsage)??0)+(((r=this._ssaoFBO)==null?void 0:r.gpuMemoryUsage)??0)}};const Mot=.5;let kJ=class u3e extends Tr{initializeProgram(e){return new vr(e.rctx,u3e.shader.get().build(),fr)}initializePipeline(){return this.configuration.hasAlpha?Ot({blending:So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft}):Ot({colorWrite:Ft})}};kJ.shader=new _r(Ynt,()=>ce(()=>import("./TextureOnly.glsl-41ddb8a9.js"),[]));let zJ=class extends va{constructor(){super(...arguments),this.hasAlpha=!1}};h([U()],zJ.prototype,"hasAlpha",void 0);let sf=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Vi,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Nt,this._passParameters=new wCe,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new lt,this.worldToPCSRatio=1,this.events=new Bn,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:i,markerTextureRepository:n}=e;this._shaderTechniqueRepository=new xCe({rctx:this._rctx,viewingMode:$e.Local,stippleTextureRepository:i,markerTextureRepository:n,waterTextureRepository:r}),this._renderContext=new GCe(this._rctx,new $J(this._rctx,this.view.state.viewingMode),new c3e(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ue(()=>r.updating,()=>this.events.emit("content-changed"),An),ue(()=>this.spatialReference,s=>this._localOriginFactory=new PJ(s),An),Ol(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new TCe(e.textureRepository,this._shaderTechniqueRepository,s=>{(s.renderOccluded&B5)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=le.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=yxe(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=rt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new sQ(Se(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(dt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Fi(this._debugTextureTechnique),this._passParameters.texture=Le(this._passParameters.texture),this._bindParameters.highlightDepthTexture=Le(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Me(this._shaderTechniqueRepository),this._temporaryFBO=Le(this._temporaryFBO),this._quadVAO=Le(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||Do(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Hc)}createDrapeSourceRenderer(e,r,i){const n=this._renderers.get(e);n!=null&&n.destroy();const s=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ue(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const r=ZDe();if(this._overlayRenderTarget!=null)for(const i of this._overlayRenderTarget.renderTargets){const n=this.overlays[Oi.INNER].validTargets[i.type];e=this._overlayRenderTarget.validateUsageForTarget(n,i,r)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=VL(e,i=>i.drapeTargetType===ZH.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=VL(e,i=>i.drapeSourceType===mO.Features),r.hasDrapedRasterSource=VL(e,i=>i.drapeSourceType===mO.RasterImage)})}ensureOverlays(e,r){this._overlays==null&&(this._overlayRenderTarget=new Wnt(this._rctx),this._overlays=[new poe(Oi.INNER,this._overlayRenderTarget),new poe(Oi.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Le(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||r(n))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Wa,e=>e.updatePolicy===O_.SYNC)}get isEmpty(){return!Kr.OVERLAY_DRAW_DEBUG_TEXTURE&&!Do(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const n=e.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:s,contentPixelRatio:o}=i;this._screenToWorldRatio=o*e.mapUnitsPerPixel/YQ;const a=r.output;if(this.isEmpty||a===D.Highlight&&!this.hasHighlights||a===D.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=r.fbo;if(!l.isValid())return!1;const c=2*e.resolution,u=e.resolution;l.resize(c,u);const d=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===D.Normal?le.DRAPED_WATER:le.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(d),e.index===Oi.INNER&&(d.setClearColor(0,0,0,0),d.clearSafe(yi.COLOR_BUFFER_BIT)),r.type===tn.Occluded&&(this._renderContext.renderOccludedMask=B5),Kr.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==tn.Occluded)for(let p=0;p<n.numViews;p++)this._setViewParameters(n.extents[p],e),this._drawDebugTexture(e.resolution,Iot[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:p,renderer:m})=>{if(r.type===tn.ColorNoRasterImage&&p.drapeSourceType===mO.RasterImage)return;const{fullOpacity:y}=p,_=y!=null&&y<1&&a===D.Color;_&&(this.bindTemporaryFramebuffer(this._rctx,c,u),d.clearSafe(yi.COLOR_BUFFER_BIT));for(let v=0;v<n.numViews;v++)this._setViewParameters(n.extents[v],e),m.render(this._renderContext);_&&this._temporaryFBO!=null&&(l.bind(d),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),y,e.index))}),d.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){this._temporaryFBO==null&&(this._temporaryFBO=new bCe(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,n){var o;let s=0;for(const a of this._renderers.values())s=((o=a.intersect)==null?void 0:o.call(a,e,r,i,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const n=e.indexOf(i.layer),s=n>=0,o=this._renderers.size*(i.renderGroup??(s?N5.MapLayer:N5.ViewLayer))+(s?n:0);this._sortedRenderers.push(new $ot(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],mve(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),OP(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Do(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Do(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Do(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(Et.TRIANGLE_STRIP,0,No(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r){if(ne(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let n=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=255):(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const s=new pr(e);s.samplingMode=At.NEAREST,this._passParameters.texture=new Ct(this._rctx,s,i);const o=new zJ;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(kJ,o),this._quadVAO=Dl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};h([f()],sf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),h([f({autoDestroy:!0})],sf.prototype,"_shaderTechniqueRepository",void 0),h([f({constructOnly:!0})],sf.prototype,"view",void 0),h([f()],sf.prototype,"worldToPCSRatio",void 0),h([f()],sf.prototype,"spatialReference",void 0),h([f({type:Boolean,readOnly:!0})],sf.prototype,"updating",null),h([f()],sf.prototype,"isEmpty",null),sf=h([N("esri.views.3d.terrain.OverlayRenderer")],sf);let $ot=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const Iot=[[1,.5,.5],[.5,.5,1]],BJ=-2,B5=Ri.OccludeAndTransparent;function VJ(t,e,r,i){const n=YP(t.rings,!!t.hasZ,Kf.CCW_IS_HOLE),s=Ys(n.position.length),o=SEe(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,r,i),a=o!=null;return new Not(n.position,s,p3e(n.polygons,n.position,s),d3e(n.outlines,n.position,s),a,o)}function h3e(t,e){const r=YP(t.rings,!1,Kf.CCW_IS_HOLE),i=$i(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=BJ;return{position:r.position,polygons:p3e(r.polygons,r.position),outlines:d3e(r.outlines,r.position),projectionSuccess:i}}function d3e(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:n})=>{const s=3*i,o=3*n;return r!=null?new f3e(i,n,Ch(e,s,o),Ch(r,s,o)):new GJ(i,n,Ch(e,s,o))})}function p3e(t,e,r=null){const i=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,u=o.map(p=>p-n),d=r!=null?new Lot(n,s,Ch(e,3*n,3*s),Ch(r,l,c),u,a):new Dot(n,s,Ch(e,3*n,3*s),u,a);i.push(d)}return i}let GJ=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},f3e=class extends GJ{constructor(e,r,i,n){super(e,r,i),this.mapPositions=n}},Lot=class extends f3e{constructor(e,r,i,n,s,o){super(e,r,i,n),this.holeIndices=s,this.pathLengths=o}},Dot=class extends GJ{constructor(e,r,i,n,s){super(e,r,i),this.holeIndices=n,this.pathLengths=s}},Not=class{constructor(e,r,i,n,s,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function bw(t,e,r,i,n,s=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(n)),a=r*o,l=i*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,d=e*s;t[d]=Dae(c),t[d+1]=Dae(u)}function Fot(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let n=0;n<e;++n)bw(r,n,t[i++],t[i++],t[i++]);return r}function Uot(t,e,r,i=2){const n=r*i,s=Nae(e[n]),o=Nae(e[n+1]),a=1-Math.abs(s)-Math.abs(o);t[2]=a,a<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=o),me(t,t)}function Dae(t){return ge(Math.round(32767*t),-32767,32767)}function Nae(t){return ge(t/32767,-1,1)}function m3e(t,e){const r=t.fragment;switch(r.code.add(w`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Zi.None:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Zi.View:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Zi.WindingOrder:r.code.add(w`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Zi.COUNT:}}var Zi;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Zi||(Zi={}));function g3e({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||Bo(s,Zs))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const z8=[1,1,.5],jJ=[0,.6,.2],kot=[0,1,.2];function y3e(t){t.vertex.code.add(w`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let zot=class extends va{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function _3e(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(E.MODELORIGINHI,"vec3"),t.attributes.add(E.MODELORIGINLO,"vec3"),t.attributes.add(E.MODEL,"mat3"),t.attributes.add(E.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(a5,e),r.uniforms.add(new pu("viewOriginHi",(i,n)=>uXe(ne(_I,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),_I)),new pu("viewOriginLo",(i,n)=>hXe(ne(_I,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),_I)))),r.code.add(w`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(w`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?w`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(w`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===D.Normal&&(jS(r),r.code.add(w`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(w`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}h([U()],zot.prototype,"instancedDoublePrecision",void 0);const _I=O();var as;function Bot(t){switch(t){case"multiply":default:return as.Multiply;case"ignore":return as.Ignore;case"replace":return as.Replace;case"tint":return as.Tint}}function v3e(t,e,r){if(t==null||e===as.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=ge(Math.round(t[3]*V5),0,V5),n=i===0||e===as.Tint?0:e===as.Replace?Vot:Got;r[0]=ge(Math.round(t[0]*Sx),0,Sx),r[1]=ge(Math.round(t[1]*Sx),0,Sx),r[2]=ge(Math.round(t[2]*Sx),0,Sx),r[3]=i+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(as||(as={}));const Sx=255,V5=85,Vot=V5,Got=2*V5;function b3e(t){t.vertex.code.add(w`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${w.int(as.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${w.int(as.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${w.int(as.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${w.int(as.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function w3e(t,e){e.hasSymbolColors?(t.include(b3e),t.attributes.add(E.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(w`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new QP("colorMixMode",r=>mSe[r.colorMixMode])),t.vertex.code.add(w`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function qw(t,e){e.hasVertexColors?(t.attributes.add(E.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(w`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(w`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(w`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function jot(t){t.fragment.code.add(w`
    #define discardOrAdjustAlpha(color) { if (color.a < ${w.float(vo)}) { discard; } }
  `)}let Nb=class extends ln{constructor(e,r){super(e,"float",jr.Draw,(i,n,s)=>i.setUniform1f(e,r(n,s)))}};function Fb(t,e){x3e(t,e,new Ce("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Hot(t,e){x3e(t,e,new Nb("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function x3e(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Gr.Mask&&e.alphaDiscardMode!==Gr.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Gr.Blend:return t.include(jot);case Gr.Opaque:i.code.add(w`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Gr.Mask:i.code.add(w`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Gr.MaskBlend:t.fragment.code.add(w`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function T3e(t,e){const{vertex:r,fragment:i}=t,n=e.hasModelTransformation;if(n){const o=hi();r.uniforms.add(new Mi("model",a=>a.modelTransformation??yn)),r.uniforms.add(new Gh("normalTransform",a=>(Qf(o,a.modelTransformation??yn),o)))}const s=e.hasColorTexture&&e.alphaDiscardMode!==Gr.Opaque;switch(e.output){case D.Depth:case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:case D.ObjectAndLayerIdColor:xc(r,e),t.include(Cl,e),t.include(Uf,e),t.include(Tg,e),t.include(Xg,e),t.include(fn,e),t.include(GP,e),pw(t),t.varyings.add("depth","float"),s&&i.uniforms.add(new Ye("tex",o=>o.texture)),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(Fb,e),i.code.add(w`
          void main(void) {
            discardBySlice(vpos);
            ${s?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===D.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:w`outputDepth(depth);`}
          }
        `);break;case D.Normal:{xc(r,e),t.include(Cl,e),t.include(ZP,e),t.include(F8,e),t.include(Uf,e),t.include(Tg,e),s&&i.uniforms.add(new Ye("tex",a=>a.texture)),e.normalType===br.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===br.Attribute||e.normalType===br.Compressed;r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?w`vNormalWorld = ${n?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:w`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(fn,e),t.include(Fb,e),i.code.add(w`
          void main() {
            discardBySlice(vpos);
            ${s?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===br.ScreenDerivative?w`vec3 normal = screenDerivativeNormal(vPositionView);`:w`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case D.Highlight:xc(r,e),t.include(Cl,e),t.include(Uf,e),t.include(Tg,e),s&&i.uniforms.add(new Ye("tex",o=>o.texture)),r.code.add(w`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(fn,e),t.include(Fb,e),t.include(c0,e),i.code.add(w`
          void main() {
            discardBySlice(vpos);
            ${s?w`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function S3e(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(E.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Zi.WindingOrder?r.code.add(w`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(w`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(w`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Pn.None&&(t.include(qZ,e),r.uniforms.add(e.pbrTextureBindType===jr.Pass?new Ye("normalTexture",i=>i.textureNormal):new Eh("normalTexture",i=>i.textureNormal)),r.code.add(w`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function JP(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new Ye("ssaoTex",(i,n)=>n.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/sA),r.code.add(w`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(w`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function KP(t){t.constants.add("ambientBoostFactor","float",Xxe)}function NE(t){t.uniforms.add(new Ce("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function ww(t,e){const r=t.fragment;switch(t.include(JP,e),e.pbrMode!==et.Disabled&&t.include(DJ,e),t.include(ZZ,e),t.include(IP),r.code.add(w`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===et.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),KP(r),NE(r),r0(r),r.code.add(w`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?w`normalize(vPosWorld)`:w`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),lm(r),r.code.add(w`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case et.Disabled:case et.WaterOnIntegratedMesh:case et.Water:t.include(K4),r.code.add(w`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case et.Normal:case et.Schematic:r.code.add(w`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(w`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new kf("hasFillLights",(i,n)=>n.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(w`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Ce("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new Ce("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)),r.code.add(w`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(w`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===et.Schematic?w`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:w`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case et.Terrain:case et.TerrainWithWater:t.include(K4),r.code.add(w`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case et.COUNT:}}function Pl(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function E3e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ZD(t,e,r,i,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function Wot(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:E3e,create:Pl,createView:Wot,fromValues:ZD},Symbol.toStringTag,{value:"Module"}));function qot(t){t.vertex.uniforms.add(new Gh("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:Pl())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(w`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Xot(t){t.vertex.uniforms.add(new Gh("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:Pl())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(w`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Yot(t){t.vertex.uniforms.add(new Gh("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:Pl())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(w`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Zot(t){t.vertex.uniforms.add(new Gh("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:Pl())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(w`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Qot(t){t.vertex.uniforms.add(new Gh("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:Pl())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(w`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function kR(t){t.include(cm),t.code.add(w`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${w.int(as.Multiply)}) {
        return allMixed;
      }
      if (mode == ${w.int(as.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.int(as.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${w.int(as.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${w.int(as.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Jot(t){const e=new mr,{vertex:r,fragment:i,varyings:n}=e;if(xc(r,t),e.include(LP),n.add("vpos","vec3"),e.include(Tg,t),e.include(_3e,t),e.include(oSe,t),t.hasColorTextureTransform&&e.include(qot),t.output===D.Color||t.output===D.Alpha){t.hasNormalTextureTransform&&e.include(Xot),t.hasEmissionTextureTransform&&e.include(Yot),t.hasOcclusionTextureTransform&&e.include(Zot),t.hasMetallicRoughnessTextureTransform&&e.include(Qot),fp(r,t),e.include(ZP,t),e.include(Cl,t);const s=t.normalType===br.Attribute||t.normalType===br.Compressed;s&&t.offsetBackfaces&&e.include(y3e),e.include(S3e,t),e.include(F8,t),t.instancedColor&&e.attributes.add(E.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(Uf,t),e.include(AE,t),e.include(w3e,t),e.include(qw,t),r.uniforms.add(new Jt("externalColor",a=>a.externalColor)),n.add("vcolorExt","vec4"),t.hasMultipassTerrain&&n.add("depth","float");const o=t.hasModelTransformation;if(o){const a=hi();r.uniforms.add(new Mi("model",l=>l.modelTransformation??yn)),r.uniforms.add(new Gh("normalTransform",l=>(Qf(a,l.modelTransformation??yn),a)))}r.code.add(w`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${w.float(vo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?w`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?w`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?w`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?w`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?w`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?w`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case D.Alpha:e.include(fn,t),e.include(Fb,t),e.include(xu,t),i.uniforms.add(new Ce("opacity",s=>s.opacity),new Ce("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Ye("tex",s=>s.texture)),i.include(kR),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?w`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case D.Color:e.include(fn,t),e.include(ww,t),e.include(JP,t),e.include(Fb,t),e.include(t.instancedDoublePrecision?U8:vw,t),e.include(xu,t),fp(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new Lt("ambient",s=>s.ambient),new Lt("diffuse",s=>s.diffuse),new Ce("opacity",s=>s.opacity),new Ce("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Ye("tex",s=>s.texture)),e.include(YZ,t),e.include(DJ,t),i.include(kR),e.include(m3e,t),KP(i),NE(i),lm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===br.ScreenDerivative?w`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:w`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===et.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?w`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?w`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?w`normalUV`:"vuv0"});`:w`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?w`normalize(posWorld);`:w`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?w`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===et.Normal||t.pbrMode===et.Schematic?w`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?w`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:w`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===rt.Color?w`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(T3e,t),e}const Kot=Object.freeze(Object.defineProperty({__proto__:null,build:Jot},Symbol.toStringTag,{value:"Module"}));let eat=class extends qCe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=na(z8),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=ui.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Se(0,0,0),this.instancedDoublePrecision=!1,this.normalType=br.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Se(.2,.2,.2),this.diffuse=Se(.8,.8,.8),this.externalColor=$t(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=O(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=uw.Less,this.textureAlphaMode=Gr.Blend,this.textureAlphaCutoff=$5,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Ri.Occlude}},tat=class extends XCe{constructor(){super(...arguments),this.origin=O(),this.slicePlaneLocalOrigin=this.origin}},HJ=class C3e extends Tr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Pn.Default:Pn.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,C3e.shader)}_initializeProgram(e,r){return new vr(e.rctx,r.get().build(this.configuration),fr)}_convertDepthTestFunction(e){return e===uw.Lequal?Hr.LEQUAL:Hr.LESS}_makePipeline(e,r){const i=this.configuration,n=e===rt.NONE,s=e===rt.FrontFace;return Ot({blending:i.output!==D.Color&&i.output!==D.Alpha||!i.transparent?null:n?fu:u0(e),culling:rat(i)?J6(i.cullFace):null,depthTest:{func:f1(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(n||s)&&i.writeDepth?$l:null,colorWrite:Ft,stencilWrite:i.hasOccludees?em:null,stencilTest:i.hasOccludees?r?r1:m1:null,polygonOffset:n||s?null:A8(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function rat(t){return t.cullFace!==ui.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}HJ.shader=new _r(Kot,()=>ce(()=>import("./DefaultMaterial.glsl-ab417bbf.js"),[]));let kt=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.alphaDiscardMode=Gr.Opaque,this.doubleSidedMode=Zi.None,this.pbrMode=et.Disabled,this.cullFace=ui.None,this.transparencyPassType=rt.NONE,this.normalType=br.Attribute,this.textureCoordinateType=Pn.None,this.customDepthTest=uw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};h([U({count:D.COUNT})],kt.prototype,"output",void 0),h([U({count:Gr.COUNT})],kt.prototype,"alphaDiscardMode",void 0),h([U({count:Zi.COUNT})],kt.prototype,"doubleSidedMode",void 0),h([U({count:et.COUNT})],kt.prototype,"pbrMode",void 0),h([U({count:ui.COUNT})],kt.prototype,"cullFace",void 0),h([U({count:rt.COUNT})],kt.prototype,"transparencyPassType",void 0),h([U({count:br.COUNT})],kt.prototype,"normalType",void 0),h([U({count:Pn.COUNT})],kt.prototype,"textureCoordinateType",void 0),h([U({count:uw.COUNT})],kt.prototype,"customDepthTest",void 0),h([U()],kt.prototype,"spherical",void 0),h([U()],kt.prototype,"hasVertexColors",void 0),h([U()],kt.prototype,"hasSymbolColors",void 0),h([U()],kt.prototype,"hasVerticalOffset",void 0),h([U()],kt.prototype,"hasSlicePlane",void 0),h([U()],kt.prototype,"hasSliceHighlight",void 0),h([U()],kt.prototype,"hasColorTexture",void 0),h([U()],kt.prototype,"hasMetallicRoughnessTexture",void 0),h([U()],kt.prototype,"hasEmissionTexture",void 0),h([U()],kt.prototype,"hasOcclusionTexture",void 0),h([U()],kt.prototype,"hasNormalTexture",void 0),h([U()],kt.prototype,"hasScreenSizePerspective",void 0),h([U()],kt.prototype,"hasVertexTangents",void 0),h([U()],kt.prototype,"hasOccludees",void 0),h([U()],kt.prototype,"hasMultipassTerrain",void 0),h([U()],kt.prototype,"hasModelTransformation",void 0),h([U()],kt.prototype,"offsetBackfaces",void 0),h([U()],kt.prototype,"vvSize",void 0),h([U()],kt.prototype,"vvColor",void 0),h([U()],kt.prototype,"receiveShadows",void 0),h([U()],kt.prototype,"receiveAmbientOcclusion",void 0),h([U()],kt.prototype,"textureAlphaPremultiplied",void 0),h([U()],kt.prototype,"instanced",void 0),h([U()],kt.prototype,"instancedColor",void 0),h([U()],kt.prototype,"objectAndLayerIdColorInstanced",void 0),h([U()],kt.prototype,"instancedDoublePrecision",void 0),h([U()],kt.prototype,"doublePrecisionRequiresObfuscation",void 0),h([U()],kt.prototype,"writeDepth",void 0),h([U()],kt.prototype,"transparent",void 0),h([U()],kt.prototype,"enableOffset",void 0),h([U()],kt.prototype,"cullAboveGround",void 0),h([U()],kt.prototype,"snowCover",void 0),h([U()],kt.prototype,"hasColorTextureTransform",void 0),h([U()],kt.prototype,"hasEmissionTextureTransform",void 0),h([U()],kt.prototype,"hasNormalTextureTransform",void 0),h([U()],kt.prototype,"hasOcclusionTextureTransform",void 0),h([U()],kt.prototype,"hasMetallicRoughnessTextureTransform",void 0),h([U({constValue:!0})],kt.prototype,"hasVvInstancing",void 0),h([U({constValue:!1})],kt.prototype,"useCustomDTRExponentForWater",void 0),h([U({constValue:!1})],kt.prototype,"supportsTextureAtlas",void 0),h([U({constValue:!0})],kt.prototype,"useFillLights",void 0);function iat(t){const e=new mr,{vertex:r,fragment:i,varyings:n}=e;return xc(r,t),e.include(LP),n.add("vpos","vec3"),e.include(Tg,t),e.include(_3e,t),e.include(oSe,t),t.output!==D.Color&&t.output!==D.Alpha||(fp(e.vertex,t),e.include(ZP,t),e.include(Cl,t),t.offsetBackfaces&&e.include(y3e),t.instancedColor&&e.attributes.add(E.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.hasMultipassTerrain&&n.add("depth","float"),e.include(Uf,t),e.include(AE,t),e.include(w3e,t),e.include(qw,t),r.uniforms.add(new Jt("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),r.code.add(w`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${w.float(vo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?w`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===D.Alpha&&(e.include(fn,t),e.include(Fb,t),e.include(xu,t),i.uniforms.add(new Ce("opacity",s=>s.opacity),new Ce("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Ye("tex",s=>s.texture)),i.include(kR),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?w`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===D.Color&&(e.include(fn,t),e.include(ww,t),e.include(JP,t),e.include(Fb,t),e.include(t.instancedDoublePrecision?U8:vw,t),e.include(xu,t),fp(e.fragment,t),r0(i),KP(i),NE(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Lt("ambient",s=>s.ambient),new Lt("diffuse",s=>s.diffuse),new Ce("opacity",s=>s.opacity),new Ce("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Ye("tex",s=>s.texture)),e.include(YZ,t),e.include(DJ,t),i.include(kR),lm(i),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?w`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?w`colorUV`:w`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:w`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===et.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?w`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?w`albedo = mix(albedo, vec3(1), 0.9);`:w``}
        ${w`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===et.Normal||t.pbrMode===et.Schematic?t.spherical?w`vec3 normalGround = normalize(vpos + localOrigin);`:w`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:w``}
        ${t.pbrMode===et.Normal||t.pbrMode===et.Schematic?w`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?w`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:w`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===rt.Color?w`fragColor = premultiplyAlpha(fragColor);`:w``}
      }
    `)),e.include(T3e,t),e}const nat=Object.freeze(Object.defineProperty({__proto__:null,build:iat},Symbol.toStringTag,{value:"Module"}));let A3e=class O3e extends HJ{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=br.Attribute,r.doubleSidedMode=Zi.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,O3e.shader)}};A3e.shader=new _r(nat,()=>ce(()=>import("./RealisticTree.glsl-2623185f.js"),[]));let tm=class extends p1{constructor(e){super(e,aat),this.supportsEdges=!0,this._configuration=new kt,this._vertexBufferLayout=lat(this.parameters)}isVisibleForOutput(e){return e!==D.Shadow&&e!==D.ShadowExcludeHighlight&&e!==D.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:n,vvColor:s}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||s||n;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?ui.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==D.Color&&e!==D.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Zi.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Zi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Zi.WindingOrder:Zi.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?et.Schematic:et.Normal:et.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<E8,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,n,s,o){if(this.parameters.verticalOffset!=null){const a=i.camera;ne(tz,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case $e.Global:l=me(Fae,tz);break;case $e.Local:l=re(Fae,hat)}let c=0;const u=ae(dat,tz,a.eye),d=Te(u),p=te(u,u,1/d);let m=null;this.parameters.screenSizePerspective&&(m=fe(l,p)),c+=pSe(a,d,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),te(l,l,c),zo(ez,l,i.transform.inverseRotation),n=ae(cat,n,ez),s=ae(uat,s,ez)}cSe(e,i,n,s,vH(i.verticalOffset),o)}requiresSlot(e,r){return r===D.Color||r===D.Alpha||r===D.Depth||r===D.Normal||r===D.Shadow||r===D.ShadowHighlight||r===D.ShadowExcludeHighlight||r===D.Highlight||r===D.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:le.OPAQUE_MATERIAL)||e===le.DRAPED_MATERIAL:!1}createGLMaterial(e){return new sat(e)}createBufferWriter(){return new DE(this._vertexBufferLayout)}},sat=class extends XZ{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==D.Color&&this._output!==D.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return ne(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?A3e:HJ,e)}},oat=class extends eat{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const aat=new oat;function lat(t){const e=Gi().vec3f(E.POSITION);return t.normalType===br.Compressed?e.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(E.NORMAL),t.hasVertexTangents&&e.vec4f(E.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(E.UV0),t.hasVertexColors&&e.vec4u8(E.COLOR),t.hasSymbolColors&&e.vec4u8(E.SYMBOLCOLOR),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),e}const cat=O(),uat=O(),hat=Se(0,0,1),Fae=O(),ez=O(),tz=O(),dat=O(),pat=["polygon","extent"];let fat=class extends hm{constructor(e,r,i,n){super(e,r,i,n),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=R8(this._getSymbolSize());if(c)throw new Y("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=na(r),n=r[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:n,transparent:s,cullFace:s?ui.None:ui.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:br.Compressed};this._material=new tm(o),this._bottomMaterial=new tm({...o,cullFace:ui.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,pat,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r,new wp);return this._createAs3DShape(r,e.renderingInfo,i,n,r.uid)}layerOpacityChanged(e,r){var a,l;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._getCombinedOpacity(i),s=n<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:n,transparent:s}),this._bottomMaterial.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(c=>{const u=r(c);u!=null&&u.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,K_)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const n=r(i);n!=null&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?Unt(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?$n.RecreateSymbol:$n.RecreateGraphics}async queryForSnapping(e,r,i,n){const s=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/FV(r),{objectId:o,target:a}=e,l=ye(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:u}=e,d=ye(c),p=ye(u);return d.z=(d.z??0)+s,p.z=(p.z??0)+s,[eae(o,l,1/0,d,p)]}case"vertex":return[Snt(o,l,1/0),eae(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,n,s){const o=FR(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(P=>P.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=VJ(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=hJ(o);if(l==null)return null;const c=new Array,u=new Array,d=ps(),p=_e(),m=O(),y=this._context.renderCoordsHelper.viewingMode===$e.Global;y||this._context.renderCoordsHelper.worldUpAtPosition(null,m),ma(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const _=_e();us(_,p);const v=hi();Qf(v,_);const{polygons:b,mapPositions:x,position:T}=a;for(const P of b){const F=P.count;if(this._context.clippingExtent&&(vi(d),lu(d,P.mapPositions),!Hd(d,this._context.clippingExtent)))continue;const k=QS(P.mapPositions,P.holeIndices,3);if(k.length===0)continue;const V=k.length,z=6*F,X=u5(z+V),q=u5(V),G=Ys(3*z),Q=Ys(3*z),M=Ys(3*z),I=Ys(z);mat(T,x,k,P,G,M,Q,I,X,q,this._getExtrusionSize(r),m,y),gp(G,G,_);const L=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),B=new bat(G,M,Fot(Q),I);c.push(Uae(this._material,X,X.length-q.length,B,i,L),Uae(this._bottomMaterial,q,0,B,i,L)),u.push(B.heights)}if(c.length===0)return null;const S=new h0({geometries:c,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});S.transformation=p;const A=UEe(this.symbolLayer,{opacity:this._getLayerOpacity()}),C=A!=null?{baseMaterial:this._material,edgeMaterials:[A],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,R=new um(this,S,c,null,null,(P,F,k,V,z)=>_at(P,F,k,V,z,u),n,C);return R.alignedSampledElevation=a.sampledElevation,R.needsElevationUpdates=K_(n.mode),R}};function Uae(t,e,r,i,n,s){const o=OE(e.length),a=[[E.POSITION,new Ue(i.positions,3,!0)],[E.NORMALCOMPRESSED,new Ue(i.normals,2,!0)],[E.COLOR,new Ue(n,4,!0)]],l=[[E.POSITION,e],[E.NORMALCOMPRESSED,e],[E.COLOR,o]];return new Xn(t,a,l,i.elevation,on.Mesh,s,r)}function mat(t,e,r,i,n,s,o,a,l,c,u,d,p){const m=r.length/3;let y=0,_=2*i.count;gat(t,e,i.index,i.count,r,0,m,n,s,o,a,l,c,_,u,d,p);let v=2*i.count;_=0,kae(n,s,a,o,y,i.pathLengths[0],i.count,v,l,_,u),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],y+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)kae(n,s,a,o,y,i.pathLengths[b],i.count,v,l,_,u),v+=4*i.pathLengths[b],_+=2*i.pathLengths[b],y+=i.pathLengths[b]}function gat(t,e,r,i,n,s,o,a,l,c,u,d,p,m,y,_,v){re(cl,_);const b=y>0?1:-1;let x=3*r,T=0,S=3*T,A=i,C=3*A;for(let F=0;F<i;++F)v&&(cl[0]=t[x],cl[1]=t[x+1],cl[2]=t[x+2],me(cl,cl)),a[S]=t[x],a[S+1]=t[x+1],a[S+2]=t[x+2],l[S]=e[x],l[S+1]=e[x+1],l[S+2]=e[x+2],c[S]=-b*cl[0],c[S+1]=-b*cl[1],c[S+2]=-b*cl[2],u[T]=0,a[C]=t[x]+y*cl[0],a[C+1]=t[x+1]+y*cl[1],a[C+2]=t[x+2]+y*cl[2],l[C]=e[x],l[C+1]=e[x+1],l[C+2]=e[x+2],c[C]=b*cl[0],c[C+1]=b*cl[1],c[C+2]=b*cl[2],u[A]=y,S+=3,C+=3,x+=3,T+=1,A+=1;x=3*s,S=0,C=3*m;const R=y<0?Hae:jae,P=y<0?jae:Hae;for(let F=0;F<o;++F)p[S]=n[x+R[0]],p[S+1]=n[x+R[1]],p[S+2]=n[x+R[2]],d[C]=n[x+P[0]]+i,d[C+1]=n[x+P[1]]+i,d[C+2]=n[x+P[2]]+i,S+=3,C+=3,x+=3}function vI(t,e,r,i,n,s,o){i[s]=i[o],o*=3,t[s*=3]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const RC=O();function kae(t,e,r,i,n,s,o,a,l,c,u){let d=n,p=n+1,m=n+o,y=n+o+1,_=a,v=a+1,b=a+2*s,x=a+2*s+1;u<0&&(d=n+o+1,y=n),c*=3;for(let T=0;T<s;++T)T===s-1&&(u>0?(p=n,y=n+o):(p=n,d=n+o)),yat(t,d,p,m,RC),vI(t,e,i,r,RC,_,d),vI(t,e,i,r,RC,v,p),vI(t,e,i,r,RC,b,m),vI(t,e,i,r,RC,x,y),l[c++]=_,l[c++]=b,l[c++]=x,l[c++]=_,l[c++]=x,l[c++]=v,d++,p++,m++,y++,_+=2,v+=2,b+=2,x+=2}const rz=O(),zae=O(),Bae=O(),Vae=O(),Gae=O();function yat(t,e,r,i,n){e*=3,r*=3,i*=3,ne(rz,t[e++],t[e++],t[e++]),ne(zae,t[r++],t[r++],t[r++]),ne(Bae,t[i++],t[i++],t[i++]),ae(Vae,zae,rz),ae(Gae,Bae,rz),ot(n,Gae,Vae),me(n,n)}const Ex=O();function _at(t,e,r,i,n,s){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const d=o.transformation,p=wE(_e(),d);for(let m=0;m<l;m+=2){const y=a[m];if(!pJ(y))continue;const _=y.getMutableAttribute(E.POSITION).data,v=s[m/2],b=new BQ(y.mapPositions),x=_.length/3;let T=0,S=!1,A=0;for(let C=0;C<x;C++){Ex[0]=_[T],Ex[1]=_[T+1],Ex[2]=_[T+2],i(b,bI),c&&(A+=bI.sampledElevation),Kr.TESTS_DISABLE_OPTIMIZATIONS?(ne(zl,b.array[b.offset],b.array[b.offset+1],bI.z+v[T/3]),r!=null&&n.toRenderCoords(zl,r,zl),De(zl,zl,p)):(ne(zl,_[T],_[T+1],_[T+2]),De(zl,zl,d),n.setAltitude(zl,bI.z+v[T/3]),De(zl,zl,p)),_[T]=zl[0],_[T+1]=zl[1],_[T+2]=zl[2];const R=vat/n.unitInMeters;(Math.abs(Ex[0]-_[T])>=R||Math.abs(Ex[1]-_[T+1])>=R||Math.abs(Ex[2]-_[T+2])>=R)&&(S=!0),b.offset+=3,T+=3}S&&(y.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m]),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m+1])),u+=A/x}return u/l}const zl=O(),cl=O(),bI=new qP,jae=[0,2,1],Hae=[0,1,2],vat=.01;let bat=class{constructor(e,r,i,n){this.positions=e,this.elevation=r,this.normals=i,this.heights=n}};function B8(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function wat(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function xat(t,e,r,i,n,s,o,a,l,c,u,d,p,m,y,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=n,v[5]=s,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=d,v[12]=p,v[13]=m,v[14]=y,v[15]=_,v}function Tat(t,e){return new Float32Array(t,e,16)}const Sat=B8();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Sat,clone:wat,create:B8,createView:Tat,fromValues:xat},Symbol.toStringTag,{value:"Module"}));const Eat=(t,e)=>{const r=am(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Sc(r,r)},Cat=(t,e)=>{const r=am(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Sc(r,r)},Aat=(t,e)=>{const r=1-e,i=am(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Sc(i,i)},Oat=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),n=am(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Sc(n,n)},Rat=(t,e)=>{const r=1-2*e,i=am(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return Sc(i,i)},Pat=(t,e)=>{const r=am(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Sc(r,r)},Mat=(t,e)=>{const r=1-e,i=am(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Sc(i,i)};let R3e=class P3e{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=ac(e.strength,r.strength,i),this.radius=ac(e.radius,r.radius,i),this.threshold=ac(e.threshold,r.threshold,i)}clone(){return new P3e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:gO(this.radius),strength:this.strength,threshold:this.threshold}}},M3e=class $3e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(ac(e.radius,r.radius,i))}clone(){return new $3e(this.radius)}toJSON(){return{type:"blur",radius:gO(this.radius)}}},tW=class I3e{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=ac(e.amount,r.amount,i),this._updateMatrix()}clone(){return new I3e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||B8();switch(this.type){case"brightness":this._colorMatrix=Eat(e,this.amount);break;case"contrast":this._colorMatrix=Cat(e,this.amount);break;case"grayscale":this._colorMatrix=Aat(e,this.amount);break;case"invert":this._colorMatrix=Rat(e,this.amount);break;case"saturate":this._colorMatrix=Pat(e,this.amount);break;case"sepia":this._colorMatrix=Mat(e,this.amount)}}},L3e=class D3e{constructor(e,r,i,n){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=n,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=ac(e.offsetX,r.offsetX,i),this.offsetY=ac(e.offsetY,r.offsetY,i),this.blurRadius=ac(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(ac(e.color[0],r.color[0],i)),this.color[1]=Math.round(ac(e.color[1],r.color[1],i)),this.color[2]=Math.round(ac(e.color[2],r.color[2],i)),this.color[3]=ac(e.color[3],r.color[3],i)}clone(){return new D3e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:gO(this.offsetX),yoffset:gO(this.offsetY),blurRadius:gO(this.blurRadius),color:e}}},N3e=class F3e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=ac(e.angle,r.angle,i),this._updateMatrix()}clone(){return new F3e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||B8();this._colorMatrix=Oat(e,this.angle)}},U3e=class k3e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=ac(e.amount,r.amount,i)}clone(){return new k3e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function ac(t,e,r){return t+(e-t)*r}function gO(t){return Math.round(1e3*up(t))/1e3}function $at(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new tW(t.type,0);case"saturate":case"brightness":case"contrast":return new tW(t.type,1);case"opacity":return new U3e(1);case"hue-rotate":return new N3e(0);case"blur":return new M3e(0);case"drop-shadow":return new L3e(0,0,0,[...iY("transparent")]);case"bloom":return new R3e(0,0,1)}}function Iat(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,n)=>i.type===r[n].type)}function Lat(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let n=i.length;n<r.length;n++)i.push($at(r[n]))}function Dat(t){const e=t[0];return!!e&&"type"in e}var Wae,qae,rW={exports:{}};rW.exports,qae=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function r(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function i(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:pm},u=pm,d="none",p=")",m=",",y="(",_="%",v="px",b="cm",x="mm",T="in",S="pt",A="pc",C="deg",R="rad",P="grad",F="turn",k="#",V=".",z="e",X=/^[ \t\n\r]/,q=/^[a-z\-]/,G=/^[0-9a-fA-F]/,Q=/^[+\-]/,M=/^[0-9]/,I=rl("none"),L=Ps("none",!1),B=Ps(")",!1),H=Ps(",",!1),Z=rl("whitespace"),K=g1([" ","	",`
`,"\r"],!1,!1),de=rl("function"),Re=Ps("(",!1),Ke=rl("identifier"),_t=g1([["a","z"],"-"],!1,!1),at=rl("percentage"),yt=Ps("%",!1),Fe=rl("length"),pe=Ps("px",!1),xt=Ps("cm",!1),vt=Ps("mm",!1),Ee=Ps("in",!1),Be=Ps("pt",!1),Ve=Ps("pc",!1),pt=rl("angle"),ut=Ps("deg",!1),ar=Ps("rad",!1),Ge=Ps("grad",!1),ft=Ps("turn",!1),cr=rl("number"),nt=rl("color"),ht=Ps("#",!1),mt=g1([["0","9"],["a","f"],["A","F"]],!1,!1),Mt=g1(["+","-"],!1,!1),Ut=g1([["0","9"]],!1,!1),bi=Ps(".",!1),Fr=Ps("e",!1),di=function(){return[]},Dt=function(j,he){return{type:"function",name:j,parameters:he||[]}},ei=function(j,he){return he.length>0?zE(j,he,3):[j]},Rr=function(j){return{type:"quantity",value:j.value,unit:j.unit}},qr=function(j){return{type:"color",colorType:j.type,value:j.value}},Sr=function(j){return j},wi=function(){return Nl()},$r=function(j){return{value:j,unit:"%"}},ti=function(j){return{value:j,unit:"px"}},Xr=function(j){return{value:j,unit:"cm"}},ur=function(j){return{value:j,unit:"mm"}},ri=function(j){return{value:j,unit:"in"}},Ii=function(j){return{value:j,unit:"pt"}},Ks=function(j){return{value:j,unit:"pc"}},eo=function(j){return{value:j,unit:"deg"}},to=function(j){return{value:j,unit:"rad"}},ro=function(j){return{value:j,unit:"grad"}},ji=function(j){return{value:j,unit:"turn"}},Li=function(j){return{value:j,unit:null}},Ur=function(){return{type:"hex",value:Nl()}},Os=function(j){return{type:"function",value:j}},Co=function(){return{type:"named",value:Nl()}},ba=function(){return parseFloat(Nl())},ie=0,xi=0,qh=[{line:1,column:1}],Rs=0,Xh=[],Ze=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');u=c[s.startRule]}function Nl(){return n.substring(xi,ie)}function Ps(j,he){return{type:"literal",text:j,ignoreCase:he}}function g1(j,he,we){return{type:"class",parts:j,inverted:he,ignoreCase:we}}function y1(){return{type:"end"}}function rl(j){return{type:"other",description:j}}function dm(j){var he,we=qh[j];if(we)return we;for(he=j-1;!qh[he];)he--;for(we={line:(we=qh[he]).line,column:we.column};he<j;)n.charCodeAt(he)===10?(we.line++,we.column=1):we.column++,he++;return qh[j]=we,we}function _1(j,he,we){var nr=dm(j),Vn=dm(he),pi={source:l,start:{offset:j,line:nr.line,column:nr.column},end:{offset:he,line:Vn.line,column:Vn.column}};return we&&l&&typeof l.offset=="function"&&(pi.start=l.offset(pi.start),pi.end=l.offset(pi.end)),pi}function qt(j){ie<Rs||(ie>Rs&&(Rs=ie,Xh=[]),Xh.push(j))}function d0(j,he,we){return new e(e.buildMessage(j,he),j,he,we)}function pm(){var j;return(j=p0())===a&&(j=wa()),j}function p0(){var j,he;return Ze++,j=ie,Qi(),n.substr(ie,4)===d?(he=d,ie+=4):(he=a,Ze===0&&qt(L)),he!==a?(Qi(),xi=j,j=di()):(ie=j,j=a),Ze--,j===a&&Ze===0&&qt(I),j}function wa(){var j,he;if(j=[],(he=Fl())!==a)for(;he!==a;)j.push(he),he=Fl();else j=a;return j}function Fl(){var j,he,we,nr;return j=ie,Qi(),(he=f0())!==a?(Qi(),(we=Tp())===a&&(we=null),Qi(),n.charCodeAt(ie)===41?(nr=p,ie++):(nr=a,Ze===0&&qt(B)),nr!==a?(Qi(),xi=j,j=Dt(he,we)):(ie=j,j=a)):(ie=j,j=a),j}function Tp(){var j,he,we,nr,Vn,pi,xa,x1;if(j=ie,(he=Ms())!==a){for(we=[],nr=ie,Vn=Qi(),n.charCodeAt(ie)===44?(pi=m,ie++):(pi=a,Ze===0&&qt(H)),pi===a&&(pi=null),xa=Qi(),(x1=Ms())!==a?nr=Vn=[Vn,pi,xa,x1]:(ie=nr,nr=a);nr!==a;)we.push(nr),nr=ie,Vn=Qi(),n.charCodeAt(ie)===44?(pi=m,ie++):(pi=a,Ze===0&&qt(H)),pi===a&&(pi=null),xa=Qi(),(x1=Ms())!==a?nr=Vn=[Vn,pi,xa,x1]:(ie=nr,nr=a);xi=j,j=ei(he,we)}else ie=j,j=a;return j}function Ms(){var j,he;return j=ie,(he=b1())===a&&(he=Xw())===a&&(he=w1())===a&&(he=m0()),he!==a&&(xi=j,he=Rr(he)),(j=he)===a&&(j=ie,(he=hM())!==a&&(xi=j,he=qr(he)),j=he),j}function Qi(){var j,he;for(Ze++,j=[],X.test(n.charAt(ie))?(he=n.charAt(ie),ie++):(he=a,Ze===0&&qt(K));he!==a;)j.push(he),X.test(n.charAt(ie))?(he=n.charAt(ie),ie++):(he=a,Ze===0&&qt(K));return Ze--,he=a,Ze===0&&qt(Z),j}function f0(){var j,he,we;return Ze++,j=ie,(he=v1())!==a?(n.charCodeAt(ie)===40?(we=y,ie++):(we=a,Ze===0&&qt(Re)),we!==a?(xi=j,j=Sr(he)):(ie=j,j=a)):(ie=j,j=a),Ze--,j===a&&(he=a,Ze===0&&qt(de)),j}function v1(){var j,he,we;if(Ze++,j=ie,he=[],q.test(n.charAt(ie))?(we=n.charAt(ie),ie++):(we=a,Ze===0&&qt(_t)),we!==a)for(;we!==a;)he.push(we),q.test(n.charAt(ie))?(we=n.charAt(ie),ie++):(we=a,Ze===0&&qt(_t));else he=a;return he!==a&&(xi=j,he=wi()),Ze--,(j=he)===a&&(he=a,Ze===0&&qt(Ke)),j}function b1(){var j,he,we;return Ze++,j=ie,Qi(),(he=il())!==a?(n.charCodeAt(ie)===37?(we=_,ie++):(we=a,Ze===0&&qt(yt)),we!==a?(xi=j,j=$r(he)):(ie=j,j=a)):(ie=j,j=a),Ze--,j===a&&Ze===0&&qt(at),j}function Xw(){var j,he,we;return Ze++,j=ie,Qi(),(he=il())!==a?(n.substr(ie,2)===v?(we=v,ie+=2):(we=a,Ze===0&&qt(pe)),we!==a?(xi=j,j=ti(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Qi(),(he=il())!==a?(n.substr(ie,2)===b?(we=b,ie+=2):(we=a,Ze===0&&qt(xt)),we!==a?(xi=j,j=Xr(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Qi(),(he=il())!==a?(n.substr(ie,2)===x?(we=x,ie+=2):(we=a,Ze===0&&qt(vt)),we!==a?(xi=j,j=ur(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Qi(),(he=il())!==a?(n.substr(ie,2)===T?(we=T,ie+=2):(we=a,Ze===0&&qt(Ee)),we!==a?(xi=j,j=ri(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Qi(),(he=il())!==a?(n.substr(ie,2)===S?(we=S,ie+=2):(we=a,Ze===0&&qt(Be)),we!==a?(xi=j,j=Ii(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,Qi(),(he=il())!==a?(n.substr(ie,2)===A?(we=A,ie+=2):(we=a,Ze===0&&qt(Ve)),we!==a?(xi=j,j=Ks(he)):(ie=j,j=a)):(ie=j,j=a)))))),Ze--,j===a&&Ze===0&&qt(Fe),j}function w1(){var j,he,we;return Ze++,j=ie,(he=il())!==a?(n.substr(ie,3)===C?(we=C,ie+=3):(we=a,Ze===0&&qt(ut)),we!==a?(xi=j,j=eo(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,(he=il())!==a?(n.substr(ie,3)===R?(we=R,ie+=3):(we=a,Ze===0&&qt(ar)),we!==a?(xi=j,j=to(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,(he=il())!==a?(n.substr(ie,4)===P?(we=P,ie+=4):(we=a,Ze===0&&qt(Ge)),we!==a?(xi=j,j=ro(he)):(ie=j,j=a)):(ie=j,j=a),j===a&&(j=ie,(he=il())!==a?(n.substr(ie,4)===F?(we=F,ie+=4):(we=a,Ze===0&&qt(ft)),we!==a?(xi=j,j=ji(he)):(ie=j,j=a)):(ie=j,j=a)))),Ze--,j===a&&(he=a,Ze===0&&qt(pt)),j}function m0(){var j,he;return Ze++,j=ie,Qi(),(he=il())!==a?(xi=j,j=Li(he)):(ie=j,j=a),Ze--,j===a&&Ze===0&&qt(cr),j}function hM(){var j,he,we,nr;if(Ze++,j=ie,n.charCodeAt(ie)===35?(he=k,ie++):(he=a,Ze===0&&qt(ht)),he!==a){if(we=[],G.test(n.charAt(ie))?(nr=n.charAt(ie),ie++):(nr=a,Ze===0&&qt(mt)),nr!==a)for(;nr!==a;)we.push(nr),G.test(n.charAt(ie))?(nr=n.charAt(ie),ie++):(nr=a,Ze===0&&qt(mt));else we=a;we!==a?(xi=j,j=Ur()):(ie=j,j=a)}else ie=j,j=a;return j===a&&(j=ie,(he=Fl())!==a&&(xi=j,he=Os(he)),(j=he)===a&&(j=ie,(he=v1())!==a&&(xi=j,he=Co()),j=he)),Ze--,j===a&&(he=a,Ze===0&&qt(nt)),j}function il(){var j,he,we,nr,Vn,pi,xa;for(j=ie,Q.test(n.charAt(ie))?(n.charAt(ie),ie++):Ze===0&&qt(Mt),he=ie,we=[],M.test(n.charAt(ie))?(nr=n.charAt(ie),ie++):(nr=a,Ze===0&&qt(Ut));nr!==a;)we.push(nr),M.test(n.charAt(ie))?(nr=n.charAt(ie),ie++):(nr=a,Ze===0&&qt(Ut));if(n.charCodeAt(ie)===46?(nr=V,ie++):(nr=a,Ze===0&&qt(bi)),nr!==a){if(Vn=[],M.test(n.charAt(ie))?(pi=n.charAt(ie),ie++):(pi=a,Ze===0&&qt(Ut)),pi!==a)for(;pi!==a;)Vn.push(pi),M.test(n.charAt(ie))?(pi=n.charAt(ie),ie++):(pi=a,Ze===0&&qt(Ut));else Vn=a;Vn!==a?he=we=[we,nr,Vn]:(ie=he,he=a)}else ie=he,he=a;if(he===a)if(he=[],M.test(n.charAt(ie))?(we=n.charAt(ie),ie++):(we=a,Ze===0&&qt(Ut)),we!==a)for(;we!==a;)he.push(we),M.test(n.charAt(ie))?(we=n.charAt(ie),ie++):(we=a,Ze===0&&qt(Ut));else he=a;if(he!==a){if(we=ie,n.charCodeAt(ie)===101?(nr=z,ie++):(nr=a,Ze===0&&qt(Fr)),nr!==a){if(Q.test(n.charAt(ie))?(Vn=n.charAt(ie),ie++):(Vn=a,Ze===0&&qt(Mt)),Vn===a&&(Vn=null),pi=[],M.test(n.charAt(ie))?(xa=n.charAt(ie),ie++):(xa=a,Ze===0&&qt(Ut)),xa!==a)for(;xa!==a;)pi.push(xa),M.test(n.charAt(ie))?(xa=n.charAt(ie),ie++):(xa=a,Ze===0&&qt(Ut));else pi=a;pi!==a?we=nr=[nr,Vn,pi]:(ie=we,we=a)}else ie=we,we=a;we===a&&(we=null),xi=j,j=ba()}else ie=j,j=a;return j}function kE(j,he){return j.map(function(we){return we[he]})}function zE(j,he,we){return[j].concat(kE(he,we))}if((o=u())!==a&&ie===n.length)return o;throw o!==a&&ie<n.length&&qt(y1()),d0(Xh,Rs<n.length?n.charAt(Rs):null,Rs<n.length?_1(Rs,Rs+1):_1(Rs,Rs))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var d=this.location.end,p=r("",c.line.toString().length," "),m=a[l.line-1],y=(l.line===d.line?d.column:m.length+1)-l.column||1;s+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+m+`
`+p+" | "+r("",l.column-1," ")+r("",y,"^")}else s+=`
 at `+u}return s},e.buildMessage=function(n,s){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+y.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function u(m){return o[m.type](m)}function d(m){var y,_,v=m.map(u);if(v.sort(),v.length>0){for(y=1,_=1;y<v.length;y++)v[y-1]!==v[y]&&(v[_]=v[y],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+d(n)+" but "+p(s)+" found."},{SyntaxError:e,parse:i}},(Wae=rW).exports&&(Wae.exports=qae());var Nat=rW.exports;function z3e(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=Xae(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new Y("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Xae(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!Iat(e[r].effects,e[r+1].effects))throw new Y("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});Lat(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function Xae(t){let e;if(!t)return[];try{e=Nat.parse(t)}catch(r){throw new Y("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>Fat(r))}function Fat(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Uat(t);case"opacity":return kat(t);case"hue-rotate":return zat(t);case"blur":return Bat(t);case"drop-shadow":return Vat(t);case"bloom":return Gat(t)}}catch(e){throw e.details.filter=t,e}throw new Y("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function Uat(t){let e=1;return FE(t.parameters,1),t.parameters.length===1&&(e=Dd(t.parameters[0])),new tW(t.name,e)}function kat(t){let e=1;return FE(t.parameters,1),t.parameters.length===1&&(e=Dd(t.parameters[0])),new U3e(e)}function zat(t){let e=0;return FE(t.parameters,1),t.parameters.length===1&&(e=Yat(t.parameters[0])),new N3e(e)}function Bat(t){let e=0;return FE(t.parameters,1),t.parameters.length===1&&(e=XJ(t.parameters[0]),eM(e,t.parameters[0])),new M3e(e)}function Vat(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new Y("effect:type-error","Accepts only one color",{});r=Zat(i)}else{const n=XJ(i);if(Object.isFrozen(e))throw new Y("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&eM(n,i)}if(e.length<2||e.length>3)throw new Y("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new L3e(e[0],e[1],e[2]||0,r||B3e("black"))}function Gat(t){let e=1,r=0,i=0;return FE(t.parameters,3),t.parameters[0]&&(e=Dd(t.parameters[0])),t.parameters[1]&&(r=XJ(t.parameters[1]),eM(r,t.parameters[1])),t.parameters[2]&&(i=Dd(t.parameters[2])),new R3e(e,r,i)}function FE(t,e){if(t.length>e)throw new Y("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function V8(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in qJ)return"<length>";if(t.unit in WJ)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function eM(t,e){if(t<0)throw new Y("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function jat(t){if(t.type!=="quantity"||t.unit!==null)throw new Y("effect:type-error",`Expected <double>, Actual: ${V8(t)}`,{term:t})}function Hat(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new Y("effect:type-error",`Expected <double> or <percentage>, Actual: ${V8(t)}`,{term:t})}const WJ={deg:1,grad:.9,rad:180/Math.PI,turn:360};function Wat(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&WJ[t.unit]!=null))throw new Y("effect:type-error",`Expected <angle>, Actual: ${V8(t)}`,{term:t})}const qJ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function qat(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&qJ[t.unit]!=null))throw new Y("effect:type-error",`Expected <length>, Actual: ${V8(t)}`,{term:t})}function Dd(t){Hat(t);const e=t.value;return eM(e,t),t.unit==="%"?.01*e:e}function Xat(t){return jat(t),eM(t.value,t),t.value}function Yat(t){return Wat(t),t.value*WJ[t.unit]||0}function XJ(t){return qat(t),t.value*qJ[t.unit]||0}function Zat(t){switch(t.colorType){case"hex":return qFe(t.value);case"named":return B3e(t.value);case"function":return Kat(t.value)}}function B3e(t){if(!J0e(t))throw new Y("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return WFe(t)}const Qat=/^rgba?/i,Jat=/^hsla?/i;function Kat(t){if(FE(t.parameters,4),Qat.test(t.name))return[Dd(t.parameters[0]),Dd(t.parameters[1]),Dd(t.parameters[2]),t.parameters[3]?Dd(t.parameters[3]):1];if(Jat.test(t.name))return K0e(Xat(t.parameters[0]),Dd(t.parameters[1]),Dd(t.parameters[2]),t.parameters[3]?Dd(t.parameters[3]):1);throw new Y("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function elt(t,e,r){var i;try{return ilt(t)}catch(n){(i=r==null?void 0:r.messages)==null||i.push(n)}return null}function tlt(t,e,r,i){try{const n=rlt(t);Pw(r,n,e)}catch(n){i.messages&&i.messages.push(n)}}function rlt(t){const e=z3e(t);return e?Dat(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(n=>n.toJSON())})):null}function ilt(t){if(!t||t.length===0)return null;if(nlt(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:Yae(r.value)});return e}return Yae(t)}function nlt(t){const e=t[0];return!!e&&"scale"in e}function Yae(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[wm(r,"amount")];break;case"blur":i=[wm(r,"radius","pt")];break;case"hue-rotate":i=[wm(r,"angle","deg")];break;case"drop-shadow":i=[wm(r,"xoffset","pt"),wm(r,"yoffset","pt"),wm(r,"blurRadius","pt"),slt(r,"color")];break;case"bloom":i=[wm(r,"strength"),wm(r,"radius","pt"),wm(r,"threshold")]}const n=`${r.type}(${i.filter(Boolean).join(" ")})`;z3e(n),e.push(n)}return e.join(" ")}function wm(t,e,r){if(t[e]==null)throw new Y("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function slt(t,e){if(t[e]==null)throw new Y("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}function olt(t){return typeof t=="function"}function bNt(t,e,r,i){return olt(t)?t(e,r,i):t}function wNt(t){return[t.r,t.g,t.b,t.a]}const alt=` /-,
`;function Zae(t){let e=t.length;for(;e--;)if(!alt.includes(t.charAt(e)))return!1;return!0}function llt(t,e){const r=[];let i=0,n=-1;do if(n=t.indexOf("[",i),n>=i){if(n>i){const s=t.substr(i,n-i);r.push([s,null,Zae(s)])}if(i=n+1,n=t.indexOf("]",i),n>=i){if(n>i){const s=e[t.substr(i,n-i)];s&&r.push([null,s,!1])}i=n+1}}while(n!==-1);if(i<t.length-1){const s=t.substr(i);r.push([s,null,Zae(s)])}return r}function clt(t,e,r){let i="",n=null;for(const s of e){const[o,a,l]=s;if(o)l?n=o:(n&&(i+=n,n=null),i+=o);else{const c=t.attributes[a];c&&(n&&(i+=n,n=null),i+=c)}}return ult(i,r)}function xNt(t,e,r){const i=llt(e,t);return n=>clt(n,i,r)}function ult(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function TNt(t,e,r,i,n,s,o=!0){const a=e/n,l=r/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let d=0;d<s;d++)for(let p=0;p<n;p++){const m=4*(p+(o?s-d-1:d)*n);let y=0,_=0,v=0,b=0,x=0,T=0,S=0;const A=(d+.5)*l;for(let C=Math.floor(d*l);C<(d+1)*l;C++){const R=Math.abs(A-(C+.5))/u,P=(p+.5)*a,F=R*R;for(let k=Math.floor(p*a);k<(p+1)*a;k++){let V=Math.abs(P-(k+.5))/c;const z=Math.sqrt(F+V*V);z>=-1&&z<=1&&(y=2*z*z*z-3*z*z+1,y>0&&(V=4*(k+C*e),S+=y*t[V+3],v+=y,t[V+3]<255&&(y=y*t[V+3]/250),b+=y*t[V],x+=y*t[V+1],T+=y*t[V+2],_+=y))}}i[m]=b/_,i[m+1]=x/_,i[m+2]=T/_,i[m+3]=S/v}}function V3e(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function hlt(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function dlt(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function plt(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function G3e(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const SNt=(t,e=0)=>t==null||isNaN(t)?e:t,ENt=t=>t.tintColor?V3e(t.tintColor):{r:255,g:255,b:255,a:1},CNt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function ANt(){return ce(()=>import("./geometryEngineJSON-c939b27e.js"),["assets/geometryEngineJSON-c939b27e.js","assets/geometryEngineBase-324c1c81.js","assets/geometryEngineJSON-b173802a.js","assets/json-48e3ea08.js"])}function ONt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function RNt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function PNt(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function MNt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function Qae(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Qae(e);if(r!=null)return r}break;case"CIMTextSymbol":return Qae(t.symbol);case"CIMSolidFill":return t.color}}function Jae(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=Jae(r);if(i!=null)return i}break}case"CIMTextSymbol":return Jae(t.symbol);case"CIMSolidStroke":return t.color}}function Kae(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=Kae(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return Kae(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function $Nt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function INt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function LNt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const DNt=t=>t.includes("data:image/svg+xml");function NNt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function j3e(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const n of t.effects)glt(n,e);if(t.symbolLayers)for(const n of t.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":flt(n,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&n.width&&(n.width*=e);break;case"CIMPictureFill":n.height&&(n.height*=e),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e);break;case"CIMHatchFill":j3e(n.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e),n.separation&&(n.separation*=e)}}else t.height!=null&&(t.height*=e)}function flt(t,e,r){if(t&&(t.markerPlacement&&mlt(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||j3e(i.symbol,e,!0,r)}function mlt(t,e){switch(G3e(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function glt(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function ylt(t){const e=[];return iW(hlt(t),e),e.length?new it(V3e(e[0])):null}function iW(t,e){var n;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(plt(s)||dlt(s)&&s.markerPlacement&&G3e(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&ele(e,s.tintColor);break;case"CIMVectorMarker":(n=s.markerGraphics)==null||n.forEach(o=>{iW(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":ele(e,s.color);break;case"CIMHatchFill":iW(s.lineSymbol,e)}}}function ele(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}let _lt=class{constructor(e,r){this._storage=new t3e,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new _lt(1e3);new it([128,128,128]);const vlt=new it("white");function blt(t){return sc(t.resource).href}function UNt(t,e){if(!t)return null;let r=null;return ow(t)?r=wlt(t):O6(t)&&(r=t.type==="cim"?ylt(t):t.color?new it(t.color):null),r?zR(r,e):null}function wlt(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var n;i.type==="object"&&((n=i.resource)!=null&&n.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new it(r):null}function zR(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new it(r)}function xlt(t,e,r){const i=t.symbolLayers;if(!i)return;const n=s=>zR(e=e??s??(r!=null?vlt:null),r);i.forEach(s=>{var o;if(s.type!=="object"||!((o=s.resource)!=null&&o.href)||e)if(s.type==="water")s.color=n(s.color);else{const a=s.material!=null?s.material.color:null,l=n(a);s.material==null?s.material=new du({color:l}):s.material.color=l,r!=null&&"outline"in s&&s.outline!=null&&s.outline.color!=null&&(s.outline.color=zR(s.outline.color,r))}})}function Tlt(t,e,r){(e=e??t.color)&&(t.color=zR(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=zR(t.outline.color,r))}function kNt(t,e,r){t&&(e||r!=null)&&(e&&(e=new it(e)),ow(t)?xlt(t,e,r):O6(t)&&Tlt(t,e,r))}async function Slt(t,e){const r=t.symbolLayers;r&&await r6(r,async i=>Elt(i,e))}async function Elt(t,e){switch(t.type){case"extrude":Alt(t,e);break;case"icon":case"line":case"text":Clt(t,e);break;case"path":Rlt(t,e);break;case"object":await Olt(t,e)}}function Clt(t,e){const r=H3e(e);r!=null&&(t.size=r)}function H3e(t){for(const e of t)if(typeof e=="number")return e;return null}function Alt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function Olt(t,e){const{resourceSize:r,symbolSize:i}=await Plt(t),n=W3e(e,r,i);t.width=yO(e[0],i[0],r[0],n),t.depth=yO(e[1],i[1],r[1],n),t.height=yO(e[2],i[2],r[2],n)}function Rlt(t,e){const r=W3e(e,pg,[t.width,void 0,t.height]);t.width=yO(e[0],t.width,1,r),t.height=yO(e[2],t.height,1,r)}function W3e(t,e,r){for(let i=0;i<3;i++){const n=t[i];switch(n){case"symbol-value":{const s=r[i];return s!=null?s/e[i]:1}case"proportional":break;default:if(n&&e[i])return n/e[i]}}return 1}async function Plt(t){const{computeObjectLayerResourceSize:e}=await ce(()=>import("./symbolLayerUtils-16974b32.js"),[]),r=await e(t,10),{width:i,height:n,depth:s}=t,o=[i,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function yO(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function Mlt(t,e){const r=H3e(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function zNt(t,e){if(t&&e)return ow(t)?Slt(t,e):void(O6(t)&&Mlt(t,e))}function BNt(t,e,r){if(t&&e!=null)if(ow(t)){const i=t.symbolLayers;i&&i.forEach(n=>{if(n&&n.type==="object")switch(r){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else O6(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function VNt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function GNt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function $lt(t,e,r,i,n){if(t==null)return null;const s=t.referencesGeometry()&&n?Ilt(e,i,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return J.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const iz=new Map;function Ilt(t,e,r){const{transform:i,hasZ:n,hasM:s}=r;iz.has(e)||iz.set(e,Llt(e));const o=iz.get(e)(t.geometry,i,n,s);return{...t,geometry:o}}function Llt(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,n,s)=>cEe(i,e,r,n,s);case"esriGeometryPolygon":return(r,i,n,s)=>uEe(i,e,r,n,s);case"esriGeometryPolyline":return(r,i,n,s)=>hEe(i,e,r,n,s);case"esriGeometryMultipoint":return(r,i,n,s)=>lEe(i,e,r,n,s);default:return J.getLogger("esri.views.2d.support.arcadeOnDemand").error(new Y("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const jNt=1.2,Dlt=Nf;let G8=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Hi.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,bs.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Hi.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=O()){return ne(e,0,0,0)}getBoundingBoxObjectSpace(e=ps()){return vi(e)}addObjectState(e,r){e===Hg.Highlight&&(this.renderGeometries.forEach(i=>{const n=i.geometry.addHighlight();r.addRenderGeometry(i,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,bs.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,bs.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(Cx)&&(e.draped.origin[0]+=Cx[0],e.draped.origin[1]+=Cx[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,n,s){vi(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,tle,i),X9e(s,tle)}if(r){let o;jd(s,Cx);const a=dJ(s,r.service.spatialReference,r);try{o=await r.service.queryElevation(Cx[0],Cx[1],n,a,"ground")}catch{}o!=null&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,r,i,n){if(this.boundingBox)x6(Dp,this.boundingBox);else{const s=e.boundingSphere,o=s[3];Dp[0]=s[0]-o,Dp[1]=s[1]-o,Dp[2]=s[2]-o,Dp[3]=s[0]+o,Dp[4]=s[1]+o,Dp[5]=s[2]+o}return r(Dp,0,2),this.calculateRelativeScreenBounds&&n.push({location:jd(Dp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),ZY(Dp,i)}};const tle=jt(),Dp=ps(),Cx=O();let q3e=class{constructor(e,r,i,n=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=nW(rle,wI,wI).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,o=0,a=0,l=0;this._lines.forEach((y,_)=>{const v=e.measureText(y),b=v.width,x=b+r;this._textWidths.push(b),this._lineWidths.push(x),o=Math.max(o,x),a=Math.max(a,v.actualBoundingBoxAscent),l=Math.max(l,v.actualBoundingBoxDescent),_===0&&(n=v),_===this._lines.length-1&&(s=v)});const c=e.font;let u=nle.get(c);if(!u){const y=e.measureText(Flt);u=new klt(y.actualBoundingBoxAscent,y.actualBoundingBoxDescent),nle.set(c,u)}a=Math.max(a,u.actualBoundingBoxAscent),l=Math.max(l,u.actualBoundingBoxDescent);const d=a+l,p=this._hasBackground?n.actualBoundingBoxAscent:a,m=this._hasBackground?s.actualBoundingBoxDescent:l;this._metricsCached=new Ult(a-p,l-m,d,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*Nlt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case R_.Left:return this._backgroundHorizontalPadding;case R_.Center:return(this.displayWidth-this._lineWidths[e])/2;case R_.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const n=r/=this.renderPixelRatio,s=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],d=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,r+d,i),this._renderLineDecoration(e,r+d,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+d,i,this._textWidths[c]),i+=this._lineSpacing}if(Kr.TEXT_SHOW_BASELINE){e.strokeStyle=ile,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let u=0;u<this._lines.length;++u){const d=c+this._baselinePosition;this._drawLine(e,[n,d],[n+this.displayWidth,d]),c+=this._lineSpacing}}if(Kr.TEXT_SHOW_BORDER&&(e.strokeStyle=ile,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+n+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,n){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=ge(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+n),e.arcTo(r,i,r+n,i,n),e.lineTo(r+s-n,i),e.arcTo(r+s,i,r+s,i+n,n),e.lineTo(r+s,i+o-n),e.arcTo(r+s,i+o,r+s-n,i+o,n),e.lineTo(r+n,i+o),e.arcTo(r,i+o,r,i+o-n,n),e.closePath()):e.rect(r,i,s,o)}_renderHalo(e,r,i,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=nW(rle,Math.max(o,wI),Math.max(a,wI)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let d=s+this._baselinePosition;for(let p=0;p<this._lines.length;++p){const m=this._getLineXOffset(p);this._renderLineDecoration(c,n+m,d,this._textWidths[p],!0),d+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of X3e)this._fillText(e,s,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const n=2*this._haloSize;i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let u=0;u<l;u++){const d=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(d*n),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,n){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(e,r,i,n){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const n=this._toRenderUnit(r[0]),s=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,u=Math.floor(s)+.5,d=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,d),e.lineTo(l,d),e.lineTo(l,u),e.stroke()}};const X3e=[];for(let e=0;e<360;e+=360/16)X3e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var R_;function nW(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(R_||(R_={}));const rle={canvas:null},Nlt=.2,wI=512,ile="rgb(255, 0, 255, 0.5)",Flt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let Ult=class{constructor(e,r,i,n,s){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=n,this.baselinePosition=s}},klt=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const nle=new Map,zlt=Object.freeze({left:0,center:.5,right:1}),QD=Object.freeze({"bottom-left":or(0,0),bottom:or(.5,0),"bottom-right":or(1,0),left:or(0,.5),center:or(.5,.5),right:or(1,.5),"top-left":or(0,1),top:or(.5,1),"top-right":or(1,1)});function Y3e(t){switch(t){case"left":return R_.Left;case"right":return R_.Right;default:return R_.Center}}function sle(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Blt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Vlt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function Glt(t){return t==="middle"?"center":t}let KS=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=_e(),this._shaderTransformation=null,this._boundingSphere=null,this.id=wc(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=De(vn(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*MS(this.shaderTransformation),this._boundingSphere):fbe}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=In(_e(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const jlt=_e(),ole=Se(0,0,1),Hlt=16,Wlt=1.5,bb=nJ,qlt=[bb/2,bb/2,1-bb/2,1-bb/2],Xlt=[IR*bb,IR*bb];let sW=class Z3e extends hm{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,n){super(e,r,i,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const n=blt(this.symbolLayer),s=Xb(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(s.data),e):await this._prepareResourcesHref(r,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=R8(this._getIconSize());if(e)throw new Y("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?ha(e.size):Hlt);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const o={width:s.imageData.width,height:s.imageData.height};i=new Hw(s.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(Ylt(r)){const{screenLength:i,minWorldLength:n,maxWorldLength:s}=r.verticalOffset;e.verticalOffset={screenLength:ha(i),minWorldLength:n||0,maxWorldLength:s??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(nz(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const s=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>stt(r));this._texture=s.texture,this._releaseTexture=s,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=qlt;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/bb,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await Ng(this._context.sharedResources.textures.fromUrl(r,s,{signal:i}));if(o.ok===!1)throw Mw(o.error),new Y("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[n,Math.round(n/l)]:[Math.round(n*l),n],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const n=new xP({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await ce(()=>import("./CIMSymbolRasterizer-1692cd3f.js"),["assets/CIMSymbolRasterizer-1692cd3f.js","assets/cimAnalyzer-01879161.js","assets/TileClipper-ae6eca9e.js","assets/definitions-0bc08d4c.js","assets/number-e491b09e.js","assets/BidiEngine-9a40f2f4.js","assets/imageutils-51a204ba.js","assets/rasterizingUtils-4df93c6e.js"])).CIMSymbolRasterizer;Bt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const d=u.scaleExpression,p=await P8e(d,this._context.layer.spatialReference,s);a=(m,y,_)=>{const v=$lt(p,m,{$view:_},"esriGeometryPoint",y);return v!==null?v:1}}else o=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Bt(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||fze}_getOutlineSize(){let e=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(ha(r.outline.size),0):(e=nz(this._getPrimitive())?Wlt:0,Math.max(e,0))}_getOutlineColor(){var n;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(n=r==null?void 0:r.outline)==null?void 0:n.color;if(i!=null){const s=it.toUnitRGB(i),o=i.a*e;return[s[0],s[1],s[2],o]}return[0,0,0,0]}_getFillColor(){var i,n;if(nz(this._getPrimitive()))return Dlt;const e=this._getPrimitive()==null,r=(n=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:n.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?or((r.x||0)+.5,.5-(r.y||0)):e in QD?QD[e]:QD.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new YS(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=qS(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new YS(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Fi(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const n=e.size[i];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[i]=ha(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var d;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),m={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(m,this._context.stage),n=[p.parameters.width,p.parameters.height]}else n=this._size,i=this._material;const s=DR(r.geometry);if(s==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((d=this._fastUpdates)!=null&&d.visualVariables.size)){const p=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=or(n[0]*l,n[1]*l),u=this.setGraphicElevationContext(r,new wp);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,s,i,a,c,e.layer.uid):this._createAs3DShape(r,s,i,a,c,u,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=WP(Z3e.elevationModeChangeTypes,i,n);if(s!==an.UPDATE)return s;const o=Bh(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!XS(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return $n.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return $n.FastUpdate}_defaultElevationInfoNoZ(){return Zlt}_createAs3DShape(e,r,i,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?_=>FH(this._fastUpdates.materialParameters,l,_):void 0,u=this._context.layer.uid,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:u}),p=aH(i,ole,null,n,s,Qlt,null,l,d),m=_J(this._context,r,p,o,a,c);if(m==null)return null;const y=new um(this,m.object,[p],null,null,Lb,o);return y.alignedSampledElevation=m.sampledElevation,y.needsElevationUpdates=Bh(o.mode)||o.mode==="absolute-height",y.getScreenSize=this._createScreenSizeGetter(s,c),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),LR(y,r,this._context.elevationProvider),y}_createAsOverlay(e,r,i,n,s,o){i.renderPriority=this._renderPriority;const a=Qt();Bi(r,a,this._context.overlaySR),a[2]=BJ;const l=this._context.clippingExtent;if(l!=null&&!YY(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=c&&this._fastUpdates?_=>FH(this._fastUpdates.materialParameters,c,_):void 0,d=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),p=aH(i,ole,a,n,s,null,null,c,d),m=new KS(p,{layerUid:o,graphicUid:e.uid,shaderTransformer:u}),y=new G8(this,[m],null,this._context.drapeSourceRenderer);return y.getScreenSize=this._createScreenSizeGetter(s,u),y.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(y.getScreenSize(),1,_),y}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const n=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(o=Ne())=>{const a=r(jlt);return o[0]=a[0]*n+i,o[1]=a[5]*s+i,o}}{const n=e[0]/this._symbolTextureRatio+i,s=e[1]/this._symbolTextureRatio+i;return(o=Ne())=>(o[0]=n,o[1]=s,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Se(e,e,e),i=up(1),n=e*i,s=Se(n,n,n);return new jP({size:!0,color:!0,rotation:!0,opacity:!1},r,s,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function Ylt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function nz(t){return t!=null&&(t==="cross"||t==="x")}sW.PRIMITIVE_SIZE=Xlt,sW.elevationModeChangeTypes={definedChanged:an.UPDATE,staysOnTheGround:an.NONE,onTheGroundChanged:an.RECREATE};const Zlt={mode:"relative-to-ground",offset:0},Qlt=$t(0,0,0,1);function oW(t){switch(t){case"butt":return Ah.BUTT;case"square":return Ah.SQUARE;case"round":return Ah.ROUND;default:return null}}function ale(t){return t==="diamond"?"kite":t}function aW(t,e,r=null){const i=[],n=[],s=e.mapPositions;Jlt(e,n,i);const o=n[0][1].data,a=i[0][1].length,l=OE(a);return Klt(e,n,i,l),rct(e,n,i,l),ect(e,n,i,l),tct(e,n,i,l),ict(e,n,i,l),nct(e,n,i,l),sct(e,n,i,o),new Xn(t,n,i,s,on.Line,r)}function Jlt(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:n}=t,s=oct(i)&&n,o=i.length/3-(s?1:0),a=new Array(2*(o-1)),l=s?i.slice(0,i.length-3):i;let c=0;for(let u=0;u<o-1;u++)a[c++]=u,a[c++]=u+1;e.push([E.POSITION,new Ue(l,3,s)]),r.push([E.POSITION,a])}function Klt(t,e,r,i){if(t.attributeData.colorFeature!=null)return;const n=t.attributeData.color;e.push([E.COLOR,new Ue(n??mh,4)]),r.push([E.COLOR,i])}function ect(t,e,r,i){if(t.attributeData.normal==null)return;const n=t.attributeData.normal;e.push([E.NORMAL,new Ue(n,3)]),r.push([E.NORMAL,i])}function tct(t,e,r,i){t.attributeData.colorFeature!=null&&(e.push([E.COLORFEATUREATTRIBUTE,new Ue([t.attributeData.colorFeature],1,!0)]),r.push([E.COLOR,i]))}function rct(t,e,r,i){t.attributeData.sizeFeature==null&&(e.push([E.SIZE,new Ue([t.attributeData.size??1],1,!0)]),r.push([E.SIZE,i]))}function ict(t,e,r,i){t.attributeData.sizeFeature!=null&&(e.push([E.SIZEFEATUREATTRIBUTE,new Ue([t.attributeData.sizeFeature],1,!0)]),r.push([E.SIZEFEATUREATTRIBUTE,i]))}function nct(t,e,r,i){const n=t.attributeData.opacityFeature;n!=null&&(e.push([E.OPACITYFEATUREATTRIBUTE,new Ue([n],1,!0)]),r.push([E.OPACITYFEATUREATTRIBUTE,i]))}function sct(t,e,r,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==$e.Global||!t.overlayInfo.spatialReference.isGeographic)return;const n=Ys(i.length),s=Mr(t.overlayInfo.spatialReference);for(let p=0;p<n.length;p+=3)F6(i,p,n,p,s);const o=i.length/3,a=Yi(o+1);let l=act,c=lct,u=0,d=0;ne(l,n[d++],n[d++],n[d++]),a[0]=0;for(let p=1;p<o+1;++p)p===o&&(d=0),ne(c,n[d++],n[d++],n[d++]),u+=Qwe(l,c),a[p]=u,[l,c]=[c,l];e.push([E.DISTANCETOSTART,new Ue(a,1,!0)]),r.push([E.DISTANCETOSTART,r[0][1]])}function oct(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const act=O(),lct=O();function ZNt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const n=i.length,s=Ys(3*n);i.forEach((a,l)=>{s[3*l]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function cct(t,e,r,i){const n=t.type==="polygon"?Kf.CCW_IS_HOLE:Kf.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=YP(s,!!t.hasZ,n),l=Ys(o.length),c=SEe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),u=c!=null;return{lines:u?Q3e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function uct(t,e){const r=t.type==="polygon"?Kf.CCW_IS_HOLE:Kf.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=YP(i,!1,r),o=$i(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=BJ;return{lines:o?Q3e(s,n):[],projectionSuccess:o}}function Q3e(t,e,r=null){const i=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;i.push({position:Ch(e,3*n,3*s),mapPositions:r!=null?Ch(r,o,a):void 0})}return i}function hct(t){const e=new mr,r=t.hasMultipassTerrain&&(t.output===D.Color||t.output===D.Alpha),i=t.space===mu.World;e.include(ACe,t),e.include(LCe,t),t.output===D.Depth&&e.include(Xg,t);const{vertex:n,fragment:s}=e;return s.include(Pc),xc(n,t),e.attributes.add(E.POSITION,"vec3"),e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),W_(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add(new yr("nearFar",(o,a)=>a.camera.nearFar),new Jt("viewport",(o,a)=>a.camera.fullViewport)),n.code.add(w`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(w`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(E.NORMAL,"vec3"),jS(n),n.constants.add("tiltThreshold","float",.7),n.code.add(w`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(w`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(w`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===_w.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===mu.Screen&&(n.uniforms.add(new Mi("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(w`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(w`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new Ce("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(w`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),LE(n,t),t8(e),n.code.add(w`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&n.code.add(w`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(w`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(w`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===mu.Screen&&n.code.add(w`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(w`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(xu,t),e.include(fn,t),s.uniforms.add(new Jt("intrinsicColor",o=>o.color),new Ye("tex",o=>o.markerTexture)),s.include(cm),e.constants.add("texelSize","float",1/Db),s.code.add(w`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",OJ/Db),e.constants.add("relativeTipLineWidth","float",gst),s.code.add(w`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",vo),s.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===D.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===D.Alpha?w`fragColor = vec4(finalColor.a);`:""}
    ${t.output===D.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===D.Color&&t.transparencyPassType===rt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===D.Highlight?w`fragColor = vec4(1.0);`:""}
    ${t.output===D.Depth?w`outputDepth(linearDepth);`:""}
  }
  `),e}const dct=Object.freeze(Object.defineProperty({__proto__:null,build:hct},Symbol.toStringTag,{value:"Module"})),J3e=new Map([[E.POSITION,0],[E.UV0,2],[E.AUXPOS1,3],[E.NORMAL,4],[E.COLOR,5],[E.COLORFEATUREATTRIBUTE,5],[E.SIZE,6],[E.SIZEFEATUREATTRIBUTE,6],[E.OPACITYFEATUREATTRIBUTE,7]]);let K3e=class eAe extends Tr{initializeProgram(e){return new vr(e.rctx,eAe.shader.get().build(this.configuration),J3e)}_makePipelineState(e,r){const i=this.configuration,n=e===rt.NONE;return Ot({blending:i.output===D.Color||i.output===D.Alpha?n?fu:u0(e):null,depthTest:{func:f1(e)},depthWrite:n?i.writeDepth?$l:null:S8(e),colorWrite:Ft,stencilWrite:i.hasOccludees?em:null,stencilTest:i.hasOccludees?r?r1:m1:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ot({blending:fu,depthTest:k5,depthWrite:null,colorWrite:Ft,stencilWrite:null,stencilTest:FCe}),this._occluderPipelineOpaque=Ot({blending:fu,depthTest:k5,depthWrite:null,colorWrite:Ft,stencilWrite:DCe,stencilTest:NCe}),this._occluderPipelineMaskWrite=Ot({blending:null,depthTest:RJ,depthWrite:null,colorWrite:null,stencilWrite:em,stencilTest:r1})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===le.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===le.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};K3e.shader=new _r(dct,()=>ce(()=>import("./LineMarker.glsl-c22f9f73.js"),[]));let pct=class extends p1{constructor(e){super(e,new mct),this._vertexAttributeLocations=J3e,this._configuration=new uo,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===le.DRAPED_MATERIAL?mu.Draped:this.parameters.worldSpace?mu.World:mu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Ah.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Ri.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Gi().vec3f(E.POSITION).vec2f(E.UV0).vec3f(E.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(E.NORMAL),this.parameters.vvSize?e.f32(E.SIZEFEATUREATTRIBUTE):e.f32(E.SIZE),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4f(E.COLOR),this.parameters.vvOpacity&&e.f32(E.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new gct(this._layout,this.parameters)}requiresSlot(e,r){return r===D.Color||r===D.Alpha||r===D.Highlight||r===D.Depth?e===le.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Ri.OccludeAndTransparentStencil?e===le.OPAQUE_MATERIAL||e===le.OCCLUDER_MATERIAL||e===le.TRANSPARENT_OCCLUDER_MATERIAL:r===D.Color||r===D.Alpha?e===(this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===le.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new fct(e)}},fct=class extends XZ{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(K3e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==D.Color&&this._output!==D.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},mct=class extends HP{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Ah.BUTT,this.anchor=_w.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},gct=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,n,s){const o=i.vertexAttributes.get(E.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(E.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,d=0;this._parameters.vvSize?d=i.vertexAttributes.get(E.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.SIZE)&&(u=i.vertexAttributes.get(E.SIZE).data[0]);let p=[1,1,1,1],m=0;this._parameters.vvColor?m=i.vertexAttributes.get(E.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(E.COLOR)&&(p=i.vertexAttributes.get(E.COLOR).data);let y=0;this._parameters.vvOpacity&&(y=i.vertexAttributes.get(E.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(n.buffer);let v=s*(this.vertexBufferLayout.stride/4);const b=(A,C,R,P)=>{if(_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],_[v++]=R[0],_[v++]=R[1],_[v++]=C[0],_[v++]=C[1],_[v++]=C[2],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=d:_[v++]=u,this._parameters.vvColor)_[v++]=m;else{const F=Math.min(4*P,p.length-4);_[v++]=p[F],_[v++]=p[F+1],_[v++]=p[F+2],_[v++]=p[F+3]}this._parameters.vvOpacity&&(_[v++]=y)};let x;(function(A){A[A.ASCENDING=1]="ASCENDING",A[A.DESCENDING=-1]="DESCENDING"})(x||(x={}));const T=(A,C)=>{const R=ne(yct,o[3*A],o[3*A+1],o[3*A+2]),P=_ct;let F=A+C;do ne(P,o[3*F],o[3*F+1],o[3*F+2]),F+=C;while(N_(R,P)&&F>=0&&F<a);e&&(De(R,R,e),De(P,P,e)),b(R,P,[-1,-1],A),b(R,P,[1,-1],A),b(R,P,[1,1],A),b(R,P,[-1,-1],A),b(R,P,[1,1],A),b(R,P,[-1,1],A)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||T(0,x.ASCENDING),S!=="end"&&S!=="begin-end"||T(a-1,x.DESCENDING)}};const yct=O(),_ct=O(),Qo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},vct={dash:Qo.dash,"dash-dot":[...Qo.dash,...Qo.dot],dot:Qo.dot,"long-dash":Qo["long-dash"],"long-dash-dot":[...Qo["long-dash"],...Qo.dot],"long-dash-dot-dot":[...Qo["long-dash"],...Qo.dot,...Qo.dot],none:null,"short-dash":Qo["short-dash"],"short-dash-dot":[...Qo["short-dash"],...Qo["short-dot"]],"short-dash-dot-dot":[...Qo["short-dash"],...Qo["short-dot"],...Qo["short-dot"]],"short-dot":Qo["short-dot"],solid:null},bct=8;function wct(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function t4t(t){return{pattern:[t,t],pixelRatio:2}}function tAe(t){return t!=null&&t.type==="style"?xct(t.style):null}function xct(t){return t!=null?wct(vct[t],bct):null}const Tct=["polyline","polygon","extent"],lle=new jP({size:!0,color:!0,rotation:!1,opacity:!0});let rAe=class iAe extends hm{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){if(this._fastUpdates=qS(this._context.renderer,lle),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:up(1))<0)throw new Y("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){var s,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:oW(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:tAe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return(o=this._fastUpdates)!=null&&o.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new yT(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new yT(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new yT({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new yT({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new pct({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:ale(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(e){return this._drivenProperties.size&&e.size?ha(knt(e.size)):1}_getDrivenColor(e){const r=$t(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Tct,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new wp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return $n.RecreateSymbol;{const n=this._fastUpdates;if(!XS(n,r,lle))return $n.RecreateSymbol;this._forEachMaterial(s=>s.setParameters(n.materialParameters))}}return $n.FastUpdate}prepareSymbolLayerPatch(e){var s,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((s=r.size)==null?void 0:s.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=oW(r.cap.newValue??"butt"),delete r.cap);const n=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){var a,l;const i=e.parameters.color,n=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._patternHidesLine&&!r?0:this._getCombinedOpacity(n),o=$t(i[0],i[1],i[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=WP(iAe.elevationModeChangeTypes,i,n);if(s!==an.UPDATE)return s;const o=Bh(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof Dr)return a1.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=ps(),c=cct(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const y=c.lines[m],_=y.position,v=y.mapPositions;if(this._context.clippingExtent!=null&&(vi(l),lu(l,v),!Hd(l,this._context.clippingExtent)))continue;const b=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,s.type,_O.ELEVATED,i);a.push(b),Kr.LINE_WIREFRAMES&&a.push(b.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(b.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const d=new h0({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),p=new um(this,d,a,null,null,sit,r);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=Bh(r.mode),p}_createGeometry(e,r,i,n,s,o,a){var _,v,b;const l=o===_O.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=s==="polygon",u=(_=this._fastUpdates)==null?void 0:_.visualVariables.color,d=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,p=(b=this._fastUpdates)==null?void 0:b.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),y={position:i,size:d?null:this._getDrivenSize(r.renderingInfo),color:u?null:this._getDrivenColor(r.renderingInfo),sizeFeature:d?ip(d.field,r.graphic):null,colorFeature:u?ip(u.field,r.graphic):null,opacityFeature:p?ip(p.field,r.graphic):null};return aW(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:n,attributeData:y},m)}_createAsOverlay(e,r){const i=e.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Kr.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=ps(),d=vi(),p=uct(n,this._context.overlaySR),m=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,s,m,"LineSymbol3DLayer");for(const y of p.lines){if(vi(u),lu(u,y.position),!Hd(u,this._context.clippingExtent))continue;SS(d,u);const _=v=>{const b=this._createGeometry(v,e,y.position,void 0,n.type,_O.DRAPED,i.uid),x=new KS(b,{layerUid:r,graphicUid:i.uid});c.push(x)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||lu(u,y.position,0,1),v!=="end"&&v!=="begin-end"||lu(u,y.position,y.position.length-3,1)}_(o),Kr.LINE_WIREFRAMES&&_(a)}return new G8(this,c,d,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??up(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?ha(1):1:ha(e)}_prepareMaterialPatch(e,r,i){var a,l;const n=r.material;if(n==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(n.type==="collection")return;const s=n.type==="complete"?(a=n.newValue)==null?void 0:a.color:((l=n.diff.color)==null?void 0:l.type)==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);i.useMaterialColor&&this._patchMaterialColor(PP(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){var u;const i=r.marker,n=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||n==null)return{changed:!1,useMaterialColor:this._markerColor==null};const s=i.diff.color,o=s!=null,a=o?s.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),n,e);const c=(u=i.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>n.setParameters({markerPrimitive:ale(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var _O;rAe.elevationModeChangeTypes={definedChanged:an.RECREATE,staysOnTheGround:an.NONE,onTheGroundChanged:an.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(_O||(_O={}));let PC=null,G5=!0;function sz(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(G5)try{return new ImageData(t,e)}catch{G5=!1}return nAe(t,e,r)}function Sct(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(G5)try{return new ImageData(t,e,r)}catch{G5=!1}const n=nAe(e,r,i);return n.data.set(t,0),n}function Ect(){return PC||(PC=document.createElement("canvas"),PC.width=1,PC.height=1),PC}function nAe(t,e,r){return r||(r=Ect()),r.getContext("2d").createImageData(t,e)}var O2;const oz=new WeakMap;let Cct=0,of=O2=class extends ke{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const n={type:"image-element",src:ES(t.src,i),crossOrigin:t.crossOrigin};e[r]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[r]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:ES(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[r]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(oz.has(this.data)||oz.set(this.data,++Cct),e(oz.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new O2(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return Sct(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new O2({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new O2({data:t}):mS(O2,t)}};h([f({type:String,json:{write:sw}})],of.prototype,"url",null),h([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],of.prototype,"data",null),h([xr("data")],of.prototype,"writeData",null),h([lr("data")],of.prototype,"readData",null),h([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],of.prototype,"transparent",null),h([f({json:{write:!0}})],of.prototype,"wrap",void 0),h([f({readOnly:!0})],of.prototype,"contentHash",null),of=O2=h([N("esri.geometry.support.MeshTexture")],of);const vO=of;let R2=class extends Cu(ke){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};h([f({type:[Number],nonNullable:!0,json:{write:!0}})],R2.prototype,"offset",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],R2.prototype,"rotation",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],R2.prototype,"scale",void 0),R2=h([N("esri.geometry.support.MeshTextureTransform")],R2);const XT=R2;var lW;let vd=lW=class extends ke{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new lW(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){var e,r,i,n;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(i=this.colorTextureTransform)==null?void 0:i.clone(),normalTextureTransform:(n=this.normalTextureTransform)==null?void 0:n.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};h([f({type:it,json:{write:!0}})],vd.prototype,"color",void 0),h([f({type:vO,json:{write:!0}})],vd.prototype,"colorTexture",void 0),h([f({type:XT,json:{write:!0}})],vd.prototype,"colorTextureTransform",void 0),h([f({type:vO,json:{write:!0}})],vd.prototype,"normalTexture",void 0),h([f({type:XT,json:{write:!0}})],vd.prototype,"normalTextureTransform",void 0),h([f({nonNullable:!0,json:{write:!0}})],vd.prototype,"alphaMode",void 0),h([f({nonNullable:!0,json:{write:!0}})],vd.prototype,"alphaCutoff",void 0),h([f({nonNullable:!0,json:{write:!0}})],vd.prototype,"doubleSided",void 0),vd=lW=h([N("esri.geometry.support.MeshMaterial")],vd);const YJ=vd;var cW;let Yu=cW=class extends YJ{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new cW(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,r,i,n,s,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(t),emissiveTextureTransform:(i=this.emissiveTextureTransform)==null?void 0:i.clone(),occlusionTexture:(n=this.occlusionTexture)==null?void 0:n.cloneWithDeduplication(t),occlusionTextureTransform:(s=this.occlusionTextureTransform)==null?void 0:s.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};h([f({type:it,json:{write:!0}})],Yu.prototype,"emissiveColor",void 0),h([f({type:vO,json:{write:!0}})],Yu.prototype,"emissiveTexture",void 0),h([f({type:XT,json:{write:!0}})],Yu.prototype,"emissiveTextureTransform",void 0),h([f({type:vO,json:{write:!0}})],Yu.prototype,"occlusionTexture",void 0),h([f({type:XT,json:{write:!0}})],Yu.prototype,"occlusionTextureTransform",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Yu.prototype,"metallic",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Yu.prototype,"roughness",void 0),h([f({type:vO,json:{write:!0}})],Yu.prototype,"metallicRoughnessTexture",void 0),h([f({type:XT,json:{write:!0}})],Yu.prototype,"metallicRoughnessTextureTransform",void 0),Yu=cW=h([N("esri.geometry.support.MeshMaterialMetallicRoughness")],Yu);const sAe=Yu;var JD;const oAe="esri.geometry.support.MeshVertexAttributes",Ax=J.getLogger(oAe);let Ua=JD=class extends ke{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return P2(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},Ax)}castPosition(t){return t&&t instanceof Float32Array&&Ax.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),P2(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},Ax)}castUv(t){return P2(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},Ax)}castNormal(t){return P2(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},Ax)}castTangent(t){return P2(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},Ax)}clone(){const t={position:ye(this.position),uv:ye(this.uv),normal:ye(this.normal),tangent:ye(this.tangent),color:ye(this.color)};return new JD(t)}clonePositional(){const t={position:ye(this.position),normal:ye(this.normal),tangent:ye(this.tangent),uv:this.uv,color:this.color};return new JD(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function az(t,e,r,i){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):t}function P2(t,e,r,i,n){if(!t)return t;if(t instanceof e)return az(t,i,e,n);for(const s of r)if(t instanceof s)return az(new e(t),i,e,n);if(Array.isArray(t))return az(new e(t),i,e,n);{const s=r.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function MC(t,e,r){e[r]=Act(t)}function Act(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}h([f({json:{write:MC}})],Ua.prototype,"color",void 0),h([_i("color")],Ua.prototype,"castColor",null),h([f({nonNullable:!0,json:{write:MC}})],Ua.prototype,"position",void 0),h([_i("position")],Ua.prototype,"castPosition",null),h([f({json:{write:MC}})],Ua.prototype,"uv",void 0),h([_i("uv")],Ua.prototype,"castUv",null),h([f({json:{write:MC}})],Ua.prototype,"normal",void 0),h([_i("normal")],Ua.prototype,"castNormal",null),h([f({json:{write:MC}})],Ua.prototype,"tangent",void 0),h([_i("tangent")],Ua.prototype,"castTangent",null),Ua=JD=h([N(oAe)],Ua);var oA;const aAe="esri.geometry.support.MeshComponent",Oct=J.getLogger(aAe);let Vm=oA=class extends ke{static from(t){return mS(oA,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return P2(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Oct)}castMaterial(t){return mS(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?sAe:YJ,t)}clone(){return new oA({faces:ye(this.faces),shading:this.shading,material:ye(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:ye(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new oA(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};h([f({json:{write:!0}})],Vm.prototype,"faces",void 0),h([_i("faces")],Vm.prototype,"castFaces",null),h([f({type:YJ,json:{write:!0}})],Vm.prototype,"material",void 0),h([_i("material")],Vm.prototype,"castMaterial",null),h([f({type:String,json:{write:!0}})],Vm.prototype,"shading",void 0),h([f({type:Boolean})],Vm.prototype,"trustSourceNormals",void 0),Vm=oA=h([N(aAe)],Vm);const xw=Vm,j8=J.getLogger("esri.geometry.support.meshUtils.normalProjection");function tM(t,e,r,i,n){return Z8(i)?(Y8(Cg.TO_PCPF,ds.fromTypedArray(t),kh.fromTypedArray(e),kh.fromTypedArray(r),i,ds.fromTypedArray(n)),n):(j8.error("Cannot convert spatial reference to PCPF"),n)}function H8(t,e,r,i,n){return Z8(i)?(Y8(Cg.FROM_PCPF,ds.fromTypedArray(t),kh.fromTypedArray(e),kh.fromTypedArray(r),i,ds.fromTypedArray(n)),n):(j8.error("Cannot convert to spatial reference from PCPF"),n)}function W8(t,e,r){return $i(t,e,0,r,t0(e),0,t.length/3),r}function q8(t,e,r){return $i(t,t0(r),0,e,r,0,t.length/3),e}function lAe(t,e,r){return Qf(ks,r),yp(e,t,ks),iQ(ks)||I8(e,e),e}function cAe(t,e,r){if(Qf(ks,r),yp(e,t,ks,4),iQ(ks)||I8(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function rM(t,e,r,i,n){if(!Z8(i))return j8.error("Cannot convert spatial reference to PCPF"),n;Y8(Cg.TO_PCPF,ds.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),kh.fromTypedArray(e),kh.fromTypedArray(r),i,ds.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function X8(t,e,r,i,n){if(!Z8(i))return j8.error("Cannot convert to spatial reference from PCPF"),n;Y8(Cg.FROM_PCPF,ds.fromTypedArray(t,16),kh.fromTypedArray(e),kh.fromTypedArray(r),i,ds.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function Y8(t,e,r,i,n,s){if(!e)return;const o=r.count,a=t0(n);if(uAe(n))for(let l=0;l<o;l++)i.getVec(l,xI),e.getVec(l,Np),ma(a,xI,TI,a),Ac(ks,TI),t===Cg.FROM_PCPF&&Uh(ks,ks),zo(Np,Np,ks),s.setVec(l,Np);else for(let l=0;l<o;l++){i.getVec(l,xI),e.getVec(l,Np),ma(a,xI,TI,a),Ac(ks,TI);const c=g4(r.get(l,1));let u=Math.cos(c);t===Cg.TO_PCPF&&(u=1/u),ks[0]*=u,ks[1]*=u,ks[2]*=u,ks[3]*=u,ks[4]*=u,ks[5]*=u,t===Cg.FROM_PCPF&&Uh(ks,ks),zo(Np,Np,ks),me(Np,Np),s.setVec(l,Np)}return s}function Z8(t){return uAe(t)||Rct(t)}function uAe(t){return t.isWGS84||S0e(t)||nm(t)||sm(t)}function Rct(t){return t.isWebMercator}var Cg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(Cg||(Cg={}));const xI=O(),Np=O(),TI=_e(),ks=hi();var bO;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(bO||(bO={}));let hAe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=wg.KTX2_ENCODING}};function Ub(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function Pct(t){return new Promise((e,r)=>{const i=new Blob([t]),n=new FileReader;n.onload=()=>{const s=n.result;e(JSON.parse(s))},n.onerror=s=>{r(s)},n.readAsText(i)})}async function Mct(t,e){return e===wg.KTX2_ENCODING?new hAe(t):new Promise((r,i)=>{const n=new Blob([t],{type:e}),s=URL.createObjectURL(n),o=new Image,a=()=>{URL.revokeObjectURL(s),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=u=>{URL.revokeObjectURL(s),i(u),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=s})}function Ef(t){if(t==null)return null;const e=t.offset!=null?t.offset:qEe,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:XEe,n=ZD(1,0,0,0,1,0,e[0],e[1],1),s=ZD(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=ZD(i[0],0,0,0,i[1],0,0,0,1),a=Pl();return US(a,s,o),US(a,n,a),a}J.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");let $ct=class extends um{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,n=i.geometries.slice();i.removeAllGeometries();const s=CG(lz,i.transformation),o=r.getOrigin(s);for(const a of n){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=n}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(n=>e(n.material));r.removeAllGeometries();for(let n=0;n<this._originalGeometries.length;n++){const s=this._originalGeometries[n],o=i[n];o.setParameters({modelTransformation:null}),o===s.material?r.addGeometry(s):r.addGeometry(s.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:n}=this;if(n.geometries.length===0)return;const s=n.geometries[0].localOrigin,o=CG(lz,e),a=i.getOrigin(o);if(a===s)return;const l=(r==null?void 0:r.localMatrix)??yn;n.clearShaderTransformation(),n.transformation=e,n.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:n}=this,s=(r==null?void 0:r.localMatrix)??yn;if(!this._fastTransformUpdatesEnabled)return n.clearShaderTransformation(),n.transformation=e,n.geometries.forEach(m=>{m.transformation=s}),void this.resetEdgeObject(i);const o=n.transformation,a=n.geometries[0].transformation,l=e,c=s,u=Vr(cle,o,a),d=Vr(ule,l,c);n.shaderTransformation=l,this._setFastMaterialTransformation({matA:u,matB:d});const p=()=>c;for(const m of n.geometries)m.shaderTransformer=p;this.resetEdgeObject(i)}alignWithElevation(e,r,i,n){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,n);i!=null&&P8(this.elevationContext.featureExpressionInfoContext,i);const s=(m,y)=>J_(m,e,this.elevationContext,r,y),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Vr(cle,a,l),u=In(Ict,o.shaderTransformation);this.alignedSampledElevation=Lb(this,this.elevationContext,e.spatialReference,s,r,u),o.shaderTransformation=u;const d=o.geometries[0].shaderTransformation,p=Vr(ule,u,d);this._setFastMaterialTransformation({matA:c,matB:p}),this.resetEdgeObject(n)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const n=i.geometries[0].localOrigin,s=OP(Lct,te(lz,n.vec3,-1)),o=Vr(hle,s,e),a=Vr(dle,s,r),l=us(hle,o),c=Vr(dle,a,l);for(const u of i.geometries)u.material.setParameters({modelTransformation:c})}};const lz=O(),cle=_e(),ule=_e(),Ict=_e(),hle=_e(),dle=_e(),Lct=_e();let Dct=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(n=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(n))return n;const o=r.byMaterial(n);return this._fastTransformOriginalMaterials.set(n,o),r.delete(n),n}const s=new tm(n.parameters);return i.stage.add(s),this._fastTransformClonedMaterials.set(s,n),s},i.localOriginFactory)}disable(e,r,i){const n=new Set,s=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return r.has(u.uid)?(n.add(c),r.byUid(u.uid).material):(s.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),a.dispose(),l});for(const o of n)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o),o.dispose();for(const o of s){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},Nct=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){var i;const r=(i=this._byMaterial.get(e))==null?void 0:i.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function Fct(t){const e=new mr,{vertex:r,fragment:i}=e;return e.include(Cl,t),e.include(qw,t),e.include($Ce,t),xc(r,t),t.stippleEnabled&&(e.attributes.add(E.UV0,"vec2"),e.attributes.add(E.AUXPOS1,"vec3"),r.uniforms.add(new Jt("viewport",(n,s)=>s.camera.fullViewport))),e.attributes.add(E.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(w`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(w`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Ce("worldToScreenRatio",(n,s)=>1/s.screenToPCSRatio)):r.code.add(w`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(w`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(w`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(w`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ce("stipplePatternPixelSize",n=>AJ(n))),r.code.add(w`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(w`}`),t.output===D.Highlight&&e.include(c0,t),e.include(fn,t),i.uniforms.add(new Ce("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new Jt("constantColor",n=>n.color)),i.code.add(w`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===D.ObjectAndLayerIdColor?w`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${w.float(vo)}) {
      discard;
    }

    ${t.output===D.Color?w`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===D.Highlight?w`outputHighlight();`:""}
  }
  `),e}const Uct=Object.freeze(Object.defineProperty({__proto__:null,build:Fct},Symbol.toStringTag,{value:"Module"}));let dAe=class pAe extends Tr{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==D.Highlight}initializeProgram(e){return new vr(e.rctx,pAe.shader.get().build(this.configuration),fr)}initializePipeline(){const e=this.configuration,r=So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),i=(n,s=null,o=null)=>Ot({blending:s,depthTest:RJ,depthWrite:o,colorWrite:Ft,stencilWrite:e.hasOccludees?em:null,stencilTest:e.hasOccludees?n?r1:m1:null});return e.output===D.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,$l),i(!1,e.transparent||this._stippleEnabled?r:null,$l)):i(!1)}get primitiveType(){return Et.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};dAe.shader=new _r(Uct,()=>ce(()=>import("./NativeLine.glsl-1fd72627.js"),[]));let Bc=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};h([U({count:D.COUNT})],Bc.prototype,"output",void 0),h([U()],Bc.prototype,"hasSlicePlane",void 0),h([U()],Bc.prototype,"hasVertexColors",void 0),h([U()],Bc.prototype,"transparent",void 0),h([U()],Bc.prototype,"draped",void 0),h([U()],Bc.prototype,"stippleEnabled",void 0),h([U()],Bc.prototype,"stippleOffColorEnabled",void 0),h([U()],Bc.prototype,"stipplePreferContinuous",void 0),h([U()],Bc.prototype,"hasOccludees",void 0),h([U({constValue:!1})],Bc.prototype,"stippleRequiresClamp",void 0),h([U({constValue:!1})],Bc.prototype,"stippleScaleWithLineWidth",void 0),h([U({constValue:!1})],Bc.prototype,"stippleRequiresStretchMeasure",void 0);var j5;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(j5||(j5={}));let ple=class extends p1{constructor(e){super(e,new Bct),this._configuration=new Bc}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===le.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!Jwe(r))return void J.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(E.POSITION).data,l=i.camera,c=Gct;fs(c,i.point);const u=2;ne($C[0],c[0]-u,c[1]+u,0),ne($C[1],c[0]+u,c[1]+u,0),ne($C[2],c[0]+u,c[1]-u,0),ne($C[3],c[0]-u,c[1]-u,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen($C[_],xm[_]))return;oa(l.eye,xm[0],xm[1],cz),oa(l.eye,xm[1],xm[2],uz),oa(l.eye,xm[2],xm[3],hz),oa(l.eye,xm[3],xm[0],dz);let d=Number.MAX_VALUE,p=0;for(let _=0;_<a.length-5;_+=3){if(Ma[0]=a[_]+r[12],Ma[1]=a[_+1]+r[13],Ma[2]=a[_+2]+r[14],$a[0]=a[_+3]+r[12],$a[1]=a[_+4]+r[13],$a[2]=a[_+5]+r[14],oi(cz,Ma)<0&&oi(cz,$a)<0||oi(uz,Ma)<0&&oi(uz,$a)<0||oi(hz,Ma)<0&&oi(hz,$a)<0||oi(dz,Ma)<0&&oi(dz,$a)<0)continue;if(l.projectToRenderScreen(Ma,V1),l.projectToRenderScreen($a,G1),V1[2]<0&&G1[2]>0){ae(Fp,Ma,$a);const b=l.frustum,x=-oi(b[si.NEAR],Ma)/fe(Fp,b[si.NEAR]);te(Fp,Fp,x),oe(Ma,Ma,Fp),l.projectToRenderScreen(Ma,V1)}else if(V1[2]>0&&G1[2]<0){ae(Fp,$a,Ma);const b=l.frustum,x=-oi(b[si.NEAR],$a)/fe(Fp,b[si.NEAR]);te(Fp,Fp,x),oe($a,$a,Fp),l.projectToRenderScreen($a,G1)}else if(V1[2]<0&&G1[2]<0)continue;V1[2]=0,G1[2]=0;const v=wZ(Pb(V1,G1,gle),c);v<d&&(d=v,re(fle,Ma),re(mle,$a),p=_/3)}const m=i.rayBegin,y=i.rayEnd;if(d<u*u){let _=Number.MAX_VALUE;if(ube(Pb(fle,mle,gle),Pb(m,y,Vct),B1)){ae(B1,B1,m);const v=Te(B1);te(B1,B1,1/v),_=v/ci(m,y)}o(_,B1,p,!1)}}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(E.POSITION).data,l=e.vertexAttributes.get(E.SIZE),c=l?l.data[0]:0,u=n[0],d=n[1],p=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,y=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],x=u-v,T=d-b,S=a[_+3]-v,A=a[_+4]-b,C=ge((S*x+A*T)/(S*S+A*A),0,1),R=S*C-x,P=A*C-T,F=R*R+P*P;F<m&&(m=F,y=_/3)}m<p*p&&s(o.dist,o.normal,y,!1)}requiresSlot(e,r){return!(r!==D.Color&&r!==D.Highlight&&r!==D.ObjectAndLayerIdColor||e!==le.OPAQUE_MATERIAL&&e!==le.DRAPED_MATERIAL)}createGLMaterial(e){return new kct(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?jst:Vst;return this.parameters.stipplePattern==null?new DE(e):new zct(e.clone().vec3f(E.AUXPOS1).vec2f(E.UV0))}},kct=class extends h1{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===D.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(dAe,e)}},zct=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(E.POSITION).length}write(e,r,i,n,s){wSe(i,this.vertexBufferLayout,e,r,n,s),this._writeAuxpos1(e,i,n,s),this._writeUV0(e,i,n,s)}_writeAuxpos1(e,r,i,n){const s=i.getField(E.AUXPOS1,ds),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=e,c=s.typedBufferStride,u=s.typedBuffer;n*=c;for(let d=0;d<o.length-1;d+=2)for(const p of[1,0]){const m=3*o[d+p],y=a[m],_=a[m+1],v=a[m+2],b=l[0]*y+l[4]*_+l[8]*v+l[12],x=l[1]*y+l[5]*_+l[9]*v+l[13],T=l[2]*y+l[6]*_+l[10]*v+l[14];u[n]=b,u[n+1]=x,u[n+2]=T,n+=c}}_writeUV0(e,r,i,n){var T;const s=i.getField(E.UV0,d1),o=r.indices.get(E.POSITION),a=r.vertexAttributes.get(E.POSITION).data,l=(T=r.vertexAttributes.get(E.DISTANCETOSTART))==null?void 0:T.data,c=s.typedBufferStride,u=s.typedBuffer;let d=0;u[n*=c]=j5.START,u[n+1]=d,n+=c;const p=3*o[0],m=ne(Ma,a[p],a[p+1],a[p+2]);e&&De(m,m,e);const y=$a,_=o.length-1;let v=1;const b=l?(S,A,C)=>d=l[C]:(S,A,C)=>d+=ci(S,A);for(let S=1;S<_;S+=2){const A=3*o[S];ne(y,a[A],a[A+1],a[A+2]),e&&De(y,y,e),b(m,y,v++);for(let C=0;C<2;++C)u[n]=1-C,u[n+1]=d,n+=c;re(m,y)}const x=3*o[_];ne(y,a[x],a[x+1],a[x+2]),e&&De(y,y,e),b(m,y,v),u[n]=j5.END,u[n+1]=d}},Bct=class extends KQ{constructor(){super(...arguments),this.color=mh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Ma=O(),$a=O(),Fp=O(),B1=O(),V1=Vo(),G1=Vo(),fle=O(),mle=O(),gle=_p(),Vct=_p(),Gct=O(),$C=[Vo(),Vo(),Vo(),Vo()],xm=[O(),O(),O(),O()],cz=Er(),uz=Er(),hz=Er(),dz=Er(),jct=["mesh"];let Hct=class extends hm{constructor(e,r,i,n){super(e,r,i,n),this._materialInfoCache=new Nct,this._fastUpdateProcessor=new Dct,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Kr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new ple({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new ple({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,jct,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new wp),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(n=>{n.material.setParameters({layerOpacity:i});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>{const s=r(n);s!=null&&s.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,K_)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const n=r(i);n!=null&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,o=Wct,{origin:a,transform:l}=i;switch(ma(r,ne(no,a.x,a.y,a.z??0),o,s),n){case bO.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case bO.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case bO.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:u,renderCoordsHelper:d}=this._context,p=(m,y)=>J_(m,u,c,d,y);return e.alignedSampledElevation=Lb(e,c,u.spatialReference,p,d,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof it?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:n}=e??Xct;return`${r[0]},${r[1]},${n},${i[0]},${i[1]}`}_materialProperties(e,r,i){const n=this._materialPropertiesDefault(e,i);if(!r.material)return n;const{color:s,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:d,alphaMode:p}=r.material,m=this._colorOrTextureUid(s),y=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),b=this._textureTransformUid(c);if(n.color=s,n.colorTexture=o,n.normalTexture=l,n.uid=`${n.uid},cmuid:${m},ctmuid:${y},cttuid:${_},ntmuid:${v},nttuid:${b},ds:${u},ac:${d},am:${p}`,r.material instanceof sAe){const{metallic:x,roughness:T,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:A,emissiveColor:C,emissiveTexture:R,emissiveTextureTransform:P,occlusionTexture:F,occlusionTextureTransform:k}=r.material,V=this._colorOrTextureUid(S),z=this._textureTransformUid(A),X=this._colorOrTextureUid(C),q=this._colorOrTextureUid(R),G=this._textureTransformUid(P),Q=this._colorOrTextureUid(F),M=this._textureTransformUid(k);n.metallic=x,n.roughness=T,n.metallicRoughnessTexture=S,n.emissiveColor=C,n.emissiveTexture=R,n.occlusionTexture=F,n.colorTextureTransform=this._convertTextureTransform(a),n.normalTextureTransform=this._convertTextureTransform(c),n.emissiveTextureTransform=this._convertTextureTransform(P),n.occlusionTextureTransform=this._convertTextureTransform(k),n.metallicRoughnessTextureTransform=this._convertTextureTransform(A),n.uid=`${n.uid},mrm:${x},mrr:${T},mrt:${V},mrtt:${z},emuid:${X},etmuid:${q},ett:${G},otmuid:${Q},ott:${M}`}return n}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:n}=e;return{scale:r,offset:i,rotation:It(n)}}_setInternalColorValueParameters(e,r){r.diffuse=it.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Gr.Opaque);return r!=null?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const n=`${e.contentHash}/${r}`;let s=this._textures.get(n);return s||(s=new Hw(Ub(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!Ub(i)&&r!==Gr.Opaque,encoding:Ub(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(n,s),this._context.stage.add(s),this._context.stage.loadImmediate(s)),s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Pt.CLAMP_TO_EDGE;case"mirror":return Pt.MIRRORED_REPEAT;default:return Pt.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(r.emissiveFactor=it.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Ef(e.colorTextureTransform),r.normalTextureTransformMatrix=Ef(e.normalTextureTransform),r.occlusionTextureTransformMatrix=Ef(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Ef(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Ef(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=mh;else{const n=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;n!=null?e.externalColor=it.toUnitRGBA(n):(i=null,e.externalColor=mh)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var y,_,v;const i=(y=r.material)==null?void 0:y.color,n=(_=r.material)==null?void 0:_.colorTexture,s=(v=r.material)==null?void 0:v.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||n!=null&&n.transparent||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},d=g3e({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:it.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:d,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Zs,diffuse:pg,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:ui.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=d?[...jJ]:[l.metallic,l.roughness,z8[2]],r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?ui.None:ui.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const m=new tm(p);return u.material=m,this._materialInfoCache.set(l.uid,u),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Gr.MaskBlend:Gr.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Gr.Opaque:r.alphaMode==="mask"?Gr.Mask:Gr.Blend}_addDebugNormals(e,r){const i=r.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const y=r[m],_=y.vertexAttributes.get(E.POSITION),v=y.vertexAttributes.get(E.NORMAL),b=y.indices.get(E.POSITION),x=y.indices.get(E.NORMAL),T=_.data,S=v.data;for(let A=0;A<b.length;A++){const C=3*b[A],R=3*x[A];for(let P=0;P<3;P++)o.push(T[C+P]);for(let P=0;P<3;P++)o.push(T[C+P]+S[R+P]*s);if(a.push(a.length),a.push(a.length),A%3==0){this._calculateFaceNormal(T,b,A,Px),this._getFaceVertices(T,b,A,no,Ox,Rx),oe(no,no,Ox),oe(no,no,Rx),te(no,no,1/3);for(let P=0;P<3;P++)l.push(no[P]);for(let P=0;P<3;P++)l.push(no[P]+Px[P]*s);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,d=new Xn(this._debugVertexNormalMaterial,[[E.POSITION,new Ue(o,3,!0)]],[[E.POSITION,a]],null,on.Line);r.push(d),d.transformation=u;const p=new Xn(this._debugFaceNormalMaterial,[[E.POSITION,new Ue(l,3,!0)]],[[E.POSITION,c]],null,on.Line);p.transformation=u,r.push(p)}_createAs3DShape(e,r,i,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,r,n);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;Kr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new h0({geometries:a,layerUid:this._context.layer.uid,graphicUid:n});c.transformation=l;const u=UEe(this.symbolLayer,{opacity:this._getLayerOpacity()}),d=u!=null?new git(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new $ct(this,c,a,null,null,Lb,i,d);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=K_(i.mode),p.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:y}=this._context,_=(v,b)=>J_(v,m,i,y,b);return p.alignedSampledElevation=Lb(p,i,m.spatialReference,_,y),p}_getCenterPointInElevationSR(e){const r=Ww(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return hZ([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,n){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,r,i,n){if(r==null)return this._createComponentNormalsFlat(e,n);let s=!1;if(!i.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,Px);for(let a=0;a<3;a++){const l=3*n[o+a];no[0]=r[l],no[1]=r[l+1],no[2]=r[l+2],fe(Px,no)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],s=!0)}}return new pz(r,n,s)}_createComponentNormalsFlat(e,r){const i=Yi(r.length),n=new Array(3*r.length);for(let s=0;s<r.length;s+=3){const o=this._calculateFaceNormal(e,r,s,Px);for(let a=0;a<3;a++)i[s+a]=o[a],n[s+a]=s/3}return new pz(i,n,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,Px);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:O(),count:0},i[c]=u),oe(u.normal,u.normal,a),u.count++}}const n=Yi(3*r.length),s=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(me(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new pz(n,s,!1)}_getFaceVertices(e,r,i,n,s,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,n){return this._getFaceVertices(e,r,i,no,Ox,Rx),ae(Ox,Ox,no),ae(Rx,Rx,no),ot(no,Ox,Rx),me(n,no),n}_getOrCreateComponents(e){return e.components??qct}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const n=r.reprojection===Kl.ECEF?r.transformBeforeProject:null;if(n!=null&&(i=gp(new Float64Array(i.length),i,n)),r.reprojection===Kl.NONE)return r.needsBufferCopy?new Float64Array(i):i;const s=n!=null?i:new Float64Array(i.length);return $i(i,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,i.length/3),s}_createNormalBuffer(e,r,i){let n=e.vertexAttributes.normal;if(n==null)return null;const s=i.reprojection===Kl.ECEF?i.transformBeforeProject:null;if(s!=null&&(n=lAe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Kl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s!=null?n:new Float32Array(n.length);return tM(n,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let n=e.vertexAttributes.tangent;if(n==null)return null;const s=i.reprojection===Kl.ECEF?i.transformBeforeProject:null;if(s!=null&&(n=cAe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Kl.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s!=null?n:new Float32Array(n.length);return rM(n,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const n=this._getVertexOpacityAndColor(e),s=Bot((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return v3e(n,s,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(n!=null&&n.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s!=null&&s.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),d=this._createNormalBuffer(e,l,a),p=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:d,tangentBuffer:p,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===Kl.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,d,p),geometryTransformation:a.reprojection===Kl.NONE&&a.geometryTransformation!=null?a.geometryTransformation:_e()}}_computeReprojectionInfo(e){var s;const{vertexSpace:r}=e,i=r.isRelative,n=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===$e.Local?Kl.NONE:Kl.ECEF:Kl.NONE;if(i){const{origin:o}=r,a=_e(),l=((s=e.transform)==null?void 0:s.localMatrix)??yn;if(n===Kl.NONE)return ma(e.spatialReference,o,a,this._context.renderCoordsHelper.spatialReference),{reprojection:n,objectTransformation:a,geometryTransformation:RS(l),needsBufferCopy:!1};const c=OP(_e(),o);return Vr(c,c,l),{reprojection:n,transformBeforeProject:c,needsBufferCopy:!0}}return{reprojection:n,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;SI[0]=o.x,SI[1]=o.y,SI[2]=o.z??0;const a=_e();return ma(e.spatialReference,SI,a,s),us(yle,a),gp(r,r,yle),i==null&&n==null||(Ac(IC,a),Uh(IC,IC),i!=null&&yp(i,i,IC),n!=null&&yp(n,n,IC,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,n=r.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(i<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??zS(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let n;const s=r.length/3;return i==null||e.spatialReference.equals(i)?n=r:(n=new Float64Array(r.length),$i(e.vertexAttributes.position,e.spatialReference,0,n,i,0,s)),vi(fz),lu(fz,n,0,s),!Hd(fz,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!Bg(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,r);if(n==null)return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:d,geometryTransformation:p}=n,m=this._getOrCreateComponents(e),y=new Array;let _=!1;for(const v of m){if(!this._validateFaces(e,v))return null;const b=this._getOrCreateFaces(e,v);if(b.length===0)continue;const x=this._createComponentNormals(s,c,v,b);x.didFlipNormals&&(_=!0);const T=[[E.POSITION,new Ue(s,3,!0)],[E.NORMAL,new Ue(x.normals,3,!0)]],S=[[E.POSITION,b],[E.NORMAL,x.indices]];a!=null&&(T.push([E.COLOR,new Ue(a,4,!0)]),S.push([E.COLOR,b])),l!=null&&(T.push([E.SYMBOLCOLOR,new Ue(l,4,!0)]),S.push([E.SYMBOLCOLOR,OE(b.length)])),o!=null&&(T.push([E.UV0,new Ue(o,2,!0)]),S.push([E.UV0,b])),u!=null&&(T.push([E.TANGENT,new Ue(u,4,!0)]),S.push([E.TANGENT,b]));const A=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),C=this._getOrCreateMaterial(e,v),R=new Xn(C,T,S,null,on.Mesh,A);R.transformation=p,y.push(R)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:y,objectTransformation:d}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}};class pz{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}}const SI=O(),no=O(),Ox=O(),Rx=O(),Px=O(),yle=_e(),IC=hi(),Wct=_e(),fz=ps(),qct=[new xw],Xct=new XT;var Kl;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Kl||(Kl={}));let Yct=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){P8(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>J_(o,e,this.elevationContext,r,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r);s!=null&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=O()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Up),De(e,this._lodRenderer.baseBoundingSphere.center,Up)}getBoundingBoxObjectSpace(e=ps()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Up);const r=this._lodRenderer.baseBoundingBox;vi(e);for(let i=0;i<8;++i)ne($u,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),De($u,$u,Up),Xf(e,$u);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Up),e.render.origin[0]+=Up[12],e.render.origin[1]+=Up[13],e.render.origin[2]+=Up[14],e.render.num++}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=Zct,l=QY(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Up);for(let u=0;u<l;u++){const d=a[u];$u[0]=o[d[0]],$u[1]=o[d[1]],$u[2]=o[d[2]],De($u,$u,Up),j1[3*u]=$u[0],j1[3*u+1]=$u[1],j1[3*u+2]=$u[2]}if(!e(j1,0,l))return null;vi(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let d=0;d<3;d++)o[d]=Math.min(o[d],j1[u+d]),o[d+3]=Math.max(o[d+3],j1[u+d]);c&&i.push({location:j1.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(jd(o,mz),this.elevationContext.mode!=="absolute-height")){let u;const d=dJ(o,r.service.spatialReference,r);try{u=await r.service.queryElevation(mz[0],mz[1],n,d,"ground")}catch{}u!=null&&E1e(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,r){if(e===Hg.Highlight){const i=new h5(e);this._addHighlightId(i),r.addExternal(n=>{this._removeHighlightId(n)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const j1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$u=O(),mz=O(),Zct=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Up=_e();function Qct(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new DEe(r,i))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function Jct(t){return{levels:t.map(e=>Qct(e))}}function Kct(t){return t=t||globalThis.location.hostname,eut.some(e=>(t==null?void 0:t.match(e))!=null)}function uW(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(fAe)!=null||e.match(gAe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(mAe)!=null||e.match(yAe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const fAe=/^devext.arcgis.com$/,mAe=/^qaext.arcgis.com$/,gAe=/^[\w-]*\.mapsdevext.arcgis.com$/,yAe=/^[\w-]*\.mapsqa.arcgis.com$/,eut=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,fAe,mAe,/^jsapps.esri.com$/,gAe,yAe];function tut(t,e,r){if(t.count!==e.count)return void $8.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],d=r[7],p=r[8],m=r[9],y=r[10],_=r[11],v=r[12],b=r[13],x=r[14],T=r[15],S=t.typedBuffer,A=t.typedBufferStride,C=e.typedBuffer,R=e.typedBufferStride;for(let P=0;P<i;P++){const F=P*A,k=P*R,V=C[k],z=C[k+1],X=C[k+2],q=C[k+3];S[F]=n*V+l*z+p*X+v*q,S[F+1]=s*V+c*z+m*X+b*q,S[F+2]=o*V+u*z+y*X+x*q,S[F+3]=a*V+d*z+_*X+T*q}}function rut(t,e,r){ZJ(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function ZJ(t,e,r,i=4,n=i){if(t.length/i!=e.length/n)return void $8.error("source and destination buffers need to have the same number of elements");const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],d=r[5],p=r[6],m=r[7],y=r[8];let _=0,v=0;for(let b=0;b<s;b++){const x=e[_],T=e[_+1],S=e[_+2],A=e[_+3];t[v]=o*x+c*T+p*S,t[v+1]=a*x+u*T+m*S,t[v+2]=l*x+d*T+y*S,t[v+3]=A,_+=n,v+=i}}function iut(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*n,c=a*o,u=s[c],d=s[c+1],p=s[c+2],m=u*u+d*d+p*p;if(m>0){const y=1/Math.sqrt(m);i[l]=y*u,i[l+1]=y*d,i[l+2]=y*p}}}function nut(t,e,r){H5(t.typedBuffer,e,r,t.typedBufferStride)}function H5(t,e,r,i=4){const n=Math.min(t.length/i,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=r*s[a],t[l+1]=r*s[a+1],t[l+2]=r*s[a+2],t[l+3]=r*s[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:iut,scale:H5,scaleView:nut,transformMat3:ZJ,transformMat3View:rut,transformMat4:tut},Symbol.toStringTag,{value:"Module"}));function sut(t,e){QJ(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function QJ(t,e,r=2,i=r){const n=e.length/2;let s=0,o=0;if(ap(e)||yDe(e)){for(let l=0;l<n;++l)t[s]=e[o],t[s+1]=e[o+1],s+=r,o+=i;return}const a=_De(e);if(gDe(e))for(let l=0;l<n;++l)t[s]=Math.max(e[o]/a,-1),t[s+1]=Math.max(e[o+1]/a,-1),s+=r,o+=i;else for(let l=0;l<n;++l)t[s]=e[o]/a,t[s+1]=e[o+1]/a,s+=r,o+=i}function out(t,e,r,i){const n=t.typedBuffer,s=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=r,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:out,normalizeIntegerBuffer:QJ,normalizeIntegerBufferView:sut},Symbol.toStringTag,{value:"Module"}));function aut(t,e){iM(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function iM(t,e,r=3,i=r){const n=e.length/i;let s=0,o=0;for(let a=0;a<n;++a)t[s]=e[o],t[s+1]=e[o+1],t[s+2]=e[o+2],s+=r,o+=i}function lut(t,e,r,i,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=r,s[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:iM,copyView:aut,fill:lut},Symbol.toStringTag,{value:"Module"}));function cut(t,e){JJ(t.typedBuffer,e,t.typedBufferStride)}function JJ(t,e,r=4){const i=e.typedBuffer,n=e.typedBufferStride,s=e.count;let o=0,a=0;for(let l=0;l<s;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=n}function uut(t,e,r,i,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=(s==null?void 0:s.count)??t.count;let c=((s==null?void 0:s.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:JJ,copyView:cut,fill:uut},Symbol.toStringTag,{value:"Module"}));let _Ae=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return im(e)?(Bt(r),BX(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await kn(r,{responseType:hut[e]})).data;const n=await Ng(this._streamDataRequester.request(r,e,i));if(n.ok===!0)return n.value;throw Mw(n.error),new Y("",`Request for resource failed: ${n.error}`)}};const hut={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function dut(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function put(t,e={}){return{data:t,parameters:{wrap:{s:Pt.REPEAT,t:Pt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let eE=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new Y(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new eE(this.major,this.minor,this._context)}static parse(e,r=""){const[i,n]=e.split("."),s=/^\s*\d+\s*$/;if(!i||!i.match||!s.test(i))throw new Y((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n||!n.match||!s.test(n))throw new Y((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(n,10);return new eE(o,a,r)}};function KD(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:KD},Symbol.toStringTag,{value:"Module"}));let _le=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var wO,vle;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(wO||(wO={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(vle||(vle={}));const vAe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},fut={pbrMetallicRoughness:vAe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},mut={ESRI_externalColorMixMode:"tint"},ble=(t={})=>{const e={...vAe,...t.pbrMetallicRoughness},r=gut({...mut,...t.extras});return{...fut,...t,pbrMetallicRoughness:e,extras:r}};function gut(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const yut={magFilter:At.LINEAR,minFilter:At.LINEAR_MIPMAP_LINEAR,wrapS:Pt.REPEAT,wrapT:Pt.REPEAT},_ut=t=>({...yut,...t});function vut(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,n,s)=>(e=n||"",r=s||"","")),{dirPart:e,filePart:r}}const EI={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let but=class wy{constructor(e,r,i,n){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=vut(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new Y("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new Y("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new Y("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(im(r)){const o=Xb(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new wy(e,r,l)}catch{}const a=BX(r);if(wy._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new wy(e,r,o)}const n=await e.loadBinary(r,i);if(wy._isGLBData(n))return this._fromGLBData(e,r,n);const s=await e.loadJSON(r,i);return new wy(e,r,s)}static _isGLBData(e){if(e==null)return!1;const r=new _le(e);return r.remainingBytes()>=4&&r.readUint32()===EI.MAGIC}static async _fromGLBData(e,r,i){const n=await wy._parseGLBData(i);return new wy(e,r,n.json,n.binaryData)}static async _parseGLBData(e){const r=new _le(e);if(r.remainingBytes()<12)throw new Y("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),n=r.readUint32(),s=r.readUint32();if(i!==EI.MAGIC)throw new Y("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<s)throw new Y("gltf-loader-error","GLB binary data is smaller than header specifies.");if(n!==2)throw new Y("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==EI.CHUNK_TYPE_JSON)throw new Y("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new Y("gltf-loader-error","No JSON data found.");o=await Pct(r.readUint8Array(c))}else if(l===1){if(u!==EI.CHUNK_TYPE_BIN)throw new Y("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else J.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new Y("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new Y("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,r);if(n.byteLength!==i.byteLength)throw new Y("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,r){if(!this.json.accessors)throw new Y("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new Y("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[wO.MAT2,wO.MAT3,wO.MAT4])throw new Y("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const n=this.json.bufferViews[i.bufferView],s=await this.getBuffer(n.buffer,r),o=Tut[i.type],a=Sut[i.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case Qe.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case Qe.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case Qe.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case Qe.UNSIGNED_BYTE:return KD(this._wrapAccessor(kS,i));case Qe.UNSIGNED_SHORT:return KD(this._wrapAccessor(o8,i));case Qe.UNSIGNED_INT:return KD(this._wrapAccessor(l8,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new Y("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==Qe.FLOAT)throw new Y("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+Qe[i.componentType]);if(i.componentCount!==3)throw new Y("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(ds,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new Y("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==Qe.FLOAT)throw new Y("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+Qe[i.componentType]);if(i.componentCount!==3)throw new Y("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(ds,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new Y("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==Qe.FLOAT)throw new Y("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+Qe[i.componentType]);if(i.componentCount!==4)throw new Y("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new pp(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new Y("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new Y("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===Qe.FLOAT)return this._wrapAccessor(d1,i);if(!i.normalized)throw new Y("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return Eut(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new Y("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new Y("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===Qe.FLOAT)return this._wrapAccessor(pp,i);if(i.componentType===Qe.UNSIGNED_BYTE)return this._wrapAccessor(ya,i);if(i.componentType===Qe.UNSIGNED_SHORT)return this._wrapAccessor(DP,i)}else if(i.componentCount===3){if(i.componentType===Qe.FLOAT)return this._wrapAccessor(ds,i);if(i.componentType===Qe.UNSIGNED_BYTE)return this._wrapAccessor(s8,i);if(i.componentType===Qe.UNSIGNED_SHORT)return this._wrapAccessor(a8,i)}throw new Y("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+Qe[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var s,o,a,l,c,u,d,p,m,y;let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const _=e.material!=null?ble(this.json.materials[e.material]):ble(),v=_.pbrMetallicRoughness,b=this.hasVertexColors(e),x=this.getTexture(v.baseColorTexture,r),T=this.getTexture(_.normalTexture,r),S=i?this.getTexture(_.occlusionTexture,r):void 0,A=i?this.getTexture(_.emissiveTexture,r):void 0,C=i?this.getTexture(v.metallicRoughnessTexture,r):void 0,R=e.material!=null?e.material:-1;n={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:v.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await x,normalTexture:await T,name:_.name,id:R,occlusionTexture:await S,emissiveTexture:await A,emissiveFactor:_.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await C,hasVertexColors:b,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(s=v==null?void 0:v.baseColorTexture)==null?void 0:s.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(p=(d=_.emissiveTexture)==null?void 0:d.extensions)==null?void 0:p.KHR_texture_transform,metallicRoughnessTextureTransform:(y=(m=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:y.KHR_texture_transform}}return n}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new Y("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,n=this.json.textures[i],s=_ut(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(i,n,r);return Uge(this._textureCache,i,()=>{const c=d=>d===33071||d===33648||d===10497,u=d=>{throw new Y("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${d}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:u(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:u(s.wrapT),minFilter:s.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return wut;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?r=Vr(_e(),i,n.matrix):n.translation||n.rotation||n.scale?(r=RS(i),n.translation&&Ml(r,r,n.translation),n.rotation&&(CI[3]=yQ(CI,n.rotation),mc(r,r,CI[3],CI)),n.scale&&AP(r,r,n.scale)):r=RS(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return iu(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=eE.parse(this.json.asset.version,"glTF");xut.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new Y("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(r,i);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new Y("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),n=this.json.images[i];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),r);return new hAe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),r)}if(n.bufferView==null)throw new Y("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new Y("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,r);if(s.byteStride!=null)throw new Y("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return Mct(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await e4(Array.from(this._bufferLoaders.values())),r=await e4(Array.from(this._textureLoaders.values()));return e.reduce((i,n)=>i+((n==null?void 0:n.byteLength)??0),0)+r.reduce((i,n)=>i+(n?Ub(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const wut=cve(_e(),Math.PI/2),xut=new eE(2,0,"glTF"),CI=Au(),Tut={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Sut={[Qe.BYTE]:1,[Qe.UNSIGNED_BYTE]:1,[Qe.SHORT]:2,[Qe.UNSIGNED_SHORT]:2,[Qe.FLOAT]:4,[Qe.INT]:4,[Qe.UNSIGNED_INT]:4};function Eut(t){switch(t.componentType){case Qe.BYTE:return new c8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.UNSIGNED_BYTE:return new n8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.SHORT:return new NP(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.UNSIGNED_SHORT:return new fQ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.UNSIGNED_INT:return new mQ(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case Qe.FLOAT:return new d1(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let Cut=0;async function bAe(t,e,r={},i=!0){const n=await but.load(t,e,r),s="gltf_"+Cut++,o={lods:[],materials:new Map,textures:new Map,meta:Aut(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await Out(n,async(u,d,p,m)=>{const y=l.get(p)??0;l.set(p,y+1);const _=u.mode!==void 0?u.mode:Et.TRIANGLES,v=_===Et.TRIANGLES||_===Et.TRIANGLE_STRIP||_===Et.TRIANGLE_FAN?_:null;if(v==null)return void J.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Et[_]+"). Skipping primitive.");if(!n.hasPositions(u))return void J.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const b=n.getPositionData(u,r),x=n.getMaterial(u,r,i),T=n.hasNormals(u)?n.getNormalData(u,r):null,S=n.hasTangents(u)?n.getTangentData(u,r):null,A=n.hasTextureCoordinates(u)?n.getTextureCoordinates(u,r):null,C=n.hasVertexColors(u)?n.getVertexColors(u,r):null,R=n.getIndexData(u,r),P={transform:RS(d),attributes:{position:await b,normal:T?await T:null,texCoord0:A?await A:null,color:C?await C:null,tangent:S?await S:null},indices:await R,primitiveType:v,material:Put(o,await x,s)};let F=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(F=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:m,lodThreshold:F},o.lods[p].parts[y]=P});for(const u of o.lods)u.parts=u.parts.filter(d=>!!d);const c=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri},customMeta:{},size:c}}function Aut(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const n=i.extras;n!=null&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(r=n)}),r}async function Out(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,s=[];for(const a of i){const l=r.nodes[a];s.push(o(a,0)),Rut(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&J.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const d=r.meshes[c.mesh];for(const p of d.primitives)s.push(e(p,u,l,d.name))}for(const d of c.children||[])s.push(o(d,l))}await Promise.all(s)}function Rut(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function Put(t,e,r){const i=s=>{const o=`${r}_tex_${s&&s.id}${s&&s.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=put(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:Mut.includes(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=dut({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const Mut=[At.LINEAR_MIPMAP_LINEAR,At.LINEAR_MIPMAP_NEAREST];function $ut(t,e){switch(e){case Et.TRIANGLES:return Iut(t);case Et.TRIANGLE_STRIP:return Lut(t);case Et.TRIANGLE_FAN:return Dut(t)}}function Iut(t){return typeof t=="number"?zS(t):Jy(t)?new Uint16Array(t):t}function Lut(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=u5(3*r);if(typeof t=="number"){let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=s,i[n++]=s+1,i[n++]=s+2):(i[n++]=s+1,i[n++]=s,i[n++]=s+2)}else{let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=t[s],i[n++]=t[s+1],i[n++]=t[s+2]):(i[n++]=t[s+1],i[n++]=t[s],i[n++]=t[s+2])}return i}function Dut(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const n=t[0];let s=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=n,i[o++]=s,i[o++]=l,s=l}return i}let Nut=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},Fut=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new Nut,this.numberOfVertices=0}};const Gm=J.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function wAe(t,e){const r=await Uut(t,e),i=await Gut(r.textureDefinitions??{},e);let n=0;for(const s in i)if(i.hasOwnProperty(s)){const o=i[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:n+eEe(r)}}async function Uut(t,e){const r=e!=null&&e.streamDataRequester;if(r)return kut(t,r,e);const i=await Ng(kn(t,e));if(i.ok===!0)return i.value.data;Mw(i.error),xAe(i.error)}async function kut(t,e,r){const i=await Ng(e.request(t,"json",r));if(i.ok===!0)return i.value;Mw(i.error),xAe(i.error.details.url)}function xAe(t){throw new Y("",`Request for object resource failed: ${t}`)}function zut(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(Gm.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Gm.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Gm.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(Gm.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else Gm.warn("Indexed geometries must specify faces"),i=!1;break}default:Gm.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(Gm.warn("Geometry requires material"),i=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(Gm.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function But(t,e){var y;const r=new Array,i=new Array,n=new Array,s=new RE,o=t.resource,a=eE.parse(o.version||"1.0","wosr");Hut.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},d=t.textures;let p=0;const m=new Map;for(let _=0;_<c.length;_++){const v=c[_];if(!zut(v))continue;const b=jut(v),x=v.params.vertexAttributes,T=[];for(const z in x){const X=x[z],q=X.values;T.push([z,new Ue(q,X.valuesPerElement,!0)])}const S=[];if(v.params.topology!=="PerAttributeArray"){const z=v.params.faces;for(const X in z)S.push([X,z[X].values])}const A=b.texture,C=d&&d[A];if(C&&!m.has(A)){const{image:z,parameters:X}=C,q=new Hw(z,X);i.push(q),m.set(A,q)}const R=m.get(A),P=R?R.id:void 0,F=b.material;let k=s.get(F,A);if(k==null){const z=u[F.substring(F.lastIndexOf("/")+1)].params;z.transparency===1&&(z.transparency=0);const X=C&&C.alphaChannelUsage,q=z.transparency>0||X==="transparency"||X==="maskAndTransparency",G=C?TAe(C.alphaChannelUsage):void 0,Q={ambient:na(z.diffuse),diffuse:na(z.diffuse),opacity:1-(z.transparency||0),transparent:q,textureAlphaMode:G,textureAlphaCutoff:.33,textureId:P,initTextureTransparent:!0,doubleSided:!0,cullFace:ui.None,colorMixMode:z.externalColorMixMode||"tint",textureAlphaPremultiplied:(C==null?void 0:C.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParamsMixin&&Object.assign(Q,e.materialParamsMixin),k=new tm(Q),s.set(F,A,k)}n.push(k);const V=new Xn(k,T,S);p+=((y=S.find(z=>z[0]===E.POSITION))==null?void 0:y[1].length)??0,r.push(V)}return{engineResources:[{name:l,stageResources:{textures:i,materials:n,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:Vut(r)}}function Vut(t){const e=vi();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(Xf(e,i.bbMin),Xf(e,i.bbMax))}),e}async function Gut(t,e){const r=new Array;for(const s in t){const o=t[s],a=o.images[0].data;if(!a){Gm.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:Pt.REPEAT,t:Pt.REPEAT},preMultiplyAlpha:TAe(u)!==Gr.Opaque},p=e!=null&&e.disableTextures?Promise.resolve(null):qg(l,e);r.push(p.then(m=>({refId:c,image:m,parameters:d,alphaChannelUsage:u})))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}function TAe(t){switch(t){case"mask":return Gr.Mask;case"maskAndTransparency":return Gr.MaskBlend;case"none":return Gr.Opaque;default:return Gr.Blend}}function jut(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const Hut=new eE(1,2,"wosr"),Mx=2.1;async function SAe(t,e){var d;const r=EAe(uW(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):wAe(r.url,e)),{engineResources:m,referenceBoundingBox:y}=But(p,e);return{lods:m,referenceBoundingBox:y,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):bAe(new _Ae(e.streamDataRequester),r.url,e,e.usePBR)),n=(d=i.model.meta)==null?void 0:d.ESRI_proxyEllipsoid,s=i.meta.isEsriSymbolResource&&n!=null&&i.meta.uri.includes("/RealisticTrees/");s&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,Yut(i,n));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[...kot]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...z8]},l={...e.materialParamsMixin,treeRendering:s},{engineResources:c,referenceBoundingBox:u}=CAe(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function EAe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function CAe(t,e,r,i){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=vi();return n.lods.forEach((u,d)=>{const p=i.skipHighLods===!0&&(l>1&&d===0||l>3&&d===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&d!==i.singleLodIndex;if(p&&d!==0)return;const m=new Fut(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(y=>{const _=p?new tm({}):Wut(n,y,m,e,r,o,a),{geometry:v,vertexCount:b}=qut(y,_??new tm({})),x=v.boundingInfo;x!=null&&d===0&&(Xf(c,x.bbMin),Xf(c,x.bbMax)),_!=null&&(m.stageResources.geometries.push(v),m.numberOfVertices+=b)}),p||s.push(m)}),{engineResources:s,referenceBoundingBox:c}}function Wut(t,e,r,i,n,s,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const d=Xut(l.alphaMode);if(!s.has(a)){if(c){const A=(C,R=!1)=>{if(C!=null&&!o.has(C)){const P=t.textures.get(C);if(P!=null){const F=P.data;o.set(C,new Hw(Ub(F)?F.data:F,{...P.parameters,preMultiplyAlpha:!Ub(F)&&R,encoding:Ub(F)&&F.encoding!=null?F.encoding:void 0}))}}};A(l.textureColor,d!==Gr.Opaque),A(l.textureNormal),A(l.textureOcclusion),A(l.textureEmissive),A(l.textureMetallicRoughness)}const m=l.color[0]**(1/Mx),y=l.color[1]**(1/Mx),_=l.color[2]**(1/Mx),v=l.emissiveFactor[0]**(1/Mx),b=l.emissiveFactor[1]**(1/Mx),x=l.emissiveFactor[2]**(1/Mx),T=l.textureColor!=null&&c?o.get(l.textureColor):null,S=g3e({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});s.set(a,new tm({...i,transparent:d===Gr.Blend,customDepthTest:uw.Lequal,textureAlphaMode:d,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,y,_],ambient:[m,y,_],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?ui.None:ui.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?br.Attribute:br.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:T!=null?T.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:T!=null&&!!T.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[v,b,x],mrrFactors:S?[...jJ]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:Ef(l.colorTextureTransform),normalTextureTransformMatrix:Ef(l.normalTextureTransform),occlusionTextureTransformMatrix:Ef(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Ef(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Ef(l.metallicRoughnessTextureTransform),...n}))}const p=s.get(a);if(r.stageResources.materials.push(p),c){const m=y=>{y!=null&&r.stageResources.textures.push(o.get(y))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return p}function qut(t,e){const r=t.attributes.position.count,i=$ut(t.indices||r,t.primitiveType),n=Yi(3*r),{typedBuffer:s,typedBufferStride:o}=t.attributes.position;gp(n,s,t.transform,3,o);const a=[[E.POSITION,new Ue(n,3,!0)]],l=[[E.POSITION,i]];if(t.attributes.normal!=null){const c=Yi(3*r),{typedBuffer:u,typedBufferStride:d}=t.attributes.normal;Qf(AI,t.transform),yp(c,u,AI,3,d),a.push([E.NORMAL,new Ue(c,3,!0)]),l.push([E.NORMAL,i])}if(t.attributes.tangent!=null){const c=Yi(4*r),{typedBuffer:u,typedBufferStride:d}=t.attributes.tangent;Qf(AI,t.transform),ZJ(c,u,AI,4,d),a.push([E.TANGENT,new Ue(c,4,!0)]),l.push([E.TANGENT,i])}if(t.attributes.texCoord0!=null){const c=Yi(2*r),{typedBuffer:u,typedBufferStride:d}=t.attributes.texCoord0;QJ(c,u,2,d),a.push([E.UV0,new Ue(c,2,!0)]),l.push([E.UV0,i])}if(t.attributes.color!=null){const c=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof pp?H5(c,t.attributes.color,255):t.attributes.color instanceof ya?JJ(c,t.attributes.color):t.attributes.color instanceof DP&&H5(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof ds?D5(c,t.attributes.color,255,4):t.attributes.color instanceof s8?iM(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof a8&&D5(c,t.attributes.color,1/256,4)),a.push([E.COLOR,new Ue(c,4,!0)]),l.push([E.COLOR,i])}return{geometry:new Xn(e,a,l),vertexCount:r}}const AI=hi();function Xut(t){switch(t){case"BLEND":return Gr.Blend;case"MASK":return Gr.Mask;case"OPAQUE":case null:case void 0:return Gr.Opaque}}function Yut(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const n of i.parts){const s=n.attributes.normal;if(s==null)return;const o=n.attributes.position,a=o.count,l=O(),c=O(),u=O(),d=new Uint8Array(4*a),p=new Float64Array(3*a),m=us(_e(),n.transform);let y=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),s.getVec(v,l),De(c,c,n.transform),ae(u,c,e.center),v4(u,u,e.radius);const b=u[2],x=Te(u),T=Math.min(.45+.55*x*x,1);v4(u,u,e.radius),m!==null&&De(u,u,m),me(u,u),r+1!==t.model.lods.length&&t.model.lods.length>1&&Lr(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p[y]=u[0],p[y+1]=u[1],p[y+2]=u[2],y+=3,d[_]=255*T,d[_+1]=255*T,d[_+2]=255*T,d[_+3]=255,_+=4}n.attributes.normal=new ds(p),n.attributes.color=new ya(d)}}}const v4t=Object.freeze(Object.defineProperty({__proto__:null,fetch:SAe,gltfToEngineResources:CAe,parseUrl:EAe},Symbol.toStringTag,{value:"Module"})),Zut=()=>!!se("enable-feature:force-wosr"),b4t=()=>!!se("enable-feature:direct-3d-object-feature-layer-display"),Qut=()=>se.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),Jut=()=>se.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),w4t=()=>!!se("enable-i3s-patching"),Kut=()=>se.add("enable-i3s-patching",!0,!0,!0),eht=()=>se.add("enable-i3s-patching",!1,!0,!0),x4t=()=>!!se("enable-feature:SceneLayer-editing"),tht=(t="i3s-patching")=>{switch(eht(),Jut(),se.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":Qut();break;case"i3s-patching":Kut()}};tht("i3s-patching");let gz={};async function rht(t,e){try{return{data:(await KJ(t,e)).data,baseUrl:o6(t),styleUrl:t}}catch(r){return Mw(r),null}}function iht(t,e,r){const i=e.portal!=null?e.portal:Mh.getDefault();let n;const s=`${i.url} - ${i.user&&i.user.username} - ${t}`;return gz[s]||(gz[s]=nht(t,i,r).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),gz[s]}function nht(t,e,r){return e.load(r).then(()=>{const i=new bf({disableExtraQuery:!0,query:`owner:${wle} AND type:${xle} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let n=null;const s=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===xle&&a.owner===wle){n=a;break}}if(!n)throw new Y("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(r)})}function AAe(t,e,r){return t&&t.styleUrl!=null?rht(t.styleUrl,r):t&&t.styleName!=null?iht(t.styleName,e,r):Promise.reject(new Y("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function OAe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function RAe(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!Zut())for(const i of r){const n=t.formatInfos.find(s=>s.type===i);if(n)return n.href}return t.webRef}function KJ(t,e){const r={responseType:"json",query:{f:"json"},...e};return kn(_g(t),r)}const wle="esri_en",xle="Style",sht="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",LC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function oht(t,e=LC){var a,l;if(!t)return{symbol:null};const{retainId:r=LC.retainId,ignoreDrivers:i=LC.ignoreDrivers,hasLabelingContext:n=LC.hasLabelingContext,retainCIM:s=LC.retainCIM}=e;let o=null;if(ow(t)||t instanceof bE)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new Y("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():n_.fromCIMSymbol(t)}else if(t instanceof Lw)o=E6.fromSimpleLineSymbol(t);else if(t instanceof A6)o=n_.fromSimpleMarkerSymbol(t);else if(t instanceof C6)o=n_.fromPictureMarkerSymbol(t);else if(t instanceof nZ)o=e.geometryType&&e.geometryType==="mesh"?vE.fromSimpleFillSymbol(t):SP.fromSimpleFillSymbol(t);else{if(!(t instanceof EP))return{error:new Y("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?S6.fromTextSymbol(t):n_.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&ow(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function W5(t,e,r,i){const n=PAe(t,{},{context:i,isLabelSymbol:!1});n!=null&&(e[r]=n)}function T4t(t,e,r,i){const n=PAe(t,{},{context:i,isLabelSymbol:!0});n!=null&&(e[r]=n)}function Tle(t){return t instanceof _E||t instanceof bE}function PAe(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:n}=r,s=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(s==="web-scene"&&!Tle(t)){const a=oht(t,{retainCIM:!0,hasLabelingContext:n});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new Y("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!PFe(i==null?void 0:i.layer))&&Tle(t)?(o==null||o.push(new Y("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function MAe(t,e){return Eze(t,null,e)}function aht(t,e,r,i){const n=t.name;return n==null?Promise.reject(new Y("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?lht(n,e,i):AAe(t,e,i).then(s=>tK(sc(s),n,e,r,RAe,i))}function eK(t,e){return e.items.find(r=>r.name===t)}function tK(t,e,r,i,n,s){var m;const o=r&&r.portal!=null?r.portal:Mh.getDefault(),a={portal:o,url:Ja(t.baseUrl),origin:"portal-item"},l=eK(e,t.data);if(!l){const y=`The symbol name '${e}' could not be found`;return Promise.reject(new Y("symbolstyleutils:symbol-name-not-found",y,{symbolName:e}))}let c=nw(n(l,i),a),u=((m=l.thumbnail)==null?void 0:m.href)??null;const d=l.thumbnail&&l.thumbnail.imageData;Kct()&&(c=uW(c)??"",u=uW(u));const p={portal:o,url:Ja(o6(c)),origin:"portal-item"};return KJ(c,s).then(y=>{const _=i==="cimRef"?OAe(y.data):y.data,v=MAe(_,p);if(v&&ow(v)){if(u){const b=nw(u,a);v.thumbnail=new Ob({url:b})}else d&&(v.thumbnail=new Ob({url:`data:image/png;base64,${d}`}));t.styleUrl?v.styleOrigin=new cR({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(v.styleOrigin=new cR({portal:r.portal,styleName:t.styleName,name:e}))}return v})}function lht(t,e,r){const i=sht.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:Mh.getDefault();return KJ(i,r).then(s=>{const o=OAe(s.data);return MAe(o,{portal:n,url:Ja(o6(i)),origin:"portal-item"})})}const cht=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:tK,getStyleItemFromStyle:eK,resolveWebStyleSymbol:aht},Symbol.toStringTag,{value:"Module"}));async function uht(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new Y("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await AAe(t,r).catch(()=>null);if(i===null)return null;const n=eK(e,i.data);if(n&&!((a=n.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const s=await tK(i,e,r,"webRef",(l,c)=>RAe(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(s===null||s.type!=="point-3d")return null;const o=s.symbolLayers.items[0];return o.type==="object"?o.resource:null}let hht=class{constructor(e,r,i){this._elementSize=r,this._buffer=Ar.createVertex(e,gr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,n=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,n)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},dht=class{constructor(e){this.modelOriginHi=e.getField(E.MODELORIGINHI,ds),this.modelOriginLo=e.getField(E.MODELORIGINLO,ds),this.model=e.getField(E.MODEL,q_),this.modelNormal=e.getField(E.MODELNORMAL,q_),this.featureAttribute=e.getField(E.INSTANCEFEATUREATTRIBUTE,pp),this.color=e.getField(E.INSTANCECOLOR,ya),this.objectAndLayerIdColor=e.getField(E.INSTANCEOBJECTANDLAYERIDCOLOR,ya)}},Sle=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){Je(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Je(this._updating,"not updating"),this.size<oDe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Je(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),Je(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Je(this._updating,"not updating"),Je(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(q5,Math.floor(this._capacity*jF));this._resize(e)}_shrink(){const e=Math.max(q5,Math.floor(this._capacity*sDe));this._resize(e)}_resize(e){if(Je(this._updating,"not updating"),e===this._capacity)return;const r=new hht(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,n=this._compactInstances(r);Je(n===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new dht(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const q5=64;var Ai;function pht(t){let e=Gi().mat4f64(E.LOCALTRANSFORM).mat4f64(E.GLOBALTRANSFORM).vec4f64(E.BOUNDINGSPHERE).vec3f64(E.MODELORIGIN).mat3f(E.MODEL).mat3f(E.MODELNORMAL).vec2f(E.MODELSCALEFACTORS);return t.includes(E.FEATUREATTRIBUTE)&&(e=e.vec4f(E.FEATUREATTRIBUTE)),t.includes(E.COLOR)&&(e=e.vec4u8(E.COLOR)),t.includes(E.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(E.OBJECTANDLAYERIDCOLOR)),e=e.u8(E.STATE).u8(E.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Ai||(Ai={}));let Ele=class{constructor(e){this.localTransform=e.getField(E.LOCALTRANSFORM,SR),this.globalTransform=e.getField(E.GLOBALTRANSFORM,SR),this.modelOrigin=e.getField(E.MODELORIGIN,kh),this.model=e.getField(E.MODEL,q_),this.modelNormal=e.getField(E.MODELNORMAL,q_),this.modelScaleFactors=e.getField(E.MODELSCALEFACTORS,d1),this.boundingSphere=e.getField(E.BOUNDINGSPHERE,i8),this.featureAttribute=e.getField(E.FEATUREATTRIBUTE,pp),this.color=e.getField(E.COLOR,ya),this.objectAndLayerIdColor=e.getField(E.OBJECTANDLAYERIDCOLOR,ya),this.state=e.getField(E.STATE,kS),this.lodLevel=e.getField(E.LODLEVEL,kS)}},M2=class extends xe{constructor(e,r){super(e),this.events=new Bn,this._capacity=0,this._size=0,this._next=0,this._layout=pht(r),this._capacity=q5,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Ele(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Ai.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;Je(e>=0&&e<this._capacity&&(r.get(e)&Ai.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Ai.ACTIVE)?this._setStateFlags(e,Ai.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;Je(e>=0&&e<this._capacity&&(r.get(e)&Ai.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=Bl,n=id;r.localTransform.getMat(e,Cle),r.globalTransform.getMat(e,yz);const s=Vr(yz,yz,Cle);ne(i,s[12],s[13],s[14]),r.modelOrigin.setVec(e,i),Ac(n,s),r.model.setMat(e,n);const o=PVe(Bl,s);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),Vw(n,n),Uh(n,n),r.modelNormal.setMat(e,n),this._setStateFlags(e,Ai.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,id),i.modelOrigin.getVec(e,Bl),r[0]=id[0],r[1]=id[1],r[2]=id[2],r[3]=0,r[4]=id[3],r[5]=id[4],r[6]=id[5],r[7]=0,r[8]=id[6],r[9]=id[7],r[10]=id[8],r[11]=0,r[12]=Bl[0],r[13]=Bl[1],r[14]=Bl[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Bl,this,e),r*=Math.max(Bl[0],Bl[1],Bl[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Bl,this,e),r*=fht(Bl[0],Bl[1],Bl[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Ai.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Ai.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Ai.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Ai.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(q5,Math.floor(this._capacity*jF)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Ele(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Ai.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function fht(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}h([f({constructOnly:!0})],M2.prototype,"shaderTransformation",void 0),h([f()],M2.prototype,"_size",void 0),h([f({readOnly:!0})],M2.prototype,"size",null),M2=h([N("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],M2);const Bl=O(),id=hi(),Cle=_e(),yz=_e();let mht=class extends Xd{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=vn(),this._tmpMat4=_e()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);De(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*MS(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},ght=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const n=i.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*r/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},yht=class extends u8{constructor(e,r,i,n,s,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function rK(t){return bp(t)&&t.intersector===Ui.LOD&&!!t.target}let _ht=class{constructor(e,r){const i=e.renderContext.rctx,n=r.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=o.createBuffer(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new WCe(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Ar.createVertex(i,gr.STATIC_DRAW,l.buffer),this.vao=new vp(i,fr,{geometry:Mc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,n,(u,d,p,m,y)=>{if(u>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,u))return;const _=new yht(o.layerUid,o.graphicUid(s),c,p,a,l);if((e.results.min.drapedLayerOrder==null||y>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Ui.LOD,_,u,d,e.transform.transform,y),e.options.store!==To.MIN&&(e.results.max.drapedLayerOrder==null||y>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Ui.LOD,_,u,d,e.transform.transform,y),e.options.store===To.ALL){const v=SQ(e.results.min.ray);v.set(Ui.LOD,_,u,d,e.transform.transform,y),e.results.all.push(v)}}})}},vht=class $Ae{static async create(e,r,i){const n=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new _ht(e,o),i))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(aP);if(ss(i)||s.length!==n.length){s.forEach(o=>o.destroy()),Bt(i);for(const o of n)if(o.status==="rejected")throw o.reason}return new $Ae(r.minScreenSpaceRadius,s)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,n,s,o,a){this.components.forEach(l=>l.intersect(e,r,i,n,s,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=vi();this.components.forEach(r=>{r.boundingInfo!=null&&(Xf(e,r.boundingInfo.bbMin),Xf(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=O();jd(e,r),this._boundingSphere={center:r,radius:.5*S1e(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const bht=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new ght(e,r)};let Zu=class extends xe{constructor(e,r){super(e),this.type=Ui.LOD,this.isGround=!1,this._handles=new Vi,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new lt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[le.OPAQUE_MATERIAL,le.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new M2({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(r.registerTask(dt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=xht(this.optionalFields),this._glInstanceBufferLayout=Mc(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(r=>r.forEach(i=>{e.cpu+=i.memoryUsage.cpu,e.gpu+=i.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,o=i.triangleCount;r.push({renderedInstances:s,renderedTriangles:s*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,n)=>i+n.renderedInstances,0),renderedTriangles:r.reduce((i,n)=>i+n.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new Sle(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new Sle(i,this._instanceBufferLayout)),vht.create(e,o,r)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(aP);if(ss(r)||s.length!==n.length){s.forEach(o=>o.destroy()),Bt(r);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=bht(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(le.TRANSPARENT_MATERIAL,D.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!Kr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Wa),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(n=>this.levels.forEach((s,o)=>{s.components.forEach(a=>i.push(this._beginComponent(e,n[o],a)))})),i}render(e,r){const i=this._getInstanceDatas(e.output);if(!i)return;let n=0;e.rctx.bindVAO(),i.forEach(s=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[n++],s[a],l,a))}))}_getInstanceDatas(e){const r=e!==D.Highlight&&e!==D.ShadowHighlight,i=e!==D.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,n){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=O();ae(s,n,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,Rle),e.transform.set(Rle),De(Ple,i,e.transform.inverse),De(Mle,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;Je((l&Ai.ACTIVE)!=0,"invalid instance state"),Je(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,r,Ple,Mle,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,s,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new mht(r,this.baseBoundingSphere);for(let n=0;n<r.capacity;++n)i.get(n)&Ai.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Me(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Xd.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(r,Xd.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,kp),ae(kp,kp,s);const a=fe(kp,r)-kp[3];o.boundingSphere.getVec(n,kp),ae(kp,kp,s);const l=fe(kp,r)+kp[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:n}=this;this._allRenderInstanceData.forEach(u=>u.forEach(d=>d.beginUpdate()));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;for(let u=0;u<a&&!e.done;++u){c===this._cycleStartIndex&&this._startUpdateCycle();const d=o.state.get(c);let p=0;if(!(d&Ai.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(d&Ai.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][m].freeTail(),d&Ai.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][m].freeTail(),d&Ai.REMOVE)s.freeInstance(c);else if(d&Ai.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,Ole),y=n.selectLevel(Ole,s.getCombinedMedianScaleFactor(c),i)),p=d&~(Ai.ACTIVE|Ai.TRANSFORM_CHANGED),y>=0&&(d&Ai.HIGHLIGHT?(Ale(this._highlightRenderInstanceData[0][y],o,c),p|=Ai.HIGHLIGHT_ACTIVE):(Ale(this._defaultRenderInstanceData[0][y],o,c),p|=Ai.DEFAULT_ACTIVE)),o.state.set(c,p),o.lodLevel.set(c,y)}else p=d&~(Ai.ACTIVE|Ai.TRANSFORM_CHANGED),o.state.set(c,p);if(this._octreeCached!=null){const y=!!(d&Ai.ACTIVE),_=!!(p&Ai.ACTIVE);!y&&_?this._octreeCached.addInstance(c):y&&!_?this._octreeCached.removeInstance(c):y&&_&&d&Ai.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(u=>u.forEach(d=>d.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){const{bindParameters:n,rctx:s,output:o}=e;if(r.size===0||!i.material.requiresSlot(n.slot,e.output))return null;const a=i.glMaterials.load(s,n.slot,o);return a!=null?a.beginSlot(n):null}_renderComponent(e,r,i,n,s){var v;if(!r)return;const{bindParameters:o,rctx:a}=e;(v=a.appleAmdDriverHelper)==null||v.resetIndicesType();const l=a.bindTechnique(r,n.material.parameters,o);a.bindVAO(n.vao),r.ensureAttributeLocations(n.vao),l.bindDraw(Tht,o,n.material.parameters),Kr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===D.Color&&(l.setUniform4fv("externalColor",$le[Math.min(s,$le.length-1)]),l.setUniform1i("colorMixMode",mSe.replace));const c=a.capabilities.instancing,u=i.capacity,d=i.headIndex,p=i.tailIndex,m=i.firstIndex,y=this._glInstanceBufferLayout,_=(b,x)=>{jZ(a,fr,i.buffer,y,b),c.drawArraysInstanced(r.primitiveType,0,n.vertexCount,x-b),HZ(a,fr,i.buffer,y)};n.material.parameters.transparent&&m!=null?d>p?(Je(m>=p&&m<=d,"invalid firstIndex"),_(m,d),_(p,m)):d<p&&(m<=d?(Je(m>=0&&m<=d,"invalid firstIndex"),_(m,d),_(p,u),_(0,m)):(Je(m>=p&&m<=u,"invalid firstIndex"),_(m,u),_(0,d),_(p,m))):d>p?_(p,d):d<p&&(_(0,d),_(p,u)),a.bindVAO(null)}};function Ale(t,e,r){const i=t.allocateHead();wht(e,r,t.view,i)}function wht(t,e,r,i){dXe(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function xht(t){let e=Gi().vec3f(E.MODELORIGINHI).vec3f(E.MODELORIGINLO).mat3f(E.MODEL).mat3f(E.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(E.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(E.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(E.INSTANCEOBJECTANDLAYERIDCOLOR)),e}h([f({constructOnly:!0})],Zu.prototype,"symbol",void 0),h([f({constructOnly:!0})],Zu.prototype,"optionalFields",void 0),h([f({constructOnly:!0})],Zu.prototype,"metadata",void 0),h([f({constructOnly:!0})],Zu.prototype,"shaderTransformation",void 0),h([f()],Zu.prototype,"_instanceData",void 0),h([f()],Zu.prototype,"_cycleStartIndex",void 0),h([f({readOnly:!0})],Zu.prototype,"_enableLevelSelection",null),h([f()],Zu.prototype,"_updateCyclesWithStaticCamera",void 0),h([f({readOnly:!0})],Zu.prototype,"running",null),Zu=h([N("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Zu);const Ole=O(),kp=Qt(),Rle=_e(),Ple=O(),Mle=O(),$le=[$t(1,0,1,1),$t(0,0,1,1),$t(0,1,0,1),$t(1,1,0,1),$t(1,0,0,1)],Tht=new tat;let Ile=class{constructor(e,r,i,n,s,o,a,l,c,u,d,p){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=d,this.pivotOffset=p}},Sht=class extends hm{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,n){super(e,r,i,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&R8(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&_it(r.primitive)?r.primitive:N1e;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await uht(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}_setMaterialTransparencyParams(e,r=(n=>(n=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:n.color)()){const s=this._getCombinedOpacity(r),o=s<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=s,e.cullFace=o?ui.None:ui.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,n=ps(ize(e)),s=na(YM(n)),o=na(dk(s,i)),a=Te(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...jJ],ambient:pg,diffuse:pg,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},d=!!u.usePBR;this._setMaterialTransparencyParams(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:x,minWorldLength:T,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:ha(x),minWorldLength:T||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=mh;else{const x=i.material!=null?i.material.color:null,T=x!=null?it.toUnitRGBA(x):mh;u.externalColor=T}this._fastUpdates=qS(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),se("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const m=new tm(u),y=FEe(e,m);if(!y)throw new Error(`Unknown object symbol primitive: ${e}`);const _=sI(y).map(x=>({opacity:1,transparent:x.parameters.transparent})),v=await this._createStageResources(y,d,r),b=await this._createLodRenderer(y,r);return new Ile(y,b,v,_,s,l,c,n,o,a,d,null)}async _createResourcesForUrl(e,r){var k,V;const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=qS(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(E.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(E.COLOR)),se("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(E.OBJECTANDLAYERIDCOLOR);const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:z,minWorldLength:X,maxWorldLength:q}=n.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:ha(z),minWorldLength:X||0,maxWorldLength:q??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const s=i.usePBR,o=await SAe(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=Jct(o.lods);c.levels.sort((z,X)=>z.minScreenSpaceRadius-X.minScreenSpaceRadius);const u=this._context,d=this.symbolLayer.material,p=this._getExternalColorParameters(d),m=(V=(k=this.symbolLayer)==null?void 0:k.material)==null?void 0:V.color,y=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=sI(c),b=sI(c).map(z=>({opacity:z.parameters.opacity||1,transparent:z.parameters.transparent}));v.forEach(z=>{const X=z.parameters;z.setParameters(p);const q=X.opacity*y,G=q<1||_||X.transparent;z.setParameters({opacity:q,transparent:G}),u.screenSizePerspectiveEnabled&&z.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const x=o.referenceBoundingBox,T=na(YM(x)),S=na(c.levels[0].pivotOffset),A=na(dk(T,this.symbolLayer)),C=Te(A),R=this._fastUpdates;XS(R,this._context.renderer,this._fastVisualVariableConvertOptions(x,A,T,S))&&v.forEach(z=>z.setParameters(R.materialParameters));const P=await this._createStageResources(c,s,r),F=await this._createLodRenderer(c,r);return new Ile(c,F,P,b,T,a,l,x,A,C,s,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const n=this._context.stage,s=sI(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=Noe(e);n.addMany(o),this._addDisposeResource(()=>n.removeMany(o)),await n.load(o,i),Bt(i);const a=Foe(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},s=this._fastUpdates,o=s?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,OI),In(u,FH(s.materialParameters,OI,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,OI),Ptt(l,s.materialParameters,OI)}}:null,a=new Zu({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=mh:e!=null&&e.color!=null?r.externalColor=it.toUnitRGBA(e.color):(r.externalColor=mh,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=DR(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const n=this.setGraphicElevationContext(r,new wp),s=e.renderingInfo;return this._createAs3DShape(r,i,s,n,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var s,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:o.color,u=n[a],d=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*u.opacity,p=d<1||e||u.transparent;l.setParameters({opacity:d,transparent:p}),this._isPrimitive&&l.setParameters({cullFace:p?ui.None:ui.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,K_)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return $n.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!XS(this._fastUpdates,r,this._fastVisualVariableConvertOptions(s,o,a,l)))return $n.RecreateSymbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return $n.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=NEe(e.levels[0]).reduce((s,o)=>s+o.indices.get(E.POSITION).length,0)/3,i=s=>Array.from(s.vertexAttributes.values()).reduce((o,a)=>o+Ky(a.data),0)+Array.from(s.indices.values()).reduce((o,a)=>o+Ky(a),0),n=Noe(e).reduce((s,o)=>s+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+Foe(e).reduce((s,o)=>s+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...zEe(this.symbol,this.symbolLayer),resourceBytes:n}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,n,s,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(Bi(r,$x,this._context.elevationProvider.spatialReference),l!=null&&!YY(l,$x))return null;const c=this._requiresTerrainElevation(n),u=this._computeGlobalTransform(r,n,_z,RI),d=this._computeLocalTransform(this._resources,this.symbolLayer,i,Lle),p=this._resources.lodRenderer.instanceData,m=p.addInstance();this._instanceIndexToGraphicUid.set(m,s),p.setLocalTransform(m,d,!1),p.setGlobalTransform(m,u),a&&p.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(m,dO(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const y=new Yct(this,m,nit,n);return c&&(y.alignedSampledElevation=RI.sampledElevation),y.needsElevationUpdates=K_(n.mode),LR(y,r,this._context.elevationProvider),y}_computeGlobalTransform(e,r,i,n){return J_(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,n),$x[0]=e.x,$x[1]=e.y,$x[2]=n.z,ma(e.spatialReference,$x,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,n){return Nh(n),this._applyObjectRotation(i,!1,n),this._applyObjectRotation(r,!0,n),this._applyObjectScale(e,i,n),this._applyAnchor(e,r,n),n}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const n=this._drivenProperties.size&&r.size?r.size:e.symbolSize,s=Loe(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||AP(i,i,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&DR(r);if(i==null)return!1;const n=this.getGeometryElevationMode(r);return e.elevationContext.mode===n&&(this._computeGlobalTransform(i,e.elevationContext,_z,RI),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=RI.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,_z,!0),LR(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(y,_,v)=>(y!=null&&y.type==="complete"?y.newValue:_)??v,n=i(r.heading,this.symbolLayer.heading,0),s=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),d=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:n,tilt:s,roll:o,anchor:u,anchorPosition:d},m=this._resources;this.loadStatus===eu.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=na(dk(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((y,_)=>{const v=this._computeLocalTransform(m,p,_,Lle),b=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const n=i.color.newValue,s=n!=null?it.toUnitRGBA(n):mh;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParams({},n)):l=this._setMaterialTransparencyParams({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var n;if(!((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)||!r)return qrt(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const n=O();switch(i.anchor){case"center":re(n,jd(e)),fa(n,n);break;case"top":{const s=jd(e);ne(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=jd(e);ne(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=jd(e),o=YM(e),a=i.anchorPosition,l=a?Se(a.x,a.y,a.z):Zs;c6(n,o,l),oe(n,n,s),fa(n,n);break}default:r!=null?fa(n,r):re(n,Zs)}return n}_applyAnchor(e,r,i){var s;if((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);n&&Ml(i,i,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,n){const s=e!=null?na(YM(e)):pg,o=e!=null?this._computeAnchor(e,n,this.symbolLayer):Zs,a=this._context.renderCoordsHelper.unitInMeters,l=Loe(r??void 0,r,i,a),c=Se(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new jP({size:!0,color:!0,rotation:!0,opacity:!1},s,r??pg,a,o,l,c)}};const $x=O(),Lle=_e(),_z=_e(),OI=Qt(),RI=new qP;let Eht=class{constructor(e,r,i,n){this.vertices=e,this.positionsES=r,this.offset=n;const s=e.length,o=Math.floor(s/2),a=this.offset+3*o,l=i[a],c=i[a+1],u=i[a+2];this.origin=Se(l,c,u),this.positions=Yi(3*s);const d=this.offset+3*s;for(let p=this.offset;p<d;p+=3)this.positions[p]=i[p]-l,this.positions[p+1]=i[p+1]-c,this.positions[p+2]=i[p+2]-u;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const n=this.positions;r.vRight[0]=n[i+3]-n[i],r.vRight[1]=n[i+4]-n[i+1],r.vRight[2]=n[i+5]-n[i+2],i+=3;let s=Te(r.vRight);r.vMinSiblingLength=s,me(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=n[i+3]-n[i],l.vRight[1]=n[i+4]-n[i+1],l.vRight[2]=n[i+5]-n[i+2];const c=Te(l.vRight);l.vMinSiblingLength=Math.min(s,c),s=c,me(l.vRight,l.vRight)}else re(l.vRight,l.vLeft),l.vMinSiblingLength=s;o=l,i+=3}}},Cht=class{constructor(e,r,i,n,s,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=n,this.endCap=s,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=iXe(1*this.numVerticesTotal),this.profileRightAxes=Yi(4*this.numVerticesTotal),this.profileUpAxes=Yi(4*this.numVerticesTotal),this.profileVertexAndNormals=Yi(4*this.numVerticesTotal),this.positions=c5(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,n,s){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=n[0],this.profileVertexAndNormals[o+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,n,s,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=s,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=c5(e,r,3*i.length);let n=0;const s=(a,l,c,u,d)=>this.emitCapVertex(n,a,l,c,u,d),o=(a,l,c,u)=>this.emitVertex(n,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(i[n],this.profile,s),n=1;n<i.length-1;++n)this.extruder.extrude(i[n],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[n],this.profile,s),n=0,this.startCap.rebuildCapGeometry(i[n],s),n=i.length-1,this.endCap.rebuildCapGeometry(i[n],s)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let n=3*(2*(r*i));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.numIndices,this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,u,d)=>{s.push(c),s.push(u),s.push(d),o.push(c),o.push(u),o.push(d),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[d])};for(let c=0;c<r;++c){const u=this.profile.indices[2*c],d=this.profile.indices[2*c+1];for(let p=0;p<i;++p){const m=p*e+u,y=(p+1)*e+d,_=p*e+d;l(m,(p+1)*e+u,y),l(m,y,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=zf(s),this.normalIndices=zf(o),this.pathVertexIndices=zf(a)}onPathChanged(){this._rebuildGeometry()}},iK=class{rebuildConnectingProfileGeometry(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],0,0)}},Dle=class extends iK{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},PI=class extends iK{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const n=this.profilePlaneOffset;for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],n,0)}rebuildCapGeometry(e,r){const i=this.profile,n=this.flip?1:-1,s=this.profilePlaneOffset,o=IAe;er(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,s,n)}buildTopology(e,r){const i=this.profile,n=this.vertexBufferStart+i.indices[0];for(let s=1;s<i.numSegments;++s){const o=i.indices[2*s],a=i.indices[2*s+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,n):r(n,l,c)}}},Nle=class extends iK{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const n=r.indices[2*i],s=r.indices[2*i+1];r.poleIndices[n]===r.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,n=e.frame,s=.5*this.sign,o=Aht,a=IAe;er(a,0,0);for(const l of i.poles)l.normal?r(n,l.position,l.normal,s,0):r(n,l.position,a,s,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(n,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),d=Math.cos(c);for(let p=0;p<i.vertices.length;++p){const m=i.poles[i.poleIndices[p]];Tf(o,i.vertices[p],m.position),dc(o,o,u),m.normal?(Ld(o,o,m.position),r(n,o,m.normal,s*d,0)):(wR(a,o),dc(a,a,u),Ld(o,o,m.position),r(n,o,a,s*d,this.sign*d))}}}buildTopology(e,r){const i=this.profile,n=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],u=this.vertexBufferStart+i.poleIndices[l];let d=n+a,p=n+l;for(let m=0;m<this.numSegments-1;++m){const y=s+m*i.vertices.length+a,_=s+m*i.vertices.length+l;this.flip?(r(y,p,d),r(p,y,_)):(r(d,p,y),r(_,y,p)),d=y,p=_}this.flip?(r(c,p,d),c!==u&&r(c,u,p)):(r(d,p,c),c!==u&&r(p,u,c))}}};const Aht=Ne(),IAe=Ne();let Oht=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],!1)}},vz=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const n=Pht,{rotationAngle:s,rotationRight:o,frame:a}=e;if(Math.abs(s)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Ec(Ule,.5*-s+c*s/this.numBendSubdivisions,l),Rht(n,a,Ule);for(let u=0;u<r.vertices.length;++u)es(r.vertices[u],o)*s>=0?i(n,r.vertices[u],r.normals[u],!1):i(a,e.applyMiterStretch(Fle,r.vertices[u]),r.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const u=es(r.vertices[c],o)*s>=0;i(a,e.applyMiterStretch(Fle,r.vertices[c]),r.normals[c],!u)}}},LAe=class{constructor(){this.up=O(),this.right=O()}};function Rht(t,e,r){De(t.up,e.up,r),De(t.right,e.right,r)}const Fle=Ne(),Ule=_e(),Pht=new LAe;let Mht=class extends Xn{constructor(e,r,i,n,s,o,a){super(e,r,i,null,on.Mesh,a),this.path=n,this.geometrySR=s,this.stencilWidth=o}};var Bf;function DAe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Bf||(Bf={}));let NAe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},FAe=class extends NAe{constructor(e){super(e),this.vertexAttributeColor=$t(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Yi(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:n,positions:s,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let u=i[c];const d=u===0||u===n.vertices.length-1;u*=3;const p=Nht;let m=0,y=0;const _=4*c,v=ne(Fht,o[_],o[_+1],o[_+2]),b=ne(Uht,a[_],a[_+1],a[_+2]),x=er(kle,l[_]*e[0],l[_+1]*e[1]);if(d)ot(p,b,v),m=o[_+3]*e[0],y=a[_+3];else{const C=Iht,R=Lht;er(C,o[_+3],a[_+3]);const P=kZ(C);wR(C,C);const F=es(x,C);if(Math.abs(F)>P){er(R,-C[1],C[0]);const k=es(x,R);dc(C,C,P*Math.sign(F)),dc(R,R,k),Ld(x,C,R)}ne(p,0,0,0)}const T=ne(Dht,v[0]*x[0]+b[0]*x[1],v[1]*x[0]+b[1]*x[1],v[2]*x[0]+b[2]*x[1]),S=3*c;this.vertexAttributePosition[S]=s[u]+T[0]+p[0]*m,this.vertexAttributePosition[S+1]=s[u+1]+T[1]+p[1]*m,this.vertexAttributePosition[S+2]=s[u+2]+T[2]+p[2]*m;const A=er(kle,l[_+2],l[_+3]);bw(this.vertexAttributeNormal,c,v[0]*A[0]+b[0]*A[1]+p[0]*y,v[1]*A[0]+b[1]*A[1]+p[1]*y,v[2]*A[0]+b[2]*A[1]+p[2]*y)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new UAe([[E.POSITION,new Ue(this.vertexAttributePosition,3,!0)],[E.NORMALCOMPRESSED,new Ue(this.vertexAttributeNormal,2,!0)],[E.COLOR,new Ue(this.vertexAttributeColor,4)]],[[E.POSITION,this.builder.vertexIndices],[E.NORMALCOMPRESSED,this.builder.normalIndices],[E.COLOR,OE(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const n=this.builder.vertexIndices,s=new Ue(this.vertexAttributePosition,3),o=n.length/3;BP(e,r,0,o,n,s,void 0,void 0,i)}},$ht=class extends NAe{constructor(e,r,i,n){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=n,this.vvData=null,this.baked=new FAe(e),this.vvData=Yi(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=r,this.vvData[4*s+1]=i,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){return new UAe([[E.POSITION,new Ue(this.builder.positions,3,!0)],[E.PROFILERIGHT,new Ue(this.builder.profileRightAxes,4,!0)],[E.PROFILEUP,new Ue(this.builder.profileUpAxes,4,!0)],[E.PROFILEVERTEXANDNORMAL,new Ue(this.builder.profileVertexAndNormals,4,!0)],[E.FEATUREVALUE,new Ue(this.vvData,4,!0)]],[[E.POSITION,this.builder.pathVertexIndices],[E.PROFILERIGHT,this.builder.vertexIndices],[E.PROFILEUP,this.builder.vertexIndices],[E.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[E.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(E.POSITION);r&&(r.data=this.builder.positions)}},UAe=class{constructor(e,r){this.vertexAttributes=e,this.indices=r}};const kle=Ne(),Iht=Ne(),Lht=Ne(),Dht=O(),Nht=O(),Fht=O(),Uht=O();function kht(t,e){let r=null;const i=t.vertices.length,n=.99619469809,s=O(),o=O(),a=O(),l=O(),c=O(),u=O(),d=Er();let p=t.vertices[0];re(o,e),ne(s,0,1,0),d5(p.vRight,o,s,s,a,o,n),re(p.frame.up,o),re(p.frame.right,a);const m=t.positions;let y=t.offset;r=p;for(let _=1;_<i;++_){p=t.vertices[_],oe(c,p.vLeft,p.vRight);let v=Te(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=m[y]+r.frame.up[0],u[1]=m[y+1]+r.frame.up[1],u[2]=m[y+2]+r.frame.up[2],y+=3;const b=ne(zht,m[y],m[y+1],m[y+2]);MP(b,c,d),kw(d,bu(u,p.vLeft),l)?(l[0]-=m[y],l[1]-=m[y+1],l[2]-=m[y+2],me(o,l),ot(a,c,o),me(a,a)):d5(c,r.frame.up,r.frame.right,s,a,o,n),re(p.frame.up,o),re(p.frame.right,a),r=p}}const zht=O();let kAe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(D3(e)),this.normals.push(D3(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:D3(e),normal:r?D3(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};const zAe={top:[0,-.5],bottom:[0,.5]};function bz(t){const r=LEe,i=new kAe,n={v0:0,v1:0};i.addPole(or(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),u=or(l*.5,c*.5),d=or(l,c);i.addVertex(u,d)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,n)}const s={v0:r-1,v1:0};if(i.addSegment(s,n),t!=="center"){const o=zAe[t];i.translate(o[0],o[1])}return i}const Bht={center:bz("center"),top:bz("top"),bottom:bz("bottom")},Vht={center:wz("center"),top:wz("top"),bottom:wz("bottom")};function wz(t){const i=new kAe,n=or(.5*-1,.5*-1),s=or(.5*1,.5*-1),o=or(.5*1,.5*1),a=or(.5*-1,.5*1),l=or(0,-1),c=or(1,0),u=or(0,1),d=or(-1,0);if(i.addPole(or(0,.5*1),u),i.addPole(or(0,.5*1)),i.addPole(or(0,.5*-1)),i.addPole(or(0,.5*-1),l),i.addVertex(n,l),i.addVertex(s,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(s,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,u),i.addVertex(a,u),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,d),i.addVertex(n,d),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=zAe[t];i.translate(p[0],p[1])}return i}function Ght(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function jht(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function BAe(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function Hht(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function Wht(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*s-n*i;return o?(o=1/o,t[0]=s*o,t[1]=-i*o,t[2]=-n*o,t[3]=r*o,t):null}function qht(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function Xht(t){return t[0]*t[3]-t[2]*t[1]}function VAe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*a+s*l,t[1]=n*a+o*l,t[2]=i*c+s*u,t[3]=n*c+o*u,t}function Yht(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=n*l+o*a,t[2]=i*-a+s*l,t[3]=n*-a+o*l,t}function Zht(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function Qht(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function Jht(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Kht(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function edt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function tdt(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function rdt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function GAe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function idt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function ndt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=tl();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}function sdt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function odt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const adt=VAe,ldt=GAe;Object.freeze(Object.defineProperty({__proto__:null,LDU:tdt,add:rdt,adjoint:qht,copy:Ght,determinant:Xht,equals:ndt,exactEquals:idt,frob:edt,fromRotation:Qht,fromScaling:Jht,identity:jht,invert:Wht,mul:adt,multiply:VAe,multiplyScalar:sdt,multiplyScalarAndAdd:odt,rotate:Yht,scale:Zht,set:BAe,str:Kht,sub:ldt,subtract:GAe,transpose:Hht},Symbol.toStringTag,{value:"Module"}));function jAe(){return[1,0,0,1]}function cdt(t){return[t[0],t[1],t[2],t[3]]}function udt(t,e,r,i){return[t,e,r,i]}function hdt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:cdt,create:jAe,createView:hdt,fromValues:udt},Symbol.toStringTag,{value:"Module"}));let HAe=class{constructor(){this.vLeft=O(),this.vRight=O(),this.vMinSiblingLength=0,this.frame=new LAe}setFrameFromUpVector(e){re(this.frame.up,e),oe(NC,this.vLeft,this.vRight),me(NC,NC),te(Vle,this.frame.up,fe(NC,this.frame.up)),ae(MI,NC,Vle),me(MI,MI),ot(this.frame.right,MI,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},ddt=class extends HAe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return rbe}get rotationAngle(){return te(U0,this.frame.up,fe(this.frame.up,this.vLeft)),ae(U0,this.vLeft,U0),fa(U0,U0),me(U0,U0),te(Lx,this.frame.up,fe(this.frame.up,this.vRight)),ae(Lx,this.vRight,Lx),me(Lx,Lx),ot(X5,this.rotationFrameUp,this.vLeft),Math.sign(fe(X5,this.vRight))*(Math.PI-As(fe(U0,Lx)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const n=XV(Math.cos(.5*i));return er(e,(n-1+1)*r[0],r[1])}},pdt=class extends HAe{get rotationFrameUp(){const e=Math.sign(fe(this.frame.right,this.vRight));return ot(DC,this.vRight,this.vLeft),te(DC,DC,e),me(DC,DC)}get rotationRight(){const e=this.rotationFrameUp,r=fe(e,this.frame.up),i=fe(e,this.frame.right);return te(Ix,this.frame.up,-i),te(Ble,this.frame.right,r),oe(Ix,Ix,Ble),me(Ix,Ix),fdt(zle,this.frame,Ix),zle}get rotationAngle(){const e=Math.sign(fe(this.frame.right,this.vRight));return fa(X5,this.vLeft),-e*(Math.PI-As(fe(X5,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*XV(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const n=XV(Math.cos(.5*i)),s=this.rotationRight,o=BAe(gdt,1+(n-1)*s[0]*s[0],(n-1)*s[0]*s[1],(n-1)*s[0]*s[1],1+(n-1)*s[1]*s[1]);return qwe(e,r,o)}};function fdt(t,e,r){er(t,fe(r,e.right),fe(r,e.up))}function mdt(t){switch(t){case Bf.World:return new ddt;case Bf.Path:return new pdt}}const DC=O(),zle=Ne(),Ix=O(),Ble=O(),X5=O(),U0=O(),Lx=O(),Vle=O(),NC=O(),MI=O(),gdt=jAe(),xz=8;function ydt(t,e){const r=E.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(w`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new yr("size",n=>n.size)),e.vvSize?(i.uniforms.add(new Lt("vvSizeMinSize",n=>n.vvSize.minSize),new Lt("vvSizeMaxSize",n=>n.vvSize.maxSize),new Lt("vvSizeOffset",n=>n.vvSize.offset),new Lt("vvSizeFactor",n=>n.vvSize.factor)),i.code.add(w`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(w`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",xz),i.uniforms.add(new Sl("vvOpacityValues",n=>n.vvOpacity.values,xz),new Sl("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,xz)),i.code.add(w`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(w`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",WT),i.uniforms.add(new Sl("vvColorValues",n=>n.vvColor.values,WT),new zSe("vvColorColors",n=>n.vvColor.colors,WT)),i.code.add(w`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(w`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(LP),t.attributes.add(E.PROFILERIGHT,"vec4"),t.attributes.add(E.PROFILEUP,"vec4"),t.attributes.add(E.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(w`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(w`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(w`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(w`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let _dt=class extends HP{constructor(){super(...arguments),this.size=or(1,1)}};function vdt(t){const e=new mr,{vertex:r,fragment:i}=e;switch(xc(r,t),e.varyings.add("vpos","vec3"),e.include(ydt,t),t.output!==D.Color&&t.output!==D.Alpha||(e.include(Cl,t),e.include(vw,t),e.include(AE,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(w`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===D.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(xu,t),t.output){case D.Alpha:e.include(fn,t),i.uniforms.add(new Ce("opacity",n=>n.opacity)),i.code.add(w`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case D.Color:e.include(fn,t),e.include(ww,t),e.include(JP,t),e.include(vw,t),e.include(m3e,t),fp(i,t),KP(i),NE(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Lt("ambient",n=>n.ambient),new Lt("diffuse",n=>n.diffuse),new Lt("specular",n=>n.specular),new Ce("opacity",n=>n.opacity)),i.include(cm),lm(i),i.code.add(w`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===rt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case D.Depth:case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:e.include(Cl,t),pw(e),e.varyings.add("depth","float"),r.code.add(w`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(fn,t),e.include(Xg,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case D.Normal:e.include(Cl,t),e.include(UR,t),jS(r),e.varyings.add("vnormal","vec3"),r.code.add(w`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(fn,t),i.code.add(w`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case D.Highlight:e.include(Cl,t),e.include(UR,t),e.varyings.add("vnormal","vec3"),r.code.add(w`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(fn,t),e.include(c0,t),i.code.add(w`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const bdt=Object.freeze(Object.defineProperty({__proto__:null,build:vdt},Symbol.toStringTag,{value:"Module"})),WAe=new Map([[E.POSITION,0],[E.PROFILERIGHT,1],[E.PROFILEUP,2],[E.PROFILEVERTEXANDNORMAL,3],[E.FEATUREVALUE,4]]);let wdt=class extends _dt{constructor(){super(...arguments),this.ambient=Se(.2,.2,.2),this.diffuse=Se(.8,.8,.8),this.specular=Se(0,0,0),this.opacity=1,this.origin=O(),this.modelTransformation=null}},qAe=class XAe extends Tr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new vr(e.rctx,XAe.shader.get().build(this.configuration),WAe)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===rt.NONE,n=e===rt.FrontFace;return Ot({blending:r.output!==D.Color&&r.output!==D.Alpha||!r.transparent?null:i?fu:u0(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Zi.None?ixe:null,depthTest:{func:f1(e)},depthWrite:i||n?$l:null,colorWrite:Ft,stencilWrite:r.hasOccludees?em:null,stencilTest:r.hasOccludees?m1:null,polygonOffset:i||n?null:C8})}};qAe.shader=new _r(bdt,()=>ce(()=>import("./Path.glsl-bb1cac2d.js"),[]));let Is=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.doubleSidedMode=Zi.None,this.transparencyPassType=rt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};h([U({count:D.COUNT})],Is.prototype,"output",void 0),h([U({count:Zi.COUNT})],Is.prototype,"doubleSidedMode",void 0),h([U({count:rt.COUNT})],Is.prototype,"transparencyPassType",void 0),h([U()],Is.prototype,"spherical",void 0),h([U()],Is.prototype,"receiveShadows",void 0),h([U()],Is.prototype,"receiveAmbientOcclusion",void 0),h([U()],Is.prototype,"vvSize",void 0),h([U()],Is.prototype,"vvColor",void 0),h([U()],Is.prototype,"vvOpacity",void 0),h([U()],Is.prototype,"hasSlicePlane",void 0),h([U()],Is.prototype,"transparent",void 0),h([U()],Is.prototype,"hasOccludees",void 0),h([U()],Is.prototype,"hasMultipassTerrain",void 0),h([U()],Is.prototype,"cullAboveGround",void 0),h([U()],Is.prototype,"doublePrecisionRequiresObfuscation",void 0),h([U({constValue:et.Disabled})],Is.prototype,"pbrMode",void 0),h([U({constValue:!0})],Is.prototype,"hasVvInstancing",void 0),h([U({constValue:!1})],Is.prototype,"useCustomDTRExponentForWater",void 0),h([U({constValue:!1})],Is.prototype,"useFillLights",void 0);let xdt=class YAe extends p1{constructor(e){super(e,new Sdt),this.supportsEdges=!0,this._vertexAttributeLocations=WAe,this._configuration=new Is,this._vertexBufferLayout=YAe.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==D.Color&&e!==D.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Zi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Zi.WindingOrder:Zi.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==D.Shadow&&e!==D.ShadowExcludeHighlight&&e!==D.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,n,s,o){const a=e;if(!DAe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:b,minSize:x,maxSize:T}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=ge(v[0]+S*b[0],x[0],T[0]),c[1]*=ge(v[2]+S*b[2],x[2],T[2])}const u=Math.max(c[0],c[1]),d=e.boundingInfo;if(d==null)return void this._intersectTriangles(l,c,n,s,o);const p=iw(d.bbMin[0]-u,d.bbMin[1]-u,d.bbMin[2]-u,d.bbMax[0]+u,d.bbMax[1]+u,d.bbMax[2]+u),m=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],y=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),_=[y/m[0],y/m[1],y/m[2]];QQ(p,n,_,i.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,r,i,n,s){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,n,s)}createBufferWriter(){return new DE(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case D.Color:case D.Alpha:case D.Depth:case D.Normal:case D.Highlight:case D.ObjectAndLayerIdColor:return e===(this.parameters.transparent?le.TRANSPARENT_MATERIAL:le.OPAQUE_MATERIAL)||e===le.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new Tdt(e)}static getVertexBufferLayout(){return Gi().vec3f(E.POSITION).vec4f(E.PROFILERIGHT).vec4f(E.PROFILEUP).vec4f(E.PROFILEVERTEXANDNORMAL).vec4f(E.FEATUREVALUE)}},Tdt=class extends h1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==D.Color&&this._output!==D.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(qAe,e)}},Sdt=class extends wdt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const Edt=["polyline"];let Cdt=class extends hm{constructor(e,r,i,n){super(e,r,i,n),this._intrinsicSize=or(1,1),this._upVectorAlignment=Bf.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){var p,m,y,_;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new jP({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((m=(p=this._context.renderer)==null?void 0:p.visualVariables)==null?void 0:m.length)>0?qS(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Bf.World:Bf.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=Bht[i];break;case"quad":this._profile=Vht[i]}switch(this.symbolLayer.join){case"round":this._extruder=new vz(0,IEe);break;case"bevel":this._extruder=new vz(0,1);break;case"miter":this._extruder=new vz(.8*Math.PI,1);break;default:this._extruder=new Oht}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new Dle,this._endCap=new Dle;break;case"butt":default:this._startCap=new PI(this._profile,0),this._endCap=new PI(this._profile,0,!0);break;case"square":this._startCap=new PI(this._profile,-.5),this._endCap=new PI(this._profile,.5,!0);break;case"round":{const v=n==="quad";this._startCap=new Nle({profile:this._profile,flip:!1,breakNormals:v,subdivisions:HH}),this._endCap=new Nle({profile:this._profile,flip:!0,breakNormals:v,subdivisions:HH});break}}const o=(_=(y=this.symbolLayer)==null?void 0:y.material)==null?void 0:_.color,a=this._getCombinedOpacityAndColor(o),l=na(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,d={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||s==="none"?ui.None:ui.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(er(this._intrinsicSize,e,r),!jH(this._intrinsicSize[0])||!jH(this._intrinsicSize[1])))throw new Y("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||dc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const v={...d,...this._fastUpdates.materialParameters,size:Zve(this._intrinsicSize)};this._material=new xdt(v)}else d.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,d.normalType=br.Compressed,this._material=new tm(d);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Edt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new wp),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(){var n,s;const e=(s=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:s.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,K_)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!XS(this._fastUpdates,r,this._vvConvertOptions))return $n.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return $n.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const d of i)r+=d.length;const l=Ys(3*r);let c,u=0;for(const d of i){n.push({offset:u,numVertices:d.length});for(const p of d)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||s.equals(o)||$i(l,s,0,l,o,0,r)?(o==null||o.equals(a)?c=v2e(l):(c=Ys(3*r),$i(l,o,0,c,a,0,r)),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,n){var y,_,v;const s=e.geometry,o=this._getVertexData(s);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(b=>b.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=s.spatialReference,c=ps(),u=this._context.renderCoordsHelper,d=new BQ(o.vertexDataES);for(const b of o.pathVertexDataInfos){const x=b.numVertices;if(x<2)continue;const T=b.offset;if(this._context.clippingExtent!=null&&(vi(c),lu(c,o.vertexDataES,T,x),!Hd(c,this._context.clippingExtent)))continue;const S=new Array,A=T+3*x;for(let X=T;X<A;X+=3){d.offset=X;const q=Xrt(d,this._context.elevationProvider,i,u);ne(hn,o.vertexDataRS[X],o.vertexDataRS[X+1],o.vertexDataRS[X+2]),u.setAltitude(hn,q),o.vertexDataRS[X]=hn[0],o.vertexDataRS[X+1]=hn[1],o.vertexDataRS[X+2]=hn[2],S.push(mdt(this._upVectorAlignment))}const C=new Eht(S,o.vertexDataES,o.vertexDataRS,T);ZAe(C,this._upVectorAlignment,this._context.renderCoordsHelper);const R=new Cht(C,this._profile,this._extruder,this._startCap,this._endCap);let P=null;if(this._fastUpdates){const X=this._fastUpdates.visualVariables,q=ip((y=X.size)==null?void 0:y.field,e)??0,G=ip((_=X.color)==null?void 0:_.field,e)??0,Q=ip((v=X.opacity)==null?void 0:v.field,e)??0;P=new $ht(R,q,G,Q)}else{const X=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Q=r.size;X[0]*=Gle(Q[0],Q[2]==="symbol-value"?this.symbolLayer.height||0:Q[2],this.symbolLayer.width||0),X[1]*=Gle(Q[2],Q[0]==="symbol-value"?this.symbolLayer.width||0:Q[0],this.symbolLayer.height||0)}let q;this._drivenProperties.color&&(q=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(q=q?[q[0],q[1],q[2],r.opacity]:[1,1,1,r.opacity]);const G=new FAe(R);G.bake(X),q&&G.bakeVertexColors(q),P=G}const{vertexAttributes:F,indices:k}=P.createGeometryData(),V=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),z=new Mht(this._material,F,k,P,l,this._stencilWidth,V);z.transformation=Ml(_e(),yn,R.path.origin),a.push(z)}if(a.length===0)return null;const p=new h0({geometries:a,layerUid:this._context.layer.uid,graphicUid:n}),m=new um(this,p,a,null,null,(b,x,T,S,A)=>Odt(b,x,S,A,this._upVectorAlignment),i);return m.alignedSampledElevation=0,m.needsElevationUpdates=K_(i.mode),m}};function ZAe(t,e,r){const{origin:i,positions:n}=t;let s=t.offset;switch(e){default:case Bf.World:for(const o of t.vertices)hn[0]=n[s++]+i[0],hn[1]=n[s++]+i[1],hn[2]=n[s++]+i[2],r.worldUpAtPosition(hn,hn),o.setFrameFromUpVector(hn);break;case Bf.Path:hn[0]=n[s]+i[0],hn[1]=n[s+1]+i[1],hn[2]=n[s+2]+i[2],r.worldUpAtPosition(hn,hn),kht(t,hn)}}function Gle(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function Adt(t,e,r,i){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)ne(hn,l[u],l[u+1],l[u+2]),r(hn,Tz),n+=Tz.sampledElevation,hn[0]=a[u]+s[0],hn[1]=a[u+1]+s[1],hn[2]=a[u+2]+s[2],i.setAltitude(hn,Tz.z),a[u]=hn[0]-s[0],a[u+1]=hn[1]-s[1],a[u+2]=hn[2]-s[2];return t.updatePathVertexInformation(),n/o.length}function Odt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!DAe(l))continue;const c=l.path,u=c.builder.path;a+=Adt(u,e,r,i),n!==Bf.World&&ZAe(u,n,i),c.onPathChanged(l),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(l)}return a/o.length}const hn=O(),Tz=new qP;function Rdt(t,e,r,i,n=1){if(r.isGeographic&&i===$e.Global){const c=Ys(e.length),u=e.length,d=Mr(r);for(let p=0;p<u;p+=3)F6(e,p,c,p,d);e=c}er(rs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)rs[0]=Math.min(rs[0],e[c]),rs[1]=Math.min(rs[1],e[c+1]);const s=rs[0]%n,o=rs[1]%n,a=rs[0]-s,l=rs[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/n,t[u+1]=(e[c+1]-l)/n,t[u+2]=a/n,t[u+3]=l/n}}function QAe(t,e,r,i,n=1){ne(H1,1,0,0),ne(W1,0,1,0),ne(Nx,0,0,1),$dt(Sz,r),Pdt(r,jle)&&Mdt(jle,H1,W1,Nx,i,Sz),er(rs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),er(q1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){ne(Dx,r[u],r[u+1],r[u+2]);const d=fe(H1,Dx),p=fe(W1,Dx);rs[0]=Math.min(rs[0],d),rs[1]=Math.min(rs[1],p),q1[0]=Math.max(q1[0],d),q1[1]=Math.max(q1[1],p)}const s=fe(Nx,Sz);Cz(k0,rs[0],rs[1],s,H1,W1,Nx),Cz(X1,q1[0],rs[1],s,H1,W1,Nx),Cz(Y1,rs[0],q1[1],s,H1,W1,Nx),ae(X1,X1,k0),te(X1,X1,.5),ae(Y1,Y1,k0),te(Y1,Y1,.5),oe(k0,k0,X1),oe(k0,k0,Y1);const o=rs[0]%n,a=rs[1]%n,l=rs[0]-o,c=rs[1]-a;for(let u=0;u<r.length;u+=3){ne(Dx,r[u],r[u+1],r[u+2]);const d=u/3,p=4*d;t[p]=(fe(H1,Dx)-l)/n,t[p+1]=(fe(W1,Dx)-c)/n,t[p+2]=l/n,t[p+3]=c/n;const m=9*d;for(let y=0;y<3;y++)e[m+y]=k0[y],e[m+y+3]=X1[y],e[m+y+6]=Y1[y]}}const Sz=O(),Dx=O(),jle=Er(),H1=O(),W1=O(),Nx=O(),rs=Ne(),q1=Ne(),k0=O(),X1=O(),Y1=O();function Pdt(t,e){const r=t.length/3-1;return Tbe(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function Mdt(t,e,r,i,n,s){n!=null?(n.basisMatrixAtPosition(s,zp),ne($I,zp[0],zp[1],zp[2]),ne(II,zp[4],zp[5],zp[6]),ne(Ez,zp[8],zp[9],zp[10])):(ne($I,1,0,0),ne(II,0,1,0),ne(Ez,0,0,1));const o=t;fe(o,Ez)<0&&te(o,o,-1),re(i,o);const a=fe(o,II),l=fe(o,$I);Math.abs(a)<Math.abs(l)?(pb(e,$I,o,-l),me(e,e),ot(r,e,o),me(r,r),te(r,r,-1)):(pb(r,II,o,-a),me(r,r),ot(e,r,o),me(e,e))}const zp=_e(),$I=O(),II=O(),Ez=O();function $dt(t,e){ne(FC,0,0,0);for(let r=0;r<e.length-3;r+=3)FC[0]+=e[r],FC[1]+=e[r+1],FC[2]+=e[r+2];te(t,FC,1/(e.length/3-1))}const FC=O();function Cz(t,e,r,i,n,s,o){ne(t,e*n[0]+r*s[0]+i*o[0],e*n[1]+r*s[1]+i*o[1],e*n[2]+r*s[2]+i*o[2])}function Idt(t){const e=new mr,{vertex:r,fragment:i,attributes:n,varyings:s}=e;xc(r,t),e.include(Cl,t),e.include(qw,t),e.include(Tg,t),e.include(GP,t),n.add(E.POSITION,"vec3"),t.vvColor&&n.add(E.COLORFEATUREATTRIBUTE,"float"),s.add("vColor","vec4"),s.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===D.Color||t.output===D.Alpha);o&&s.add("depth","float"),r.uniforms.add(new Jt("eColor",c=>c.color));const a=t.output===D.Depth;a&&(e.include(Xg,t),pw(e),W_(e)),r.code.add(w`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?w`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w`transformPosition(proj, view, vpos);`}
    }
  `),e.include(fn,t),o&&e.include(xu,t),i.include(cm);const l=t.output===D.Highlight;return l&&e.include(c0,t),i.code.add(w`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===D.ObjectAndLayerIdColor?w`fColor.a = 1.0;`:""}

    if (fColor.a < ${w.float(vo)}) {
      discard;
    }

    ${t.output===D.Alpha?w`fragColor = vec4(fColor.a);`:""}

    ${t.output===D.Color?w`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===rt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?w`outputHighlight();`:""};
    ${t.output===D.Depth?w`outputDepth(linearDepth);`:""};
    ${t.output===D.ObjectAndLayerIdColor?w`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Ldt=Object.freeze(Object.defineProperty({__proto__:null,build:Idt},Symbol.toStringTag,{value:"Module"}));let JAe=class KAe extends Tr{initializeProgram(e){return new vr(e.rctx,KAe.shader.get().build(this.configuration),fr)}_createPipeline(e,r){const i=this.configuration,n=e===rt.NONE,s=e===rt.FrontFace;return Ot({blending:i.output!==D.Color&&i.output!==D.Alpha||!i.transparent?null:n?fu:u0(e),culling:J6(i.cullFace),depthTest:{func:f1(e)},depthWrite:(n||s)&&i.writeDepth?$l:null,colorWrite:Ft,stencilWrite:i.hasOccludees?em:null,stencilTest:i.hasOccludees?r?r1:m1:null,polygonOffset:n||s?i.polygonOffset?Ddt:null:A8(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};JAe.shader=new _r(Ldt,()=>ce(()=>import("./ColorMaterial.glsl-c349707a.js"),[]));const Ddt={factor:1,units:1};let Ro=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.cullFace=ui.None,this.transparencyPassType=rt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};h([U({count:D.COUNT})],Ro.prototype,"output",void 0),h([U({count:ui.COUNT})],Ro.prototype,"cullFace",void 0),h([U({count:rt.COUNT})],Ro.prototype,"transparencyPassType",void 0),h([U()],Ro.prototype,"hasSlicePlane",void 0),h([U()],Ro.prototype,"hasVertexColors",void 0),h([U()],Ro.prototype,"transparent",void 0),h([U()],Ro.prototype,"polygonOffset",void 0),h([U()],Ro.prototype,"enableOffset",void 0),h([U()],Ro.prototype,"writeDepth",void 0),h([U()],Ro.prototype,"hasOccludees",void 0),h([U()],Ro.prototype,"hasMultipassTerrain",void 0),h([U()],Ro.prototype,"cullAboveGround",void 0),h([U()],Ro.prototype,"objectAndLayerIdColorInstanced",void 0),h([U()],Ro.prototype,"vvColor",void 0),h([U({constValue:!0})],Ro.prototype,"hasVvInstancing",void 0),h([U({constValue:!1})],Ro.prototype,"vvSize",void 0),h([U({constValue:!1})],Ro.prototype,"vvOpacity",void 0);let Hle=class extends IJ{constructor(e){super(e,new Fdt),this.supportsEdges=!0,this._configuration=new Ro}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<E8,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===D.Color||r===D.Alpha||r===D.Highlight||r===D.Depth&&this.parameters.writeLinearDepth||r===D.ObjectAndLayerIdColor?e===le.DRAPED_MATERIAL?!0:r===D.Highlight?e===le.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:le.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new Ndt(e)}createBufferWriter(){const e=Gi().vec3f(E.POSITION);return se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(E.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4u8(E.COLOR),new DE(e)}},Ndt=class extends h1{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==D.Color&&this._output!==D.Alpha||this._updateOccludeeState(e),this.ensureTechnique(JAe,e)}},Fdt=class extends HP{constructor(){super(...arguments),this.color=Nf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ui.None,this.hasOccludees=!1}};var _o;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(_o||(_o={}));const hW=.70710678118,Wle=hW,Udt=.08715574274;function kdt(t){const e=new mr,r=t.hasMultipassTerrain&&(t.output===D.Color||t.output===D.Alpha),{vertex:i,fragment:n,attributes:s,varyings:o}=e;xc(i,t),e.include(Cl,t),e.include(qw,t),e.include(Tg,t),t.draped?i.uniforms.add(new Ce("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):s.add(E.BOUNDINGRECT,"mat3"),s.add(E.POSITION,"vec3"),s.add(E.UVMAPSPACE,"vec4"),t.vvColor&&s.add(E.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new Jt("uColor",c=>c.color));const a=t.style===_o.ForwardDiagonal||t.style===_o.BackwardDiagonal||t.style===_o.DiagonalCross;a&&i.code.add(w`
      const mat2 rotate45 = mat2(${w.float(hW)}, ${w.float(-Wle)},
                                 ${w.float(Wle)}, ${w.float(hW)});
    `),t.draped||(fp(i,t),i.uniforms.add(new Ce("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),i.code.add(w`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(w`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(w`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${w.float(Udt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(w`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":w`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${w.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===D.Depth;return l&&(e.include(Xg,t),pw(e),W_(e)),i.code.add(w`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?w`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w`transformPosition(proj, view, vpos);`}
    }
  `),e.include(fn,t),n.include(cm),t.draped&&n.uniforms.add(new Ce("texelSize",(c,u)=>1/u.camera.pixelRatio)),t.output===D.Highlight&&e.include(c0,t),r&&e.include(xu,t),t.output!==D.Highlight&&(n.code.add(w`
      const float lineWidth = ${w.float(t.lineWidth)};
      const float spacing = ${w.float(t.patternSpacing)};
      const float spacingINV = ${w.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(w`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.code.add(w`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==D.Highlight?w`color.a *= ${zdt(t)};`:""}

      ${t.output===D.ObjectAndLayerIdColor?w`color.a = 1.0;`:""}

      if (color.a < ${w.float(vo)}) {
        discard;
      }

      ${t.output===D.Alpha?w`fragColor = vec4(color.a);`:""}

      ${t.output===D.Color?w`fragColor = color; ${t.transparencyPassType===rt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===D.Highlight?w`outputHighlight();`:""}
      ${t.output===D.Depth?w`outputDepth(linearDepth);`:""};
    }
  `),e}function zdt(t){function e(r){return t.draped?w`coverage(vuv.${r}, texelSize)`:w`sampleAA(vuv.${r})`}switch(t.style){case _o.ForwardDiagonal:case _o.Horizontal:return e("y");case _o.BackwardDiagonal:case _o.Vertical:return e("x");case _o.DiagonalCross:case _o.Cross:return w`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const Bdt=Object.freeze(Object.defineProperty({__proto__:null,build:kdt},Symbol.toStringTag,{value:"Module"}));let eOe=class tOe extends Tr{initializeProgram(e){return new vr(e.rctx,tOe.shader.get().build(this.configuration),rOe)}_setPipelineState(e,r){const i=this.configuration,n=e===rt.NONE,s=e===rt.FrontFace;return Ot({blending:i.output===D.Color||i.output===D.Alpha?n?fu:u0(e):null,culling:J6(i.cullFace),depthTest:{func:f1(e)},depthWrite:n?i.writeDepth?$l:null:S8(e),colorWrite:Ft,stencilWrite:i.hasOccludees?em:null,stencilTest:i.hasOccludees?r?r1:m1:null,polygonOffset:n||s?i.polygonOffset?Vdt:null:A8(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};eOe.shader=new _r(Bdt,()=>ce(()=>import("./Pattern.glsl-2fa8b945.js"),[]));const Vdt={factor:1,units:1};let Ls=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.cullFace=ui.None,this.transparencyPassType=rt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}};h([U({count:D.COUNT})],Ls.prototype,"output",void 0),h([U({count:ui.COUNT})],Ls.prototype,"cullFace",void 0),h([U({count:_o.COUNT})],Ls.prototype,"style",void 0),h([U({count:rt.COUNT})],Ls.prototype,"transparencyPassType",void 0),h([U()],Ls.prototype,"hasSlicePlane",void 0),h([U()],Ls.prototype,"hasVertexColors",void 0),h([U()],Ls.prototype,"polygonOffset",void 0),h([U()],Ls.prototype,"writeDepth",void 0),h([U()],Ls.prototype,"hasOccludees",void 0),h([U()],Ls.prototype,"patternSpacing",void 0),h([U()],Ls.prototype,"lineWidth",void 0),h([U()],Ls.prototype,"enableOffset",void 0),h([U()],Ls.prototype,"draped",void 0),h([U()],Ls.prototype,"hasMultipassTerrain",void 0),h([U()],Ls.prototype,"cullAboveGround",void 0),h([U()],Ls.prototype,"vvColor",void 0),h([U({constValue:!1})],Ls.prototype,"hasVvInstancing",void 0),h([U({constValue:!1})],Ls.prototype,"vvSize",void 0),h([U({constValue:!1})],Ls.prototype,"vvOpacity",void 0);const rOe=new Map([[E.POSITION,0],[E.COLOR,3],[E.UVMAPSPACE,4],[E.COLORFEATUREATTRIBUTE,5],[E.BOUNDINGRECT,6]]);let nK=class extends IJ{constructor(e){super(e,new Hdt),this.supportsEdges=!0,this._vertexAttributeLocations=rOe,this._configuration=new Ls}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<E8,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===D.Color||r===D.Alpha||r===D.Highlight||r===D.Depth&&this.parameters.writeLinearDepth?e===le.DRAPED_MATERIAL?!0:r===D.Highlight?e===le.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?le.TRANSPARENT_MATERIAL:le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new Gdt(e)}createBufferWriter(){const e=Gi().vec3f(E.POSITION).vec4f(E.UVMAPSPACE);return this.parameters.draped||e.mat3f(E.BOUNDINGRECT),this.parameters.vvColor?e.f32(E.COLORFEATUREATTRIBUTE):e.vec4u8(E.COLOR),new jdt(e)}},Gdt=class extends h1{_updateParameters(e){return this.ensureTechnique(eOe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==D.Color&&this._output!==D.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},jdt=class extends DE{write(e,r,i,n,s){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case E.UVMAPSPACE:{Je(a.size===4);const c=n.getField(o,pp);c&&HS(l,a.data,c,s);break}case E.BOUNDINGRECT:{Je(a.size===9);const c=n.getField(o,q_);c&&this.writeBoundingRect(l,a.data,e,c,s);break}default:xSe(o,a,l,e,r,n,s)}}}writeBoundingRect(e,r,i,n,s){const o=i,a=n.typedBuffer,l=n.typedBufferStride,c=e.length;s*=l;for(let u=0;u<c;++u){const d=9*e[u],p=r[d],m=r[d+1],y=r[d+2];a[s]=o[0]*p+o[4]*m+o[8]*y+o[12],a[s+1]=o[1]*p+o[5]*m+o[9]*y+o[13],a[s+2]=o[2]*p+o[6]*m+o[10]*y+o[14];for(let _=3;_<9;++_)a[s+_]=r[d+_];s+=l}}},Hdt=class extends HP{constructor(){super(...arguments),this.color=$t(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ui.None,this.hasOccludees=!1,this.style=_o.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function Wdt(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new Hle(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=$t(0,0,0,0),e.transparent=!0),new Hle(e)):(e.style=qdt(r.style),new nK(e))}function qdt(t){switch(t){case"horizontal":return _o.Horizontal;case"vertical":return _o.Vertical;case"cross":return _o.Cross;case"forward-diagonal":return _o.ForwardDiagonal;case"backward-diagonal":return _o.BackwardDiagonal;case"diagonal-cross":return _o.DiagonalCross;default:return}}function Xdt(t){return t.material instanceof nK&&!t.material.parameters.draped}function Ydt(t,e){if(Xdt(t)){const r=t.vertexAttributes.get(E.POSITION).data,i=t.getMutableAttribute(E.UVMAPSPACE).data,n=t.getMutableAttribute(E.BOUNDINGRECT).data;QAe(i,n,r,e)}}function Zdt(t,e,r,i,n){const s=EEe(t,e,r,i,n),o=t.stageObject.geometries;for(const a of o)Ydt(a,n);return s}const Qdt=["polyline","polygon","extent"],qle=new jP({size:!1,color:!0,rotation:!1,opacity:!1});let iOe=class nOe extends hm{constructor(e,r,i,n){super(e,r,i,n),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=qS(this._context.renderer,qle)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){var i,n,s;if(this._material!=null)return;const e=(n=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:n.color,r=this._getCombinedOpacityAndColor(e);this._material=Wdt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(s=this._fastUpdates)==null?void 0:s.materialParameters}),this._needsUV=this._material instanceof nK,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const n=tAe(e.pattern);return new yT({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,stippleScaleWithLineWidth:!0,cap:oW(e.patternCap||"butt")})};this._outlineMaterial=r(ha(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Qdt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r,new wp);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,n)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!XS(this._fastUpdates,r,qle))return $n.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return $n.FastUpdate}layerOpacityChanged(){var e,r;if(this._material!=null){const i=this._material.parameters.color,n=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,s=this._getCombinedOpacity(n);this._material.setParameters({color:[i[0],i[1],i[2],s],transparent:s<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const i=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=WP(nOe.elevationModeChangeTypes,i,n);if(s!==an.UPDATE)return s;const o=Bh(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var u;const n=FR(e.geometry);if(!n)return null;const s=VJ(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new Jdt(s,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Yi(4*a,!0),o.boundingRect=Ys(9*a,!0),QAe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new h0({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new um(this,l,o.outGeometries,null,null,Zdt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Bh(i.mode),c}_createAs3DShapeFill(e,r){var n;const i=r.renderData.polygons;for(const{position:s,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(vi(nd),lu(nd,o),!Hd(nd,this._context.clippingExtent)))continue;const u=QS(o,a,3);if(u.length===0)continue;const d=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,p=rae({material:this._material,indices:u,mapPositions:o,attributeData:{position:s,color:d?null:r.color,colorFeature:d?ip(d.field,e):null,uvMapSpace:this._needsUV?c5(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?Ch(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:n,position:s}=r[i];if(this._context.clippingExtent!=null&&(vi(nd),lu(nd,n),!Hd(nd,this._context.clippingExtent)))continue;const o=aW(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:n,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,r){var a;const i=FR(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const n=h3e(i,this._context.overlaySR),s=new Kdt(n,r,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=Yi(4*o,!0),Rdt(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=vi(),s.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._hasOutline&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new G8(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var n;const i=r.renderData.polygons;for(const{position:s,holeIndices:o,index:a,count:l}of i){const c=vi(nd);if(lu(c,s),!Hd(c,this._context.clippingExtent))continue;const u=QS(s,o,3);if(u.length===0)continue;SS(r.outBoundingBox,c);const d=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,p=rae({material:this._material,indices:u,attributeData:{position:s,color:d?null:r.color,colorFeature:d?ip(d.field,e):null,uvMapSpace:this._needsUV?c5(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new KS(p,r))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:n}=r[i];if(vi(nd),lu(nd,n),!Hd(nd,this._context.clippingExtent))continue;SS(e.outBoundingBox,nd);const s=aW(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new KS(s,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,n;const e=(n=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:n.color,r=this._getOutlineOpacity();return dO(e!=null?it.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};iOe.elevationModeChangeTypes={definedChanged:an.RECREATE,staysOnTheGround:an.NONE,onTheGroundChanged:an.RECREATE};const nd=ps();let Jdt=class extends N8{constructor(e,r,i,n){super(e,i,n),this.color=r}},Kdt=class extends N8{constructor(e,r,i,n){super(e,i,n),this.color=r}};const ept="arial-unicode-ms",Xle="woff2",Yle=new Map,sOe=new Set;let tpt=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function rpt(t){const e=spt(t),r=Yle.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${Jr.fontsUrl}/woff2/${e}.${Xle}') format('${Xle}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(i)&&i.status==="loading")return i.loaded;const s=i.load().then(()=>(n.add(i),i));return Yle.set(e,new tpt(i,s)),sOe.add(i),s}function ipt(t){return sOe.has(t)}function npt(t){if(!t)return ept;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function spt(t){const e=opt(t)+apt(t);return npt(t.family)+(e.length>0?e:"-regular")}function opt(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function apt(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let oOe=class aOe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var p,m,y,_,v;const i=(p=e==null?void 0:e.material)==null?void 0:p.color,n=it.toUnitRGBA(i)??Nf,s=e.size!=null?ha(e.size):12,o=e.lineHeight,a=e.background!=null?it.toUnitRGBA(e.background.color):Nf,l={family:((m=e.font)==null?void 0:m.family)??"sans-serif",decoration:((y=e.font)==null?void 0:y.decoration)??"none",weight:((_=e.font)==null?void 0:_.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=c!=null&&c.color!=null&&c.size>0?{size:ha(c.size),color:it.toUnitRGBA(c.color)}:{size:0,color:Nf},d=new aOe({color:n,size:s,background:{color:a,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r});if(e.font){let b=!1;const x=d.fontString(s);try{b=(await document.fonts.load(x)).some(T=>!ipt(T))}catch{J.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${x}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!lpt.has(e.font.family))try{await rpt(e.font)}catch{}}return d}};const lpt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let cpt=class{constructor(e,r,i){this._renderer=new q3e(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=nW(upt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Hw(e,{wrap:{s:Pt.CLAMP_TO_EDGE,t:Pt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const upt={canvas:null},hpt=[0,0,1];let dpt=class extends hm{constructor(e,r,i,n){super(e,r,i,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=R8(this.symbolLayer.size);if(e)throw new Y("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await oOe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=DR(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const n=this.symbolLayer.text;if(n==null||n==="")return null;const s=iZ(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(s!=null&&!V1e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new xEe(s,this.symbolLayer.horizontalAlignment,Glt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,n,o)}createLabel(e,r,i,n){const s=e.graphic,o=DR(s.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(s,o,a,r,i,n)}setGraphicElevationContext(e,r,i=0){const n=super.setGraphicElevationContext(e,r);return n.addOffsetRenderUnits(i),n}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return Zle(e,r,(i,n)=>{this.updateGraphicElevationContext(n,i)}),an.UPDATE}slicePlaneEnabledChanged(e,r){return Zle(e,r,i=>{for(const n of i.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=Bh(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return fpt}_createAs3DShape(e,r,i,n,s,o){var P;const a=this.setGraphicElevationContext(e,new wp,n.elevationOffset),l=((P=e.geometry)==null?void 0:P.type)==="polyline",c=e.uid;let u=null,d=null;if(o==null){const F=Y3e(n.horizontalPlacement);u=new cpt(i,F,this._textRenderParameters);let k=null;if(this._context.sharedResources.textures!=null){d=this._context.sharedResources.textures.fromData(u.key,()=>u.create(),()=>{k!=null&&k.release()});const V=this._context.stage.renderView.textureRepository.acquire(d.texture.id);if(V==null||Eu(V))return d.release(),null;k=V}}const p=ppt(u,n),m={occlusionTest:!0,screenOffset:n.screenOffset,anchorPosition:p,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?m.textureId=o.id:d!=null&&(m.textureId=d.texture.id),n.verticalOffset!=null){const{screenLength:F,minWorldLength:k,maxWorldLength:V}=n.verticalOffset;m.verticalOffset={screenLength:ha(F),minWorldLength:k||0,maxWorldLength:V??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:F,screenSizePerspectiveSettingsLabels:k}=this._context.sharedResources;m.screenSizePerspective=k.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=F}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,s!=null){const F=JSON.stringify(m);y=s.get(F),y==null&&(y=new YS(m),s.add(F,y))}else y=new YS(m);const _=n.translation,v=u?or(u.displayWidth,u.displayHeight):dp,b=n.centerOffset,x=aH(y,hpt,_,null,v,b,[0,0],null),T=_J(this._context,r,x,a,c);if(T==null)return null;const S=new um(this,T.object,[x],s==null?[y]:null,d,Lb,a);S.alignedSampledElevation=T.sampledElevation,S.needsElevationUpdates=Bh(a.mode)||a.mode==="absolute-height";const{displayWidth:A,displayHeight:C}=u??n;S.getScreenSize=(F=Ne())=>(F[0]=A,F[1]=C,F);const R=new $Ee(n.elevationOffset,i);return S.metadata=R,LR(S,r,this._context.elevationProvider),S}};function Zle(t,e,r){t&&t.forEach(i=>{const n=e(i);n!=null&&r(n,i.graphic)})}function ppt(t,e){if(e.verticalPlacement==="baseline"){const i=zlt[e.horizontalPlacement],n=t!=null?t.baselineAnchorY:0;return or(i,n)}const r=Vlt(e.horizontalPlacement,e.verticalPlacement);return QD[r]}const fpt={mode:"relative-to-ground",offset:0},mpt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},gpt=["polyline","polygon","extent"];let dW=class Lv extends hm{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,gpt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new wp);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const e=new e3e,r=this.symbolLayer.color;r!=null&&(e.color=it.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?Lv.headingVectorFromAngle(this.symbolLayer.waveDirection):or(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=mpt[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new KCe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=WP(Lv.elevationModeChangeTypes,i,n);if(s!==an.UPDATE)return s;const o=Bh(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var d;const n=FR(e.geometry);if(n==null)return null;const s=VJ(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=s.position.length/3,a=Ys(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new ypt(s,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(d=this._context.stage.renderView)==null?void 0:d.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new h0({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),u=new um(this,c,l.outGeometries,null,null,EEe,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=Bh(r.mode),u}_createUVCoordsFromVertices(e,r,i,n){const s=el(n);Ih(z0);for(let l=0;l<i;l++)er(Qle,r[3*l],r[3*l+1]),_Y(z0,Qle);ew(z0,z0,s);const o=z0[0]%Lv.unitSizeOfTexture,a=z0[1]%Lv.unitSizeOfTexture;LI[0]=z0[0]-o,LI[1]=z0[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*s-LI[0])/Lv.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*s-LI[1])/Lv.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(vi(Z1),lu(Z1,a),!Hd(Z1,this._context.clippingExtent)))continue;const c=QS(a,l,3);if(c.length===0)continue;const u=Ch(i,2*s,2*n),d=iae({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(d)}}_createAsOverlay(e){var a;const r=FR(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=h3e(r,this._context.overlaySR),n=i.position.length/3,s=Ys(2*n);this._createUVCoordsFromVertices(s,i.position,n,this._context.overlaySR);const o=new _pt(i,s,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=vi(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new G8(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of i){if(vi(Z1),lu(Z1,n),!Hd(Z1,this._context.clippingExtent))continue;SS(e.outBoundingBox,Z1);const l=QS(n,s,3);if(l.length===0)continue;const c=Ch(r,2*o,2*a),u=iae({material:this._material,indices:l,attributeData:{position:n,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new KS(u,e))}}static headingVectorFromAngle(e){const r=Ne(),i=l6(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};dW.unitSizeOfTexture=100,dW.elevationModeChangeTypes={definedChanged:an.RECREATE,staysOnTheGround:an.NONE,onTheGroundChanged:an.RECREATE};const LI=Ne(),z0=jt(),Qle=Ne(),Z1=ps();let ypt=class extends N8{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}},_pt=class extends N8{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}};function vpt(t,e,r,i){var s;const n=((s=wpt[t.type])==null?void 0:s[e.type])||bpt[e.type];return n?new n(t,e,r,i):(J.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const bpt={icon:sW,object:Sht,line:rAe,path:Cdt,fill:iOe,extrude:fat,text:dpt,water:dW},wpt={"mesh-3d":{fill:Hct}};let xpt=class extends mJ{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const n=this.symbolLayers[i];n!=null&&(n.symbol=e,n.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let s=0;s<i;s++){const o=r.at(s);if(o.enabled===!1)continue;DI.renderPriority=1-(1+s)/i,DI.renderPriorityStep=1/i,DI.ignoreDrivers=o.ignoreDrivers;const a=vpt(this.symbol,o,this._context,DI),l=CX(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await r6(this.symbolLayers,async(s,o)=>{if(s!=null)try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),Bt(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,n=this.symbolLayers.map(o=>(o==null?void 0:o.createGraphics3DGraphic(e))??null),s=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new _nt(i,r||this,n,e.layer,s)}get complexity(){return yJ(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let n=0;n<i;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof um?l:null};if(s!=null&&!s.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==eu.LOADED?$n.RecreateSymbol:this.symbolLayers.reduce((i,n)=>i!==$n.RecreateSymbol&&n!=null?Math.min(i,n.applyRendererDiff(e,r)):i,$n.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===eu.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const o=i[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[s];u!=null&&a.graphics3DGraphicPatches.forEach(d=>d(u,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,n)=>i.updateGeometry(n,r))}updateTransform(e,r,i,n){return this._updateGeometryOrTransform(e,(s,o)=>s.updateTransform(o,r,i,n))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const n=this.symbolLayers[i];if(n==null)continue;const s=e.layers[i];if(!s||!r(n,s))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const n=e.layers[r];n!=null&&i.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===eu.LOADING?e++:n.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,n){const s=this.symbolLayers.filter(aP).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,n)),o=await Promise.all(s);return Bt(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const DI=new vnt;let Tpt=class extends mJ{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:gJ}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):$n.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,n){var s;return((s=this.graphics3DSymbol)==null?void 0:s.updateTransform(e,r,i,n))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function sK(t){return t instanceof Tpt?t.graphics3DSymbol:t instanceof xpt?t:null}const BR=J.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Spt(t){const e=Ipt(t);if(e==null)return null;const r=Ept(t,e);if(r==null)return null;const i=r.anchor,n=!!e.hasLabelVerticalOffset;return Apt({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Ne(),centerOffset:$t(0,0,0,-1),centerOffsetUnits:"world",translation:O(),elevationOffset:0,hasLabelVerticalOffset:n},r,t)}function Ept(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=Yd[r],n=i||Y5(t);return r&&!i&&BR.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),Cpt(n,t)}function oK(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=sK(e);return r!=null?r.symbol.symbolLayers.at(0):null}function Cpt(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(BR.warnOncePerTick(Jle(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),Y5(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return BR.warnOncePerTick(Jle(t==null?void 0:t.placement,`'${i}' geometries`)),Y5(e);break;case"point":case"mesh":return t}return t}function Jle(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function Y5(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=oK(t);return r!=null&&r.type==="extrude"?Yd["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Yd["above-center"];default:return}}function Apt(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":Rpt(t,e,r);break;case"polygon":Opt(t,e,r);break;case"mesh":aK(t,e,r.graphics3DGraphic.layers[0])}return t}function Opt(t,e,r){const i=oK(r);if(i!=null)switch(i.type){case"extrude":{const n=r.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(xO),jd(xO,t.translation),t.translation[2]=c1(xO)/2):ne(t.translation,0,0,0),aK(t,e,n);break}}}function Rpt(t,e,r){const i=oK(r);if(i==null)return;const n=r.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):ne(t.translation,0,0,0),i.type){case"icon":case"text":Ppt(t,e,r,n);break;case"object":aK(t,e,n)}}function Ppt(t,e,r,i){const{graphics3DGraphic:n}=r,s=i!=null?i.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Yd[r.labelClass.labelPlacement]&&BR.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=Mpt(r);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-o[0]);const a=s[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function Mpt(t,e=Lpt){const{graphics3DGraphic:r}=t,i=r.layers[0],n=i!=null?i.stageObject.geometries[0].material:null;if(n&&n instanceof YS){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function aK(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(xO):xO,n=Se(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Te(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function $pt(t){return t==="above-center"}function Ipt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,n=sK(i.graphics3DSymbol),s=_h(n,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Yd[e]||Y5(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Kle(s.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&$pt(o.placement)?{placement:"above-center",verticalOffset:Kle(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(BR.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function Kle(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const Yd={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},ece={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in ece){const e=ece[t],r=Yd[t];e.forEach(i=>{Yd[i]=r})}Object.freeze&&(Object.freeze(Yd),Object.keys(Yd).forEach(t=>{var e;Object.freeze(Yd[t]),Object.freeze((e=Yd[t])==null?void 0:e.normalizedOffset)}));const Lpt=[0,0],xO=ps();let tce=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const NI=4096;let Dpt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=Qt()}},Npt=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new Dpt,this.rendered=!1}},Fpt=class{constructor(e,r,i){this.size=e,this.cursor=r,this.lineHeight=i}resize(e){this.size.height=e}resetCursor(){this.cursor.x=TO,this.cursor.y=TO+lOe,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}},aA=class extends xe{constructor(e){super(e),this.type=on.Texture,this.id=wc(),this.events=new Bn,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new Fpt({width:NI,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=Le(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const r=new pr;return r.wrapMode=Pt.CLAMP_TO_EDGE,r.flipped=!0,r.samplingMode=At.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,r}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new Ct(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(dt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Pi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=Le(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,r,i,n){const s=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,gi(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+a)/s.size.height,(e.placement.offset.x+o)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,n),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].setAttributeData(E.SIZE,[0,0]),r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,n=e.textId,s=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=s+TO,l=o+TO+lOe;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=i.cursor.y+l+i.lineHeight-i.size.height,u=i.size.height+c<NI;if(u){const d=Math.ceil(i.size.height*Math.max(1.3,(c+i.size.height)/i.size.height));this._resizeAtlas(Math.min(MJ(d),NI))}return!r||!u&&i.size.height===NI?(this._processRemovals(),_T.OK):(this._repack(),_T.REPACK)}i.cursor.x=TO,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n)}return _T.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].setAttributeData(E.UV0,e.placement.uvMinMax),i.geometries[0].setAttributeData(E.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(this._glTexture==null)return Ho.YIELD;let i=!1;if(Do(this._elementsToAddOrUpdate,(s,o)=>{const a=this._elements.get(o);if(a!=null&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const u=c.geometries[0],d=this._elements.get(o);u.setAttributeData(E.UV0,d.placement.uvMinMax),u.setAttributeData(E.SIZE,[d.textRenderer.displayWidth,d.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===_T.REPACK&&(i=!0,!0)}),i)return this.runTask(Wa,!1),void e.madeProgress();let n=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),Do(this._elementsToRender,(s,o)=>(this._processRenderingRequest(s),this._elementsToRender.delete(o),n=!0,e.madeProgress(),e.done)),n&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&Knt.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new Npt(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,n)=>e.push({element:i,key:n}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,n)=>i.key.localeCompare(n.key)),this._elements.clear();for(const{element:i,key:n}of e)this._elements.set(n,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:n}=this,s=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:n,resizeAtlas:o=>s._resizeAtlas(o),run:(o,a)=>s.runTask(o,a)}}};h([f({constructOnly:!0})],aA.prototype,"view",void 0),h([f({type:Boolean})],aA.prototype,"updating",void 0),aA=h([N("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],aA);const TO=2,lOe=2;var _T;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(_T||(_T={}));let rce=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},Upt=class{constructor(e,r,i,n,s){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},kpt=class{constructor(e,r,i,n,s,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new CCe(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},Dv=class extends xe{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Vi,this._handles.add([ue(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ue(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(dt.LABELER,this)]),this._textTextureAtlas=new aA({view:this.view}),this._hudMaterialCollection=new tce(this.view._stage),this._calloutMaterialCollection=new tce(this.view._stage)}dispose(){this._handles=Me(this._handles),this._textTextureAtlas=Le(this._textTextureAtlas),this._hudMaterialCollection=Le(this._hudMaterialCollection),this._calloutMaterialCollection=Le(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),sd.graphic=null,sd.renderingInfo=null,sd.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const n=new rce(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n),r.setVisibilityFlag(js.LABEL,Uo.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(js.LABEL,Uo.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Ho.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!ice(r)){if(zpt(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),Az(r)){this._dirty=!0;continue}if(!ice(r))continue}Do(r.labelsToInitialize,(i,n)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(n,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),Bt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,n=i.layer,s=n.labelingInfo&&n.labelingInfo.filter(c=>!!c.symbol);!s||s.length===0||(await r6(s,async(c,u)=>{const d=c.symbol,p=sK(i.getOrCreateGraphics3DSymbol(d));if(p==null)return void J.getLogger(this).error("Failed to create Graphics3DSymbol for label");await p.load(),Bt(r);let m=null;iZ(d)&&d.hasVisibleCallout()&&(m=qit(d,i.symbolCreationContext),await m.load(),Bt(r));const y=await Ng(bEe(c,e.layer.fieldsIndex,this.view.spatialReference));if(Bt(r),y.ok===!0){const _=await this._createTextRenderParameters(p.symbol);Bt(r),e.labelClassContexts[u]=new Upt(c,p,m,_,y.value)}else J.getLogger(this).error(`Label expression failed to evaluate: ${y.error}`)}),Bt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(Zn(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return(r==null?void 0:r.type)!=="text"?null:oOe.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,yu(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,n,s){const o=new xEe(i.verticalOffset,sle(i.anchor),Blt(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return sd.graphic=r,sd.renderingInfo=null,sd.layer=n,s.createLabel(sd,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,n,s){return sd.graphic=e,sd.layer=s,sd.renderingInfo=new Hit(null,r,n.translation,n.centerOffset,n.screenOffset,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(sd)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,n=i.labelClassContexts;if(!n||n.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let s=!1;const o=r.graphic,a=i.layer,l=FI(i.layer);for(let u=0;u<n.length;u++){const d=e.textRenderers[u],p=e.textLabelPlacements[u];if(d==null||p==null)continue;const m=n[u],y=m.graphics3DSymbol,_=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,v=y.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(i.elevationInfoOverride);const b=this._createTextSymbolGraphic(d,o,p,a,v);if(b==null)return!1;b._labelClass=m.labelClass,b._labelIndex=u,r.addLabelGraphic(b,i.stageLayer),r.deconflictionPriority=((c=m.textRenderParameters)==null?void 0:c.definition.size)??0,r.setVisibilityFlag(js.LABEL,Uo.USER,l),r.setVisibilityFlag(js.LABEL,Uo.SCALE_RANGE,!0),r.setVisibilityFlag(js.LABEL,Uo.DECONFLICTION,!1),s=!0;const x=m.graphics3DCalloutSymbolLayer;if(x&&p.hasLabelVerticalOffset){x.setElevationInfoOverride(i.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,_,x,p,a);T!=null&&(m.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(T,i.stageLayer))}break}return i.scaleVisibility&&s&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const n=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];n!=null&&n.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const x=l.needsHydrationToEvaluate()?Ort(n,r.layer):n;c=l.evaluate(x)}catch{c=null}else c=l.evaluate(n);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,d=((s=u.symbol)==null?void 0:s.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const p=e.graphics3DGraphic,m=a.labelClass,y=r.disablePlacement,_=Spt({graphics3DGraphic:p,labelSymbol:d,labelClass:m,disablePlacement:y});if(_==null)continue;const v=sle(_.anchor),b=Y3e(v);e.textRenderers[o]=new q3e(c,b,a.textRenderParameters),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const n=new rce(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,n=this._labels.get(i);e.graphics.delete(i),n&&(this._destroyGraphic(n,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const n=e.graphics.get(i);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const n=new Map;r.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const r=FI(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const n=this._labels.get(i);n&&(this._destroyGraphic(n,i),n.visible=!1,n.rendered=!1,e.labelsToInitialize.set(i,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const n=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new kpt(this.view._stage,a,e,r,n,s,o,FI(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>FI(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(n=>this._removeGraphic(r,n)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,n=this._labels.get(i);n&&n.visible!==r&&(r&&!n.rendered?(this._labelsToAdd.set(i,n),this._labelsToRemove.delete(i),n.textInitialized||n.labelingContext.labelsToInitialize.set(i,n)):!r&&n.rendered&&(this._labelsToRemove.set(i,n),this._labelsToAdd.delete(i)),n.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>Az(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(Az(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Az(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function ice(t){return t.labelClassContexts&&t.labelClassContexts.length}function zpt(t){return t.labelClassContexts===null}function FI(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}h([f({constructOnly:!0})],Dv.prototype,"view",void 0),h([f({constructOnly:!0})],Dv.prototype,"deconflictor",void 0),h([f()],Dv.prototype,"_textTextureAtlas",void 0),h([f({type:Boolean,readOnly:!0})],Dv.prototype,"updating",null),Dv=h([N("esri.views.3d.layers.graphics.Labeler")],Dv);const sd=new Wit(null,null,null);let lA=class $2{constructor(e,r,i,n=null){this.lij=[0,0,0],this.extent=jt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:ia.VISIBLE_ON_SURFACE,screenRect:jt(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,r,i,n)}acquire(e,r,i,n){this.tilingScheme=n,this.id=$2.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,n.getExtent(e,r,i,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(r,i,n,this.tilingScheme),e[1].acquire(r,i+1,n,this.tilingScheme),e[2].acquire(r,i,n+1,this.tilingScheme),e[3].acquire(r,i+1,n+1,this.tilingScheme),e):[new $2(r,i,n,this.tilingScheme),new $2(r,i+1,n,this.tilingScheme),new $2(r,i,n+1,this.tilingScheme),new $2(r,i+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Ug(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var ia;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(ia||(ia={}));const cOe=.5*Math.PI,Bpt=cOe/Math.PI*180;let Vpt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:O(),direction:O()};for(let r=0;r<4;r++)this._extent[r]={origin:O(),direction:O(),cap:{next:null,direction:O()}},this._planes[r]=Er();this._planes[si.NEAR]=Er(),this._planes[si.FAR]=Er(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,r,i),oe(this._center.origin,s[0].origin,s[2].origin),te(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||te(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,Qg(a.cap.direction,a.origin,l.origin),mR(a.direction,a.cap.direction,a.origin,this._planes[o]),n||te(a.direction,a.direction,-1)}mR(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[si.NEAR]),n?HG(this._planes[si.NEAR],this._planes[si.FAR]):(V6(this._planes[si.FAR],this._planes[si.NEAR]),HG(this._planes[si.NEAR],this._planes[si.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Mr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===$e.Global){const s=this._maxSpanSpatialReference.isGeographic?Bpt:cOe*r;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(i||!e.intersectsRay(bu(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!i&&e.intersectsRay(bu(o.origin,o.direction))||e.intersectsLineSegment(Pb(o.origin,o.cap.next,jpt),o.cap.direction))return!0}const n=i?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(sZe(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){vY(e,od),od[2]=i,ma(r,od,Oz,this._renderCoordsHelper.spatialReference),us(nce,Oz),vi(Vl);for(const{x0:s,x1:o,y0:a,y1:l}of Gpt)for(let c=0;c<5;c++){const u=c/4;od[0]=wt(e[s],e[o],u),od[1]=wt(e[a],e[l],u),od[2]=i,Cs(od,r,od,this._renderCoordsHelper.spatialReference),De(od,od,nce),Xf(Vl,od)}ne(this._extent[0].origin,Vl[0],Vl[1],Vl[2]),ne(this._extent[1].origin,Vl[3],Vl[1],Vl[2]),ne(this._extent[2].origin,Vl[3],Vl[4],Vl[2]),ne(this._extent[3].origin,Vl[0],Vl[4],Vl[2]);for(let s=0;s<4;++s)De(this._extent[s].origin,this._extent[s].origin,Oz)}_toRenderBoundingExtentLocal(e,r,i){RP(e,r,Tm,this._renderCoordsHelper.spatialReference),ne(this._extent[0].origin,Tm[0],Tm[1],i),ne(this._extent[1].origin,Tm[2],Tm[1],i),ne(this._extent[2].origin,Tm[2],Tm[3],i),ne(this._extent[3].origin,Tm[0],Tm[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case $e.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case $e.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(oi(e.planes[si.NEAR],this._center.origin)<0&&fe(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(oi(e.planes[si.NEAR],i.origin)<0&&fe(i.direction,e.direction)<0)return!0}return!1}};const Gpt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],od=O(),Oz=_e(),nce=_e(),Vl=ps(),Tm=jt(),jpt=_p();let Hpt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new Wy(e),this._extendedFrustum=new Wy(e),this._intersector=new Vpt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return ia.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===$e.Global&&e.lij[0]>=Wpt&&e.lij[0]<qpt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==ia.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=Wy.nearFarLineIndices,i=e.mutablePoints;for(const n of r){const[s,o]=n,a=i[s],l=i[o];ae(Fc,l,a),te(Fc,Fc,Ypt),oe(i[o],a,Fc)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=ia.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const n=lce.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==ia.INVISIBLE&&(r=o,o===ia.VISIBLE_ON_SURFACE))break}return lce.release(n),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const n=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===$e.Global&&e.lij[0]<Xpt?this._calculateSingleTileVisibilitySided(e,!1)===ia.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Mr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?ia.VISIBLE_ON_SURFACE:ia.VISIBLE_WHEN_EXTENDED:ia.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Fc);this._aboveGround||fa(r,r);const i=As(-fe(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Fc),a){case Xe.FAR_BOTTOM_LEFT:case Xe.FAR_TOP_LEFT:case Xe.NEAR_BOTTOM_LEFT:case Xe.NEAR_TOP_LEFT:WG(this._extendedFrustum.planes[si.LEFT],Fc,Fc);break;case Xe.FAR_BOTTOM_RIGHT:case Xe.FAR_TOP_RIGHT:case Xe.NEAR_BOTTOM_RIGHT:case Xe.NEAR_TOP_RIGHT:WG(this._extendedFrustum.planes[si.RIGHT],Fc,Fc)}te(Fc,Fc,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(bu(l,Fc),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),oa(s[Xe.NEAR_BOTTOM_LEFT],s[Xe.NEAR_BOTTOM_RIGHT],s[Xe.NEAR_TOP_RIGHT],oce),oa(s[Xe.NEAR_BOTTOM_RIGHT],s[Xe.NEAR_TOP_RIGHT],s[Xe.NEAR_TOP_LEFT],ace),fe(oce,ace)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[Xe.NEAR_BOTTOM_LEFT],o[Xe.NEAR_BOTTOM_RIGHT]]=[o[Xe.NEAR_BOTTOM_RIGHT],o[Xe.NEAR_BOTTOM_LEFT]]:[o[Xe.NEAR_TOP_LEFT],o[Xe.NEAR_TOP_RIGHT]]=[o[Xe.NEAR_TOP_RIGHT],o[Xe.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-sce;return{zWithMargin:e,pointIndices:Wy.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+sce;return{zWithMargin:e,pointIndices:Wy.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const Wpt=2,qpt=6,Xpt=12,Ypt=.95,sce=1,Fc=O(),oce=Er(),ace=Er(),lce=new ko(Array,t=>{t.length!==4&&(t[0]=new lA,t[1]=new lA,t[2]=new lA,t[3]=new lA)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let Zpt=class{constructor(e){this._camera=new lt,this._focusOnMap=[0,0],this._screenRect=jt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new Hpt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,yY(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=a8e(e.extent,this._focusOnMap),e.measures.visibility!==ia.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=Qpt,i=1<<r,n=e.measures.screenRect;Ih(n);let s=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),u=c*c;for(let d=0;d<i;d++)for(let p=0;p<i;p++)if(s+=this._computeScreenArea(e,o,a+d,l+p,n),s>u)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===ia.VISIBLE_WHEN_EXTENDED?this._tileSize*Jpt:this._tileSize}_computeScreenArea(e,r,i,n,s){const o=e.measures.visibility===ia.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,n,o,B0),Ih(Rz);for(let a=0;a<4;a++)_Y(Rz,B0[a]);return S_(s,Rz,s),Lne(B0[0],B0[1],B0[2])+Lne(B0[0],B0[2],B0[3])}_projectToScreen(e,r,i,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,UC),this._toRenderCoords(UC,0,3,V0[0]),this._toRenderCoords(UC,2,3,V0[1]),this._toRenderCoords(UC,2,1,V0[2]),this._toRenderCoords(UC,0,1,V0[3]),n&&(this._projectToPlane(V0,this._camera.frustum[si.NEAR]),this._projectToPlane(V0,this._camera.frustum[si.TOP]),this._projectToPlane(V0,this._camera.frustum[si.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(V0[o],cce),this._camera.renderToScreen(cce,s[o])}_projectToPlane(e,r){for(let n=0;n<4;n++)zC[n]=oi(r,e[n]);const i=Math.max(zC[0],zC[1],zC[2],zC[3]);if(i>0){const n=te(kC,r,-i);for(let s=0;s<4;s++)oe(e[s],e[s],n)}}_toRenderCoords(e,r,i,n){return kC[0]=e[r],kC[1]=e[i],kC[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(kC,this._tilingScheme.spatialReference,n),n}};const Rz=jt(),Qpt=2,Jpt=5,B0=[Xi(),Xi(),Xi(),Xi()],UC=jt(),kC=O(),V0=[O(),O(),O(),O()],zC=[0,0,0,0],cce=Vo();function N5t(t,e,r){if(t==null||r==null)return!1;let i=!0;return ts[0]=t.xmin!=null?t.xmin:0,ts[1]=t.ymin!=null?t.ymin:0,ts[2]=t.zmin!=null?t.zmin:0,i=i&&$i(ts,t.spatialReference,0,e,r,0,1),ts[0]=t.xmax!=null?t.xmax:0,ts[1]=t.ymax!=null?t.ymax:0,ts[2]=t.zmax!=null?t.zmax:0,i=i&&$i(ts,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function uOe(t,e,r){if(t==null||r==null)return!1;let i=!0;return ts[0]=t.xmin!=null?t.xmin:0,ts[1]=t.ymin!=null?t.ymin:0,ts[2]=t.zmin!=null?t.zmin:0,i=i&&$i(ts,t.spatialReference,0,ts,r,0,1),e[0]=ts[0],e[1]=ts[1],ts[0]=t.xmax!=null?t.xmax:0,ts[1]=t.ymax!=null?t.ymax:0,ts[2]=t.zmax!=null?t.zmax:0,i=i&&$i(ts,t.spatialReference,0,ts,r,0,1),e[2]=ts[0],e[3]=ts[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const ts=O();let ho=class extends xe{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void J.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=jt();return uOe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new ir,this.tileSize=512,this._idToTile=new Map,this._handles=new Vi,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Nt}initialize(){this._handles.add([ue(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Br),ue(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),An)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(dt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Pi(this._frameWorker),this._handles=Me(this._handles)}addClient(){const e=eft();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Za(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Wa))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=dt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=dt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Zpt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new lA(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const n=r.measures.screenRect,s=i.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),Ih(UI);for(let r=0;r<e.length;r++)if(S_(UI,e.data[r].measures.screenRect,UI),lp(UI)>tft)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!f6(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==ia.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const r=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),i=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===ia.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};h([f({constructOnly:!0})],ho.prototype,"scheduler",void 0),h([f({constructOnly:!0})],ho.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],ho.prototype,"tilingSchemeOwner",void 0),h([f({constructOnly:!0})],ho.prototype,"cameraOnSurface",void 0),h([f({constructOnly:!0})],ho.prototype,"focus",void 0),h([f({constructOnly:!0})],ho.prototype,"viewState",void 0),h([f({constructOnly:!0})],ho.prototype,"terrain",void 0),h([f()],ho.prototype,"tiles",void 0),h([f()],ho.prototype,"tileSize",void 0),h([f({readOnly:!0})],ho.prototype,"tilingScheme",null),h([f()],ho.prototype,"filterExtent",null),h([f({readOnly:!0})],ho.prototype,"_filterExtentRect",null),h([f({readOnly:!0})],ho.prototype,"_rootTileIds",null),h([f({value:!1})],ho.prototype,"suspended",null),h([f({readOnly:!0})],ho.prototype,"updating",null),ho=h([N("esri.views.3d.layers.support.FeatureTileTree3D")],ho);let Kpt=0;function eft(){return Kpt++}const UI=jt(),tft=10;let Ji=class extends xe{constructor(){super(...arguments),this._propertiesPool=new jg({camera:lt},this),this._lastSeenCameraProjectionValues=new lt,this.mode=Cr.ANIMATING,this._cssCamera=new lt,this._camera=new lt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Bn,this.viewingMode=$e.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new Bm({mode:this.viewingMode}))}exit(){var e;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new jg({camera:lt},this)}destroy(){var e,r;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,(r=this._propertiesPool)==null||r.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===$e.Global){const e=Mr(this.spatialReference).radius;this.camera=new lt({eye:Se(4*e,0,0),center:Se(e,0,0),up:Se(0,0,1)})}else this.camera=new lt({eye:Se(0,0,100),center:Se(0,0,0),up:Se(0,1,0)})}get animation(){return this.cameraController instanceof OR&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/n),e.width=Math.round(i/n),e}set camera(e){e!==Iu&&Iu.copyFrom(e),Iu.computeUp(this.viewingMode),this.events.emit("before-camera-change",Iu);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Iu)&&(this._lastSeenCameraProjectionValues.copyFrom(Iu),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(Iu)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Iu),this._cameraChanged=!r.almostEquals(Iu),this._cameraChanged)){const i=Fge(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Cr.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===$e.Global}get isLocal(){return this.viewingMode===$e.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(uce),this.addHandles(Dh(()=>e.state===Wi.Finished||e.state===Wi.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),uce),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Wi.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Wi.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Iu.copyFrom(this._get("camera")),e(Iu),this.camera=Iu,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[Yt.TOP]!==r.padding[Yt.TOP]||e.padding[Yt.RIGHT]!==r.padding[Yt.RIGHT]||e.padding[Yt.BOTTOM]!==r.padding[Yt.BOTTOM]||e.padding[Yt.LEFT]!==r.padding[Yt.LEFT]}};h([f()],Ji.prototype,"mode",void 0),h([f({readOnly:!0,type:DS})],Ji.prototype,"animation",null),h([f({type:lt})],Ji.prototype,"camera",null),h([f({type:lt})],Ji.prototype,"cssCamera",null),h([f()],Ji.prototype,"_cssCamera",void 0),h([f()],Ji.prototype,"_camera",void 0),h([f({readOnly:!0})],Ji.prototype,"pixelRatio",null),h([f()],Ji.prototype,"rasterPixelRatio",void 0),h([f()],Ji.prototype,"contentPixelRatio",void 0),h([f({readOnly:!0})],Ji.prototype,"alignPixelEnabled",null),h([f({readOnly:!0})],Ji.prototype,"updating",null),h([f({})],Ji.prototype,"_contentCamera",void 0),h([f({type:lt})],Ji.prototype,"contentCamera",null),h([f({readOnly:!0})],Ji.prototype,"fixedContentCamera",null),h([f({readOnly:!0})],Ji.prototype,"constraints",void 0),h([f({readOnly:!0})],Ji.prototype,"events",void 0),h([f({readOnly:!0})],Ji.prototype,"isGlobal",null),h([f({readOnly:!0})],Ji.prototype,"isLocal",null),h([f({readOnly:!0})],Ji.prototype,"viewingMode",void 0),h([f({readOnly:!0})],Ji.prototype,"spatialReference",void 0),h([f()],Ji.prototype,"navigating",null),h([f()],Ji.prototype,"stationary",null),h([f()],Ji.prototype,"_cameraChanged",void 0),h([f()],Ji.prototype,"cameraController",null),Ji=h([N("esri.views.3d.state.ViewState")],Ji);const rft=Ji,Iu=new lt,uce="ViewStateHandles";let ift=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Nt,this._tolerance=BS,this._tmpRay=qs(),this._tmpRegion=jt(),this._validateHUDIntersector=zh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),hce(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,hce(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,n){return r.options.selectionMode=!1,r.options.store=To.MIN,this.computeIntersection(e,r,n),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,n=.5){return e.getRenderCenter(BI,i,n),BI[0]+=.0466,BI[1]-=.0123,LQ(e,BI,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const n=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||bp(n)&&n.intersector!==Ui.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=BS){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Ui.TERRAIN?1:i.type===Ui.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Ui.TERRAIN?1:i.type===Ui.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return Q2e(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==$e.Local||e==null||oe(r,e.origin,me(Ie.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,n)}_intersectElevation(e,r,i=0,n=null){if(e==null)return null;const s=r!=null?r.mode:"absolute-height",o=(r==null?void 0:r.offset)??0,a=s!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,zI)){const x=this._view.computeMapPointFromVec3d(zI);return x.z??(x.z=0),x.z-=o,x}return null}const c=this._view.state.camera,u=Ie.get();c.projectToRenderScreen(e.origin,u);const d=new dce(null,this._forEachLayer),p=this._view.slicePlane,m=p!=null?xse(p):null,y=zh(this.viewingMode);y.options.store=To.MIN,y.options.verticalOffset=l;const _=e.origin,v=oe(Ie.get(),_,e.direction);y.reset(_,v,c),y.point=u;const b=n?"type"in n&&n.type==="graphics"?x=>x.layerUid!==n.uid:x=>x.graphicUid!==n.uid:null;switch(s){case"relative-to-scene":{const x=T=>(!b||b(T))&&!!T.lastValidElevationBB;y.intersect(d.layers,u,this._tolerance,null,x),this._externalIntersectionHandlers.forAll(T=>{if(T.type===Ui.I3S||T.type===Ui.TERRAIN){const S=T.slicePlaneEnabled?m:null;T.intersect(y,S,y.rayBegin,y.rayEnd,u)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(x=>{if(x.isGround){const T=x.slicePlaneEnabled?m:null;x.intersect(y,T,y.rayBegin,y.rayEnd,u)}})}if(y.results.min.getIntersectionPoint(zI)){const x=this._view.computeMapPointFromVec3d(zI);return x.z=i,x}return null}computeIntersection(e,r,i){var y;if(e==null)return;const n=this._view.state.camera,s=Ie.get();n.projectToRenderScreen(e.origin,s);const o=new dce(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=oe(Ie.get(),e.origin,e.direction);r.reset(a,l,n),r.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,u=c!=null?xse(c):null;r.intersect(o.sliceableLayers,s,this._tolerance,u);const d=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(_=>{const v=_.layerUid,b=Array.isArray(v),x=b?v:[v];b&&(r.options.filteredLayerUids=[]);let T=!1;for(const S of x)o.filterLayerUid(S)?T=!0:b&&r.options.filteredLayerUids.push(S);if(r.options.isFiltered=!T,_.isGround&&d||!r.options.isFiltered){const S=_.slicePlaneEnabled?u:null;_.intersect(r,S,a,l,s)}});const p=Ie.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&m.spatialReference!=null&&r.results.ground.getIntersectionPoint(p)){const _=m.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,b=Ie.get();this._view.renderCoordsHelper.fromRenderCoords(p,b,m.spatialReference),b[2]=((y=this._view.elevationProvider)==null?void 0:y.getElevation(p[0],p[1],p[2],v,"ground"))??0,_.intersect(r,b,r.results.ground,x=>o.filterRenderGeometry(x))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;Ug(this._tmpRegion,s7);const i=this._view.state.camera,n=[],s=this._tmpRegion,o=b=>{const x=new sft(b);i.projectToRenderScreen(b.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),n.push(x),_Y(s,x.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const b of r.all)r.min.target.object!==b.target.object&&r.max.target.object!==b.target.object&&o(b);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,s[0]-cA),u=Math.max(0,s[1]-cA),d=Math.min(nu(s)+2*cA,a-c),p=Math.min(lp(s)+2*cA,l-u),m=new Uint8Array(d*p*4);this._view._stage.renderer.readHUDVisibility(c,u,d,p,m);let y=!0;const _=e.results.max.dist==null;let v=0;for(const b of n)for(const x of nft)if(m[4*(Math.min(b.screenPoint[0]+x[0],a)-s[0]+(Math.min(b.screenPoint[1]+x[1],l)-s[1])*d)]){y&&(e.results.min.copy(b.result),y=!1),_&&e.results.max.copy(b.result),e.options.store===To.ALL&&e.results.all.splice(v++,0,b.result);break}}};const cA=1,nft=(()=>{const t=[],e=cA;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let sft=class{constructor(e){this.result=e,this.screenPoint=Vo()}},kI;function hce(t){return kI&&kI.viewingMode===t||(kI=zh(t)),kI}let dce=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function pce(t){return typeof t=="object"&&"intersect"in t}const zI=O(),BI=Vo();let V5t=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,n,s){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,s,i,n)}},oft=class{constructor(e,r,i,n){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(dt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,n=0){const s=Wo(),o={x:e,y:r,minDemResolution:n,result:s,signal:i};return this._queries.push(o),pa(i,()=>{vX(this._queries,o),s.reject(wr())}),s.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void e.madeProgress();const n=r.map(u=>[u.x,u.y]),s=r.reduce((u,d)=>Math.min(u,d.minDemResolution),1/0),o=new yP({points:n,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let u=0;r.forEach(d=>pa(d.signal,()=>{u++,d.result.reject(wr()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((d,p)=>{d.signal!=null&&d.signal.aborted?d.result.reject(wr()):d.result.resolve(u.geometry.points[p][2])})}).catch(u=>{r.forEach(d=>d.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(Wa)}}},uA=class extends Bn.EventedMixin(xe){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Me(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new oft(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&Js(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=VI(o,this._im,e,r,i,n,s),o==null&&(o=VI(o,this._ground,e,r,i,n,s)),s==="scene"&&(o=VI(o,this._scene,e,r,i,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:n,queryContext:s,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,n=-1/0;for(const s of[this._im,this._ground,this._scene])s.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),n=Math.max(n,a.max))}});return{min:i,max:n}}queryElevation(e,r,i,n,s,o=null,a=0){const l=Wo();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{s==="scene"&&(c=VI(c,this._scene,e,r,i,n,s)),l.resolve(c)}).catch(c=>{Zn(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,n,s))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){var r;this._handles.has(e)&&((r=this._handles.get(e))==null||r.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const n=i.indexOf(e);n>-1&&i.splice(n,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function VI(t,e,r,i,n,s,o){for(const a of e){const l=a.getElevation(r,i,n,s,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}h([f({constructOnly:!0})],uA.prototype,"view",void 0),h([f()],uA.prototype,"spatialReference",null),uA=h([N("esri.views.3d.support.CombinedElevationProvider")],uA);let hA=class pW{static isValidProfile(e){return e in pW.profiles}static getDefaultProfile(){return se("esri-iPhone")?"low":"medium"}static apply(e,r){const i=pW.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const n=r.sceneService.object,s=i.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function fce(){const t=!!se("esri-mobile"),e=!!se("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!se("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!se("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}hA.test={reset(){const t=fce();for(const e of Object.keys(t))hA.profiles[e]=t[e]}},function(t){t.profiles=fce()}(hA||(hA={}));const eN=hA;function hOe(){return new Float32Array(4)}function aft(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function rm(t,e,r,i){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function lft(t,e){return new Float32Array(t,e,4)}function dOe(){return hOe()}function pOe(){return rm(1,1,1,1)}function fOe(){return rm(1,0,0,0)}function mOe(){return rm(0,1,0,0)}function gOe(){return rm(0,0,1,0)}function yOe(){return rm(0,0,0,1)}const cft=dOe(),uft=pOe(),hft=fOe(),dft=mOe(),pft=gOe(),fft=yOe();Object.freeze(Object.defineProperty({__proto__:null,ONES:uft,UNIT_W:fft,UNIT_X:hft,UNIT_Y:dft,UNIT_Z:pft,ZEROS:cft,clone:aft,create:hOe,createView:lft,fromValues:rm,ones:pOe,unitW:yOe,unitX:fOe,unitY:mOe,unitZ:gOe,zeros:dOe},Symbol.toStringTag,{value:"Module"}));const mce=new it([0,255,255]),gce=new it([0,0,0]),yce=1,_ce=.25,vce=.4,bce=.2;let af=class extends xe{constructor(){super(...arguments),this.color=mce.clone(),this.haloColor=null,this.haloOpacity=yce,this.fillOpacity=_ce,this.shadowOpacity=vce,this.shadowColor=gce.clone(),this.shadowDifference=bce}static toEngineOptions(e){const r=it.toUnitRGBA(e.color??mce),i=e.haloColor!=null?it.toUnitRGBA(e.haloColor):r,n=it.toUnitRGBA(e.shadowColor??gce),s=e.haloOpacity??yce,o=e.fillOpacity??_ce,a=e.shadowOpacity??vce,l=e.shadowDifference??bce;return{color:rm(r[0],r[1],r[2],r[3]),haloColor:rm(i[0],i[1],i[2],i[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:$t(n[0],n[1],n[2],n[3]),occludedShadowOpacity:a*(1-l)}}};h([f({type:it})],af.prototype,"color",void 0),h([f({type:it})],af.prototype,"haloColor",void 0),h([f()],af.prototype,"haloOpacity",void 0),h([f()],af.prototype,"fillOpacity",void 0),h([f()],af.prototype,"shadowOpacity",void 0),h([f({type:it})],af.prototype,"shadowColor",void 0),h([f()],af.prototype,"shadowDifference",void 0),af=h([N("esri.views.3d.support.HighlightOptions")],af);const fW=af;function mft(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function gft(t){return typeof t=="string"?Ja(t):ye(t)}function yft(t,e,r){const i={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){i[n]=[];for(let o=0;o<s.length;o++)i[n][o]=yft(s[o])}else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(r&&r[n]);i[n]=e?o:JSON.stringify(o)}else i[n]=e?s:JSON.stringify(s);else i[n]=s}return i}function q5t(t){return{geometryType:AY(t[0]),geometries:t.map(e=>e.toJSON())}}function _ft(t,e,r){const i=w8e(e);return t.map(n=>{const s=i.fromJSON(n);return s.spatialReference=r,s})}let Nv=class extends ke{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:AY(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};h([f()],Nv.prototype,"geometries",void 0),h([f({json:{read:{source:"outSR"}}})],Nv.prototype,"outSpatialReference",void 0),h([f()],Nv.prototype,"transformation",void 0),h([f()],Nv.prototype,"transformForward",void 0),Nv=h([N("esri.rest.support.ProjectParameters")],Nv);const lK=Nv,vft=Qa(lK);async function _Oe(t,e,r){e=vft(e);const i=gft(t),n={...i.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=AY(e.geometries[0]),a=mft(n,r);return kn(i.path+"/project",a).then(({data:{geometries:l}})=>_ft(l,o,s))}async function cK(t=null,e){var n,s;if(Jr.geometryServiceUrl)return Jr.geometryServiceUrl;if(!t)throw new Y("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||Mh.getDefault():t,await r.load({signal:e});const i=(s=(n=r.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!i)throw new Y("internal:geometry-service-url-not-configured");return i}async function bft(t,e,r=null,i){const n=await cK(r,i),s=new lK;s.geometries=[t],s.outSpatialReference=e;const o=await _Oe(n,s,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new Y("internal:geometry-service-projection-failed")}const wft=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:cK,projectGeometry:bft},Symbol.toStringTag,{value:"Module"}));let xft=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=el(this.spatialReference,Mr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=cK(e&&e.get("portalItem")).catch(()=>{throw new Y("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],n=!1);const s=i.map(l=>l instanceof ze?l:new ze(l,this.spatialReference)),o=new lK({geometries:s,outSpatialReference:St.WGS84}),a=(await _Oe(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}},Od=class extends xe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};h([f()],Od.prototype,"minTotalNumberOfFeatures",void 0),h([f()],Od.prototype,"maxTotalNumberOfFeatures",void 0),h([f()],Od.prototype,"maxTotalNumberOfPrimitives",void 0),h([f()],Od.prototype,"snapshotAvailable",void 0),h([f()],Od.prototype,"polygonLodFactor",void 0),h([f()],Od.prototype,"polylineLodFactor",void 0),h([f()],Od.prototype,"skipHighSymbolLods",void 0),Od=h([N("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Od);let Vf=class extends xe{constructor(){super(...arguments),this.lodFactor=1}};h([f()],Vf.prototype,"lodFactor",void 0),Vf=h([N("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Vf);let Z5=class extends Vf{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};Z5=h([N("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],Z5);let rg=class extends xe{constructor(){super(...arguments),this.object=new Z5,this.point=new Vf,this.integratedMesh=new Vf,this.pointCloud=new Vf,this.uncompressedTextureDownsamplingEnabled=!1}};h([f({type:Z5})],rg.prototype,"object",void 0),h([f({type:Vf})],rg.prototype,"point",void 0),h([f({type:Vf})],rg.prototype,"integratedMesh",void 0),h([f({type:Vf})],rg.prototype,"pointCloud",void 0),h([f()],rg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),rg=h([N("esri.views.3d.support.QualitySettings.SceneServiceSettings")],rg);let Dy=class extends xe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};h([f()],Dy.prototype,"lodBias",void 0),h([f()],Dy.prototype,"angledSplitBias",void 0),h([f()],Dy.prototype,"reduceTileLevelDifferences",void 0),h([f()],Dy.prototype,"textureFadeDuration",void 0),Dy=h([N("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Dy);let vT=class extends xe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([f()],vT.prototype,"pixelRatio",void 0),h([f()],vT.prototype,"maxTotalNumberOfFeatures",void 0),vT=h([N("esri.views.3d.support.QualitySettings.HeatmapSettings")],vT);let Po=class extends xe{constructor(){super(...arguments),this.graphics3D=new Od,this.sceneService=new rg,this.tiledSurface=new Dy,this.heatmap=new vT,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([f({type:Od})],Po.prototype,"graphics3D",void 0),h([f({type:rg})],Po.prototype,"sceneService",void 0),h([f({type:Dy})],Po.prototype,"tiledSurface",void 0),h([f({type:vT})],Po.prototype,"heatmap",void 0),h([f()],Po.prototype,"fadeDuration",void 0),h([f()],Po.prototype,"antialiasingEnabled",void 0),h([f()],Po.prototype,"physicallyBasedRenderingEnabled",void 0),h([f()],Po.prototype,"highQualityTransparency",void 0),h([f()],Po.prototype,"highResolutionAtmosphere",void 0),h([f()],Po.prototype,"reflections",void 0),h([f()],Po.prototype,"ambientOcclusion",void 0),h([f()],Po.prototype,"memoryLimit",void 0),h([f()],Po.prototype,"additionalCacheMemory",void 0),h([f()],Po.prototype,"frameRate",void 0),h([f()],Po.prototype,"maximumPixelRatio",void 0),Po=h([N("esri.views.3d.support.QualitySettings.QualitySettings")],Po);const wce=Po;function Tft(t){return cE(t)&&t.length>=3}function Sft(t){return(uE(t)||Array.isArray(t))&&t.length>=3}function Eft(t){return Tft(t)||Sft(t)}let Cft=class mW{constructor(e,r,i,n){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=n,this._tmpCoordinateSystem=n7e(n)}set extent(e){e&&s7e(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return p7e(this._coordinateSystem,e)}setAltitude(e,r,i=e){return Ube(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){f7e(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return c7e(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return u7e(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,gc.X,Ie.get()),n=this.worldBasisAtPosition(e,gc.Y,Ie.get()),s=this.worldBasisAtPosition(e,gc.Z,Ie.get());return am(r,i[0],i[1],i[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Ie.get()),n=this.worldBasisAtPosition(e,gc.Y,Ie.get()),s=pbe(r,n,i);return Ka(s)}intersectManifoldClosestSilhouette(e,r,i){return xk(this._coordinateSystem,r,this._tmpCoordinateSystem),d7e(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){xk(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=Ie.get();return h7e(this._tmpCoordinateSystem,e,n)?re(i,n):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===$e.Global)return this.intersectManifold(e,r,i);xk(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=Ie.get();return kw(n.plane,e,s)?re(i,s):null}toRenderCoords(e,r,i){return T5(e)?Bi(e,r,this.spatialReference):Cs(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return T5(r)?(i!=null&&(r.spatialReference=i),hZ(e,this.spatialReference,r)):Eft(r)?Cs(e,this.spatialReference,r,i)?r:null:Vg(e,this.spatialReference,r)}static create(e,r){switch(e){case $e.Local:return new mW($e.Local,r,el(r),l7e());case $e.Global:return new mW($e.Global,r,1,a7e(r))}}static renderUnitScaleFactor(e,r){return UV(e)/UV(r)}};var Cf;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Cf||(Cf={}));const Aft=(()=>{const t=new Array;return t[Cf.ELEVATION]=10,t[Cf.BASEMAP]=10,t[Cf.I3S_INDEX]=10,t[Cf.I3S_DATA]=10,t[Cf.SYMBOLOGY]=5,t})(),Oft=30;function vOe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function Rft(t){return new ml({view:t})}const GI=1,Pz=1,Pft=.75,Mft=.6,xce=1.3;let ml=class extends xe{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new t3e,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(GI),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,r){return new dot(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Mft&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(GI);else if(e)(this._memoryPredicted>1.1*Pz||this._usedMemory>Pz)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/xce),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>Pz)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/xce),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<Pft&&this._quality<GI){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),GI))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l;if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const r=((a=this.view)==null?void 0:a._stage)&&this.view._stage.renderView&&((l=this.view._stage.renderer)==null?void 0:l.edgeView);r!=null&&(e+=r.usedMemory);let i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(c=>{if(vOe(c)){const u=c.ignoresMemoryFactor?this._quality:1;e+=c.usedMemory*u,i+=c.unloadedMemory*u}});const n=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&n){this._warnMemoryUsage=e;const c=d=>(d/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",u=Math.round(100*this._quality);J.getLogger(this).warn(`Memory Limit exceeded! Limit: ${c(s)} Current: ${c(e)} Projected: ${c(e+i)} Quality: ${u}%`)}this._usedMemory=e/s,this._memoryPredicted=(e+i)/s;const o=s-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};h([f({constructOnly:!0})],ml.prototype,"view",void 0),h([f()],ml.prototype,"maxMemory",null),h([f()],ml.prototype,"additionalCacheMemory",null),h([f()],ml.prototype,"memoryFactor",null),h([f()],ml.prototype,"updating",null),h([f()],ml.prototype,"usedMemory",null),h([f()],ml.prototype,"_quality",void 0),h([f()],ml.prototype,"_usedMemory",void 0),h([f()],ml.prototype,"_updating",void 0),h([f()],ml.prototype,"_stableQuality",void 0),h([f()],ml.prototype,"_maxMemory",void 0),h([f()],ml.prototype,"_additionalCacheMemory",void 0),ml=h([N("esri.views.3d.support.MemoryController")],ml);let $ft=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},Ift=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new Lft}},Lft=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Dft=class{constructor(e,r,i,n){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=n.map(s=>new Ift(s))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,n)=>this._taskCallback(i,n))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,Je(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},tN=class extends xe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new Dft((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,r),i&&(this._frameTask=i.registerTask(dt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Pi(this._frameTask),this._tasks.forEach(e=>yu(e.abortController)),this._loadQueue=Me(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,n={}){const s=Wo();s.__signal=n!=null?n.signal:null;const o=this._createOrUpdateTask(e,r,i,n,s);return pa(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,r,i,n,s,o){const a=new Uft(e,r,i,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;qO(e.resolvers,r),r.reject(wr()),e.resolvers.length===0&&(e.status===Ju.DOWNLOADING&&(e.status=Ju.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=Ju.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,n,s){const o=kft(n!=null&&n.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,r,i,o,s)}_doneLoadingCB(e,r){this._loadQueue&&(Je(e.status===Ju.DOWNLOADING),e.status=Ju.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();Bt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==Ju.DOWNLOADED&&(r.err=r.err||wr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!Zn(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(r)Zn(r)?n.reject(r):n.reject(new Y("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const s=i<=0?e.result:ye(e.result);n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===Ju.CANCELLED)return!1;let i,n;switch(e.startTime=performance.now(),e.status=Ju.DOWNLOADING,e.docType){case"binary":n="array-buffer",i=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=kn(e.url,{...e.options,responseType:n,timeout:i,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===Ju.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,d=Fft(u);if(n="image",e.size=u.byteLength,d==="unknown")return e.request=kn(e.url,{responseType:n,timeout:i,signal:s}),void e.request.then(y=>a(y.data),l);const p=new Blob([u],{type:d}),m=window.URL.createObjectURL(p);o=()=>window.URL.revokeObjectURL(m),e.request=kn(m,{responseType:n,timeout:i,signal:s}),e.request.then(y=>a(new Q8(y.data,d,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};h([f({readOnly:!0})],tN.prototype,"updating",void 0),tN=h([N("esri.views.3d.support.StreamDataLoader")],tN);const Nft={numRetries:0};function Fft(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let Q8=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},Uft=class extends $ft{constructor(e,r,i,n,s){super(n),this.url=e,this.options=r,this.docType=i,this.key=s,this.result=null,this.status=Ju.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Nft.numRetries}};function kft(t,e,r){return`${t}:${e}:${r}`}var Ju;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Ju||(Ju={}));let rN=class extends xe{constructor(){super(...arguments),this.updating=!1}};function zft(t){return new bd({view:t})}h([f({readOnly:!0})],rN.prototype,"updating",void 0),rN=h([N("esri.views.3d.support.ResourceControllerMain")],rN);let bd=class extends rN{constructor(){super(...arguments),this._immediateTask=LS,this._normalTask=LS,this._updatingObjects=_R([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Aje(),this._memoryController=Rft(this.view),this._streamDataLoader=new tN,this._streamDataLoader.setup(Oft,Aft,this._scheduler),this.addHandles([ue(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Br),ue(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=fS({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(dt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(dt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Pi(this._frameTask),this._streamDataLoader=Me(this._streamDataLoader),this._memoryController=Me(this._memoryController),this._scheduler=Me(this._scheduler),this.view=null}get updating(){var e,r,i,n;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((n=this._updatingObjects)==null?void 0:n.value.some(s=>s.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,n,s)=>r.request(i,n,e,s),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],Za(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(OX(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};h([f()],bd.prototype,"view",void 0),h([f()],bd.prototype,"_scheduler",void 0),h([f()],bd.prototype,"_memoryController",void 0),h([f()],bd.prototype,"_streamDataLoader",void 0),h([f()],bd.prototype,"_immediateTask",void 0),h([f()],bd.prototype,"_normalTask",void 0),h([f()],bd.prototype,"_updatingObjects",void 0),h([f({readOnly:!0})],bd.prototype,"updating",null),bd=h([N("esri.views.3d.support.ResourceControllerImpl")],bd);function Bft(t){return vOe(t)}function Vft(t){return"performanceInfo"in t}var sa,tt;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(sa||(sa={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(tt||(tt={}));const Fx=O(),Gft=O(),Sm=O(),Em=O();function jft(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return Rye(i,e);const n=Math.min(i[2]-i[0],i[3]-i[1]);return o8e(i,e,r*n)}function jI(t,e,r,i){re(Fx,r),Fx[i]=e[i];const n=ae(Fx,Fx,e),s=ae(Gft,t,e),o=fe(s,n),a=fe(n,n);let l;l=o<=0?e:a<=o?r:oe(Fx,e,te(n,n,o/a));const c=ae(Fx,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Hft(t,e,r){const i=t.extent;if(i==null)return 0;Sm[0]=i[0],Sm[1]=i[1],Sm[2]=r,Em[0]=i[2],Em[1]=i[3],Em[2]=r;let n=1/0,s=1/0;return e[0]<Sm[0]?n=jI(e,Sm,Em,0):e[0]>Em[0]&&(n=jI(e,Em,Sm,0)),e[1]<Sm[1]?s=jI(e,Sm,Em,1):e[1]>Em[1]&&(s=jI(e,Em,Sm,1)),Math.min(n,s)}function Wft(t,e,r){if(t==null)return DZ();if(t.spatialReference.isGeographic&&!G_(t.spatialReference))return new Y("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=hc.checkUnsupported(t);if(i!=null)return i;if(r==null)return new Y("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=qft(t,r);if(n)return n;const s=t.spatialReference;return e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new Y("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function qft(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,n=[i*t.size[0],i*t.size[1]],s=[t.origin.x,t.origin.y],o=Aye(e),a=jt();hc.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>aT){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const d=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**d)*10**d,new Y("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:aT})}return null}const Xft=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Wft,isInsideExtent:jft,tiltToExtentEdge:Hft},Symbol.toStringTag,{value:"Module"}));function Yft(){return!0}function Zft(){return 0}function Qft(t,e){if(t==null)return DZ();const r=t.lods.length-1,i=t.spatialReference,n=G_(i)||nm(i)||sm(i);if(i.isWebMercator){if(!hc.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new Y("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new Y("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!hc.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new Y("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new Y("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new Y("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const Jft=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Qft,isInsideExtent:Yft,tiltToExtentEdge:Zft},Symbol.toStringTag,{value:"Module"})),Kft={[$e.Global]:Jft,[$e.Local]:Xft};function _f(t,e){t||console.warn("Terrain: "+e)}let cs=!1,Q5=!1;function emt(t){Q5=t,cs=cs||t}function tmt(t){cs=t}function be(t,e){var r;if(cs&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function gW(t){return J8(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function J5(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function J8(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function uK(t){return(t==null?void 0:t.type)==="tile-3d"}function VR(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function bOe(t){return(t==null?void 0:t.type)==="wmts-3d"}function yW(t){return(t==null?void 0:t.type)==="elevation-3d"}function BC(t){return(t==null?void 0:t.type)==="group"}function K5(t){return t&&(uK(t)||bOe(t)||J8(t)||VR(t))}function _W(t){return t&&(uK(t)||J8(t)||VR(t)||bOe(t))}function GR(t){return _W(t)||yW(t)}function rmt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function wOe(t){return xOe(t==null?void 0:t.sourceLayerInfo)}function imt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function nmt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof Q8||e instanceof HTMLCanvasElement||e instanceof ImageData}function xOe(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function YT(t){return t!=null&&"release"in t&&t.release(),null}function Tce(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function hK(t,e,r,i){return Kft[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function K8(t,e,r){let i=null,n=null;if((t==null?void 0:t.type)==="wmts"){const s=smt(t,e,r);i=s.tileInfo,n=s.fullExtent}else{n=J5(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=r===$e.Local;if(J5(t))i=t.getCompatibleTileInfo(e,n,s);else if((t==null?void 0:t.type)==="vector-tile"){const o=s&&!omt(e)||amt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&n!=null&&hK(i,n,e,r)==null?{tileInfo:i,fullExtent:n}:null}function smt(t,e,r){const i=MFe(t);if(i!=null){if(!ir.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const n=i.find(s=>hK(s.tileInfo,s.fullExtent,e,r)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function omt(t){return t.isWGS84||t.isWebMercator||S0e(t)||!eR(t)}const amt={force512VTL:!1};function Sce(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Cm(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function hh(t,e,r=umt){return Math.abs(t-e)<r}function eF(t){return t===tt.NORTH_EAST?tt.SOUTH_WEST:t===tt.NORTH_WEST?tt.SOUTH_EAST:t===tt.SOUTH_WEST?tt.NORTH_EAST:tt.NORTH_WEST}function tF(t){return t===tt.NORTH?tt.SOUTH:t===tt.EAST?tt.WEST:t===tt.SOUTH?tt.NORTH:tt.EAST}function lmt(t){return t===tt.NORTH_WEST||t===tt.SOUTH_WEST}function cmt(t){return t===tt.NORTH_WEST||t===tt.NORTH_EAST}function Ece(t){return t===tt.NORTH_WEST||t===tt.WEST||t===tt.SOUTH_WEST}function Cce(t){return t===tt.NORTH_EAST||t===tt.EAST||t===tt.SOUTH_EAST}function Ace(t){return t===tt.SOUTH_EAST||t===tt.SOUTH||t===tt.SOUTH_WEST}function Oce(t){return t===tt.NORTH_EAST||t===tt.NORTH||t===tt.NORTH_WEST}const Rf=[tt.NORTH,tt.EAST,tt.SOUTH,tt.WEST],jR=[tt.NORTH_EAST,tt.SOUTH_EAST,tt.SOUTH_WEST,tt.NORTH_WEST],umt=1e-5;let hmt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=GR(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,Vft(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},dmt=class{constructor(e){var i;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const n=e.resourceController.memoryController;this.totalMemory=(n.maxMemory??0)*j4.MEGABYTES,this.usedMemory=Math.round(n.usedMemory*this.totalMemory),this.quality=n.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,e.allLayerViews.items.forEach(n=>{(Bft(n)||GR(n))&&this.layerPerformanceInfos.push(new hmt(n,e))}),this.layerPerformanceInfos.sort((n,s)=>s.memory-n.memory)}},pmt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const n=i?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>bAe(new _Ae(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,n=this._wosrMemCache.get(i);return n!=null?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,s=>wAe(e,s),r)}async _loadOnce(e,r,i,n,s){Bt(s);const o=pa(s,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),Bt(s),l}finally{Pi(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},fmt=class extends lT{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){Bt(i);const n=i!=null?i.signal:null,s=this.makeUid(e,r);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o=new gwe,o.abortController=a;const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async u=>{const d=this._createTexture(e,u,r);return c.texture=d,c.abortController=null,this._stage.add(d),await this._stage.load(d),{uid:s,texture:d,release:()=>this._release(s)}},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await AX(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,r,i){var s;const n={width:r.width,height:r.height,wrap:{s:Pt.CLAMP_TO_EDGE,t:Pt.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(_0e(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new Hw(r,n)}},mmt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Cf.SYMBOLOGY),this.objectResourceCache=new pmt((i,n)=>e.resourceController.memoryController.newCache(i,n)),this.textures=new fmt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Mr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=ZTe(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=uet(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Za();this._graphicsOwners.push(e);const r=ue(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Za(()=>{r.remove(),qO(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Vi;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ue(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,Br),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Me(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;HI.distance=e.centerOnSurfaceInfrequent.distance,HI.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(HI),this.screenSizePerspectiveSettingsLabels.update(HI),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const HI={distance:0,fovY:0};let I2=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new n_({symbolLayers:[new i_({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Uw({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(r==null)return;this.hide();const i=new ze({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new z_({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},Xy=class extends xe{constructor(e){super(e),this.handles=new Vi}destroy(){this.handles.destroy()}};h([f({constructOnly:!0})],Xy.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Xy.prototype,"surface",void 0),h([f({constructOnly:!0})],Xy.prototype,"state",void 0),Xy=h([N("esri.views.3d.support.PointOfInterest")],Xy);const gmt=Array;let wd=class extends Xy{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new jg({location:ze,renderLocation:gmt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=O(),this._tmpPoint=new ze}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Ol(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Me(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=ci(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return mw(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),Ho.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>ymt&&this.renderCoordsHelper.viewingMode===$e.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?_mt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{Zn(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Ho.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(Mz,this._estimatedSurfaceAltitude,this._camera.eye),Bo(this._get("renderLocation"),Mz)||(this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),Mz)),this.notifyChange("renderLocation"))}};h([f({constructOnly:!0})],wd.prototype,"scheduler",void 0),h([f({constructOnly:!0})],wd.prototype,"cache",void 0),h([f({constructOnly:!0})],wd.prototype,"task",void 0),h([f({readOnly:!0})],wd.prototype,"location",null),h([f({constructOnly:!0})],wd.prototype,"map",void 0),h([f({readOnly:!0})],wd.prototype,"renderLocation",void 0),h([f({readOnly:!0})],wd.prototype,"scale",null),h([f({readOnly:!0})],wd.prototype,"updating",null),wd=h([N("esri.views.3d.support.CameraOnSurface")],wd);const Mz=O(),ymt=1e5,_mt=1e6,vmt=Array;let Ku=class extends Xy{constructor(e){super(e),this._propertiesPool=new jg({location:ze,renderLocation:vmt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=O(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Pi(this._frameWorker),this._propertiesPool=Me(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Ho.YIELD}_updateRenderLocation(){const e=wmt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=xmt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(re(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=ci(this._camera.eye,e):(te(e,this._camera.viewForward,this._get("distance")),oe(e,e,this._camera.eye)),Bo(this._get("renderLocation"),e)||this._set("renderLocation",re(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var n,s;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=Mr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=la(i.eye),c=l<a*a,u=ci(i.eye,r);if(c&&u>o/4){const d=a-Math.sqrt(l);return te(r,i.viewForward,d),oe(r,r,i.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;o!=null&&RP(o,(s=this.surface)==null?void 0:s.spatialReference,VC,this.renderCoordsHelper.spatialReference)&&(r[0]=ge(r[0],VC[0],VC[2]),r[1]=ge(r[1],VC[1],VC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(Kr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,n=ci(i,e),s=ci(i,r);if(Math.abs(s-n)/n>bmt)return!0}return!1}};h([f({constructOnly:!0})],Ku.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Ku.prototype,"task",void 0),h([f()],Ku.prototype,"distance",void 0),h([f({constructOnly:!0})],Ku.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([f({readOnly:!0})],Ku.prototype,"location",null),h([f({readOnly:!0})],Ku.prototype,"renderLocation",void 0),h([f()],Ku.prototype,"updating",void 0),Ku=h([N("esri.views.3d.support.CenterOnSurface")],Ku);const bmt=.05,wmt=O(),xmt=O(),VC=jt();let Tmt=class{constructor(e){this._handles=new Vi,this.events=new Bn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Me(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",Smt)}};const Smt={},Emt=Array;let lf=class extends Xy{constructor(e){super(e),this._propertiesPool=new jg({location:ze,renderLocation:Emt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ue(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ue(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(dt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Me(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,Rce);const s=Math.max(0,(Math.acos(fe(Rce,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!N_(e,r)){const c=this._propertiesPool.get("renderLocation");re(c,r),this._set("renderLocation",c)}return Ho.YIELD}const o=1-ge(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Pce);const l=this._propertiesPool.get("renderLocation");return Lr(l,r,Pce,a),e&&N_(e,l)||this._set("renderLocation",l),Ho.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(Vo());if(i[1]=r.aboveGround?r.padding[Yt.BOTTOM]:r.fullHeight-r.padding[Yt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,GC)){ae(GC,GC,r.eye);const s=me(GC,GC);if(this.renderCoordsHelper.intersectManifold(bu(r.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,r.eye)}updateRenderLocation(){this._dirty=!0}};h([f()],lf.prototype,"_dirty",void 0),h([f({constructOnly:!0})],lf.prototype,"scheduler",void 0),h([f({constructOnly:!0})],lf.prototype,"centerOnSurface",void 0),h([f({constructOnly:!0})],lf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([f({readOnly:!0})],lf.prototype,"updating",null),h([f({readOnly:!0})],lf.prototype,"location",null),h([f({readOnly:!0})],lf.prototype,"renderLocation",void 0),lf=h([N("esri.views.3d.support.pointsOfInterest.Focus")],lf);const Rce=O(),GC=O(),Pce=O();let jm=class extends xe{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=O();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Vi}initialize(){this.view.state.isLocal&&(this._handles.add([ue(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Ol(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=vY(this.surfaceView.extent),r=new ze({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Zn(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};h([f({constructOnly:!0})],jm.prototype,"view",void 0),h([f({constructOnly:!0})],jm.prototype,"cache",void 0),h([f()],jm.prototype,"surface",null),h([f()],jm.prototype,"surfaceView",null),h([f({readOnly:!0})],jm.prototype,"location",void 0),h([f({readOnly:!0})],jm.prototype,"renderLocation",null),jm=h([N("esri.views.3d.terrain.StableSurfaceCenter")],jm);let Hm=class extends xe{constructor(e){super(e),this._tileGeometryUpdateExtent=Ih(),this._tileGeometryUpdateSpatialReference=null,this.events=new Bn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(dt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Cmt),Ih(this._tileGeometryUpdateExtent),this._set("updating",!1)),Ho.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,S_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,n=Amt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Q1,r),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,J1,r),Q1[0]<J1[0]?(n[0]=Q1[0],n[2]=J1[0]):(n[0]=J1[0],n[2]=Q1[0]),Q1[1]<J1[1]?(n[1]=Q1[1],n[3]=J1[1]):(n[1]=J1[1],n[3]=Q1[1]),f6(n,e)}};h([f({constructOnly:!0})],Hm.prototype,"state",void 0),h([f({constructOnly:!0})],Hm.prototype,"centerOnSurfaces",void 0),h([f({constructOnly:!0})],Hm.prototype,"renderCoordsHelper",void 0),h([f({constructOnly:!0})],Hm.prototype,"scheduler",void 0),h([f({constructOnly:!0})],Hm.prototype,"surface",void 0),h([f({readOnly:!0})],Hm.prototype,"updating",void 0),Hm=h([N("esri.views.3d.support.SurfaceGeometryUpdates")],Hm);const Cmt={},Q1=O(),J1=O(),Amt=Ih();let yl=class extends xe{constructor(e){super(e),this._handles=new Vi,this._tmpRay=qs(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new jg({renderPointOfView:Omt},this),this.renderPointOfView=O(),this._pois=new Array,this._debugCenters=new Map}initialize(){var u;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:n}=this.view;this._surfaceIntersector=zh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=To.MIN,this._contentIntersector=zh(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Ku({...l,task:dt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new Ku({...l,task:dt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new Ku({...l,task:dt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new wd({...l,cache:a,task:dt.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new Hm({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Tmt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new jm({cache:a,view:this.view})),this._set("focus",new lf({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(d,p)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new I2(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new I2(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new I2(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new I2(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new I2(c,"green","Focus")),this._handles.add([ue(()=>e.contentCamera,d=>this._cameraChanged(d),Br),ue(()=>r.extent,()=>this._updateCenterPointsOfInterest()),Dh(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),Br),Ol(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Ol(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Dh(()=>Kr.SHOW_POI,d=>this._setDebug(d),Pr)]),this._cameraChanged(this.view.state.contentCamera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Ux,Pmt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ux):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=oe(Ux,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(Ux)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ux)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const n=LQ(r,e,Rmt);if(n==null)return null;const s=n.origin,o=oe(Ux,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;Bo(this.renderPointOfView,r)||this._set("renderPointOfView",re(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(ue(()=>r.renderLocation,i=>{var n;return(n=this._debugCenters.get(r))==null?void 0:n.show(i,r.renderCoordsHelper.spatialReference)},Pr),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};h([f({readOnly:!0})],yl.prototype,"centerOnContent",void 0),h([f({readOnly:!0})],yl.prototype,"centerOnSurfaceFrequent",void 0),h([f({readOnly:!0})],yl.prototype,"centerOnSurfaceInfrequent",void 0),h([f({readOnly:!0})],yl.prototype,"cameraOnSurface",void 0),h([f({readOnly:!0})],yl.prototype,"focus",void 0),h([f({readOnly:!0})],yl.prototype,"renderPointOfView",void 0),h([f({readOnly:!0})],yl.prototype,"surfaceOrigin",void 0),h([f({readOnly:!0})],yl.prototype,"contentGeometryUpdates",void 0),h([f({readOnly:!0})],yl.prototype,"surfaceGeometryUpdates",void 0),h([f({constructOnly:!0})],yl.prototype,"view",void 0),h([f({readOnly:!0})],yl.prototype,"updating",null),yl=h([N("esri.views.3d.support.PointsOfInterest")],yl);const Omt=Array,Ux=O(),Rmt=qs(),Pmt={exclude:new Set([jy])},HR=new ir,SO=new WeakMap;function Mmt(t){TOe(t)&&HR.push(t)}function $mt(t){TOe(t)&&HR.includes(t)&&HR.remove(t)}function TOe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function SOe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:SOe(e,t%e):0}let $z=0,WI=0;function Imt(){const t=Date.now();for(const e of HR)e.refreshInterval&&t-(SO.get(e)??0)+5>=6e4*e.refreshInterval&&(SO.set(e,t),e.refresh(t))}Lge(()=>{const t=Date.now();let e=0;for(const r of HR)e=SOe(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?SO.get(r)||SO.set(r,t):SO.delete(r);if(e!==WI){if(WI=e,clearInterval($z),WI===0)return void($z=0);$z=setInterval(Imt,WI)}});function Lmt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const AFt=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=Age(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||Mmt(this)},()=>{})}destroy(){$mt(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){_V(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{J.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return h([f({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),h([f({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),h([f()],e.prototype,"refreshParameters",null),e=h([N("esri.layers.mixins.RefreshableLayer")],e),e};let Dmt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},Nmt=class{constructor(e,r,i,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=n)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,n=-1/0,s=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=n>-3e38?n:0)}},EOe=class{constructor(e,r,i,n,s={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=iBe(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>J.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Za(()=>{i.removed=!0,vX(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const n=this._transferLists[e],s=n?n(r):[];return this._thread.invoke(e,r,{transferList:s,signal:i})}return this._promise?this._promise.then(()=>(Bt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},Mce=class extends EOe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(EO.forEach((e,r)=>{e===this&&EO.delete(r)}),this.destroy())}};const EO=new Map;function Fmt(t=null){let e=EO.get(t);return e||(t!=null?(e=new Mce(r=>t.immediate.schedule(r)),EO.set(t,e)):(e=new Mce,EO.set(null,e))),++e.ref,e}var lc,$ce,Ice;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(lc||(lc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}($ce||($ce={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Ice||(Ice={}));let Umt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},IFt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function DFt(t,e,r,i,n,s){const o=r-n;if(o>=0)return(e>>o)+(i-(s<<o))*(t>>o);const a=-o;return e-(s-(i<<a))*(t>>a)<<a}let NFt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][n]||null}getCellSpan(e,r,i,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function kmt(t,e,r,i,n,s){const o=e[i++];for(let a=0;a<o;a++){const l=new Umt(s);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let p=0;p<c;p++){const m=e[i++],y=e[i++],_=e[i++],v=e[i++],b=!!e[i++],x=e[i++],T=r[i++],S=r[i++],A=e[i++],C=e[i++];l.colliders.push({xTile:m,yTile:y,dxPixels:_,dyPixels:v,hard:b,partIndex:x,width:A,height:C,minLod:T,maxLod:S})}const u=t[i++];for(let p=0;p<u;p++)l.textVertexRanges.push([t[i++],t[i++]]);const d=t[i++];for(let p=0;p<d;p++)l.iconVertexRanges.push([t[i++],t[i++]]);n.push(l)}return i}function UFt(t,e,r){for(const[i,n]of t.symbols)zmt(t,e,r,n,i)}function zmt(t,e,r,i,n){const s=t.layerData.get(n);if(s.type===lc.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let d=c;d<c+u;d+=4)s.iconOpacity[d/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,d=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&d===0;const p=r?Math.floor(127*u)|d<<7:d?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let d=c;d<c+u;d+=4)s.textOpacity[d/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let eU=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[i++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},Bmt=class extends eU{constructor(e,r){super(e,r),this.type=lc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=i[n++],this.lineIndexCount=i[n++];const s=i[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=i[n++],l=i[n++],c=i[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=Le(this.vao)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=Ar.createVertex(e,gr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=Ar.createIndex(e,gr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=this.layer.lineMaterial;this.vao=new Fh(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},Vmt=class extends eU{constructor(e,r){super(e,r),this.type=lc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=i[n++],this.fillIndexCount=i[n++],this.outlineIndexStart=i[n++],this.outlineIndexCount=i[n++];const s=i[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=i[n++],l=i[n++],c=i[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.fillVAO)==null?void 0:r.memoryEstimate)??0)+(((i=this.outlineVAO)==null?void 0:i.memoryEstimate)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=Le(this.fillVAO),this.outlineVAO=Le(this.outlineVAO)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=Ar.createVertex(e,gr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=Ar.createIndex(e,gr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=n[i++],d=Ar.createVertex(e,gr.STATIC_DRAW,new Int32Array(s.buffer,4*i,u));i+=u;const p=n[i++],m=Ar.createIndex(e,gr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,p));i+=p;const y=this.layer,_=y.fillMaterial,v=y.outlineMaterial;this.fillVAO=new Fh(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Fh(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:d},m)}},Gmt=class extends eU{constructor(e,r,i){super(e,r),this.type=lc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++];for(let p=0;p<l;p++){const m=n[a++],y=n[a++],_=n[a++];this.iconPerPageElementsMap.set(m,[y,_])}const c=n[a++];for(let p=0;p<c;p++){const m=n[a++],y=n[a++],_=n[a++];this.glyphPerPageElementsMap.set(m,[y,_])}const u=n[a++],d=n[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(d),a=kmt(n,s,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.iconVAO)==null?void 0:r.memoryEstimate)??0)+(((i=this.textVAO)==null?void 0:i.memoryEstimate)??0)+Ky(this.iconOpacity)+Ky(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=Le(this.iconVAO),this.textVAO=Le(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.byteLength&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,n=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===n.byteLength&&n.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=Ar.createVertex(e,gr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=Ar.createIndex(e,gr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=n[i++],d=Ar.createVertex(e,gr.STATIC_DRAW,new Int32Array(s.buffer,4*i,u));i+=u;const p=n[i++],m=Ar.createIndex(e,gr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,p));i+=p;const y=Ar.createVertex(e,gr.STATIC_DRAW,this.iconOpacity.buffer),_=Ar.createVertex(e,gr.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,x=v.textMaterial;this.iconVAO=new Fh(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:y},c),this.textVAO=new Fh(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:d,opacity:_},m)}},jmt=class extends eU{constructor(e,r){super(e,r),this.type=lc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=i[n++],this.circleIndexCount=i[n++],this.bufferDataOffset=n}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=Le(this.vao)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=Ar.createVertex(e,gr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=Ar.createIndex(e,gr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=this.layer.circleMaterial;this.vao=new Fh(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const jFt=!0,HFt=32,Lce=200,Hmt=1/se("mapview-transitions-duration");let Wmt=class extends Bn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Wo(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Wo(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===i)this.computedVisible=this.visible;else{const s=e*Hmt;this.computedOpacity=n>i?Math.max(i,n-s):Math.min(i,n+s),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},vW=class Fv{static getId(e,r,i,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${n}`}constructor(e,r,i,n){this.set(e,r,i,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,n){this.set(e,r,i,n)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new Fv(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Fv(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,n=this.world;return[new Fv(e,r,i,n),new Fv(e,r,i+1,n),new Fv(e,r+1,i,n),new Fv(e,r+1,i+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};vW.pool=new ko(vW,null,null,25,50);let qmt=class extends Wmt{constructor(e,r,i,n,s,o,a=s,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new vW(e),this.resolution=r,this.x=i,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;JZ(i,o,0,0,0,a,0,n,s,1),US(this.transforms.dvs,e.displayViewMat3,i)}},Iz=class COe extends qmt{constructor(e,r,i,n,s,o,a,l=null){super(e,r,i,n,s,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Lce}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Lce)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){var i;let r=!1;for(const n of e)if(this.layerData.has(n)){const s=this.layerData.get(n);this._memoryUsedByLayerData-=s.memoryUsed,s.type===lc.SYMBOL&&this.symbols.has(n)&&(this.symbols.delete(n),r=!0),s.destroy(),this.layerData.delete(n),this.layerCount--}(i=this._memCache)==null||i.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(AOe.delete(this),COe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var i;let r=!1;if(e){const{bucketsWithData:n,emptyBuckets:s}=e,o=this._createRenderBuckets(n);if(s&&s.byteLength>0){const a=new Uint32Array(s);for(const l of a)this._deleteLayerData(l)}for(const[a,l]of o)this._deleteLayerData(a),l.type===lc.SYMBOL&&(this.symbols.set(a,l.symbols),r=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(a,l),this.layerCount++;(i=this._memCache)==null||i.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[n,s]of this.layerData)s.type===lc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,n=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;KZ(o),r5(o,o,s),eQ(o,o,Math.PI*e.rotation/180),tQ(o,o,[i,n,1])}_createTransforms(){return{dvs:Pl(),tileMat3:Pl(),tileUnitsToPixels:Pl()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const n of e){const s=this._deserializeBucket(n,i);for(const o of s.layerUIDs)r.set(o,s)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case lc.FILL:i=new Vmt(e,this.styleRepository);break;case lc.LINE:i=new Bmt(e,this.styleRepository);break;case lc.SYMBOL:i=new Gmt(e,this.styleRepository,this);break;case lc.CIRCLE:i=new jmt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const AOe=new Map;function Xmt(){AOe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const XFt={value:.5,readOnly:!0},Ymt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let bT=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},Zmt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},Qmt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new Zmt(i,r)}computeMinMaxValue(e,r,i,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,d=.5*yR;let p=(c-1)/o,m=(i-this.j*o)*p,y=(r-this.i*o)*p;if(p<1){const _=Math.floor(m),v=Math.floor(y),b=_+v*c,x=u[b],T=u[b+1],S=u[b+c],A=u[b+c+1];if(x+T+S+A<d){const C=m-_,R=y-v,P=s$(x,T,S,A,C,R),F=s$(x,T,S,A,C+p,R),k=s$(x,T,S,A,C,R+p),V=s$(x,T,S,A,C+p,R+p);return n.min=Math.min(P,F,k,V),n.max=Math.max(P,F,k,V),n}m=_,y=v,p=1}else m=Math.floor(m),y=Math.floor(y),p=Math.ceil(p);for(let _=m;_<=m+p;_++)for(let v=y;v<=y+p;v++){const b=u[_+v*c];b<d?(a=Math.min(a,b),l=Math.max(l,b)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const Jmt=.5*yR;function qi(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const n=i.safeWidth;let s=ge(i.dy*(i.y1-e),0,n),o=ge(i.dx*(t-i.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=i.data.width,u=a*c+l,d=i.data.values,p=d[u],m=d[u+1],y=u+c,_=d[y],v=d[y+1];if(p+_+m+v<Jmt){s-=a,o-=l;const b=p+(m-p)*o;return b+(_+(v-_)*o-b)*s}}return null}let Qu=class extends xe{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=OOe(i.fullExtent,this.viewSpatialReference);n!=null&&e.push(Aye(n))}}),e}};function Kmt(t,e){return t===$e.Global?new bW(e):new wW(e)}h([f({readOnly:!0})],Qu.prototype,"layerViewsExtent",null),h([f({readOnly:!0})],Qu.prototype,"tiledLayersExtent",null),h([f({readOnly:!0})],Qu.prototype,"stencilEnabledExtents",null),h([f()],Qu.prototype,"viewSpatialReference",void 0),h([f()],Qu.prototype,"tilingScheme",void 0),h([f()],Qu.prototype,"defaultTiledLayersExtent",void 0),h([f({constructOnly:!0})],Qu.prototype,"layers",void 0),h([f({constructOnly:!0})],Qu.prototype,"layerViews",void 0),Qu=h([N("esri.views.3d.terrain.ExtentHelper")],Qu);let bW=class extends Qu{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?pwe:XGe}};bW=h([N("esri.views.3d.terrain.ExtentHelperGlobal")],bW);let wW=class extends Qu{_computeLayerViewsExtent(){const e=Ih(),r=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=OOe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,r);S_(e,a,e)}});const i=r7(e)?e:null,n=this._get("layerViewsExtent");return Cb(i,n)?n:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=Ih();this.layers.forEach(o=>{if(o.loaded&&jA(o)){const a=K8(o,r,$e.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(J5(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&S_(i,c,i)}}),S_(i,this.defaultTiledLayersExtent,i);const n=r7(i)?i:null,s=this._get("tiledLayersExtent");return Cb(n,s)?s:n}};function OOe(t,e){return t==null||t.spatialReference.equals(e)?t:uZ(t,t.spatialReference,e)}wW=h([N("esri.views.3d.terrain.ExtentHelperLocal")],wW);var Zt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Zt||(Zt={}));const Uv=[Zt.ELEVATION,Zt.MAP];function ROe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.search(".glsl")!==-1&&delete t[i]}}const egt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let G0,Ia=class extends xe{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Kr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Mr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Vi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=se("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){var n;const e=this.view;this.renderer=new sf({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const r=()=>this.setDrawTexturesDirty();this._groundIntersector=zh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{r(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",s=>{var o;return(o=e._stage)==null?void 0:o.renderer.setParameters({hasOverlayWater:s})}),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),ue(()=>e.state.camera.pixelRatio,r),ue(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ue(()=>{var s,o,a;return[(s=e.pointsOfInterest)==null?void 0:s.renderPointOfView,(a=(o=e.pointsOfInterest)==null?void 0:o.centerOnSurfaceFrequent)==null?void 0:a.location]},()=>this.setPlacementDirty()),ue(()=>{var s,o;return[(s=e.state)==null?void 0:s.pixelRatio,(o=e.state)==null?void 0:o.contentPixelRatio]},()=>this.setPlacementDirty(),Br),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(dt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",s=>{this._updateOverlays(Wa,s.camera,dn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,dn.BACKGROUND,s)})]);let i=s=>this._renderOverlayCallback(s);this._removeRenderOverlayCallback=()=>{i=()=>{}},(n=e._stage)==null||n.renderer.setParameters({renderOverlay:s=>i(s)})}_renderOverlayCallback(e){this._contentUpdated=!1;const r=this.renderer;r.processSyncDrapeSources(),r.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(r.overlays,dn.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){var e,r;this._handles=Me(this._handles),this._removeRenderOverlayCallback(),(r=(e=this.view)==null?void 0:e._stage)==null||r.renderer.setParameters({renderOverlay:()=>{}}),G0!=null&&(G0.hide(),G0=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new F_(-20037508342787e-6,20037508342787e-6):new F_(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Hc)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,dn.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return Ho.YIELD;const n=this._computeOverlayResolution(r);this._computeOverlayExtents(r,n,Am);const s=nu(Am.inner)/nu(Am.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(Oi.INNER,Am.inner,n,1*Am.pixelRatioAdjustment,Am.mapUnitsPerPixel),a=this._updateOverlay(Oi.OUTER,Am.outer,n,s*Am.pixelRatioAdjustment,Am.mapUnitsPerPixel);o!==mf.EXTENT&&a!==mf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===mf.NONE&&a===mf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,n=e.fullHeight/e.pixelRatio*r,s=Math.ceil(1.5*Math.max(i,n));return Math.min(MJ(s),this._maxResolution)}_updateOverlay(e,r,i,n,s){if(this.renderer.overlays.length===0)return mf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,tgt(r,o.extent)&&i===o.resolution)return a===s?mf.NONE:mf.RERENDER_ONLY;Ug(o.extent,r),o.resolution=i;const l=vY(o.extent);return o.renderLocalOrigin=R5(l[0],l[1],0,"OV_"+this._latestOriginId++),mf.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Oi.INNER],n=this.renderer.overlays[Oi.OUTER],s=e.extent;this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,Oi.INNER,r),this._setTileOverlayData(s,Oi.OUTER,r)):(this._clearTileOverlayData(Oi.INNER,r),this._clearTileOverlayData(Oi.OUTER,r))}else this._clearTileOverlayData(Oi.INNER,r),this._clearTileOverlayData(Oi.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[Oi.INNER],i=this.renderer.overlays[Oi.OUTER],n=this._pointIsInExtent(e,r.extent)?r:i;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[r].extent,s=nu(n),o=lp(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,nu(e)/s,lp(e)/o),i.setOffset(r,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){ROe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Wa)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,n=new gSe(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,ngt,r,i);if(s==null)return!1;const o=s.origin,a=oe(qI,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=ge(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=qI;EE(z6(B6,Mr(this.view.spatialReference).radius+l),bu(e.eye,e.viewForward),u),ae(u,u,e.eye);const d=U_.normalize(pbe(e.viewForward,u,e.viewRight))/e.fovY+.5,p=d<=0||d>=1?.5:n;i=c?p*d:d+p*(1-d)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(u),p=$t(0,d,1,0),m=au(p,p,e.projectionMatrix)[1],y=ge(.5+.5*m,0,1);i=y===1||y===0?.5:c?y*n:1-(1-y)*n}return!!this._intersectGroundFromView(e,.5,i,r)&&u6(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=O();this._findHorizonBasedPointOfInterest(e,s)||re(s,n),Kr.OVERLAY_SHOW_CENTER?(G0==null&&(G0=new I2(this.view.graphics,"red")),G0.show(s,this._renderSR)):G0!=null&&G0.hide();const o=Math.max(.1,ci(e.eye,s)),a=Z_(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||Cs(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,u=c&&this._spatialReference!=null?1/Mr(this._spatialReference).metersPerDegree:1,d=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/d*o*u;i.mapUnitsPerPixel=p/this._worldToPCSRatio;let m=r*p/2*YQ,y=!1,_=c?90:1/0;this._isSpherical&&l!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(m/=Math.cos(g4(s[1])),_=l[3]):(y=!0,m/=Mr(this._spatialReference).metersPerDegree,_=90),m>=_&&(m=_,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;y&&(v=1/Math.max(.2,Math.cos(Math.abs(It(s[1])))),m*v>180&&(v=180/m),i.mapUnitsPerPixel*=v);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const x=m*v,T=32,S=.5*r/(T*x),A=.5*r/(T*m);s[0]=Math.round(s[0]*S)/S,s[1]=Math.round(s[1]*A)/A;const C=i.inner;C[0]=s[0]-x,C[1]=s[1]-m,C[2]=s[0]+x,C[3]=s[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,_);const R=i.outer;if(6*x>nu(l))Ug(R,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)R[0]=C[0]-x,R[1]=C[1]-m,R[2]=C[2]+x,R[3]=C[3]+m;else{Cs(e.eye,this._renderSR,qI,this._spatialReference),Tf(K1,s,qI);let F=-Math.atan2(K1[1],K1[0])+.125*Math.PI;F<0&&(F+=2*Math.PI);const k=Math.floor(F/(.25*Math.PI));ew(K1,egt[k],2*m),K1[0]*=v,K1[2]*=v,cY(R,C,K1)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-_),R[3]=Math.min(R[3],_);else{const F=i7(C,l,rgt),k=i7(R,l,igt);hre(F,k)&&(R[2]=R[0],R[3]=R[1])}const P=Math.abs(C[2]-C[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,P),i.pixelRatioAdjustment=i.mapUnitsPerPixel/P}_drawOverlayTextures(e,r,i){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const n=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Oi.INNER],i),o=this._drawOverlay(e[Oi.OUTER],i);s!==FS.CHANGED&&o!==FS.CHANGED||this.surface.updateTileOverlayParams(dn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),n?(this.surface.requestRender(r),r===dn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(dn.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):f6(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:hre(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,n=e.y;return i>r[0]&&i<r[2]&&n>r[1]&&n<r[3]}_shiftExtentToFitBounds(e,r,i){let n=0,s=0;e[0]<-r?n=e[0]+r:e[2]>r&&(n=r-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),E4(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Wa)}}};function tgt(t,e){const i=Kr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}h([f()],Ia.prototype,"_spatialReference",void 0),h([f({readOnly:!0})],Ia.prototype,"running",null),h([f()],Ia.prototype,"_placementDirty",void 0),h([f()],Ia.prototype,"_contentUpdated",void 0),h([f()],Ia.prototype,"_isSpherical",null),h([f()],Ia.prototype,"_worldToPCSRatio",null),h([f({autoDestroy:!0})],Ia.prototype,"renderer",void 0),h([f({constructOnly:!0})],Ia.prototype,"view",void 0),h([f({constructOnly:!0})],Ia.prototype,"surface",void 0),h([f()],Ia.prototype,"suspended",null),h([f()],Ia.prototype,"updating",null),h([f({type:Boolean})],Ia.prototype,"hasHighlights",null),h([f({type:Boolean})],Ia.prototype,"rendersOccluded",null),Ia=h([N("esri.views.3d.terrain.OverlayManager")],Ia);const K1=Qt(),qI=O(),Am={inner:jt(),outer:jt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},rgt=jt(),igt=jt(),ngt=qs();var mf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(mf||(mf={}));let POe=class xW{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!xW.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let n="";throw i&&(n=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+n),r}}release(e){if(xW.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new Nt({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};POe.test={disabled:!1};let sgt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=vi(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},Dce=class{constructor(e,r,i,n,s){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return be(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),oe(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:n}=this.attributes.normalCompressed;Uot(e,i,this.getAttributeIndex(r),n)}_setNormal(e,r,i,n){const{typedBuffer:s,typedBufferStride:o}=this.attributes.normalCompressed;bw(s,e,r,i,n,o)}_setUV(e,r,i){np(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,n){this._setNormal(this.getAttributeIndex(e),r,i,n)}setVertexFromValuesRawPositionUV(e,r,i,n,s,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,n),this._setUV(a,s,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,n,s,o,a,l,c){const u=this.getAttributeIndex(e);this.attributes.position.setValues(u,r,i,n),this._setUV(u,s,o),this._setNormal(u,a,l,c)}};const ogt=Gi().vec3f(E.POSITION).vec2i16(E.UV0).vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),dK=new POe(t=>ogt.createBuffer(t),t=>t.count);function agt(){dK.clear()}function MOe(t){return dK.acquire(t)}function lgt(t){dK.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const Nce=16384;function np(t,e,r,i){t.setValues(e,r*Nce,i*Nce)}function Oh(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let cgt=class{constructor(){this.sinLonLUT=new Array(F3+1),this.cosLonLUT=new Array(F3+1),this.sinLatLUT=new Array(F3+1),this.cosLatLUT=new Array(F3+1)}update(e,r,i){const n=r[0],s=r[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},XI=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},ugt=class{constructor(){this.cornerNeighborData=[new XI,new XI,new XI,new XI],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},hgt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new ugt}},$Oe=class iN{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Me(this._current),this._next=Me(this._next),this._waiting=Me(this._waiting),this._delayed=Me(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=iN.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Ag.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==ns.FADING,s=e-this._fadeStart>=r;(i||n||s)&&(Me(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=iN.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=Ag.Immediate){this._delayed=Me(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=iN.test.fadeMoment||performance.now();return r!==Ag.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Me(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Ag;$Oe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Ag||(Ag={}));var tE;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(tE||(tE={}));let IOe=class{constructor(){this._queue=new Nt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},dgt=class{constructor(){this._q=new Nt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function CO(t,e,r){if(e==null||e.fullExtent==null)return!1;const i=e.fullExtent,n=t.extent;if(r){if(n[0]<i.xmin||n[1]<i.ymin||n[2]>i.xmax||n[3]>i.ymax)return!1}else if(i.xmin>n[2]||i.ymin>n[3]||i.xmax<n[0]||i.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function Og(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function LOe(t,e,r=null){r==null||r.length===0?t===tE.BACK_TO_FRONT?e.sort(pgt):e.sort(fgt):e.sort((i,n)=>mgt(i,n,t,r))}function pgt(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function fgt(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function DOe(t,e,r){const i=t.screenDepth,n=e.screenDepth;return i<n?-r:i>n?r:Og(t,e)}function mgt(t,e,r,i){return Fce(t,i)===Fce(e,i)?DOe(t,e,r):t?r:-r}function Fce(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function ggt(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function ygt(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(ggt)}function _gt(t,e,r){let i=1,n=0,s=0;for(;t!==e;)if(i*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,n,s,i)}function vgt(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let n=0;n<4;n++){const s=i.children[n];if(s&&s!==r)return!0}}return!1}function u6t(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,n=r?e:t,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}let pK=class{get updating(){return!!this._tileRequested}init(e,r,i,n){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,ns.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),n=gW(i),{minLevel:s,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?CO:()=>!0;let u=this.tile;const d=u.level;let p;const m=this._tileLayerInfo.upsampleInfo,y=m!=null?m.tile.level:-1,_=m!=null&&y-d>=a,v=n==null?void 0:n.tilemapCache,b=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;u&&c(u,n,!1)&&u.level>=s;){const x=u.level,T=d-x,S=u.layerInfo[r][e];if(S.data&&T>=a){(!_||x>y)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const A=(b==null?void 0:b.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(A[0],A[1],u.lij[2]))!=="unavailable"&&x<=o&&!S.data&&!S.dataMissing&&((!p||u.level===s||x%dwe==0||d-p.level<a)&&(p=u),T>=l))break;u=u.parent}if(p!=null&&d-p.level<a)if(m)p=null;else{const x=this._findAncestorWithData();x!=null&&(this._setUpsampleTile(x),p=x.layerInfo[r][e].dataInvalidated?x:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=r)return n;i=n}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,ns.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},bgt=class extends pK{get _desiredMinLevelDelta(){throw Uce}get _progressiveLevelModulo(){throw Uce}dispose(){}};const Uce=new Error("Abstract method called on TileAgent"),Gl=new bgt;let NOe=class extends pK{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return JG(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},FOe=class extends pK{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return dwe}};var kb,Tw;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(kb||(kb={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(Tw||(Tw={}));function wgt(t){t.fragment.uniforms.add(new Ye("u_colormap",e=>e.u_colormap),new Ce("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Ce("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Ce("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(w`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function xgt(t){t.fragment.uniforms.add(new Ye("u_transformGrid",e=>e.u_transformGrid),new yr("u_transformSpacing",e=>e.common.u_transformSpacing),new yr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(w`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let UOe=class extends Wr{constructor(){super(...arguments),this.scale=1,this.offset=dp}};function kOe(t){t.attributes.add(E.POSITION,"vec2"),t.attributes.add(E.UV0,"vec2"),t.vertex.uniforms.add(new Ce("scale",e=>e.scale)),t.vertex.uniforms.add(new yr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(w`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let Tgt=class extends UOe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function Sgt(t,e){t.include(xgt),t.fragment.uniforms.add(new Ye("u_image",i=>i.u_image),new kf("u_flipY",i=>i.common.u_flipY),new kf("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new yr("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(w`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(w`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(w`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Ae;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Ae||(Ae={}));const TW={normal:Ae.Normal,average:Ae.Average,lighten:Ae.Lighten,lighter:Ae.Lighter,screen:Ae.Screen,plus:Ae.Plus,"color-dodge":Ae.ColorDodge,darken:Ae.Darken,multiply:Ae.Multiply,"color-burn":Ae.ColorBurn,overlay:Ae.Overlay,"soft-light":Ae.SoftLight,"hard-light":Ae.HardLight,"vivid-light":Ae.VividLight,hue:Ae.Hue,saturation:Ae.Saturation,luminosity:Ae.Luminosity,color:Ae.Color,difference:Ae.Difference,exclusion:Ae.Exclusion,minus:Ae.Minus,invert:Ae.Invert,reflect:Ae.Reflect,"destination-over":Ae.DestinationOver,"destination-atop":Ae.DestinationAtop,"destination-in":Ae.DestinationIn,"destination-out":Ae.DestinationOut,"source-atop":Ae.SourceAtop,"source-in":Ae.SourceIn,"source-out":Ae.SourceOut,xor:Ae.Xor};function Egt(t){return t===Ae.DestinationOver||t===Ae.DestinationAtop||t===Ae.DestinationIn||t===Ae.DestinationOut||t===Ae.SourceAtop||t===Ae.SourceIn||t===Ae.SourceOut||t===Ae.Xor}function fK(t){t.code.add(w`
    float lineFactorAtPosition(float value) {
      float pos = value * ${w.float(257)};
      if(pos < 0.5 || pos > ${w.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function Cgt(t,e){const r=e.blendMode;r!==Ae.Normal&&(r===Ae.Reflect&&t.code.add(w`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Ae.ColorDodge&&r!==Ae.VividLight||t.code.add(w`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Ae.ColorBurn&&r!==Ae.VividLight||t.code.add(w`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Ae.Overlay&&t.code.add(w`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Ae.HardLight&&t.code.add(w`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Ae.SoftLight&&t.code.add(w`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Ae.VividLight&&t.code.add(w`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Ae.Hue&&r!==Ae.Saturation&&r!==Ae.Color&&r!==Ae.Luminosity||(t.code.add(w`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Ae.Hue&&r!==Ae.Saturation||t.code.add(w`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(w`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Ae.Multiply?w`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Average?w`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Lighten?w`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Darken?w`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Lighter?w`return vec4(cl * ol + cb * ob, ol + ob);`:r===Ae.Plus?w`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Ae.Minus?w`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Ae.Screen?w`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Difference?w`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Invert?w`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ae.DestinationOver?w`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Ae.DestinationAtop?w`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Ae.DestinationOut?w`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Ae.SourceAtop?w`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Ae.SourceOut?w`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Ae.Xor?w`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Ae.DestinationIn?w`return vec4(cb * ob * ol, ol * ob);`:r===Ae.SourceIn?w`return vec4(cl * ol * ob, ol * ob);`:r===Ae.Hue?w`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Saturation?w`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Color?w`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Luminosity?w`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Exclusion?w`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Reflect?w`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.ColorDodge?w`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.ColorBurn?w`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.Overlay?w`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.SoftLight?w`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.HardLight?w`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Ae.VividLight?w`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:w``}
    }
  `))}var ws,Zd,Nd;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(ws||(ws={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Zd||(Zd={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Nd||(Nd={}));function zOe(t,e){const r=e.output===ws.GridComposite,i=e.output===ws.ColorComposite,n=e.output===ws.GroupBackgroundComposite,s=e.output===ws.Composite;r&&t.fragment.include(fK),i&&t.fragment.uniforms.add(new Lt("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Zd.Required;o&&t.fragment.uniforms.add(new Ce("baseOpacity",c=>c.baseOpacity)),s&&t.fragment.uniforms.add(new Ye("fboColor",c=>c.fboTexture));const a=e.blendMode!==Ae.Normal,l=e.premultipliedSource===Nd.On;t.fragment.include(Cgt,e),t.fragment.code.add(w`
    vec4 getBackground(vec2 uv) {
      return ${o?w`baseOpacity *`:""} ${n?w`vec4(0.0, 0.0, 0.0, 0.0)`:i?w`vec4(backgroundColor, 1.0)`:r?w`vec4(gridColor(uv), 1.0)`:w`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?w`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:w`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?w`colorLayer * opacity;`:w`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let tU=class extends Tgt{constructor(e,r,i,n,s,o){super(e,n,s),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Zs,this.fboTexture=null,this.baseOpacity=1}},Agt=class extends tU{},Ogt=class extends tU{};function Rgt(t){const e=new mr;return e.include(kOe),e.include(Sgt,t),e.include(wgt,t),e.include(zOe,t),e.fragment.code.add(w`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===kb.Stretch?Mgt(e,t):t.colorizerType===kb.Lut?Pgt(e):t.colorizerType===kb.Hillshade&&$gt(e,t),e}function Pgt(t){t.fragment.code.add(w`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Mgt(t,e){t.fragment.uniforms.add(new QP("u_bandCount",i=>i.symbolizer.u_bandCount),new Sl("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Sl("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Sl("u_factor",i=>i.symbolizer.u_factor,3),new Ce("u_minOutput",i=>i.symbolizer.u_minOutput),new Ce("u_maxOutput",i=>i.symbolizer.u_maxOutput),new kf("u_useGamma",i=>i.symbolizer.u_useGamma),new Sl("u_gamma",i=>i.symbolizer.u_gamma,3),new Sl("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Ce("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(w`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?w`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:w`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(w`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Tw.Noop?w`
        fragColor = applyBackgroundBlend(currentPixel);`:w`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function $gt(t,e){const r=t.fragment;r.uniforms.add(new Ye("u_image",n=>n.u_image),new QP("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new Sl("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new Sl("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new Sl("u_cosZs",n=>n.symbolizer.u_cosZs,6),new Sl("u_weights",n=>n.symbolizer.u_weights,6),new yr("u_factor",n=>n.symbolizer.u_factor),new Ce("u_minValue",n=>n.symbolizer.u_minValue),new Ce("u_maxValue",n=>n.symbolizer.u_maxValue),new yr("u_srcImageSize",n=>n.common.u_srcImageSize)),r.include(cm),r.code.add(w`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(w`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?w`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:w`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(w`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const Igt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Ogt,ColorizerStretchUniforms:Agt,ColorizerUniforms:tU,build:Rgt},Symbol.toStringTag,{value:"Module"}));function Lgt(t,e,r="nearest",i=!1){var c;const n=!(i&&e.pixelType==="u8"),s=n?Un.FLOAT:Un.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new pr;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===rr.WEBGL2&&n?qe.RGBA32F:Tt.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?At.NEAREST:At.LINEAR,l.dataType=s,l.wrapMode=Pt.CLAMP_TO_EDGE,new Ct(t,l,o)}function Dgt(t,e){const{spacing:r,offsets:i,coefficients:n,size:[s,o]}=e,a=r[0]>1,l=new pr;l.width=a?4*s:s,l.height=o,l.internalFormat=t.type===rr.WEBGL2?qe.RGBA32F:Tt.RGBA,l.dataType=Un.FLOAT,l.samplingMode=At.NEAREST,l.wrapMode=Pt.CLAMP_TO_EDGE;const c=new Float32Array(a?s*o*16:2*i.length);if(a&&n!=null)for(let u=0,d=0;u<n.length;u++)c[d++]=n[u],u%3==2&&(c[d++]=1);else for(let u=0;u<o;u++)for(let d=0;d<s;d++){const p=4*(u*s+d),m=2*(d*o+u);c[p]=i[m],c[p+1]=i[m+1],c[p+3]=i[m]===-1?0:1}return new Ct(t,l,c)}function kce(t,e){const r=new pr;return r.internalFormat=Tt.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=At.NEAREST,r.wrapMode=Pt.CLAMP_TO_EDGE,new Ct(t,r,e)}function Ngt(t,e,r,i=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:dp,u_transformGridSize:t?t.size:dp,u_targetImageSize:e,u_srcImageSize:r}}function Fgt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Ugt(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function kgt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const zce={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let zgt=class{constructor(e,r,i=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=n||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=Le(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...zce,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||zce}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var n;return!!((n=this._bandIds)!=null&&n[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?At.LINEAR:At.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=Le(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=Dgt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:n,opacity:s}=this,o=Ngt(r,[i,n],[this.source.width,this.source.height],s),a=Fgt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Ugt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?kgt(this.symbolizerParameters):null;return new tU(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Le(this._rasterTexture),this._transformGridTexture=Le(this._transformGridTexture),this._colormapTexture=Le(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Le(this._rasterTexture));const n=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&n)return;this._rasterTexture=Le(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Lgt(e,i,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((n,s)=>n!==r[s])?(this._colormapTexture=Le(this._colormapTexture),this._colormapTexture=kce(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=kce(e,i),void(this._colormap=i)):(this._colormapTexture=Le(this._colormapTexture),void(this._colormap=null))}},nN=class{constructor(){this.waitingAgents=new Nt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=Lz.acquire();return r._init(e),r}release(){this.dispose(),sN.delete(this),Lz.release(this)}dispose(){this.loadingAgent=Le(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=YT(this._data)}static prune(){Lz.prune(0)}_init(e){this.waitingAgents.clear(),this._data=YT(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=yu(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),_gt(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){YT(this._data),this._data=e}};const Lz=new ko(nN,null,()=>{}),sN=new Map;function Bgt(){sN.size>0&&(console.log(`${sN.size} live TilePerLayerInfo allocations:`),sN.forEach(t=>console.log(t,`
`)))}let L2=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}};var gt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(gt||(gt={}));const Vgt=.1;let mK=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=jt(),this._elevationBounds=Ne(),this.layerInfo=[[],[]],this.extentInRadians=jt(),this.centerAtSeaLevel=O(),this._center=[O(),vn(),O()],this.up=sY(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=O()}static prune(){gK.prune(0),yK.prune(0),nN.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Dn.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??sa.INTERSECTS;this._frustumVisibility=r===sa.INSIDE?sa.INSIDE:r===sa.OUTSIDE?sa.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==sa.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Mr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Dn.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,r&&r.elevationBounds?fs(this._elevationBounds,r.elevationBounds):er(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const n of Uv){const s=i.numLayers(n),o=this.layerInfo[n];for(const a of o)a.release();o.length=s;for(let a=0;a<s;a++)o[a]=nN.acquire(this._surface.upsampleInfoPool),n===Zt.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,F3)}release(){_f(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Uv){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Zt.MAP].reduce((e,r)=>e+(r instanceof Iz?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){var i;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:n}of this.layerInfo[Zt.MAP])n instanceof Iz?e+=this._getTerrainDataMemory(n):this._mapTileMemoryInternal+=this._getTerrainDataMemory(n);const r=this._cpuImageMemorySize;for(const n of this.layerInfo[Zt.ELEVATION])this._usedMemory+=n.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((i=this.renderData.texture)==null?void 0:i.gpuMemoryUsage)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===Zt.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===Zt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof L2?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof Q8?this._cpuImageMemorySize:e instanceof zgt?e.memoryUsage:e instanceof Iz?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const r=this._center[Dn.MIDDLE],i=e,n=r[0],s=r[1],o=r[2],a=i[2]*n+i[6]*s+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*n+i[7]*s+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===sa.OUTSIDE))return gt.NONE;const n=this.level;ae(ZI,this._center[Dn.MIDDLE],r);let s=la(ZI),o=ZI,a=Dn.MIDDLE;ae(Dz,this._center[Dn.TOP],r);const l=la(Dz);l<s&&(s=l,o=Dz,a=Dn.TOP),ae(Nz,this._center[Dn.BOTTOM],r);const c=la(Nz);if(c<s&&(s=c,o=Nz,a=Dn.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return gt.SPLIT;const u=i!=null?i-n:1/0,d=Math.sqrt(s),p=e.fovX*d*2,m=this._edgeLen/p,y=()=>{if(n<e.maxLod)return this.elevationLevel=n,gt.NONE;const R=n+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return R!==this.elevationLevel?(this.elevationLevel=R,gt.ELEVATION):gt.NONE};if(u<=.5)return y();const _=fe(this.up,ZI),v=this._elevationBounds[1]-this._elevationBounds[0],b=v/this.edgeLen;if(e.aboveGround&&_>0&&b<.001&&_/d-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return gt.NONE;const x=i!=null?3-Math.min(u,2):1;if(m*x<e.relativeWidthLimit||n>=e.maxLod)return y();if(n<7)return gt.SPLIT;te(so,this.up,_),ae(so,so,o);const T=la(so);if(T<=this.radius*this.radius)return gt.SPLIT;te(so,so,this.radius/Math.sqrt(T)),oe(so,so,this._center[a]),ae(so,r,so);const S=Math.min(1,(Math.abs(fe(so,this.up))+.5*v+this._curvatureHeight)/Te(so)),A=Vgt/e.angledSplitBias,C=e.fovY*d*2;return S*(this._edgeLen/C*x)<A*e.relativeHeightLimit?gt.NONE:gt.SPLIT}setChildren(e,r,i,n){_f(!!(e&&r&&i&&n),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of Uv)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of Uv){const i=this.layerInfo[r];for(const n of i)n.loadingAgent&&n.loadingAgent!==Gl&&(YI(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(gt.GEOMETRY),this.resetPendingUpdate(gt.TEXTURE_NOFADING),this.resetPendingUpdate(gt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Zt.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Gl&&(YI(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Cb(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=i&&this._isWithinClippingArea,s=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(gt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Uv){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Gl&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(gt.SPLIT)||e!==Zt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===gt.SPLIT||e===gt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const n=this.layerInfo[r][e];if(n.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(n.waitingAgents.push(i),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e);const a=n.data&&"type"in n.data&&n.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(n.requestPromise)return!0;yu(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,r,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return la(ae(so,this._center[Dn.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const n=this.layerInfo[r][e],s=n.waitingAgents,o=s.removeUnordered(i)!=null;_f(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const n=i!=null&&"type"in i&&i.type==="vector-tile",s=this.layerInfo[r][e];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const n=this.layerInfo[r][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,r)),e){case Zt.MAP:return this._updateTexture(r);case Zt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===ns.FADING?gt.TEXTURE_NOFADING:gt.TEXTURE_FADING),this.setPendingUpdate(e===ns.FADING?gt.TEXTURE_FADING:gt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(gt.GEOMETRY);for(const e of this.layerInfo[Zt.ELEVATION])e.pendingUpdates|=gt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];er(e,1/0,-1/0);const n=this.layerInfo[Zt.ELEVATION];let s=!0;for(const o of n)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;te(so,this.up,r),oe(i[Dn.MIDDLE],this.centerAtSeaLevel,so),te(so,this.up,e[0]),oe(i[Dn.TOP],this.centerAtSeaLevel,so),te(so,this.up,e[1]),oe(i[Dn.BOTTOM],this.centerAtSeaLevel,so)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[Zt.ELEVATION][e],n=JG(this.level),s=Math.max(this.elevationLevel-n,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,Zt.ELEVATION),l=gW(a);if(!CO(this,l,!1))return;const c=jgt;let u=!1;const d=i.data;if(d&&d.level<=s){const p=i.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,m,y=0;for(let _=this._parent;_&&(!m||y<n)&&(y=this.elevationLevel-_.level,p=m||p,m=_.layerInfo[Zt.ELEVATION][e].data,!(!m&&p&&_.level<=s));_=_.parent);m=m||p,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,u=!0))}u&&(i.elevationBounds==null&&(i.elevationBounds=new bT),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const n=this.layerInfo[i];for(const a of n)a.loadingAgent&&a.loadingAgent!==Gl&&(YI(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=r.length;n.length=o;for(let a=0;a<o;a++){const l=r[a];n[a]=l>-1?s[l]:nN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,ns.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Gl&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Uv){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Gl&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Gl&&this.updateRenderData(e,ns.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Gl&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Gl,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||_S(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var n,s,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(K5(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||_S((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const n=this._isSuspended(r);for(let s=e;s<i.length;++s){const o=i[s];let a=!1;const l=this._surface.layerViewByIndex(s,r),c=gW(l);if(o.loadingAgent?CO(this,c,!1)?(o.loadingAgent!==Gl&&o.loadingAgent.setSuspension(n),o.loadingAgent!==Gl&&(a=o.loadingAgent.update())):o.dispose():CO(this,c,!1)&&(o.loadingAgent=Ggt(this,s,r,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Gl&&this.setPendingUpdate(gt.GEOMETRY):(YI(o.loadingAgent),o.loadingAgent=Gl)),o.loadingAgent===Gl&&this.updateRenderData(r,ns.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,JG(this.level)-r),n=ge(1+(this.maxTesselation>>i),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const n of i)if(Hgt(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!r(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return r(s)?s:null}}return null}findNeighborTile(e,r){const i=this.lij,n=this.getNeighborLIJ(i,e);return n?Wgt(i,n)?r(this)?this:null:this._findLIJ(n,r):null}findCorner(e,r){const i=e===tt.NORTH_EAST?1:e===tt.NORTH_WEST?0:e===tt.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!r||!r(n));)n=n.children[i];return n}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,n=>r(n)||n.level===this.level))==null?void 0:i.findCorner(eF(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===tt.NORTH?[0,1]:e===tt.NORTH_EAST?[1]:e===tt.EAST?[1,3]:e===tt.SOUTH_EAST?[3]:e===tt.SOUTH?[2,3]:e===tt.SOUTH_WEST?[2]:e===tt.WEST?[0,2]:[0],n=s=>{const o=s.children;!r(s)&&o[0]&&i.forEach(a=>n(o[a]))};n(this)}forallNeighbors(e){jR.forEach(r=>this.findNeighborCornerTileExact(r,e)),Rf.forEach(r=>{var i;return(i=this.findNeighborTile(r,n=>n.level===this.level||e(n)))==null?void 0:i.forAllSubtreeOnSide(tF(r),e)})}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(be(!cs||i>=0),i===0)return 0;const n=2**i,s=(1&e)==1,o=s?0:1,a=r.lij[o+1]*n,l=this.lij[o+1],c=l-a,u=s?n-1-c:c;return cs&&(be(a<=l&&l<a+n),be(0<=u&&u<n)),u}forEachLoadedNeighbor(e){const r=this.level,i=n=>n.level===r||n.isLoaded;Rf.forEach(n=>{const s=this.findNeighborTile(n,i);s!=null&&s!==this&&s.forAllSubtreeOnSide(tF(n),o=>!!o.isLoaded&&(e(o,n),!0))}),jR.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,i))==null?void 0:o.findCorner(eF(n),a=>a.isLoaded);be(!s||SW(this,s,n)),s!=null&&s.isLoaded&&e(s,n)})}getNeighborLIJ(e,r){const i=Oce(r)?-1:Ace(r)?1:0,n=Ece(r)?-1:Cce(r)?1:0,s=[e[0],e[1]+i,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+tl()>=r}checkGeometryWaterproofness(){var e;Q5&&(be(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,n=.25*(r[2]-r[0]);if(Oce(e)&&r[3]+n>=i[3]||Ace(e)&&r[1]-n<=i[1])return!1;const s=this.surface.isGlobal;return!(!s&&Ece(e)&&r[0]-n<=i[0])&&!(!s&&Cce(e)&&r[2]+n>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;re(this._lastPOI,e);const i=this._center[Dn.MIDDLE],n=e[0]-i[0],s=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=n*n+s*s+o*o}};function Ggt(t,e,r,i){const n=r===Zt.ELEVATION?yK.acquire():gK.acquire();return n.init(t,e,r,i),n}function YI(t){t.dispose(),t instanceof NOe?yK.release(t):t instanceof FOe&&gK.release(t)}const gK=new ko(FOe),yK=new ko(NOe),jgt=new bT;var Dn;function Hgt(t,e){const r=t.level,i=e[0];if(r>i)return!1;const n=i-r,s=Math.floor(e[1]/2**n),o=Math.floor(e[2]/2**n);return s===t.lij[1]&&o===t.lij[2]}function Wgt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function qgt(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===tt.EAST||t.isWestEnd&&e.isEastEnd&&r===tt.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case tt.NORTH:return hh(t.extent[3],e.extent[1],i);case tt.SOUTH:return hh(t.extent[1],e.extent[3],i);case tt.EAST:return hh(t.extent[2],e.extent[0],i)||hh(t.extent[2],-e.extent[0],i);case tt.WEST:return hh(t.extent[0],e.extent[2],i)||hh(t.extent[0],-e.extent[2],i)}}function SW(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Bce(t,e,r):Bce(e,t,eF(r)))}function Bce(t,e,r){be(t.level>=e.level);const i=lmt(r),n=cmt(r),s=t.extent,o=e.extent,a=[i?s[0]:s[2],n?s[3]:s[1]],l=[i?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=hh(a[0],l[0],c)||t.surface.isGlobal&&hh(a[0],-l[0],c),d=hh(a[1],l[1],c);if(u&&d)return!0;if(t.level===e.level||!u&&!d)return be(!1),!1;const p=u?Vce(o[1],o[3],s[1],s[3],c):Vce(o[0],o[2],s[0],s[2],c);return be(p),p}function Vce(t,e,r,i,n){return t-n<=r&&r<=i&&i<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Dn||(Dn={}));const ZI=O(),Dz=O(),Nz=O(),so=O();let Xgt=class{constructor(){this._scales=$t(-1,-1,-1,-1),this._offsets=$t(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function Ygt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(w`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(w`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(w`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let _K=class extends qCe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=O(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var pc;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(pc||(pc={}));let Zgt=class extends _K{constructor(){super(...arguments),this.identifier=pc.Material,this.output=D.Color,this.transparent=!1,this.integratedMesh=!1}},Qgt=class extends _K{constructor(){super(...arguments),this.identifier=pc.ShadowMap}},Jgt=class extends _K{constructor(){super(...arguments),this.identifier=pc.Highlight}},rF=class extends ln{constructor(e,r){super(e,"vec4",jr.Draw,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}};var Rg;function Kgt(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new rF("overlayTexOffset",(n,s)=>e0t(n,s)),new rF("overlayTexScale",(n,s)=>t0t(n,s))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Ye("ovColorTex",(n,s)=>EW(n,s))),BOe(t,e)}function BOe(t,e){e.pbrMode!==et.Water&&e.pbrMode!==et.WaterOnIntegratedMesh&&e.pbrMode!==et.TerrainWithWater||t.include(ZCe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(w`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(w`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(w`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(w`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==et.Water&&e.pbrMode!==et.WaterOnIntegratedMesh&&e.pbrMode!==et.TerrainWithWater||(r0(i),lm(i),i.code.add(w`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function EW(t,e){return e.overlays.length===0?null:t.identifier===pc.Material&&t.output===D.Color?e.overlays[Oi.INNER].getColorTextureNoRasterImage():t.identifier===pc.Material&&t.output===D.ObjectAndLayerIdColor?e.overlays[Oi.INNER].getColorTexture(za.ObjectAndLayerIdColor):t.identifier===pc.Highlight?e.overlays[Oi.INNER].getValidTexture(tn.Highlight):null}function e0t(t,e){for(const r of e.overlays){const{index:i,extent:n}=r;Oye(n)>0&&(ZT[2*i]=t.toMapSpace[0]/nu(n)-n[0]/nu(n),ZT[2*i+1]=t.toMapSpace[1]/lp(n)-n[1]/lp(n))}return ZT}function t0t(t,e){for(const r of e.overlays){const{index:i,extent:n}=r;Oye(n)>0&&(ZT[2*i]=t.toMapSpace[2]/nu(n),ZT[2*i+1]=t.toMapSpace[3]/lp(n))}return ZT}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Rg||(Rg={}));const ZT=Qt();var Pf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Pf||(Pf={}));let r0t=class extends LJ{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=za.None}};function jC(t,e){t.vertex.uniforms.add(new iF("overlayTexOffset"),new iF("overlayTexScale")),t.fragment.uniforms.add(new Ce("overlayOpacity",r=>r.overlayOpacity),new Ye("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[Oi.INNER].getColorTexture(r.overlaySource))),BOe(t,e)}function i0t(t,e){const{vertex:r,fragment:i,varyings:n}=t;n.add("vtc","vec2"),r.uniforms.add(new iF("texOffsetAndScale")),i.uniforms.add(new Gce("tex")),i.uniforms.add(new Fz("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(r.uniforms.add(new iF("nextTexOffsetAndScale")),n.add("nvtc","vec2"),i.uniforms.add(new Gce("texNext")),i.uniforms.add(new Fz("nextTexOpacities")),i.uniforms.add(new n0t("fadeFactor")));const o=e.tileBlendInput===Pf.ColorComposite,a=e.tileBlendInput===Pf.GridComposite;a&&i.include(fK),o&&i.uniforms.add(new Fz("backgroundColor")),r.code.add(w`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?w`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:w``}
  }`),i.code.add(w`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?w`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?w`backgroundColor`:w`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:w`return color;`}
    }`),s?i.code.add(w`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(w`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let n0t=class extends ln{constructor(e){super(e,"float")}},Fz=class extends ln{constructor(e){super(e,"vec3")}},iF=class extends ln{constructor(e){super(e,"vec4")}},Gce=class extends ln{constructor(e){super(e,"sampler2D")}},VOe=class extends r0t{};function s0t(t){const e=new mr,{vertex:r,fragment:i,varyings:n}=e;e.include(LP),e.include(ZP,t),e.include(Uf,t);const s=()=>{e.include(UR,t),r.code.add(w`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};xc(r,t),e.include(Cl,t);const o=t.overlayMode!==Rg.Disabled,a=o&&t.invisible;switch(t.output){case D.Color:{e.include(i0t,t),e.include(ww,t),o&&e.include(jC,{...t,pbrMode:t.pbrMode===et.Terrain?et.TerrainWithWater:et.Water});const l=t.overlayMode===Rg.EnabledWithWater;l&&e.include(Ygt,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),t.screenSizePerspective&&jS(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(AE,t),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),r.code.add(w`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?w`forwardVertexTangent(vnormal);`:w``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?w`setOverlayVTC(uv);`:""}
          ${t.tileBorders?w`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?w`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?w`forwardLinearDepth();`:""}

        }
      `),e.include(fn,t),e.include(ww,t),e.include(JP,t),e.include(vw,t),fp(i,t),KP(i),NE(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Lt("viewDirection",(u,d)=>me(jce,ne(jce,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))),l&&i.uniforms.add(new Ye("ovWaterTex",(u,d)=>d.overlays.length===0?null:d.overlays[Oi.INNER].getNormalTexture(u.overlaySource)),new nSe("view",(u,d)=>Ml(o0t,d.camera.viewMatrix,u.origin))),i.code.add(w`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r0(i),lm(i),i.code.add(w`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?w`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?w`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===et.Terrain||t.pbrMode===et.TerrainWithWater?w`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:w`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?w`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?w`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?w`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:w`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?w`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case D.Depth:a&&e.include(jC,t),e.include(Xg,t),W_(e),pw(e),r.code.add(w`
              void main(void) {
                ${a?w`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(w`
              void main() {
                ${a?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case D.Shadow:case D.ShadowHighlight:case D.ShadowExcludeHighlight:e.include(Xg,t),W_(e),pw(e),r.code.add(w`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(w`void main() {
outputDepth(linearDepth);
}`);break;case D.Normal:a&&e.include(jC,t),n.add("vnormal","vec3"),jS(r),s(),r.code.add(w`
            void main(void) {
              ${a?w`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(w`
            void main() {
              ${a?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case D.Highlight:o&&e.include(jC,t),r.code.add(w`
          void main() {
            ${o?w`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(c0,t),i.code.add(w`
          void main() {
            ${o?w`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===D.ObjectAndLayerIdColor&&(e.include(jC,{...t,pbrMode:et.Disabled}),r.code.add(w`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(w`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const o0t=_e(),jce=O(),a0t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:VOe,build:s0t},Symbol.toStringTag,{value:"Module"}));let GOe=class jOe extends Tr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global}initializeProgram(e){return new vr(e.rctx,jOe.shader.get().build(this.configuration),HOe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Ot({blending:r.renderOccluded?Cc(ve.ONE,ve.ONE_MINUS_SRC_ALPHA):null,culling:i?VZ:null,depthTest:r.renderOccluded?null:{func:Hr.LESS},depthWrite:r.renderOccluded?null:$l,colorWrite:Ft,stencilTest:e?bst(Rl.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};GOe.shader=new _r(a0t,()=>ce(()=>import("./Terrain.glsl-84e9c4a7.js"),[]));const HOe=new Map([[E.POSITION,0],[E.UV0,1],[E.NORMALCOMPRESSED,2]]);let l0t=class{constructor(){this.geometry=new sgt,this.intersectionData=null,this.geometryState=null,this._textureRef=new $Oe(()=>this.tile.surface.textureFadeDuration),this.overlay=new Xgt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,vi(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new hgt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),cs&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)be(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return n}const s=i.level,o=Rf[e];if(!r)return be(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),n;if(r.isLoaded){const c=r,u=c.renderData.geometryState,d=s-c.level;if(be(d>=0),d===0){const y=u.numVerticesPerSide-1;return Math.max(y,n)}const p=2**d,m=u.neighborData.edgeResolutions[(e+2)%4]/p;return Math.max(1,m)}be(!r.isLeaf);let a=n;return r.forAllSubtreeOnSide(tF(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-s)),!0):(be(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),n=r.edgePeerNeighbors,s=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(Rf[l],i),u=sb(e,c),d=((a=u==null?void 0:u.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,p=n[l],m=u!==sb(e,p),y=s[l]!==d;n[l]=c,(m||y)&&(s[l]=d,this._markEdgeDirty(l));const _=r.edgeResolutions[l],v=this._calculateEdgeResolution(l,c);be(tw(v)),be(v>=1),r.edgeResolutions[l]=v,_!==v&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(jR[l],i);o[l]=c;const u=sb(e,n[l]),d=sb(e,n[(l+1)%4]),p=sb(e,c);ad[l]=p,ad[(l+1)%4]=d,ad[(l+2)%4]=e,ad[(l+3)%4]=u,be(ad.some(v=>(v==null?void 0:v.isLoaded)||v===e));const m=ad.reduce((v,b)=>Math.min(v,(b==null?void 0:b.level)??1/0),1/0);ad.forEach((v,b)=>{v&&(v==null?void 0:v.level)>m&&(ad[b]=null)}),be(ad.some(v=>(v==null?void 0:v.isLoaded)||v===e));const y=r.cornerNeighborData[l].cornerTiles,_=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let v=0;v<4;++v){const b=ad[v],x=(b==null?void 0:b.renderData.geometryState.samplerDataVersion)??-1,T=y[v]!==b,S=!T&&_[v]!==x;(T||S)&&(y[v]=b,_[v]=x,this._markCornerDirty(l))}be(y.some(v=>(v==null?void 0:v.isLoaded)||v===e))}cs&&be(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)ad[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;cs&&be(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,n=this.geometry.vertexAttributes,s=!i||!n||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,lgt(this.geometry),!0)}ensureTexture(e,r){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),n=Math.max(i,5);let s=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Hf(o.clippingArea,s)||(this._clippingAreaChanged=!0,o.clippingArea=s,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,n=e.gl;this._vao=new vp(e,HOe,{geometry:Mc(r.layout)},{geometry:Ar.createVertex(e,n.STATIC_DRAW,r.buffer)},Ar.createIndex(e,n.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=Ag.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[Zt.ELEVATION],i=r.length,n=new Array(i);let s=0,o=0,a=!1;for(let u=0;u<i;u++){const d=r[u];if(d.upsampleInfo!=null){const p=d.upsampleInfo.tile,m=p.layerInfo[Zt.ELEVATION][u].data,y=m&&m.samplerData;e&&e[s]===y||(a=!0),n[s++]=y,o=Math.max(o,p.lij[0])}else if(d.data){const p=this.tile.surface.layerViewByIndex(u,Zt.ELEVATION);if(CO(this.tile,p.layer,!1)){const m=d.data;e&&e[s]===m.samplerData||(a=!0),n[s++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,n;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((n=this.geometry.vertexAttributes)==null?void 0:n.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!cs)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void be(e==null?void 0:e.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=Rf.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),n=e.level;be(this._dirtyCorners===0),be(this._dirtyEdges===0),be(this._dirtyEdgeResolutions===0),be(!this._numVerticesPerSideChanged),be(!this._samplerDataChanged),be(!this._clippingAreaChanged),be(!this._wireframeChanged);const s=jR.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=s[a];be(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}Rf.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,L=>(L.level===n||(L==null?void 0:L.isLoaded))&&(L==null?void 0:L.intersectsClippingArea));if(!c){const L=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void be(!L)}be(c.isLoaded||c.level===e.level),be(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const u=n-c.level;if(!c.isLoaded)return be(!c.isLeaf),void be(u===0);const d=c.renderData;be(qgt(e,c,a)),be(u>=0);const p=2**u;if(u<0)return void be(!1);const m=e.renderData,y=m.geometry,_=y.outerEdges[l],v=y.numVerticesPerSide-1,b=d.geometry;if(!b)return void be(!1);const x=this.geometryState.neighborData.edgePeerNeighbors[l];if(x!=null&&x.isLoaded){const L=x.renderData;be(x==x),be(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===L.geometryState.samplerDataVersion),be(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===L.geometryState.samplerDataVersion)}const T=(l+2)%4,S=b.outerEdges[T],A=_.count-1,C=S.count-1;be(A*p===C,`Tile[${e.lij}]:e${l},res=${A} edgeRes mismatch with Neighbor[${c.lij}]:e${T},res=${C} (expected:${A*p})`);const R=e.extent,P=a===tt.NORTH||a===tt.SOUTH,F=S.count-1,k=F/2**u,V=_.count-1;if(k<1)return void be(V===1);be(k===V),be(tw(k));const z=b.numVerticesPerSide-1;be(u>0||k===Math.max(z,v));const X=e.getNeighborEdgeStartVertexIndex(l,c);be(0<=X&&X<p);const q=X*k;be(0<=q&&q<=F-k);let G=0,Q=q;_.getVertexPos(Bp,0),_.getVertexPos(Vp,_.count-1);const M=ci(Bp,Vp),I=Math.max(c0t,1e-4*M);for(let L=0;L<=k;++L){_.getVertexPos(Bp,G),S.getVertexPos(Vp,Q);const B=L/k,H=P?R[0]+B*(R[2]-R[0]):a===tt.WEST?R[0]:R[2],Z=P?a===tt.SOUTH?R[1]:R[3]:R[1]+B*(R[3]-R[1]),K=e.surface.extent;if(K==null||p6(K,H,Z)){const de=gP(Bp,Vp),Re=rc(Bp)-Kt.radius,Ke=rc(Vp)-Kt.radius,_t=de<I;if(!_t){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${G}/${_.count}] and [${c.lij}].edge${T}[${Q}/${S.count}]`),K!=null&&console.warn("  surface extent= ",K," x,y=",H,",",Z);const Fe=O();ae(Fe,m.localOrigin,d.localOrigin),rc(Fe)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${d.localOrigin} d=${rc(Fe)} [${Fe}]`),(()=>{const pe=ki(Bp),xt=ki(Vp);e.updateEdgeElevations(),c.updateEdgeElevations(),_.getVertexPos(Bp,G),S.getVertexPos(Vp,Q);const vt=O();Ws(vt,Bp,pe),rc(vt)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${pe} vs ${Bp} d=${rc(vt)} [${vt}]`),Ws(vt,Vp,xt),rc(vt)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${xt} vs ${Vp} d=${rc(vt)} [${vt}]`)})(),be(_t,`Mismatch in tile [${e.lij}].edge[${l}][${G}/${_.count}] vs neighbor [${c.lij}].edge[${T}][${Q}/${S.count}] ${Cm(Bp)} vs ${Cm(Vp)}  dist=${de} h(t|n|d)=${Re}|${Ke}|${Ke-Re}`)}_.getNormal(kx,G),S.getNormal(zx,Q),me(Hce,kx),me(Wce,zx);const at=fe(Hce,Wce),yt=1-at<.01||!1||e===c;if(!yt){const Fe=O();Ws(Fe,kx,zx);const pe=()=>`Mismatch in tile edge normal ${Sce(e.lij)} (${G}/${_.count-1}) edge ${l} vs neighbor ${Sce(c.lij)}  (${Q}/${S.count-1}) nedge ${T} :${Cm(kx)} vs ${Cm(zx)}  dot = ${at} : ${Cm(Fe)}`;console.warn("Mismatch in tile edge normal: ",pe());{e.updateEdgeElevations(),c.updateEdgeElevations();const xt=O(),vt=O();_.getNormal(xt,G),S.getNormal(vt,Q),N_(kx,xt)||console.warn("Missing update in tile normal: ",Cm(kx)," => ",Cm(xt)),N_(zx,vt)||console.warn("Missing update in neighbor normal: ",Cm(zx)," => ",Cm(vt))}be(yt,pe())}}G+=1,Q+=1}})}};const Bp=O(),Vp=O(),kx=O(),zx=O(),Hce=O(),Wce=O(),c0t=1,ad=[null,null,null,null];function sb(t,e){return e!=null&&e.isLoaded||e===t?e:null}const u0t=65536;function h0t(t,e){const r=t.tile,{extent:i,extentInRadians:n,surface:s}=r,o=t.localOrigin,a=t.geometryState,l=s.isWebMercator,c=a.numVerticesPerSide,u=c-1,d=(c-2)**2,p=l&&(e===ch.HAS_SOUTH_POLE||e===ch.HAS_BOTH_POLES),m=l&&(e===ch.HAS_NORTH_POLE||e===ch.HAS_BOTH_POLES),y=6,_=((p?1:0)+(m?1:0))*y*(u+1),v=a.neighborData,b=v.edgeResolutions.reduce((R,P)=>R+P+1,0),x=MOe(d+_+b),T=t.geometry;T.numVerticesPerSide=a.numVerticesPerSide,T.vertexAttributes=x;const S=T.boundingBox;vi(S);const A=vK(t);po.update(u,n,A),d0t(t),tRe(t,d),WOe(t);const C=[];if((()=>{let R=d+b;const P=o[0],F=o[1],k=o[2],V=r.ellipsoid.radius,z=i[1],X=i[3],q=(G,Q)=>{const M=Q*c;Oh(-P,-F,G*V-k,S),C.push({connectedRowOffset:M,connectedOuterEdgeOffset:G===1?0:2,rowOffset:R,latitudeResolution:y});const I=YOe(G===-1?z:X,V),L=G*Math.PI/2-I,B=.99*(G===1?1:-1),H=V+0,Z=x.position,K=x.uv0,{typedBuffer:de,typedBufferStride:Re}=x.normalCompressed;for(let Ke=1;Ke<=y;++Ke){const _t=I+L*(Ke/y),at=Math.cos(_t),yt=Math.sin(_t);for(let Fe=0;Fe<=u;Fe++){const pe=Fe/u,xt=po.sinLonLUT[Fe],vt=po.cosLonLUT[Fe]*at,Ee=xt*at,Be=yt,Ve=vt*H-P,pt=Ee*H-F,ut=Be*H-k;Oh(Ve,pt,ut,S),Z.setValues(R,Ve,pt,ut),np(K,R,pe,B),bw(de,R,vt,Ee,Be,Re),++R}}};p&&q(-1,0),m&&q(1,u)})(),eRe(T,a.numVerticesPerSide,C,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,cs)for(let R=0;R<4;++R)be(T.outerEdges[R].count===v.edgeResolutions[R]+1)}function d0t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,n=i-2,s=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:u,typedBufferStride:d}=a.normalCompressed,p=e.extent,m=p[0],y=p[2],_=p[1],v=p[3],b=e.ellipsoid.radius,x=r.samplerData,T=t.localOrigin,S=T[0],A=T[1],C=T[2],R=l.typedBuffer,P=l.typedBufferStride,F=1/s,k=o.boundingBox;let V=0;if(1<=n){const z=F,X=_*(1-z)+v*z,q=po.sinLatLUT[1],G=po.cosLatLUT[1];for(let Q=1;Q<=n;Q++){const M=Q*F,I=m*(1-M)+y*M,L=po.sinLonLUT[Q],B=po.cosLonLUT[Q],H=b+qi(I,X,x),Z=H*B*G-S,K=H*L*G-A,de=H*q-C;Oh(Z,K,de,k);const Re=(Q-1)*P;R[Re]=Z,R[Re+1]=K,R[Re+2]=de,np(c,Q-1,M,z)}}for(let z=1;z<=n;z++){const X=z*F,q=_*(1-X)+v*X,G=po.sinLatLUT[z],Q=po.cosLatLUT[z],M=z+1,I=M*F,L=_*(1-I)+v*I,B=po.sinLatLUT[M],H=po.cosLatLUT[M],Z=po.sinLonLUT[0],K=po.cosLonLUT[0],de=b+qi(m,q,x);let Re=K*Q*de-S,Ke=Z*Q*de-A,_t=G*de-C;const at=V*P;let yt=R[at],Fe=R[at+1],pe=R[at+2];for(let xt=1;xt<=n;xt++){const vt=xt*F,Ee=m*(1-vt)+y*vt,Be=po.sinLonLUT[xt],Ve=po.cosLonLUT[xt];let pt=0,ut=0,ar=0;if(xt<n){const ur=(V+1)*P;pt=R[ur],ut=R[ur+1],ar=R[ur+2]}else{const ur=po.sinLonLUT[s],ri=po.cosLonLUT[s],Ii=b+qi(y,q,x);pt=ri*Q*Ii-S,ut=ur*Q*Ii-A,ar=G*Ii-C}const Ge=Re,ft=Ke,cr=_t;Re=yt,Ke=Fe,_t=pe,yt=pt,Fe=ut,pe=ar;const nt=pt-Ge,ht=ut-ft,mt=ar-cr;let Mt=0,Ut=0,bi=0;if(z>1){const ur=(V-n)*P;Mt=R[ur],Ut=R[ur+1],bi=R[ur+2]}else{const ur=po.sinLatLUT[0],ri=po.cosLatLUT[0],Ii=b+qi(Ee,_,x);Mt=Ve*ri*Ii-S,Ut=Be*ri*Ii-A,bi=ur*Ii-C}const Fr=b+qi(Ee,L,x),di=Ve*H*Fr-S,Dt=Be*H*Fr-A,ei=B*Fr-C;if(z<n){const ur=V+n,ri=ur*P;R[ri]=di,R[ri+1]=Dt,R[ri+2]=ei,Oh(di,Dt,ei,k),np(c,ur,vt,I)}const Rr=Mt-di,qr=Ut-Dt,Sr=bi-ei;let wi=Ve*Q,$r=Be*Q,ti=G;ti*ti<.999&&(wi=mt*qr-ht*Sr,$r=nt*Sr-mt*Rr,ti=ht*Rr-nt*qr);const Xr=1/Math.sqrt(wi*wi+$r*$r+ti*ti);bw(u,V,wi*Xr,$r*Xr,ti*Xr,d),++V}}}function p0t(t){t.tile.intersectsClippingArea&&(WOe(t),rU(t))}function f0t(t){t.tile.intersectsClippingArea&&(XOe(t),qOe(t,!0),rU(t))}function WOe(t){t.tile.intersectsClippingArea&&(XOe(t),qOe(t))}function qOe(t,e=!1){const r=t.geometryState,i=t.geometry,n=r.neighborData,s=t.tile,o=s.level,a=s.extent,l=s.ellipsoid.radius,c=s.extentInRadians,u=c[0],d=c[2],p=c[1],m=c[3],y=r.samplerData,_=a[0],v=a[2],b=a[1],x=a[3],T=vK(t),S=i.boundingBox,A=t.localOrigin,C=A[0],R=A[1],P=A[2],F=i.vertexAttributes,k=F.position,V=k.typedBuffer,z=k.typedBufferStride,X=F.uv0;for(let q=0;q<4;++q){const G=q===1||q===3,Q=n.edgeResolutions[q];be(tw(Q));const M=Q+1,I=sb(s,n.edgePeerNeighbors[q]);if(nRe(s,I,q)){rRe(t,q,I);continue}const L=I!=null;be(!L||I.level===s.level),be(!L||Og(s,I)<=0);const B=I==null?void 0:I.renderData,H=B==null?void 0:B.geometryState;if(cs){const nt=s.surface;if(!I&&nt&&!nt.updatingRootTiles){const ht=Rf[q],mt=s.findNeighborTile(ht,Mt=>Mt.isLoaded||Mt.isLeaf||Mt.level===s.level);mt?mt.intersectsClippingArea&&(be(!mt.isLoaded),be(!mt.isLeaf),be(mt.level===o)):be((nt==null?void 0:nt.rootTiles)==null||!s.shouldHaveNeighbor(ht))}}const Z=q===1?a[2]:a[0],K=I==null?void 0:I.extent,de=K&&G?q===1?K[0]:K[2]:Z,Re=q===0?a[3]:a[1],Ke=q===1?1:0,_t=q===0?1:0,at=q===1?d:u,yt=q===0?m:p,Fe=Math.sin(at),pe=Math.cos(at),xt=Math.sin(yt),vt=Math.cos(yt),Ee=H==null?void 0:H.samplerData,Be=L?(nt,ht,mt)=>.5*(qi(nt,ht,y)+qi(mt,ht,Ee)):(nt,ht,mt)=>qi(nt,ht,y),Ve=i.outerEdges[q],pt=e&&M>3?M-3:1,ut=y!=null&&y.some(nt=>nt!=null),ar=Ee!=null&&Ee.some(nt=>nt!=null),Ge=ut||ar,ft=1/Q,cr=Ve.index0;be(!K||hh(K[2]-K[0],a[2]-a[0])),(()=>{const nt=q===1?-1:q===3?1:0,ht=q===0?-1:q===2?1:0,mt=(a[2]-a[0])*ft,Mt=nt*mt,Ut=ht*mt,bi=G?nt*((d-u)*ft):0,Fr=G?0:ht*ft,di=_t,Dt=G?at+bi:at,ei=G?Math.sin(Dt):Fe,Rr=G?Math.cos(Dt):pe,qr=G?at-bi:at,Sr=G?Math.sin(qr):Fe,wi=G?Math.cos(qr):pe,$r=G?yt:T(di+Fr),ti=G?xt:Math.sin($r),Xr=G?vt:Math.cos($r),ur=G?yt:T(di-Fr),ri=G?xt:Math.sin(ur),Ii=G?vt:Math.cos(ur);let Ks=0,eo=0,to=0;{const Ur=0*ft,Os=G?Z:_*(1-Ur)+v*Ur,Co=G?de:Os,ba=G?b*(1-Ur)+x*Ur:Re,ie=G?at:u*(1-Ur)+d*Ur,xi=G?Fe:Math.sin(ie),qh=G?pe:Math.cos(ie),Rs=G?T(Ur):yt,Xh=G?Math.sin(Rs):xt,Ze=G?Math.cos(Rs):vt,Nl=l+Be(Os,ba,Co);Ks=qh*Ze*Nl,eo=xi*Ze*Nl,to=Xh*Nl}let ro=0,ji=0,Li=0;{const Ur=1*ft,Os=G?Z:_*(1-Ur)+v*Ur,Co=G?de:Os,ba=G?b*(1-Ur)+x*Ur:Re,ie=G?at:u*(1-Ur)+d*Ur,xi=G?Fe:Math.sin(ie),qh=G?pe:Math.cos(ie),Rs=G?T(Ur):yt,Xh=G?Math.sin(Rs):xt,Ze=G?Math.cos(Rs):vt,Nl=l+Be(Os,ba,Co);ro=qh*Ze*Nl,ji=xi*Ze*Nl,Li=Xh*Nl}for(let Ur=1;Ur<M-1;Ur+=pt){let Os=0,Co=0,ba=0;{const wa=(Ur+1)*ft,Fl=G?Z:_*(1-wa)+v*wa,Tp=G?de:Fl,Ms=G?b*(1-wa)+x*wa:Re,Qi=G?at:u*(1-wa)+d*wa,f0=G?Fe:Math.sin(Qi),v1=G?pe:Math.cos(Qi),b1=G?T(wa):yt,Xw=G?Math.sin(b1):xt,w1=G?Math.cos(b1):vt,m0=l+Be(Fl,Ms,Tp);Os=v1*w1*m0,Co=f0*w1*m0,ba=Xw*m0}const ie=Os,xi=Co,qh=ba,Rs=ro,Xh=ji,Ze=Li;ro=ie,ji=xi,Li=qh;{const wa=cr+Ur,Fl=wa*z,Tp=Rs-C,Ms=Xh-R,Qi=Ze-P;V[Fl]=Tp,V[Fl+1]=Ms,V[Fl+2]=Qi,Oh(Tp,Ms,Qi,S);const f0=Ur*ft;np(X,wa,G?Ke:f0,G?f0:_t)}const Nl=Ks,Ps=eo,g1=to;Ks=Rs,eo=Xh,to=Ze;const y1=Rs,rl=Xh,dm=Ze,_1=1/Math.sqrt(y1*y1+rl*rl+dm*dm),qt=dm*_1;let d0=0,pm=0,p0=0;if(Ge&&qt*qt<.999){let wa=0,Fl=0,Tp=0;{const Ms=q===0?-1:1;wa=Ms*(ie-Nl),Fl=Ms*(xi-Ps),Tp=Ms*(qh-g1)}{const Ms=Ur*ft,Qi=G?Z:_*(1-Ms)+v*Ms,f0=G?de:Qi,v1=G?b*(1-Ms)+x*Ms:Re,b1=G?at:u*(1-Ms)+d*Ms,Xw=G?Fe:Math.sin(b1),w1=G?pe:Math.cos(b1),m0=G?T(Ms):yt,hM=G?Math.sin(m0):xt,il=G?Math.cos(m0):vt;let kE=y1,zE=rl,j=dm;if(L){const he=l+qi(f0-Mt,v1-Ut,Ee),we=G?il:Ii;kE=(G?wi:w1)*we*he,zE=(G?Sr:Xw)*we*he,j=(G?hM:ri)*he}{const he=l+qi(Qi+Mt,v1+Ut,y),we=G?il:Xr,nr=(G?Rr:w1)*we*he,Vn=(G?ei:Xw)*we*he,pi=(G?hM:ti)*he;L||(kE=2*y1-nr,zE=2*rl-Vn,j=2*dm-pi);const xa=q===3?-1:1,x1=xa*(kE-nr),HK=xa*(zE-Vn),WK=xa*(j-pi);d0=Tp*HK-Fl*WK,pm=wa*WK-Tp*x1,p0=Fl*x1-wa*HK;const pU=1/Math.sqrt(d0*d0+pm*pm+p0*p0);d0*=pU,pm*=pU,p0*=pU}}}else d0=y1*_1,pm=rl*_1,p0=dm*_1;Ve.setNormalFromValues(Ur,d0,pm,p0)}})()}}function XOe(t){iRe(t)}function YOe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function m0t(t,e,r,i){return YOe(t*(1-i)+e*i,r)}function g0t(t,e,r){return t*(1-r)+e*r}function vK(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,n=e.ellipsoid.radius;return s=>m0t(i[1],i[3],n,s)}const r=e.extentInRadians;return i=>g0t(r[1],r[3],i)}function y0t(t,e){const r=t.tile.extent,i=t.geometryState,n=r[0],s=r[1],o=r[2]-n,a=r[3]-s,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-n)/o):0,u=l!=null?Math.max(0,(l[1]-s)/a):0,d=l!=null?Math.min(1,(l[2]-n)/o):1,p=l!=null?Math.min(1,(l[3]-s)/a):1,m=i.numVerticesPerSide,y=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((T,S)=>T+S+1,0),v=MOe(y+_),b=t.geometry,x=b.boundingBox;vi(x),b.numVerticesPerSide=i.numVerticesPerSide,b.vertexAttributes=v,gi(b.uvRange,c,u,d,p),_0t(t),tRe(t,y),ZOe(t),eRe(b,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),t.intersectionData=null}function _0t(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,n=i.samplerData,s=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??bK,c=e.extent,u=c[0],d=c[1],p=c[2],m=c[3],y=Math.max(u,l[0]),_=Math.min(p,l[2]),v=Math.max(d,l[1]),b=Math.min(m,l[3]),x=e.ellipsoid.radius,T=e.horizontalScale,S=i.numVerticesPerSide,A=S-1,C=S-2,R=t.geometry,P=R.vertexAttributes,F=P.position,k=P.uv0,{typedBuffer:V,typedBufferStride:z}=P.normalCompressed,X=R.uvRange,q=X[0],G=X[1],Q=X[2],M=X[3],I=R.boundingBox,L=s[0],B=s[1],H=s[2],Z=F.typedBuffer,K=F.typedBufferStride;let de=0;const Re=ge(d,v,b),Ke=o?(Math.PI/2-2*Math.atan(Math.exp(-Re/x)))*x:Re*T,_t=1/A,at=ge(d*(1-_t)+m*_t,v,b);let yt=Ke,Fe=o?(Math.PI/2-2*Math.atan(Math.exp(-at/x)))*x:at*T;for(let pe=1;pe<=C;pe++){const xt=pe/A,vt=ge(d*(1-xt)+m*xt,v,b),Ee=ge(xt,G,M),Be=Fe,Ve=(pe-1)/A,pt=ge(d*(1-Ve)+m*Ve,v,b),ut=yt,ar=(pe+1)/A,Ge=ge(d*(1-ar)+m*ar,v,b),ft=o?(Math.PI/2-2*Math.atan(Math.exp(-Ge/x)))*x:Ge*T,cr=ge(ar,G,M);yt=Fe,Fe=ft;const nt=ge(u,y,_);let ht=nt*T,mt=qi(nt,vt,n);const Mt=1/A,Ut=ge(Mt,q,Q),bi=ge(u*(1-Ut)+p*Ut,y,_);let Fr=Ut,di=bi,Dt=bi*T,ei=qi(bi,vt,n);if(pe===1){const Rr=Dt-L,qr=yt-B,Sr=ei-H,wi=0*K;Z[wi]=Rr,Z[wi+1]=qr,Z[wi+2]=Sr,Oh(Rr,qr,Sr,I);const $r=ge(Mt,q,Q);np(k,de,$r,Ee)}for(let Rr=1;Rr<=C;Rr++){const qr=Dt,Sr=ei,wi=(Rr+1)/A,$r=ge(wi,q,Q),ti=ge(u*(1-wi)+p*wi,y,_),Xr=di;di=ti;{const ji=de+1,Li=ji*K;if(pe===1||Rr===C){const Ur=ti*T,Os=qi(ti,vt,n);if(pe===1&&Rr<C){const Co=Ur-L,ba=Be-B,ie=Os-H;Z[Li]=Co,Z[Li+1]=ba,Z[Li+2]=ie,Oh(Co,ba,ie,I),np(k,ji,$r,Ee)}Dt=Ur,ei=Os}else Dt=Z[Li]+L,ei=Z[Li+2]+H}const ur=Dt,ri=ei,Ii=ht,Ks=mt;ht=qr,mt=Sr;const eo=(de-C)*K,to=pe===1?qi(Xr,pt,n):Z[eo+2]+H,ro=qi(Xr,Ge,n);if(pe<C){const ji=de+C,Li=ji*K,Ur=qr-L,Os=ft-B,Co=ro-H;Z[Li]=Ur,Z[Li+1]=Os,Z[Li+2]=Co,Oh(Ur,Os,Co,I);const ba=Fr;Fr=$r,np(k,ji,ba,cr)}{const ji=ur-Ii,Li=ut-ft,Ur=Li*(ri-Ks),Os=ji*(to-ro),Co=-Li*ji,ba=Ur*Ur+Os*Os+Co*Co;if(ba===0)bw(V,de,0,0,1,z);else{const ie=1/Math.sqrt(ba);bw(V,de,Ur*ie,Os*ie,Co*ie,z)}}++de}}}function v0t(t,e){t.tile.intersectsClippingArea&&(JOe(t),QOe(t,!0),rU(t))}function b0t(t,e){t.tile.intersectsClippingArea&&(ZOe(t),rU(t))}function ZOe(t,e){t.tile.intersectsClippingArea&&(JOe(t),QOe(t,!1))}function QOe(t,e){const r=t.geometryState,i=r.neighborData,n=t.tile,s=n.surface,o=n.extent,a=r.clippingArea,l=a??bK,c=o[0],u=o[2],d=o[1],p=o[3],m=[p>l[3],u>l[2],d<l[1],c<l[0]],y=t.geometry,_=n.horizontalScale,v=KOe(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,_),b=y.boundingBox,x=y.uvRange[0],T=y.uvRange[1],S=y.uvRange[2],A=y.uvRange[3],C=Math.max(c,l[0]),R=Math.min(u,l[2]),P=Math.max(d,l[1]),F=Math.min(p,l[3]),k=t.localOrigin,V=k[0],z=k[1],X=k[2],q=r.samplerData;for(let G=0;G<4;++G){const Q=G===1||G===3,M=i.edgeResolutions[G];be(tw(M));const I=M+1,L=m[G],B=sb(n,i.edgePeerNeighbors[G]);if(!L&&nRe(n,B,G)){rRe(t,G,B);continue}const H=B!=null&&!L,Z=B==null?void 0:B.renderData,K=Z==null?void 0:Z.geometryState;if(cs&&(be(!H||B.level===n.level),be(!H||Og(n,B)<=0),n&&!B&&!s.updatingRootTiles)){const nt=Rf[G],ht=n.findNeighborTile(nt,mt=>mt.isLoaded||mt.isLeaf||mt.level===n.level);s.updatingRootTiles||(ht?ht.intersectsClippingArea&&(be(!ht.isLoaded),be(!ht.isLeaf),be(ht.level===n.level)):be((s==null?void 0:s.rootTiles)==null||!n.shouldHaveNeighbor(nt)))}const de=ge(G===1?u:c,C,R),Re=ge(G===0?p:d,P,F),Ke=K==null?void 0:K.samplerData,_t=y.outerEdges[G],at=e&&I>3?I-3:1,yt=ge(G===1?1:0,x,S),Fe=ge(G===0?1:0,T,A),pe=H?(nt,ht)=>.5*(qi(nt,ht,Ke)+qi(nt,ht,q)):(nt,ht)=>qi(nt,ht,q),xt=(u-c)/M,vt=Q?G===1?xt:-xt:0,Ee=Q?0:G===0?xt:-xt,Be=-vt,Ve=-Ee;let pt=0,ut=0,ar=0;{const nt=0/M,ht=Q?de:ge(c*(1-nt)+u*nt,C,R),mt=Q?ge(d*(1-nt)+p*nt,P,F):Re,Mt=pe(ht,mt);pt=ht*_,ut=v(mt),ar=Mt}let Ge=0,ft=0,cr=0;{const nt=1/M,ht=Q?de:ge(c*(1-nt)+u*nt,C,R),mt=Q?ge(d*(1-nt)+p*nt,P,F):Re,Mt=pe(ht,mt);Ge=ht*_,ft=v(mt),cr=Mt}for(let nt=1;nt<I-1;nt+=at){const ht=nt/M,mt=Ge,Mt=ft,Ut=cr;{const $r=Q?yt:ge(ht,x,S),ti=Q?ge(ht,T,A):Fe,Xr=mt-V,ur=Mt-z,ri=Ut-X;Oh(mt,ur,ri,b),_t.setVertexFromValuesRawPositionUV(nt,Xr,ur,ri,$r,ti)}{const $r=(nt+1)/M,ti=Q?de:ge(c*(1-$r)+u*$r,C,R),Xr=Q?ge(d*(1-$r)+p*$r,P,F):Re,ur=pe(ti,Xr);Ge=ti*_,ft=v(Xr),cr=ur}const bi=Ge,Fr=cr,di=pt,Dt=ut,ei=ar;pt=mt,ut=Mt,ar=Ut;let Rr=0,qr=0,Sr=0;if(Q){const $r=ft-Mt,ti=Fr-Ut,Xr=Dt-Mt,ur=ei-Ut,ri=ge(d*(1-ht)+p*ht,P,F),Ii=de+Be,Ks=Ii*_-mt,eo=qi(Ii,ri,q)-Ut,to=G===3?-1:1;if(Rr=to*(-Xr+$r)*eo,qr=to*Ks*(-ur+ti),Sr=-to*Ks*(-Xr+$r),H){const ro=de+vt,ji=ro*_-mt;Rr=(-Xr+$r)*(eo-(qi(ro,ri,Ke)-Ut)),qr=(Ks-ji)*(-ur+ti),Sr=-(Ks-ji)*(-Xr+$r)}}else{const $r=bi-mt,ti=Fr-Ut,Xr=di-mt,ur=ei-Ut,ri=ge(c*(1-ht)+u*ht,C,R),Ii=Re+Ve,Ks=qi(ri,Ii,q)-Ut,eo=v(Ii)-Mt,to=G===2?-1:1;if(Rr=to*eo*(-ur+ti),qr=to*(-Xr+$r)*Ks,Sr=-to*eo*(-Xr+$r),H){const ro=ri,ji=Re+Ee,Li=v(ji)-Mt;Rr=(-eo+Li)*(-ur+ti),qr=(-Xr+$r)*(-Ks+(qi(ro,ji,Ke)-Ut)),Sr=-(-eo+Li)*(-Xr+$r)}}const wi=1/Math.sqrt(Rr*Rr+qr*qr+Sr*Sr);_t.setNormalFromValues(nt,Rr*wi,qr*wi,Sr*wi)}}}function JOe(t,e){iRe(t)}function w0t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function x0t(t,e){return t*e}function KOe(t,e,r){return t?i=>w0t(i,e):i=>x0t(i,r)}function eRe(t,e,r,i,n,s){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),c=Rf.map((T,S)=>S===0&&n[1]<e-2||S===1&&i[1]<e-2||S===2&&n[0]>1||S===3&&i[0]>1),u=t.outerEdges.reduce((T,S,A)=>T+(c[A]?0:o-2+S.count-1),0),d=r.reduce((T,S)=>T+o*(2*(S.latitudeResolution-1)+1),0),p=s?2:1,m=3*(l+u+d)*p,y=a>=u0t?new Uint32Array(m):new Uint16Array(m);let _=0;const v=e-2,b=o-2;be(b>=0);const x=(T,S,A,C,R,P)=>{const F=T*R,k=P[F],V=P[F+1],z=P[F+2],X=S*R,q=P[X],G=P[X+1],Q=P[X+2],M=A*R,I=P[M],L=P[M+1],B=P[M+2],H=C*R,Z=P[H],K=P[H+1],de=P[H+2];return(q-Z)*(q-Z)+(G-K)*(G-K)+(Q-de)*(Q-de)>(k-I)*(k-I)+(V-L)*(V-L)+(z-B)*(z-B)};if(s){const T=(A,C,R)=>{y[_++]=A,y[_++]=C,y[_++]=C,y[_++]=R,y[_++]=R,y[_++]=A,cs&&(be(A<a),be(C<a),be(R<a),be(_<=m))};(()=>{for(let A=Math.max(n[0],1)-1;A<Math.min(n[1],e-2)-1;++A){const C=A*v;for(let R=Math.max(i[0],1)-1;R<Math.min(i[1],e-2)-1;++R){const P=A*v+R,F=P+1,k=F+v,V=k-1,z=C+R,X=z+1,q=X+v,G=q-1,Q=t.vertexAttributes.position.typedBuffer,M=t.vertexAttributes.position.typedBufferStride;x(z,X,q,G,M,Q)?(T(P,F,k),T(k,V,P)):(T(P,F,V),T(V,k,F))}}})(),be(_===3*l*p),(()=>{for(let A=0;A<4;++A){const C=_;if(c[A])continue;const R=t.outerEdges[A],P=t.innerEdges[A];let F=0,k=0;const V=R.count,z=P.count;be(z===o-1);let X=0;const q=A===1||A===2?(G,Q,M)=>T(G,Q,M):(G,Q,M)=>T(G,M,Q);for(;F<V-1||k<z-1;){const G=P.getVertexIndex(k),Q=R.getVertexIndex(F),M=F<V-1,I=k<z-1;M&&(!I||(M?0+o*(F+.5)/(V-1):0)<=(I?1+b*(k+.5)/(z-1):0))?(++F,cs&&be(F<V),q(G,Q,R.getVertexIndex(F)),X++):(++k,cs&&be(k<z),q(G,Q,P.getVertexIndex(k)),X++)}cs&&(be(F===V-1),be(k===z-1),be(X===V+z-2),be(X===o-2+R.count-1),be(_===C+3*X*p))}})(),be(_===3*(l+u)*p);const S=A=>{const C=t.outerEdges[A.connectedOuterEdgeOffset];let R=C.getVertexIndex(0),P=C.stride;for(let F=0;F<A.latitudeResolution;++F){const k=F===0?A.rowOffset:R+e;for(let V=0;V<o;V++)T(R,R+1,k+V),F<A.latitudeResolution-1&&T(R+1,k+V+1,k+V),R+=P;R=k,P=1}};r.forEach(S)}else{(()=>{const S=Math.max(n[0],1)-1,A=Math.min(n[1],e-2)-1,C=Math.max(i[0],1)-1,R=Math.min(i[1],e-2)-1;for(let P=S;P<A;++P){const F=P*v;for(let k=C;k<R;++k){const V=F+k,z=V+1,X=z+v,q=X-1,G=t.vertexAttributes.position.typedBuffer,Q=t.vertexAttributes.position.typedBufferStride;x(V,z,X,q,Q,G)?(y[_]=V,y[_+1]=z,y[_+2]=X,y[_+3]=X,y[_+4]=q,y[_+5]=V):(y[_]=V,y[_+1]=z,y[_+2]=q,y[_+3]=q,y[_+4]=z,y[_+5]=X),_+=6}}})(),be(_===3*l*p),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const A=t.outerEdges[S],C=t.innerEdges[S];let R=0,P=0;const F=A.count,k=C.count;be(k===o-1);const V=S===1||S===2,z=V?1:2,X=V?2:1,q=A.index0,G=A.stride,Q=C.index0,M=C.stride;for(;R<F-1||P<k-1;){const I=Q+P*M,L=q+R*G,B=R<F-1,H=P<k-1,Z=B&&(!H||(B?0+o*(R+.5)/(F-1):0)<=(H?1+b*(P+.5)/(k-1):0));Z?++R:++P;const K=Z?L+G:I+M;y[_]=I,y[_+z]=L,y[_+X]=K,_+=3}}})(),be(_===3*(l+u)*p);const T=S=>{const A=t.outerEdges[S.connectedOuterEdgeOffset];let C=A.getVertexIndex(0),R=A.stride;for(let P=0;P<S.latitudeResolution;++P){const F=P===0?S.rowOffset:C+e;for(let k=0;k<o;k++){const V=F+k;y[_]=C,y[_+1]=C+1,y[_+2]=V,P<S.latitudeResolution-1?(y[_+3]=C+1,y[_+4]=V+1,y[_+5]=V,_+=6):_+=3,C+=R}C=F,R=1}};r.forEach(T)}be(_===m),t.indices=y,t.indexCount=m}function tRe(t,e){const r=t.localOrigin,i=t.geometry,n=t.geometryState.neighborData.edgeResolutions,s=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?s-1:0)*s+(l===1?s-1:0),d=(c?0:1)*s+(c?1:0);i.innerEdges[l]=new Dce(o,r,u,d,s)}{const c=a,u=n[l]+1;i.outerEdges[l]=new Dce(o,r,c,1,u),a+=u}}}function rRe(t,e,r){const i=(e+2)%4,n=t.geometryState,s=t.tile,o=n.neighborData,a=s.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];be(tw(c));const u=c+1,d=t.geometry,p=d.boundingBox,m=d.outerEdges[e],y=d.uvRange[0],_=d.uvRange[1],v=d.uvRange[2],b=d.uvRange[3],x=ge(e===1?1:0,y,v),T=ge(e===0?1:0,_,b),S=r.renderData,A=S.geometryState,C=S.geometry.outerEdges[i],R=s.getNeighborEdgeStartVertexIndex(e,r)*c,P=c*2**a;be(A.neighborData.edgeResolutions[i]===P),be(C.count-1===P);const F=S.localOrigin[0]-t.localOrigin[0],k=S.localOrigin[1]-t.localOrigin[1],V=S.localOrigin[2]-t.localOrigin[2],z=m.attributes,X=m.index0,q=m.stride,G=z.position.typedBuffer,Q=z.position.typedBufferStride,M=z.normalCompressed.typedBuffer,I=z.normalCompressed.typedBufferStride,L=z.uv0,B=C.attributes,H=C.index0,Z=C.stride,K=B.position.typedBuffer,de=B.position.typedBufferStride,Re=B.normalCompressed.typedBuffer,Ke=B.normalCompressed.typedBufferStride;for(let _t=1;_t<u-1;++_t){const at=X+q*_t,yt=H+Z*(R+_t),Fe=at*Q,pe=yt*de,xt=K[pe]+F,vt=K[pe+1]+k,Ee=K[pe+2]+V;G[Fe]=xt,G[Fe+1]=vt,G[Fe+2]=Ee,Oh(xt,vt,Ee,p);const Be=at*I,Ve=yt*Ke;M[Be]=Re[Ve],M[Be+1]=Re[Ve+1];const pt=_t/c,ut=l?x:ge(pt,y,v),ar=l?ge(pt,_,b):T;np(L,at,ut,ar)}}function iRe(t){var Fe;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,n=r.cornerNeighborData,s=t.geometry,o=s.outerEdges,a=s.boundingBox,l=t.tile,c=((Fe=t.tile.surface.view)==null?void 0:Fe.viewingMode)==="local",u=l.ellipsoid.radius,d=l.extentInRadians,p=l.horizontalScale;let m=0,y=0,_=0;const v=(pe,xt,vt)=>{const Ee=d[xt===0?1:3],Be=d[pe===0?0:2],Ve=Math.cos(Ee),pt=Math.sin(Ee),ut=Math.sin(Be),ar=Math.cos(Be),Ge=u+vt;m=ar*Ve*Ge,y=ut*Ve*Ge,_=pt*Ge},b=c?(()=>{const pe=t.geometryState.clippingArea,xt=l.extent,vt=pe!=null&&(xt[3]>pe[3]||xt[2]>pe[2]||xt[1]<pe[1]||xt[0]<pe[0]),Ee=KOe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,p);return(Be,Ve,pt)=>{const ut=Be===0?X[0]:X[2],ar=Ve===0?X[1]:X[3],Ge=vt?ge(ut,pe[0],pe[2]):ut,ft=vt?ge(ar,pe[1],pe[3]):ar,cr=pt;m=Ge*p,y=Ee(ft),_=cr}})():v;let x=0,T=0,S=0,A=0,C=0,R=0,P=0,F=0,k=0;const V=c&&t.tile.surface.isWebMercatorOnPlateeCarree,z=(pe,xt,vt,Ee,Be)=>{let Ve=0,pt=0,ut=0;if(c){const ar=xt*p,Ge=V?(Math.PI/2-2*Math.atan(Math.exp(-vt/u)))*u:vt*p;Ve=ar-m,pt=Ge-y,ut=Ee-_}else{const ar=vK(pe),Ge=pe.tile,ft=Ge.extent,cr=Ge.extentInRadians,nt=(xt-ft[0])/(ft[2]-ft[0]),ht=(vt-ft[1])/(ft[3]-ft[1]),mt=cr[0]*(1-nt)+cr[2]*nt,Mt=ar(ht),Ut=Math.cos(Mt),bi=Math.sin(Mt),Fr=Math.sin(mt),di=Math.cos(mt),Dt=u+Ee;Ve=di*Ut*Dt-m,pt=Fr*Ut*Dt-y,ut=bi*Dt-_}switch(Be){case 0:P+=Ve,F+=pt,k+=ut;break;case 1:A-=Ve,C-=pt,R-=ut;break;case 2:P-=Ve,F-=pt,k-=ut;break;case 3:A+=Ve,C+=pt,R+=ut}},X=l.extent,q=e.clippingArea,G=q??bK,Q=X[0],M=X[2],I=X[1],L=X[3],B=[L>G[3],M>G[2],I<G[1],Q<G[0]],H=Math.max(Q,G[0]),Z=Math.min(M,G[2]),K=Math.max(I,G[1]),de=Math.min(L,G[3]),Re=s.uvRange[0],Ke=s.uvRange[1],_t=s.uvRange[2],at=s.uvRange[3],yt=pe=>{var ar;const xt=n[pe].cornerTiles;x=0,T=0,S=1,A=0,C=0,R=0,P=0,F=0,k=0;let vt=1/0;for(let Ge=0;Ge<4;++Ge)vt=Math.min(vt,((ar=xt[Ge])==null?void 0:ar.level)??1/0);for(let Ge=0;Ge<4;++Ge){const ft=xt[Ge];HC[Ge]=(ft==null?void 0:ft.level)===vt?ft:null}let Ee=1,Be=0;for(let Ge=0;Ge<4;++Ge){const ft=HC[Ge];ft&&(Ee=Math.max(Ee,ft==null?void 0:ft.renderData.geometryState.numVerticesPerSide),Be=ft.extent[2]-ft.extent[0])}const Ve=Be,pt=Ee;be(pt>1);const ut=Ve/pt;for(let Ge=0;Ge<4;++Ge){const ft=HC[(Ge+3)%4],cr=HC[Ge%4];if(!ft&&!cr)continue;const nt=Ge===0?1:Ge===1?2:Ge===2?3:0,ht=Ge===0?2:Ge===1?3:Ge===2?0:1;if(ft&&cr){const mt=Uz[Ge][0]*ut,Mt=Uz[Ge][1]*ut,Ut=ft.extent,bi=Ut[nt===0||nt===1?2:0]+mt,Fr=Ut[nt===0||nt===3?3:1]+Mt,di=cr.extent,Dt=di[ht===0||ht===1?2:0]+mt,ei=di[ht===0||ht===3?3:1]+Mt,Rr=ft.renderData,qr=cr.renderData,Sr=qi(bi,Fr,Rr.geometryState.samplerData),wi=qi(Dt,ei,qr.geometryState.samplerData);z(Rr,bi,Fr,.5*(Sr+wi),Ge)}else{const mt=ft??cr,Mt=ft?nt:ht,Ut=mt.extent,bi=Uz[Ge],Fr=Ut[Mt===0||Mt===1?2:0]+bi[0]*ut,di=Ut[Mt===0||Mt===3?3:1]+bi[1]*ut,Dt=mt.renderData,ei=qi(Fr,di,Dt.geometryState.samplerData);z(Dt,Fr,di,ei,Ge)}}if(!c){const Ge=Math.sqrt(m*m+y*y+_*_);x=m/Ge,T=y/Ge,S=_/Ge}if(c||S*S<.999){const Ge=Math.sqrt(A*A+C*C+R*R);A/=Ge,C/=Ge,R/=Ge;const ft=Math.sqrt(P*P+F*F+k*k);P/=ft,F/=ft,k/=ft,x=R*F-C*k,T=A*k-R*P,S=C*P-A*F;const cr=1/Math.sqrt(x*x+T*T+S*S);x*=cr,T*=cr,S*=cr}};for(let pe=0;pe<4;++pe){const xt=pe,vt=(pe+1)%4,Ee=pe===0||pe===1?1:0,Be=pe===0||pe===3?1:0,Ve=ge(Ee,Re,_t),pt=ge(Be,Ke,at),ut=o[xt],ar=pe===0||pe===3?ut.count-1:0,Ge=o[vt],ft=pe===0||pe===1?Ge.count-1:0,cr=n[pe].cornerTiles;let nt=-1;for(let Mt=0;Mt<4;++Mt){const Ut=cr[Mt];Ut&&(nt===-1||Og(cr[nt],Ut)>0)&&(nt=Mt)}const ht=nt,mt=cr[ht];if(mt!==l){const Mt=l.level-mt.level,Ut=2**Mt,bi=[mt.lij[0]+Mt,mt.lij[1]*Ut,mt.lij[2]*Ut],Fr=[bi[1]+Ut===l.lij[1],pe===0&&(ht===1||ht===0&&mt!==cr[3])||pe===1&&(ht===0||ht===1&&mt!==cr[2]),bi[1]===l.lij[1]+1,pe===2&&(ht===3||ht===2&&mt!==cr[1])||pe===3&&(ht===2||ht===3&&mt!==cr[0])],di=Fr.reduce((Sr,wi)=>Sr+(wi?1:0),0);be(di===1||di===2);let Dt=-1,ei=-1;const Rr=mt.renderData;if(di===1){const Sr=Fr.findIndex($r=>$r);be(0<=Sr&&Sr<=3),Dt=(Sr+2)%4;const wi=t.geometryState.neighborData.edgeResolutions[Sr];ei=l.getNeighborEdgeStartVertexIndex(Sr,mt)*wi+wi*(Sr===0&&pe===0||Sr===1&&pe===0||Sr===2&&pe===1||Sr===3&&pe===3?1:0)}else{be(Fr[1]||Fr[3]),Dt=Fr[1]?3:1;const Sr=Rr.geometryState.neighborData.edgeResolutions[Dt];ei=pe===0||pe===3?0:Sr}const qr=Rr.geometry.outerEdges[Dt];{const Sr=ut.index0+ar*ut.stride,wi=Ge.index0+ft*Ge.stride,$r=qr.index0+ei*qr.stride;{const ti=qr.attributes.position,Xr=ti.typedBuffer,ur=$r*ti.typedBufferStride,ri=t.localOrigin,Ii=qr.localOrigin,Ks=Xr[ur]+Ii[0]-ri[0],eo=Xr[ur+1]+Ii[1]-ri[1],to=Xr[ur+2]+Ii[2]-ri[2];Oh(Ks,eo,to,a);{const ro=ut.attributes.position,ji=ro.typedBuffer,Li=Sr*ro.typedBufferStride;ji[Li]=Ks,ji[Li+1]=eo,ji[Li+2]=to}{const ro=Ge.attributes.position,ji=ro.typedBuffer,Li=wi*ro.typedBufferStride;ji[Li]=Ks,ji[Li+1]=eo,ji[Li+2]=to}}np(ut.attributes.uv0,Sr,Ve,pt),np(Ge.attributes.uv0,wi,Ve,pt);{const ti=qr.attributes.normalCompressed.typedBuffer,Xr=$r*qr.attributes.normalCompressed.typedBufferStride;{const ur=ut.attributes.normalCompressed,ri=ur.typedBuffer,Ii=Sr*ur.typedBufferStride;ri[Ii]=ti[Xr],ri[Ii+1]=ti[Xr+1]}{const ur=Ge.attributes.normalCompressed,ri=ur.typedBuffer,Ii=wi*ur.typedBufferStride;ri[Ii]=ti[Xr],ri[Ii+1]=ti[Xr+1]}}}}else{const Mt=B[xt],Ut=B[vt];let bi;if(Mt||Ut){const ei=ge(Q*(1-Ee)+M*Ee,H,Z),Rr=ge(I*(1-Be)+L*Be,K,de),qr=e.samplerData;bi=qi(ei,Rr,qr)}else bi=T0t(cr);b(Ee,Be,bi),yt(pe);const Fr=m-i[0],di=y-i[1],Dt=_-i[2];Oh(Fr,di,Dt,a),ut.setVertexFromValuesRawPositionUVNormal(ar,Fr,di,Dt,Ve,pt,x,T,S),Ge.setVertexFromValuesRawPositionUVNormal(ft,Fr,di,Dt,Ve,pt,x,T,S)}}for(let pe=0;pe<4;++pe)HC[pe]=null}function T0t(t){var s,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);cs&&(be(!t[0]||!t[2]||SW(t[0],t[2],tt.SOUTH_WEST)),be(!t[1]||!t[3]||SW(t[1],t[3],tt.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,u=a===0||a===3,d=l.extent,p=d[c?0:2],m=d[u?1:3],y=(o=(s=l.renderData)==null?void 0:s.geometryState)==null?void 0:o.samplerData;i+=qi(p,m,y),r++}}const n=r?i/r:0;return be(n!=null),n}function rU(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const Uz=[[0,1],[1,0],[0,-1],[-1,0]],po=new cgt,bK=yY(-1/0,-1/0,1/0,1/0),HC=[null,null,null,null];function nRe(t,e,r){if(!e)return!1;const i=Og(t,e);return i>0||i===0&&r>=2}let S0t=class extends mK{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=jt(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const n=i.view.renderSpatialReference,s=i.spatialReference,o=n!=null&&HX(n)&&s!=null&&s.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const u=Se(c[0],c[1],0);Cs(u,St.WebMercator,u,St.PlateCarree);const d=Se(c[2],c[3],0);Cs(d,St.WebMercator,d,St.PlateCarree),l[0]=u[0],l[1]=u[1],l[2]=d[0],l[3]=d[1]}else for(let u=0;u<4;++u)l[u]=c[u]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),n=Math.sqrt(r*r+i*i),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(n,s);this._center[Dn.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const d=e[u],p=d[0],m=d[1],y=d[2],_=d[3];if(p*(p>0?i:o)+m*(m>0?n:a)+y*(y>0?s:l)+_>=0)return sa.OUTSIDE;c=c&&p*(p<0?i:o)+m*(m<0?n:a)+y*(y<0?s:l)+_<=0}return c?sa.INSIDE:sa.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return J9e(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,n){return QI[0]=1/r[0],QI[1]=1/r[1],QI[2]=1/r[2],JQ(this._aabb(),e,QI,i,n)}createGeometry(){y0t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){v0t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){b0t(this.renderData,this._horizontalScaleFactor)}};const QI=O();let E0t=class{constructor(){this.extent=Qt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},oN=class extends xe{constructor(){super(...arguments),this._queries=new Nt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Nt({initialSize:30}),this._queryPool=new ko(E0t)}queryVisibleLevelRange(e,r,i,n){const s=this._queryPool.acquire();vh(s.extent,e),s.minLevel=r??-Number.MAX_VALUE,s.maxLevel=i??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const n=this._queries.data[i],s=n.extent;r>=n.minLevel&&r<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};h([f()],oN.prototype,"updating",null),oN=h([N("esri.views.3d.terrain.ScaleRangeQueries")],oN);let C0t=class extends mK{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=vn(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const n=this.ellipsoid.radius,s=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],u=wt(o,l,.5),d=wt(s,a,.5),p=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-s)*Math.cos(p)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),kve(this.centerAtSeaLevel,d,u,this.ellipsoid.radius),me(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)ne(e[Dn.MIDDLE],0,0,0),ne(e[Dn.TOP],0,0,0),ne(e[Dn.BOTTOM],0,0,0),e[Dn.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Dn.MIDDLE],i=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,A0t(r,i,3*s));e[Dn.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!h_(e,this._boundingSphere))return sa.OUTSIDE;if(this.lij[0]<10)return sa.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<CE;s++){const o=s===si.NEAR,a=e[s],l=a[0],c=a[1],u=a[2],d=a[3]-(o?i:0);let p=!1;for(let m=0;m<8;++m){const y=3*m;if(l*r[y]+c*r[y+1]+u*r[y+2]+d<0){if(p=!0,!n)break}else n=!1}if(!p)return sa.OUTSIDE}return n?sa.INSIDE:sa.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){h0t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),cs&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,n=this.ellipsoid.radius,s=i[1];if(this.level===0)ne(r,0,0,0),e[3]=n+s;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];ev(Yce,a,l,n),ev(Zce,a,c,n),oe(r,Yce,Zce);const u=.5*(i[0]+i[1]);te(r,r,(n+u)/rc(r));const d=this.convexHull;let p=0;const m=(_,v)=>{const b=_[0]-d[3*v],x=_[1]-d[3*v+1],T=_[2]-d[3*v+2];return Math.sqrt(b*b+x*x+T*T)};for(let _=0;_<8;++_){const v=m(r,_);p=Math.max(p,v)}const y=p;e[3]=y+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===ch.HAS_NORTH_POLE,a=s&&n===ch.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],d=e[2],p=a?-c:e[1],m=o?c:e[3],y=.5*(u+d),_=i[0],v=r+(l?Math.min(0,_-1):_),b=(Q,M,I)=>ev(Q,M,I,v),x=O(),T=O(),S=O(),A=O();b(x,u,p),b(T,u,m),b(S,d,m),b(A,d,p);const C=(Q,M)=>{for(let I=0;I<3;++I)this._convexHull[3*M+I]=Q[I]};C(x,0),C(T,1),C(S,2),C(A,3);const R=i[1],P=r+(l?Math.max(0,R+1):R),F=O(),k=O(),V=O();ev(k,y,m,v),ev(V,y,p,v),oe(F,k,V),me(F,F);const z=O(),X=O(),q=(Q,M)=>{Ws(X,Q,M),me(X,X);const I=-fe(Q,z)/fe(X,z);be(I>=0),te(X,X,I),oe(Q,Q,X)};if(2**this.lij[0]>2*this.lij[1]){const Q=V,M=O();ot(M,Xce,Q),me(M,M),ot(z,Q,M),me(z,z),be(hh(fe(z,Q)/rc(Q),0)),q(x,T),q(A,S),C(x,0),C(A,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Q=k,M=O();ot(M,Xce,Q),me(M,M),ot(z,M,Q),me(z,z),q(T,x),q(S,A),C(T,1),C(S,2)}const G=(Q,M)=>{const I=P/fe(M,F);for(let L=0;L<3;++L)this._convexHull[3*Q+L]=M[L]*I};G(4,x),G(5,T),G(6,S),G(7,A)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?ch.HAS_BOTH_POLES:ch.HAS_NORTH_POLE:i?ch.HAS_SOUTH_POLE:ch.REGULAR}intersectsRay(e,r,i,n){const s=this._boundingSphere,o=s[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=s[0]-e[0],c=s[1]-e[1],u=s[2]-e[2],d=(l*r[0]+c*r[1]+u*r[2])/a,p=r[0]*d-l,m=r[1]*d-c,y=r[2]*d-u;return p*p+m*m+y*y<o*o}getDefaultVerticesPerSide(){return this.level<qce.length?qce[this.level]+1:2}updateCornerElevations(){f0t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){p0t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var vt;if(!cs||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,n=O(),s=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=s+o[0],l=1,c=0,u=this._center[Dn.MIDDLE][3],d=this.convexHull,p=(Ee,Be)=>{for(let Ve=0;Ve<3;++Ve)Ee[Ve]=d[3*Be+Ve]};{const Ee=O(),Be=O(),Ve=O(),pt=O(),ut=O(),ar=(Ge,ft,cr,nt)=>{p(Be,Ge),p(Ve,ft),p(pt,cr),Ws(Be,Be,Ve),Ws(pt,pt,Ve),ot(Ee,Be,pt),me(Ee,Ee);const ht=fe(Ee,Ve);p(ut,nt);const mt=fe(Ee,ut),Mt=Math.abs(mt-ht);be(hh(Mt,0),`Non coplanar ${Ge},${ft},${cr},${nt} diff = ${Mt}`)};ar(0,1,2,3),ar(4,5,6,7),ar(0,1,4,5),ar(1,2,5,6),ar(2,3,6,7),ar(3,0,7,4)}const m=Ys(24),y=(Ee,Be,Ve)=>{const pt=4*Ee;for(let ut=0;ut<3;++ut)m[pt+ut]=Be[ut];m[pt+3]=Ve},_=O(),v=O(),b=O(),x=O(),T=(Ee,Be,Ve,pt)=>{p(_,Be),p(v,Ve),p(b,pt),Ws(_,_,v),me(_,_),Ws(b,b,v),me(b,b),ot(x,_,b),me(x,x);const ut=fe(x,v);y(Ee,x,ut)};T(0,0,1,2),T(1,1,0,4),T(2,1,5,2),T(3,3,2,6),T(4,4,0,3),T(5,4,6,5);const S=1,A=(Ee,Be,Ve,pt)=>{const ut=4*Ee;return m[ut]*Be+m[ut+1]*Ve+m[ut+2]*pt-m[ut+3]},C=(Ee,Be,Ve,pt)=>A(Ee,Be,Ve,pt)>=-S,R=(Ee,Be)=>C(Ee,Be[0],Be[1],Be[2]),P=2**this.lij[0]>2*this.lij[1],F=(Ee,Be,Ve)=>Math.sqrt(sRe(Ee,Be,Ve,i[0],i[1],i[2]))<r,k=Ee=>F(Ee[0],Ee[1],Ee[2]),V=(Ee,Be)=>F(Ee[Be],Ee[Be+1],Ee[Be+2]),z=this.extentInRadians,X=.5*(z[0]+z[2]),q=z[1],G=z[3],Q=O(),M=O();ev(Q,X,G,a),ev(M,X,q,a);const I=P?"Upper":"Lower";let L=!0;for(let Ee=0;Ee<6;++Ee){for(let Be=0;Be<8;++Be){const Ve=3*Be,pt=C(Ee,d[Ve],d[Ve+1],d[Ve+2]);L&&(L=pt),be(pt,`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${Ee}`)}be(R(Ee,M),`Tile[${this.lij}] (${I}) bottom mid outside of plane ${Ee}`),be(R(Ee,Q),`Tile[${this.lij}] (${I}) top mid outside of plane ${Ee}`)}be(L,"Not all convex hull points are inside  convex hull polyhedron"),be(k(M),`Tile[${this.lij}] (${I}) bottom mid outside of bounding sphere`),be(k(Q),`Tile[${this.lij}] (${I}) top mid outside of bounding sphere`);for(let Ee=0;Ee<8;++Ee){const Be=V(d,3*Ee);be(Be,`Tile[${this.lij}] Convex hull point ${Ee} outside of bounding sphere`)}for(let Ee=0;Ee<6;++Ee)for(let Be=0;Be<8;++Be){const Ve=3*Be;C(Ee,d[Ve],d[Ve+1],d[Ve+2])||console.error(`Tile[${this.lij}] Convex hull point ${Be} outside of plane ${Ee}`)}const B=this.extentInRadians,H=Math.max(B[2]-B[0],B[3]-B[1]),Z=Math.round(H*s),K=this.renderData;if(!K)return;const{geometry:de,localOrigin:Re}=K,Ke=(vt=de.vertexAttributes)==null?void 0:vt.position;if(!Ke)return;const _t=Ke.count,at=O(),yt=de.numVerticesPerSide-2,Fe=yt*yt,pe=K.geometryState.neighborData,xt=pe.edgeResolutions.reduce((Ee,Be)=>Ee+Be+1,0);for(let Ee=0;Ee<_t;++Ee){const Be=Ee<Fe,Ve=!Be&&Ee<Fe+xt;let pt=!1,ut=-1;if(Ve){let Dt=Fe;for(let ei=0;ei<4;++ei){const Rr=pe.edgeResolutions[ei];if(Ee===Dt||Ee===Dt+Rr-1){pt=!0;break}if(Dt+=Rr,Ee<Dt){ut=ei;break}}}const ar=Ve?pe.edgePeerNeighbors[ut]:null,Ge=Ve&&ar&&Og(this,ar)>0;Ke.getVec(Ee,n),oe(at,n,Re);const ft=rc(at)-s;let cr=0,nt=!1;const ht=o[0]-ft,mt=ft-o[1],Mt=ht>l,Ut=mt>l,bi=Mt||Ut,Fr=()=>{const Dt=Be?"internal":Ve&&!pt?"edge":pt?"corner":"pole";return`Tile[${this.lij}].vertex[${Ee}]:${Dt}`+(Mt?"(below)":Ut?"(above)":"")+(Ge?"(Neighbor)":"")},di=gP(at,i);if(di>=r+c){const Dt=di-r;bi||(console.error(`${Fr()} is out of the bounding sphere by ${Dt.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${ft.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Dt/r).toFixed(0)})`),nt=!0)}for(let Dt=0;Dt<6;++Dt)if(!C(Dt,at[0],at[1],at[2])){const ei=A(Dt,at[0],at[1],at[2]),Rr=Ee%yt,qr=(Ee-Rr)/yt;Dt===0&&ht||Dt===5&&mt||(console.error(`${Fr()} (${Rr},${qr})|${yt}] is out of the bounding trapezoid plane ${Dt} h=${Math.round(ft)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(ei)} radii = ${Math.round(r)}/${Math.round(u)}} : maxL = ${Z}`),++cr)}if(nt||cr>0)break}}};const qce=[128,64,64,32,16,8,8,4];function A0t(t,e,r){return sRe(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function sRe(t,e,r,i,n,s){const o=i-t,a=n-e,l=s-r;return o*o+a*a+l*l}const ev=(t,e,r,i)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*n,t[1]=i*o*s,t[2]=i*a},Xce=[0,0,1],Yce=O(),Zce=O();let xd=class extends xe{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([f()],xd.prototype,"fovX",void 0),h([f()],xd.prototype,"fovY",void 0),h([f()],xd.prototype,"relativeWidthLimit",void 0),h([f()],xd.prototype,"relativeHeightLimit",void 0),h([f()],xd.prototype,"maxLod",void 0),h([f()],xd.prototype,"angledSplitBias",void 0),h([f()],xd.prototype,"aboveGround",void 0),h([f()],xd.prototype,"frustum",void 0),xd=h([N("esri.views.3d.terrain.SplitLimits")],xd);let oRe=class extends va{constructor(){super(...arguments),this.blendMode=Ae.Normal}};h([U({count:Ae.COUNT})],oRe.prototype,"blendMode",void 0);let AO=class extends oRe{constructor(){super(...arguments),this.output=ws.Composite,this.baseOpacityMode=Zd.NotRequired,this.premultipliedSource=Nd.Off}};h([U({count:ws.COUNT})],AO.prototype,"output",void 0),h([U({count:Zd.COUNT})],AO.prototype,"baseOpacityMode",void 0),h([U()],AO.prototype,"premultipliedSource",void 0);var Sw;function O0t(t){const e=new mr;if(e.include(kOe),t.background===Sw.Only){const r=t.output===ws.ColorComposite;return r?e.fragment.uniforms.add(new Lt("backgroundColor",i=>i.backgroundColor)):e.fragment.include(fK),e.fragment.code.add(w`
    void main() {
      fragColor = vec4(${r?w`backgroundColor`:w`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(zOe,t),e.fragment.uniforms.add(new Ye("tex",r=>r.texture)),e.fragment.uniforms.add(new Ce("opacity",r=>r.opacity)),e.fragment.code.add(w`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Sw||(Sw={}));const R0t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Sw},build:O0t},Symbol.toStringTag,{value:"Module"}));let P0t=class extends UOe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Zs}},aRe=class lRe extends Tr{initializeProgram(e){return new vr(e.rctx,lRe.shader.get().build(this.configuration),fr)}initializePipeline(){return Ot({blending:Cc(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};aRe.shader=new _r(R0t,()=>ce(()=>import("./BlendLayers.glsl-79ff1735.js"),[]));let cRe=class extends AO{constructor(){super(...arguments),this.background=Sw.BelowLayer}};h([U()],cRe.prototype,"background",void 0);let kz=class{constructor(e,r,i,n,s,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=$t(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Se(n,s,o)}destroy(){this.texture.release()}};function M0t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function $0t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function I0t(t,e,r,i,n,s,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t}function uRe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=r*s-i*n;return l?(l=1/l,t[0]=s*l,t[1]=-i*l,t[2]=-n*l,t[3]=r*l,t[4]=(n*a-s*o)*l,t[5]=(i*o-r*a)*l,t):null}function L0t(t){return t[0]*t[3]-t[1]*t[2]}function hRe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],d=r[2],p=r[3],m=r[4],y=r[5];return t[0]=i*c+s*u,t[1]=n*c+o*u,t[2]=i*d+s*p,t[3]=n*d+o*p,t[4]=i*m+s*y+a,t[5]=n*m+o*y+l,t}function wK(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+s*c,t[1]=n*u+o*c,t[2]=i*-c+s*u,t[3]=n*-c+o*u,t[4]=a,t[5]=l,t}function dRe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i*c,t[1]=n*c,t[2]=s*u,t[3]=o*u,t[4]=a,t[5]=l,t}function xK(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=i*c+s*u+a,t[5]=n*c+o*u+l,t}function D0t(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function N0t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function TK(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function F0t(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function U0t(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function k0t(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function pRe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function z0t(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function B0t(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function V0t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function G0t(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],d=e[3],p=e[4],m=e[5],y=tl();return Math.abs(r-l)<=y*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=y*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-d)<=y*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-p)<=y*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-m)<=y*Math.max(1,Math.abs(a),Math.abs(m))}const j0t=hRe,H0t=pRe;Object.freeze(Object.defineProperty({__proto__:null,add:k0t,copy:M0t,determinant:L0t,equals:G0t,exactEquals:V0t,frob:U0t,fromRotation:D0t,fromScaling:N0t,fromTranslation:TK,identity:$0t,invert:uRe,mul:j0t,multiply:hRe,multiplyScalar:z0t,multiplyScalarAndAdd:B0t,rotate:wK,scale:dRe,set:I0t,str:F0t,sub:H0t,subtract:pRe,translate:xK},Symbol.toStringTag,{value:"Module"}));function fRe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function W0t(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function q0t(t,e,r,i,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function X0t(t,e){return new Float32Array(t,e,6)}function mRe(t,e,r,i){const n=e[i],s=e[i+1];t[i]=r[0]*n+r[2]*s+r[4],t[i+1]=r[1]*n+r[3]*s+r[5]}function Y0t(t,e,r,i=0,n=0,s=2){const o=n||e.length/s;for(let a=i;a<o;a++)mRe(t,e,r,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:W0t,create:fRe,createView:X0t,fromValues:q0t,transform:mRe,transformMany:Y0t},Symbol.toStringTag,{value:"Module"}));function aN(){return[1,0,0,1,0,0]}function Z0t(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Q0t(t,e,r,i,n,s){return[t,e,r,i,n,s]}function J0t(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Z0t,create:aN,createView:J0t,fromValues:Q0t},Symbol.toStringTag,{value:"Module"}));function K0t(t){return t instanceof Float32Array&&t.length>=2}function eyt(t){return Array.isArray(t)&&t.length>=2}function zz(t){return K0t(t)||eyt(t)}const tyt=96,ryt=39.37;function SK(t,e){return e.type?er(t,e.x,e.y):fs(t,e)}function iyt(t){return el(t)}function nyt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const syt=function(){const t=Ne();return function(e,r,i){const n=r.targetGeometry;SK(t,n);const s=.5*iU(r);return e.xmin=t[0]-s*i[0],e.ymin=t[1]-s*i[1],e.xmax=t[0]+s*i[0],e.ymax=t[1]+s*i[1],e.spatialReference=n.spatialReference,e}}();function iU(t){return t.scale*oyt(t.targetGeometry)}function oyt(t){return t!=null&&ua(t.spatialReference)?1/(iyt(t.spatialReference)*ryt*tyt):1}function ayt(t){return l6(t.rotation)||0}const EK=function(){const t=Ne(),e=Ne(),r=Ne();return function(i,n,s,o,a,l){return zZ(t,n),dc(e,s,.5*l),er(r,1/o*l,-1/o*l),TK(i,e),a&&wK(i,i,a),dRe(i,i,r),xK(i,i,t),i}}(),lyt=function(){const t=Ne();return function(e,r,i,n){const s=iU(r),o=ayt(r);return SK(t,r.targetGeometry),EK(e,t,i,s,o,n)}}(),cyt=function(){const t=Ne();return function(e,r,i,n){const s=iU(r);return SK(t,r.targetGeometry),EK(e,t,i,s,0,n)}}();function uyt(t){const e=Sb(t);return e?e.valid[1]-e.valid[0]:0}function hyt(t,e){return Math.round(uyt(t)/e)}var CW;const Om=[0,0];let xy=CW=class extends ke{constructor(t){super(t),this._viewpoint2D={center:Ne(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Dr,this.id=0,this.inverseTransform=aN(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=aN(),this.transformNoRotation=aN(),this.displayMat3=Pl(),this.displayViewMat3=Pl(),this.viewMat3=Pl(),this.viewMat2d=fRe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=nyt(r,t.viewpoint),this._set("size",fs(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new CW({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return zz(e)?Cv(t,e,this.inverseTransform):(Om[0]=e,Om[1]=r,Cv(t,Om,this.inverseTransform))}toScreen(t,e,r){return zz(e)?Cv(t,e,this.transform):(Om[0]=e,Om[1]=r,Cv(t,Om,this.transform))}toScreenNoRotation(t,e,r){return zz(e)?Cv(t,e,this.transformNoRotation):(Om[0]=e,Om[1]=r,Cv(t,Om,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,n=this._get("size");return EK(t,r,n,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new hp({targetGeometry:new ze(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!s||!e||!r)return;this.resolution=iU(o),this.rotation=i,this.scale=r,this.spatialReference=e,fs(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;JZ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=KZ(this.viewMat3),u=uh(s[0]/2,s[1]/2),d=uh(-s[0]/2,-s[1]/2),p=l6(i);r5(c,c,u),eQ(c,c,p),r5(c,c,d),US(this.displayViewMat3,this.displayMat3,c);const m=TK(this.viewMat2d,u);return wK(m,m,p),xK(m,m,d),syt(this.extent,o,s),lyt(this.transform,o,s,n),uRe(this.inverseTransform,this.transform),cyt(this.transformNoRotation,o,s,n),this.worldScreenWidth=hyt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};h([f({readOnly:!0})],xy.prototype,"id",void 0),h([f({value:1,json:{write:!0}})],xy.prototype,"pixelRatio",null),h([f({json:{write:!0}})],xy.prototype,"size",null),h([f()],xy.prototype,"spatialReference",void 0),h([f({type:hp,json:{write:!0}})],xy.prototype,"viewpoint",null),xy=CW=h([N("esri.views.2d.ViewState")],xy);const dyt=xy;var AW,OW,Qce,Jce,Kce,eue,tue,rue,iue,nue,sue,oue,aue,lue,cue,uue,hue,due,pue,fue,mue,gue,yue,_ue,vue,bue,wue,xue,Tue,Sue,Eue,Cue,Aue,Oue,Rue,Pue,Mue,$ue,Iue,Lue,Due,Nue,Fue,Uue,kue,zue,Bue,Vue,Gue,jue,Hue,Wue,que,Xue,Yue,Zue,Que,Jue,Kue,ehe,the;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(AW||(AW={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(OW||(OW={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Qce||(Qce={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Jce||(Jce={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Kce||(Kce={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(eue||(eue={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(tue||(tue={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(rue||(rue={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(iue||(iue={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(nue||(nue={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(sue||(sue={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(oue||(oue={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(aue||(aue={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(lue||(lue={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(cue||(cue={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(uue||(uue={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(hue||(hue={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(due||(due={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(pue||(pue={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(fue||(fue={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(mue||(mue={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(gue||(gue={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(yue||(yue={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(_ue||(_ue={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(vue||(vue={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(bue||(bue={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(wue||(wue={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(xue||(xue={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(Tue||(Tue={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(Sue||(Sue={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(Eue||(Eue={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(Cue||(Cue={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(Aue||(Aue={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(Oue||(Oue={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(Rue||(Rue={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(Pue||(Pue={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(Mue||(Mue={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}($ue||($ue={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(Iue||(Iue={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(Lue||(Lue={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(Due||(Due={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Nue||(Nue={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Fue||(Fue={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Uue||(Uue={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(kue||(kue={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(zue||(zue={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Bue||(Bue={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(Vue||(Vue={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Gue||(Gue={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(jue||(jue={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Hue||(Hue={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Wue||(Wue={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(que||(que={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Xue||(Xue={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(Yue||(Yue={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(Zue||(Zue={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(Que||(Que={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Jue||(Jue={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Kue||(Kue={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(ehe||(ehe={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(the||(the={}));var RW,ob,PW,nF,MW,sF,$W,ab,IW;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(RW||(RW={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(ob||(ob={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(PW||(PW={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(nF||(nF={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(MW||(MW={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(sF||(sF={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}($W||($W={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(ab||(ab={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(IW||(IW={}));let ld=class{};ld.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ob.VISIBLE}},ld.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ob.VISIBLE}},ld.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ob.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:AW.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:OW.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},ld.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ob.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:PW.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:sF.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:nF.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:sF.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:MW.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:nF.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:$W.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[IW.HORIZONTAL]}},ld.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:ob.VISIBLE}},ld.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},ld.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:ab.MAP}},ld.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:ab.MAP},"line-width":{type:"number",minimum:0,default:1}},ld.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:ab.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:ab.MAP}},ld.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},ld.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:ab.MAP}};const pyt=.125;let fyt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new dyt({viewpoint:new hp({targetGeometry:new ze(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,n,s,o,a,l,c,u,d){this._render(e,r,i,n,s,o,a,l,c,u,d)}renderSymbols(e,r,i,n,s,o,a,l,c,u,d){this._render(e,r,i,n,s,o,a,l,c,u,d,RW.SYMBOL)}_render(e,r,i,n,s,o,a,l,c,u,d,p){const m=r[0]-o.getLevelShift(r[0]),y=this._renderParams;y.context=e,y.painter=n,y.glyphMosaic=n.glyphMosaic,y.spriteMosaic=n.spriteMosaic,y.pixelRatio=u*d,y.displayLevel=m,y.requiredLevel=m;const _=o.getScale(r[0]),[v,b]=o.getOffset(r,a*_),x=pyt*a*_/c,T=i.transforms.dvs;T[0]=x,T[4]=-x,T[6]=-1-v-l[0]*a*2,T[7]=1+b+(1-l[1])*a*2-2,y.state.size[0]=c/d,y.state.size[1]=c/d,y.state.pixelRatio=d,i.stage||i.attachWithContext(e),i.triangleCount=0,n.drawTile(y,i,s,p)}},gRe=class yRe extends Tr{initializeProgram(e){return new vr(e.rctx,yRe.shader.get().build(this.configuration),fr)}initializePipeline(){return Ot({blending:Cc(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};gRe.shader=new _r(Igt,()=>ce(()=>import("./RasterColorizer.glsl-724b79fe.js"),[]));let dA=class extends AO{constructor(){super(...arguments),this.colorizerType=kb.Stretch,this.stretchType=Tw.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};h([U({count:kb.COUNT})],dA.prototype,"colorizerType",void 0),h([U({count:Tw.COUNT})],dA.prototype,"stretchType",void 0),h([U()],dA.prototype,"applyColormap",void 0),h([U()],dA.prototype,"requireBilinearWithNN",void 0);let rhe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new hs(this._rctx,new pr(e),new n5(jn.DEPTH_COMPONENT16,e));return this._fbos.set(e,i),i}};const myt=J.getLogger("esri.views.3d.terrain");let gyt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new fyt,this._bindParameters=new e8(null,null,null),this._blendLayersTechniqueConfig=new cRe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Dl(this._rctx,$P)}dispose(){this._fbos.forEach(Le),this._fbos=null,this._vtFBO=Le(this._vtFBO),this._vaoQuad=Le(this._vaoQuad),this._vectorTileHelper=Le(this._vectorTileHelper),this._backgroundTechnique=Fi(this._backgroundTechnique),this._applyOpacityTechnique=Fi(this._applyOpacityTechnique),this._blendLayersTechnique=Fi(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,n=Nd.Off,s=Sw.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(aRe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Ae.Normal,r?ws.ColorComposite:ws.GridComposite,Zd.NotRequired,Nd.Off,Sw.Only),n=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Et.TRIANGLE_STRIP,0,No(this._vaoQuad,"geometry"))}drawGroup(e,r,i,n,s,o=Nd.On){r===ws.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(n,r,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,n,s,o=Nd.Off){if(e.texture==null)return;e.fboTexture=r===ws.GroupBackgroundComposite||n===Ae.Normal&&s===Zd.NotRequired&&o===Nd.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(n,r,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,n,s,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,Zt.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=n===Ae.Normal&&s===Zd.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,n,s);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,c,null);this._render(u)}_getRasterColorizerTechnique(e,r,i,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new dA,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Tw.Noop:Tw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(gRe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,n,s,o,a,l,c){const u=this._rctx,d=o.sourceLayerInfo.data,p=o.tile.surface.layerViewByIndex(o.layerIndex,Zt.MAP),m=s===Zd.Required||e.opacity<1||n!==Ae.Normal||r!==ws.Composite,y=m?Nd.On:Nd.Off;this._getBlendLayersTechnique(n,r,s,y).bindPipelineState(u);let _=null,v=null;m?(v=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new rhe(this._rctx)),_=this._vtFBO.get(i),u.bindFramebuffer(_),this._clearCurrentFBO()):c&&u.clearSafe(yi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(u,o.sourceLod,d,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/o.scale),o.offset,l,a,p.contentZoom),o.vtlNeighborInfos.forAll(b=>this._vectorTileHelper.renderSymbols(u,b.sourceLod,b.sourceLayerInfo.data,p.painter,p.layer.styleRepository,p.schemaHelper,1,b.offset,l,a,p.contentZoom))}catch(b){myt.warnOnce("A render call containing vector tiles did not resolve correctly.",b)}return _==null||(u.bindFramebuffer(v),e.texture=_.colorTexture,e.offset=dp,e.scale=1,this.drawRasterData(e,r,i,n,s,y),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Ct.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;r.gl.copyTexImage2D(nn.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),r.bindTexture(i,Ct.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(yi.COLOR_BUFFER_BIT|yi.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let n=this._fbos.length;n<=r;n++)this._fbos.push(new rhe(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},yyt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new Nt({allocator:e=>e||new _yt})}},_yt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},vyt=class{constructor(e,r,i,n){this.start=e,this.end=r,this.blendMode=i,this.opacity=n}},byt=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new P0t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new gyt(this._rctx,this._techniqueRepository),this._blackTex=new L2(TWe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Le(this._composition),this._backgroundTexture=Fi(this._backgroundTexture),this._blackTex=Fi(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,n=i.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let u=!1;oF.clear(),Bx.length=0;const d=e.layerInfo[Zt.MAP];let p=d.length,m=0,y=null;for(;m<d.length;m++){const v=i.layerViewByIndex(m,Zt.MAP),b=v.layer.opacity;ihe[m]=b;const x=v.fullOpacity;if(nhe[m]=x,Z0e(v.layer)&&p>=d.length&&(p=m),K5(v)){she[m]=v.layer.blendMode;let S=v.layer.blendMode!=="normal";if(_S(v.layer.parent)){const A=LW(v.layer.parent);A!=null&&A!==""&&(S=_Re(v.layer.parent)||S)}S&&(u=S,l=!1)}if(b===0&&!u){d[m].pendingUpdates&=~(gt.TEXTURE_NOFADING&gt.TEXTURE_FADING);continue}++o;const T=Bz(e,m);if(T){if(d[m].pendingUpdates&=~(gt.TEXTURE_NOFADING&gt.TEXTURE_FADING),_S(v.layer.parent)){const S=LW(v.layer.parent);S!=null&&S!==""&&vRe(v.layer.parent,m)}VR(v)?a=Math.max(a,this.tileSize*c):n===1&&x===1&&(v.isOpaque||this._dataToTexture(T)&&T.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s,y===null&&(y=m)}}const _=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),s!==0&&y!==null?s===1&&!u&&this._useLayerTexture(e,y,p,nhe[y])||this._composeMapLayers(e,r,m-1,p,ihe,she,a,_,!l||u,oF,u):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=dp,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=Ag.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=Ag.Delayed);const n=e.renderData;this._backgroundTexture&&n.textureReference==null&&(i=Ag.Immediate),n.setTextureReference(this._backgroundTexture!=null?new kz(this._backgroundTexture,ns.FADING,ohe,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,n){const s=r<i,o=s?1:e.surface.baseOpacity,a=s?e.surface.baseOpacity:1,l=Bz(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new kz(l.sourceLayerInfo.data,ns.FADING,l,o,a,n)),!0)}_composeMapLayers(e,r,i,n,s,o,a,l,c,u,d){this._composition.ensureBuffer(a);const p=e.surface.baseOpacity;let m=!1,y=At.LINEAR_MIPMAP_LINEAR,_=!1,v=0;for(let T=i;T>=0;T--){const S=Bz(e,T);if(!S||s[T]===0&&!d)continue;const A=T<n&&p<1&&!m;this._passParameters.baseOpacity=A?p:1;const C=this._passParameters.baseOpacity<1?Zd.Required:Zd.NotRequired;A&&(m=!0);let R=!1;u.forEach(V=>{V.start===T&&(Bx.push(V),this._composition.openGroup(a),R=!0)});const P=v===0,F=R?ws.GroupBackgroundComposite:c&&P?this.backgroundIsGrid?ws.GridComposite:ws.ColorComposite:ws.Composite,k=TW[o[T]];for(wOe(S)?(this._passParameters.opacity=s[T],_=this._composition.drawVectorData(this._passParameters,F,a,k,C,S,l,this.tileSize,_)):rmt(S)?(this._passParameters.opacity=s[T],this._composition.drawImageryTileData(this._passParameters,F,a,k,C,S),this._hasNearestInterpolation(S)&&(y=At.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=s[T],this._composition.drawRasterData(this._passParameters,F,a,k,C));Bx.length>0&&Bx[Bx.length-1].end===T;){const V=Bx.pop();this._passParameters.opacity=V.opacity,this._passParameters.offset=dp,this._passParameters.scale=1;const z=c&&P?this.backgroundIsGrid?ws.GridComposite:ws.ColorComposite:ws.Composite;this._composition.drawGroup(this._passParameters,z,a,TW[V.blendMode],C)}v++}const b=e.renderData,x=b.ensureTexture(a,()=>this._buildTexture(a,y));this._composition.copyFBOToTexture(x),this._composition.unbind(),b.setTextureReference(new kz(x,r,ohe,m?1:p,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(nmt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return imt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=At.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const i=new pr;i.wrapMode=Pt.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const n=this._rctx;let s;if(typeof e=="number")i.width=i.height=e,s=new L2(new Ct(n,i));else if(e instanceof Q8)i.isOpaque=e.isOpaque,s=new L2(new Ct(n,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,s=new L2(new Ct(n,i,e))}catch{s=new L2(gxe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=n.bindTexture(s.texture,Ct.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),n.bindTexture(o,Ct.TEXTURE_UNIT_FOR_UPDATES),s}get test(){return{backgroundTexture:this._backgroundTexture}}};function Bz(t,e){Aa.layerIndex=e,Aa.vtlNeighborInfos.clear();const r=t.layerInfo[Zt.MAP][e];if(r.data)return er(Aa.offset,0,0),Aa.tile=t,Aa.scale=1,Aa.sourceLod=t.lij,Aa.sourceLayerInfo=r,wOe(Aa)&&t.forEachLoadedNeighbor((n,s)=>{if(n.level!==t.level)return;const o=n.layerInfo[Zt.MAP][e];if(!xOe(o)||r.data===o.data)return;const a=Aa.vtlNeighborInfos.pushNew();a.offset=Wm[s],a.sourceLod=n.lij,a.sourceLayerInfo=o}),Aa;const i=r.upsampleInfo;if(i){const n=i.tile.layerInfo[Zt.MAP][e];return Aa.tile=i.tile,fs(Aa.offset,i.offset),Aa.scale=i.scale,Aa.sourceLod=i.tile.lij,Aa.sourceLayerInfo=n,Aa}return null}function LW(t){return t.get("uid")}function _Re(t){let e=t.blendMode!=="normal";return _S(t.parent)&&(e=_Re(t.parent)||e),e}function vRe(t,e){_S(t.parent)&&vRe(t.parent,e);const r=LW(t);if(r!=null&&r!==""){const i=oF.get(r);i?i.start=e:oF.set(r,new vyt(e,e,t.blendMode,t.opacity))}}const ihe=new Array,nhe=new Array,she=new Array,oF=new Map,Bx=new Array,Aa=new yyt,ohe={offset:[0,0],scale:1},Wm=new Array;Wm[tt.NORTH]=[0,-1],Wm[tt.NORTH_EAST]=[-1,-1],Wm[tt.EAST]=[-1,0],Wm[tt.SOUTH_EAST]=[-1,1],Wm[tt.SOUTH]=[0,1],Wm[tt.SOUTH_WEST]=[1,1],Wm[tt.WEST]=[1,0],Wm[tt.NORTH_WEST]=[1,-1];const bRe=200,Vz=40,wyt=.8,xyt=10,pA=1e-6;function Tyt(t,e,r){const i=e,n=r;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(n[a]<=pA)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-pA){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(i[a]>l){if(n[a]>=-pA)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]>=pA){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let ahe=class{constructor(e,r,i,n,s){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=n,this.rightStartIndex=s}},CK=class DW{constructor(e,r,i,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=n,this._rayDirection=O(),this.bspNodeTree=new Array;const s=i-r,o=s<=wRe?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=Oyt(e,r,i,n.data,n.stride),l=ge(Math.log2(s/Vz),2,xyt),c=(u,d,p)=>{const m=Cyt(o,a,u,d),y=d-u;if(y<=Vz){const S=new ahe(m,void 0,0,u,d);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=Ayt(m),b=Eyt(o,a,u,d,_,v),x=(S,A)=>{if(p>l)return;const C=A-S;return C<Vz||C>=wyt*y?void 0:c(S,A,p+1)},T=new ahe(m,_,v,b.next,b.mid);return this.bspNodeTree.push(T),T.leftNode=x(u,b.next),T.rightNode=x(b.mid,d),T};c(0,s,0),this.triangleVertexIndices=Ryt(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,n=this.positionAttribute.data,s=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,d=u[0],p=u[1],m=u[2];for(let y=e,_=3*e;y<r;++y){let v=i[_++]*s;const b=n[v++],x=n[v++],T=n[v];v=i[_++]*s;const S=n[v++],A=n[v++],C=n[v];v=i[_++]*s;const R=S-b,P=A-x,F=C-T,k=n[v++]-b,V=n[v++]-x,z=n[v]-T,X=p*z-V*m,q=m*k-z*d,G=d*V-k*p,Q=R*X+P*q+F*G;if(Math.abs(Q)<=Number.EPSILON)continue;const M=a-b,I=l-x,L=c-T,B=M*X+I*q+L*G;if(Q>0){if(B<0||B>Q)continue}else if(B>0||B<Q)continue;const H=I*F-P*L,Z=L*R-F*M,K=M*P-R*I,de=d*H+p*Z+m*K;if(Q>0){if(de<0||B+de>Q)continue}else if(de>0||B+de<Q)continue;const Re=(k*H+V*Z+z*K)/Q;if(Re>=0){const Ke=this.indices[y]+this.firstTriangleIndex,_t=ZQ(R,P,F,k,V,z,Syt);this._callback(Re,_t,Ke,!1)}}}DW.numFacesTested+=r-e}intersectRay(e,r){DW.numFacesTested=0;const i=Se(e.r0[0],e.r0[1],e.r0[2]),n=Se(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-i[0],o=n[1]-i[1],a=n[2]-i[2];if(s*s+o*o+a*a<pA)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=s,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(e,r,i){const n=this._rayOrigin,s=this._rayDirection;if(!Tyt(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=r,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};CK.numFacesTested=0;const Syt=O(),Vx=[1/0,1/0,1/0],Gx=[-1/0,-1/0,-1/0];function Eyt(t,e,r,i,n,s){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function Cyt(t,e,r,i){if(i<=r)return iw(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[r];for(let s=0;s<3;++s)Vx[s]=e[n+0+s],Gx[s]=e[n+3+s]}for(let n=r+1;n<i;++n){const s=6*t[n];for(let o=0;o<3;++o)Vx[o]=Math.min(Vx[o],e[s+0+o]),Gx[o]=Math.max(Gx[o],e[s+3+o])}return iw(Vx[0],Vx[1],Vx[2],Gx[0],Gx[1],Gx[2])}function Ayt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],n=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function Oyt(t,e,r,i,n){const s=r-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l]*n,u=t[l+1]*n,d=t[l+2]*n;for(let p=0;p<3;++p){const m=i[c+p],y=i[u+p],_=i[d+p];o[6*a+p]=Math.min(m,y,_),o[6*a+3+p]=Math.max(m,y,_)}}return o}function Ryt(t,e,r,i){const n=i-r;let s=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=wRe?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const wRe=65535;let Ln=class extends Fo{constructor(){super(...arguments),this.output=D.Color,this.overlayMode=Rg.Disabled,this.tileBlendInput=Pf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=et.Terrain}};h([U({count:D.COUNT})],Ln.prototype,"output",void 0),h([U({count:Rg.COUNT})],Ln.prototype,"overlayMode",void 0),h([U({count:Pf.COUNT})],Ln.prototype,"tileBlendInput",void 0),h([U()],Ln.prototype,"spherical",void 0),h([U()],Ln.prototype,"doublePrecisionRequiresObfuscation",void 0),h([U()],Ln.prototype,"receiveShadows",void 0),h([U()],Ln.prototype,"hasSlicePlane",void 0),h([U()],Ln.prototype,"backfaceCullingEnabled",void 0),h([U()],Ln.prototype,"textureFadingEnabled",void 0),h([U()],Ln.prototype,"renderOccluded",void 0),h([U()],Ln.prototype,"hasScreenSpaceReflections",void 0),h([U()],Ln.prototype,"hasCloudsReflections",void 0),h([U()],Ln.prototype,"invisible",void 0),h([U()],Ln.prototype,"tileBorders",void 0),h([U()],Ln.prototype,"visualizeNormals",void 0),h([U()],Ln.prototype,"screenSizePerspective",void 0),h([U()],Ln.prototype,"receiveAmbientOcclusion",void 0),h([U({count:et.COUNT})],Ln.prototype,"pbrMode",void 0),h([U({constValue:br.Compressed})],Ln.prototype,"normalType",void 0),h([U({constValue:Pn.Compressed})],Ln.prototype,"textureCoordinateType",void 0),h([U({constValue:!1})],Ln.prototype,"highStepCount",void 0),h([U({constValue:!1})],Ln.prototype,"useCustomDTRExponentForWater",void 0),h([U({constValue:!1})],Ln.prototype,"useFillLights",void 0);const Gz=7,Pyt=10,jz=ps();var _s;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(_s||(_s={}));let Xl=class extends xe{get _isGlobal(){return this._stage.viewingMode===$e.Global}constructor(e){super(e),this.type=Ui.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ln,this._passParameters=new VOe,this._rctx=null,this._renderDataPool=new ko(l0t),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new IOe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=_s.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Ri.Occlude}initialize(){const e=[le.OPAQUE_TERRAIN,le.TRANSPARENT_TERRAIN,le.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),agt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===_s.TransparentWithDraped||e===_s.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return jy}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?B5:Ri.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,gt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===gt.TEXTURE_FADING?ns.FADING:ns.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[Zt.ELEVATION])i.pendingUpdates&=~gt.GEOMETRY;e.resetPendingUpdate(gt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=Pyt-Gz,i=Math.max(0,Math.floor((e.level-r)/Gz)*Gz);if(this._isGlobal&&i===0)return Zs;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=dn.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=dn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=dn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new byt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=gxe(this._rctx)}uninitializeRenderContext(){this._emptyTex=Le(this._emptyTex),this._tileRenderer=Le(this._tileRenderer)}intersect(e,r,i,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==_s.Opaque)return;const s=Myt,o=$yt;ae(s,n,i),ne(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===To.MIN,d=!!e.results.ground.target,p=DZe(e.verticalOffset),m=e.tolerance;let y,_=u&&a.dist!=null?a.dist:1/0;const v=x=>{const T=x.renderData;if(!(T!=null&&T.vao))return;const S=T.geometry;x6(jz,S.boundingBox);const A=T.localOrigin;p!=null&&(p.localOrigin=A,p.applyToAabb(jz));const C=jz;if(jx[0]=i[0]-A[0],jx[1]=i[1]-A[1],jx[2]=i[2]-A[2],!JQ(C,jx,o,m,_))return;const R=(G,Q,M)=>{G.set(this.type,x,Q,M,yn),_=u&&a.dist!=null?a.dist:1/0},P=(G,Q)=>{if(Q!=null&&G>=0&&(e.options.backfacesTerrain||fe(Q,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,n,G))){if((c.dist==null||G<c.dist)&&R(c,G,Q),e.options.isFiltered)return;e.options.store===To.ALL&&(y==null?(y=SQ(e.ray),R(y,G,Q),e.results.all.push(y)):G<y.dist&&R(y,G,Q)),(a.dist==null||G<a.dist)&&R(a,G,Q),e.options.store!==To.MIN&&(l.dist==null||G>l.dist)&&R(l,G,Q)}},F=Iyt;ae(F,n,A);const k=S.indices,V=S.vertexAttributes,z=V.getField(E.POSITION,ds),X=new Ue(z.typedBuffer,3,!1,V.stride/4),q=S.indexCount/3;if(!p&&q>bRe){const G=x.renderData;G.intersectionData==null&&(G.intersectionData=new CK(k,0,q,X)),G.intersectionData.intersectRay({r0:jx,r1:F},P)}else BP(jx,F,0,q,k,X,null,p,P)},b=this._rootTiles;b!=null&&(()=>{const x=this._tileIterator;x.reset(b);const T=e.options.invisibleTerrain;for(let S=x.next();S;S=x.next())!(S.visible||T&&S.intersectsClippingArea)||p==null&&!S.intersectsRay(i,s,m,_)||d&&this._useStencilForTile(S)?x.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const n of this._patchGroups.values())for(const s of n)((i=s.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===le.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&B5))return null}else{const r=this.transparency===_s.Opaque?le.OPAQUE_TERRAIN:le.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case D.Color:return this.transparency===_s.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?Rg.Disabled:this._overlayRenderer.hasWater?Rg.EnabledWithWater:Rg.Enabled,this._updateTechnique(D.Color,e.bindParameters.slot===le.OCCLUDED_TERRAIN));case D.Shadow:case D.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(D.Shadow,!1)):null;case D.Depth:return this.transparency===_s.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(D.Depth,!1));case D.Normal:return this.transparency===_s.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(D.Normal,!1));case D.ObjectAndLayerIdColor:return this.transparency===_s.Empty?null:this._updateTechnique(D.ObjectAndLayerIdColor,!1);case D.Highlight:return this.transparency!==_s.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(D.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case D.Color:{const n=e.bindParameters.slot===le.OCCLUDED_TERRAIN?za.Occluded:za.ColorAndWater;this.transparency===_s.Opaque?this._renderMaterialPass(e,r,n):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,n),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case D.Depth:case D.Normal:this._renderAuxiliaryPass(e,r,za.ColorAndWater);break;case D.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,za.Highlight);break;case D.Shadow:case D.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,za.None);break;case D.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,za.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:n}=e;this._passParameters.overlaySource=i,n.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const n=e.rctx;this._passParameters.overlaySource=i,n.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i=null;if(e!=null){const n=it.toUnitRGBA(e);i=Se(n[0]||0,n[1]||0,n[2]||0)}r.setBackground(i),this._allTiles.forAll(n=>r.updateTileTexture(n,ns.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?Pf.GridComposite:r.backgroundColor!=null?Pf.ColorComposite:Pf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==tE.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)LOe(this.renderOrder,i,r);e.sort((i,n)=>DOe(i[0],n[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),n=i.renderData;if(!n){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const s=n.localOrigin;let o=this._patchGroups.get(s);o||(o=new Array,this._patchGroups.set(s,o)),o.push(i),(!this._highestVisibleLODTile||i.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const n=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const o=s[0].renderData.localOrigin;r.program.bindDraw(new eW(o),e.bindParameters,this._passParameters);for(let a=0;a<s.length;a++)this._renderPatch(e,r,s[a],Et.TRIANGLES,n,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const n=e.bindParameters.camera,s=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const d=ZTe(this._stage.viewingMode,this._ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;d.update({distance:p,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===za.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",Zs),s.setUniform4fv("texOffsetAndScale",Nf));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:Zs;this._techniqueConfiguration.tileBlendInput===Pf.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?Et.LINES:Et.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const u=this._patchGroups;for(const d of u.values()){const p=d[0].renderData.localOrigin;r.program.bindDraw(new eW(p),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of d){const y=m.renderData,_=y.textureReference;if(_!=null){if(!a){s.setUniform4fv("texOffsetAndScale",_.offsetAndScale),s.bindTexture("tex",_.texture.texture);const v=y.textureFadeFactor,b=v<1?y.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&b!=null&&v<1?(s.setUniform1f("fadeFactor",v),s.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),s.setUniform3fv("nextTexOpacities",b.opacities),s.bindTexture("texNext",b.texture.texture)):s.setUniform1f("fadeFactor",1),y.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",_.opacities)}this._renderPatch(e,r,m,c,o,i),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,n,s,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(cs&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const u=r.program;o===za.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),s&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const d=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,d,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(GOe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};h([f({constructOnly:!0})],Xl.prototype,"_overlayRenderer",void 0),h([f({constructOnly:!0})],Xl.prototype,"_stage",void 0),h([f({readOnly:!0})],Xl.prototype,"_isGlobal",null),h([f({constructOnly:!0})],Xl.prototype,"_allTiles",void 0),h([f({constructOnly:!0})],Xl.prototype,"_ellipsoidRadius",void 0),h([f({value:!1})],Xl.prototype,"renderingDisabled",null),h([f()],Xl.prototype,"renderPatchBorders",null),h([f()],Xl.prototype,"visualizeNormals",null),h([f()],Xl.prototype,"cullBackFaces",null),h([f({value:tE.FRONT_TO_BACK})],Xl.prototype,"renderOrder",null),h([f()],Xl.prototype,"wireframe",null),Xl=h([N("esri.views.3d.terrain.TerrainRenderer")],Xl);const Myt=O(),$yt=O(),jx=O(),Iyt=O();let Lyt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},cf=class extends xe{constructor(e){super(e),this._handles=new Vi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ue(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Me(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!jA(r)||r.isRejected())&&!(r.isFulfilled()&&!Dyt(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||J5(r)))),e)if(e.isResolved()){const r=K8(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new hc(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===$e.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=hc.makeWebMercatorAuxiliarySphere(r):G_(e.spatialReference)&&(e=hc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ue(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===$e.Global){const e=this.extentHelper.viewSpatialReference,r=G_(e)||nm(e)||sm(e);e.isWebMercator?this.tilingScheme=hc.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=hc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Cb(e,this.extent)||(this.tilingScheme=hc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Dyt(t,e,r){return K8(t,e,r)!=null}h([f()],cf.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],cf.prototype,"extent",void 0),h([f({value:!1})],cf.prototype,"tilingSchemeLocked",void 0),h([f({constructOnly:!0})],cf.prototype,"viewSpatialReference",void 0),h([f({constructOnly:!0})],cf.prototype,"layers",void 0),h([f({constructOnly:!0})],cf.prototype,"extentHelper",void 0),h([f({constructOnly:!0})],cf.prototype,"viewingMode",void 0),cf=h([N("esri.views.3d.terrain.TilingSchemeLogic")],cf);let Nyt=class{constructor(){this.offset=Ne(),this.scale=0,this.tile=null}init(e,r,i,n){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},Gt=class extends Bn.EventedMixin(xe){constructor(e){var r,i;super(e),this._scaleRangeQueries=new oN,this._iteratorPool=new ko(IOe,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new dgt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new Lyt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=O(),this._eyePosSurfaceSR=O(),this._splitLimits=new xd,this._frustum=TR(),this._viewProjectionMatrix=_e(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Vi,this._watchUpdatingTracking=new Df,this._frameTask=LS,this._allTiles=new Nt,this._upsampleInfoPool=new ko(Nyt),this._rootTilesExtent=jt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=St.WebMercator,this.visibleElevationBounds=new bT(1/0,-1/0),this.rootTileElevationBounds=new bT(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Ia({...e,surface:this}),this._isGlobal=!((i=(r=e.view)==null?void 0:r.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=Fmt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new ko(S0t):new ko(C0t);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",o=>o.unloadMapData()),this._elevationQueryCache=new Dmt(e.newCache("elevation-query")),this._handles.add([ue(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),ue(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),ue(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new Xl({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Mr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ue(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?ns.UNFADED:ns.IMMEDIATE)},An),ue(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?ns.UNFADED:ns.IMMEDIATE),An),ue(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},Br),ue(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},An),ue(()=>this.snapLevel,()=>this._viewChanged=!0,Br),ue(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),ue(()=>Kr.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?ce(()=>import("./TerrainTileTree3DDebugger-33a28731.js"),["assets/TerrainTileTree3DDebugger-33a28731.js","assets/TileTreeDebugger-142b9f39.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&Kr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Me(this._treeDebugger))},Pr)]);const{spatialReference:r}=this.view;this._extentHelper=Kmt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new sR({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),n=new cf({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",n),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Cf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Cf.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(dt.TERRAIN_SURFACE,this),this._handles.add([ue(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),Pr),ue(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Br),ue(()=>this.extent,()=>this._updateRootTiles(),Pr),this.view.on("resize",()=>this._viewChangeUpdate()),ue(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),An),ue(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,Pr),ue(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?et.Terrain:et.Disabled,Pr),ue(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Br)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Fi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Me(this._upsampleMapCache),this._elevationQueryCache=Me(this._elevationQueryCache),this._set("tilingSchemeLogic",Me(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Me(this.overlayManager)),this._tilePool=Me(this._tilePool),mK.prune(),this._treeDebugger=Me(this._treeDebugger),this._renderer=Me(this._renderer),this._iteratorPool=Me(this._iteratorPool),this._set("view",null),this._extentHelper=Me(this._extentHelper),this._upsampleInfoPool=Me(this._upsampleInfoPool),Xmt(),Bgt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,r;if(this.lodSnapping===cO.ON){const i=this.view,n=this.tilingScheme,s=(r=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:r.scale;if(n&&s){const o=i.state.contentCamera;let a=_8(i,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=n.levelAtScale(s)-l,u=Math.min(c,this._splitLimits.maxLod||1/0);return u<=0?null:u}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?cO.ON:cO.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(r==null||e==null)return null;const i=jt(),n=uOe(r,i,e)?i:null,s=this._get("extent");return Cb(n,s)?s:n}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=i7(this.groundExtent,this._userClippingExtent,jt()),r=this._get("extent");return Cb(e,r)?r:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){var e,r;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(e=this._watchUpdatingTracking)!=null&&e.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(r=this.overlayManager)!=null&&r.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var e,r,i;return((i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity)??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}get wireframe(){var e;return(e=this._renderer)==null?void 0:e.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===_s.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,n){this._renderer.intersect(e,r,i,n)}getElevation(e,r,i,n){const s=this._rootTiles;if(s==null||!s.length||s[0].layerInfo[Zt.ELEVATION].length===0)return null;const o=ul;return o[0]=e,o[1]=r,o[2]=i,Cs(o,n,o,this._spatialReference)?che(s,o[0],o[1]):(J.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const n=this._rootTiles,s=n?n[0].layerInfo[Zt.ELEVATION].length:0;if(n!=null&&n.length&&s!==0)for(let o=0;o<r;++o){const a=3*o;i(o,che(n,e[a],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!Bi(e,ul,this.spatialReference))return J.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(r!=null){for(const i of r)if(i!=null&&i.containsPoint(ul)){let n=i;for(;n.children[0]&&!n.rendered;){const s=n.children[0].extent;let o=0;ul[0]>s[2]&&(o+=1),ul[1]<s[1]&&(o+=2),n=n.children[o]}return this._getLodBiasCorrectedScale(n.level)}}return 1/0}getSphereElevationBounds(e,r){var a;if(ul[0]=e[0],ul[1]=e[1],ul[2]=e[2],ul[3]=e[3],!Cs(ul,r,ul,(a=this.tilingScheme)==null?void 0:a.spatialReference))return J.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,n=-1/0;const s=l=>{if(l&&ure(l.extent,ul))if(l.isLeaf||l.rendered)i=Math.min(i,l.elevationBounds[0]),n=Math.max(n,l.elevationBounds[1]);else for(const c of l.children)s(c)},o=this._rootTiles;if(o!=null)for(const l of o)s(l);return{min:i,max:n}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!Bi(e,ul,this.spatialReference))return J.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;ul[3]=r;let i=null;const n=o=>{if(o&&ure(o.extent,ul)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)n(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},s=this._rootTiles;if(s!=null)for(const o of s)n(o);return i}queryVisibleScaleRange(e,r,i,n){const s=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+a,o+a,n)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,n=this._allSurfaceLayersTransparent()?r?_s.Empty:_s.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?_s.Opaque:_s.Semitransparent,s=i!==n;return s&&(this._renderer.transparency=n,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var i,n,s;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;_f(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((n=(i=this.view)==null?void 0:i.state)!=null&&n.isLocal),this.tilingScheme&&this._removeAllTiles();const r=(e==null?void 0:e.spatialReference)??St.WebMercator;this._spatialReference=r,this._isWebMercator=!!(r!=null&&r.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&HX((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,n){const s=this._tilePool.acquire();return JI[0]=e,JI[1]=r,JI[2]=i,s.init(JI,n,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=kyt;let n=r.rootTilesInExtent(e,i,5*aT);if(this._rootTiles!=null){if(n.length>aT)return void J.getLogger(this).warn(YGe);const s=this._rootTiles.map(a=>a.lij),o=aDe(s,n,lhe);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>lhe(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,n.length>aT&&(J.getLogger(this).warn(ZGe),n=r.rootTilesInExtent(e,i,aT)),this._setRootTiles(n.map(s=>this._newRootTile(s)));Cb(i,this._rootTilesExtent)||(this._rootTilesExtent=jt(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Og);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===gt.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(gt.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(gt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const r=vgt(e),i=this.visibleElevationBounds;let n=r?i.min:1/0,s=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(gt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(gt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(n=Math.min(c.elevationBounds[0],n),s=Math.max(c.elevationBounds[1],s))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(n)&&isFinite(s)&&(i.min!==n||i.max!==s)&&(this.visibleElevationBounds=new bT(n,s))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),r=Math.max(r,s[1])});const n=this.rootTileElevationBounds;n.min===e&&n.max===r||(this.rootTileElevationBounds=new bT(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),n=Math.tan(.5*r.fovY),s=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=n,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=TR()),s5(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,s5(this._frustum,e.frustum),Vr(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),re(this._eyePosRenderSR,r.eye),Cs(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(xRe(e)?this._loadChildren(e):Uyt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(gt.TEXTURE_FADING)?gt.TEXTURE_FADING:!!e.resetPendingUpdate(gt.TEXTURE_NOFADING)&&gt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=Wz.extent;Ih(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>S_(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),Wz.spatialReference=this.spatialReference,this.emit("elevation-change",Wz)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,n=this._splitLimits,s=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(n,s,i);if(a!==gt.SPLIT){if(o.resetPendingUpdate(gt.SPLIT)&&o.updateAgentSuspension(),a===gt.ELEVATION&&o.updateAgents(Zt.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(gt.MERGE),o.resetPendingUpdate(gt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let u=l.next();!l.done;u=l.next())this._updateClippingStatus(u),u.updateVisibility(),u.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(gt.MERGE),o.isLeaf&&(o.setPendingUpdate(gt.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(gt.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(ygt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){be(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),i=(s,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<s.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(Og);const n=r.length;for(let s=0;s<n;++s){const o=r[s];be(o.isLoaded),be(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,u=d=>{var m;const p=jR[d];i(o,(m=c[d])==null?void 0:m.findCorner(eF(p),y=>y.isLoaded))};for(let d=0;d<4;++d)if(l&1<<d){const p=a.geometryState.neighborData.edgePeerNeighbors[d];p&&(p==null?void 0:p.level)>=o.level&&p.forAllSubtreeOnSide(tF(Rf[d]),m=>!(!m.isLoaded||!m.intersectsClippingArea)&&(be(e.has(m)||Og(o,m)<0),i(o,m),!0)),u((d+1)%4),u(d)}}e.clear(),this._updateTilesGeometries(r),cs&&Q5&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const n=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let o=!1;const a=!this._allTiles.some(l=>{var u;if(!i&&!n&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(gt.MERGE)){if(!r)return l.setPendingUpdate(gt.MERGE),e.done;for(;(u=c.parent)!=null&&u.resetPendingUpdate(gt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(gt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(gt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(gt.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(dn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*qGe}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=ge(e-this._lodBias,0,r.length-1),n=i-Math.floor(i);return r[Math.floor(i)].scale*(1-n)+r[Math.ceil(i)].scale*n}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){_f(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],n=2*e.lij[2];e.setChildren(this._createTile(r,i,n,e),this._createTile(r,i,n+1,e),this._createTile(r,i+1,n,e),this._createTile(r,i+1,n+1,e)),e.setPendingUpdate(gt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){KI.spatialReference=this.spatialReference,KI.extent=e.extent,KI.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",KI)}_createTile(e,r,i,n){_f(!!n,"_createTile sanity check");const s=this._acquireTile(e,r,i,n);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(gt.SPLIT),s}get shortBatches(){return this.view.state.mode!==Cr.IDLE}_mergeTile(e){_f(!e.hasPendingUpdate(gt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(_f(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){_f(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const n=r[i];this._unloadChildren(n),this._unloadTile(n)}}_loadTile(e){e.load(),e.setPendingUpdate(gt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const n=new Qmt(e.lij,e.extent,i);e.dataArrived(r,Zt.ELEVATION,n);const s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=Wa){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let n=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),GR(s)||BC(s))if(this._basemapLayerViewHandles.has(s.uid)&&!BC(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);a!=null&&((a<n||n==null)&&(r=!0),n=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((s,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var r,i;let e=((i=(r=this.view.map)==null?void 0:r.ground)==null?void 0:i.opacity)===0;for(const n of this.view.allLayerViews.items)if(_W(n)&&!Z0e(n.layer)&&n.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((K5(e)||BC(e))&&Egt(TW[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return yW(e)?Zt.ELEVATION:Zt.MAP}_registerTiledLayerView(e){const r=[];if((K5(e)||BC(e))&&r.push(ue(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(ns.UNFADED)})),!BC(e)){const i=this._layerClassFromLayerView(e);r.push(ue(()=>e.suspended,()=>this._updateTiledLayers())),r.push(ue(()=>e.fullOpacity,()=>this._updateTileTextures(ns.UNFADED))),r.push(ue(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),r.push(e.on("data-changed",()=>{const n=this._getLayerIdxByUID(i,e.uid);n!=null&&this._invalidateLayerData(n,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(const i of r)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(n=>{if(!n.layer||n.suspended||!GR(n)||!n.fullExtent)return;const s=this._layerClassFromLayerView(n);if(s===Zt.MAP){const o=n.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[s].push(n)});for(const n of Uv){const s=this._layerViews[n],o=r[n];o.reverse();const a=o.length;let l=s.length!==a;const c=new Array(a),u=new Array(s.length);this._layerIndexByUid[n].clear();for(let d=0;d<a;d++){const p=o[d].uid;this._layerIndexByUid[n].set(p,d);const m=s.indexOf(o[d]);c[d]=m,d!==m&&(l=!0),m>-1&&(u[m]=d)}if(l){const d=this._postorderIterator;for(d.reset(this._rootTiles);!d.done;)d.next().modifyLayers(u,c,n);this._layerViews[n]=o,this._restartAllAgents(n),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===Zt.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(Zt.MAP),e===ns.IMMEDIATE?this.renderer.updateTileTexture(r,gt.TEXTURE_NOFADING):r.updateRenderData(Zt.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=dn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,n){const s=this.layerViewByIndex(r,i),o=s.layer;return!o.tilemapCache||VR(s)?this._requestTileData(e,i,s,n):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...n,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Bt(n),Zn(a)||this._dataMissing(e,i,s,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,n),n.signal)))}_requestTileData(e,r,i,n){return r===Zt.ELEVATION?yW(i)?this._requestElevationTileData(e,i,n):Promise.reject():_W(i)?this._requestMapTileData(e,i,n):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const n=a=>{if(ss(i))return;const l=this._layerIndexByUid[Zt.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):J.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Zt.ELEVATION,e.lij.toString())},s=a=>{Zn(a)||(this._dataMissing(e,Zt.ELEVATION,r,a),this.requestUpdate())};if(Tce(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:yR,signal:i.signal}).then(a=>{if(!ss(i))return this._frameTask.schedule(()=>n(a),i.signal,s);J.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:yR},i.signal)).then(a=>{a?n(new Nmt(a)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const n=(u,d)=>{--this._asyncWorkItems,YT(d),ss(i)||(this._dataMissing(e,Zt.MAP,r,u),this.requestUpdate())},s=u=>d=>n(d,u),o=u=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),ss(i)?YT(u):this._mapTileDataArrived(e,r,u)},i.signal,s(u)).catch(s(u)),a=(u,d=null)=>this._frameTask.schedule(()=>n(u,d));if(VR(r)){const u=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(u[0],u[1],u[2],i).then(o,a)}if(J8(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(uK(r)&&Tce(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(u=>{if(ss(i))return J.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(wr());o(u)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Lmt(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const n=this._getLayerIdxByUID(Zt.MAP,r.uid);n!=null?e.dataArrived(n,Zt.MAP,i):(YT(i),J.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,n){const s=this._getLayerIdxByUID(r,i.uid);s!=null?e.dataMissing(s,r,n):J.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=this.overlayManager.gpuMemoryUsage;const i=this._layerClassFromLayerView(e),n=this._getLayerIdxByUID(i,e.uid);return n!=null&&this._allTiles.forAll(s=>r+=s.getUsedMemoryForLayer(i,n)),r}getTile(e){if(e==null||this._rootTiles==null)return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],n=Math.floor(r[1]/i),s=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===n&&a.lij[2]===s&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return _f(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){Hz.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&Hz.push(i)});const r=Hz.toArray();return LOe(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!Q5)return;const e=this._rootTiles;if(e==null)return;const r=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometry)==null?void 0:l.indices)==null?void 0:c.length)>0},i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},n=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometry)||(((l=o.renderData.geometry.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),r(o)){o.checkGeometryWaterproofness();for(const c of o.children)i(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)n(c)},s=o=>{var u;const a=((u=o.parent)==null?void 0:u.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const d of o.children)s(d)};for(const o of e)n(o),s(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const n=(i+(i<0?r:0))%r;return[e[0],e[1],n]}enableInternalChecks(e){tmt(e)}enableWaterproofnessChecks(e){emt(e)}};h([f()],Gt.prototype,"_renderer",void 0),h([f({constructOnly:!0})],Gt.prototype,"_scaleRangeQueries",void 0),h([f({constructOnly:!0})],Gt.prototype,"view",void 0),h([f({constructOnly:!0})],Gt.prototype,"overlayManager",void 0),h([f()],Gt.prototype,"_hasPendingUpdates",void 0),h([f()],Gt.prototype,"_asyncWorkItems",void 0),h([f()],Gt.prototype,"_allTilesDirty",void 0),h([f()],Gt.prototype,"_allTilesSorted",void 0),h([f()],Gt.prototype,"_viewChanged",void 0),h([f()],Gt.prototype,"_splitLimits",void 0),h([f({readOnly:!0})],Gt.prototype,"_watchUpdatingTracking",void 0),h([f()],Gt.prototype,"_frameTask",void 0),h([f({readOnly:!0})],Gt.prototype,"snapLevel",null),h([f({readOnly:!0})],Gt.prototype,"lodSnapping",null),h([f()],Gt.prototype,"_userClippingExtent",null),h([f()],Gt.prototype,"_rootTilesExtent",void 0),h([f({readOnly:!0})],Gt.prototype,"extent",null),h([f({readOnly:!0})],Gt.prototype,"groundExtent",null),h([f({readOnly:!0})],Gt.prototype,"_tilingSchemeExtent",null),h([f({readOnly:!0})],Gt.prototype,"updating",null),h([f({readOnly:!0})],Gt.prototype,"running",null),h([f(Ymt)],Gt.prototype,"updatingProgress",void 0),h([f({readOnly:!0})],Gt.prototype,"updatingProgressValue",null),h([f()],Gt.prototype,"_maxNumUpdating",void 0),h([f()],Gt.prototype,"baseOpacity",null),h([f()],Gt.prototype,"hasCompositeBlendMode",void 0),h([f({readOnly:!0})],Gt.prototype,"viewingMode",null),h([f()],Gt.prototype,"maxTextureScale",void 0),h([f({readOnly:!0})],Gt.prototype,"ready",null),h([f({value:tE.FRONT_TO_BACK})],Gt.prototype,"renderOrder",null),h([f({readOnly:!0})],Gt.prototype,"rootTiles",null),h([f()],Gt.prototype,"_rootTiles",void 0),h([f({readOnly:!0})],Gt.prototype,"spatialReference",null),h([f({type:it})],Gt.prototype,"backgroundColor",null),h([f({value:!1})],Gt.prototype,"slicePlaneEnabled",null),h([f({readOnly:!0})],Gt.prototype,"tilingScheme",void 0),h([f({readOnly:!0})],Gt.prototype,"tilingSchemeLocked",null),h([f({readOnly:!0})],Gt.prototype,"tilingSchemeLogic",void 0),h([f()],Gt.prototype,"wireframe",null),h([f({value:!1})],Gt.prototype,"suspended",null),h([f()],Gt.prototype,"textureFadeDuration",null),h([f()],Gt.prototype,"visibleElevationBounds",void 0),h([f()],Gt.prototype,"rootTileElevationBounds",void 0),h([f()],Gt.prototype,"_layerViewsDirty",void 0),h([f()],Gt.prototype,"renderPatchBorders",null),h([f()],Gt.prototype,"visualizeNormals",null),h([f()],Gt.prototype,"renderingDisabled",null),Gt=h([N("esri.views.3d.terrain.TerrainSurface")],Gt);const Fyt=Gt;function lhe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function xRe(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(xRe(r))return!0;return!1}function Uyt(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const ul=Qt(),kyt=jt(),JI=[0,0,0],Hz=new Nt,Wz={spatialReference:null,extent:jt(),context:"ground"},KI={spatialReference:null,extent:null,scale:0};function che(t,e,r){var i;for(const n of t){if(!n.containsPointXY(e,r))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[a]}const o=((i=s==null?void 0:s.renderData)==null?void 0:i.geometryState.samplerData)??null;return qi(e,r,o)}return null}let zyt=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},fA=class extends xe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},u)=>{let d=!1;if(l===Hi.UPDATE){const p=o.get(u);if(p){if(c&bs.TRANSFORMATION){const m=this.model.getObject(s);this.model.updateRenderGeometryTransformation(m,a,p)&&(d=!0)}d||r.updates.push({renderGeometry:p,updateType:c})}else Je(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===Hi.REMOVE||d){const p=o.get(u);p?(r.removes.push(p),o.delete(u)):l===Hi.REMOVE&&Je(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===Hi.ADD||d){const p=this.model.getObject(s);if(p!=null){const m=this.model.getRenderGeometry(p,a);r.adds.push(m),o.set(u,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(n=>n.forEach(s=>r.push(s)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,Hi.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(bs.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(bs.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(bs.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,Hi.UPDATE,bs.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const n of r.geometries)this._objectGeometryAdded(r,n,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const n of r.geometries)this._objectGeometryRemoved(r,n,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,n)=>{const s=this.model.getObject(n);s&&s.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,r,Hi.UPDATE,bs.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Hi.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,Hi.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,n,s=bs.NONE){i=i??this._getParentLayerId(e);const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const u=c.operation;u===Hi.REMOVE&&n===Hi.ADD&&c.states!==bs.NONE?c.operation=Hi.UPDATE:u===Hi.REMOVE&&n===Hi.ADD||u===Hi.ADD&&n===Hi.REMOVE?l.delete(a):u!==Hi.UPDATE||n!==Hi.REMOVE&&n!==Hi.UPDATE?(Je((u===Hi.REMOVE||u===Hi.ADD)&&n===Hi.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=s):(c.operation=n,c.states|=s)}else l.set(a,new zyt(n,r,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}get _hasDirtyGeometryRecords(){return Do(this._dirtyGeomRecords,e=>Do(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:oNe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,n)=>{i.forEach((s,o)=>{r.length>0&&(r+=`
`),r+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,n)=>e.commitLayer(n,r))}}};h([f({constructOnly:!0})],fA.prototype,"model",void 0),h([f()],fA.prototype,"dirty",void 0),fA=h([N("esri.views.3d.webgl-engine.lib.ModelDirtySet")],fA);const Byt=fA;let lN=class extends xe{constructor(){super(...arguments),this.dirtySet=new Byt({model:this}),this._content=new Map,this._originFactory=new PJ(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;Je(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),F5(e)&&this.dirtySet.layerAdded(e)}remove(e){Je(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),F5(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)r!=null&&(Je(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)Je(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:n}=r,s=new KS(r,{shaderTransformer:i,castShadow:e.castShadow});return s.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),s.localOrigin=n??this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(r,s));const n=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==n}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<on.COUNT;++i)e[i]=r.filter(n=>n.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};h([f({constructOnly:!0})],lN.prototype,"dirtySet",void 0),lN=h([N("esri.views.3d.webgl-engine.parts.Model")],lN);function Vyt(){const t=new Float32Array(4);return t[3]=1,t}function TRe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Gyt(t,e,r,i){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function SRe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:TRe,create:Vyt,createView:SRe,fromValues:Gyt},Symbol.toStringTag,{value:"Module"}));const rE=1e-6,WC=[0,0,0],eL=[0,0,0];function jyt(t,e){const{data:r,size:i}=t,n=r.length/i;if(n<=0)return;const s=new Kyt(t);cN(WC,s.minProj,s.maxProj),lb(WC,WC,.5),dh(eL,s.maxProj,s.minProj);const o=NW(eL),a=new e_t;a.quality=o,n<14&&(t=new Ue(new Float64Array(s.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[0,0,0],p=[0,0,0],m=[0,0,0],y=[0,0,0];switch(Hyt(s,t,y,l,c,u,d,p,m,a)){case 1:return void phe(WC,eL,e);case 2:return void Jyt(t,d,e)}Wyt(t,y,l,c,u,d,p,m,a),ERe(t,a.b0,a.b1,a.b2,JT,KT);const _=[0,0,0];dh(_,KT,JT),a.quality=NW(_),a.quality<o?CRe(a.b0,a.b1,a.b2,JT,KT,_,e):phe(WC,eL,e)}function Hyt(t,e,r,i,n,s,o,a,l,c){return qyt(t,i,n),FW(i,n)<rE?1:(dh(o,i,n),Mo(o,o),Xyt(e,i,o,s)<rE?2:(dh(a,n,s),Mo(a,a),dh(l,s,i),Mo(l,l),ph(r,a,o),Mo(r,r),kv(e,r,o,a,l,c),0))}const qC=[0,0,0],XC=[0,0,0],Lu=[0,0,0],Du=[0,0,0],Nu=[0,0,0],j0=[0,0,0],H0=[0,0,0],W0=[0,0,0];function Wyt(t,e,r,i,n,s,o,a,l){Yyt(t,e,r,qC,XC),qC[0]!==void 0&&(dh(Lu,qC,r),Mo(Lu,Lu),dh(Du,qC,i),Mo(Du,Du),dh(Nu,qC,n),Mo(Nu,Nu),ph(j0,Du,s),Mo(j0,j0),ph(H0,Nu,o),Mo(H0,H0),ph(W0,Lu,a),Mo(W0,W0),kv(t,j0,s,Du,Lu,l),kv(t,H0,o,Nu,Du,l),kv(t,W0,a,Lu,Nu,l)),XC[0]!==void 0&&(dh(Lu,XC,r),Mo(Lu,Lu),dh(Du,XC,i),Mo(Du,Du),dh(Nu,XC,n),Mo(Nu,Nu),ph(j0,Du,s),Mo(j0,j0),ph(H0,Nu,o),Mo(H0,H0),ph(W0,Lu,a),Mo(W0,W0),kv(t,j0,s,Du,Lu,l),kv(t,H0,o,Nu,Du,l),kv(t,W0,a,Lu,Nu,l))}function qyt(t,e,r){let i=FW(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=FW(t.maxVert[s],t.minVert[s]);o>i&&(i=o,n=s)}yc(e,t.minVert[n]),yc(r,t.maxVert[n])}const Fu=[0,0,0];function Xyt(t,e,r,i){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){Fu[0]=n[l]-e[0],Fu[1]=n[l+1]-e[1],Fu[2]=n[l+2]-e[2];const c=r[0]*Fu[0]+r[1]*Fu[1]+r[2]*Fu[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],d=Fu[0]*Fu[0]+Fu[1]*Fu[1]+Fu[2]*Fu[2]-c*c/u;d>o&&(o=d,a=l)}return yc(i,n,a),o}const vs=[0,0];function Yyt(t,e,r,i,n){Qyt(t,e,vs,n,i);const s=ORe(r,e);vs[1]-rE<=s&&(i[0]=void 0),vs[0]+rE>=s&&(n[0]=void 0)}const uhe=[0,0,0],hhe=[0,0,0],dhe=[0,0,0],Hx=[0,0,0],Wx=[0,0,0],tL=[0,0,0];function kv(t,e,r,i,n,s){if(ARe(e)<rE)return;ph(uhe,r,e),ph(hhe,i,e),ph(dhe,n,e),QT(t,e,vs),Wx[1]=vs[0],Hx[1]=vs[1],tL[1]=Hx[1]-Wx[1];const o=[r,i,n],a=[uhe,hhe,dhe];for(let l=0;l<3;++l){QT(t,o[l],vs),Wx[0]=vs[0],Hx[0]=vs[1],QT(t,a[l],vs),Wx[2]=vs[0],Hx[2]=vs[1],tL[0]=Hx[0]-Wx[0],tL[2]=Hx[2]-Wx[2];const c=NW(tL);c<s.quality&&(yc(s.b0,o[l]),yc(s.b1,e),yc(s.b2,a[l]),s.quality=c)}}const Zyt=[0,0,0];function QT(t,e,r){const{data:i,size:n}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const o=i[s]*e[0]+i[s+1]*e[1]+i[s+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function Qyt(t,e,r,i,n){const{data:s,size:o}=t;yc(i,s),yc(n,i),r[0]=ORe(Zyt,e),r[1]=r[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<r[0]&&(r[0]=l,yc(i,s,a)),l>r[1]&&(r[1]=l,yc(n,s,a))}}function phe(t,e,r){yc(r.center,t),lb(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const Rm=[0,0,0],qx=[0,0,0],YC=[0,0,0],JT=[0,0,0],KT=[0,0,0],fhe=[0,0,0];function Jyt(t,e,r){yc(Rm,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Rm[0]=0:Math.abs(e[1])>Math.abs(e[2])?Rm[1]=0:Rm[2]=0,ARe(Rm)<rE&&(Rm[0]=Rm[1]=Rm[2]=1),ph(qx,e,Rm),Mo(qx,qx),ph(YC,e,qx),Mo(YC,YC),ERe(t,e,qx,YC,JT,KT),dh(fhe,KT,JT),CRe(e,qx,YC,JT,KT,fhe,r)}function ERe(t,e,r,i,n,s){QT(t,e,vs),n[0]=vs[0],s[0]=vs[1],QT(t,r,vs),n[1]=vs[0],s[1]=vs[1],QT(t,i,vs),n[2]=vs[0],s[2]=vs[1]}const rL=[0,0,0],Gp=[1,0,0,0,1,0,0,0,1],Xx=[0,0,0];function CRe(t,e,r,i,n,s,o){Gp[0]=t[0],Gp[1]=t[1],Gp[2]=t[2],Gp[3]=e[0],Gp[4]=e[1],Gp[5]=e[2],Gp[6]=r[0],Gp[7]=r[1],Gp[8]=r[2],t_t(o.quaternion,Gp),cN(Xx,i,n),lb(Xx,Xx,.5),lb(o.center,t,Xx[0]),lb(rL,e,Xx[1]),cN(o.center,o.center,rL),lb(rL,r,Xx[2]),cN(o.center,o.center,rL),lb(o.halfSize,s,.5)}const Uc=7;let Kyt=class{constructor(e){this.minVert=new Array(Uc),this.maxVert=new Array(Uc);const r=64*Uc;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Uc),i+=8*Uc,this.maxProj=new Float64Array(this.buffer,i,Uc),i+=8*Uc;for(let l=0;l<Uc;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Uc;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Uc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(Uc),s=new Array(Uc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<Uc;++l){let c=n[l];yc(this.minVert[l],o,c),c=s[l],yc(this.maxVert[l],o,c)}}},e_t=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function NW(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function cN(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function dh(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function lb(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function yc(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function ph(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o}function Mo(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function ARe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function FW(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function ORe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function t_t(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const n=(i+1)%3,s=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+i]+e[3*i+n])*o,t[s]=(e[3*s+i]+e[3*i+s])*o}}const zb=Au(),ka=O(),UW=O(),r_t=hi();let f8t=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:nY(this.buffer,56*a+0),halfSize:Exe(this.buffer,56*a+24),quaternion:SRe(this.buffer,56*a+36)}}};function RRe(t=[0,0,0],e=[-1,-1,-1],r=Au()){return{center:ki(t),halfSize:i5(e),quaternion:TRe(r)}}function mhe(t){return RRe(t.center,t.halfSize,t.quaternion)}function g8t(t,e){re(e.center,t.center),re(e.halfSize,t.halfSize),vQ(e.quaternion,t.quaternion)}function y8t(t,e){return e=e||RRe(),jyt(t,e),e}function zv(t,e){const r=oi(e,t.center),i=nU(t,e);return r>i?1:r<-i?-1:0}function _8t(t,e){return ka[0]=t.center[0]-e[0],ka[1]=t.center[1]-e[1],ka[2]=t.center[2]-e[2],X_(zb,t.quaternion),Sh(ka,ka,zb),b4(ka,ka),lY(UW,ka,t.halfSize),u6(UW,ka)<e[3]*e[3]}function v8t(t,e){e||(e=ps());const r=rQ(r_t,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),n=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),s=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+i,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function b8t(t,e){return oi(e,t.center)-nU(t,e)}function w8t(t,e){return oi(e,t.center)+nU(t,e)}function x8t(t,e){return zv(t,e[0])<=0&&zv(t,e[1])<=0&&zv(t,e[2])<=0&&zv(t,e[3])<=0&&zv(t,e[4])<=0&&zv(t,e[5])<=0}function T8t(t,e,r,i=0){X_(zb,t.quaternion),ae(ka,e,t.center);const n=Sh(ka,ka,zb),s=Sh(UW,r,zb);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(i+t.halfSize[l]-n[l])/s[l],u=(-i-t.halfSize[l]-n[l])/s[l];o=Math.max(o,Math.min(c,u)),a=Math.min(a,Math.max(c,u))}else if(n[l]>t.halfSize[l]+i||n[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function nU(t,e){X_(zb,t.quaternion),Sh(ka,e,zb);const r=t.halfSize;return Math.abs(ka[0]*r[0])+Math.abs(ka[1]*r[1])+Math.abs(ka[2]*r[2])}function S8t(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],Sh(i,i,t.quaternion),oe(i,i,t.center)}}function i_t(t){return rc(t.halfSize)}function n_t(t,e,r,i,n){if(vQ(n.quaternion,t.quaternion),i===$e.Global){X_(iL,t.quaternion),Sh(q0,t.center,iL),b4(Yx,q0),lY(Zx,Yx,t.halfSize),Ws(Zx,Yx,Zx);const s=Te(Zx);oe(Zx,Yx,t.halfSize);const o=Te(Zx);if(s<r)re(n.center,t.center),ne(q0,r,r,r),oe(n.halfSize,t.halfSize,q0);else{const a=o>0?1+e/o:1,l=s>0?1+r/s:1,c=(l+a)/2,u=(l-a)/2;te(n.halfSize,Yx,u),pb(n.halfSize,n.halfSize,t.halfSize,c),te(n.center,Yx,c),pb(n.center,n.center,t.halfSize,u),aye(q0,q0),c6(n.center,n.center,q0),Sh(n.center,n.center,n.quaternion)}}else{const s=ne(q0,0,0,1);pb(n.center,t.center,s,(r+e)/2),X_(iL,t.quaternion),Sh(s,s,iL),b4(s,s),pb(n.halfSize,t.halfSize,s,(r-e)/2)}return n}const q0=O(),Yx=O(),Zx=O(),iL=Au();let s_t=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=o_t(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i];if(!e(n,n+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let n=0;n<i.length;n+=2){const s=i[n],o=s+i[n+1],a=e[s],l=e[o];r[n]=a,r[n+1]=l-a}return r}};function o_t(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let n=1;n<t.length;n++){const s=t[n];r+i===s?i+=1:(e.push(r),e.push(i),r=s,i=1)}return e.push(r),e.push(i),e}let a_t=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new s_t(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let n=0;n<i;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=l_t(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function l_t(t,e,r){const i=[],n=[];let s=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[a])),s=a):(o!==a-1&&(n.length&&n.push(r[o+1]-n[n.length-1]),n.push(r[a])),o=a),!0)),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[o+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}let mA=class extends xe{constructor(){super(...arguments),this.visible=eS.Hidden}};var eS;h([f({autoDestroy:!0})],mA.prototype,"renderable",void 0),h([f({autoDestroy:!0})],mA.prototype,"components",void 0),mA=h([N("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],mA),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(eS||(eS={}));function c_t(t,e,r,i){if(r>=e)return t;t==null&&(t=u_t());const n=t.isVisibleBit;let s=t.data;const o=MRe(s),a=r/o|0,l=r-o*a,c=(e-1)/o|0,u=s,d=i===n;if(!(r<u.length*o)&&d){const p=a+1,m=Math.ceil(u.length*jF),y=c+1;let _=Math.max(p,m);_=Math.min(_,y),s=new Uint32Array(_),s.set(u)}return a<s.length&&(s[a]=d_t(s[a],l,d)),t.data=s,t}function PRe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,n=MRe(i);return e<i.length*n?h_t(r,i,e,n):!t.isVisibleBit}function u_t(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function h_t(t,e,r,i){const n=r/i|0,s=r-n*i;return p_t(e[n],s)===t}function MRe(t){return t.BYTES_PER_ELEMENT*8}function d_t(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function p_t(t,e){return(t&1<<e)!=0}let f_t=class{constructor(e,r){this._components=r,this._indices=e.indices!=null?zf(e.indices):zS(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,n,s,o,a){const l=new Ue(this._positions,3,!1,3),c=this._indices,u=this._components.offsets,d=dSe(e,r,m_t),p=e[2],m=r[2];this._components.visibility.forEachComponent(y=>{if(!PRe(this._components.pickability,y))return!0;const _=this.getComponentAabb(y,g_t);if(o!=null){const T=o[y];s!=null?s.componentOffset=T:(e[2]=p-T,r[2]=m-T)}if(s!=null&&s.applyToAabb(_),!QQ(_,e,d,i))return!0;const v=u[y]/3,b=u[y+1]/3,x=(T,S,A)=>a(y,T,zo(S,S,n),A);return s==null&&b-v>bRe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new CK(this._indices,v,b,l)),this._componentIntersectionData[y].intersectRay({r0:e,r1:r},x)):BP(e,r,v,b,c,l,void 0,s,x),!0})}_computePerComponentAabbs(){const e=this._components.count,r=Yi(6*e),i=this._indices,n=this._positions,s=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=s[a],c=s[a+1];let u=1/0,d=1/0,p=1/0,m=-1/0,y=-1/0,_=-1/0;for(let v=l;v<c;v++){const b=3*i[v],x=n[b],T=n[b+1],S=n[b+2];u=Math.min(u,x),d=Math.min(d,T),p=Math.min(p,S),m=Math.max(m,x),y=Math.max(y,T),_=Math.max(_,S)}r[o++]=u,r[o++]=d,r[o++]=p,r[o++]=m,r[o++]=y,r[o++]=_}return r}get positions(){return this._positions}get indices(){return this._indices}};const m_t=O(),g_t=ps();let y_t=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},__t=class{constructor(e,r,i,n){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=n}dispose(){this.vao.dispose()}},v_t=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function b_t(t,e){return{near:t,far:e}}function nM(t){return t?WR(t,1/0,-1/0):b_t(1/0,-1/0)}function WR(t,e,r){return t.near=e,t.far=r,t}function iE(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function nL(t,e){return t.near<=e&&e<=t.far}const kW={near:0,far:0};function w_t(t,e){const r=nM(),{eye:i,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=fe(Ws(Vc,a.center,i),s),c=nU(a,s);if(nL(r,l-c)&&nL(r,l+c))return;const u=C_t(a,n);if(u===-1)return;if(u===0)return Pm.far=l+c,Pm.near=l-c,void iE(r,Pm);const d=sL.pushNew();d.near=l-c,d.far=l+c,d.mask=u,d.object=o});for(let o=0;o<sL.length;o++){const a=sL.data[o];if(nL(r,a.near)&&nL(r,a.far))continue;Pm.far=a.far,Pm.near=1/0,E_t(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,x_t,c=>{let u=T_t;for(let d=0;d<$Re&&c.length>0;d++){if(!(a.mask&1<<d))continue;S_t(n[d],c,u);const p=c;c=u,u=p}for(let d=0;d<c.length;d+=3){ne(_l,c.data[d],c.data[d+1],c.data[d+2]);const p=fe(Ws(_l,_l,i),s);Pm.near=Math.min(Pm.near,p)}})===0&&(Pm.near=0),iE(r,Pm)}return sL.length=0,r}const sL=new Nt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=lE(t.object),t)}),Pm=nM(),_l=O(),tv=O(),x_t=new Nt({deallocator:null}),T_t=new Nt({deallocator:null});function S_t(t,e,r){r.length=0;const i=e.length-3;qz(_l,e,i);const n=oi(t,_l);n<=0&&(r.push(_l[0]),r.push(_l[1]),r.push(_l[2]));let s=0,o=n;for(;s<i;s+=3){qz(tv,e,s);const a=oi(t,tv);o*a<0&&(Lr(_l,tv,_l,a/(a-o)),vl(r,_l)),a<=0&&vl(r,tv),o=a,re(_l,tv)}o*n<0&&(qz(tv,e,i),Lr(_l,tv,_l,n/(n-o)),vl(r,_l))}function qz(t,e,r){return ne(t,e.data[r],e.data[r+1],e.data[r+2])}function vl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function E_t(t,e,r,i){X_(yhe,t.quaternion),Ws(Vc,e,t.center),Sh(Vc,Vc,yhe);const n=8*((Vc[0]<-t.halfSize[0]?-1:Vc[0]>t.halfSize[0]?1:0)+3*(Vc[1]<-t.halfSize[1]?-1:Vc[1]>t.halfSize[1]?1:0)+9*(Vc[2]<-t.halfSize[2]?-1:Vc[2]>t.halfSize[2]?1:0)+13),s=ghe[n];if(s===0)return s;rQ(oL,t.quaternion),tQ(oL,oL,t.halfSize);const o=(a,l)=>{const c=ghe[n+l+1];return ne(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),zo(a,a,oL),oe(a,t.center,a)};return r.length=0,vl(r,o(Xz,0)),vl(r,o(_he,1)),vl(r,o(Vc,2)),vl(r,o(vhe,3)),i(r),s===1||(r.length=0,vl(r,Xz),vl(r,vhe),vl(r,o(Vc,4)),vl(r,o(bhe,5)),i(r),s===2||(r.length=0,vl(r,Xz),vl(r,bhe),vl(r,o(Vc,6)),vl(r,_he),i(r))),s}const ghe=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),$Re=4;function C_t(t,e){let r=0;for(let i=0;i<$Re;i++){const n=zv(t,e[i]);if(n>0)return-1;n===0&&(r|=1<<i)}return r}const oL=hi(),yhe=Au(),Vc=O(),Xz=O(),_he=O(),vhe=O(),bhe=O();let A_t=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?w_t(e,this._objects.visibleObjects):null}};function O_t(t){const e=Gi().vec3f(E.POSITION);return t.normals&&e.vec2i16(E.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Pn.Default?e.vec2f(E.UV0):t.textureCoordinates===Pn.Atlas&&(e.vec2f(E.UV0),e.vec4u16(E.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(E.COLOR,{glNormalized:!0}),e}let R_t=class{constructor(){this.externalColor=Qt(),this.externalColorMixMode=as.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},P_t=class extends ln{constructor(e,r){super(e,"int",jr.Draw,(i,n,s)=>i.setUniform1i(e,r(n,s)))}};var Gf;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Gf||(Gf={}));const AK=429496.7296;function IRe(t,e){$R(t/AK*.5+.5,e)}function M_t(t,e){switch(e.componentData){case Gf.Varying:return $_t(t,e);case Gf.Uniform:return I_t(t);case Gf.COUNT:return;default:e.componentData}}function $_t(t,e){const{vertex:r,fragment:i}=t;r.include(Pc),r.uniforms.add(new Eh("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(E.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===D.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(b3e),r.constants.add("elevationScale","float",2*AK),r.constants.add("stride","float",se("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(w`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(w`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?w`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:w`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(w`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?w`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function I_t(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new rF("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new P_t("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(w`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(w`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var gh;function L_t(t,e){const r=t.vertex;switch(r.code.add(w`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case gh.None:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) {}`);break;case gh.Opaque:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case gh.Transparent:r.code.add(w`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(gh||(gh={}));var jf;function D8t(t){return t&&nm(t)?jf.Mars:t&&sm(t)?jf.Moon:jf.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(jf||(jf={}));var ru;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(ru||(ru={}));let sr=class extends va{constructor(){super(...arguments),this.output=D.Color,this.textureCoordinateType=Pn.None,this.componentData=Gf.Uniform,this.cullFace=ui.Back,this.vertexDiscardMode=gh.None,this.doubleSidedMode=Zi.WindingOrder,this.alphaDiscardMode=Gr.Opaque,this.integratedMeshMode=ru.None,this.transparencyPassType=rt.NONE,this.ellipsoidMode=jf.Earth,this.pbrMode=et.Disabled,this.normalType=br.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};h([U({count:D.COUNT})],sr.prototype,"output",void 0),h([U({count:Pn.COUNT})],sr.prototype,"textureCoordinateType",void 0),h([U({count:Gf.COUNT})],sr.prototype,"componentData",void 0),h([U({count:ui.COUNT})],sr.prototype,"cullFace",void 0),h([U({count:gh.COUNT})],sr.prototype,"vertexDiscardMode",void 0),h([U({count:Zi.COUNT})],sr.prototype,"doubleSidedMode",void 0),h([U({count:Gr.COUNT})],sr.prototype,"alphaDiscardMode",void 0),h([U({count:ru.COUNT})],sr.prototype,"integratedMeshMode",void 0),h([U({count:rt.COUNT})],sr.prototype,"transparencyPassType",void 0),h([U({count:jf.COUNT})],sr.prototype,"ellipsoidMode",void 0),h([U({count:et.COUNT})],sr.prototype,"pbrMode",void 0),h([U({count:br.COUNT})],sr.prototype,"normalType",void 0),h([U()],sr.prototype,"spherical",void 0),h([U()],sr.prototype,"doublePrecisionRequiresObfuscation",void 0),h([U()],sr.prototype,"hasVertexColors",void 0),h([U()],sr.prototype,"hasNormals",void 0),h([U()],sr.prototype,"hasSlicePlane",void 0),h([U()],sr.prototype,"hasBaseColorTexture",void 0),h([U()],sr.prototype,"receiveAmbientOcclusion",void 0),h([U()],sr.prototype,"receiveShadows",void 0),h([U()],sr.prototype,"blendingEnabled",void 0),h([U()],sr.prototype,"hasScreenSpaceReflections",void 0),h([U()],sr.prototype,"hasPolygonOffset",void 0),h([U()],sr.prototype,"hasMetallicRoughnessTexture",void 0),h([U()],sr.prototype,"hasEmissionTexture",void 0),h([U()],sr.prototype,"hasOcclusionTexture",void 0),h([U()],sr.prototype,"hasNormalTexture",void 0),h([U()],sr.prototype,"hasOccludees",void 0),h([U()],sr.prototype,"hasMultipassTerrain",void 0),h([U()],sr.prototype,"cullAboveGround",void 0),h([U()],sr.prototype,"hasCloudsReflections",void 0),h([U()],sr.prototype,"snowCover",void 0),h([U()],sr.prototype,"objectAndLayerIdColor",void 0),h([U({constValue:jr.Draw})],sr.prototype,"pbrTextureBindType",void 0),h([U({constValue:!0})],sr.prototype,"hasSliceHighlight",void 0),h([U({constValue:!1})],sr.prototype,"hasSliceInVertexProgram",void 0),h([U({constValue:!1})],sr.prototype,"useCustomDTRExponentForWater",void 0),h([U({constValue:!1})],sr.prototype,"hasVertexTangents",void 0),h([U({constValue:!0})],sr.prototype,"supportsTextureAtlas",void 0),h([U({constValue:!1})],sr.prototype,"highStepCount",void 0),h([U({constValue:!1})],sr.prototype,"instancedDoublePrecision",void 0),h([U({constValue:!0})],sr.prototype,"useFillLights",void 0),h([U({constValue:!1})],sr.prototype,"objectAndLayerIdColorInstanced",void 0);function whe(t,e){t.include(qw,e),t.fragment.include(kR);const r=t.fragment;r.uniforms.add(new rF("baseColor",i=>i.baseColor)),r.uniforms.add(new Nb("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(w`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(w`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(w`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function xhe(t,e){const r=t.fragment;switch(e.doubleSidedMode){case Zi.None:r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Zi.View:t.include(kT,e),r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Zi.WindingOrder:r.code.add(w`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Zi.COUNT:}switch(e.normalType){case br.Attribute:case br.Compressed:t.include(F8,e),r.code.add(w`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case br.ScreenDerivative:t.include(kT,e),r.code.add(w`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case br.Ground:e.spherical?(t.include(kT,e),r.code.add(w`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(w`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(w`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case br.COUNT:}}function D_t(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===D.Color||e.alphaDiscardMode!==Gr.Opaque)){t.include(qZ,e);const i=e.textureCoordinateType===Pn.Atlas;r.uniforms.add(new Eh("baseColorTexture",n=>n.texture)),i?(t.include(_xe),r.code.add(w`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(w`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(w`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function N_t(t){const e=new mr;e.include(kT,t),e.include(F8,t),e.include(qw,t),e.include(Uf,t),e.include(AE,t),e.include(M_t,t),e.include(Hot,t),e.include(ptt,t),e.include(D_t,t),e.include(L_t,t);const{vertex:r,fragment:i}=e;t.pbrMode!==et.Normal&&t.pbrMode!==et.Schematic||(e.include(YZ,t),t.hasNormalTexture&&e.include(S3e,t));const n=t.output===D.Shadow||t.output===D.ShadowHighlight||t.output===D.ShadowExcludeHighlight;n&&t.componentData===Gf.Varying?r.code.add(w`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(w`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===ru.ColorOverlay||t.integratedMeshMode===ru.ColorOverlayWithWater,o=s&&t.output===D.Color&&t.pbrMode===et.WaterOnIntegratedMesh;return s&&(e.include(ww,t),e.include(Kgt,t),t.spherical?r.code.add(w`
      const float invEllipsoidRadius = ${w.float(1/(t.ellipsoidMode===jf.Earth?Kt.radius:t.ellipsoidMode===jf.Mars?If.radius:Fg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(w`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(w`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===D.ObjectAndLayerIdColor?w`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${w.float(vo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===D.ObjectAndLayerIdColor?w`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?w`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:w`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?w`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===D.Alpha&&(i.include(wu),e.include(xu,t),e.include(whe,t),s&&i.uniforms.add(new Ye("ovColorTex",(a,l)=>EW(a,l))),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?w`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===D.Color&&(i.include(wu),e.include(xu,t),e.include(whe,t),e.include(xhe,t),e.include(ww,t),t.receiveShadows?(e.include(U8,t),i.code.add(w`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(w`float evaluateShadow() { return 0.0; }`),s&&i.uniforms.add(new Ye("ovColorTex",(a,l)=>EW(a,l))),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?w`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?w`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===et.Normal||t.pbrMode===et.Schematic?(lm(i),i.code.add(w`
        ${t.pbrMode===et.Normal?w`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(w`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(w`vec3 shadingNormal = normalVertex;`),i.code.add(w`${t.spherical?w`vec3 normalGround = normalize(positionWorld());`:w`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(w`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?w`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?w` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(w`float shadow = evaluateShadow();`):t.spherical?(NE(i),i.code.add(w`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(w`float shadow = 0.0;`),o&&i.uniforms.add(new Ye("ovNormalTex",(a,l)=>OK(l))),t.snowCover&&i.code.add(w`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(w`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?w` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?w`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(w`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===rt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===D.Depth||n)&&(e.include(Xg,t),i.code.add(w`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===D.Normal&&(e.include(xhe,t),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===br.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===D.ObjectAndLayerIdColor&&e.fragment.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?w`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===D.Highlight&&(e.include(c0,t),i.code.add(w`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?w`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function OK(t){return t.overlays.length===0?null:t.overlays[Oi.INNER].getValidTexture(tn.Water)}const F_t=Object.freeze(Object.defineProperty({__proto__:null,build:N_t,getOverlayNormalTexture:OK},Symbol.toStringTag,{value:"Module"}));let LRe=class DRe extends Tr{initializeConfiguration(e,r){r.spherical=e.viewingMode===$e.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new vr(e.rctx,DRe.shader.get().build(this.configuration),NRe)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==ru.None,n=e===rt.NONE,s=e===rt.FrontFace;return Ot({blending:r.output!==D.Color&&r.output!==D.Alpha||!r.blendingEnabled?null:n?fu:u0(e),culling:J6(r.cullFace),depthTest:{func:f1(e)},depthWrite:n||s?$l:null,colorWrite:Ft,stencilWrite:i||r.hasOccludees?em:null,stencilTest:i?wst(Rl.IntegratedMeshMaskExcluded):r.hasOccludees?m1:null,polygonOffset:n||s?r.hasPolygonOffset?{factor:2,units:2}:null:C8})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};LRe.shader=new _r(F_t,()=>ce(()=>import("./ComponentShader.glsl-ec5515fa.js"),[]));const NRe=new Map([[E.POSITION,0],[E.NORMAL,1],[E.NORMALCOMPRESSED,1],[E.COLOR,2],[E.UV0,3],[E.UVREGION,4],[E.COMPONENTINDEX,5]]);let U_t=class extends Wr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},RK=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Ki(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(s){const o=this[i];if(o==null)this[i]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(n){this[i]!==n&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function The(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let sU=class{constructor(e){this._low=O(),this._high=O(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){re(this._low,re(She,e));const r=Ws(She,e,this._low);re(this._high,r)}get(e){return oe(e,this._low,this._high)}getLowScaled(e){return te(e,this._low,1)}};const She=rn();let Ds=class extends U_t{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=$t(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=na(z8),this.emissiveFactor=Se(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new uN,this.componentParameters=new OO,this.textureAlphaCutoff=$5,this.alphaDiscardMode=Gr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=jf.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new sr;const i=new sU(e.position),n=E3e(e.rotationScale);Vw(n,n),this.transformNormalGlobalFromModel=qve(Uh(n,n)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=Fi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasEmissionTexture=this.emissionTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.transparencyPassType=r.identifier===pc.Material&&i.transparencyPassType!=null?i.transparencyPassType:rt.NONE,s.hasMultipassTerrain=r.identifier===pc.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,s.cullAboveGround=r.identifier===pc.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?Zi.View:Zi.None,s.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();s.blendingEnabled=o===Na.Transparent||o===Na.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?z_t(i)?OK(i)?ru.ColorOverlayWithWater:ru.ColorOverlay:ru.NoOverlay:ru.None,s.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(s.pbrMode=s.integratedMeshMode===ru.ColorOverlayWithWater?et.WaterOnIntegratedMesh:this.usePBR?a?et.Schematic:et.Normal:et.Disabled,s.normalType=s.integratedMeshMode===ru.None?s.hasNormals?br.Compressed:br.ScreenDerivative:br.Ground,s.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===pc.ShadowMap)s.output=D.Shadow,s.vertexDiscardMode=gh.None;else if(r.identifier===pc.Highlight)s.output=D.Highlight,s.vertexDiscardMode=gh.None;else{switch(this._computeWhichMaterialPass()===Na.OpaqueAndTransparent?s.vertexDiscardMode=r.transparent?gh.Opaque:gh.Transparent:s.vertexDiscardMode=gh.None,s.output=r.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,r.output){case D.Color:s.receiveAmbientOcclusion=i.ssaoHelper.active,s.hasOccludees=i.hasOccludees,s.receiveShadows=i.shadowMap.ready,s.hasScreenSpaceReflections=i.ssr.enabled,s.hasCloudsReflections=i.cloudsFade.data!=null;break;case D.Alpha:s.hasOccludees=i.hasOccludees;break;case D.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(LRe,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const n=i.renderable.geometry,s=i.components,o=i.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Na.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case Na.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case Na.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case Na.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),k_t(r)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const u=this.componentParameters.castShadows!==xs.None;u&&e.shadowMap.submitDraw(this,n,a,o),l!=null&&(e.highlight.submitDraw(this,n,l,o),u&&e.highlightShadowMap.submitDraw(this,n,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Na.IntegratedMesh:this.objectOpacity<1?Na.Transparent:this.componentParameters.opaqueOverride===xs.All?Na.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Gr.Blend||this.alphaDiscardMode===Gr.MaskBlend?Na.Transparent:this.componentParameters.transparent===xs.None?Na.Opaque:this.componentParameters.transparent===xs.All?Na.Transparent:Na.OpaqueAndTransparent}};var Na,xs;h([Ki({vectorOps:mye})],Ds.prototype,"baseColor",void 0),h([Ki()],Ds.prototype,"usePBR",void 0),h([Ki()],Ds.prototype,"hasParametersFromSource",void 0),h([Ki({vectorOps:ire})],Ds.prototype,"mrrFactors",void 0),h([Ki({vectorOps:ire})],Ds.prototype,"emissiveFactor",void 0),h([Ki({dispose:!0})],Ds.prototype,"baseColorTexture",void 0),h([Ki({dispose:!0})],Ds.prototype,"metallicRoughnessTexture",void 0),h([Ki({dispose:!0})],Ds.prototype,"emissionTexture",void 0),h([Ki({dispose:!0})],Ds.prototype,"occlusionTexture",void 0),h([Ki({dispose:!0})],Ds.prototype,"normalTexture",void 0),h([Ki()],Ds.prototype,"objectOpacity",void 0),h([The()],Ds.prototype,"commonMaterialParameters",void 0),h([The()],Ds.prototype,"componentParameters",void 0),h([Ki()],Ds.prototype,"textureAlphaCutoff",void 0),h([Ki()],Ds.prototype,"alphaDiscardMode",void 0),h([Ki()],Ds.prototype,"isIntegratedMesh",void 0),h([Ki()],Ds.prototype,"polygonOffsetEnabled",void 0),h([Ki()],Ds.prototype,"ellipsoidMode",void 0),h([Ki()],Ds.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Na||(Na={}));let uN=class extends RK{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=ui.Back,this.hasSlicePlane=!0}};h([Ki()],uN.prototype,"doubleSided",void 0),h([Ki()],uN.prototype,"cullFace",void 0),h([Ki()],uN.prototype,"hasSlicePlane",void 0);let OO=class extends RK{constructor(){super(...arguments),this.externalColor=$t(1,1,1,1),this.externalColorMixMode=as.Multiply,this.castShadows=xs.All}get transparent(){return this.externalColor[3]<1?xs.All:xs.None}get opaqueOverride(){return this.externalColorMixMode===as.Replace&&this.externalColor[3]===1?xs.All:xs.None}get visible(){return this.externalColor[3]>0?xs.All:xs.None}get type(){return Gf.Uniform}};h([Ki({vectorOps:mye})],OO.prototype,"externalColor",void 0),h([Ki()],OO.prototype,"externalColorMixMode",void 0),h([Ki()],OO.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(xs||(xs={}));let gA=class extends RK{constructor(){super(...arguments),this.texture=null,this.transparent=xs.None,this.opaqueOverride=xs.None,this.castShadows=xs.None}get type(){return Gf.Varying}};function k_t(t){return t.overlays.length!==0&&t.overlays[Oi.INNER].getValidTexture(tn.Highlight)!=null}function z_t(t){return t.overlays.length!==0&&t.overlays[Oi.INNER].getColorTextureNoRasterImage()!=null}h([Ki()],gA.prototype,"texture",void 0),h([Ki()],gA.prototype,"transparent",void 0),h([Ki()],gA.prototype,"opaqueOverride",void 0),h([Ki()],gA.prototype,"castShadows",void 0);const aF=Gi().vec3f(E.POSITION).u16(E.COMPONENTINDEX).u16(E.U16PADDING),FRe=Gi().vec2u8(E.SIDENESS),B_t=Mc(FRe),URe=Gi().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u8(E.VARIANTOFFSET,{glNormalized:!0}).u8(E.VARIANTSTROKE).u8(E.VARIANTEXTENSION,{glNormalized:!0}).u8(E.U8PADDING,{glPadding:!0}).u16(E.U16PADDING,{glPadding:!0}),zW=URe.clone().vec3f(E.NORMAL),BW=URe.clone().vec3f(E.NORMALA).vec3f(E.NORMALB),kRe=new Map([[E.POSITION0,0],[E.POSITION1,1],[E.COMPONENTINDEX,2],[E.VARIANTOFFSET,3],[E.VARIANTSTROKE,4],[E.VARIANTEXTENSION,5],[E.NORMAL,6],[E.NORMALA,6],[E.NORMALB,7],[E.SIDENESS,8]]);function Ehe(t,e,r){const i=e/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),o=(b,x)=>{b<x?n[b+1]++:s[x+1]++};for(let b=0;b<i;b++){const x=t[3*b],T=t[3*b+1],S=t[3*b+2];o(x,T),o(T,S),o(S,x)}let a=0,l=0;for(let b=0;b<r;b++){const x=n[b+1],T=s[b+1];n[b+1]=a,s[b+1]=l,a+=x,l+=T}const c=new Uint32Array(6*i),u=n[r],d=(b,x,T)=>{if(b<x){const S=n[b+1]++;c[2*S]=x,c[2*S+1]=T}else{const S=s[x+1]++;c[2*u+2*S]=b,c[2*u+2*S+1]=T}};for(let b=0;b<i;b++){const x=t[3*b],T=t[3*b+1],S=t[3*b+2];d(x,T,b),d(T,S,b),d(S,x,b)}const p=(b,x)=>{const T=2*b,S=x-b;for(let A=1;A<S;A++){const C=c[T+2*A],R=c[T+2*A+1];let P=A-1;for(;P>=0&&c[T+2*P]>C;P--)c[T+2*P+2]=c[T+2*P],c[T+2*P+3]=c[T+2*P+1];c[T+2*P+2]=C,c[T+2*P+3]=R}};for(let b=0;b<r;b++)p(n[b],n[b+1]),p(u+s[b],u+s[b+1]);const m=new Int32Array(3*i),y=(b,x)=>b===t[3*x]?0:b===t[3*x+1]?1:b===t[3*x+2]?2:-1,_=(b,x)=>{const T=y(b,x);m[3*x+T]=-1},v=(b,x,T,S)=>{const A=y(b,x);m[3*x+A]=S;const C=y(T,S);m[3*S+C]=x};for(let b=0;b<r;b++){let x=n[b];const T=n[b+1];let S=s[b];const A=s[b+1];for(;x<T&&S<A;){const C=c[2*x],R=c[2*u+2*S];C===R?(v(b,c[2*x+1],R,c[2*u+2*S+1]),x++,S++):C<R?(_(b,c[2*x+1]),x++):(_(R,c[2*u+2*S+1]),S++)}for(;x<T;)_(b,c[2*x+1]),x++;for(;S<A;)_(c[2*u+2*S],c[2*u+2*S+1]),S++}return m}let zRe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?G_t:V_t}write(e,r,i){const n=this._edgeHashFunction(i);lL.seed=n;const s=lL.getIntRange(0,255),o=lL.getIntRange(0,this.settings.variants-1),a=.7,l=lL.getFloat(),c=255*(.5*j_t(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,s),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const PK=new Float32Array(6),lF=new Uint32Array(PK.buffer),f_=new Uint32Array(1);function V_t(t){const e=PK;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],f_[0]=5381;for(let r=0;r<lF.length;r++)f_[0]=31*f_[0]+lF[r];return f_[0]}function G_t(t){const e=PK;e[0]=Qx(t.position0[0]),e[1]=Qx(t.position0[1]),e[2]=Qx(t.position0[2]),e[3]=Qx(t.position1[0]),e[4]=Qx(t.position1[1]),e[5]=Qx(t.position1[2]),f_[0]=5381;for(let r=0;r<lF.length;r++)f_[0]=31*f_[0]+lF[r];return f_[0]}const Che=1e4;function Qx(t){return Math.round(t*Che)/Che}function j_t(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let cF=class{constructor(){this._commonWriter=new zRe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return zW.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),oe(aL,i.faceNormal0,i.faceNormal1),me(aL,aL),e.normal.setVec(r,aL)}trim(e,r){return this._commonWriter.trim(e,r)}};cF.Layout=zW,cF.glLayout=Mc(zW,1);let uF=class{constructor(){this._commonWriter=new zRe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return BW.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};uF.Layout=BW,uF.glLayout=Mc(BW,1);const aL=O(),lL=new FA,Bv=-1;var hF;function H_t(t,e,r,i=Q_t){const n=t.vertices.position,s=t.vertices.componentIndex,o=It(i.anglePlanar),a=It(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=VW.edge,d=u.position0,p=u.position1,m=u.faceNormal0,y=u.faceNormal1,_=Z_t(t),v=Y_t(t),b=v.length/4,x=e.allocate(b);let T=0;const S=b,A=r.allocate(S);let C=0,R=0,P=0;const F=uDe(0,b),k=new Float32Array(b);k.forEach((G,Q,M)=>{n.getVec(v[4*Q],d),n.getVec(v[4*Q+1],p),M[Q]=ci(d,p)}),F.sort((G,Q)=>k[Q]-k[G]);const V=new Array,z=new Array;for(let G=0;G<b;G++){const Q=F[G],M=k[Q],I=v[4*Q],L=v[4*Q+1],B=v[4*Q+2],H=v[4*Q+3],Z=H===Bv;if(n.getVec(I,d),n.getVec(L,p),Z)ne(m,_[3*B],_[3*B+1],_[3*B+2]),re(y,m),u.componentIndex=s.get(I),u.cosAngle=fe(m,y);else{if(ne(m,_[3*B],_[3*B+1],_[3*B+2]),ne(y,_[3*H],_[3*H+1],_[3*H+2]),u.componentIndex=s.get(I),u.cosAngle=fe(m,y),q_t(u,c))continue;u.cosAngle<-.9999&&re(y,m)}R+=M,P++,Z||W_t(u,l)?(e.write(x,T++,u),V.push(M)):X_t(u,o)&&(r.write(A,C++,u),z.push(M))}const X=new Float32Array(V.reverse()),q=new Float32Array(z.reverse());return{regular:{instancesData:e.trim(x,T),lodInfo:{lengths:X}},silhouette:{instancesData:r.trim(A,C),lodInfo:{lengths:q}},averageEdgeLength:R/P}}function W_t(t,e){return t.cosAngle<e}function q_t(t,e){return t.cosAngle>e}function X_t(t,e){const r=As(t.cosAngle),i=VW.fwd,n=VW.ortho;return Qg(i,t.position1,t.position0),r*(fe(ot(n,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function Y_t(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],d=r[3*a],p=r[3*a+1],m=r[3*a+2];n+=l===Bv||d<p?1:0,n+=c===Bv||p<m?1:0,n+=u===Bv||m<d?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],d=r[3*a],p=r[3*a+1],m=r[3*a+2];(l===Bv||d<p)&&(s[o++]=d,s[o++]=p,s[o++]=a,s[o++]=l),(c===Bv||p<m)&&(s[o++]=p,s[o++]=m,s[o++]=a,s[o++]=c),(u===Bv||m<d)&&(s[o++]=m,s[o++]=d,s[o++]=a,s[o++]=u)}return s}function Z_t(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,n=Yz.v0,s=Yz.v1,o=Yz.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],u=i[3*l+1],d=i[3*l+2];r.getVec(c,n),r.getVec(u,s),r.getVec(d,o),ae(s,s,n),ae(o,o,n),ot(n,s,o),me(n,n),a[3*l]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(hF||(hF={}));const VW={edge:{position0:O(),position1:O(),faceNormal0:O(),faceNormal1:O(),componentIndex:0,cosAngle:0},ortho:O(),fwd:O()},Yz={v0:O(),v1:O(),v2:O()},Q_t={anglePlanar:4,angleSignificantEdge:35};function J_t(t){const e=K_t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Ahe.updateSettings(t.writerSettings),Ohe.updateSettings(t.writerSettings),H_t(e,Ahe,Ohe)}function K_t(t,e,r,i){if(e){const o=Ehe(r,i,t.count);return new e1t(r,i,o,t)}const n=YH(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),s=Ehe(n.indices,i,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:aF.createView(n.buffer)}}let e1t=class{constructor(e,r,i,n){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=n}};const Ahe=new cF,Ohe=new uF,X8t=Gi().vec3f(E.POSITION0).vec3f(E.POSITION1),t1t=Gi().vec3f(E.POSITION0).vec3f(E.POSITION1).u16(E.COMPONENTINDEX).u16(E.U16PADDING,{glPadding:!0});let r1t=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},i1t=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new pr;i.samplingMode=At.NEAREST,i.wrapMode=Pt.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new Ct(this._rctx,i),this._data=new ya(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,n,s,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,r,i,n){const s=e*this._fieldCount+r;this._dirty=!0,this._data.set(s,i,n)}getDataElement(e,r,i){const n=e*this._fieldCount+r;return this._dirty=!0,this._data.get(n,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,n=new ya(new ArrayBuffer(4*i));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const BRe=65536;let n1t=class{constructor(e,r=1){this.textureBuffer=new i1t(e,r),this._indexManager=new r1t(BRe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},VRe=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>BRe)return null;const r=new n1t(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const Rhe=J.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let s1t=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new Nt,new Nt],this._renderSubmit=new A_t(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=se("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new VRe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Je(this._objects[eS.Hidden].length===0&&this._objects[eS.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r==null||r.destroy()}createObject(e){const r=new mA;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=mhe(e.obb),r.components=new a_t(this._componentBufferManager,zf(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new f_t(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=wo(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,n=i.renderable.material,s=i.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new R_t,c=o.textureBuffer,u=new Uint8Array(4),d=new Uint32Array(u.buffer);let p=0,m=0,y=0,_=s.verticalOffsets,v=1/0,b=-1/0,x=!1,T=!1,S=0;for(let A=0;A<s.count;A++){r(A,l),p+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===as.Replace&&l.externalColor[3]===1),y+=+l.castShadows,v3e(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[A],0,u[0],u[1],u[2],u[3]),x||(x=A>0&&S!==d[0]),S=d[0],T||(T=l.elevationOffset!==0),T&&_==null&&(_=new Array(A).fill(0)),_!=null&&(_[A]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),IRe(l.elevationOffset,u),c.setData(a[A],1,u[0],u[1],u[2],u[3]);const C=l.objectAndLayerIdColor;C!=null&&c.setData(a[A],2,C[0],C[1],C[2],C[3]),l.pickable!==PRe(s.pickability,A)&&(s.pickability=c_t(s.pickability,s.count,A,l.pickable))}s.verticalOffsets=T?_:null,i.offsetObb=T?n_t(i.obb,v,b,this._viewingMode,i.offsetObb!=null?i.offsetObb:mhe(i.obb)):null,x||T||this._hasObjectAndLayerId?(n.componentParameters=new gA,n.componentParameters.castShadows=Zz(y,s.count),n.componentParameters.transparent=Zz(p,s.count),n.componentParameters.opaqueOverride=Zz(m,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new OO,n.componentParameters.castShadows=l.castShadows?xs.All:xs.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,n=!1){e.intersectionGeometry.getComponentAabb(r,i);const s=e,o=s.components.verticalOffsets;if(n||o==null)return i;const a=o[r];if(this._viewingMode===$e.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=LZe(a);return l.localOrigin=s.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,n,s,o){const a=e;s!=null&&(s.localOrigin=a.transform.position);const l=Vw(Phe,a.transform.rotationScale);Ws(cL,r,a.transform.position),Ws(uL,i,a.transform.position),zo(cL,cL,l),zo(uL,uL,l);const c=Uh(Phe,l);return a.intersectionGeometry.intersect(cL,uL,n,c,s,a.components.verticalOffsets,o)}addEdges(e,r,i,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return r.addComponentObject(e,s.transform,{center:s.obb.center,radius:i_t(s.obb)},a,o,l,i,n)}async extractEdgeInformation(e,r,i){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:t1t.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=aF.createBuffer(a.length/3);iM(c.position.typedBuffer,a,c.position.typedBufferStride,3),dCe(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,d=this._computeVisibilityIndices(o,s,l,u);return{origin:ki(n.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:d,indicesLength:d.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let n=0;for(let s=0;s<i.length-1;s++){const o=i[s],a=i[s+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,r,i,n){if(e&&r.allVisible())return e;let s=0;r.forEachComponentRange((l,c)=>(s+=i[c]-i[l],!0));const o=ap(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],d=i[c];for(let p=u;p<d;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void Rhe.warn("Removing non-existing highlight.");const n=i.highlightCounts[r],s=i.highlightCounts[i.count];if(n!==0){if(n>1)return i.highlightCounts[r]=n-1,void(i.highlightCounts[i.count]=s-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),s===1?i.highlightCounts=null:i.highlightCounts[i.count]=s-1}else Rhe.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[eS.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=Ar.createVertex(i,gr.STATIC_DRAW,n.vertices.data),a=_h(n.indices,_=>Ar.createIndex(i,gr.STATIC_DRAW,_)),l=Mc(O_t(s)),c=new Uint16Array(n.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],b=r.offsets[_+1],x=r.materialDataIndices[_];if(n.indices!=null)for(let T=v;T<b;T++)c[n.indices[T]]=x;else for(let T=v;T<b;T++)c[T]=x}const u=Ar.createVertex(i,gr.STATIC_DRAW,c.buffer),d=new Ds(e.transform,e.toMapSpace),p=new Fh(i,NRe,{data:l,componentIndices:o1t},{data:o,componentIndices:u},a),m=new __t(p,Et.TRIANGLES,s,a!=null),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+u.byteLength+(a!=null?a.byteLength:0)};return new y_t(d,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}};const o1t=Mc(Gi().u16(E.COMPONENTINDEX));function Zz(t,e){return t===e?xs.All:t===0?xs.None:xs.Some}const Phe=Pl(),cL=O(),uL=O();let GRe=class extends Wr{constructor(){super(...arguments),this.scale=Ne()}};function a1t(t){const e=new mr;e.attributes.add(E.POSITION,"vec2"),e.varyings.add("uv0","vec2"),e.varyings.add("uv1","vec2"),e.vertex.uniforms.add(new yr("scale",i=>i.scale)),e.vertex.code.add(w`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),e.fragment.uniforms.add(new Ye("tex",i=>i.texture),new Ye("depthTexture",i=>i.depthTexture),new yr("scale",i=>i.scale),new yr("clampUV",i=>l1t(i)));const r=t.haze;return e.fragment.code.add(w`
    void main() {
      ${r?w`vec4`:w`float`} depthSample = texture(depthTexture, uv0) ${r?"":w`.r`};
      if (depthSample ${r?w`== vec4(0)`:w`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),e}function l1t(t){if(!t.texture)return Mhe;const e=er(Mhe,t.texture.descriptor.width,t.texture.descriptor.height),r=UZ(e,e,t.scale),i=Wwe(r,r);return Zwe(i,t.scale,i)}const Mhe=Ne(),c1t=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:GRe,build:a1t},Symbol.toStringTag,{value:"Module"}));let jRe=class HRe extends Tr{initializeProgram(e){return new vr(e.rctx,HRe.shader.get().build(this.configuration),fr)}initializePipeline(){return this.configuration.haze?Ot({blending:So(ve.ONE,ve.ZERO,ve.ONE_MINUS_SRC_COLOR,ve.ONE),depthTest:{func:Hr.ALWAYS},colorWrite:Ft}):Ot({blending:Cc(ve.SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),depthTest:{func:Hr.ALWAYS},colorWrite:Ft})}};jRe.shader=new _r(c1t,()=>ce(()=>import("./AtmosphereCompositing.glsl-69a14b5e.js"),[]));let WRe=class extends Wr{constructor(){super(...arguments),this.opacity=1}};function u1t(t){const e=new mr;return e.include(Vh),e.fragment.uniforms.add(new Ye("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ce("opacity",r=>r.opacity)),e.fragment.code.add(w`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const h1t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:WRe,build:u1t},Symbol.toStringTag,{value:"Module"}));var ca;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(ca||(ca={}));let GW=class extends va{constructor(){super(...arguments),this.alphaMode=ca.None,this.hasOpacityFactor=!1}};h([U({count:ca.COUNT})],GW.prototype,"alphaMode",void 0),h([U()],GW.prototype,"hasOpacityFactor",void 0);let qRe=class XRe extends Tr{initializeProgram(e){return new vr(e.rctx,XRe.shader.get().build(this.configuration),fr)}initializePipeline(){switch(this.configuration.alphaMode){case ca.None:return Ot({colorWrite:Ft});case ca.Alpha:return Ot({blending:So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft});case ca.PremultipliedAlpha:case ca.COUNT:return Ot({blending:Cc(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}}};qRe.shader=new _r(h1t,()=>ce(()=>import("./Compositing.glsl-2c5c8d4d.js"),[]));let YRe=class extends Wr{};function d1t(){const t=new mr;return t.include(Vh),t.fragment.uniforms.add(new Ye("tex",e=>e.texture)),t.fragment.code.add(w`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const p1t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:YRe,build:d1t},Symbol.toStringTag,{value:"Module"}));let ZRe=class QRe extends Tr{initializeProgram(e){return new vr(e.rctx,QRe.shader.get().build(),fr)}initializePipeline(){return Ot({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};ZRe.shader=new _r(p1t,()=>ce(()=>import("./HUDCompositing.glsl-67260826.js"),[]));let JRe=class extends Wr{};function f1t(){const t=new mr;return t.include(Vh),t.fragment.uniforms.add(new Ye("colorTexture",e=>e.colorTexture),new Ye("alphaTexture",e=>e.alphaTexture),new Ye("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(w`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const m1t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:JRe,build:f1t},Symbol.toStringTag,{value:"Module"}));let KRe=class ePe extends Tr{initializeProgram(e){return new vr(e.rctx,ePe.shader.get().build(),fr)}initializePipeline(){return Ot({blending:So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};KRe.shader=new _r(m1t,()=>ce(()=>import("./OITCompositing.glsl-858510ff.js"),[]));let tPe=class extends Wr{constructor(){super(...arguments),this.overlayIndex=Oi.INNER,this.opacity=1}};function g1t(){const t=new mr;return t.include(Vh),t.fragment.uniforms.add(new Ye("tex",e=>e.texture)),t.fragment.uniforms.add(new QP("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ce("opacity",e=>e.opacity)),t.fragment.code.add(w`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const y1t=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:tPe,build:g1t},Symbol.toStringTag,{value:"Module"}));let rPe=class iPe extends Tr{initializeProgram(e){return new vr(e.rctx,iPe.shader.get().build(),fr)}initializePipeline(){return Ot({blending:Cc(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};rPe.shader=new _r(y1t,()=>ce(()=>import("./OverlayCompositing.glsl-cf0d34dd.js"),[]));let _1t=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new GW,this._atmosphereConfiguration=new t5,this._passParameters=new WRe,this._atmosphereParameters=new GRe,this._oitParameters=new JRe,this._hudParameters=new YRe,this._overlayParameters=new tPe}destroy(){this._vao=Le(this._vao)}compositeOIT(e,r,i,n){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=n;const s=this._rctx,o=this._techniqueRepository.acquire(KRe);s.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Et.TRIANGLE_STRIP,0,No(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,n=this._techniqueRepository.acquire(ZRe);i.bindTechnique(n,this._hudParameters,e);const s=this._ensureVAO();i.bindVAO(s),i.drawArrays(Et.TRIANGLE_STRIP,0,No(s,"geometry")),n.release()}compositeOverlay(e,r,i,n){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=n;const s=this._rctx,o=this._techniqueRepository.acquire(rPe);s.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Et.TRIANGLE_STRIP,0,No(a,"geometry")),o.release()}compositeAtmosphere(e,r,i,n,s){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTexture=i,this._atmosphereParameters.scale=n,this._atmosphereConfiguration.haze=s;const a=this._techniqueRepository.acquire(jRe,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Et.TRIANGLE_STRIP,0,No(l,"geometry")),a.release()}composite(e,r,i=ca.None,n=1){const s=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=r,this._passParameters.opacity=n;const o=this._techniqueRepository.acquire(qRe,this._configuration);s.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Et.TRIANGLE_STRIP,0,No(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=Dl(this._rctx)),this._vao}};const v1t=1e4,jW=100,b1t=500,w1t=500,x1t=.1;function T1t(t,e,r){return rJ(e,t)*(r[1]-r[0])+r[0]}function S1t(t,e,r){let i=0;if(!e.some(s=>(i+=s.numGeometries,i>=v1t)))return $1t.compute(t,e);const n=nM();return r.forAll(s=>{s.visible&&iE(n,E1t(t,s))}),n}function E1t(t,e){if(!e.visible)return;const r=nM(),i=e.getSpatialQueryAccelerator();return i!=null?C1t(r,t,i):A1t(r,t,e.objects),r}function C1t(t,e,r){const i=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<b1t)WR(ih,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,n,Xd.DepthOrder.FRONT_TO_BACK,ih,(l,c)=>{HW(t,e,l),ih.far=t.near,c.setRange(ih)},s,o),WR(ih,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,n,Xd.DepthOrder.BACK_TO_FRONT,ih,(l,c)=>{HW(t,e,l),ih.near=t.far,c.setRange(ih)},s,o);else{const l=Math.max(Math.min(a,w1t),Math.ceil(a*x1t)),c=r.findClosest(n,Xd.DepthOrder.FRONT_TO_BACK,s,o,l),u=r.findClosest(n,Xd.DepthOrder.BACK_TO_FRONT,s,o,l);c&&u&&($he(t,e,c.boundingVolumeWorldSpace.bounds),$he(t,e,u.boundingVolumeWorldSpace.bounds))}}function A1t(t,e,r){Jx.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&Jx.add(i)}),Jx.empty||(Jx.sort(e),WR(ih,e.near,Math.min(t.near,e.far)),Jx.forEachInDepthRange(ih,Xd.DepthOrder.FRONT_TO_BACK,(i,n)=>{n<t.near&&HW(t,e,i)}),WR(ih,Math.max(t.far,e.near),e.far),Jx.forEachInDepthRange(ih,Xd.DepthOrder.BACK_TO_FRONT,(i,n,s)=>{t.far=Math.max(t.far,s)}))}function HW(t,e,r){if(!r.visible||!h_(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=M1t;r.geometries.forEach(s=>{Vr(n,i,s.shaderTransformation);const o=MS(n);nPe(t,e,s.boundingInfo,n,o)})}function nPe(t,e,r,i,n){if(r==null)return;De(Ba,r.center,i);const{eye:s,viewForward:o}=e,a=o[0]*(Ba[0]-s[0])+o[1]*(Ba[1]-s[1])+o[2]*(Ba[2]-s[2]);if(Ba[3]=r.radius*n,!(a-Ba[3]>t.near&&a+Ba[3]<t.far)&&h_(e.frustum,Ba))if(r.radius>jW&&r.getChildren())for(const l of r.getChildren())nPe(t,e,l,i,n);else WW.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function $he(t,e,r){const i=e.eye,n=e.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];t.near=Math.min(t.near,s-r[3]),t.far=Math.max(t.far,s+r[3])}let O1t=class{constructor(){this._items=new Nt({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(n=>{const s=n.obj.boundingVolumeWorldSpace.bounds,o=(s[0]-r[0])*i[0]+(s[1]-r[1])*i[1]+(s[2]-r[2])*i[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,r,i){if(r===Xd.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.obj,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.obj,s.near,s.far)}}},R1t=class{constructor(){this._view=_e(),this._viewProj=_e(),this._frustum=TR(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),In(this._view,e.viewMatrix),Vr(this._viewProj,e.projectionMatrix,this._view),s5(this._frustum,e.frustum);const i=this._view,n=i[2],s=i[6],o=i[10],a=i[14];r.forAll(p=>p.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const y=m.boundingSphere,_=n*y[0]+s*y[1]+o*y[2]+a,v=_-y[3],b=_+y[3];this._geometries.push(m),this._near.push(-b),this._far.push(-v)}));const l=new v_t;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,d=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[d++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,m)=>this._near[p]<this._near[m]?-1:this._near[p]>this._near[m]?1:0),this._farCandidates.sort((p,m)=>this._far[p]<this._far[m]?1:this._far[p]>this._far[m]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const m=this._nearCandidates[p];if(this._near[m]<l.near){const y=this._geometries[m],_=y.boundingInfo;this._includeNearBoundingInfoRec(_,y.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const m=this._farCandidates[p];if(this._far[m]>l.far){const y=this._geometries[m],_=y.boundingInfo;this._includeFarBoundingInfoRec(_,y.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const n=e.center;De(Ba,n,r);const s=MS(r),o=Ba[0],a=Ba[1],l=Ba[2],c=e.radius*s,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=d+c;if(!(-(d-c)<2||-p>=i.near))if(-p>this._looseRange.near)i.near=-p;else{if(c>jW){const m=e.getChildren();if(m!==void 0){for(const y of m)this._includeNearBoundingInfoRec(y,r,i);return}}WW.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let n=e.radius;const s=e.center;De(Ba,s,r);const o=MS(r),a=Ba[0],l=Ba[1],c=Ba[2];n*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>n||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>n||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>n||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>n)return;const d=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-d<=i.far))if(-d<this._looseRange.far)i.far=-d;else{if(n>jW){const p=e.getChildren();if(p!==void 0){for(const m of p)this._includeFarBoundingInfoRec(m,r,i);return}}WW.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},P1t=class{constructor(){this._modelViewProj=_e(),this._clipPosition=[Qt(),Qt(),Qt(),Qt(),Qt(),Qt(),Qt(),Qt()]}unionDepthRangeWithAABB(e,r,i,n,s){const o=this._modelViewProj;Vr(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?n[0]:s[0],d=l===0||l===1||l===4||l===5?n[1]:s[1],p=l<4?n[2]:s[2];c[0]=o[0]*u+o[4]*d+o[8]*p+o[12],c[1]=o[1]*u+o[5]*d+o[9]*p+o[13],c[2]=o[2]*u+o[6]*d+o[10]*p+o[14],c[3]=o[3]*u+o[7]*d+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[Qz[l][0]],u=this._clipPosition[Qz[l][1]],d=this._clipPosition[Qz[l][2]],p=this._clipTriangle(c,u,d);let m=!0;for(let y=0;y<p.length;++y)if(p[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<p.length;++y){const _=p[y][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void Je(!1)}_intersect(e,r,i){let n=0;return i===0?n=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?n=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?n=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(n=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),dY(Qt(),e,r,n)}_clipTriangle(e,r,i){let n=[e,r,i];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const Qz=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Ba=vn(),M1t=_e(),ih=nM(),Jx=new O1t,$1t=new R1t,WW=new P1t;let I1t=class{},L1t=class extends Wr{constructor(){super(...arguments),this.textures=new I1t}};function D1t(){const t=new mr;return t.attributes.add(E.POSITION,"vec2"),t.vertex.uniforms.add(new Jt("drawPosition",(e,r)=>N1t(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(w`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Ye("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Ye("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Ye("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new kf("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new kf("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(w`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function N1t(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,n=t.magnifier.offset.y*r;wf(t.magnifier.position,Ihe);const s=e.camera.screenToRender(Ihe,F1t),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return gi(U1t,(s[0]+i)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const Ihe=Xi(),F1t=f1e(),U1t=Qt();async function k1t(t){const e=ce(()=>import("./mask-svg-023bbc42.js"),[]),r=ce(()=>import("./overlay-svg-d62383f3.js"),[]),i=qg((await e).default,{signal:t}),n=qg((await r).default,{signal:t}),s={mask:await i,overlay:await n};return Bt(t),s}let D2=class extends xe{constructor(){super(...arguments),this._handles=new Vi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new L1t,this.events=new Bn,this.attributeLocations=new Map([[E.POSITION,0]]),this._tmpScreenPoint=Xi(),this._tmpRenderPoint=f1e()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(ue(()=>_h(this._magnifier,i=>i.version),r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const n=r.camera.pixelRatio,s=Math.ceil(n*i.size);if(this._updateResources(e,s),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),wf(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,u=r.camera.fullHeight,d=.5*a,p=.5*a;l[0]=ge(l[0],d,c-d-1),l[1]=ge(l[1],p,u-p-1);const m=Math.floor(l[0]-d),y=Math.floor(l[1]-p),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Et.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:hE(async n=>{const s=r==null||i==null?k1t(n):null,o=r!=null?qg(r,{signal:n}):s.then(l=>l.mask),a=i!=null?qg(i,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const n=this._createTextureResources(e,r);if(n==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:Dl(e,GZ,this.attributeLocations,0,1),pipelineState:Ot({blending:Cc(ve.ONE,ve.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Ft})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new pr;i.internalFormat=Tt.RGBA,i.wrapMode=Pt.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!_0e(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const n=new Ct(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=Tt.ALPHA,i.preMultiplyAlpha=!1;const s=new Ct(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=Tt.RGBA,i.flipped=!1,{input:new Ct(e,i),mask:s,overlay:n,size:r}}_createProgram(e){return new vr(e,D1t(),this.attributeLocations)}};h([f()],D2.prototype,"_imageSources",void 0),h([f()],D2.prototype,"_imageLoadTask",void 0),h([f({readOnly:!0})],D2.prototype,"updating",null),D2=h([N("esri/views/3d/webgl-engine/lib/MagnifierHelper")],D2);let z1t=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new ya(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,n,s,o=null,a=null,l=null){if(!(e&&r&&i&&n)||(this._layerUidToId.set(n,i),this._layerUidToPopupEnabled.set(n,s),!s))return;let c=this._layerUidToGraphicsUidToObjectId.get(n);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(n,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return $t(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return J.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let n=i.get(e.graphicUid);if(!n){for(;!n;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new ya(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let s=null;n?(s=n.get(i.graphicUid),s||J.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):J.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||J.getLogger(this).warn("no layerId found for uid "+i.layerUid),s&&o&&e.set(r,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:o,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:o})}return e}};var qR;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(qR||(qR={}));let X0=class{constructor(e,r,i=qR.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Nt({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,n){const s=this._draws.pushNew();s.geometry=r,s.geometryRanges=i,s.material=e,s.depthSquaredHint=n,s.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===s&&l.configuration.transparencyPassType===rt.NONE||(n.bindTechnique(l,e,r),s=l);const c=this._draws.data[a],u=c.geometry;n.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const d=c.geometryRanges,p=d.length;if(c.indexType!==0){const m=hN.get(c.indexType);for(let y=0;y<p;y+=2){const _=d[y],v=d[y+1];n.drawElements(u.primitiveType,v,c.indexType,_*m)}}else for(let m=0;m<p;m+=2){const y=d[m],_=d[m+1];n.drawArrays(u.primitiveType,y,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===qR.FrontToBack?1:-1;this._draws.sort((r,i)=>{const n=e*(r.depthSquaredHint-i.depthSquaredHint);return n!==0?n:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const hN=new Map;hN.set(Qe.UNSIGNED_BYTE,1),hN.set(Qe.UNSIGNED_SHORT,2),hN.set(Qe.UNSIGNED_INT,4);let B1t=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new Zgt,this._shadowPassParameters=new Qgt,this._highlightPassParameters=new Jgt,this._systems=new Set,this._passes={materialOpaque:new X0(e,r),materialTransparent:new X0(e,r,qR.BackToFront),materialIntegratedMesh:new X0(e,r),shadowMap:new X0(e,r),highlight:new X0(e,r),highlightIntegratedMesh:new X0(e,r),highlightShadowMap:new X0(e,r),defaultShadowMap:new X0(e,r)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(r,i)=>r.prepare(i,e.bindParameters)))}render(e,r){this._invoke(e,(i,n)=>i.dispatch(n,e.bindParameters,r))}_invoke(e,r){switch(e.bindParameters.slot){case le.OPAQUE_MATERIAL:switch(e.output){case D.Color:case D.Depth:case D.Normal:case D.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case D.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case D.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case D.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case D.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case le.TRANSPARENT_MATERIAL:switch(e.output){case D.Color:case D.Alpha:case D.Depth:case D.Normal:case D.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case le.INTEGRATED_MESH:switch(e.output){case D.Color:case D.Depth:case D.Normal:case D.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case D.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[le.OPAQUE_MATERIAL,le.TRANSPARENT_MATERIAL,le.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const n=i.queryShadowCasterDepthRange(e);n!=null&&iE(r,n,r)}),r}_configure(e){const r=e.output===D.Shadow||e.output===D.ShadowHighlight||e.output===D.ShadowExcludeHighlight?this._shadowPassParameters:e.output===D.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,n=i.viewInverseTransposeMatrix;ne(Jz,n[3],n[7],n[11]),Kz.set(Jz),re(r.transformWorldFromViewTH,Kz.high),re(r.transformWorldFromViewTL,Kz.low),re(r.slicePlaneLocalOrigin,Jz),Ac(r.transformViewFromCameraRelativeRS,i.viewMatrix),In(r.transformProjFromView,i.projectionMatrix),r.identifier===pc.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===le.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===le.INTEGRATED_MESH,Uh(Lhe,r.transformViewFromCameraRelativeRS),Vw(r.transformNormalViewFromGlobal,Lhe))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const Jz=O(),Lhe=hi(),Kz=new sU;let V1t=class{constructor(){this._step=Fhe,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,se("disable-feature:high-quality-idle"))this._dilation=1;else{const n=r?performance.now()-this._firstIdleTime:0;if(n>=Dhe+j1t)return this._step=1/0,void(this._dilation=1);this._dilation=n>=Dhe?H1t:1}const i=ge(e/G1t,Fhe,q1t);this._step===1/0?this._step=i:this._step=this._step*Nhe+i*(1-Nhe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const G1t=.5,Dhe=12e4,j1t=1e4,H1t=10,Nhe=.9,W1t=30,Fhe=1e3/1,q1t=1e3/W1t,X1t=8.6,Y1t=.4;function Z1t(){const t=new mr,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(E.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(E.UV0,"vec2"),e.uniforms.add(new Ye("coverageTex",s=>s.coverageTexture)),i.add(w`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Ye("tex",s=>s.blurColorTexture),new Ye("origin",s=>s.highlightColorTexture),new Jt("uColor",s=>s.color),new Jt("haloColor",s=>s.haloColor),new Jt("opacities",s=>gi(Q1t,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),r.constants.add("outlineSize","float",X1t),r.constants.add("blurSize","float",Y1t),n.add(w`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const Q1t=Qt(),J1t=Object.freeze(Object.defineProperty({__proto__:null,build:Z1t},Symbol.toStringTag,{value:"Module"}));let sPe=class oPe extends Tr{initializeProgram(e){return new vr(e.rctx,oPe.shader.get().build(),fr)}initializePipeline(){return Ot({blending:So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft})}};sPe.shader=new _r(J1t,()=>ce(()=>import("./HighlightApply.glsl-d2c44603.js"),[]));let aPe=class extends Wr{constructor(){super(...arguments),this.blurSize=Ne()}};function K1t(){const t=new mr,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(E.POSITION,"vec2"),t.attributes.add(E.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Ye("coverageTex",s=>s.coverageTexture)),r.uniforms.add(new FJ("blurSize",s=>s.blurSize)),i.add(w`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new Eh("tex",s=>s.blurInputTexture)),n.add(w`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const evt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:aPe,build:K1t},Symbol.toStringTag,{value:"Module"}));let lPe=class cPe extends Tr{initializeProgram(e){return new vr(e.rctx,cPe.shader.get().build(),fr)}initializePipeline(){return Ot({colorWrite:Ft})}};lPe.shader=new _r(evt,()=>ce(()=>import("./HighlightBlur.glsl-8389b4e8.js"),[]));let uPe=class extends Wr{constructor(){super(...arguments),this.invFramebufferDim=Ne()}};function tvt(){const t=new mr,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(E.POSITION,"vec2"),i.add(w`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new Eh("tex",s=>s.inputTexture)),r.uniforms.add(new FJ("invFramebufferDim",s=>s.invFramebufferDim)),n.add(w`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const rvt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:uPe,build:tvt},Symbol.toStringTag,{value:"Module"}));let hPe=class dPe extends Tr{initializeProgram(e){return new vr(e.rctx,dPe.shader.get().build(),fr)}initializePipeline(){return Ot({colorWrite:Ft})}};hPe.shader=new _r(rvt,()=>ce(()=>import("./HighlightDownsample.glsl-b1b35495.js"),[]));let Uhe=class extends Wr{constructor(){super(...arguments),this.color=rm(1,0,1,1),this.haloColor=rm(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=$t(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const ivt=32;let nvt=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=Qt(),this._passParameters=new Uhe,this._downsampleDrawParameters=new uPe,this._blurDrawParameters=new aPe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Dl(this._rctx);const e=new pr;e.wrapMode=Pt.CLAMP_TO_EDGE,this._blur0Fbo=new hs(this._rctx,e),this._blur1Fbo=new hs(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire(lPe),this._downsampleTechnique=this._techniqueRep.acquire(hPe),this._applyTechnique=this._techniqueRep.acquire(sPe)}dispose(){if(this._blurTechnique=Fi(this._blurTechnique),this._downsampleTechnique=Fi(this._downsampleTechnique),this._applyTechnique=Fi(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=Le(this._blur0Fbo),this._blur1Fbo=Le(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new Uhe,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const n=e.camera;vh(this._viewportToRestore,n.fullViewport);const s=n.fullWidth,o=n.fullHeight,a=n.pixelRatio,l=Math.ceil(s/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const u=this._rctx;u.bindVAO(this._quadVAO);let d=null;this._gridUpdateResources(r,ivt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,d=this._grid.vao;const p=u.bindTechnique(this._blurTechnique,this._passParameters,e);u.bindVAO(d),u.bindFramebuffer(this._blur0Fbo),u.setViewport(0,0,l,c),u.setClearColor(0,0,0,0),u.clear(yi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,er(this._blurDrawParameters.blurSize,1/l,0),p.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,No(d,"geometry")),u.bindFramebuffer(this._blur1Fbo),u.clear(yi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,er(this._blurDrawParameters.blurSize,0,1/c),p.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,No(d,"geometry")),u.bindFramebuffer(i),u.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,u.bindTechnique(this._applyTechnique,this._passParameters,e),u.drawArrays(this._applyTechnique.primitiveType,0,No(d,"geometry")),u.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,n=this._grid;let s=!1;if(n.coverageMipmap===null&&(n.coverageMipmap=[e],s=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(s=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==r&&(n.cellPixelSize=r,s=!0),s){for(let l=1;l<n.coverageMipmap.length;l++)n.coverageMipmap[l].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(let l=0;l<n.mipmapLevels;l++){const c=n.coverageMipmap[l],u=new pr(Math.ceil(c.width/2),Math.ceil(c.height/2));u.pixelFormat=Tt.RGB,u.dataType=Un.UNSIGNED_SHORT_5_6_5,u.wrapMode=Pt.CLAMP_TO_EDGE,n.coverageMipmap[l+1]=new hs(i,u)}}const o=Math.ceil(e.height/n.cellPixelSize),a=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==o||n.horizontalCellCount!==a){n.verticalCellCount=o,n.horizontalCellCount=a;const l=o+1,c=a+1,u=1/o,d=1/a,p=6,m=4,y=new Float32Array(p*m*l*c);let _=0;for(let v=0;v<l;v++)for(let b=0;b<c;b++)y[_]=(b-.5)*d*2-1,y[_+1]=(v-.5)*u*2-1,y[_+2]=b*d,y[_+3]=v*u,y[_+4]=(b+.5)*d*2-1,y[_+5]=(v-.5)*u*2-1,y[_+6]=b*d,y[_+7]=v*u,y[_+8]=(b-.5)*d*2-1,y[_+9]=(v+.5)*u*2-1,y[_+10]=b*d,y[_+11]=v*u,y[_+12]=(b-.5)*d*2-1,y[_+13]=(v+.5)*u*2-1,y[_+14]=b*d,y[_+15]=v*u,y[_+16]=(b+.5)*d*2-1,y[_+17]=(v-.5)*u*2-1,y[_+18]=b*d,y[_+19]=v*u,y[_+20]=(b+.5)*d*2-1,y[_+21]=(v+.5)*u*2-1,y[_+22]=b*d,y[_+23]=v*u,_+=p*m;n.vao&&n.vao.dispose(),n.vao=new vp(i,fr,{geometry:$P},{geometry:Ar.createVertex(i,gr.STATIC_DRAW,y)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,n=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let s=0;s<i.mipmapLevels;s++){r.bindFramebuffer(i.coverageMipmap[s+1]);const o=i.coverageMipmap[s+1].width,a=i.coverageMipmap[s+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[s].colorTexture,er(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),n.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(Et.TRIANGLE_STRIP,0,No(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const svt={dataType:Un.UNSIGNED_BYTE,internalFormat:Tt.RGBA},ovt={};let avt=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._fbos.forEach((n,s)=>{n.colorTexture!==i&&n.depthStencilAttachment!==i||(n.detachColorTexture(),n.detachDepthStencilTexture(),n.dispose(),this._fbos.delete(s))}),i.dispose(),e.delete(r))}_getDepthTexture(e,r,i){let n=this._depthTextures.get(e.id);if(!n||n.descriptor.width===r&&n.descriptor.height===i||(n.dispose(),n=null),!n){const s=new pr(r,i);s.pixelFormat=Tt.DEPTH_STENCIL,s.dataType=Un.UNSIGNED_INT_24_8,s.samplingMode=At.NEAREST,s.wrapMode=Pt.CLAMP_TO_EDGE,n=new Ct(this._rctx,s),this._depthTextures.set(e.id,n),this._activeTargets.add(e.id)}return n}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,r,i){let n=this._colorTextures.get(e.id);if(n&&(n.descriptor.width===r&&n.descriptor.height===i||(n.dispose(),n=lE())),!n){const s=new pr(r,i);s.internalFormat=e.internalFormat,s.dataType=e.dataType,s.samplingMode=e.samplingMode!=null?e.samplingMode:At.LINEAR,s.wrapMode=Pt.CLAMP_TO_EDGE,n=new Ct(this._rctx,s),this._colorTextures.set(e.id,n),this._activeTargets.add(e.id)}return n}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:wc(),...ovt,...e}}registerColorTarget(e={}){return{id:wc(),...svt,...e}}getFramebuffer(e,r,i,n){const s=this._getKey(i,n);let o=this._fbos.get(s);const a=this.getColorTexture(i,e,r),l=n?this._getDepthTexture(n,e,r):void 0;return o?((o.width!==e||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new hs(this._rctx,a,l),this._fbos.set(s,o),o)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=n=>{r.has(n)||(r.add(n),e+=n.gpuMemoryUsage)};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),e}},lvt=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new avt(e);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=i.registerColorTarget({name:"colorFloatTarget",dataType:Un.HALF_FLOAT,internalFormat:qe.RGBA16F,samplingMode:At.NEAREST}),this.alphaFloatTarget=i.registerColorTarget({name:"alphaFloatTarget",dataType:Un.HALF_FLOAT,internalFormat:qe.R16F,samplingMode:At.NEAREST}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:At.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:qe.RGBA4,dataType:Un.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:qe.RGBA4,dataType:Un.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const r=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,_b(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(yi.COLOR_BUFFER_BIT|yi.DEPTH_BUFFER_BIT|yi.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,ca.None)}renderTmpAndCompositeToMain(e,r,i,n=!1){this.renderToTargets(e,this.tmpColor,n?this.tmpDepth:this.mainDepth,cvt),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(e,r,i,n){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,n,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,uvt)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let n,s;switch(r){case rt.Color:n=this.colorFloatTarget,s=[0,0,0,0];break;case rt.Alpha:n=this.alphaFloatTarget,s=[1,1,1,1];break;case rt.FrontFace:n=this.frontFaceTarget,s=[0,0,0,0];break;case rt.NONE:case rt.COUNT:return}i?this.renderToTargets(e,n,this.tmpDepth,s,!0,!0):this.renderToTargets(e,n,this.mainDepth,s,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ca.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),ca.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(yi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,n=!1){const s=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);s.setClearColor(r[0],r[1],r[2],l),o|=yi.COLOR_BUFFER_BIT}i&&(o|=yi.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),o|=yi.STENCIL_BUFFER_BIT),o&&s.clearSafe(o,n),e(),s.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,n,s=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,n,s,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const cvt=[0,0,0,0],uvt=[0,1,0,1];let yA=class extends xe{constructor(e){super({}),this._context=e,this._renderPlugins=new Nt,this._slots=[];for(let r=0;r<le.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r,i){const n=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),wr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},s=r.initializeRenderContext(this._context,i);if(Eu(s))return s.then(n);n(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}prepareSlots(e){for(const r of e)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(i=>{i.canRender&&(khe(i)&&i.prepareTechnique(this._context.renderContext),zhe(i)&&i.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(khe(i)){const n=i.prepareTechnique(this._context.renderContext);return n!=null&&(r.push(n),!0)}if(zhe(i)){const n=i.prepareTechniques(this._context.renderContext);return n!=null&&(r.push(n),!0)}return r.push(null),!0}).forEach((i,n)=>i.render(this._context.renderContext,r[n]))}queryDepthRange(e){const r=hvt;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const n=i.queryDepthRange(e);n&&iE(r,n,r)}}),r}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[le.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,Ri.None)}};function khe(t){return"prepareTechnique"in t}function zhe(t){return"prepareTechniques"in t}h([f()],yA.prototype,"_renderPlugins",void 0),h([f({readOnly:!0})],yA.prototype,"updating",null),yA=h([N("esri.views.3d.webgl-engine.lib.RenderPluginManager")],yA);const hvt={near:0,far:0};let pPe=class extends LJ{};const oU=255,dvt=1/oU;function pvt(t){const e=new mr,r=e.fragment;return r.include(Pc),r.include(wu),e.include(k8),e.include(Vh),e.include(U8,t),r.uniforms.add(new Ye("depthMap",i=>i.linearDepthTexture),new Mi("inverseViewMatrix",(i,n)=>us(Bhe,Ml(Bhe,n.camera.viewMatrix,n.camera.center))),new yr("nearFar",(i,n)=>n.camera.nearFar)),r.constants.add("sampleValue","float",dvt),r.code.add(w`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const Bhe=_e(),fvt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:pPe,ShadowCastMaxSamples:oU,build:pvt},Symbol.toStringTag,{value:"Module"}));var Ew;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(Ew||(Ew={}));let qW=class extends va{constructor(){super(...arguments),this.visualization=Ew.Gradient,this.bandsEnabled=!1}};h([U({count:Ew.COUNT})],qW.prototype,"visualization",void 0),h([U()],qW.prototype,"bandsEnabled",void 0);let fPe=class extends Wr{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=PP(mvt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const mvt=$t(.01,0,.25,1);function gvt(t){const e=new mr,r=e.fragment;r.include(Pc),r.include(wu),e.include(k8),e.include(Vh);const{visualization:i,bandsEnabled:n}=t;r.constants.add("inverseSampleValue","float",oU),r.uniforms.add(new Ye("shadowCastMap",a=>a.shadowCastMap),new Ce("sampleScale",a=>a.sampleScale),new Ce("opacityFromElevation",a=>a.opacityFromElevation),new Jt("uColor",a=>a.color));const s=i===Ew.Gradient,o=i===Ew.Threshold;return s&&n?r.uniforms.add(new Ce("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Ce("threshold",a=>a.threshold)),r.code.add(w`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?w`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?w`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?w`* strength`:""});
      }
    `),e}const yvt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:fPe,build:gvt},Symbol.toStringTag,{value:"Module"}));let mPe=class gPe extends Tr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,gPe.shader.get().build(this.configuration),fr)}initializePipeline(){return Ot({blending:fu,colorWrite:Ft,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};mPe.shader=new _r(yvt,()=>ce(()=>import("./ShadowCastVisualize.glsl-2c61efe0.js"),[]));const _vt=4e4,vvt=5e4,yPe=1/512;let dN=class extends xe{constructor(e,r,i,n){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=n,this._passParameters=new fPe(this._data),this._techniqueConfig=new qW,this._enabled=!1,this._vao=Dl(r),this._techniqueConfig.visualization=Ew.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Le(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(mPe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,No(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>yPe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;LT(e,r)||(vh(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([f()],dN.prototype,"opacityFromElevation",null),dN=h([N("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],dN);let MK=class extends va{constructor(){super(...arguments),this.receiveShadows=!0}};h([U()],MK.prototype,"receiveShadows",void 0);let _Pe=class vPe extends Tr{constructor(e){super(e,new MK,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,vPe.shader.get().build(this.configuration),fr)}initializePipeline(){return Ot({blending:So(ve.ONE,ve.ONE,ve.ONE,ve.ONE),colorWrite:Ft,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};_Pe.shader=new _r(fvt,()=>ce(()=>import("./ShadowCastAccumulate.glsl-15b89038.js"),[]));let gl=class extends xe{constructor(e,r,i,n,s,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new pPe,this._cachedLightDirections=[],this._depthRange=kW,this._previewing=!1,this._handles=new Vi,this._cameraForcedForScreenshot=!1,this._bindParameters=new e8(new $J(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Dl(e),this._accumulationRenderer=new dN(r,e,this,o);const a=this._stage.view.resourceController.scheduler;this._handles.add([a.registerTask(dt.SHADOW_ACCUMULATOR,this),ue(()=>i.renderView,l=>{this._handles.remove(Vhe),l!=null&&this._handles.add(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Vhe)},An),ue(()=>this._previewing,()=>this._requestRenderIfEnabled(),Br)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=Le(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Le(this._fbo),this._vao=Le(this._vao),this._accumulationTechniqueCached=Fi(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new _Pe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==kW&&this._opacityFromElevation>yPe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(Hf(r,e,N_))return;const i=Math.min(oU,e.length);r.length=i,this._sampleCount=i;for(let n=0;n<i;++n)r[n]=re(r[n]??O(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,n){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=n,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(bvt,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Tt.RGBA,Un.UNSIGNED_BYTE,Ghe),Ghe[0]/this._progress)}_enable(){this._progress=0;const e=new pr;e.wrapMode=Pt.CLAMP_TO_EDGE,this._fbo=new hs(this._rctx,e)}_disable(){this._fbo=Le(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(yi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,No(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*wvt%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-nR(_vt,vvt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};h([f()],gl.prototype,"_progress",void 0),h([f()],gl.prototype,"_sampleCount",void 0),h([f()],gl.prototype,"_fbo",void 0),h([f()],gl.prototype,"_depthRange",void 0),h([f()],gl.prototype,"_previewing",void 0),h([f()],gl.prototype,"_accumulationRenderer",void 0),h([f()],gl.prototype,"_isRefining",null),h([f()],gl.prototype,"_isActive",null),h([f()],gl.prototype,"canAccumulate",null),h([f()],gl.prototype,"_isDoneAccumulating",null),h([f()],gl.prototype,"_opacityFromElevation",null),h([f()],gl.prototype,"running",null),gl=h([N("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],gl);const bvt=6,Vhe="renderView",wvt=104729,Ghe=new Uint8Array(4),jhe={highlightedThreshold:.99999,selfShadowThreshold:.025};function xvt(t){const e=new mr;e.include(vw,t);const r=e.fragment;return r.include(Pc),r.include(wu),e.include(k8),e.include(Vh),r.uniforms.add(new Ye("defaultDepthTex",(i,n)=>n.shadowMap.getSnapshot(JS.Default)),new Ye("highlightDepthTex",(i,n)=>n.shadowMap.getSnapshot(JS.Highlight)),new Ye("depthMap",(i,n)=>n.linearDepthTexture),new Ye("highlightMap",(i,n)=>n.highlightColorTexture),new Jt("uColor",i=>i.shadowColor),new yr("nearFar",(i,n)=>n.camera.nearFar),new Ce("opacity",i=>i.shadowOpacity),new Ce("occludedOpacity",i=>i.occludedShadowOpacity),new Ce("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Lt("lightingMainDirectionView",(i,n)=>me(Whe,De(Whe,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new yr("texelSize",(i,n)=>n.linearDepthTexture!=null?er(Tvt,1/n.linearDepthTexture.descriptor.width,1/n.linearDepthTexture.descriptor.height):dp),new Mi("inverseViewMatrix",(i,n)=>us(Hhe,Ml(Hhe,n.camera.viewMatrix,n.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",kSe).add("highlightedThreshold","float",jhe.highlightedThreshold).add("selfShadowThreshold","float",jhe.selfShadowThreshold),r.code.add(w`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(w`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Hhe=_e(),Whe=O(),Tvt=Ne(),Svt=Object.freeze(Object.defineProperty({__proto__:null,build:xvt},Symbol.toStringTag,{value:"Module"}));let Evt=class extends LJ{constructor(){super(...arguments),this.shadowColor=$t(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},bPe=class wPe extends Tr{constructor(e){super(e,new MK,()=>this.destroy())}initializeProgram(e){return new vr(e.rctx,wPe.shader.get().build(this.configuration),fr)}initializePipeline(){return Ot({blending:So(ve.SRC_ALPHA,ve.ONE,ve.ONE_MINUS_SRC_ALPHA,ve.ONE_MINUS_SRC_ALPHA),colorWrite:Ft,depthTest:null,depthWrite:null})}get primitiveType(){return Et.TRIANGLE_STRIP}};bPe.shader=new _r(Svt,()=>ce(()=>import("./ShadowHighlight.glsl-56ab9734.js"),[]));const Cvt=.001953125,Avt=4e4,Ovt=5e4;let Rvt=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new Evt,this._drawParameters=new Qst,this._vao=Dl(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new bPe({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,No(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.memoryEstimate)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-nR(Avt,Ovt,e.relativeElevation);const i=this._viewingMode===$e.Global?me(qhe,e.center):ne(qhe,0,0,1),n=fe(i,r);this._passParameters.dayNightTerminator=nR(0,1,ge(30*n,0,1))}dispose(){this._vao=Le(this._vao),this._techniqueCached=Fi(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=Cvt}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const qhe=O(),Xhe=e0();let Pvt=class{constructor(){this._plane=e0()}get isEnabled(){return!$be(this.plane,Xhe)}get plane(){return this._plane}set plane(e){zw(e||Xhe,this._plane)}},Mvt=class extends Wr{};function XR(t){t.uniforms.add(new Jt("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,n=r.height;return gi($vt,1/i,1/n,i,n)}))}const $vt=Qt(),Kx={maxSearchSteps:8,maxDistanceAreaTex:16};function Ivt(){const t=new mr,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),XR(i),i.code.add(w`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${w.int(Kx.maxSearchSteps)} );
      }
    `),n.uniforms.add(new Ye("edgesTexture",s=>s.edges.colorTexture)),n.uniforms.add(new Ye("areaTexture",s=>s.areaTexture)),n.uniforms.add(new Ye("searchTexture",s=>s.searchTexture)),XR(n),n.code.add(w`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${w.int(Kx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${w.int(Kx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${w.int(Kx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${w.int(Kx.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${w.int(Kx.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const Lvt=Object.freeze(Object.defineProperty({__proto__:null,build:Ivt},Symbol.toStringTag,{value:"Module"}));let xPe=class TPe extends Tr{initializeProgram(e){return new vr(e.rctx,TPe.shader.get().build(),fr)}initializePipeline(){return Ot({colorWrite:Ft})}};xPe.shader=new _r(Lvt,()=>ce(()=>import("./BlendWeights.glsl-79c88ca2.js"),[]));function Dvt(){const t=new mr,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(E.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),XR(i),i.code.add(w`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),n.uniforms.add(new Ye("blendWeightsTexture",s=>s.blend.colorTexture),new Ye("colorTexture",s=>s.colorTexture)),XR(n),n.code.add(w`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const Nvt=Object.freeze(Object.defineProperty({__proto__:null,build:Dvt},Symbol.toStringTag,{value:"Module"}));let SPe=class EPe extends Tr{initializeProgram(e){return new vr(e.rctx,EPe.shader.get().build(),fr)}initializePipeline(){return Ot({colorWrite:Ft})}};SPe.shader=new _r(Nvt,()=>ce(()=>import("./Blur.glsl-2561d33a.js"),[]));const Yhe={threshold:.05,localConstrastAdaption:2};function Fvt(){const t=new mr,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(E.POSITION,"vec2"),XR(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(w`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),n.uniforms.add(new Ye("colorTexture",s=>s.colorTexture)),n.code.add(w`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${w.float(Yhe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${w.float(Yhe.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const Uvt=Object.freeze(Object.defineProperty({__proto__:null,build:Fvt},Symbol.toStringTag,{value:"Module"}));let CPe=class APe extends Tr{initializeProgram(e){return new vr(e.rctx,APe.shader.get().build(),fr)}initializePipeline(){return Ot({colorWrite:Ft})}};CPe.shader=new _r(Uvt,()=>ce(()=>import("./EdgeDetect.glsl-43794585.js"),[]));let _A=class extends xe{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new Mvt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=yu(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const r=this._abortController.signal;return ce(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return Bt(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,At.LINEAR,Tt.RGB),this._loadTextureFromBase64(e.searchTexure,At.NEAREST,Tt.LUMINANCE)]).then(([i,n])=>{ss(r)?(i.dispose(),n.dispose(),Bt(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=n)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const n=new va;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(CPe,n,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(xPe,n,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(SPe,n,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=xWe(this._rctx);const r=new pr(4,4);r.pixelFormat=Tt.RG,r.internalFormat=qe.RG8,r.wrapMode=Pt.CLAMP_TO_EDGE,this._passParameters.edges=new hs(this._rctx,r);const i=new pr(4,4);return i.pixelFormat=Tt.RGBA,i.wrapMode=Pt.CLAMP_TO_EDGE,this._passParameters.blend=new hs(this._rctx,i),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=Le(this._vao),this._passParameters.areaTexture=Le(this._passParameters.areaTexture),this._passParameters.searchTexture=Le(this._passParameters.searchTexture),this._passParameters.blend=Le(this._passParameters.blend),this._passParameters.edges=Le(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(r==null)return;r.colorTexture=e;const i=this._rctx,n=i.getBoundFramebufferObject(),s=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,s,o),r.edges.resize(s,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(yi.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3),r.blend.resize(s,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(yi.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3),i.bindFramebuffer(n),i.setClearColor(0,1,0,1),i.clear(yi.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(Et.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return qg(e).then(n=>{const s=new pr;return s.pixelFormat=i,s.wrapMode=Pt.CLAMP_TO_EDGE,s.width=n.width,s.height=n.height,s.samplingMode=r,new Ct(this._rctx,s,n)})}};h([f()],_A.prototype,"_abortController",void 0),h([f({readOnly:!0})],_A.prototype,"updating",null),_A=h([N("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],_A);function kvt(t,e){const r=-t[0],i=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*r,e[1]+=s*i,e[2]+=s*n,e[4]+=o*r,e[5]+=o*i,e[6]+=o*n,e[8]+=a*r,e[9]+=a*i,e[10]+=a*n,e[12]+=l*r,e[13]+=l*i,e[14]+=l*n}function zvt(t,e){const r=t[0],i=t[1],n=t[2];e[12]+=r*e[0]+i*e[4]+n*e[8],e[13]+=r*e[1]+i*e[5]+n*e[9],e[14]+=r*e[2]+i*e[6]+n*e[10],e[14]+=r*e[3]+i*e[7]+n*e[11]}let Bvt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new Vvt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{In(r.viewMatrix,e),zvt(r.origin.vec3,r.viewMatrix)})}},Vvt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=_e()}},Gvt=class extends Jxe{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=hi()}},jvt=class extends Kxe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=hi(),this.slicePlaneLocalOrigin=O(),this.transformNormalGlobalFromModel=hi()}};function Hvt(t){const e=w`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const Wvt=or(.5,-4e-4);function qvt(t,e){const r=t.vertex;r.include(Hvt),r.constants.add("depthBias","vec2",Wvt),r.uniforms.add(new yr("inverseViewport",(i,n)=>n.inverseViewport)),e.legacy?(r.uniforms.add(new Mi("proj",(i,n)=>n.camera.projectionMatrix)),r.code.add(w`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new Gh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new Mi("transformProjFromView",i=>i.transformProjFromView)),r.code.add(w`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(w`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Xvt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(w`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(w`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Yvt(t,e){const r=t.vertex;e.silhouette?(r.code.add(w`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(w`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Zvt(t,e){const r=t.vertex;r.include(Pc),r.uniforms.add(new Ce("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(w`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new Eh("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(E.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*AK),r.code.add(w`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(w`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new xR("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(w`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(E.NORMALA,"vec3"),t.attributes.add(E.NORMALB,"vec3"),r.code.add(w`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(E.NORMAL,"vec3"),r.code.add(w`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(w`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(a5,e),r.include(a5,e),r.uniforms.add(new Gh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new xR("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new pu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new pu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Lt("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Lt("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(w`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?w`normalize(transformWorldFromModelTL + rotatedModelPosition);`:w`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Mi("transformProjFromView",(i,n)=>n.camera.projectionMatrix)),r.code.add(w`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(w`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Qvt(t){return t.mode===ls.SKETCH||t.mode===ls.MIXED}var ls,cb;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(ls||(ls={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(cb||(cb={}));function $K(t,e){const r=t.vertex;switch(t.attributes.add(E.SIDENESS,"vec2"),e.mode===ls.MIXED?r.code.add(w`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(w`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case ls.MIXED:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case ls.SKETCH:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case ls.SOLID:r.code.add(w`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case ls.COUNT:break;default:e.mode}}function Jvt(t,e){const r=t.vertex;switch(t.include($K,e),e.mode){case ls.SOLID:r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case ls.SKETCH:r.uniforms.add(new Nb("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case ls.MIXED:r.uniforms.add(new Nb("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(w`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Kvt(t,e){t.include($K,e);const{vertex:r,fragment:i}=t;switch(Qvt(e)&&(r.uniforms.add(new Eh("strokesTexture",n=>n.strokesTexture.texture)),r.uniforms.add(new Nb("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new Nb("strokeVariants",n=>n.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new Eh("strokesTexture",n=>n.strokesTexture.texture),new Nb("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)),r.code.add(w`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Pc),i.code.add(w`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case ls.SOLID:r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(w`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case ls.SKETCH:r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(w`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case ls.MIXED:t.varyings.add("vType","float"),r.code.add(w`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(w`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function ebt(t){const e=new mr,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new Zhe("model"),new Zhe("localView")),e.include(qvt,t),e.include(Zvt,t),e.include(Jvt,t),e.include($K,t),e.include(Kvt,t),e.include(fn,t),e.include(Yvt,t),e.include(Xvt,t),e.include(xu,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new yr("pixelToNDC",(n,s)=>er(tbt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Jt("viewport",(n,s)=>s.camera.fullViewport),new Ce("pixelRatio",(n,s)=>s.camera.pixelRatio)),e.attributes.add(E.POSITION0,"vec3"),e.attributes.add(E.POSITION1,"vec3"),e.attributes.add(E.VARIANTOFFSET,"float"),e.attributes.add(E.VARIANTSTROKE,"float"),e.attributes.add(E.VARIANTEXTENSION,"float"),r.code.add(w`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?w`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:w`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===ls.SKETCH?w`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===ls.MIXED?w`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(w`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const tbt=Ne();let Zhe=class extends ln{constructor(e){super(e,"mat4")}};const rbt=Object.freeze(Object.defineProperty({__proto__:null,build:ebt},Symbol.toStringTag,{value:"Module"}));let OPe=class RPe extends Tr{initializeProgram(e){return new vr(e.rctx,RPe.shader.get().build(this.configuration),kRe)}initializePipeline(e){return e.blendMinMax?Ot({blending:So(ve.ONE,ve.ONE,ve.ZERO,ve.ONE,Zf.ADD,e.blendMinMax.MAX),depthTest:{func:Hr.LEQUAL},colorWrite:Ft}):Ot({depthTest:{func:Hr.LEQUAL},depthWrite:$l,colorWrite:Ft})}};OPe.shader=new _r(rbt,()=>ce(()=>import("./EdgeShader.glsl-e2d5d7be.js"),[]));let uf=class extends Fo{constructor(){super(...arguments),this.mode=ls.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};h([U({count:ls.COUNT})],uf.prototype,"mode",void 0),h([U()],uf.prototype,"hasSlicePlane",void 0),h([U()],uf.prototype,"silhouette",void 0),h([U()],uf.prototype,"legacy",void 0),h([U()],uf.prototype,"antialiasing",void 0),h([U()],uf.prototype,"doublePrecisionRequiresObfuscation",void 0),h([U()],uf.prototype,"hasMultipassTerrain",void 0),h([U()],uf.prototype,"cullAboveGround",void 0),h([U()],uf.prototype,"spherical",void 0);const ibt=8,eB=128,nbt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},sbt={solid:ls.SOLID,sketch:ls.SKETCH,uber:ls.MIXED};let tB=class PPe{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new uf,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[zt.TRANSPARENT]:{[zt.TRANSPARENT]:new Nt,[zt.OPAQUE]:new Nt},[zt.OPAQUE]:{[zt.TRANSPARENT]:new Nt,[zt.OPAQUE]:new Nt}},this._renderablesDirty=!1,this._drawParameters=new jvt,this._settings={...nbt,...i},this.key=PPe.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:Kr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=sbt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=Fi(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){if(this._renderablesDirty&&this._sortRenderables(),r!==zt.INVISIBLE){const i=this._sortedRenderables[r];i[zt.TRANSPARENT].forAll(e),i[zt.OPAQUE].forAll(e)}}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(OPe,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,n,s){this._render(e,r,r.regular.vao,i,n,s)}renderSilhouetteEdges(e,r,i,n,s){this._render(e,r,r.silhouette.vao,i,n,s)}_render(e,r,i,n,s,o){o>0&&(this._bindDraw(e,r,n,s),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(Et.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,n){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const s=new sU(r.transform.position),o=Uh(Qhe,Vw(Qhe,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;ne(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[zt.TRANSPARENT][zt.TRANSPARENT].clear(),this._sortedRenderables[zt.TRANSPARENT][zt.OPAQUE].clear(),this._sortedRenderables[zt.OPAQUE][zt.TRANSPARENT].clear(),this._sortedRenderables[zt.OPAQUE][zt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==zt.INVISIBLE&&r.edgeTransparency!==zt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[zt.TRANSPARENT][zt.TRANSPARENT].sort(e),this._sortedRenderables[zt.TRANSPARENT][zt.OPAQUE].sort(e),this._sortedRenderables[zt.OPAQUE][zt.TRANSPARENT].sort(e),this._sortedRenderables[zt.OPAQUE][zt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const Qhe=Pl();function BUt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new Kqe(t.layout)}}function hL(t){return new m2e(t.layout).createView(t.buffer)}let obt=class extends EOe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return J_t(e);const n=await this.invoke(new rB(e),r);return this._unpackOutput(n)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new rB(e),r);return hL(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new rB(e),r);return hL(i)}_unpackOutput(e){return{regular:{instancesData:hL(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:hL(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},rB=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=ap(e.indices)?e.indices:e.indices.buffer,this.indicesType=ap(e.indices)?"Array":qF(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function abt(t){const r=ZC.resolution,i=r/2,n=new Uint8Array(4*r*r),s=4*r*i,o=ZC.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=ZC.strokes.length;let d=(c-1)*u*l;for(const{distance:y,pressure:_}of ZC.strokes){let v=y,b=_,x=d;for(let T=0;T<c;T++){T!==0&&(v=Jhe(v,YR.DISTANCE),b=Jhe(b,YR.PRESSURE));for(let S=0;S<ZC.resolution;S++){const A=.5+(v?v[S%v.length]/a:0),C=b?b[S%b.length]:1;$R(A,n,x),$R(C,n,x+s),x+=4}x-=l*(u+1)}d+=l}const p=new pr;p.width=p.height=r;const m=new Ct(t,p,n);return new cbt(r,a,o,u,m)}function Jhe(t,e){if(!t)return null;const r=t.length/2,i=lbt*r,n=new Array(r);let s=0;const o=e===YR.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(i,1-(1-l)*Khe):Math.min(i,l*Khe)}return n}var YR;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(YR||(YR={}));const lbt=.1,Khe=.5;let cbt=class{constructor(e,r,i,n,s){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=n,this.texture=s}dispose(){this.texture=Le(this.texture)}};const ZC={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function ede(t){let e=null;for(const r of t){const i=r.type;if(ubt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function tde(t){let e=zt.INVISIBLE;for(const{material:r}of t)if(MPe(r)){if(r.color[3]*r.opacity<1)return zt.TRANSPARENT;e=zt.OPAQUE}return e}function rde(t){let e=zt.INVISIBLE;for(const{material:r}of t)if(MPe(r)){switch(r.objectTransparency){case zt.TRANSPARENT:case zt.INVISIBLE:return zt.TRANSPARENT;case zt.OPAQUE:if(r.opacity<1)return zt.TRANSPARENT}e=zt.OPAQUE}return e}function MPe(t){return t.size*t.color[3]*t.opacity>0}function ubt(t){return t.size*t.color[3]>0}function ide(t,e,r,i){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,s)}else for(let l=o;l<a;l++)r.set(l,s)}}let Td=class extends xe{constructor(t){super(t),this._updatingHandles=new Df,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=O(),this._localOrigins=new Bvt(new PJ(t.renderSR))}initialize(){this._worker=new obt(this.schedule),this._componentColorManager=new VRe(this.rctx,3);const t=FRe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Ar.createVertex(this.rctx,gr.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=Le(this._strokesTexture),this._componentColorManager=Me(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=Le(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",gbt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,n,s,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new sde(new Promise(d=>l=d),r.center,r.radius);this._perObjectData.set(t,c);const u=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,i,n,s,o,a));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void J.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(t);let s;(n==null?void 0:n.renderables.length)>0&&this._perObjectDataEvictionCache.add(n);const o=t.boundingVolumeWorldSpace.bounds,a=new sde(new Promise(c=>s=c),o,vg(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&hbt(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const u=t.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(t,a,u,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(n),this.setNeedsRender(),s()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(r==null)return;const i=e instanceof Array?n=>e[n]:()=>e;r.renderables.forEach(n=>{const s=n.components.meta.length;for(let o=0;o<s;o++){const a=i(o),l=n.components.meta[o],c=l.index;l.material.opacity=a,n.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const n=t instanceof h0,s=!!r.hasSlicePlane,o=ede(e),a=tB.getKey(o,s,n),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),d=this._acquireRenderer(o,s,n);u.removeRenderable(c),--u.refCount,c.rendererKey=a,d.addRenderable(c)}for(let u=0;u<e.length;u++)c.components.meta[u].material=e[u];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>{const n=i.components.meta;for(let s=0;s<n.length;s++)i.components.meta[s].verticalOffset=(e==null?void 0:e[s])??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=O(),n=new sU;let s=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,u=!0;l.forEachRenderable(d=>{d.visible&&(s+=d.statistics.averageEdgeLength,o++,c&&d.regular&&(l.updateTechnique(t,!1),c=!1),u&&d.silhouette&&(l.updateTechnique(t,!0),u=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new Gvt(40*s/o,e);ne(i,r[3],r[7],r[11]),n.set(i),re(a.transformWorldFromViewTH,n.high),re(a.transformWorldFromViewTL,n.low),Ac(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Uh(cde,a.transformViewFromCameraRelativeRS),Vw(a.transformNormalViewFromGlobal,cde),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=tde(t.components.meta),r=rde(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedShaderTransformation(e,r);const i=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(ne(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,kvt(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let n=0;n<e.length;n++){const s=e[n].material,o=e[n].index,a=ge(Math.round(s.size*ibt),0,255),l=ge(s.extensionLength,-eB,255-eB)+eB,c=s.type==="solid"?hF.SOLID:hF.SKETCH,u=255*s.opacity,d=s.color,p=255*d[0],m=255*d[1],y=255*d[2],_=255*d[3];r.textureBuffer.setData(o,0,p,m,y,_),r.textureBuffer.setData(o,1,a,l,c,u),IRe(e[n].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let n=0;n<t.length;n++){const s=t[n],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:s})}const i=new dbt(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,n,s=n.length){return this._worker.process({data:e,indices:n,indicesLength:s,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,n){const s=c=>this._verticesBufferObject!=null?new pbt(new vp(this.rctx,kRe,{vertices:B_t,instances:c===cb.REGULAR?cF.glLayout:uF.glLayout},{vertices:this._verticesBufferObject,instances:Ar.createVertex(this.rctx,gr.STATIC_DRAW,c===cb.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===cb.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?s(cb.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?s(cb.SILHOUETTE):null,l=((o==null?void 0:o.vao.memoryEstimate)??0)+((a==null?void 0:a.vao.memoryEstimate)??0);return new mbt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:n,averageEdgeLength:t.averageEdgeLength},r,tde(e.meta),rde(e.meta),e,i)}async _addGeometry(t,e,r,i,n,s){const o=r.vertexAttributes.get(E.POSITION),a=r.indices.get(E.POSITION),l=_e(),c=this._computeModelTransformWithLocalOrigin(t,r,l),u=new lde(o,a,l,c);return this._addPositionData(e,u,r.edgeIndicesLength,i,n,s)}async _addPositionData(t,e,r,i,n,s=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(o==null||r<=0)return;const a=this._acquireRenderer(i.type,!!n.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,u=e.indices,d=e.position,p=d.data.length/d.size,m=aF.createBuffer(p);for(let v=0;v<p;v++)m.position.set(v,0,d.data[v*d.size]),m.position.set(v,1,d.data[v*d.size+1]),m.position.set(v,2,d.data[v*d.size+2]);ide(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,s,u,r));if(t.loaded==null)return;const _=this._createRenderable(y,o,new fbt(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,n,s,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(s);if(a==null)return 0;const l=ede(s),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=aF.createBuffer(r.length/3);iM(u.position.typedBuffer,r,u.position.typedBufferStride,3),ide(a.meta,n,u.componentIndex,i);const d=!0,p=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(p,u,d,!1,i));if(e.loaded==null)return 0;const y=this._createRenderable(m,a,t,c.key,!0);return e.renderables.push(y),c.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,n){const s=new Map;let o=0,a=null,l=0;for(let b=0;b<t.geometries.length;b++){const x=t.geometries[b];if(!x.material.supportsEdges)continue;!a&&x.localOrigin&&(a=x);const T=x.vertexAttributes.get(E.POSITION);l+=T.data.length/T.size,o+=x.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,u=o?new c(o):null,d=[];let p=0;for(let b=0;b<t.geometries.length;b++){const x=t.geometries[b];if(!x.material.supportsEdges)continue;const T=x.vertexAttributes.get(E.POSITION),S=x.indices.get(E.POSITION);let A=s.get(T.data);if(A==null){A=d.length/3;for(let C=0;C<T.data.length;C+=T.size)d.push(T.data[C]),d.push(T.data[C+1]),d.push(T.data[C+2]);s.set(T.data,A)}if(S)for(let C=0;C<x.edgeIndicesLength;C++)u[p++]=A+S[C]}const m=a||t.geometries[0],y=_e(),_=this._computeModelTransformWithLocalOrigin(t,m,y);for(let b=0;b<t.geometries.length;b++)t.geometries[b].localOrigin=_.origin;const v=new lde({data:d,size:3},u,y,_);await this._updatingHandles.addPromise(this._addPositionData(e,v,u.length,r[0],i,n))}_acquireRenderer(t,e,r){const i=tB.getKey(t,e,r);let n=this._renderers.get(i);return this._strokesTexture==null&&(this._strokesTexture=abt(this.rctx)),n||(n=new tB(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===$e.Global}),this._renderers.set(i,n)),++n.refCount,n}_removeRenderable(t){nde(t.regular),nde(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=O(),n=s=>{Ws(i,s.center,e);const o=fe(i,r),a=s.radius,l=o<-a?1/0:o<a?0:o-a;s.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),n=r.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!ode(o)||!o.visible)return;const a=dL(o.regular.lod.lengths,o.distanceToCamera,s);t.renderRegularEdges(i,o,r,e,a)},n)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),n=r.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!ade(o)||!o.visible)return;const a=dL(o.silhouette.lod.lengths,o.distanceToCamera,s);t.renderSilhouetteEdges(i,o,r,e,a)},n)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(n,s)=>n.forEachRenderable(o=>{o.visible&&!e&&(ode(o)&&(e=dL(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&ade(o)&&(e=dL(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},s);return this._renderers.forEach(n=>{e||(i(n,zt.OPAQUE),i(n,zt.TRANSPARENT))}),e}}}};function nde(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function hbt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const n=t.geometries[i];if(n.material.supportsEdges){if(e){if(!Hf(e,n.transformation))return!1}else e=n.transformation;if(r||n.localOrigin==null){if(r&&r.localOrigin!=null&&n.localOrigin!=null&&r.localOrigin.id!==n.localOrigin.id)return!1}else r=n}}return!0}h([f({constructOnly:!0})],Td.prototype,"rctx",void 0),h([f({constructOnly:!0})],Td.prototype,"renderSR",void 0),h([f({constructOnly:!0})],Td.prototype,"viewingMode",void 0),h([f({constructOnly:!0})],Td.prototype,"techniqueRepository",void 0),h([f({constructOnly:!0})],Td.prototype,"setNeedsRender",void 0),h([f({constructOnly:!0})],Td.prototype,"schedule",void 0),h([f({readOnly:!0})],Td.prototype,"_updatingHandles",void 0),h([f({readOnly:!0})],Td.prototype,"updating",null),Td=h([N("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Td);class sde{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}let dbt=class{constructor(e,r){this.buffer=e,this.meta=r}};class pbt{constructor(e,r){this.vao=e,this.lod=r}}class fbt{constructor(e,r){this.modelMatrix=e,this.origin=r}}let mbt=class{constructor(e,r,i,n,s,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function ode(t){return t.regular!=null}function ade(t){return t.silhouette!=null}function dL(t,e,r){const i=e*r,n=hDe(t,i,!0);return n===-1?i<t[0]?t.length:0:t.length-n}class lde{constructor(e,r,i,n){this.position=e,this.indices=r,this.modelTransform=i,this.origin=n}}const cde=hi(),gbt=()=>Promise.reject();function xp(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let ude=class{constructor(e,r,i,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},qm=!1;function ybt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&xp(t)?new ude(()=>t.createQuery(),i=>{t.deleteQuery(i),qm=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{qm||(qm=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),qm=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new ude(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),qm=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{qm||(qm=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),qm=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function _bt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new vbt(r,e)}let vbt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(i,null)})}start(){qm||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var mi;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(mi||(mi={}));const hde="Total";let bbt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new dg(hde),this._cpuTimeSamplers=new Map(Object.values(mi).map(r=>[r,new dg(r)])),this._enableGPUTimer=0,this._totalGPUTime=new dg("GPU"),this._gpuTimeSamplers=new Map(Object.values(mi).map(r=>[r,new dg(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(mi),hde];this._gpuTimerPool=_bt(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:SX(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=Le(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(mi.FINISH);this._gpuTimeSamplers.get(mi.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},Yl=class extends xe{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(t=null,e=!se("disable-feature:high-quality-idle")){this._renderStateFeatures=rse(e,t),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(t,e=this._state){var r;return((r=this._renderStateFeatures)==null?void 0:r.get(e,t))??!1}setFeatureEnabled(t,e,r){var i;(i=this._renderStateFeatures)==null||i.set(e,t,r),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(Hn.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Hn.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Hn.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,r,i,n,s,o,a){super({}),this._stage=t,this._materialRepository=e,this._techniqueRepository=i,this._rctx=n,this._compositingHelper=s,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new Nt,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Pvt,this._state=Cr.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=_s.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new V1t,this._handles=new Vi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(t.view.qualityProfile),this._smaaPass=new _A(this._rctx,i),a(),this._offscreen=new lvt(this._rctx,this._compositingHelper),this.performanceInfo=new bbt(this._rctx),this._shadowMap=new $J(this._rctx,t.viewingMode),this._ssaoHelper=new c3e(t.view,i,this._rctx,a),this._highlight=new nvt(i,this._rctx),this._shadowHighlight=new Rvt(this._rctx,t.viewingMode),this._shadowAccumulator=new gl(this._rctx,i,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,u)=>{l.shadowMap.start(l.camera,c,u,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(D.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new Mst(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new yA({renderContext:this._renderContext,techniqueRepository:i,textureRepository:r,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new B1t(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ue(()=>this._stage.view.state.camera,()=>a(),An),ue(()=>Kr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(zt.TRANSPARENT):()=>{},a()},Pr),ue(()=>this._ssaoEnabled||this.isFeatureEnabled(Hn.SSAO),l=>this._ssaoHelper.enabled=l,An)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Pi(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=Le(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Me(this._edgeView),this.renderPassManager.destroy(),w2e.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new Td({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:wbt(t)}),this._handles.add(ue(()=>_h(this._edgeView,e=>e.updating),()=>this._requestRender(),Br)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return I6(this._bindParameters.ssr.reprojectionMatrix,yn)}set _reprojectionMatrix(t){_X(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var t;return!!((t=this._shadowMap)!=null&&t.enabled)}setParameters(t){var i,n;const{_shadowMap:e,_bindParameters:r}=this;if(((i=t.qualitySettings)==null?void 0:i.reflections)!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),((n=t.qualitySettings)==null?void 0:n.ambientOcclusion)!==void 0&&this._ssaoEnabled!==t.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=t.qualitySettings.ambientOcclusion,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const s=t.environment.lighting.type!=="virtual";r.enableFillLights!==s&&(r.enableFillLights=s,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:r,removes:i,updates:n}=t;if(r.length===0&&i.length===0&&n.length===0)return;const s=HCe(t);let o=!1;s.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(u=>u.material===l);c==null&&a.adds.length>0&&(c=new r3e(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(u=>t.removes.removeUnordered(u)),a.adds.forEach(u=>t.adds.removeUnordered(u)),a.updates.forEach(u=>t.updates.removeUnordered(u)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(le.LINE_CALLOUTS_HUD_DEPTH,D.Color)||a.requiresSlot(le.HUD_MATERIAL,D.Color)||a.requiresSlot(le.LABEL_MATERIAL,D.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(r=>this._hasAnimations=r.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?Pi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,r,i,n){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:s,contentCamera:o,mode:a,alignPixelEnabled:l}=r;this._state=a,this._renderOverlay(n),this.performanceInfo.advance(mi.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=rt.NONE,this._bindParameters.alignPixelEnabled=l;const c=this._offscreen;c.setupRenderTarget(this.hasReflections);const u=e0(this._sliceHelper.plane);i===hw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),s.setGLViewport(this._rctx),this._prepare(s,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(mi.PREPARE);const d=this._computeDepthRange(s);this._renderShadowMap(t,s,this._bindParameters.lighting.mainLight.direction,d),this.performanceInfo.advance(mi.SHADOW_MAP),c.initializeFrame(s),this._ensureBindParameters(s,o);const p=this._terrainRenderingEnabled&&(this._terrainTransparency===_s.Semitransparent||this._terrainTransparency===_s.TransparentWithDraped),m=this._highQualityTransparency&&p,y=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(m,y),this._renderLinearDepth(),this.performanceInfo.advance(mi.LINEAR_DEPTH),this._accumulateShadows(d,s,o),this.performanceInfo.advance(mi.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(mi.NORMALS),this._ensureBindParametersSSR(n),this._renderSSAO(n),this.performanceInfo.advance(mi.SSAO),this._renderContext.output=D.Color,c.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(mi.OPAQUE),this._renderTerrainLinearDepth(m),this._setMultipassTerrain(m),this._renderEdges(zt.OPAQUE),this.performanceInfo.advance(mi.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(le.VOXEL),this.performanceInfo.advance(mi.VOXEL),this._renderHiddenTransparentEdges(),y&&(this._oitEnabled?this._renderOITPass(wT.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(mi.TRANSPARENT),this._renderGeometryLinearDepth(m);const _=this._renderHUDVisibility(m);m||this._renderInternalSlot(le.LINE_CALLOUTS),this.performanceInfo.advance(mi.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(mi.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(zt.TRANSPARENT,m),this.performanceInfo.advance(mi.TRANSPARENT_EDGES),this._renderTransparentTerrain(),p&&_&&(m?this._renderLineCallouts(tc.Occluded):c.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(tc.Occluded,c.framebuffer),this.performanceInfo.advance(mi.HUD_OCCLUDED)),this.performanceInfo.advance(mi.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),p&&(c.compositeTransparentTerrainOntoMain(this._bindParameters),m&&(this._renderEdges(zt.OPAQUE),this.performanceInfo.advance(mi.OPAQUE_EDGES),y&&(this._oitEnabled?this._renderOITPass(wT.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(mi.TRANSPARENT),this._renderEdges(zt.TRANSPARENT),this.performanceInfo.advance(mi.TRANSPARENT_EDGES))),m&&this._renderLineCallouts(tc.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),c.renderToTargets(()=>{this._renderInternalSlot(le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(le.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(le.LASERLINES)},c.currentColorTarget,c.mainDepth),this.performanceInfo.advance(mi.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&c.renderTmpAndCompositeToMain(()=>this._renderSlot(le.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ca.PremultipliedAlpha),this.performanceInfo.advance(mi.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(mi.OCCLUDED);const v=i===hw.ON&&this._magnifierHelper.enabled,b=v&&t==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(b);const x=this._offscreen.colorTexture;this._renderAntiAliasing(x)||x==null||this._compositingHelper.composite(this._bindParameters,x,ca.None),this.performanceInfo.advance(mi.ANTIALIASING),this._renderHUD(tc.NotOccluded,b),this.performanceInfo.advance(mi.HUD),this._renderHighlights(b,this._bindParameters),this.performanceInfo.advance(mi.HIGHLIGHTS),v&&this._magnifierHelper.render(this._rctx,this._bindParameters),b!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,ca.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=u,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(t,e){this._renderContext.output=D.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._prepareSlots(le.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,le.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(le.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,le.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t!=null&&se("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(D.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=tc.NotOccluded,this._renderInternalSlot(le.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,r=t===dn.BACKGROUND;if(r||e){const i=r?this.performanceInfo.elapsedTime:0,n=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),s=Math.max(i,n);this._animationTimestep.frame(s,r)}}readDepthPixels(t,e,r){const i=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const n=yi.COLOR_BUFFER_BIT|yi.DEPTH_BUFFER_BIT|yi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(n),this._renderGeometryAndTransparentTerrainPass(D.Depth)}i.readPixels(e[0],e[1],e[2],e[3],Tt.RGBA,Un.UNSIGNED_BYTE,r)}readHUDVisibility(t,e,r,i,n){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,r,i,Tt.RGBA,Un.UNSIGNED_BYTE,n)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_prepareSlots(...t){this._renderPlugins.prepareSlots(t)}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const r=this._edgeView;r!=null&&r.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,t),this._bindParameters,ca.Alpha,e)}_renderShadowMap(t,e,r,i){const n=this._shadowMap;n.enabled&&(n.start(e,r,i,this.isFeatureEnabled(Hn.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(D.ShadowHighlight,this._shadowMap,s=>n.takeCascadeSnapshotTo(s,JS.Highlight)),n.clear(),this._renderShadowCascades(D.ShadowExcludeHighlight,this._shadowMap,s=>{n.takeCascadeSnapshotTo(s,JS.Default),this._renderGeometryAndTransparentTerrainPass(D.ShadowHighlight)})):this._renderShadowCascades(D.Shadow),n.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,r=i=>{}){for(const i of e.cascades)i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(t),r(i)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(D.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=D.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(D.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(D.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return kW;const e=S1t(t,this._materialRenderers,this._stage.layers);return iE(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._prepareSlots(le.TRANSPARENT_TERRAIN),this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._prepareSlots(le.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(le.INTEGRATED_MESH,le.OPAQUE_TERRAIN,le.OPAQUE_MATERIAL,le.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,le.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(le.INTEGRATED_MESH),this._renderSlot(le.OPAQUE_TERRAIN),this._renderInternalSlot(le.OPAQUE_MATERIAL),this._renderSlot(le.OPAQUE_MATERIAL),this._renderSlot(le.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(le.TRANSPARENT_MATERIAL),this._renderSlot(le.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(le.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(le.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===tc.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(le.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(le.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(wT.HUD,t),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,ca.PremultipliedAlpha)):t===tc.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(tc.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._prepareInternalSlots(this._materialRenderers,le.LINE_CALLOUTS_HUD_DEPTH,le.HUD_MATERIAL,le.LABEL_MATERIAL),this._renderInternalSlot(le.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(le.HUD_MATERIAL),this._renderInternalSlot(le.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const r=this._highlight,i=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(D.Highlight),this._rctx.clearSafe(yi.DEPTH_BUFFER_BIT),this._renderHUDElements(tc.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),r.render(this._bindParameters,i,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,r){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,r)}_prepareTransparencySlots(){this._renderContext.output=D.Alpha,this._bindParameters.transparencyPassType=rt.Alpha,this._prepareInternalSlots(this._materialRenderers,le.TRANSPARENT_MATERIAL),this._prepareSlots(le.TRANSPARENT_MATERIAL),this._renderContext.output=D.Color,this._bindParameters.transparencyPassType=rt.Color,this._prepareInternalSlots(this._materialRenderers,le.TRANSPARENT_MATERIAL),this._prepareSlots(le.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=rt.FrontFace,this._prepareInternalSlots(this._materialRenderers,le.TRANSPARENT_MATERIAL),this._prepareSlots(le.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=rt.NONE}_renderOITPass(t,e=tc.Both){const r=t===wT.HUD,i=r?()=>this._renderHUDElements(e):()=>this._renderTransparentGeometry(),n=o=>{this._bindParameters.transparencyPassType=o,this._offscreen.renderOITPass(i,o,r)},s=this._renderContext.output;this._renderContext.output=D.Alpha,n(rt.Alpha),this._renderContext.output=D.Color,n(rt.Color),n(rt.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,r),this._bindParameters.transparencyPassType=rt.NONE,this._renderContext.output=s,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let t=0;kc.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&s.material.renderOccluded===Ri.OccludeAndTransparentStencil&&(t|=s.material.renderOccluded,kc.push(s))});const e=this._offscreen,r=(s,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,s))};kc.length!==0&&(this._prepareInternalSlots(kc,le.OCCLUDER_MATERIAL,le.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(le.OCCLUDER_MATERIAL,kc),r(.5,Ri.OccludeAndTransparentStencil,()=>this._renderInternalSlot(le.TRANSPARENT_OCCLUDER_MATERIAL,kc),!1,!1)),kc.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&(s.material.renderOccluded===Ri.OccludeAndTransparent||s.material.renderOccluded===Ri.Transparent||s.material.renderOccluded===Ri.Opaque)&&(t|=s.material.renderOccluded,kc.push(s))});const i=this._renderPlugins.renderOccludedFlags;if(t|=i,!t)return;const n=s=>{this._renderContext.renderOccludedMask=s,this._prepareInternalSlots(kc,le.OPAQUE_MATERIAL,le.TRANSPARENT_MATERIAL,le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),i>Ri.Occlude&&this._renderSlot(le.OCCLUDED_TERRAIN),this._renderInternalSlot(le.OPAQUE_MATERIAL,kc),this._renderInternalSlot(le.TRANSPARENT_MATERIAL,kc),this._renderInternalSlot(le.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,kc),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=D.Color,r(.5,Ri.OccludeAndTransparent,()=>n(Ri.OccludeAndTransparent),!0,Rl.OutlineVisualElementMask),r(.5,Ri.Transparent,()=>n(Ri.Transparent),!0,Rl.OutlineVisualElementMask),r(1,Ri.Opaque,()=>n(Ri.Opaque),!0,Rl.OutlineVisualElementMask),kc.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&t!=null)return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(r=>r.requiresSlot(le.TRANSPARENT_MATERIAL,D.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=r.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=yn:(us(pde,this._bindParameters.camera.viewMatrix),us(dde,this._bindParameters.camera.projectionMatrix),Vr(e2,pde,dde),Vr(e2,this._renderContext.lastFrameCamera.viewMatrix,e2),Vr(e2,this._renderContext.lastFrameCamera.projectionMatrix,e2),this._reprojectionMatrix=e2),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=yn,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(t,...e){for(const r of e)this._bindParameters.slot=r,t.forAll(i=>{i.material.shouldRender(this._renderContext)&&i.prepareTechnique(this._renderContext)})}_renderInternalSlot(t,e=this._materialRenderers){let r=!1;return this._bindParameters.slot=t,e.forAll(i=>{if(i.material.shouldRender(this._renderContext)){const n=i.prepareTechnique(this._renderContext);n!=null&&(i.render(this._renderContext,n),r=!0)}}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=yxe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var t,e,r,i,n;return{offscreen:((t=this._offscreen)==null?void 0:t.gpuMemoryUsage)??0,highlights:(((e=this._highlight)==null?void 0:e.gpuMemoryUsage)??0)+(((r=this._shadowHighlight)==null?void 0:r.gpuMemoryUsage)??0),shadows:((i=this._shadowMap)==null?void 0:i.gpuMemoryUsage)??0,ssao:((n=this._ssaoHelper)==null?void 0:n.gpuMemoryUsage)??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=rse()},getFramebufferTexture:e=>{switch(e){case Ny.Color:return t._offscreen.colorTexture;case Ny.LinearDepth:return t._offscreen.linearDepthTexture;case Ny.Normals:return t._offscreen.normalTexture;case Ny.ShadowMap:return t._shadowMap.depthTexture;case Ny.HudVisibility:return t._offscreen.hudVisibilityTexture;case Ny.Highlight:return t._offscreen.highlightTexture}}}}};var wT,Ny;h([f()],Yl.prototype,"_renderPlugins",void 0),h([f()],Yl.prototype,"_shadowAccumulator",void 0),h([f()],Yl.prototype,"_state",void 0),h([f()],Yl.prototype,"_renderStateFeatures",void 0),h([f()],Yl.prototype,"_antialiasingEnabled",void 0),h([f({readOnly:!0})],Yl.prototype,"_antialiasing",null),h([f()],Yl.prototype,"_ssaoEnabled",void 0),h([f()],Yl.prototype,"_smaaPass",void 0),h([f({autoDestroy:!0})],Yl.prototype,"_edgeView",void 0),h([f()],Yl.prototype,"updating",null),h([f()],Yl.prototype,"isCameraFinal",null),Yl=h([N("esri.views.3d.webgl-engine.lib.Renderer")],Yl),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(wT||(wT={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(Ny||(Ny={}));const kc=new Nt,dde=_e(),pde=_e(),e2=_e();function wbt(t){return e=>t.immediate.schedule(e)}let $Pe=class IPe{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=IPe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Ar.createIndex(this._rctx,gr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,bt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Et.POINTS,1,Qe.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},fde=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:ve.ONE,dstRGB:ve.ZERO,srcAlpha:ve.ONE,dstAlpha:ve.ZERO},this.blendEquation={mode:Zf.ADD,modeAlpha:Zf.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=qd.BACK,this.frontFace=NS.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Hr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:qd.FRONT_AND_BACK,func:Hr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:qd.FRONT_AND_BACK,fail:_n.KEEP,zFail:_n.KEEP,zPass:_n.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},xbt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${i}: ${s.shift()}
`,s.forEach(o=>e+=`   ${o}
`)})}return e}};const Tbt={RECORD_ALLOCATIONS:!1};let Sbt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new xbt(Tbt.RECORD_ALLOCATIONS);this._current.length<Es.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<Es.COUNT;++r){const i=this._current[r];i>0&&(e+=`${Es[r]}: ${i}
`)}}return e+=this._allocations.information,e}},Ebt=class{constructor(e,r,i){const n=r.textureFilterAnisotropic,s=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),xp(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const Cbt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var mde,LPe={exports:{}};(mde=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(LPe.exports=mde);const Abt=UP(LPe.exports);var gde,XW={exports:{}};XW.exports,gde=XW,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(gde.exports=e)}();const yde=UP(XW.exports);var DPe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(DPe);const Obt=UP(DPe.exports);var cd=999,_de=9999,iB=0,nB=1,vde=2,bde=3,wde=4,pL=5,Rbt=6,Pbt=7,Mbt=8,xde=9,$bt=10,Tde=11,Ibt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Lbt(){var t,e,r,i=0,n=0,s=cd,o=[],a=[],l=1,c=0,u=0,d=!1,p=!1,m="";return function(z){return a=[],z!==null?_(z.replace?z.replace(/\r\n/g,`
`):z):v()};function y(z){z.length&&a.push({type:Ibt[s],data:z,position:u,line:l,column:c})}function _(z){var X;for(i=0,r=(m+=z).length;t=m[i],i<r;){switch(X=i,s){case iB:i=A();break;case nB:i=S();break;case vde:i=T();break;case bde:i=C();break;case wde:i=F();break;case Tde:i=P();break;case pL:i=k();break;case _de:i=V();break;case xde:i=x();break;case cd:i=b()}X!==i&&(m[X]===`
`?(c=0,++l):++c)}return n+=i,m=m.slice(i),a}function v(z){return o.length&&y(o.join("")),s=$bt,y("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=n+i-1,s=iB,e=t,i+1):e==="/"&&t==="/"?(u=n+i-1,s=nB,e=t,i+1):t==="#"?(s=vde,u=n+i,i):/\s/.test(t)?(s=xde,u=n+i,i):(d=/\d/.test(t),p=/[^\w_]/.test(t),u=n+i,s=d?wde:p?bde:_de,i)}function x(){return/[^\s]/g.test(t)?(y(o.join("")),s=cd,i):(o.push(t),e=t,i+1)}function T(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(y(o.join("")),s=cd,i)}function S(){return T()}function A(){return t==="/"&&e==="*"?(o.push(t),y(o.join("")),s=cd,i+1):(o.push(t),e=t,i+1)}function C(){if(e==="."&&/\d/.test(t))return s=pL,i;if(e==="/"&&t==="*")return s=iB,i;if(e==="/"&&t==="/")return s=nB,i;if(t==="."&&o.length){for(;R(o););return s=pL,i}if(t===";"||t===")"||t==="("){if(o.length)for(;R(o););return y(t),s=cd,i+1}var z=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||z){for(;R(o););return s=cd,i}return o.push(t),e=t,i+1}function R(z){for(var X,q,G=0;;){if(X=yde.indexOf(z.slice(0,z.length+G).join("")),q=yde[X],X===-1){if(G--+z.length>0)continue;q=z.slice(0,1).join("")}return y(q),u+=q.length,(o=o.slice(q.length)).length}}function P(){return/[^a-fA-F0-9]/.test(t)?(y(o.join("")),s=cd,i):(o.push(t),e=t,i+1)}function F(){return t==="."||/[eE]/.test(t)?(o.push(t),s=pL,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(s=Tde,o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),s=cd,i):(o.push(t),e=t,i+1)}function k(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(y(o.join("")),s=cd,i):(o.push(t),e=t,i+1)}function V(){if(/[^\d\w_]/.test(t)){var z=o.join("");return s=Abt.indexOf(z)>-1?Mbt:Obt.indexOf(z)>-1?Pbt:Rbt,y(o.join("")),s=cd,i}return o.push(t),e=t,i+1}}function Dbt(t){var e=Lbt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function Nbt(t){return Dbt(t)}function Fbt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const sB=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Ubt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=i.exec(n.data);if(s){const o=s[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return n.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function kbt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function vA(t,e,r,i){i=i||r;for(const n of t)if(n.type==="ident"&&n.data===r)return i in e?e[i]++:e[i]=0,vA(t,e,i+"_"+e[i],i);return r}function NPe(t,e,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const d=l[u];if(d.type==="operator"&&d.data===";")return u}return null}function n(l){let c=-1,u=0,d=-1;for(let p=0;p<l.length;p++){const m=l[p];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++u:/\#endif\s*.*/.test(m.data)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(d=Math.max(d,p)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=i(l,p);if(y===null)throw new Error("precision statement not followed by any semicolons!");d=Math.max(d,y)}c<d&&u===0&&(c=p)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function zbt(t,e,r,i="lowp"){NPe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Bbt(t,e,r,i,n="lowp"){NPe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Vbt(t,e){let r,i,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(r=s),o.data==="]")){i=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),n}function Sde(t,e){if(t.startsWith("#version 300"))return t;const r=Nbt(t);if(Ubt(r,"100","300 es")==="300 es")return t;let i=null,n=null;const s={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===tu.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===tu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===tu.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=vA(r,s,"fragColor"),zbt(r,i,"vec4")),l.data=i),e===tu.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Vbt(r,a+1),u=vA(r,s,"fragData");Bbt(r,u,"vec4",c,"mediump"),l.data=u}else e===tu.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=vA(r,s,"gl_FragDepth")),l.data=n);break;case"ident":if(Cbt.includes(l.data)){if(e===tu.VERTEX_SHADER&&kbt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=vA(r,s,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&sB.includes(c[1].trim())){const p=r[a+1];r.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&sB.includes(u[1].trim())&&(l.data="#if 1");const d=l.data.match(/\#ifndef\s+(.*)/);d&&d[1]&&sB.includes(d[1].trim())&&(l.data="#if 0")}}return Gbt(t,Fbt(r))}function Gbt(t,e){return e}const jbt=4294967295;let Hbt=class{constructor(e,r,i,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===rr.WEBGL2&&(r=Sde(r,tu.VERTEX_SHADER),i=Sde(i,tu.FRAGMENT_SHADER)),this._vShader=Ede(this._context,tu.VERTEX_SHADER,r),this._fShader=Ede(this._context,tu.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Es.Shader,this),gj()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),gj()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===rr.WEBGL2){const l=o;for(const[c,u]of this._uniformBlockBindings){const d=l.getUniformBlockIndex(a,c);d<jbt&&l.uniformBlockBinding(a,d,u)}}this._glName=a,this._context.instanceCounter.increment(Es.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Es.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Es.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){jp(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){jp(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){jp(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){jp(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){jp(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),n[0]=r,n[1]=i)}setUniform2fv(e,r){jp(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),this._nameToUniform3.set(e,[r,i,n])):r===s[0]&&i===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),s[0]=r,s[1]=i,s[2]=n)}setUniform3fv(e,r){jp(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),this._nameToUniform4.set(e,[r,i,n,s])):o!==void 0&&r===o[0]&&i===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),o[0]=r,o[1]=i,o[2]=n,o[3]=s)}setUniform4fv(e,r){jp(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){jp(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){jp(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function Ede(t,e,r){const i=t.gl,n=i.createShader(e);return i.shaderSource(n,r),i.compileShader(n),gj()&&!i.getShaderParameter(n,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===tu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(n)),console.error(Wbt(r))),n}function Wbt(t){let e=2;return t.replaceAll(`
`,()=>`
`+qbt(e++)+":")}function qbt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function jp(t,e,r){const i=t.get(e);return i?_X(i,r):(t.set(e,Array.from(r)),!0)}let Xbt=class{constructor(e){this._rctx=e,this._store=new RE}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,n){const s=this._store.get(e,r);if(s!=null)return s.ref(),s;const o=new Hbt(this._rctx,e,r,i,n);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},sM=class{constructor(){this._result=!1}dispose(){this._program=Le(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},Ybt=class extends sM{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===rr.WEBGL2&&se("mac")&&se("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new pr(1);i.wrapMode=Pt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const n=new hs(r,i),s=Ar.createIndex(this._rctx,gr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(s,bt.ELEMENT_ARRAY_BUFFER),r.drawElements(Et.POINTS,1,Qe.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(Et.TRIANGLES,0,258);const o=new Uint8Array(4);return n.readPixels(0,0,1,1,Tt.RGBA,Un.UNSIGNED_BYTE,o),n.dispose(),s.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${w.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${w.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=$Pe.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},Zbt=class extends sM{constructor(e){super(),this._rctx=e,this._program=Cde(this._rctx,!1),this._obfuscated=Cde(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=Le(this._obfuscated)}_test(e){if(se("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new pr(1);i.wrapMode=Pt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const n=new hs(r,i),s=Ar.createVertex(r,gr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Fh(r,new Map([["position",0]]),{geometry:[new xo("position",2,Qe.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=Se(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Se(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);nH(a,c,3);const u=new Float32Array(6);nH(l,u,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const d=new Uint8Array(4);n.readPixels(0,0,1,1,Tt.RGBA,Un.UNSIGNED_BYTE,d),o.dispose(),n.dispose();const p=(a[2]-l[2])/25,m=rJ(d);return Math.abs(p-m)}};function Cde(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let Qbt=class extends sM{constructor(e){var n,s,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===rr.WEBGL1)return void(this._result=!(!((n=e.capabilities.textureFloat)!=null&&n.textureFloat)||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new pr(1);i.wrapMode=Pt.CLAMP_TO_EDGE,i.dataType=Un.FLOAT,i.internalFormat=qe.RGBA32F,i.samplingMode=At.NEAREST;const n=new hs(r,i),s=Ar.createVertex(r,gr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Fh(r,new Map([["a_pos",0]]),{geometry:[new xo("a_pos",2,Qe.UNSIGNED_SHORT,0,4)]},{geometry:s});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:d}=r.getViewport();r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const p=Ot({blending:HSe});r.setPipelineState(p),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const m=r.gl.getError();return r.setViewport(l,c,u,d),r.bindFramebuffer(a),o.dispose(),n.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},Jbt=class extends sM{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new pr(1);i.wrapMode=Pt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const n=new hs(r,i),s=new Uint8Array(4),o=Ar.createVertex(r,gr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Fh(r,new Map([["a_position",0]]),{geometry:[new xo("a_position",2,Qe.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Ct(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(n),r.useProgram(e);const{x:u,y:d,width:p,height:m}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(Et.TRIANGLE_STRIP,0,4),r.setViewport(u,d,p,m),n.readPixels(0,0,1,1,Tt.RGBA,Un.UNSIGNED_BYTE,s),a.dispose(),n.dispose();const y=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return y&&J.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),r.bindFramebuffer(c),y}};new xo("a_pos",2,Qe.BYTE,0,2);new xo("a_pos",2,Qe.BYTE,0,4),new xo("a_tex",2,Qe.BYTE,2,4);const Kbt={geometry:[new xo("a_pos",2,Qe.UNSIGNED_SHORT,0,4)]};let ewt=class extends sM{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new pr(1);i.wrapMode=Pt.CLAMP_TO_EDGE,i.samplingMode=At.NEAREST;const n=new hs(r,i),s=Ar.createVertex(r,gr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Fh(r,new Map([["a_pos",0]]),Kbt,{geometry:s}),a=new pr;a.samplingMode=At.LINEAR,a.wrapMode=Pt.CLAMP_TO_EDGE;const l=new Ct(r,a,bA);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:u,y:d,width:p,height:m}=r.getViewport();r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(yi.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(Et.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return n.readPixels(0,0,1,1,Tt.RGBA,Un.UNSIGNED_BYTE,y),o.dispose(),n.dispose(),l.dispose(),r.setViewport(u,d,p,m),r.bindFramebuffer(c),y[0]!==255}};const bA=new Image;bA.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",bA.width=5,bA.height=5,bA.decode();let twt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Qbt(e),this.svgPremultipliesAlpha=new ewt(e),this.doublePrecisionRequiresObfuscation=new Zbt(e),this.ignoresSamplerPrecision=new Jbt(e),this.drawArraysRequiresIndicesTypeReset=new Ybt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function rwt(t,e){if(e.disjointTimerQuery)return null;if(xp(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function iwt(t){if(xp(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function nwt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function swt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function owt(t,e){if(xp(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function awt(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function lwt(t,e){if(xp(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function cwt(t,e){if(xp(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function Ade(t,e,r,i,n){if(i&&xp(t))return!0;if(e[r])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function uwt(t,e){if(!xp(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function hwt(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function dwt(t,e){if(xp(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let pwt=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=rwt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=iwt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=dwt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=nwt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=swt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=awt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=ybt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=lwt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=cwt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=owt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Ade(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=hwt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=uwt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Ade(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},fwt=class{constructor(e,r){this.gl=e,this.instanceCounter=new Sbt,this.programCache=new Xbt(this),this._state=new fde,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=xp(e)?rr.WEBGL2:rr.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===rr.WEBGL1?null:this.gl}configure(e){this._capabilities=new pwt(this.gl,e),this._parameters=new Ebt(this.gl,this._capabilities,e),Ct.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new fde,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new uWe({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const n=i.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const n=i.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=i.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),Le(this._driverTest),this._driverTest=new twt(this)}dispose(){Le(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(bt.ARRAY_BUFFER),this.unbindBuffer(bt.ELEMENT_ARRAY_BUFFER),this.type===rr.WEBGL2&&(this.unbindBuffer(bt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(bt.PIXEL_PACK_BUFFER),this.unbindBuffer(bt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(bt.COPY_READ_BUFFER),this.unbindBuffer(bt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,eh()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,n){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,r,i,n),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,r,i,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,n){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(e,r,i,n),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,n){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(e,r,i,n),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(e,r,i,n),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=qd.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,r,i,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===qd.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=qd.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,r,i,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(Dk+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&yi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&yi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&yi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(eh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Ode(e,i)),this.gl.drawArrays(e,r,i),eh()){const n=yne(this);n&&console.error("drawArrays:",n)}}drawElements(e,r,i,n){if(eh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Ode(e,r)),this.gl.drawElements(e,r,i,n),eh()){const s=yne(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:r,type:i,offset:n},d=(a==null?void 0:a.size)??0,p=n+r,m=d<p?`. Buffer is too small. Attempted to draw index ${p} of ${d}`:"";console.error(`drawElements: ${s}${m}`,{args:u,vao:c})}}}logInfo(){eh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){eh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===r&&s.width===i&&s.height===n||(s.x=e,s.y=r,s.width=i,s.height=n,this.gl.viewport(e,r,i,n))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[r];return e==null||e.glName==null?(n!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[r]=null,n):i||n!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,n):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),n)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(mo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(mo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const n=r===mo.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),n?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,n=0,s=e.width,o=e.height,a=0,l=0,c=r.width,u=r.height,d=yi.COLOR_BUFFER_BIT,p=At.NEAREST){this.bindFramebufferSeparate(e,mo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,mo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,s,o,a,l,c,u,d,p)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case bt.ARRAY_BUFFER:this._state.vertexBuffer=jl(this.gl,e,r,this._state.vertexBuffer);break;case bt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=jl(this.gl,e,r,this._state.indexBuffer);break;case bt.UNIFORM_BUFFER:this._state.uniformBuffer=jl(this.gl,e,r,this._state.uniformBuffer);break;case bt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=jl(this.gl,e,r,this._state.pixelPackBuffer);break;case bt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=jl(this.gl,e,r,this._state.pixelUnpackBuffer);break;case bt.COPY_READ_BUFFER:this._state.copyReadBuffer=jl(this.gl,e,r,this._state.copyReadBuffer);break;case bt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=jl(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let n=i[r];return n==null&&(n={buffer:null,offset:0,size:0},i[r]=n),n}bindBufferBase(e,r,i){const n=this._getBufferBinding(e,r);n!=null&&(n.buffer===i&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0))}bindBufferRange(e,r,i,n,s){const o=this._getBufferBinding(e,r);if(o!=null&&!(o.buffer===i&&o.offset===n&&o.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,n,s),o.buffer=i,o.offset=n,o.size=s}}bindUBO(e,r,i,n){r!=null?(eh()&&(n??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&n!==void 0?this.bindBufferRange(bt.UNIFORM_BUFFER,e,r.buffer,i,n):this.bindBufferBase(bt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(bt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const n=this._state.uniformBufferBindingPoints[r];n!=null&&n.buffer===e.buffer&&this.bindBufferBase(bt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case bt.ARRAY_BUFFER:this._state.vertexBuffer=jl(this.gl,null,e,this._state.vertexBuffer);break;case bt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=jl(this.gl,null,e,this._state.indexBuffer);break;case bt.UNIFORM_BUFFER:this._state.uniformBuffer=jl(this.gl,null,e,this._state.uniformBuffer);break;case bt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=jl(this.gl,null,e,this._state.pixelPackBuffer);break;case bt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=jl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case bt.COPY_READ_BUFFER:this._state.copyReadBuffer=jl(this.gl,null,e,this._state.copyReadBuffer);break;case bt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=jl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(mj.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(Es.Sync,i),r.flush();do await XO(e),n=r.clientWaitSync(i,0,0);while(n===e5.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Es.Sync,i),r.deleteSync(i),n===e5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=mo.FRAMEBUFFER){return e===mo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(bt.ARRAY_BUFFER),this.unbindBuffer(bt.ELEMENT_ARRAY_BUFFER),this.type===rr.WEBGL2&&(this.unbindBuffer(bt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(bt.PIXEL_PACK_BUFFER),this.unbindBuffer(bt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(bt.COPY_READ_BUFFER),this.unbindBuffer(bt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(ve.ONE,ve.ZERO),this.setBlendEquation(Zf.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(qd.BACK),this.setFrontFace(NS.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Hr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Hr.ALWAYS,0,0),this.setStencilOp(_n.KEEP,_n.KEEP,_n.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)r.disableVertexAttribArray(l);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(bt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(bt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(bt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(c!=null){const{buffer:u,offset:d,size:p}=c;u!==null?d===0&&p===0?i.bindBufferBase(bt.UNIFORM_BUFFER,l,u.glName):i.bindBufferRange(bt.UNIFORM_BUFFER,l,u.glName,d,p):i.bindBufferBase(bt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(bt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(bt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(bt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(bt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(mo.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(mo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(qc.COLOR_ATTACHMENT0)),i.bindFramebuffer(mo.DRAW_FRAMEBUFFER,((s=this._state.drawFramebuffer)==null?void 0:s.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(mo.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}r.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){r.activeTexture(Dk+l),r.bindTexture(nn.TEXTURE_2D,null),r.bindTexture(nn.TEXTURE_CUBE_MAP,null),this.type===rr.WEBGL2&&(r.bindTexture(nn.TEXTURE_3D,null),r.bindTexture(nn.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];c!=null&&r.bindTexture(c.descriptor.target,c.glName)}r.activeTexture(Dk+this._state.activeTexture);const n=this._state.viewport;r.viewport(n.x,n.y,n.width,n.height),this.resetInfo()}_loadExtensions(){this.type===rr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function jl(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function Ode(t,e){switch(t){case Et.POINTS:return 2*e;case Et.TRIANGLES:return e/3;case Et.TRIANGLE_STRIP:case Et.TRIANGLE_FAN:return e-2;default:return 0}}let mwt=class extends fwt{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}bindTechnique(e,r,i,n){return this.useProgram(e.program),e.bindPipelineState(this,i==null?void 0:i.slot,!!n),e.program.bindPass(r,i),e.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new $Pe(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}},N2=class extends xe{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Bn,this._frameTask=e.view.resourceController.scheduler.registerTask(dt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(on.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(kJ,new zJ)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",dn.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return Je(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),n=new gwt(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&r.unload()})});return this._textures.set(e,n),n.ref(),r.glTexture!=null?(this._updateGLTexture(n,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=r.load(this._rctx),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,Zn(l)||J.getLogger(this).error(l),null);return Eu(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",dn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};h([f()],N2.prototype,"_loadingCount",void 0),h([f()],N2.prototype,"_frameTask",void 0),h([f()],N2.prototype,"updating",null),N2=h([N("esri.views.3d.webgl-engine.lib.TextureRepository")],N2);let gwt=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(J.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function ywt(t,e){return new OCe(r=>yst(r,t),r=>r,e)}let wA=class extends xe{constructor(){super(...arguments),this._passParameters=new _wt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=Le(this._passParameters.waveNormal),this._passParameters.wavePertubation=Le(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return bg.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return bg.LOADED;const r=new pr;return r.samplingMode=At.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.maxAnisotropy=8,++this._loading,qg(Ir("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Ct(e,{...r,width:i.width,height:i.height},i)).catch(i=>J.getLogger(this).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,qg(Ir("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Ct(e,{...r,width:i.width,height:i.height},i)).catch(i=>J.getLogger(this).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),bg.LOADING}};h([f()],wA.prototype,"_loading",void 0),h([f({type:Boolean,readOnly:!0})],wA.prototype,"updating",null),wA=h([N("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],wA);let _wt=class extends Wr{};const Rde=2048,vwt=1.5,bwt=8;function wwt(t,e){const{format:r,quality:i,rotation:n,disableDecorations:s}=t||{},o=IK(t,e.padding),a=Owt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=Awt(t,a),u=Mwt(r),d=Nwt[u];return{format:u,quality:ge(i??d,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function xwt(t,e){const r=wwt(t,e),i=r.area,n=r.width/i.width,s=IK(r,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*n+o),d=Math.floor(c*n+a),p=t&&t.layers?t.layers:[],m=r.ignoreBackground,y=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(i.x*n)+s.left,y:Math.floor(i.y*n)+s.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:n,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:y,objectAndLayerIdColor:!1}}function oB(t,e,r){const{ctx:i,canvas:n}=FPe(t,r),s=i.getImageData(0,0,t.width,t.height),o=Swt(n,e);return UPe(n),{dataUrl:o,data:s}}function aB(t,e){const{ctx:r,canvas:i}=FPe(t,e),n=r.getImageData(0,0,t.width,t.height);return UPe(i),n}function FPe(t,e){const r=Twt();e.premultipliedAlpha&&Iwt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&$wt(i),{ctx:i,canvas:r}}function UPe(t){t.width=0,t.height=0}function Twt(){return lB==null&&(lB=document.createElement("canvas")),lB}let lB=null;function Swt(t,e){const r=Lwt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function Ewt(t,e,r,i=0,n=0,s=t.width-i,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:u,data:d}=e,p=s/c,m=o/u,y=Math.ceil(p/2),_=Math.ceil(m/2),v=t.width;for(let b=0;b<u;b++)for(let x=0;x<c;x++){const T=4*(x+(a?u-b-1:b)*c);let S=0,A=0,C=0,R=0,P=0,F=0;const k=(b+.5)*m;for(let V=Math.floor(b*m);V<(b+1)*m;V++){const z=Math.abs(k-(V+.5))/_,X=(x+.5)*p,q=z*z;for(let G=Math.floor(x*p);G<(x+1)*p;G++){const Q=Math.abs(X-(G+.5))/y,M=Math.sqrt(q+Q*Q);if(M>=1)continue;let I=2*M*M*M-3*M*M+1;const L=4*(i+G+(n+V)*v);F+=I*l[L+3],A+=I,!r&&l[L+3]<255&&(I=I*l[L+3]/255),C+=I*l[L],R+=I*l[L+1],P+=I*l[L+2],S+=I}}d[T]=C/S,d[T+1]=R/S,d[T+2]=P/S,d[T+3]=F/A}return e}function Cwt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:o}=t,a=IK(t,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,d=n-c,p=Math.min(bwt,Math.min((Rde-l)/u,(Rde-c)/d));return p<vwt?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(d*p)+c,pixelRatio:s*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:i,height:n}}}function Awt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const n=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}function Owt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&n!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(i==null&&n!=null){const s=Math.min(r.width,i);r.height=s/r.width*r.height,r.width=s}else if(i!=null&&n==null){const s=Math.min(r.height,n);r.width=s/r.height*r.width,r.height=s}}return Rwt(Pwt(r,t),e)}function Rwt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),n={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),u=n.height-c;return{x:n.x,y:Math.floor(n.y+u/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function Pwt(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const s=Math.floor(t.height*r);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/r);return t.y-=(n-t.height)/2,t.height=n,t}function IK(t,e){return!e||t&&t.ignorePadding?Fwt:e}function Mwt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Dwt}}function $wt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Iwt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const n=e[i+3];if(n!==255&&n>0){const s=255/n;e[i]=e[i]*s,e[i+1]=e[i+1]*s,e[i+2]=e[i+2]*s}}}const Lwt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Pde=98,Dwt="png",Nwt={png:100,jpg:Pde,jpeg:Pde},Fwt={top:0,right:0,bottom:0,left:0};let Uwt=class{constructor(e,r){this.parameters=e,this.frameHasDecorations=r}},kwt=class{constructor(e,r,i,n){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=n,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(dn.BACKGROUND);const r=Wo();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const n={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const n=e.getContext("2d"),s=i.pixelRatio;return n.save(),n.translate(0,r.height),n.scale(1,-1),i.region&&n.translate(-i.region.x,-i.region.y),n.scale(s,s),r=this._renderFunctions.renderOverlay(e,r),n.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=sz(i,n,a);this._rctx.gl.readPixels(0,0,i,n,Tt.RGBA,Qe.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=sz(s.width,s.height,a);return Ewt(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=sz(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,Tt.RGBA,Qe.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,r,i){let n=null;const s=e.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};_b(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&e.frameHasDecorations,c=o.width!==s.fullWidth||o.height!==s.fullHeight,u=r.ignorePadding&&s.pixelRatio!==r.pixelRatio,d=c||l||u||r.objectAndLayerIdColor,p=r.objectAndLayerIdColor?new hs(this._rctx,new pr(o.width,o.height),new n5(jn.DEPTH_STENCIL,o.width,o.height)):null;if(d){const v=s.clone();if(r.ignorePadding){const A=PP(v.padding);for(let C=0;C<4;C++)A[C]=Math.round(A[C]/v.pixelRatio*r.pixelRatio);v.padding=A}v.fullWidth=o.width,v.fullHeight=o.height,v.pixelRatio=r.pixelRatio;const b=s.fovX-v.fovX,x=s.fovY-v.fovY;b<0&&b<x?v.fovX=s.fovX:x<0&&x<b&&(v.fovY=s.fovY);const T={camera:v,contentCamera:v,mode:Cr.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(T),a=!0,n=new hs(this._rctx,new pr(o.width,o.height),new n5(jn.DEPTH_STENCIL,o.width,o.height));const S=r.disableDecorations?hw.OFF:hw.ON;this._renderFunctions.renderScene(n,p,T,S,i),this._disposeOffscreenBuffers()}const m=()=>{this._rctx.bindFramebuffer(null),Le(n)},y=this._readbackScreenshot(r,m);m();let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),Le(p)};this._rctx.bindFramebuffer(p),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null),v()}if(d&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return a&&this._forceCameraHook(e.parameters),[y,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Ns=class extends xe{constructor(e){super({}),this.events=new Bn,this.waterTextureRepository=new wA,this._magnifierHelper=new D2,this.objectAndLayerIdRenderHelper=se("enable-feature:objectAndLayerId-rendering")?new z1t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([ue(()=>{var n;return(n=this.waterTextureRepository)==null?void 0:n.updating},()=>this.requestRender(),Pr),ue(()=>e.view.qualityProfile,n=>{var s;return(s=this.renderer)==null?void 0:s.updateRenderFeature(n)},An),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextureRepository=ast(this._rctx,r),this.markerTextureRepository=ywt(this._rctx,r),this._shaderTechniqueRepository=new xCe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new N2(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",n=>this.requestRender(n))),this._materialRepository=new TCe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new _1t(this._rctx,this._shaderTechniqueRepository),this.renderer=new Yl(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,n=>this.requestRender(n));const i={renderScene:(n,s,o,a,l)=>this.renderer.render(n,s,o,a,l),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(n,s)=>e.options.screenshot.renderOverlay(n,s)};this._screenshotManager=new kwt(this._rctx,i,n=>this.events.emit("force-camera-for-screenshot",n),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Pi(this._frameTask),this._shaderTechniqueRepository=Me(this._shaderTechniqueRepository)}requestRender(e=dn.UPDATE){this._needsRender=!0,e===dn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,n,s,o=s){const a=n.constrainWindowSize(r,i,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const d=T1t(4*u,l,n.nearFar);c>d&&d!==n.nearFar[0]&&d!==n.nearFar[1]&&(c=d)}if(e!=null){const u=e.pickDepth(r*n.pixelRatio,i*n.pixelRatio,n);u!=null&&c>u&&u!==n.nearFar[0]&&u!==n.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){ROe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,n=dn.BACKGROUND,s=!1;const o={preRender:({time:a})=>{i=this.updating,n=this._needsUpdate?dn.UPDATE:dn.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new gSe(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(dn.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,hw.ON,a),s=!0,l&&this.renderer.hasReflections&&(this.requestRender(dn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new Uwt(r,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{s&&(this.renderer.finish(r.mode===Cr.IDLE?n:dn.UPDATE),s=!1)}};this._frameTask=fS(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},n=pWe("3d",this._canvas,i);n!=null?(this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&J.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&se("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):J.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>r.view.resourceController.memoryController.newCache(s,o);return new mwt(e,i,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new s1t(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};h([f({type:Boolean,readOnly:!0})],Ns.prototype,"updating",null),h([f({autoDestroy:!0})],Ns.prototype,"_rctx",void 0),h([f({autoDestroy:!0})],Ns.prototype,"_container",void 0),h([f({autoDestroy:!0})],Ns.prototype,"_canvas",void 0),h([f({autoDestroy:!0})],Ns.prototype,"stippleTextureRepository",void 0),h([f({autoDestroy:!0})],Ns.prototype,"markerTextureRepository",void 0),h([f({autoDestroy:!0})],Ns.prototype,"waterTextureRepository",void 0),h([f({autoDestroy:!0})],Ns.prototype,"_magnifierHelper",void 0),h([f({readOnly:!0})],Ns.prototype,"objectAndLayerIdRenderHelper",void 0),h([f({autoDestroy:!0})],Ns.prototype,"_textureRepository",void 0),h([f({autoDestroy:!0})],Ns.prototype,"_compositingHelper",void 0),h([f({autoDestroy:!0,readOnly:!0})],Ns.prototype,"renderer",void 0),h([f({autoDestroy:!0})],Ns.prototype,"_screenshotManager",void 0),h([f()],Ns.prototype,"componentObjectCollection",null),h([f({autoDestroy:!0})],Ns.prototype,"_componentObjectCollection",void 0),h([f()],Ns.prototype,"_needsUpdate",void 0),h([f()],Ns.prototype,"_needsWaterReflectionUpdate",void 0),Ns=h([N("esri.views.3d.webgl-engine.parts.RenderView")],Ns);let Gc=class extends xe{constructor(e){super(e),this._model=new lN,this._layers=new Nt,this._asyncChangeSet=new KH,this._syncChangeSet=new KH,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Ns(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(dt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),F5(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),F5(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}async load(e,r){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>i.glTexture==null).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const n=this._layerSyncSet.has(i.id)||i.updatePolicy===O_.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,s),this._layerSyncSet.delete(i.id),s.empty||(this.renderer.modify(s,n?Wa:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wa),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==O_.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===O_.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wa),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Wa),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Wa))}addRenderPlugin(e,r,i){const n=this.renderer.renderPlugins.add(e,r,i),s=()=>{pce(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(Eu(n))return n.then(s);s()}removeRenderPlugin(e){this.destroyed||(pce(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};Gc.DebugSettings={endFrameContentValidation:!1},h([f({constructOnly:!0})],Gc.prototype,"view",void 0),h([f({constructOnly:!0})],Gc.prototype,"options",void 0),h([f({readOnly:!0})],Gc.prototype,"viewingMode",null),h([f({constructOnly:!0})],Gc.prototype,"container",void 0),h([f({readOnly:!0})],Gc.prototype,"updating",null),h([f({constructOnly:!0})],Gc.prototype,"_model",void 0),h([f({autoDestroy:!0})],Gc.prototype,"renderView",void 0),h([f({readOnly:!0})],Gc.prototype,"renderer",null),h([f({readOnly:!0})],Gc.prototype,"running",null),Gc=h([N("esri.views.3d.webgl-engine.Stage")],Gc);let bkt=class extends u8{constructor(e,r,i,n){super(r,i),this.point=e,this.createGraphic=n}};function kPe(t){return bp(t)&&t.intersector===Ui.PCL&&!!t.target}let xkt=class extends k2e{constructor(e,r,i,n,s){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=n,this.triangleNr=s}},Skt=class extends u8{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function aU(t){return bp(t)&&t.intersector===Ui.I3S&&!!t.target}function zPe(t){return bp(t)&&t.intersector===Ui.VOXEL&&!!t.target}function Mde(t,e){var r,i;return h8(t)||d8(t)?ZR((r=t.target)==null?void 0:r.object,e):Ust(t)?(i=e.map)==null?void 0:i.ground:kPe(t)||aU(t)||jCe(t)||zPe(t)?ZR(t.target,e):null}function Ckt(t,e){const r=YW(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function YW(t,e){var r;if(t==null)return null;if(h8(t)||d8(t))return $de((r=t.target)==null?void 0:r.object,e);if(kPe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(zPe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return jCe(t)||rK(t)?$de(t.target,e):aU(t)?zwt(t.target,e):null}function $de(t,e){if(t==null||t.graphicUid==null)return null;const r=ZR(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(n=>n.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function zwt(t,e){const r=ZR(t,e);if(r==null)return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?Vwt(i.getGraphicFromIntersectorTarget(t)):null}function Bwt(t,e){const r=ZR(t,e);if(r==null)return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function Vwt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function ZR(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function Akt(t,e){if(h8(t)||d8(t))return vg(t.target.object.boundingVolumeWorldSpace.bounds);if(rK(t)){dve(fL,t.transformation);const r=Math.max(fL[0],fL[1],fL[2]);return t.target.baseBoundingSphere.radius*r}return aU(t)?_h(Bwt(t.target,e),r=>.5*S1e(r)):null}function Okt(t){return!h8(t)&&!d8(t)&&(rK(t)?t.target.numLodLevels>1:!!aU(t))}const fL=O();async function Gwt(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+jwt),n=r.results.findIndex(s=>(s.distance??0)>i);return n!==-1&&(r.results=r.results.slice(0,n)),r}const jwt=.05;function Rkt(t){return t&&typeof t.highlight=="function"}function Hwt(t){return t&&typeof t.maskOccludee=="function"}function Pkt(t,e,r){return t==null||t>r&&(e===0||t<e)}function Mkt(t,e){return t!=null&&t>0||e!=null&&e>0}function $kt(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let cB,uB;function Wwt(t){const e=pxe(t);for(;e.length>1;){const r=Ide(e.shift());if(r.available)return r}return Ide(e.shift())}function Ide(t){switch(t){case rr.WEBGL1:return qwt();case rr.WEBGL2:return Xwt()}}function qwt(){return cB||(cB=Qwt()),cB}function Xwt(){return uB||(uB=Jwt()),uB}let BPe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},Ywt=class extends BPe{constructor(){super(...arguments),this.type=rr.WEBGL1}},Zwt=class extends BPe{constructor(){super(...arguments),this.type=rr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function VPe(t,e){if(t===rr.WEBGL1&&typeof WebGLRenderingContext>"u"||t===rr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=yj(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=yj(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===rr.WEBGL1){const s=i.getParameter(i.VERSION),o=s==null?void 0:s.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),i}function Qwt(){const t=new Ywt,e=VPe(rr.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function Jwt(){const t=new Zwt,e=VPe(rr.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function Kwt(t){const e=Wwt(t);if(!e.available)return new Y("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new Y("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new Y("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new Y("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===rr.WEBGL1){if(!e.supportsElementIndexUint)return new Y("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new Y("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new Y("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function ext(t){return t&&"nodeType"in t}function txt(t){return t&&typeof t.render=="function"}const Lde={component:"esri-component"};let Vv=class extends xe{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(Lde.component),r&&r.classList.remove(Lde.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||ext(e)?(this._set("widget",null),R6(e)):(txt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};h([f({dependsOn:[]})],Vv.prototype,"id",null),h([f()],Vv.prototype,"node",null),h([_i("node")],Vv.prototype,"castNode",null),h([f({readOnly:!0})],Vv.prototype,"widget",void 0),Vv=h([N("esri.views.ui.Component")],Vv);const pN=Vv,GPe="calcite-mode-";function rxt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function ixt(){return rxt().startsWith("dark")}function nxt(){return`${GPe}${ixt()?"dark":"light"}`}function sxt(t){oxt(t),t.classList.add(nxt())}function oxt(t){Array.from(t.classList).forEach(e=>{e.startsWith(GPe)&&t.classList.remove(e)})}const axt={left:0,top:0,bottom:0,right:0},jPe={bottom:30,top:15,right:15,left:15},Mm="esri-ui",Hl={ui:Mm,corner:`${Mm}-corner`,innerContainer:`${Mm}-inner-container`,manualContainer:`${Mm}-manual-container`,cornerContainer:`${Mm}-corner-container`,topLeft:`${Mm}-top-left`,topRight:`${Mm}-top-right`,bottomLeft:`${Mm}-bottom-left`,bottomRight:`${Mm}-bottom-right`};function lxt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function mL(t){return t===0?"0":`${t}px`}function hB(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function dB(t,{top:e,bottom:r,left:i,right:n}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=n}let hf=class extends Bn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=ep(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&dB(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&dB(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([ue(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Pr),ue(()=>this.padding,this._applyUIPadding,Pr),ue(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},Pr),j0e(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(Hl.ui),sxt(e),this._attachContainers(e)),r&&(r.classList.remove(Hl.ui),dB(r,{top:"",bottom:"",left:"",right:""}),tve(r)),this._set("container",e))}get height(){var s;const e=((s=this.view)==null?void 0:s.height)??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:n}=r;return Math.max(e-i-n,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...jPe,...e}}get width(){var s;const e=((s=this.view)==null?void 0:s.width)??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:n}=r;return Math.max(e-i-n,0)}add(e,r){let i,n,s;if(Array.isArray(e))return void e.forEach(a=>this.add(a,r));const o=hB(e);o&&({index:i,position:r,component:e,key:n}=o),r&&typeof r=="object"&&({index:i,key:n,position:r,internal:s}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,n,s)}remove(e,r){var n;if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,r));const i=this._find(e);if(i){if(this._componentMap.has(e)&&((n=this._componentMap.get(e))==null?void 0:n.key)!==r)return;const s=this._components.indexOf(i),o=i.node.parentNode;return o==null||o.removeChild(i.node),this._componentMap.delete(e),this._components.splice(s,1)[0]}}empty(e,r={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,r);return}const i=this._positionNameToContainerLookup[e??"manual"],n=Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(s=>{var o;return s==null?!1:!(((o=this._componentMap.get(s))==null?void 0:o.internal)??!1)||r.removeInternal});for(const s of n)this.remove(s)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const n=hB(e)||hB(r);if(n&&(i=n.index,r=n.position,e=n.component||e),r&&!this._isValidPosition(r))return;const s=this.remove(e);s&&this.add(s,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e,r={includeInternal:!1}){return e?Array.isArray(e)?e.map(i=>this._getComponentsAtPosition(i,r)).flat():this._getComponentsAtPosition(e,r):this._components.filter(i=>{var n;return r.includeInternal||!((n=this._componentMap.get(i))!=null&&n.internal)}).map(({widget:i,node:n})=>i??n)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,n,s){e instanceof pN||(e=new pN({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),this._componentMap.set(e,{key:n,internal:s})}_find(e){return e?e instanceof pN?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??axt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Hl.innerContainer,Hl.cornerContainer);const r=document.createElement("div");r.classList.add(Hl.innerContainer,Hl.manualContainer);const i=document.createElement("div");i.classList.add(Hl.topLeft,Hl.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add(Hl.topRight,Hl.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(Hl.bottomLeft,Hl.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(Hl.bottomRight,Hl.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=bGe();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:i,"top-trailing":a?i:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:n}=e,s=this._positionNameToContainerLookup[r],o=n!=null&&n>-1;if(lxt(i.widget)&&i.widget.startup(),!o)return void s.appendChild(i.node);const a=Array.from(s.children);if(n===0)return void(s.firstChild?Wre(i.node,s.firstChild):s.appendChild(i.node));n>=a.length?s.appendChild(i.node):Wre(i.node,a[n])}_toPixelPosition(e){return{top:mL(e.top),left:mL(e.left),right:mL(e.right),bottom:mL(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e,r){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(aP).filter(n=>{var s;return r.includeInternal||!((s=this._componentMap.get(n))!=null&&s.internal)}).map(({widget:n,node:s})=>n??s)}};h([f()],hf.prototype,"_locale",void 0),h([f()],hf.prototype,"container",null),h([f()],hf.prototype,"height",null),h([f({value:jPe})],hf.prototype,"padding",null),h([_i("padding")],hf.prototype,"castPadding",null),h([f()],hf.prototype,"view",void 0),h([f()],hf.prototype,"width",null),hf=h([N("esri.views.ui.UI")],hf);const cxt=hf,uxt="randomUUID"in crypto;function HPe(){if(uxt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function Ukt(){return`{${HPe()}}`}const hxt={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},dxt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},pxt=t=>({...dxt,...t}),fxt=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},mxt=(t,e)=>t.find(e),Dde=(t,e,r=!1)=>{let i=t;return e.forEach((n,s)=>{const o=i!=null&&i.children?mxt(i.children,a=>a.domNode===n):void 0;r&&!o&&s!==e.length-1||(i=o)}),i},gxt=t=>{let e;const r={...hxt,...t},i=pxt(r),n=i.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(p,m,y)=>{var b;let _;i.eventHandlerInterceptor=(x,T,S,A)=>function(C){let R;n("domEvent",C);const P=fxt(C.currentTarget,_.domNode),F=P.some(V=>{var z;return customElements.get((z=V==null?void 0:V.tagName)==null?void 0:z.toLowerCase())});if(C.eventPhase===Event.CAPTURING_PHASE||!F)P.reverse(),R=Dde(_.getLastRender(),P);else{const V=C.composedPath(),z=V.slice(V.indexOf(C.currentTarget),V.indexOf(_.domNode)).filter(X=>X.getRootNode()===X.ownerDocument).reverse();R=Dde(_.getLastRender(),z,!0)}let k;return R&&(k=r.handleInterceptedEvent(e,R,this,C)),n("domEventProcessed",C),k},(b=r.postProcessProjectionOptions)==null||b.call(r,i);const v=y();_=p(m,v,i),l.push(_),c.push(y),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let d=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let p=0;p<l.length;p++){const m=c[p]();n("rendered",void 0),l[p].update(m),n("patched",void 0)}n("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(d=r.modifyDoRenderImplementation(d,l,c)),e={renderNow:d,scheduleRender:()=>{s||a||(s=requestAnimationFrame(d))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,m)=>{u(u_.append,p,m)},insertBefore:(p,m)=>{u(u_.insertBefore,p,m)},merge:(p,m)=>{u(u_.merge,p,m)},replace:(p,m)=>{u(u_.replace,p,m)},detach:p=>{for(let m=0;m<c.length;m++)if(c[m]===p)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},F2={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let U2,WPe,lU,qPe=!1,dF=!1,LK=!1,Kc=!1,Nde=null,ZW=!1;const yxt=t=>{const e=new URL(t,qo.$resourcesUrl$);return e.origin!==lM.location.origin?e.href:e.pathname},_xt=t=>qo.$resourcesUrl$=t,Cw=(t,e="")=>()=>{},Fde="http://www.w3.org/1999/xlink",Ude={},vxt="http://www.w3.org/2000/svg",bxt="http://www.w3.org/1999/xhtml",wxt=t=>t!=null,DK=t=>(t=typeof t,t==="object"||t==="function");function xxt(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const XPe=(t,e,...r)=>{let i=null,n=null,s=null,o=!1,a=!1;const l=[],c=d=>{for(let p=0;p<d.length;p++)i=d[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!DK(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?pF(null,i):i),a=o)};if(c(r),e){e.key&&(n=e.key),e.name&&(s=e.name);{const d=e.className||e.class;d&&(e.class=typeof d!="object"?d:Object.keys(d).filter(p=>d[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,Ext);const u=pF(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=n,u.$name$=s,u},pF=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},Txt={},Sxt=t=>t&&t.$tag$===Txt,Ext={forEach:(t,e)=>t.map(kde).forEach(e),map:(t,e)=>t.map(kde).map(e).map(Cxt)},kde=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),Cxt=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),XPe(t.vtag,r,...t.vchildren||[])}const e=pF(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},Axt=t=>e2t.map(e=>e(t)).find(e=>!!e),Oxt=(t,e)=>t!=null&&!DK(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,Rxt=t=>t,kkt=(t,e,r)=>{const i=Rxt(t);return{emit:n=>Pxt(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:n})}},Pxt=(t,e,r)=>{const i=qo.ce(e,r);return t.dispatchEvent(i),i},zde=new WeakMap,Mxt=(t,e,r)=>{let i=mF.get(t);i2t&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,mF.set(t,i)},$xt=(t,e,r,i)=>{var n;let s=YPe(e,r);const o=mF.get(s);if(t=t.nodeType===11?t:sp,o)if(typeof o=="string"){t=t.head||t;let a=zde.get(t),l;if(a||zde.set(t,a=new Set),!a.has(s)){{l=sp.createElement("style"),l.innerHTML=o;const c=(n=qo.$nonce$)!==null&&n!==void 0?n:xxt(sp);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(s)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return s},Ixt=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,n=Cw("attachStyles",e.$tagName$),s=$xt(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=s,r.classList.add(s+"-h"),i&2&&r.classList.add(s+"-s")),n()},YPe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Bde=(t,e,r,i,n,s)=>{if(r!==i){let o=Hde(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Vde(r),u=Vde(i);l.remove(...c.filter(d=>d&&!u.includes(d))),l.add(...u.filter(d=>d&&!c.includes(d)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):Hde(lM,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&qo.rel(t,e,r,!1),i&&qo.ael(t,e,i,!1);else{const l=DK(i);if((o||l&&i!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=i;else{const u=i??"";e==="list"?o=!1:(r==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Fde,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(Fde,e,i):t.setAttribute(e,i))}}},Lxt=/\s/,Vde=t=>t?t.split(Lxt):[],ZPe=(t,e,r,i)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||Ude,o=e.$attrs$||Ude;for(i in s)i in o||Bde(n,i,s[i],void 0,r,e.$flags$);for(i in o)Bde(n,i,s[i],o[i],r,e.$flags$)},fF=(t,e,r,i)=>{const n=e.$children$[r];let s=0,o,a,l;if(qPe||(LK=!0,n.$tag$==="slot"&&(U2&&i.classList.add(U2+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)o=n.$elm$=sp.createTextNode(n.$text$);else if(n.$flags$&1)o=n.$elm$=sp.createTextNode("");else{if(Kc||(Kc=n.$tag$==="svg"),o=n.$elm$=sp.createElementNS(Kc?vxt:bxt,n.$flags$&2?"slot-fb":n.$tag$),Kc&&n.$tag$==="foreignObject"&&(Kc=!1),ZPe(null,n,Kc),wxt(U2)&&o["s-si"]!==U2&&o.classList.add(o["s-si"]=U2),n.$children$)for(s=0;s<n.$children$.length;++s)a=fF(t,n,s,o),a&&o.appendChild(a);n.$tag$==="svg"?Kc=!1:o.tagName==="foreignObject"&&(Kc=!0)}return o["s-hn"]=lU,n.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=WPe,o["s-sn"]=n.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===n.$tag$&&t.$elm$&&QR(t.$elm$,!1)),o},QR=(t,e)=>{qo.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const n=r[i];n["s-hn"]!==lU&&n["s-ol"]&&(KPe(n).insertBefore(n,NK(n)),n["s-ol"].remove(),n["s-ol"]=void 0,LK=!0),e&&QR(n,e)}qo.$flags$&=-2},QPe=(t,e,r,i,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===lU&&(o=o.shadowRoot);n<=s;++n)i[n]&&(a=fF(null,r,n,t),a&&(i[n].$elm$=a,o.insertBefore(a,NK(e))))},JPe=(t,e,r,i,n)=>{for(;e<=r;++e)(i=t[e])&&(n=i.$elm$,rMe(i),dF=!0,n["s-ol"]?n["s-ol"].remove():QR(n,!0),n.remove())},Dxt=(t,e,r,i)=>{let n=0,s=0,o=0,a=0,l=e.length-1,c=e[0],u=e[l],d=i.length-1,p=i[0],m=i[d],y,_;for(;n<=l&&s<=d;)if(c==null)c=e[++n];else if(u==null)u=e[--l];else if(p==null)p=i[++s];else if(m==null)m=i[--d];else if(gL(c,p))k2(c,p),c=e[++n],p=i[++s];else if(gL(u,m))k2(u,m),u=e[--l],m=i[--d];else if(gL(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&QR(c.$elm$.parentNode,!1),k2(c,m),t.insertBefore(c.$elm$,u.$elm$.nextSibling),c=e[++n],m=i[--d];else if(gL(u,p))(c.$tag$==="slot"||m.$tag$==="slot")&&QR(u.$elm$.parentNode,!1),k2(u,p),t.insertBefore(u.$elm$,c.$elm$),u=e[--l],p=i[++s];else{for(o=-1,a=n;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===p.$key$){o=a;break}o>=0?(_=e[o],_.$tag$!==p.$tag$?y=fF(e&&e[s],r,o,t):(k2(_,p),e[o]=void 0,y=_.$elm$),p=i[++s]):(y=fF(e&&e[s],r,s,t),p=i[++s]),y&&KPe(c.$elm$).insertBefore(y,NK(c.$elm$))}n>l?QPe(t,i[d+1]==null?null:i[d+1].$elm$,r,i,s,d):s>d&&JPe(e,n,l)},gL=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,NK=t=>t&&t["s-ol"]||t,KPe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,k2=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,n=e.$children$,s=e.$tag$,o=e.$text$;let a;o===null?(Kc=s==="svg"?!0:s==="foreignObject"?!1:Kc,s==="slot"||ZPe(t,e,Kc),i!==null&&n!==null?Dxt(r,i,e,n):n!==null?(t.$text$!==null&&(r.textContent=""),QPe(r,null,e,n,0,n.length-1)):i!==null&&JPe(i,0,i.length-1),Kc&&s==="svg"&&(Kc=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},eMe=t=>{const e=t.childNodes;let r,i,n,s,o,a;for(i=0,n=e.length;i<n;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,s=0;s<n;s++)if(a=e[s].nodeType,e[s]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[s].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[s].textContent.trim()!==""){r.hidden=!0;break}}eMe(r)}},Vd=[],tMe=t=>{let e,r,i,n,s,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,n=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(Gde(r,n)?(s=Vd.find(u=>u.$nodeToRelocate$===r),dF=!0,r["s-sn"]=r["s-sn"]||n,s?s.$slotRefNode$=e:Vd.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&Vd.map(u=>{Gde(u.$nodeToRelocate$,r["s-sn"])&&(s=Vd.find(d=>d.$nodeToRelocate$===r),s&&!u.$slotRefNode$&&(u.$slotRefNode$=s.$slotRefNode$))})):Vd.some(u=>u.$nodeToRelocate$===r)||Vd.push({$nodeToRelocate$:r}));e.nodeType===1&&tMe(e)}},Gde=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",rMe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(rMe)},Nxt=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,n=t.$vnode$||pF(null,null),s=Sxt(e)?e:XPe(null,null,e);lU=r.tagName,i.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>s.$attrs$[a]=r[o])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=r.shadowRoot||r,U2=r["s-sc"],WPe=r["s-cr"],qPe=(i.$flags$&1)!==0,dF=!1,k2(n,s);{if(qo.$flags$|=1,LK){tMe(s.$elm$);let o,a,l,c,u,d,p=0;for(;p<Vd.length;p++)o=Vd[p],a=o.$nodeToRelocate$,a["s-ol"]||(l=sp.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(p=0;p<Vd.length;p++)if(o=Vd[p],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,u=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(d=l["s-nr"],d&&d["s-sn"]===a["s-sn"]&&c===d.parentNode&&(d=d.nextSibling,!d||!d["s-nr"])){u=d;break}(!u&&c!==a.parentNode||a.nextSibling!==u)&&a!==u&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,u))}else a.nodeType===1&&(a.hidden=!0)}dF&&eMe(s.$elm$),qo.$flags$&=-2,Vd.length=0}},Fxt=(t,e)=>{},FK=(t,e)=>(t.$flags$|=16,Fxt(t,t.$ancestorComponent$),s2t(()=>Uxt(t,e))),Uxt=(t,e)=>{const r=t.$hostElement$,i=Cw("scheduleUpdate",t.$cmpMeta$.$tagName$),n=r;let s;return e?s=tS(n,"componentWillLoad"):s=tS(n,"componentWillUpdate"),s=jde(s,()=>tS(n,"componentWillRender")),i(),jde(s,()=>kxt(t,n,e))},kxt=async(t,e,r)=>{const i=t.$hostElement$,n=Cw("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&Ixt(t);const s=Cw("render",t.$cmpMeta$.$tagName$);zxt(t,e,i),s(),n(),Bxt(t)},zxt=(t,e,r)=>{try{Nde=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(F2.hasRenderFn||F2.reflect)&&(F2.vdomRender||F2.reflect)&&(F2.hydrateServerSide||Nxt(t,e))}catch(a){aM(a,t.$hostElement$)}return Nde=null,null},Bxt=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=Cw("postUpdate",e),n=r;t.$ancestorComponent$,tS(n,"componentDidRender"),t.$flags$&64?(tS(n,"componentDidUpdate"),i()):(t.$flags$|=64,tS(n,"componentDidLoad"),i())},zkt=t=>{{const e=oM(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&FK(e,!1),r}},tS=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){aM(i)}},jde=(t,e)=>t&&t.then?t.then(e):e(),Vxt=(t,e)=>oM(t).$instanceValues$.get(e),Gxt=(t,e,r,i)=>{const n=oM(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;r=Oxt(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){n.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const d=i.$watchers$[e];d&&d.map(p=>{try{l[p](r,o,e)}catch(m){aM(m,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;FK(n,!1)}}}},jxt=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),n=t.prototype;i.map(([s,[o]])=>{(o&31||o&32)&&Object.defineProperty(n,s,{get(){return Vxt(this,s)},set(a){Gxt(this,s,a,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(o,a,l){qo.jmp(()=>{const c=s.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return s.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},Hxt=async(t,e,r,i,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=Axt(t)]);const a=YPe(r,e.$modeName$);if(!mF.has(a)){const l=Cw("registerStyles",r.$tagName$);Mxt(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>FK(e,!0))()},Wxt=t=>{},qxt=t=>{if(!(qo.$flags$&1)){const e=oM(t),r=e.$cmpMeta$,i=Cw("connectedCallback",r.$tagName$);e.$flags$&1?(iMe(t,e,r.$listeners$),Wxt(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&Xxt(t),r.$members$&&Object.entries(r.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),Hxt(t,e,r)),i()}},Xxt=t=>{const e=t["s-cr"]=sp.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},Yxt=t=>{if(!(qo.$flags$&1)){const e=oM(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},Bkt=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){Kxt(this,r)},connectedCallback(){qxt(this),i&&i.call(this)},disconnectedCallback(){Yxt(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,jxt(t,r)},Vkt=(t,e)=>e,iMe=(t,e,r,i)=>{r&&r.map(([n,s,o])=>{const a=Qxt(t,n),l=Zxt(e,o),c=Jxt(n);qo.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>qo.rel(a,s,l,c))})},Zxt=(t,e)=>r=>{try{F2.lazyLoad||t.$hostElement$[e](r)}catch(i){aM(i)}},Qxt=(t,e)=>e&4?sp:e&8?lM:e&16?sp.body:t,Jxt=t=>t2t?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,nMe=new WeakMap,oM=t=>nMe.get(t),Kxt=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return iMe(t,r,e.$listeners$),nMe.set(t,r)},Hde=(t,e)=>e in t,aM=(t,e)=>(0,console.error)(t,e),mF=new Map,e2t=[],lM=typeof window<"u"?window:{},sp=lM.document||{head:{}},Gkt=lM.HTMLElement||class{},qo={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},t2t=(()=>{let t=!1;try{sp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),r2t=t=>Promise.resolve(t),i2t=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),QW=[],sMe=[],oMe=(t,e)=>r=>{t.push(r),ZW||(ZW=!0,e&&qo.$flags$&4?n2t(JW):qo.raf(JW))},Wde=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){aM(r)}t.length=0},JW=()=>{Wde(QW),Wde(sMe),(ZW=QW.length>0)&&qo.raf(JW)},n2t=t=>r2t().then(t),jkt=oMe(QW,!1),s2t=oMe(sMe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.6.1
 */const aMe="calcite-mode-auto",lMe="calcite-mode-dark",o2t="calcite-mode-light",Hkt={autoMode:aMe,darkMode:lMe,lightMode:o2t,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var cMe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],gF=cMe.join(","),uMe=typeof Element>"u",Aw=uMe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,yF=!uMe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},_F=function t(e,r){var i;r===void 0&&(r=!0);var n=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),s=n===""||n==="true",o=s||r&&e&&t(e.parentNode);return o},a2t=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},hMe=function(e,r,i){if(_F(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(gF));return r&&Aw.call(e,gF)&&n.unshift(e),n=n.filter(i),n},dMe=function t(e,r,i){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(!_F(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var u=Aw.call(o,gF);u&&i.filter(o)&&(r||!e.includes(o))&&n.push(o);var d=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),p=!_F(d,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(d&&p){var m=t(d===!0?o.children:d.children,!0,i);i.flatten?n.push.apply(n,m):n.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return n},pMe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},fMe=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||a2t(e))&&!pMe(e)?0:e.tabIndex},l2t=function(e,r){var i=fMe(e);return i<0&&r&&!pMe(e)?0:i},c2t=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},mMe=function(e){return e.tagName==="INPUT"},u2t=function(e){return mMe(e)&&e.type==="hidden"},h2t=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},d2t=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},p2t=function(e){if(!e.name)return!0;var r=e.form||yF(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=i(window.CSS.escape(e.name));else try{n=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=d2t(n,e.form);return!s||s===e},f2t=function(e){return mMe(e)&&e.type==="radio"},m2t=function(e){return f2t(e)&&!p2t(e)},g2t=function(e){var r,i=e&&yF(e),n=(r=i)===null||r===void 0?void 0:r.host,s=!1;if(i&&i!==e){var o,a,l;for(s=!!((o=n)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&n;){var c,u,d;i=yF(n),n=(c=i)===null||c===void 0?void 0:c.host,s=!!((u=n)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(n))}}return s},qde=function(e){var r=e.getBoundingClientRect(),i=r.width,n=r.height;return i===0&&n===0},y2t=function(e,r){var i=r.displayCheck,n=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=Aw.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(Aw.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=yF(e);if(l&&!l.shadowRoot&&n(l)===!0)return qde(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(g2t(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return qde(e);return!1},_2t=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var n=r.children.item(i);if(n.tagName==="LEGEND")return Aw.call(r,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}r=r.parentElement}return!1},vF=function(e,r){return!(r.disabled||_F(r)||u2t(r)||y2t(r,e)||h2t(r)||_2t(r))},KW=function(e,r){return!(m2t(r)||fMe(r)<0||!vF(e,r))},v2t=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},b2t=function t(e){var r=[],i=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=l2t(a,o),c=o?t(n.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),i.sort(c2t).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(r)},w2t=function(e,r){r=r||{};var i;return r.getShadowRoot?i=dMe([e],r.includeContainer,{filter:KW.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:v2t}):i=hMe(e,r.includeContainer,KW.bind(null,r)),b2t(i)},Wkt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=dMe([e],r.includeContainer,{filter:vF.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=hMe(e,r.includeContainer,vF.bind(null,r)),i},qkt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Aw.call(e,gF)===!1?!1:KW(r,e)},x2t=cMe.concat("iframe").join(","),Xkt=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return Aw.call(e,x2t)===!1?!1:vF(r,e)};const T2t={getShadowRoot:!0};function Ykt(t){const e="dir",r=`[${e}]`,i=S2t(t,r);return i?i.getAttribute(e):"ltr"}function UK(t){return t.getRootNode()}function Zkt(t){const e=UK(t);return"host"in e?e:null}function gMe(t){return t.host||null}function Qkt(t,{selector:e,id:r}){function i(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=UK(n),o=r?"getElementById"in s?s.getElementById(r):null:e?s.querySelector(e):null,a=gMe(s);return o||(a?i(a):null)}return i(t)}function S2t(t,e){function r(i){return i?i.closest(e)||r(gMe(UK(i))):null}return r(t)}function E2t(t,e){return yMe(t,e)}function yMe(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return yMe(i instanceof ShadowRoot?i.host:i,e)}function Jkt(t,e){return!!E2t(e,r=>r===t?!0:void 0)}function C2t(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function Kkt(t){if(t)return C2t(t)?t.setFocus():t.focus()}function e9t(t){t&&(w2t(t,T2t)[0]||t).focus()}const JR=":not([slot])";function t9t(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:JR;return r!=null&&r.all?A2t(t,i,r):O2t(t,i,r)}function _Me(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function A2t(t,e,r){let i=e===JR?_Me(t,JR):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(s=>s.parentElement===t),i=r!=null&&r.matches?i.filter(s=>s==null?void 0:s.matches(r.matches)):i;const n=r==null?void 0:r.selector;return n?i.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,o)=>[...s,...o],[]).filter(s=>!!s):i}function O2t(t,e,r){let i=e===JR?_Me(t,JR)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const n=r==null?void 0:r.selector;return n?i==null?void 0:i.querySelector(n):i}function r9t(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function i9t(t){return(!!t).toString()}function n9t(t){return $2t(t)||P2t(t)}function R2t(t){return M2t(t).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim()}function P2t(t){return!!R2t(t)}function M2t(t){return t.target.assignedNodes({flatten:!0})}function $2t(t){return!!I2t(t).length}function I2t(t){return t.target.assignedElements({flatten:!0})}function s9t(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v1.6.1
 */function Xde(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(lMe)||t.contains(aMe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&i(o),s=o};let s=r();i(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function L2t(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?Xde():document.addEventListener("DOMContentLoaded",()=>Xde(),{once:!0}))}const D2t=L2t;D2t();let vMe;function N2t(){try{yxt(".")}catch{_xt(iu(Ir(vMe)))}}function o9t(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return Promise.all(e)}vMe="components/assets";const bMe=Symbol("widget"),F2t=Symbol("widget-test-data"),U2t=[],k2t={},bF=new WeakMap;function wMe(t,e){let r=e.children;if(r&&r.length)for(let n=0;n<r.length;++n)r[n]=wMe(t,r[n]);else r=U2t;const i=e.vnodeSelector;if(kK(i)){const n=e.properties||k2t,s=n.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:z2t,afterUpdate:B2t,afterRemoved:xMe,parentWidget:t,widgetConstructor:i,widgetProperties:{...n,key:s,children:r}},children:void 0,text:void 0,domNode:null}}return e}function z2t(t,e,r,{parentWidget:i,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,bF.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i._internalHandles.add(Za(()=>xMe(t)))}function B2t(t,e,r,{widgetProperties:i}){var s;const n=bF.get(t);n&&(n.set(i),(s=n.afterUpdate)==null||s.call(n,n,t))}function xMe(t){var r;const e=bF.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),bF.delete(t))}function kK(t){return typeof t=="function"&&t[bMe]}const Yde=new Set;function V2t(t){Yde.add(t),t.finally(()=>Yde.delete(t))}var TMe;const G2t="esri.widgets.Widget";let j2t=0;const H2t={widgetIcon:"esri-icon-checkbox-unchecked"};function SMe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?SMe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const W2t=gxt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,n,s,o)=>{const a=e==null?void 0:e(i,n,s,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in s)||l){const c=i[2].toLowerCase()+i.slice(3),u=m=>a==null?void 0:a.call(s,m);s.addEventListener(c,u,l);const d=()=>s.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=m=>{p==null||p(m),d()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:n,type:s}=i,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(Kbe(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let pB=!1,Fs=class extends t6(Bn.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new Vi,this._projector=W2t,this._readyForTrueRender=!1,this.iconClass=H2t.widgetIcon,this.icon=null,this.key=this,this._loadLocale=Age(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await o1(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{if(this.destroyed)return;let c=await X0e(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=SMe(ye(c),this.uiStrings)),this[l]=c}));if(this.destroyed)return;for(const a of o)a.error&&J.getLogger(this).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),N2t();const i="esri-widget-uid-"+HPe(),n=this.render.bind(this);this._trackingTarget=new JF(()=>this.scheduleRender());const s=()=>{var u;if(!this._readyForTrueRender||this.destroyed)return null;const o=n();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;l||(a.key=i),this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return(u=o.children)==null||u.forEach(d=>{if(kK(d.vnodeSelector))return;let{properties:p}=d;p||(d.properties=p={}),p.key||(p.key=`${this.id}--${c++}`)}),wMe(this,o)};this.render=()=>{if(pB)return s();let o=pGe(this)??null;if(o)return o;this._trackingTarget.clear(),pB=!0;try{o=Lg(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{pB=!1}return o&&fGe(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),V2t(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(_te)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Me(this._trackingTarget),Me(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,Ek(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return R6(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+j2t++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(TMe=bMe,F2t)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Ek(this),this._projector.scheduleRender())}classes(...e){return vGe.apply(this,e)}renderNow(){Ek(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this._internalHandles.add(ue(()=>this.viewModel,(i,n)=>{n&&this._internalHandles.remove("delegated-events"),i&&ZF(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>dP(i,s,o=>{this.emit(s,o)})),"delegated-events")},Pr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(_te),this.scheduleRender()};this._internalHandles.add([j0e(e),ue(()=>this.uiStrings,e),Dh(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};Fs[TMe]=!0,h([f()],Fs.prototype,"_readyForTrueRender",void 0),h([f({value:null})],Fs.prototype,"container",null),h([_i("container")],Fs.prototype,"castContainer",null),h([f()],Fs.prototype,"iconClass",void 0),h([f()],Fs.prototype,"icon",void 0),h([f()],Fs.prototype,"id",null),h([f()],Fs.prototype,"label",null),h([f()],Fs.prototype,"renderable",null),h([f()],Fs.prototype,"uiStrings",void 0),h([f()],Fs.prototype,"viewModel",void 0),h([f({value:!0})],Fs.prototype,"visible",null),h([f()],Fs.prototype,"key",void 0),h([f()],Fs.prototype,"children",void 0),h([f()],Fs.prototype,"afterCreate",void 0),h([f()],Fs.prototype,"afterUpdate",void 0),h([f()],Fs.prototype,"afterRemoved",void 0),Fs=h([N(G2t)],Fs);const cM=Fs;function Zde(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function q2t(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function yL(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function X2t(t){return t.type==="bing-maps"}const Y0=[];let z2=class extends pR{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ir,this.view=null,this._allLayerViewsChange=r=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(n=>ue(()=>{var s;return[n.suspended,(s=n.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),r&&r.removed&&r.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.handles.add([Ol(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Dh(()=>{var r;return((r=this.view)==null?void 0:r.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,r=e==null?void 0:e.allLayerViews;Y0.length=0,e&&r?(r.forEach(i=>{var o;if(i.suspended||!((o=i.layer)!=null&&o.attributionVisible))return;const n=i.layer;if(Zde(n,"user"))return void yL(Y0,i,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(i)){const a=this._fetchedAttributionData.get(i);return void(a?yL(Y0,i,this._getDynamicAttribution(a,e,n)):Zde(n)&&yL(Y0,i,n.copyright))}return void this._fetchAttributionData(i)}const s=n.get("portalItem.accessInformation");yL(Y0,i,s||n.copyright)}),q2t(this.items,Y0)&&(this.items.removeAll(),this.items.addMany(Y0)),Y0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const r=await Ng(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=r.ok?this._createContributionIndex(r.value,X2t(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,r){const i=e.contributors,n={};if(!i)return n;for(let s=0;s<i.length;s++){const o=i[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(r&&l.zoomMin?1:0),d=l.zoomMax-(r&&l.zoomMax?1:0),p=new Dr({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:St.WGS84}),m={extent:BA(p),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let y=u;y<=d;y++)n[y]??(n[y]=[]),n[y].push(m)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,r,i){var u;const{extent:n,scale:s}=r;let o=((u=i.tileInfo)==null?void 0:u.scaleToZoom(s))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=$w(n.center.clone().normalize(),r.spatialReference),c=new Set;return a?a.filter(d=>{const p=d.id,m=!c.has(p)&&l&&d.extent&&eY(d.extent,l);return m&&c.add(p),m}).sort((d,p)=>p.score-d.score||d.objectId-p.objectId).map(d=>d.attribution).join(", "):""}};h([f({readOnly:!0,type:ir})],z2.prototype,"items",void 0),h([f({readOnly:!0})],z2.prototype,"state",null),h([f()],z2.prototype,"view",void 0),z2=h([N("esri.widgets.Attribution.AttributionViewModel")],z2);const EMe=z2;function cU(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:Z2t(t[e])}}}function Y2t(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function Z2t(t){return function(e,...r){Y2t(e)?SGe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function uU(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var Q2t=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},CMe=function(t,e){for(var r=0,i=t.length;r<i;r++){var n=t[r];Array.isArray(n)?CMe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=Q2t(n)),e.push(n))}},J2t=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var n=[];return CMe(r,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function qa(t,e,...r){return typeof t!="function"||kK(t)?J2t(t,e,...r):t(e,...r)}const t2="esri-attribution",Z0={base:`${t2} esri-widget`,poweredBy:`${t2}__powered-by`,sources:`${t2}__sources`,open:`${t2}--open`,sourcesOpen:`${t2}__sources--open`,link:`${t2}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let La=class extends cM{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=Z0.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new EMe}initialize(){this.addHandles(Ol(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Z0.open]:this._isOpen};return qa("div",{bind:this,class:this.classes(Z0.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return qa("div",{class:Z0.poweredBy},"Powered by"," ",qa("a",{class:Z0.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:n}=this,s={[Z0.sourcesOpen]:e,[Z0.interactive]:r};return qa("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Z0.sources,s),innerHTML:n,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};h([f()],La.prototype,"_isOpen",void 0),h([f()],La.prototype,"_isInteractive",null),h([f()],La.prototype,"_attributionTextOverflowed",void 0),h([f()],La.prototype,"_prevSourceNodeHeight",void 0),h([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],La.prototype,"attributionText",null),h([f()],La.prototype,"iconClass",void 0),h([f()],La.prototype,"icon",void 0),h([f()],La.prototype,"itemDelimiter",void 0),h([f()],La.prototype,"label",null),h([f(),uU("esri/widgets/Attribution/t9n/Attribution")],La.prototype,"messages",void 0),h([f()],La.prototype,"view",null),h([f({type:EMe})],La.prototype,"viewModel",void 0),h([cU()],La.prototype,"_toggleState",null),La=h([N("esri.widgets.Attribution")],La);const K2t=La,eTt=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return GF(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return h([f()],e.prototype,"goToOverride",void 0),h([f()],e.prototype,"view",void 0),e=h([N("esri.widgets.support.GoTo")],e),e},tTt="esri.widgets.CompassViewModel";let Gv=class extends eTt(xe){constructor(e){super(e),this._handles=new Vi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ue(()=>this.view,this._updateRotationWatcher,Pr))}destroy(){Pi(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var r;if(!this.get("view.ready"))return;const e={};((r=this.view)==null?void 0:r.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ue(()=>e==null?void 0:e.rotation,this._updateForRotation,Pr):ue(()=>e==null?void 0:e.camera,this._updateForCamera,Pr))}};h([f({readOnly:!0})],Gv.prototype,"canShowNorth",null),h([f()],Gv.prototype,"orientation",void 0),h([f({readOnly:!0})],Gv.prototype,"state",null),h([f()],Gv.prototype,"view",void 0),Gv=h([N(tTt)],Gv);const AMe=Gv,Q0={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Sd=class extends cM{constructor(e,r){super(e,r),this.iconClass=Q0.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new AMe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",n=(r==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,o={[Q0.disabled]:i,[Q0.interactive]:!i},a={[Q0.northIcon]:n,[Q0.rotationIcon]:!n},{messages:l}=this;return qa("div",{bind:this,class:this.classes(Q0.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":l.reset,title:l.reset},qa("span",{"aria-hidden":"true",class:this.classes(Q0.icon,a),styles:this._toRotationTransform(e)}),qa("span",{class:Q0.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};h([f()],Sd.prototype,"goToOverride",null),h([f()],Sd.prototype,"iconClass",void 0),h([f()],Sd.prototype,"icon",void 0),h([f()],Sd.prototype,"label",null),h([f(),uU("esri/widgets/Compass/t9n/Compass")],Sd.prototype,"messages",void 0),h([f()],Sd.prototype,"view",null),h([f({type:AMe})],Sd.prototype,"viewModel",void 0),h([cU()],Sd.prototype,"_reset",null),Sd=h([N("esri.widgets.Compass")],Sd);const rTt=Sd,r2="esri-navigation-toggle",Uu={base:`${r2} esri-widget`,button:`${r2}__button esri-widget--button`,activeButton:`${r2}__button--active`,panButton:`${r2}__button--pan`,rotateButton:`${r2}__button--rotate`,isLayoutHorizontal:`${r2}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let B2=class extends xe{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(Dh(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};h([f({readOnly:!0})],B2.prototype,"state",null),h([f()],B2.prototype,"navigationMode",void 0),h([f()],B2.prototype,"view",void 0),B2=h([N("esri.widgets.NavigationToggleViewModel")],B2);const OMe=B2;let Ed=class extends cM{constructor(e,r){super(e,r),this.iconClass=Uu.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new OMe}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[Uu.disabled]:e,[Uu.isLayoutHorizontal]:this.layout==="horizontal"},n={[Uu.activeButton]:r},s={[Uu.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return qa("div",{bind:this,class:this.classes(Uu.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},qa("div",{class:this.classes(Uu.button,Uu.panButton,n)},qa("span",{class:Uu.panIcon})),qa("div",{class:this.classes(Uu.button,Uu.rotateButton,s)},qa("span",{class:Uu.rotationIcon})))}_toggle(){this.toggle()}};h([f()],Ed.prototype,"iconClass",void 0),h([f()],Ed.prototype,"icon",void 0),h([f()],Ed.prototype,"label",null),h([f({value:"vertical"})],Ed.prototype,"layout",null),h([f(),uU("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Ed.prototype,"messages",void 0),h([f()],Ed.prototype,"view",null),h([f({type:OMe})],Ed.prototype,"viewModel",void 0),h([cU()],Ed.prototype,"_toggle",null),Ed=h([N("esri.widgets.NavigationToggle")],Ed);const iTt=Ed,QC={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Xm=class extends cM{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,r={[QC.disabled]:!this.enabled,[QC.interactive]:this.enabled};return qa("div",{bind:this,class:this.classes(QC.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},qa("span",{"aria-hidden":"true",role:"presentation",class:this.classes(QC.icon,this.iconClass??"")}),qa("span",{class:QC.iconText},this.title))}_triggerAction(){this.action.call(this)}};h([f()],Xm.prototype,"action",void 0),h([f()],Xm.prototype,"enabled",void 0),h([f()],Xm.prototype,"iconClass",void 0),h([f()],Xm.prototype,"icon",void 0),h([f()],Xm.prototype,"title",void 0),h([cU()],Xm.prototype,"_triggerAction",null),Xm=h([N("esri.widgets.IconButton")],Xm);const Qde=Xm;let V2=class extends xe{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};h([f({readOnly:!0})],V2.prototype,"canZoomIn",null),h([f({readOnly:!0})],V2.prototype,"canZoomOut",null),h([f()],V2.prototype,"view",void 0),V2=h([N("esri.widgets.Zoom.ZoomConditions2D")],V2);const nTt=V2;let G2=class extends xe{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};h([f({readOnly:!0})],G2.prototype,"canZoomIn",null),h([f({readOnly:!0})],G2.prototype,"canZoomOut",null),h([f()],G2.prototype,"view",void 0),G2=h([N("esri.widgets.Zoom.ZoomConditions3D")],G2);const sTt=G2;let Ty=class extends xe{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new nTt({view:e}):e.type==="3d"&&(this._zoomConditions=new sTt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():_V(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():_V(e.goTo({zoomFactor:.5}))}};h([f()],Ty.prototype,"_zoomConditions",void 0),h([f()],Ty.prototype,"canZoomIn",null),h([f()],Ty.prototype,"canZoomOut",null),h([f({readOnly:!0})],Ty.prototype,"state",null),h([f()],Ty.prototype,"view",null),Ty=h([N("esri.widgets.Zoom.ZoomViewModel")],Ty);const RMe=Ty,JC={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let df=class extends cM{constructor(e,r){super(e,r),this.iconClass=JC.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new RMe}initialize(){this._zoomInButton=new Qde({action:this.zoomIn.bind(this),iconClass:JC.zoomInIcon}),this._zoomOutButton=new Qde({action:this.zoomOut.bind(this),iconClass:JC.zoomOutIcon})}destroy(){this._zoomInButton=Me(this._zoomInButton),this._zoomOutButton=Me(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[JC.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:n}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:o}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=o,qa("div",{class:this.classes(JC.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};h([f()],df.prototype,"iconClass",void 0),h([f()],df.prototype,"icon",void 0),h([f()],df.prototype,"label",null),h([f({value:"vertical"})],df.prototype,"layout",null),h([f(),uU("esri/widgets/Zoom/t9n/Zoom")],df.prototype,"messages",void 0),h([f()],df.prototype,"view",null),h([f({type:RMe})],df.prototype,"viewModel",void 0),df=h([N("esri.widgets.Zoom")],df);const oTt=df;function aTt(t){return(t==null?void 0:t.view)!==void 0}let fN=class extends cxt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const n=this._find(i),s=n==null?void 0:n.widget;aTt(s)&&(s.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([ue(()=>this.components,this._componentsWatcher,Pr),ue(()=>this.view,this._updateViewAwareWidgets,Pr)])}_add(e,r,i,n,s){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,n,s)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new pN({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new K2t({view:r});case"compass":return new rTt({view:r});case"navigation-toggle":return new iTt({view:r});case"zoom":return new oTt({view:r})}}};h([f()],fN.prototype,"components",void 0),fN=h([N("esri.views.ui.DefaultUI")],fN);const PMe=fN;let mN=class extends PMe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([f()],mN.prototype,"components",void 0),mN=h([N("esri.views.ui.3d.DefaultUI3D")],mN);const MMe=mN;let We=class extends b7e(pje(kGe(Zje))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new jg({slicePlane:Ebe},this),this._resourceController=zft(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new UH({view:this}),this.labeler=new Dv({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new $S,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new rb,this.environmentManager=new yd,this.floors=new ir,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Kje({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new rft,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new MMe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new fW,this.voxelWasm=null,this.voxelWasmPromise=null,rBe(),t&&t.environment||(this._defaults.environment=new T2,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===Yr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([Ol(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ue(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new net({view:this}),this.stateManager=new gs({view:this})}initialize(){this.groundView=new eje({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Ol(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},Pr),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},Pr),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>tNe(e>0?1e3/Math.ceil(e):0),Pr),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,An),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),An),this.addHandles(ue(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Br))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Me(this.sharedSymbolResources),this._set("labeler",Me(this.labeler)),this._set("deconflictor",Me(this.deconflictor)),this._resourceController=Me(this._resourceController),this._set("stateManager",Me(this.stateManager)),this._set("inputManager",Me(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Me(this.environmentManager)),this.groundView=Me(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof Dr?this.spatialReference&&(t=_L(t,this.spatialReference),t==null)?(J.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(J.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?J.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===$e.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:_L(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||St.WGS84,r=_L(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||St.WGS84;let e;const r=s=>{const o=_L(s,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const s=i.groundExtent;r(new Dr({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof T2?t:t instanceof Gwe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):T2.fromWebsceneEnvironment(t):Qa(T2,t):new T2}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){eN.isValidProfile(t)&&(eN.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||eN.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");zw(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?g7e(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?CP.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||GR(a))return;++r,t+=a.updatingProgress}}else++r});for(const a of this._updatingObjects)a!=null&&a.updating&&(r+=.1,t+=.5*.1);for(const a of this._updatingObjectsWithProgress)a!=null&&a.updating&&(++r,t+=a.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.updating||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(t!=null)return Pk(t);const e=this.spatialReference;return e?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?Pk(this.defaultsFromMap.viewingMode):SH(e,$e.Global)?"global":"local":"global"}set viewingMode(t){this.ready?J.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new dmt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return J.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),n=Yie(t)?Xie(this,t):t,s=wf(n);r.enableDraped=r.include&&!r.include.has(jy)||r.exclude&&r.exclude.has(jy);const o=this.sceneIntersectionHelper,a=zh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?To.ALL:To.MIN,o.intersectIntersectorScreen(s,a,r),i){for(const l of a.results.all){const c=YW(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return J.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Af(this.elevationProvider,t):null)??0;return Bi(t,i2,this.renderSpatialReference,e),this.state.camera.projectToScreen(i2,fB),Lh(fB[0],fB[1])}pixelSizeAt(t){return this.ready?t?(Bi(t,i2,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(i2)):0:(J.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return J.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=Yie(t)?Xie(this,t):t,i=Xi(r.x,r.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=zh(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=To.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,s,n);const o=this._intersectResultsToHits(s.results.all,n.graphics),a=s.results.ground,l=Mde(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:bp(a)?a.distanceInRenderSpace:0,layer:c}};return Kr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=s),Promise.resolve(u)}async popupHitTest(t){const{results:e,ground:r}=await Gwt(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new Y("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return oB(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return aB(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[aB(r[0],this._pixelFormat()),aB(r[1],this._pixelFormat())]}_completeSettings(t){const e=xwt(t,this);return e.pixelRatio/=this.state.pixelRatio,Cwt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!se("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=oB(r[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[i,oB(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return ine.importLayerView(t)}hasLayerViewModule(t){return ine.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=Kwt(this.type);const e=se("safari");if(e&&e<9&&(t=new Y("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw J.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?ene(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,$e.Local),n=this._validateSpatialReferenceForViewingMode(t,e,$e.Global);return i||n?i&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,$e.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,$e.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!SH(t,r)&&(e==null||!!ere(e)||(!jA(e)||K8(e,t,r)!=null)&&(!Kte(e)||r!==$e.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,n=t.isWGS84;return ere(e)&&(i||n)?!n||r===$e.Local||hK(e.tileInfo,e.fullExtent,t,$e.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:St.WebMercator,viewingMode:r}]:[{spatialReference:i?St.WGS84:St.WebMercator,viewingMode:r}]:jA(e)||Kte(e)||!i&&!n?jA(e)&&i&&r!==$e.Global?[{spatialReference:t,viewingMode:r},{spatialReference:St.WGS84,viewingMode:$e.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?St.WGS84:St.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?J.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${Pk(r)} viewing mode.`):t.isGeographic&&J.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||St.WGS84;return Cs(t,this.renderSpatialReference,t,r)||(r=St.WGS84,Cs(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new ze(t,r),e}trackGraphicState(t){if(!t.graphic)return J.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const n=s=>{var o;!i&&s!=null&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(r=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return dS(t.map(r=>this.highlight(r)));if(ir.isCollection(t))return dS(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Za()}maskOccludee(t){if(!t)return J.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const n=s=>{!i&&s!=null&&Hwt(s)&&(r=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await uR(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new Y("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,RO.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,RO.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(i2)?(e=this.computeMapPointFromVec3d(i2,e),t.intersector===Ui.TERRAIN&&this.basemapTerrain&&(e.z=Af(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let n=0;n<t.length;n++){const s=t[n],o=Mde(s,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=YW(s,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&n!==t.length-1&&(i=new Set),i!=null){const u=this._getGraphicFilterUid(a.graphic);if(i.has(u))continue;i.add(u)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var n;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??_7e,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof z_)lTt(r,this._getGraphicFilterUid(t)),e===RO.INCLUDE&&(this.graphicsView!=null&&t.layer===this?KC(r,this.graphicsView.processor.layer.id):t.layer&&KC(r,t.layer.uid));else if(dV(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?KC(r,this.graphicsView.processor.layer.id):i===this.map.ground?KC(r,jy):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&KC(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new Fyt({view:this})),this._set("elevationProvider",new uA({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new yl({view:this})),this._set("featureTiles",new ho({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?xE(d6(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Kr.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ce(()=>import("./FeatureTileTree3DDebugger-3e47616a.js"),["assets/FeatureTileTree3DDebugger-3e47616a.js","assets/TileTreeDebugger-142b9f39.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Kr.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||Kr.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},An),this.updatingHandles.add(()=>this.clippingArea,t,An),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,An)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new xft(this.map,t));const e=this.state.isGlobal,r=m7e(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Cft.create(this.state.viewingMode,r)),e||this.addHandles(ue(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const n=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!RP(i,this.basemapTerrain.spatialReference,Jde,n)||(this.renderCoordsHelper.extent=Jde)},Br),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(BS/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Yr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(ue(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Br),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(n,s)=>this._renderScreenshotOverlay(n,s)}},e=new ift(this.state.viewingMode,n=>this._stage.layers.forAll(n),this);this._set("sceneIntersectionHelper",e);const r=R6(this.surface);this._stage=new Gc({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Pr),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,n=>this._stage.renderer.setParameters({highQualityTransparency:n}),Pr),ue(()=>this.magnifier,n=>this._stage.renderView.magnifier=n,An),this.on("pointer-move",()=>{var n;return(n=this._stage)==null?void 0:n.renderer.resetAnimation()}),dP(this._stage.renderView.canvas,"webglcontextlost",n=>this.fatalError=new Y("webgl-context-lost",n.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:fW.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(BS/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Me(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new mmt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ce(()=>import("./GraphicsView3D-1336db36.js"),["assets/GraphicsView3D-1336db36.js","assets/GraphicsProcessor-750d4e2b.js","assets/diffUtils-590c9088.js","assets/Query-1c961d4c.js","assets/Graphics3DObjectStates-bb2a6162.js","assets/UniqueValueRenderer-fef4204d.js","assets/jsonUtils-f73b3833.js","assets/DictionaryLoader-c0729336.js","assets/FieldsIndex-f79a8f26.js","assets/heatmapUtils-327ef4c5.js","assets/defaults-34554cbf.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-58185a60.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-3cae7682.js","assets/quickselect-e80674f5.js","assets/popupUtils-f04ec9a9.js"])).default;Bt(t),await uR(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=ene(this.viewingMode);if(t===$e.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Ol(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(jy);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(jy);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=ce(()=>import("./VoxelWasmPerSceneView-0fc2c231.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function KC(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function lTt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function _L(t,e){return t!=null&&Bg(t.spatialReference,e)?xE(t,e):null}var RO;We.type="3d",h([f()],We.prototype,"_userClippingArea",void 0),h([f()],We.prototype,"_resourceController",void 0),h([f()],We.prototype,"_stage",void 0),h([f({readOnly:!0})],We.prototype,"deconflictor",void 0),h([f({readOnly:!0})],We.prototype,"labeler",void 0),h([f(F4($S,"analyses"))],We.prototype,"analyses",void 0),h([f({type:DS,readOnly:!0})],We.prototype,"animation",null),h([f({readOnly:!0})],We.prototype,"basemapTerrain",void 0),h([f({readOnly:!0})],We.prototype,"elevationProvider",void 0),h([f()],We.prototype,"camera",null),h([f({type:vu})],We.prototype,"contentCamera",null),h([f({readOnly:!0})],We.prototype,"canvas",void 0),h([f({type:ze})],We.prototype,"center",null),h([f({type:Dr})],We.prototype,"clippingArea",null),h([f({type:rb})],We.prototype,"constraints",void 0),h([f({type:Dr,readOnly:!0})],We.prototype,"renderDataExtent",null),h([f({type:Dr,readOnly:!0})],We.prototype,"dataExtent",null),h([f({type:Dr,readOnly:!0})],We.prototype,"_groundAndLayersExtent",null),h([f({value:null,type:T2})],We.prototype,"environment",null),h([_i("environment")],We.prototype,"castEnvironment",null),h([f({readOnly:!0})],We.prototype,"environmentManager",void 0),h([f({type:Dr})],We.prototype,"extent",null),h([f()],We.prototype,"floors",void 0),h([f()],We.prototype,"screenCenter",null),h([f()],We.prototype,"frustum",null),h([f({type:Number,readOnly:!0})],We.prototype,"fullOpacity",void 0),h([f({readOnly:!0})],We.prototype,"graphicsView",void 0),h([f({readOnly:!0})],We.prototype,"analysisViewManager",void 0),h([f()],We.prototype,"groundView",void 0),h([f({type:Boolean})],We.prototype,"initialExtentRequired",null),h([f()],We.prototype,"_defaultsFromMapSettings",null),h([f()],We.prototype,"interacting",null),h([f()],We.prototype,"stationary",null),h([f()],We.prototype,"navigating",null),h([f()],We.prototype,"map",void 0),h([f({readOnly:!0})],We.prototype,"mapCoordsHelper",void 0),h([f()],We.prototype,"padding",null),h([f({type:yl,readOnly:!0})],We.prototype,"pointsOfInterest",void 0),h([f({type:ho,readOnly:!0})],We.prototype,"featureTiles",void 0),h([f()],We.prototype,"_featureTreeDebugger",void 0),h([f({type:Boolean})],We.prototype,"screenSizePerspectiveEnabled",void 0),h([f({constructOnly:!0})],We.prototype,"deactivatedWebGLExtensions",void 0),h([f({constructOnly:!0})],We.prototype,"debugWebGLExtensions",void 0),h([f({constructOnly:!0})],We.prototype,"renderCanvas",void 0),h([f({constructOnly:!0})],We.prototype,"state",void 0),h([f({readOnly:!0})],We.prototype,"inputManager",void 0),h([f({readOnly:!0})],We.prototype,"stateManager",void 0),h([f({type:["low","medium","high"]})],We.prototype,"qualityProfile",null),h([f({type:wce,get(){let t=this._get("qualitySettings");return t||(t=new wce,eN.apply(this.qualityProfile,t)),t}})],We.prototype,"qualitySettings",void 0),h([f()],We.prototype,"slicePlane",null),h([f({readOnly:!0})],We.prototype,"typeSpecificPreconditionsReady",null),h([f({readOnly:!0})],We.prototype,"renderCoordsHelper",void 0),h([f({readOnly:!0})],We.prototype,"sceneIntersectionHelper",void 0),h([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],We.prototype,"resolution",null),h([f({type:Number})],We.prototype,"scale",null),h([f()],We.prototype,"heightModelInfo",null),h([f()],We.prototype,"spatialReference",void 0),h([f({type:Boolean,constructOnly:!0})],We.prototype,"alphaCompositingEnabled",void 0),h([f({constructOnly:!0})],We.prototype,"preserveDrawingBufferEnabled",void 0),h([f({type:Boolean})],We.prototype,"supersampleScreenshotsEnabled",void 0),h([f({readOnly:!0})],We.prototype,"type",void 0),h([f(),_i(t=>t instanceof PMe?t:mS(MMe,t))],We.prototype,"ui",void 0),h([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],We.prototype,"updating",null),h([f()],We.prototype,"_updatingObjects",null),h([f()],We.prototype,"_updatingObjectsWithProgress",null),h([f({type:Number,readOnly:!0,dependsOn:["updating"]})],We.prototype,"updatingProgress",void 0),h([f({type:["global","local"]})],We.prototype,"viewingMode",null),h([f({type:hp})],We.prototype,"viewpoint",null),h([f({type:Number})],We.prototype,"zoom",null),h([f({type:fW})],We.prototype,"highlightOptions",void 0),We=h([N("esri.views.SceneView")],We),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(RO||(RO={}));const i2=O(),fB=Xi(),Jde=jt(),cTt=We,Kde={read:{reader:elt},write:{allowNull:!0,writer:tlt}},uTt=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return h([f({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),h([f({json:{read:!1,write:!1,origins:{"web-map":Kde,"portal-item":Kde}}})],e.prototype,"effect",void 0),e=h([N("esri.layers.mixins.BlendLayer")],e),e},hTt=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&dTt(r,i.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return h([f({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),h([f({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=h([N("esri.layers.mixins.ScaleRangeLayer")],e),e};function dTt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}var eq;let xA=eq=class extends ke{constructor(t){super(t)}async collectRequiredFields(t,e){return kg(t,e,this.expression)}clone(){return new eq({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};h([f({type:String,json:{write:!0}})],xA.prototype,"expression",void 0),h([f({type:String,json:{write:!0}})],xA.prototype,"title",void 0),xA=eq=h([N("esri.layers.support.FeatureExpressionInfo")],xA);const epe=xA;var tq;const vL=Oc()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),tpe=new zn({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Ym=tq=class extends ke{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new tq({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&nDe(this.featureExpressionInfo,t.featureExpressionInfo)}};h([f({type:epe,json:{write:!0}})],Ym.prototype,"featureExpressionInfo",void 0),h([lr("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Ym.prototype,"readFeatureExpressionInfo",null),h([xr("featureExpressionInfo",{featureExpressionInfo:{type:epe},"featureExpression.value":{type:[0]}})],Ym.prototype,"writeFeatureExpressionInfo",null),h([f({type:vL.apiValues,nonNullable:!0,json:{type:vL.jsonValues,read:vL.read,write:{writer:vL.write,isRequired:!0}}})],Ym.prototype,"mode",null),h([f({type:Number,json:{write:!0}})],Ym.prototype,"offset",void 0),h([f({type:uit,json:{type:String,read:tpe.read,write:tpe.write}})],Ym.prototype,"unit",null),Ym=tq=h([N("esri.layers.support.ElevationInfo")],Ym);const pTt=Ym;let Zm=class extends uTt(hTt(Hye)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new Mb,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,r){return super.on(e,r)}graphicChanged(e){this.emit("graphic-update",e)}};h([f({type:pTt})],Zm.prototype,"elevationInfo",void 0),h([f(F4(Mb,"graphics"))],Zm.prototype,"graphics",void 0),h([f({type:["show","hide"]})],Zm.prototype,"listMode",void 0),h([f()],Zm.prototype,"screenSizePerspectiveEnabled",void 0),h([f({readOnly:!0})],Zm.prototype,"type",void 0),h([f({constructOnly:!0})],Zm.prototype,"internal",void 0),Zm=h([N("esri.layers.GraphicsLayer")],Zm);const fTt=Zm;let TA=class extends Cu(ke){constructor(e){super(e),this.type="georeferenced-relative",this.isRelative=!0,this.isGeoreferenced=!0,this.origin=O()}getOriginPoint(e){const[r,i,n]=this.origin;return new ze({x:r,y:i,z:n,spatialReference:e})}setOriginFormPoint({x:e,y:r,z:i}){this.origin=Se(e,r,i??0)}};h([Vt({georeferencedRelative:"georeferenced-relative"},{readOnly:!0})],TA.prototype,"type",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],TA.prototype,"origin",void 0),TA=h([N("esri.geometry.support.MeshGeoreferencedRelativeVertexSpace")],TA);const $Me=TA;let gN=class extends Cu(ke){constructor(){super({}),this.type="georeferenced",this.isRelative=!1,this.isGeoreferenced=!0}};h([Vt({georeferenced:"georeferenced"},{readOnly:!0})],gN.prototype,"type",void 0),gN=h([N("esri.geometry.support.MeshGeoreferencedVertexSpace")],gN);const wF=gN;let SA=class extends Cu(ke){constructor(e){super(e),this.type="local",this.isRelative=!0,this.isGeoreferenced=!1,this.origin=O()}getOriginPoint(e){const[r,i,n]=this.origin;return new ze({x:r,y:i,z:n,spatialReference:e})}setOriginFormPoint({x:e,y:r,z:i}){this.origin=Se(e,r,i??0)}};h([Vt({local:"local"},{readOnly:!0})],SA.prototype,"type",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],SA.prototype,"origin",void 0),SA=h([N("esri.geometry.support.MeshLocalVertexSpace")],SA);const xF=SA;var rq;let pf=rq=class extends ke{constructor(t){super(t),this.translation=O(),this.rotationAxis=na(I2e),this.rotationAngle=0,this.scale=Se(1,1,1)}get rotation(){return UD(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=ki(t),this.rotationAngle=AYe(t)}get localMatrix(){const t=_e();return ER(rpe,this.rotation,p5(this.rotation)),pve(t,rpe,this.translation,this.scale),t}get localMatrixInverse(){return us(_e(),this.localMatrix)}applyLocal(t,e){return De(e,t,this.localMatrix)}applyLocalInverse(t,e){return De(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&lZ(this.localMatrix,t.localMatrix)}clone(){const t={translation:ki(this.translation),rotationAxis:ki(this.rotationAxis),rotationAngle:this.rotationAngle,scale:ki(this.scale)};return new rq(t)}};h([f({type:[Number],nonNullable:!0,json:{write:!0}})],pf.prototype,"translation",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],pf.prototype,"rotationAxis",void 0),h([f({type:Number,nonNullable:!0,json:{write:!0}})],pf.prototype,"rotationAngle",void 0),h([f({type:[Number],nonNullable:!0,json:{write:!0}})],pf.prototype,"scale",void 0),h([f()],pf.prototype,"rotation",null),h([f()],pf.prototype,"localMatrix",null),h([f()],pf.prototype,"localMatrixInverse",null),pf=rq=h([N("esri.geometry.support.MeshTransform")],pf);const rpe=Au(),nE=pf;function UE(t,e){return t.isGeographic||t.isWebMercator&&((e==null?void 0:e.geographic)??!0)}function hU(t,e,r){const i=!t.isGeoreferenced;(r==null?void 0:r.geographic)!=null&&r.geographic!==i&&J.getLogger(e).warnOnce(`Specifying the 'geographic' parameter (${r.geographic}) for a Mesh vertex space of type "${t.type}" is not supported. This parameter will be ignored.`)}function dU(t,e,r){return UE(e.spatialReference,r)?yTt(t,e,r):gTt(t,e,r)}function IMe(t,e,r,i){const{position:n,normal:s,tangent:o}=t;if(!e.isRelative)return{position:n,normal:s,tangent:o};const a=(r==null?void 0:r.localMatrix)??yn;return dU({position:gp(new Float64Array(n.length),n,a),normal:s!=null?lAe(s,new Float32Array(s.length),a):null,tangent:o!=null?cAe(o,new Float32Array(o.length),a):null},e.getOriginPoint(i),{geographic:!e.isGeoreferenced})}function LMe(t,e,r){if(r!=null&&r.useTransform){const{position:i,normal:n,tangent:s}=t,{x:o,y:a,z:l}=e,c=Se(o,a,l??0);return{vertexAttributes:{position:i,normal:n,tangent:s},vertexSpace:r.geographic??1?new xF({origin:c}):new $Me({origin:c}),transform:new nE}}return{vertexAttributes:dU(t,e,r),vertexSpace:new wF,transform:null}}function TF(t,e,r){return UE(e.spatialReference,r)?wTt(t,e,r):DMe(t,e,r)}function mTt(t,e,r,i,n){if(!e.isRelative)return TF(t,i,n);const{spatialReference:s}=i,o=IMe(t,e,r,s);return i.equals(e.getOriginPoint(s))?DMe(o,i,n):TF(o,i,n)}function zK({positions:t,transform:e,vertexSpace:r,inSpatialReference:i,outSpatialReference:n,outPositions:s,local:o}){const a=r.isRelative?r.origin:Zs,l=r.isRelative?(e==null?void 0:e.localMatrix)??yn:yn;if(r.isGeoreferenced){const p=s??Ys(t.length);if(I6(l,yn)?rXe(p,t):gp(p,t,l),!Bo(a,Zs)){const[m,y,_]=a;for(let v=0;v<p.length;v+=3)p[v]+=m,p[v+1]+=y,p[v+2]+=_}return $i(p,i,0,p,n,0,p.length/3),p}const c=t0(i),u=!o&&Bg(i,c)?c:i;ma(i,a,wb,u),Vr(wb,wb,l);const d=s??Ys(t.length);return gp(d,t,wb),$i(d,u,0,d,n,0,d.length/3),d}function gTt(t,e,r){const i=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=BK(r?r.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)i[c]=n[c]*l+s,i[c+1]=n[c+1]*l+o,i[c+2]=n[c+2]*l+a;return{position:i,normal:t.normal,tangent:t.tangent}}function yTt(t,e,r){const i=e.spatialReference,n=NMe(e,r,wb),s=new Float64Array(t.position.length),o=_Tt(t.position,n,i,s),a=Qf(FMe,n);return{position:o,normal:vTt(o,s,t.normal,a,i),tangent:bTt(o,s,t.tangent,a,i)}}function _Tt(t,e,r,i){gp(i,t,e);const n=new Float64Array(t.length);return q8(i,n,r)}function vTt(t,e,r,i,n){if(r==null)return null;const s=new Float32Array(r.length);return yp(s,r,i),H8(s,t,e,n,s),s}function bTt(t,e,r,i,n){if(r==null)return null;const s=new Float32Array(r.length);yp(s,r,i,4);for(let o=3;o<s.length;o+=4)s[o]=r[o];return X8(s,t,e,n,s),s}function DMe(t,e,r){const i=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=BK(r?r.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)i[c]=(n[c]-s)/l,i[c+1]=(n[c+1]-o)/l,i[c+2]=(n[c+2]-a)/l;return{position:i,normal:t.normal,tangent:t.tangent}}function wTt(t,e,r){const i=e.spatialReference;NMe(e,r,wb);const n=us(ETt,wb),s=new Float64Array(t.position.length),o=xTt(t.position,i,n,s),a=Qf(FMe,n);return{position:o,normal:TTt(t.normal,t.position,s,i,a),tangent:STt(t.tangent,t.position,s,i,a)}}function NMe(t,e,r){ma(t.spatialReference,[t.x,t.y,t.z??0],r,t0(t.spatialReference));const i=BK(e?e.unit:null,t.spatialReference);return AP(r,r,[i,i,i]),r}function xTt(t,e,r,i){const n=W8(t,e,i),s=new Float64Array(n.length);return gp(s,n,r),s}function TTt(t,e,r,i,n){if(t==null)return null;const s=tM(t,e,r,i,new Float32Array(t.length));return yp(s,s,n),s}function STt(t,e,r,i,n){if(t==null)return null;const s=rM(t,e,r,i,new Float32Array(t.length));return yp(s,s,n,4),s}function BK(t,e){if(t==null)return 1;const r=UV(e);return 1/fo(r,"meters",t)}const wb=_e(),ETt=_e(),FMe=hi(),E9t=Object.freeze(Object.defineProperty({__proto__:null,georeference:dU,georeferenceApplyTransform:IMe,georeferenceByTransform:LMe,project:zK,ungeoreference:TF,ungeoreferenceByTransform:mTt},Symbol.toStringTag,{value:"Module"}));function CTt({xmin:t,xmax:e,ymin:r,ymax:i,zmin:n,zmax:s},o,a,l){n??(n=0),s??(s=0),ipe??(ipe=new Float64Array(24));const c=ipe;return c[0]=t,c[1]=r,c[2]=n,c[3]=t,c[4]=i,c[5]=n,c[6]=e,c[7]=i,c[8]=n,c[9]=e,c[10]=r,c[11]=n,c[12]=t,c[13]=r,c[14]=s,c[15]=t,c[16]=i,c[17]=s,c[18]=e,c[19]=i,c[20]=s,c[21]=e,c[22]=r,c[23]=s,zK({positions:c,transform:o,vertexSpace:a,inSpatialReference:l,outSpatialReference:l,outPositions:c,local:!1}),yN(c,l)}let ipe=null;function yN(t,e){let r=1/0,i=1/0,n=1/0,s=-1/0,o=-1/0,a=-1/0;const l=t.length;let c=0;for(;c<l;){const u=t[c++],d=t[c++],p=t[c++];r=Math.min(r,u),i=Math.min(i,d),n=Math.min(n,p),s=Math.max(s,u),o=Math.max(o,d),a=Math.max(a,p)}return new Dr({xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a,spatialReference:e})}const KR="esri.geometry.support.meshUtils.centerAt";function ATt(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const{vertexSpace:i}=t,n=(r==null?void 0:r.origin)??t.origin;i.isRelative?(hU(i,KR,r),OTt(t,e,n)):UE(t.spatialReference,r)?RTt(t,e,n):PTt(t,e,n)}function OTt(t,e,r){const{vertexSpace:i}=t;if(!i.isRelative)return;const n=kMe,s=UMe;if(!Bi(e,s,t.spatialReference))return void J.getLogger(KR).error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!Bi(r,n,t.spatialReference)){const l=t.origin;n[0]=l.x,n[1]=l.y,n[2]=l.z,J.getLogger(KR).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}const o=ae($Tt,s,n),a=i.origin;i.origin=oe(O(),a,o)}function RTt(t,e,r){const i=TF(t.vertexAttributes,r,{geographic:!0}),{position:n,normal:s,tangent:o}=dU(i,e,{geographic:!0});t.vertexAttributes.position=n,t.vertexAttributes.normal=s,t.vertexAttributes.tangent=o,t.vertexAttributesChanged()}function PTt(t,e,r){const i=kMe,n=UMe;if(Bi(e,n,t.spatialReference)){if(!Bi(r,i,t.spatialReference)){const s=t.origin;i[0]=s.x,i[1]=s.y,i[2]=s.z,J.getLogger(KR).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}MTt(t.vertexAttributes.position,n,i),t.vertexAttributesChanged()}else J.getLogger(KR).error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function MTt(t,e,r){if(t)for(let i=0;i<t.length;i+=3)for(let n=0;n<3;n++)t[i+n]+=e[n]-r[n]}const UMe=O(),kMe=O(),$Tt=O();async function ITt(t,e,r){const{source:i}=e,{loadGLTFMesh:n}=await AX(ce(()=>import("./loadGLTFMesh-932e7ee5.js"),[]),r),s=await DTt(i,r);Bt(r);const o=n(new ze({x:0,y:0,z:0,spatialReference:t.spatialReference}),s.url,{resolveFile:LTt(s),useTransform:!0,signal:r==null?void 0:r.signal});o.then(()=>s.dispose(),()=>s.dispose());const{vertexAttributes:a,components:l}=await o;t.vertexAttributes=a,t.components=l}function LTt(t){const e=o6(t.url);return r=>{const i=n6(r,e,e),n=i?i.replace(/^ *\.\//,""):null;return(n?t.files.get(n):null)??r}}async function DTt(t,e){if(Array.isArray(t)){if(!t.length)throw new Y("mesh-load-external:missing-assets","There must be at least one file to load");return t[0]instanceof File?FTt(t):UTt(t,e)}return zMe(t)}async function NTt(t,e){const{parts:r}=t;if(r.length===1)return new SF(r[0].partUrl);const i=await t.toBlob(e);return Bt(e),SF.fromBlob(i)}function zMe(t){return SF.fromBlob(t)}function FTt(t){return BMe(t.map(e=>({name:e.name,mimeType:e.type,source:zMe(e)})))}async function UTt(t,e){const r=await e4(t.map(async i=>{const n=await NTt(i);return Bt(e),{name:i.assetName,mimeType:i.assetMimeType,source:n}}));if(ss(e))throw r.forEach(i=>i.source.dispose()),wr();return BMe(r)}const kTt=/^(model\/gltf\+json)|(model\/gltf-binary)$/,zTt=/\.(gltf|glb)/i;function BMe(t){const e=new Map;let r=null;for(const{name:i,mimeType:n,source:s}of t)(r==null||kTt.test(n)||zTt.test(i))&&(r=s.url),e.set(i,s.url),s.files.forEach((o,a)=>e.set(a,o));if(r==null)throw new Y("mesh-load-external:missing-files","Missing files to load external mesh source");return new SF(r,()=>t.forEach(({source:i})=>i.dispose()),e)}let SF=class VMe{constructor(e,r=()=>{},i=new Map){this.url=e,this.dispose=r,this.files=i}static fromBlob(e){const r=URL.createObjectURL(e);return new VMe(r,()=>URL.revokeObjectURL(r))}},GMe=class{constructor(e,r,i){this.assetName=e,this.assetMimeType=r,this.parts=i}equals(e){return this===e||this.assetName===e.assetName&&this.assetMimeType===e.assetMimeType&&Hf(this.parts,e.parts,(r,i)=>r.equals(i))}isOnService(e){return this.parts.every(r=>r.isOnService(e))}makeHash(){let e="";for(const r of this.parts)e+=r.partHash;return e}async toBlob(e){const{parts:r}=this;if(r.length===1)return r[0].toBlob(e);const i=await Promise.all(r.map(n=>n.toBlob(e)));return Bt(e),new Blob(i)}},A9t=class{constructor(e,r){this.partUrl=e,this.partHash=r}equals(e){return this===e||this.partUrl===e.partUrl&&this.partHash===e.partHash}isOnService(e){return this.partUrl.startsWith(`${e.path}/assets/`)}async toBlob(e){const{data:r}=await kn(this.partUrl,{responseType:"blob"});return Bt(e),r}};function npe(t){return BTt(t==null?void 0:t.source)}function spe(t){return Array.isArray(t)?t.every(e=>e instanceof GMe):!1}const ope=/^(model\/gltf\+json)|(model\/gltf-binary)$/,ape=/\.(gltf|glb)/i;function BTt(t){return t?Array.isArray(t)?t.some(lpe):lpe(t):!1}function lpe(t){if(t instanceof File){const{type:e,name:r}=t;return ope.test(e)||ape.test(r)}return ope.test(t.assetMimeType)||ape.test(t.assetName)}function VTt(t,e){if(!t)return!1;const{source:r}=t;return jTt(r,e)}function GTt(t,e){if(t===e)return!0;const{source:r}=t,{source:i}=e;if(r===i)return!0;if(spe(r)&&spe(i)){if(r.length!==i.length)return!1;const n=(a,l)=>a.assetName<l.assetName?-1:a.assetName>l.assetName?1:0,s=[...r].sort(n),o=[...i].sort(n);for(let a=0;a<s.length;++a)if(!s[a].equals(o[a]))return!1;return!0}return!1}function jTt(t,e){return Array.isArray(t)?t.every(r=>cpe(r,e)):cpe(t,e)}function cpe(t,e){return t instanceof GMe&&t.isOnService(e)}function R9t(t,e){return t instanceof File?e7(t.name,e)??KV(t.type,e):KV(t.assetMimeType,e)??e7(t.assetName,e)}function P9t(t){return Array.isArray(t)?t:[t]}function M9t(t){return!!t.original}let Fy=class extends c7{constructor(){super(),this.externalSources=new ir,this._explicitDisplaySource=null}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(e){if(e!=null&&!npe(e))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=e,e&&this.externalSources.every(r=>!GTt(r,e))&&this.externalSources.add(e)}clearSources(){this.displaySource=null,this.externalSources.removeAll()}getExternalSourcesOnService(e){return this.externalSources.items.filter(r=>VTt(r,e))}get _implicitDisplaySource(){return this.externalSources.find(npe)}};h([f()],Fy.prototype,"externalSources",void 0),h([f()],Fy.prototype,"displaySource",null),h([f()],Fy.prototype,"_implicitDisplaySource",null),h([f()],Fy.prototype,"_explicitDisplaySource",void 0),Fy=h([N("esri.geometry.support.meshUtils.Metadata")],Fy);const HTt="esri.geometry.support.meshUtils.offset";function WTt(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const{vertexSpace:i}=t;i.isRelative?(hU(i,HTt,r),qTt(i,e)):UE(t.spatialReference,r)?XTt(t,e):YTt(t,e)}function qTt(t,e){const r=t.origin;t.origin=oe(O(),r,e)}function XTt(t,e){const r=t.spatialReference,i=t.vertexAttributes.position,n=t.vertexAttributes.normal,s=t.vertexAttributes.tangent,o=new Float64Array(i.length),a=n!=null?new Float32Array(n.length):null,l=s!=null?new Float32Array(s.length):null,c=t.extent.center,u=ZTt;ma(r,[c.x,c.y,c.z],upe,t0(r)),Ac(hpe,upe),zo(u,e,hpe),W8(i,r,o),n!=null&&a!=null&&tM(n,i,o,r,a),s!=null&&l!=null&&rM(s,i,o,r,l),jMe(o,u),q8(o,i,r),n!=null&&a!=null&&H8(a,i,o,r,n),s!=null&&l!=null&&X8(l,i,o,r,s),t.vertexAttributesChanged()}function YTt(t,e){jMe(t.vertexAttributes.position,e),t.vertexAttributesChanged()}function jMe(t,e){if(t)for(let r=0;r<t.length;r+=3)for(let i=0;i<3;i++)t[r+i]+=e[i]}const ZTt=O(),upe=_e(),hpe=hi();function QTt(){const{faceDescriptions:t,faceVertexOffsets:e,uvScales:r}=sSt,i=4*t.length,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(2*t.length*3);let l=0,c=0,u=0,d=0;for(let p=0;p<t.length;p++){const m=t[p],y=l/3;for(const v of e)a[d++]=y+v;const _=m.corners;for(let v=0;v<4;v++){const b=_[v];let x=0;o[u++]=.25*r[v][0]+m.uvOrigin[0],o[u++]=m.uvOrigin[1]-.25*r[v][1];for(let T=0;T<3;T++)m.axis[T]!==0?(n[l++]=.5*m.axis[T],s[c++]=m.axis[T]):(n[l++]=.5*b[x++],s[c++]=0)}}return{position:n,normal:s,uv:o,faces:a}}function JTt(t,e){const r=t.components[0],i=r.faces,n=oSt[e],s=6*n,o=new Array(6),a=new Array(i.length-6);let l=0,c=0;for(let u=0;u<i.length;u++)u>=s&&u<s+6?o[l++]=i[u]:a[c++]=i[u];if(t.vertexAttributes.uv!=null){const u=new Float32Array(t.vertexAttributes.uv),d=4*n*2,p=[0,1,1,1,1,0,0,0];for(let m=0;m<p.length;m++)u[d+m]=p[m];t.vertexAttributes.uv=u}return t.components=[new xw({faces:o,material:r.material}),new xw({faces:a})],t}function KTt(t=0){const e=Math.round(8*2**t),r=2*e,i=(e-1)*(r+1)+2*r,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(3*((e-1)*r*2));let l=0,c=0,u=0,d=0;for(let p=0;p<=e;p++){const m=p/e*Math.PI+.5*Math.PI,y=Math.cos(m),_=Math.sin(m);Vs[2]=_;const v=p===0||p===e,b=v?r-1:r;for(let x=0;x<=b;x++){const T=x/b*2*Math.PI;Vs[0]=-Math.sin(T)*y,Vs[1]=Math.cos(T)*y;for(let S=0;S<3;S++)n[l]=.5*Vs[S],s[l]=Vs[S],++l;o[c++]=(x+(v?.5:0))/r,o[c++]=p/e,p!==0&&x!==r&&(p!==e&&(a[u++]=d,a[u++]=d+1,a[u++]=d-r),p!==1&&(a[u++]=d,a[u++]=d-r,a[u++]=d-r-1)),d++}}return{position:n,normal:s,uv:o,faces:a}}function eSt(t=0){const r=Math.round(16*2**t),i=(5-1)*(r+1)+2*r,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(3*(4*r));let l=0,c=0,u=0,d=0,p=0;for(let m=0;m<=5;m++){const y=m===0||m===5,_=m<=1||m>=5-1,v=m===2||m===4,b=y?r-1:r;for(let x=0;x<=b;x++){const T=x/b*2*Math.PI,S=y?0:.5;Vs[0]=S*Math.sin(T),Vs[1]=S*-Math.cos(T),Vs[2]=m<=2?.5:-.5;for(let A=0;A<3;A++)n[l++]=Vs[A],s[c++]=_?A===2?m<=1?1:-1:0:A===2?0:Vs[A]/S;o[u++]=(x+(y?.5:0))/r,o[u++]=m<=1?1*m/3:m<=3?1*(m-2)/3+1/3:1*(m-4)/3+2/3,v||m===0||x===r||(m!==5&&(a[d++]=p,a[d++]=p+1,a[d++]=p-r),m!==1&&(a[d++]=p,a[d++]=p-r,a[d++]=p-r-1)),p++}}return{position:n,normal:s,uv:o,faces:a}}function tSt(t,e){const r=typeof e=="number"?e:e!=null?e.width:1,i=typeof e=="number"?e:e!=null?e.height:1;switch(t){case"up":case"down":return{width:r,depth:i};case"north":case"south":return{width:r,height:i};case"east":case"west":return{depth:r,height:i}}}function rSt(t){const e=e3.facingAxisOrderSwap[t],r=e3.position,i=e3.normal,n=new Float64Array(r.length),s=new Float32Array(i.length);let o=0;for(let a=0;a<4;a++){const l=o;for(let c=0;c<3;c++){const u=e[c],d=Math.abs(u)-1,p=u>=0?1:-1;n[o]=r[l+d]*p,s[o]=i[l+d]*p,o++}}return{position:n,normal:s,uv:new Float32Array(e3.uv),faces:new Uint32Array(e3.faces),isPlane:!0}}const n2=1,s2=2,o2=3,e3={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[o2,n2,s2],west:[-o2,-n2,s2],north:[-n2,o2,s2],south:[n2,-o2,s2],up:[n2,s2,o2],down:[n2,-s2,-o2]}};function bL(t,e,r){t.isPlane||iSt(t),nSt(t,r==null?void 0:r.size);const{vertexAttributes:i,vertexSpace:n,transform:s}=LMe(t,e,r);return{vertexAttributes:new Ua({...i,uv:t.uv}),vertexSpace:n,transform:s,components:[new xw({faces:t.faces,material:r&&r.material||null})],spatialReference:e.spatialReference}}function iSt(t){for(let e=0;e<t.position.length;e+=3)t.position[e+2]+=.5}function nSt(t,e){if(e==null)return;const r=typeof e=="number"?[e,e,e]:[e.width!=null?e.width:1,e.depth!=null?e.depth:1,e.height!=null?e.height:1];J0[0]=r[0],J0[4]=r[1],J0[8]=r[2];for(let i=0;i<t.position.length;i+=3){for(let n=0;n<3;n++)Vs[n]=t.position[i+n];zo(Vs,Vs,J0);for(let n=0;n<3;n++)t.position[i+n]=Vs[n]}if(r[0]!==r[1]||r[1]!==r[2]){J0[0]=1/r[0],J0[4]=1/r[1],J0[8]=1/r[2];for(let i=0;i<t.normal.length;i+=3){for(let n=0;n<3;n++)Vs[n]=t.normal[i+n];zo(Vs,Vs,J0),me(Vs,Vs);for(let n=0;n<3;n++)t.normal[i+n]=Vs[n]}}}const sSt={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},oSt={south:0,east:1,north:2,west:3,up:4,down:5},Vs=O(),J0=hi(),HMe="esri.geometry.support.meshUtils.rotate";function aSt(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position||e[3]===0)return;const{spatialReference:i,vertexSpace:n}=t;if(n.isRelative){hU(n,HMe,r);const s=(r==null?void 0:r.origin)??t.origin;t.transform??(t.transform=new nE),lSt(t.transform,n,e,s)}else{const s=(r==null?void 0:r.origin)??t.origin;UE(i,r)?cSt(t,e,s):uSt(t,e,s)}}function lSt(t,e,r,i){const n=e.origin,s=ne(xT,i.x,i.y,i.z??0),o=ae(xT,s,n);t.applyLocalInverse(o,dpe),t.rotation=hH(t.rotation,r,jh()),t.applyLocalInverse(o,o),ae(o,o,dpe),t.translation=oe(O(),t.translation,o)}function cSt(t,e,r){const i=t.spatialReference,n=t0(i),s=WMe;Bi(r,s,n)||Bi(t.origin,s,n);const o=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,c=new Float64Array(o.length),u=a!=null?new Float32Array(a.length):null,d=l!=null?new Float32Array(l.length):null;ma(n,s,EF,n),Ac(fpe,EF);const p=ppe;zo(ppe,e,fpe),p[3]=e[3],W8(o,i,c),a!=null&&u!=null&&tM(a,o,c,i,u),l!=null&&d!=null&&rM(l,o,c,i,d),rS(c,p,3,s),q8(c,o,i),a!=null&&u!=null&&(rS(u,p,3),H8(u,o,c,i,a)),l!=null&&d!=null&&(rS(d,p,4),X8(d,o,c,i,l)),t.vertexAttributesChanged()}function uSt(t,e,r){const i=WMe;if(!Bi(r,i,t.spatialReference)){const n=t.origin;i[0]=n.x,i[1]=n.y,i[2]=n.z,J.getLogger(HMe).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}rS(t.vertexAttributes.position,e,3,i),rS(t.vertexAttributes.normal,e,3),rS(t.vertexAttributes.tangent,e,4),t.vertexAttributesChanged()}function rS(t,e,r,i=Zs){if(t!=null){Ec(EF,p5(e),e);for(let n=0;n<t.length;n+=r){for(let s=0;s<3;s++)xT[s]=t[n+s]-i[s];De(xT,xT,EF);for(let s=0;s<3;s++)t[n+s]=xT[s]+i[s]}}}const xT=O(),dpe=O(),ppe=jh(),EF=_e(),fpe=hi(),WMe=O(),qMe="esri.geometry.support.meshUtils.scale";function hSt(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const{spatialReference:i,vertexSpace:n}=t;if(n.isRelative){hU(n,qMe,r);const s=(r==null?void 0:r.origin)??t.origin;t.transform??(t.transform=new nE),dSt(t.transform,n,e,s)}else{const s=UE(i,r),o=(r==null?void 0:r.origin)??t.origin;s?pSt(t,e,o):fSt(t,e,o)}}function dSt(t,e,r,i){const n=e.origin,s=ne(TT,i.x,i.y,i.z),o=ae(TT,s,n);t.applyLocalInverse(o,mpe);const a=te(O(),t.scale,r);t.scale=a,t.applyLocalInverse(o,o),ae(o,o,mpe),t.translation=oe(O(),t.translation,o)}function pSt(t,e,r){const i=t.spatialReference,n=t0(i),s=YMe;Bi(r,s,n)||Bi(t.origin,s,n);const o=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,c=new Float64Array(o.length),u=a!=null?new Float32Array(a.length):null,d=l!=null?new Float32Array(l.length):null;W8(o,i,c),a!=null&&u!=null&&tM(a,o,c,i,u),l!=null&&d!=null&&rM(l,o,c,i,d),XMe(c,e,s),q8(c,o,i),a!=null&&u!=null&&H8(u,o,c,i,a),l!=null&&d!=null&&X8(d,o,c,i,l),t.vertexAttributesChanged()}function fSt(t,e,r){const i=YMe;if(!Bi(r,i,t.spatialReference)){const n=t.origin;i[0]=n.x,i[1]=n.y,i[2]=n.z,J.getLogger(qMe).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}XMe(t.vertexAttributes.position,e,i),t.vertexAttributesChanged()}function XMe(t,e,r=Zs){if(t)for(let i=0;i<t.length;i+=3){for(let n=0;n<3;n++)TT[n]=t[i+n]-r[n];te(TT,TT,e);for(let n=0;n<3;n++)t[i+n]=TT[n]+r[n]}}const TT=O(),mpe=O(),YMe=O();var jc;const Qm="esri.geometry.Mesh",mSt={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:wF,"georeferenced-relative":$Me,local:xF}};let Da=jc=class extends P6(Dg.LoadableMixin(t6(Zg))){constructor(t){super(t),this.components=null,this.vertexSpace=new wF,this.transform=null,this.metadata=new Fy,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new Ua,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(ue(()=>{var t;return{vertexAttributes:this.vertexAttributes,components:(t=this.components)==null?void 0:t.map(e=>e.clone())}},()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){var t;return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):((t=this.metadata.displaySource)==null?void 0:t.extent)!=null}get _transformedExtent(){const{components:t,spatialReference:e,vertexAttributes:r,vertexSpace:i}=this,n=r.position;if(n.length===0||t&&t.length===0)return new Dr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:e});if(i.type==="local"){const{_untransformedExtent:s,transform:o}=this;return CTt(s,o,i,e)}if(i.type==="georeferenced-relative"){const{transform:s}=this,o=zK({positions:n,transform:s,vertexSpace:i,inSpatialReference:e,outSpatialReference:e,local:!1});return yN(o,e)}return yN(n,e)}get _untransformedExtent(){return yN(this.vertexAttributes.position,this.spatialReference)}get anchor(){const{vertexSpace:t}=this;if(t.isRelative)return t.getOriginPoint(this.spatialReference);const{center:e,zmin:r}=this._transformedExtent;return new ze({x:e.x,y:e.y,z:r,spatialReference:this.spatialReference})}get origin(){const{vertexSpace:t}=this;return t.isRelative?t.getOriginPoint(this.spatialReference):this._transformedExtent.center}get extent(){var t,e;return this.loaded||((e=(t=this.metadata)==null?void 0:t.displaySource)==null?void 0:e.extent)==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(t){this.loaded?(this.components||(this.components=[]),this.components.push(xw.from(t)),this.notifyChange("components")):J.getLogger(this).error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(t){if(this.loaded){if(this.components){const e=this.components.indexOf(t);if(e!==-1)return this.components.splice(e,1),void this.notifyChange("components")}J.getLogger(this).error("removeComponent()","Provided component is not part of the list of components")}else J.getLogger(this).error("removeComponent()","Mesh must be loaded before applying operations")}rotate(t,e,r,i){return CYe(t,e,r,gpe),aSt(this,gpe,i),this}offset(t,e,r,i){return this.loaded?(wL[0]=t,wL[1]=e,wL[2]=r,WTt(this,wL,i),this):(J.getLogger(this).error("offset()","Mesh must be loaded before applying operations"),this)}scale(t,e){return this.loaded?(hSt(this,t,e),this):(J.getLogger(this).error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(t,e){return this.loaded?(ATt(this,t,e),this):(J.getLogger(this).error("centerAt()","Mesh must be loaded before applying operations"),this)}load(t){const{metadata:{displaySource:e}}=this;return e&&this.addResolvingPromise(ITt(this,e,t)),Promise.resolve(this)}addExternalSources(t){this.metadata.externalSources.addMany(t)}updateDisplaySource(t){this.metadata.displaySource=t}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(t){var i;let e=null;if(this.components){const n=new Map,s=new Map;e=this.components.map(o=>o.cloneWithDeduplication(n,s))}const r={components:e,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),vertexSpace:t,transform:((i=this.transform)==null?void 0:i.clone())??null,metadata:this.metadata.clone()};return new jc(r)}cloneShallow(){return new jc({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(t){const e=ce(()=>import("./gltfexport-6ef31b0f.js"),["assets/gltfexport-6ef31b0f.js","assets/imageutils-51a204ba.js"]),r=this.load(),i=await Promise.all([e,r]),{toBinaryGLTF:n}=i[0];return n(this,t)}get memoryUsage(){let t=0;if(t+=this.vertexAttributes.memoryUsage,this.components!=null)for(const e of this.components)t+=e.memoryUsage;return t}_clearSources(){this.metadata.clearSources()}static createBox(t,e){if(!(t instanceof ze))return J.getLogger(Qm).error(".createBox()","expected location to be a Point instance"),null;const r=new jc(bL(QTt(),t,e));return e&&e.imageFace&&e.imageFace!=="all"?JTt(r,e.imageFace):r}static createSphere(t,e){return t instanceof ze?new jc(bL(KTt(e&&e.densificationFactor||0),t,e)):(J.getLogger(Qm).error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(t,e){return t instanceof ze?new jc(bL(eSt(e&&e.densificationFactor||0),t,e)):(J.getLogger(Qm).error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(t,e){if(!(t instanceof ze))return J.getLogger(Qm).error(".createPlane()","expected location to be a Point instance"),null;const r=(e==null?void 0:e.facing)??"up",i=tSt(r,e==null?void 0:e.size);return new jc(bL(rSt(r),t,{...e,size:i}))}static createFromPolygon(t,e){if(!(t instanceof a1))return J.getLogger(Qm).error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const r=Gnt(t);return new jc({vertexAttributes:new Ua({position:r.position}),components:[new xw({faces:r.faces,shading:"flat",material:(e==null?void 0:e.material)??null})],spatialReference:t.spatialReference,vertexSpace:new wF})}static async createFromGLTF(t,e,r){if(!(t instanceof ze))throw J.getLogger(Qm).error(".createfromGLTF()","expected location to be a Point instance"),new Y("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:i}=await AX(ce(()=>import("./loadGLTFMesh-932e7ee5.js"),[]),r);return new jc(await i(t,e,r))}static async createFromFiles(t,e,r){if(!(t instanceof ze)){const o="Expected location to be a Point instance";throw J.getLogger(Qm).error(".createFromFiles()",o),new Y("invalid-input",o)}const i=jc.createWithExternalSource(t,e),n=r==null?void 0:r.layer;if(!n){const o="A layer is needed to convert the files";throw J.getLogger(Qm).error(".createFromFiles()",o),new Y("invalid-input",o)}const[s]=await n.uploadAssets([i],r);return s}static createWithExternalSource(t,e,r){var p;const i=(r==null?void 0:r.extent)??null,{x:n,y:s,z:o,spatialReference:a}=t,l=((p=r==null?void 0:r.transform)==null?void 0:p.clone())??new nE,c=(r==null?void 0:r.vertexSpace)??new xF({origin:[n,s,o??0]}),u={source:e,extent:i},d=new Fy;return d.externalSources.push(u),new jc({metadata:d,transform:l,vertexSpace:c,spatialReference:a})}static createIncomplete(t,e){var c;const{x:r,y:i,z:n,spatialReference:s}=t,o=((c=e==null?void 0:e.transform)==null?void 0:c.clone())??new nE,a=(e==null?void 0:e.vertexSpace)??new xF({origin:[r,i,n??0]}),l=new jc({transform:o,vertexSpace:a,spatialReference:s});return l.addResolvingPromise(Promise.reject(new Y("mesh-incomplete","Mesh resources are not complete"))),l}};h([f({type:[xw],json:{write:!0}})],Da.prototype,"components",void 0),h([f({nonNullable:!0,types:mSt,constructOnly:!0,json:{write:!0}})],Da.prototype,"vertexSpace",void 0),h([f({type:nE,json:{write:!0}})],Da.prototype,"transform",void 0),h([f({constructOnly:!0})],Da.prototype,"metadata",void 0),h([f()],Da.prototype,"hasExtent",null),h([f()],Da.prototype,"_transformedExtent",null),h([f()],Da.prototype,"_untransformedExtent",null),h([f()],Da.prototype,"anchor",null),h([f()],Da.prototype,"origin",null),h([f({readOnly:!0,json:{read:!1}})],Da.prototype,"extent",null),h([f({readOnly:!0,json:{read:!1,write:!0,default:!0}})],Da.prototype,"hasZ",void 0),h([f({readOnly:!0,json:{read:!1,write:!0,default:!1}})],Da.prototype,"hasM",void 0),h([f({type:Ua,nonNullable:!0,json:{write:!0}})],Da.prototype,"vertexAttributes",void 0),Da=jc=h([N(Qm)],Da);const wL=O(),gpe=jh(),gSt=Da,P_=20;function ySt(t,{x:e,y:r}){const i=vSt(_St(t)),n=bSt(i),s=wSt(i,n),o=P_*.75,a=P_*.55;return new ze({x:s.x*e*o+n.x*r*a,y:s.y*e*o+n.y*r*a,z:s.z*e*o+n.z*r*a})}const _St=({centerPoint:t,startPoint:e})=>new ze({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z});function vSt(t){const e=xSt(t);return new ze({x:t.x/e,y:t.y/e,z:t.z/e})}const bSt=t=>new ze({x:0,y:-t.z,z:t.x}),wSt=(t,e)=>new ze({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}),xSt=t=>Math.sqrt(t.x**2+t.y**2+t.z**2);function ZMe(t,e,r){const i=t.geometry;t.geometry=i.rotate(0,0,e,{origin:r.centerPoint}).clone()}function TSt(t,e,r,i={x:0,y:0}){const n=ySt(r,i),{centerPoint:s}=r,o=r.startPoint.clone(),a=SSt.bind(void 0,r.blockPosition);o.x=a(s.x,r.startPoint.x)-n.x,o.y=a(s.y,r.startPoint.y)-n.y,o.z=a(s.z,r.startPoint.z)-n.z;const l=ESt(o,e,r.sketchEdges);return ZMe(l,r.initialAngle,r),t.add(l),l}const SSt=(t,e,r)=>e*(1-t)+r*t;function ESt(t,e,r=!1){const i=gSt.createBox(t,{size:{width:P_/2,height:P_/2,depth:P_/2}});return new z_({geometry:i,symbol:QMe(e,r)})}function QMe(t,e){const r=new vE({symbolLayers:[new Fw({material:{color:mB(t,.5)},edges:t==="_"?void 0:e?new qY({size:P_*.5,color:mB(t,.9)}):new m1e({size:P_*.15,color:mB(t,.9)})})]});return Object.defineProperty(r,"shape",{value:t}),r}const CSt=100,ASt=40;function mB(t,e=1){const r=oP[t].color[0];return iq(r,CSt,t==="_"?100:ASt,t==="_"?e*.6:e)}const iq=(t,e,r,i=1)=>it.fromRgb(["hsla(",t,", ",e,"%, ",r,"%, ",i,")"].join(""));function OSt(t,e,r){t.symbol.shape!==e&&(t.symbol=QMe(e,r.sketchEdges))}function RSt(t,e,r,i){const n=ai.useMemo(()=>t===void 0?void 0:PSt(t,r),[t,r]),s=r.type==="animated";ai.useEffect(()=>{if(!(n===void 0||!s||i))return n.start(),n.stop},[n,s,i]),ai.useEffect(()=>{n!==void 0&&e.forEach((o,a)=>o.forEach((l,c)=>n.spawnBox(l,c,a)))},[n,e])}function PSt(t,e){const r=new fTt;function i(c,u=c){$Le(Object.values(n).map(d=>Object.values(d??{})).flat()).forEach(d=>ZMe(d,u,e)),e.rotateCamera(t,c)}const n={};function s(c,u=0,d=0){var m;n[d]??(n[d]={}),(m=n[d])[u]??(m[u]=TSt(r,c,e,{x:-(sP/2)+u,y:yX/2-d}));const p=n[d][u];return OSt(p,c,e),p}t.map.add(r);let o;return{start:()=>o=setInterval(()=>i(-.04),ISt),stop:()=>clearInterval(o),spawnBox:s}}const MSt=1e3,$St=60,ISt=MSt/$St,t3=270;function LSt(t){const e=t==="animated",r=new ze({spatialReference:{wkid:102100},x:-8238833+(e?0:-500),y:4969413+(e?0:-500),z:e?250:120}),i=e?2500:800,n=e?t3:t3-30,s=o(n,t3,90);function o(c,u,d){const{x:p,y:m}=DSt(t3-u+c,i),y=r.clone();return y.x+=p,y.y+=m,new vu({position:y,heading:u-c,tilt:d})}const a=(c,u)=>void c.goTo(o(u,c.camera.heading,c.camera.tilt),{animate:!1}),l=o(0,t3,90).position;return{type:t,centerPoint:r,initialCamera:s,rotateCamera:a,sketchEdges:!e,initialAngle:n,startPoint:l,blockPosition:e?.7:.2}}function DSt(t,e){const r=t*Math.PI/180;return{x:e*Math.cos(r),y:e*Math.sin(r)}}var nq;let EA=nq=class extends ke{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new nq({minValue:this.minValue,maxValue:this.maxValue})}};h([f({type:Number,json:{write:!0}})],EA.prototype,"minValue",void 0),h([f({type:Number,json:{write:!0}})],EA.prototype,"maxValue",void 0),EA=nq=h([N("esri.renderer.support.AuthoringInfoClassBreakInfo")],EA);var sq;let Uy=sq=class extends ke{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new sq({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ye(this.classBreakInfos)})}};h([f({type:String,json:{write:!0}})],Uy.prototype,"field",void 0),h([f({type:String,json:{write:!0}})],Uy.prototype,"normalizationField",void 0),h([f({type:String,json:{write:!0}})],Uy.prototype,"label",void 0),h([f({type:[EA],json:{write:!0}})],Uy.prototype,"classBreakInfos",void 0),Uy=sq=h([N("esri.renderers.support.AuthoringInfoFieldInfo")],Uy);var oq;const xL=new zn({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),TL=new zn({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),ype={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},_pe=["high-to-low","above-and-below","centered-on","extremes"],vpe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],bpe=["seconds","minutes","hours","days","months","years"];let Zl=oq=class extends ke{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new oq({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};h([f({types:ype,json:{write:!0}})],Zl.prototype,"endTime",void 0),h([_i("endTime")],Zl.prototype,"castEndTime",null),h([f({type:String,json:{write:!0}})],Zl.prototype,"field",void 0),h([f({type:Number,json:{write:!0}})],Zl.prototype,"maxSliderValue",void 0),h([f({type:Number,json:{write:!0}})],Zl.prototype,"minSliderValue",void 0),h([f({types:ype,json:{write:!0}})],Zl.prototype,"startTime",void 0),h([_i("startTime")],Zl.prototype,"castStartTime",null),h([f({type:xL.apiValues,value:null,json:{type:xL.jsonValues,read:xL.read,write:xL.write}})],Zl.prototype,"style",null),h([f({type:vpe,value:null,json:{type:vpe,origins:{"web-scene":{type:_pe,write:{writer:(t,e)=>{_pe.includes(t)&&(e.theme=t)}}}},write:!0}})],Zl.prototype,"theme",null),h([f({type:TL.apiValues,json:{type:TL.jsonValues,read:TL.read,write:TL.write}})],Zl.prototype,"type",void 0),h([f({type:bpe,json:{type:bpe,write:!0}})],Zl.prototype,"units",void 0),Zl=oq=h([N("esri.renderers.support.AuthoringInfoVisualVariable")],Zl);const NSt=Zl;let _N=class extends ke{constructor(e){super(e),this.type=null}};h([f({readOnly:!0,json:{read:!1,write:!0}})],_N.prototype,"type",void 0),_N=h([N("esri.rest.support.ColorRamp")],_N);const VK=_N;var aq;let jv=aq=class extends VK{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new aq({fromColor:ye(this.fromColor),toColor:ye(this.toColor),algorithm:this.algorithm})}};h([Vt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],jv.prototype,"algorithm",void 0),h([f({type:it,json:{type:[mn],write:!0}})],jv.prototype,"fromColor",void 0),h([f({type:it,json:{type:[mn],write:!0}})],jv.prototype,"toColor",void 0),h([f({type:["algorithmic"]})],jv.prototype,"type",void 0),jv=aq=h([N("esri.rest.support.AlgorithmicColorRamp")],jv);const GK=jv;var lq;let CA=lq=class extends VK{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new lq({colorRamps:ye(this.colorRamps)})}};h([f({type:[GK],json:{write:!0}})],CA.prototype,"colorRamps",void 0),h([f({type:["multipart"]})],CA.prototype,"type",void 0),CA=lq=h([N("esri.rest.support.MultipartColorRamp")],CA);const JMe=CA,FSt={key:"type",base:VK,typeMap:{algorithmic:GK,multipart:JMe}};function USt(t){return t&&t.type?t.type==="algorithmic"?GK.fromJSON(t):t.type==="multipart"?JMe.fromJSON(t):null:null}var cq;const rv=new zn({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),SL=new zn({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),wpe=new zn({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),xpe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],kSt=["high-to-low","above-and-below","above","below","90-10"],zSt=["flow-line","wave-front"],BSt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Gn=cq=class extends ke{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?USt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new cq({classificationMethod:this.classificationMethod,colorRamp:ye(this.colorRamp),fadeRatio:ye(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:ye(this.field1),field2:ye(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};h([f({type:rv.apiValues,value:null,json:{type:rv.jsonValues,read:rv.read,write:rv.write,origins:{"web-document":{default:"manual",type:rv.jsonValues,read:rv.read,write:rv.write}}}})],Gn.prototype,"classificationMethod",null),h([f({types:FSt,json:{write:!0}})],Gn.prototype,"colorRamp",void 0),h([lr("colorRamp")],Gn.prototype,"readColorRamp",null),h([f({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gn.prototype,"fadeRatio",void 0),h([f({type:[String],value:null,json:{write:!0}})],Gn.prototype,"fields",null),h([f({type:Uy,value:null,json:{write:!0}})],Gn.prototype,"field1",null),h([f({type:Uy,value:null,json:{write:!0}})],Gn.prototype,"field2",null),h([f({type:zSt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gn.prototype,"flowTheme",null),h([f({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Gn.prototype,"focus",null),h([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Gn.prototype,"isAutoGenerated",void 0),h([f({type:Number,value:null,json:{type:mn,write:!0}})],Gn.prototype,"numClasses",null),h([f({type:xpe,json:{type:xpe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Gn.prototype,"lengthUnit",void 0),h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gn.prototype,"maxSliderValue",void 0),h([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gn.prototype,"minSliderValue",void 0),h([f({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gn.prototype,"statistics",null),h([f({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Gn.prototype,"standardDeviationInterval",null),h([f({type:SL.apiValues,value:null,json:{type:SL.jsonValues,read:SL.read,write:SL.write,origins:{"web-scene":{type:wpe.jsonValues,write:{writer:wpe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],Gn.prototype,"type",null),h([f({type:[NSt],json:{write:!0}})],Gn.prototype,"visualVariables",void 0),h([f({type:BSt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gn.prototype,"univariateSymbolStyle",null),h([f({type:kSt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gn.prototype,"univariateTheme",null),Gn=cq=h([N("esri.renderers.support.AuthoringInfo")],Gn);const VSt=Gn,gB=new zn({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let AA=class extends ke{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};h([f({type:VSt,json:{write:!0}})],AA.prototype,"authoringInfo",void 0),h([f({type:gB.apiValues,readOnly:!0,json:{type:gB.jsonValues,read:!1,write:{writer:gB.write,ignoreOrigin:!0}}})],AA.prototype,"type",void 0),AA=h([N("esri.renderers.Renderer")],AA);const GSt=AA;function jSt(t){var e,r;return((r=(e=t.match(HSt))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const HSt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var uq;let vN=uq=class extends ke{constructor(){super(...arguments),this.title=null}clone(){return new uq({title:this.title})}};h([f({type:String,json:{write:!0}})],vN.prototype,"title",void 0),vN=uq=h([N("esri.renderers.support.LegendOptions")],vN);var hq;let bN=hq=class extends vN{constructor(){super(...arguments),this.showLegend=null}clone(){return new hq({title:this.title,showLegend:this.showLegend})}};h([f({type:Boolean,json:{write:!0}})],bN.prototype,"showLegend",void 0),bN=hq=h([N("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],bN);const KMe=bN,yB=new zn({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Cd=class extends ke{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(J.getLogger(this).error(".field: field must be a string value"),null):kge(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};h([f()],Cd.prototype,"index",void 0),h([f({type:yB.apiValues,readOnly:!0,json:{read:yB.read,write:yB.write}})],Cd.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Cd.prototype,"field",void 0),h([_i("field")],Cd.prototype,"castField",null),h([f({type:String,json:{write:!0}})],Cd.prototype,"valueExpression",void 0),h([f({type:String,json:{write:!0}})],Cd.prototype,"valueExpressionTitle",void 0),h([f({readOnly:!0})],Cd.prototype,"arcadeRequired",null),h([f({type:KMe,json:{write:!0}})],Cd.prototype,"legendOptions",void 0),Cd=h([N("esri.renderers.visualVariables.VisualVariable")],Cd);const uM=Cd;var dq;let Hv=dq=class extends ke{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new dq({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};h([f({type:it,json:{type:[mn],write:!0}})],Hv.prototype,"color",void 0),h([f({type:String,json:{write:!0}})],Hv.prototype,"label",void 0),h([f({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Hv.prototype,"value",void 0),h([xr("value")],Hv.prototype,"writeValue",null),Hv=dq=h([N("esri.renderers.visualVariables.support.ColorStop")],Hv);const WSt=Hv;var pq;let Wv=pq=class extends uM{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new pq({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([f({readOnly:!0})],Wv.prototype,"cache",null),h([f({type:["color"],json:{type:["colorInfo"]}})],Wv.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],Wv.prototype,"normalizationField",void 0),h([f({type:[WSt],json:{write:!0}})],Wv.prototype,"stops",null),Wv=pq=h([N("esri.renderers.visualVariables.ColorVariable")],Wv);const e$e=Wv;var fq;let Sy=fq=class extends ke{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return fY(e.transparency)}writeOpacity(t,e,r){e[r]=pY(t)}clone(){return new fq({label:this.label,opacity:this.opacity,value:this.value})}};h([f({type:String,json:{write:!0}})],Sy.prototype,"label",void 0),h([f({type:Number,json:{type:mn,write:{target:"transparency"}}})],Sy.prototype,"opacity",void 0),h([lr("opacity",["transparency"])],Sy.prototype,"readOpacity",null),h([xr("opacity")],Sy.prototype,"writeOpacity",null),h([f({type:Number,json:{write:!0}})],Sy.prototype,"value",void 0),Sy=fq=h([N("esri.renderers.visualVariables.support.OpacityStop")],Sy);const qSt=Sy;var mq;let qv=mq=class extends uM{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new mq({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([f({readOnly:!0})],qv.prototype,"cache",null),h([f({type:["opacity"],json:{type:["transparencyInfo"]}})],qv.prototype,"type",void 0),h([f({type:String,json:{write:!0}})],qv.prototype,"normalizationField",void 0),h([f({type:[qSt],json:{write:!0}})],qv.prototype,"stops",null),qv=mq=h([N("esri.renderers.visualVariables.OpacityVariable")],qv);const t$e=qv;var gq;let Jm=gq=class extends uM{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const n=`visualVariables[${this.index}]`;i.messages.push(new Y("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:i}))}}clone(){return new gq({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};h([f({readOnly:!0})],Jm.prototype,"cache",null),h([f({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Jm.prototype,"axis",void 0),h([f({type:["rotation"],json:{type:["rotationInfo"]}})],Jm.prototype,"type",void 0),h([f({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Jm.prototype,"rotationType",void 0),h([f({type:String,json:{write:!0}})],Jm.prototype,"valueExpressionTitle",void 0),h([xr("web-scene","valueExpressionTitle")],Jm.prototype,"writeValueExpressionTitleWebScene",null),Jm=gq=h([N("esri.renderers.visualVariables.RotationVariable")],Jm);const r$e=Jm;var yq;let j2=yq=class extends ke{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new yq({label:this.label,size:this.size,value:this.value})}};h([f({type:String,json:{write:!0}})],j2.prototype,"label",void 0),h([f({type:Number,cast:gn,json:{write:!0}})],j2.prototype,"size",void 0),h([f({type:Number,json:{write:!0}})],j2.prototype,"value",void 0),j2=yq=h([N("esri.renderers.visualVariables.support.SizeStop")],j2);const XSt=j2;var _q;let wN=_q=class extends KMe{constructor(){super(...arguments),this.customValues=null}clone(){return new _q({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};h([f({type:[Number],json:{write:!0}})],wN.prototype,"customValues",void 0),wN=_q=h([N("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],wN);const YSt=wN;var vq;const EL=new zn({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),bq=new zn({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Tpe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?gn(t):t.type==="size"?gT(t)?t:(delete(t={...t}).type,new ii(t)):void 0}function Spe(t,e,r){if(typeof t!="object")return t;const i=new ii;return i.read(t,r),i}let ii=vq=class extends uM{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&fCe.test(this.valueExpression)}}set expression(t){J.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){gT(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),gT(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return pCe(this)}set maxDataValue(t){t&&this.stops&&(J.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(J.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return Tpe(t)}readMaxSize(t,e,r){return Spe(t,e,r)}set minDataValue(t){t&&this.stops&&(J.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(J.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return Tpe(t)}readMinSize(t,e,r){return Spe(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(J.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return Ent(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;i.messages.push(new Y("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?bq.read(t):null}clone(){return new vq({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:gT(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:gT(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===yo.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===yo.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};h([f({readOnly:!0})],ii.prototype,"cache",null),h([f({type:EL.apiValues,json:{type:EL.jsonValues,origins:{"web-map":{read:!1}},read:EL.read,write:EL.write}})],ii.prototype,"axis",void 0),h([f({type:String,value:null,json:{read:!1}})],ii.prototype,"expression",null),h([f()],ii.prototype,"index",null),h([f({type:String,readOnly:!0})],ii.prototype,"inputValueType",null),h([f({type:YSt,json:{write:!0}})],ii.prototype,"legendOptions",void 0),h([f({type:Number,value:null,json:{write:!0}})],ii.prototype,"maxDataValue",null),h([f({type:Number,value:null,json:{write:!0}})],ii.prototype,"maxSize",null),h([_i("maxSize")],ii.prototype,"castMaxSize",null),h([lr("maxSize")],ii.prototype,"readMaxSize",null),h([f({type:Number,value:null,json:{write:!0}})],ii.prototype,"minDataValue",null),h([f({type:Number,value:null,json:{write:!0}})],ii.prototype,"minSize",null),h([_i("minSize")],ii.prototype,"castMinSize",null),h([lr("minSize")],ii.prototype,"readMinSize",null),h([f({type:String,json:{write:!0}})],ii.prototype,"normalizationField",void 0),h([f({readOnly:!0})],ii.prototype,"arcadeRequired",null),h([f({type:String})],ii.prototype,"scaleBy",void 0),h([f({type:[XSt],value:null,json:{write:!0}})],ii.prototype,"stops",null),h([f({type:["outline"],json:{write:!0}})],ii.prototype,"target",void 0),h([f({type:String,readOnly:!0})],ii.prototype,"transformationType",null),h([f({type:["size"],json:{type:["sizeInfo"]}})],ii.prototype,"type",void 0),h([f({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],ii.prototype,"useSymbolValue",void 0),h([f({type:String,json:{write:!0}})],ii.prototype,"valueExpression",void 0),h([lr("valueExpression",["valueExpression","expression"])],ii.prototype,"readValueExpression",null),h([xr("web-scene","valueExpression")],ii.prototype,"writeValueExpressionWebScene",null),h([f({type:["radius","diameter","area","width","distance"],json:{write:!0}})],ii.prototype,"valueRepresentation",void 0),h([f({type:bq.apiValues,json:{write:bq.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],ii.prototype,"valueUnit",void 0),h([lr("valueUnit")],ii.prototype,"readValueUnit",null),ii=vq=h([N("esri.renderers.visualVariables.SizeVariable")],ii);const i$e=ii,ZSt={color:e$e,size:i$e,opacity:t$e,rotation:r$e},QSt=new zn({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),JSt=/^\[([^\]]+)\]$/i;let xN=class extends xe{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let n=null;return n=r.target===i.target?0:r.target?1:-1,n});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:n,rotationType:s}=r,o=n&&n.match(JSt),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=QSt.read(l.type),u=ZSt[c];u||(J.getLogger(this).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new D_("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const d=new u;return d.read(l,i),d})}writeVariables(e,r){const i=[];for(const n of e){const s=n.toJSON(r);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};h([f()],xN.prototype,"visualVariables",null),xN=h([N("esri.renderers.visualVariables.VisualVariableFactory")],xN);const KSt=xN,eEt={base:uM,key:"type",typeMap:{opacity:t$e,color:e$e,rotation:r$e,size:i$e}},tEt=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new KSt}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,n){return this._vvFactory.readVariables(r,i,n)}writeVisualVariables(r,i,n,s){i[n]=this._vvFactory.writeVariables(r,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const n=this.visualVariables;return n?n.filter(s=>s.type===r&&(typeof i=="string"?s.target===i:i!==!1||!s.target)):[]}async collectVVRequiredFields(r,i){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&rw(r,i,s.field),s.normalizationField&&rw(r,i,s.normalizationField),s.valueExpression&&(rEt(s.valueExpression,r,i)||await kg(r,i,s.valueExpression)))}};return h([f({types:[eEt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),h([lr("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),h([xr("visualVariables")],e.prototype,"writeVisualVariables",null),e=h([N("esri.renderers.mixins.VisualVariablesMixin")],e),e};function rEt(t,e,r){const i=jSt(t);return i!=null&&(rw(e,r,i),!0)}const iEt={types:Cze,json:{write:{writer:W5},origins:{"web-scene":{types:Hre,write:{writer:W5},read:{reader:PX({types:Hre})}}}}},F9t={types:{base:Rc,key:"type",typeMap:{"simple-fill":FT.typeMap["simple-fill"],"picture-fill":FT.typeMap["picture-fill"],"polygon-3d":FT.typeMap["polygon-3d"]}},json:{write:{writer:W5},origins:{"web-scene":{type:SP,write:{writer:W5}}}}},U9t={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var wq;let Xv=wq=class extends tEt(GSt){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new wq({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ye(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};h([f({type:String,json:{write:!0}})],Xv.prototype,"description",void 0),h([f({type:String,json:{write:!0}})],Xv.prototype,"label",void 0),h([f(iEt)],Xv.prototype,"symbol",void 0),h([Vt({simple:"simple"})],Xv.prototype,"type",void 0),Xv=wq=h([N("esri.renderers.SimpleRenderer")],Xv);const nEt=Xv;function sEt(t,e){ai.useEffect(()=>{t!==void 0&&oEt(t)},[t,e])}function oEt(t){aEt(t),uEt(t),hEt(t)}function aEt(t){const e=t.map.allLayers.find(({title:r})=>r==="Buildings");e!==void 0&&(e.renderer=lEt())}const lEt=(t=Math.floor(Math.random()*365))=>new nEt({symbol:new vE({symbolLayers:[new Fw({material:{color:iq(t,100,90),colorMixMode:"replace"},edges:new qY({size:P_*.15,color:iq(t,100,90,.3)})})]})}),cEt=VF(Array.from({length:24},(t,e)=>e));function uEt(t){const e=new Date;e.setHours(cEt()),t.environment.lighting.date=e}function hEt(t){t.environment.weather=pEt()()}const dEt=[()=>new Q4({cloudCover:Math.random()}),()=>new Dwe({cloudCover:Math.random()}),()=>new Fwe({cloudCover:Math.random(),precipitation:Math.random()}),()=>new Uwe({cloudCover:Math.random(),precipitation:Math.random()}),()=>new Nwe({fogStrength:Math.min(Math.random(),.9)})],pEt=VF(dEt),n$e=t=>function({isPaused:r,board:i,nextShapes:n,score:s}){const o=ai.useMemo(()=>LSt(t),[t]),[a,l]=ai.useState(null),[c,u]=ai.useState(void 0);ai.useEffect(()=>{if(a===null)return;const y=new Wye({basemap:new iR({portalItem:{id:"0560e29930dc4d5ebeb58c635c0909c9"}})}),_=new cTt({container:a,map:y,environment:{lighting:{directShadowsEnabled:!0}},camera:o.initialCamera,qualityProfile:"high"});return _.ui.remove(_.ui.getComponents()),_.when(()=>{const v=_.map.allLayers.find(({title:b})=>b==="Places and Labels");v&&(v.visible=!1),u(_)}),()=>_.destroy()},[a,o]);const d=ai.useRef(s),p=d.current>s,m=ai.useRef(0);return p&&t==="stationary"&&(m.current+=1),d.current=s,ai.useEffect(()=>{c!==void 0&&(c.camera=o.initialCamera)},[c,o,m.current]),RSt(c,i,o,r),sEt(c,s),st.jsxs(st.Fragment,{children:[st.jsx("div",{className:"w-full h-full",ref:l}),st.jsx("div",{className:"absolute top-0 right-0 drop-shadow-[0_1px_2px_#000]",children:st.jsx(Jme,{score:s,nextShapes:n})})]})},fEt=n$e("animated"),mEt=n$e("stationary"),iS="bg-white hover:bg-gray-200 p-4 rounded text-black",gEt={[Ss.sceneryRenderer]:mEt,[Ss.panoramaRenderer]:fEt,[Ss.gridRenderer]:ZLe};function yEt({onSelect:t}){return st.jsxs("div",{className:"flex flex-col gap-8 h-full p-8",children:[st.jsx("span",{className:"flex-1"}),st.jsxs("div",{className:"flex flex-col gap-8",children:[st.jsx("h1",{className:"text-5xl",children:Ss.title}),st.jsx("div",{className:"flex gap-4",children:Object.entries(gEt).map(([e,r])=>st.jsx("button",{className:iS,type:"button",onClick:()=>t(r),children:e},e))})]}),st.jsx("div",{className:"flex-1 flex justify-end items-end text-end",children:st.jsxs("span",{children:[st.jsx("a",{href:"https://github.com/maxpatiiuk/tetris-react/",className:"text-blue-500",target:"_blank",rel:"noopener",children:Ss.sourceCode}),st.jsx("br",{}),Ss.inspiredBy(e=>st.jsx("a",{href:"https://youtu.be/PFVL6t8IHE8?si=qjVQxbNN9RQQmnud&t=21",className:"text-blue-500",target:"_blank",rel:"noopener",children:e})),st.jsx("br",{}),Ss.instructions]})})]})}function _Et({score:t,onRestart:e,onChangeMap:r}){const[i,n]=Qme(),s=ai.useRef(i).current;return ai.useEffect(()=>n(Math.max(i,t)),[t,i]),st.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center text-3xl text-center",children:st.jsxs("span",{className:"flex flex-col gap-4",children:[st.jsx("h1",{className:"pb-4 text-6xl",children:Ss.gameOver}),st.jsxs("h2",{children:[Ss.yourScore," ",t]}),st.jsxs("h2",{children:[Ss.yourBestScore," ",s]}),st.jsxs("div",{className:"flex gap-4",children:[st.jsx("button",{className:iS,type:"button",onClick:e,children:Ss.playAgain}),st.jsx("button",{className:iS,type:"button",onClick:r,children:Ss.changeMap})]})]})})}function vEt({onSave:t,onLoad:e,onChangeMap:r}){return st.jsx("div",{className:"absolute inset-0 flex items-center justify-center w-screen h-screen text-4xl text-center bg-black/70",children:st.jsxs("div",{className:"flex flex-col gap-8",children:[Ss.paused,st.jsx("span",{children:Ss.pressKeyToResume(st.jsx("span",{className:"rounded-xl p-px text-black bg-white",children:Ss.esc}))}),st.jsxs("div",{className:"flex gap-4",children:[st.jsx("button",{className:iS,type:"button",onClick:t,children:Ss.saveGame}),st.jsx("button",{className:iS,type:"button",onClick:e,children:Ss.loadGame}),st.jsx("button",{className:iS,type:"button",onClick:r,children:Ss.changeMap})]})]})})}const bEt=Object.values({1984:"1YjETQrefLDU6gUdVdjkxK","Starlight Infinite <area X>":"3ICMKtmOim2EQWPGZQlJvm","Singularity X <area X>":"3GR0kABoqo4yYwb0E7CRbt","Butterfly Effect <area X>":"38TW4C6Ozqvpc93ay4E1xO","Butterfly Effect<area X> - Instrumental Mix":"63unOawz5mnIJLhTNdY0B2","Cycle of Silence <area X>":"0y1KtxudTFGVauom0OAw4a","Awakening <area X>":"0Axjc4z6NuEvnI33yfL2Jd","Midnight Sky (Moon Lounge Mix)":"3ObVJtrHe9m1pD0kQjFlnL","1989, Pt. 2":"2FPOAypb6OTKPcVmjs6Fg7",Deserve:"38us10664RE7LzKuP0fubG","Into the Darkness":"17GpTGIlK1wj9sTHkmEBVf",Roses:"1JtdpEnMkAlRHaqAFZWaiE","Midnight Sky":"35S2ehMIqht4nyMC9trphK",Pusher:"0e9Pc6OTaRYbLzAbQcjwD9","Mind Echoes":"3FJ9a6f0Q0onNzAsB1mbqc","Lion Garden":"2yikQFeZTqEVY3pwvOTdKE","All on You":"2zh9jc1IJtUeJoqxK70rki","Deep Dream":"7c9bKzkJ3VcNtmvbzYRFNC",Hope:"0gJ3TBmlm3uvbg7w1A47p3","Drowning Valley":"1bQGr0Yb814NklGQLwtJkz",Walls:"1ySshlSe4XTK8h9aV7cHlu","Two of Us":"1ebNrHTKWLTacblm1AKjKC","Connected (Yours Forever)":"0QpNG88fUtqBFv3jSPKFzH","World of Colors":"6s6wJWlQOrhutApxBjALcL","Like Never Before":"5rwd85f9zKqEqrLkJy21jl",Here:"5DysxV3wWy5BFDjLyKpwJR",Hometown:"1afYzACckpTdtIcd6a1jWE","'Aumakua":"0ES5svcsn175HeltIe3w2y",Chains:"53YBoGEL4eoqHaiDE2rdFG",Snows:"2mXWsRaFeA6MQk51lS4Wgc","3 Senses":"63wf92i45hD2svEtZFaMXi",Boscage:"6XtFtwIRnkUMnj6skKX0vF",Temptation:"70272Cf8IvttxP4k0dEcI5","New Beginnings":"0a2gqb08h29F854LOcodDi","You and I":"5gbll0kKGZ33zLxS4tP1Ah","Lunar Discourse":"1UguHfmcgaEvZcAXAbPsTI",Flames:"0M6lfckrMvgq8tJm9rAfBd","Spring Field":"5V79CYii3UmXypu0ARb8XF","Bright Shadow":"7Bk8zpZzbM3fKk5IEdxvaT",Joy:"6XJGtJDhnAZJkNUpEpzmRA","Next Chapter":"1ikwQqffDGOvNWZTC6VodQ","Connected (Yours Forever) [In-Game Mix]":"781SaJ3m5CzRWtx7yycM0e","Connected (Yours Forever) [Obvious Sky Mix]":"0SIGIMjkTPT4msCRdEAf8g","Always Been but Never Dreamed":"0T4pRzSKGRCtq7ZqA3RHdV","So They Say":"2oOB6hUcj70AekyncV54sE","World of Colors (In-Game Mix)":"3uc5T2QGpCtsVsFQ8J7Jlm","Look Up":"01YImcxm3FqgmFSTvDagLc",Unfold:"1FzV8n4LhHE06a2lopplyj"}),wEt=VF(bEt,1);function xEt(){return ai.useCallback(()=>`spotify:track:${wEt()}`,[])}const jK=document.createElement("script");jK.src="https://open.spotify.com/embed-podcast/iframe-api/v1";jK.async=!0;document.body.appendChild(jK);Object.defineProperty(window,"onSpotifyIframeApiReady",{configurable:!0,value:t=>{s$e=t,TN==null||TN(t)}});let TN,s$e;function TEt(){const[t,e]=ai.useState(null),[r,i]=ai.useState(s$e),[n,s]=ai.useState(void 0),o=xEt();return TN=i,ai.useEffect(()=>t===null||r===void 0?void 0:r.createController(document.createElement("div"),{uri:o(),theme:"dark"},a=>{t.append(a.iframeElement),a.play(),s(a)}),[t,r,o]),ai.useEffect(()=>{if(n===void 0)return;const a=n.on("playback_update",({data:{position:l,duration:c}})=>{l===0||l!==c||(n.loadUri(o()),n.play())});return()=>{a(),n==null||n.destroy()}},[n]),st.jsx("div",{ref:e,className:`
        h-20 z-10 absolute top-0 left-0 w-[min(100%,25rem)]
        [&>iframe]:h-full flex flex-row-reverse align-center bg-[#282828]
        rounded-tl-none rounded-lg
      `,children:st.jsx("button",{title:Ss.nextSong,"aria-label":Ss.nextSong,className:"w-12 h-full p-2 hover:brightness-75",onClick:()=>{n==null||n.loadUri(o()),n==null||n.play()},children:SEt})})}const SEt=st.jsx("svg",{fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:st.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z"})});function EEt(){const[t,e]=ai.useState(),[r,i]=ai.useState(!1);return st.jsxs(st.Fragment,{children:[t===void 0?st.jsx(yEt,{onSelect:n=>{i(!0),e(()=>n)}}):st.jsx(CEt,{renderer:t,onChangeMap:()=>e(void 0)}),r&&st.jsx(TEt,{})]})}function CEt({renderer:t,onChangeMap:e}){const[r,i]=ai.useState();return st.jsxs(st.Fragment,{children:[st.jsx(AEt,{isGameOver:typeof r=="number",renderer:t,onGameOver:i,onChangeMap:e}),typeof r=="number"&&st.jsx(_Et,{score:r,onChangeMap:e,onRestart:()=>i(void 0)})]})}function AEt({renderer:t,isGameOver:e,onGameOver:r,onChangeMap:i}){const[n,s]=ai.useState(()=>Ay.initial(Array.from({length:5},UL))),o=ai.useRef(n);o.current=n;const[a,l]=YLe(),c=Object.keys(n.currentShapeLocation).length===0,u=ai.useRef(c),d=ai.useRef(0);return c&&!u.current&&(d.current+=1),u.current=c,ai.useEffect(()=>{if(e)return;function p(){const{isGameOver:y=!1,..._}=Ay.gravity(o.current,UL());y&&r(o.current.score),s(_)}p();const m=setInterval(p,ILe/Math.log(3+n.score/Xme));return()=>clearInterval(m)},[d.current,e]),ai.useEffect(()=>{if(e)return;s(Ay.initial(Array.from({length:5},UL))),document.addEventListener("keydown",p,{capture:!0});function p(T){T.key!==m&&clearTimeout(y),T.key in Epe?(_.add(T.key),m!==T.key&&(m=T.key,b()),T.preventDefault(),T.stopPropagation()):(m=void 0,T.key==="Escape"||T.key==="p"?s(Ay.togglePause(o.current)):T.key===" "&&s(Ay.hardDrop(o.current)))}let m,y;const _=new Set,v=100;function b(){m!==void 0&&(s(Ay.move(o.current,Epe[m])),m!=="ArrowUp"&&(y=setTimeout(b,v)))}document.addEventListener("keyup",x,{capture:!0});function x(T){_.delete(T.key),T.key===m&&(m=Array.from(_)[0],clearTimeout(y),b())}return()=>{m=void 0,document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("keyup",x,{capture:!0})}},[e]),st.jsxs("div",{className:"flex items-center justify-center w-screen h-screen text-white bg-black",children:[st.jsx(t,{board:n.board,nextShapes:n.nextShapes,score:n.score,isPaused:n.isPaused||e}),n.isPaused&&st.jsx(vEt,{onLoad:()=>s({...a,isPaused:!1}),onSave:()=>l(n),onChangeMap:i})]})}const Epe={ArrowUp:Nn.UP,ArrowDown:Nn.DOWN,ArrowLeft:Nn.LEFT,ArrowRight:Nn.RIGHT,w:Nn.UP,s:Nn.DOWN,a:Nn.LEFT,d:Nn.RIGHT,k:Nn.UP,j:Nn.DOWN,h:Nn.LEFT,l:Nn.RIGHT};_B.createRoot(document.getElementById("root")).render(st.jsx(ai.StrictMode,{children:st.jsx(EEt,{})}));export{Mtt as $,tPe as A,g1t as B,Lxe as C,I5 as D,oqe as E,iat as F,wot as G,Eot as H,OK as I,UJ as J,Ogt as K,Agt as L,tU as M,Rgt as N,U5 as O,_st as P,Z1t as Q,aPe as R,BHe as S,K1t as T,uPe as U,N_t as V,tvt as W,pPe as X,Jot as Y,oU as Z,VOe as _,Mxe as a,Ue as a$,pvt as a0,xvt as a1,Ivt as a2,Dvt as a3,Fvt as a4,iot as a5,fPe as a6,gvt as a7,ebt as a8,hct as a9,Hye as aA,Bg as aB,Dh as aC,O_ as aD,o0e as aE,ir as aF,ue as aG,Br as aH,qb as aI,ZH as aJ,z_ as aK,Ymt as aL,An as aM,hE as aN,yu as aO,ss as aP,mO as aQ,Age as aR,Za as aS,Ol as aT,d6 as aU,Hi as aV,dS as aW,LEt as aX,Eu as aY,Xn as aZ,E as a_,Fct as aa,vdt as ab,kdt as ac,Idt as ad,Df as ae,Vi as af,Pr as ag,Me as ah,h as ai,f as aj,a1 as ak,N as al,RY as am,pre as an,xe as ao,Fmt as ap,Fi as aq,Y as ar,Mw as as,kn as at,Nmt as au,JO as av,ce as aw,Bt as ax,lr as ay,CP as az,e2e as b,RCt as b$,KS as b0,bs as b1,BJ as b2,Hw as b3,Pt as b4,W0e as b5,s3t as b6,Ng as b7,D_ as b8,Mh as b9,$Y as bA,eE as bB,B3t as bC,xP as bD,up as bE,ha as bF,dY as bG,Qt as bH,ge as bI,A6 as bJ,Lw as bK,yw as bL,e1 as bM,Nt as bN,IEt as bO,fV as bP,ege as bQ,t_e as bR,tAt as bS,V3t as bT,UP as bU,SD as bV,FZ as bW,fRt as bX,xr as bY,Jr as bZ,a3t as b_,hRt as ba,NM as bb,St as bc,NBe as bd,xE as be,Ja as bf,nZ as bg,it as bh,n_ as bi,Uw as bj,EP as bk,wt as bl,pR as bm,Zn as bn,jLt as bo,HLt as bp,Ort as bq,Hg as br,eLt as bs,jNt as bt,I_ as bu,Q3t as bv,Xye as bw,_lt as bx,mge as by,J as bz,Xqe as c,$w as c$,sn as c0,_g as c1,H0e as c2,U4e as c3,vte as c4,s6 as c5,LCt as c6,ze as c7,m6 as c8,yP as c9,_rt as cA,pRt as cB,I9e as cC,s1e as cD,J3t as cE,lAt as cF,_9e as cG,I4 as cH,O4 as cI,W3t as cJ,K3t as cK,FV as cL,Js as cM,CBe as cN,Pw as cO,elt as cP,tlt as cQ,yje as cR,Wje as cS,uR as cT,_Rt as cU,XFt as cV,hK as cW,P6 as cX,t6 as cY,el as cZ,Qr as c_,Dr as ca,j4 as cb,TS as cc,YF as cd,h5e as ce,fo as cf,d5e as cg,p5e as ch,f5e as ci,Qa as cj,ke as ck,ye as cl,gft as cm,se as cn,ko as co,zn as cp,wrt as cq,OY as cr,oR as cs,CY as ct,Bn as cu,Wo as cv,PX as cw,Cze as cx,nEt as cy,Cu as cz,UXe as d,Sn as d$,bft as d0,b4e as d1,Vt as d2,VBe as d3,gbe as d4,Hge as d5,XF as d6,KY as d7,ES as d8,lR as d9,Ih as dA,Aye as dB,$Be as dC,Sb as dD,Yb as dE,SY as dF,TY as dG,Gye as dH,EY as dI,R3t as dJ,w3t as dK,H3t as dL,sUe as dM,vi as dN,Cs as dO,Xf as dP,ot as dQ,me as dR,ne as dS,O as dT,sR as dU,x4t as dV,dt as dW,D6 as dX,fR as dY,aP as dZ,OG as d_,yge as da,uu as db,hze as dc,KO as dd,dze as de,HPe as df,$At as dg,$Me as dh,xF as di,gSt as dj,Se as dk,nE as dl,m3t as dm,Uge as dn,A9t as dp,GMe as dq,b4t as dr,IFe as ds,Yr as dt,VL as du,lit as dv,ps as dw,OAt as dx,NLt as dy,jt as dz,XXe as e,Cb as e$,AG as e0,PG as e1,V4 as e2,Sve as e3,l3t as e4,$R as e5,MFe as e6,on as e7,CCe as e8,h0 as e9,ua as eA,L6e as eB,MLt as eC,Yit as eD,Vyt as eE,o3 as eF,$i as eG,zr as eH,X_ as eI,Sh as eJ,rn as eK,G4 as eL,SMt as eM,YM as eN,ize as eO,fP as eP,uTt as eQ,AFt as eR,hTt as eS,tR as eT,Rc as eU,C6 as eV,_Ot as eW,h0e as eX,fwe as eY,mn as eZ,S_ as e_,Gje as ea,ICt as eb,im as ec,Xb as ed,ep as ee,zEt as ef,J_t as eg,K_t as eh,H_t as ei,BUt as ej,aF as ek,X8t as el,t1t as em,IMe as en,t5e as eo,vrt as ep,hnt as eq,dnt as er,AY as es,uCe as et,PLt as eu,RLt as ev,sAt as ew,oAt as ex,rAt as ey,nAt as ez,Fit as f,ZIt as f$,s7 as f0,fTt as f1,kd as f2,iu as f3,_i as f4,pP as f5,Bkt as f6,Gkt as f7,zkt as f8,XPe as f9,_h as fA,Zg as fB,T5e as fC,iBe as fD,OCt as fE,YCt as fF,Zmt as fG,COt as fH,GF as fI,HGe as fJ,hre as fK,wr as fL,_Ct as fM,yCt as fN,Ok as fO,fY as fP,sw as fQ,pTt as fR,Frt as fS,gn as fT,kAt as fU,zAt as fV,T4t as fW,PFe as fX,YIt as fY,vEe as fZ,uJ as f_,i9t as fa,Txt as fb,Ykt as fc,yxt as fd,n9t as fe,kkt as ff,Qkt as fg,s9t as fh,Zkt as fi,OEt as fj,DFe as fk,KV as fl,e7 as fm,rY as fn,aDe as fo,o1 as fp,o3t as fq,pBe as fr,re as fs,De as ft,_e as fu,AX as fv,e4 as fw,VNt as fx,v8e as fy,qO as fz,aQ as g,_je as g$,QIt as g0,nu as g1,lp as g2,uMt as g3,f6 as g4,Ys as g5,Yi as g6,r6 as g7,Kr as g8,pa as g9,us as gA,_Y as gB,Dg as gC,Ww as gD,sLt as gE,nLt as gF,J_ as gG,wp as gH,qP as gI,zgt as gJ,Wwt as gK,MY as gL,Ud as gM,c7 as gN,e5e as gO,NIt as gP,iT as gQ,DG as gR,BIt as gS,Yoe as gT,p3t as gU,UIt as gV,wc as gW,zg as gX,dr as gY,_P as gZ,Xa as g_,Ug as ga,Oi as gb,Mkt as gc,i7 as gd,ma as ge,Mr as gf,Sit as gg,RRe as gh,wX as gi,xX as gj,hDe as gk,DEt as gl,t0 as gm,HX as gn,vQ as go,rQ as gp,y8t as gq,S8t as gr,_Q as gs,Ws as gt,te as gu,oe as gv,Bot as gw,as as gx,Tit as gy,hi as gz,Vqe as h,l4e as h$,pb as h0,ci as h1,vn as h2,bVe as h3,Xd as h4,_p as h5,Pb as h6,oOt as h7,AVe as h8,ki as h9,DCt as hA,M9t as hB,Ukt as hC,g3t as hD,VTt as hE,R9t as hF,P9t as hG,D as hH,le as hI,Ui as hJ,rr as hK,Hr as hL,qd as hM,_n as hN,Xe as hO,si as hP,Cft as hQ,$e as hR,m7e as hS,Wy as hT,Hn as hU,Pi as hV,To as hW,SQ as hX,Skt as hY,HEt as hZ,i4e as h_,PEt as ha,V4e as hb,gS as hc,GX as hd,iDe as he,Ir as hf,AW as hg,OW as hh,G3t as hi,j3t as hj,E8e as hk,S8e as hl,q6e as hm,rre as hn,nw as ho,iw as hp,EAt as hq,sc as hr,I3t as hs,$T as ht,Wf as hu,$2t as hv,OP as hw,gp as hx,XO as hy,UV as hz,wCe as i,$t as i$,gV as i0,h4e as i1,_u as i2,Ky as i3,NEt as i4,oCt as i5,q5t as i6,_ft as i7,BA as i8,SLt as i9,S8 as iA,Ft as iB,em as iC,r1 as iD,m1 as iE,A8 as iF,Fo as iG,IJ as iH,E8 as iI,DE as iJ,Gst as iK,XZ as iL,KQ as iM,wF as iN,nMt as iO,yp as iP,I8 as iQ,EOe as iR,Do as iS,y3t as iT,v2e as iU,Z5e as iV,yS as iW,jIt as iX,_7e as iY,N5 as iZ,Ri as i_,mr as ia,xc as ib,Cl as ic,w as id,fn as ie,xu as ig,Ye as ih,Ce as ii,$5 as ij,cm as ik,rt as il,_r as im,Cc as io,ve as ip,U as iq,ui as ir,Tr as is,vr as it,fr as iu,Ot as iv,u0 as iw,J6 as ix,f1 as iy,$l as iz,Sw as j,uut as j$,vh as j0,ae as j1,Hle as j2,yT as j3,Bo as j4,Zs as j5,dMt as j6,Ie as j7,AP as j8,In as j9,Oc as jA,VOt as jB,WBe as jC,a6 as jD,yY as jE,KU as jF,Kt as jG,zo as jH,ZY as jI,Pne as jJ,_Ae as jK,bAe as jL,LMe as jM,Ua as jN,vO as jO,Ub as jP,sAe as jQ,$ut as jR,xw as jS,bnt as jT,Qf as jU,dCe as jV,d3t as jW,xnt as jX,lut as jY,rut as jZ,iut as j_,nDe as ja,dRt as jb,Cwe as jc,mRt as jd,gRt as je,Tve as jf,qU as jg,Vre as jh,M3t as ji,SS as jj,RAt as jk,BEt as jl,RX as jm,ow as jn,mS as jo,GSt as jp,yRt as jq,Jkt as jr,S2t as js,jkt as jt,r9t as ju,t9t as jv,obt as jw,n0e as jx,FT as jy,pY as jz,s0t as k,tEt as k$,sut as k0,out as k1,pp as k2,nut as k3,ya as k4,cut as k5,DP as k6,s8 as k7,ds as k8,wnt as k9,wR as kA,Vo as kB,qs as kC,wf as kD,vAt as kE,iOt as kF,Q2e as kG,kw as kH,zh as kI,jy as kJ,Xi as kK,$ as kL,UCt as kM,uP as kN,PP as kO,kEt as kP,yft as kQ,mft as kR,g7e as kS,TCt as kT,Hf as kU,ILt as kV,$Lt as kW,KSe as kX,LIt as kY,Oye as kZ,iEt as k_,aut as ka,a8 as kb,kh as kc,d1 as kd,XT as ke,Ka as kf,Mx as kg,GIt as kh,eAt as ki,q3t as kj,Y3t as kk,X3t as kl,Z3t as km,aR as kn,rw as ko,aAt as kp,gEe as kq,JF as kr,Lg as ks,_te as kt,vW as ku,JAt as kv,T0e as kw,eOt as kx,KAt as ky,Tf as kz,Xnt as l,Lh as l$,kge as l0,BAt as l1,kg as l2,F9t as l3,vN as l4,U9t as l5,AAe as l6,bE as l7,ADe as l8,Eve as l9,Pkt as lA,ia as lB,_V as lC,Cje as lD,_R as lE,Bi as lF,$ve as lG,i7e as lH,yOt as lI,Jt as lJ,fu as lK,Et as lL,Gi as lM,p1 as lN,h1 as lO,h3t as lP,t4t as lQ,j0e as lR,c3t as lS,X0e as lT,es as lU,It as lV,f1e as lW,T9e as lX,L_ as lY,jCt as lZ,NV as l_,Af as la,ZNt as lb,aW as lc,rCt as ld,rpt as le,E4e as lf,TNt as lg,NNt as lh,xNt as li,bNt as lj,nT as lk,flt as ll,wNt as lm,Kkt as ln,T2t as lo,Xkt as lp,w2t as lq,Wkt as lr,qkt as ls,fMe as lt,e9t as lu,Vkt as lv,I2t as lw,e0 as lx,Abe as ly,qVe as lz,O0t as m,xo as m$,Ld as m0,er as m1,dc as m2,zZ as m3,kZ as m4,Lr as m5,dOt as m6,MVe as m7,uU as m8,cM as m9,or as mA,l6 as mB,L3t as mC,MCt as mD,nFe as mE,fe as mF,g8t as mG,v8t as mH,CAt as mI,Z9e as mJ,zv as mK,f8t as mL,h5 as mM,Wr as mN,PAt as mO,fIt as mP,nSe as mQ,Vr as mR,Mi as mS,FJ as mT,yr as mU,pu as mV,ZV as mW,pw as mX,t8 as mY,Pc as mZ,c0 as m_,qa as ma,HAt as mb,wOt as mc,nge as md,UX as me,PCt as mf,dP as mg,S4e as mh,i6 as mi,XCt as mj,rge as mk,y0e as ml,o6 as mm,ACt as mn,$te as mo,L1e as mp,Hkt as mq,Uh as mr,US as ms,$We as mt,JZ as mu,tVe as mv,Vw as mw,vHe as mx,lh as my,Ne as mz,GRe as n,va as n$,Qe as n0,Er as n1,Te as n2,fa as n3,gi as n4,E1e as n5,b8t as n6,w8t as n7,T8t as n8,YY as n9,Xoe as nA,FLt as nB,$3t as nC,ALt as nD,oCe as nE,lCe as nF,nCe as nG,eae as nH,Snt as nI,DIt as nJ,Bye as nK,K6e as nL,T3t as nM,tFe as nN,lFe as nO,cCe as nP,eY as nQ,JCt as nR,t3e as nS,dot as nT,Wa as nU,WSt as nV,wu as nW,k8 as nX,Lt as nY,Ml as nZ,Mc as n_,la as na,fVe as nb,x6 as nc,Le as nd,vp as ne,Ar as nf,gr as ng,bkt as nh,Eje as ni,N5t as nj,Cf as nk,RP as nl,Rye as nm,dEe as nn,eA as no,xbe as np,$kt as nq,i5 as nr,UAt as ns,i$e as nt,gT as nu,VSt as nv,XSt as nw,zA as nx,T_ as ny,DLt as nz,a1t as o,Wie as o$,Vh as o0,au as o1,aOt as o2,MP as o3,K6 as o4,fSe as o5,sOt as o6,Cet as o7,Dl as o8,yqe as o9,QS as oA,G_ as oB,gc as oC,HBe as oD,uOt as oE,hOt as oF,cw as oG,BV as oH,zf as oI,Lne as oJ,So as oK,fs as oL,CG as oM,VCt as oN,BCt as oO,lt as oP,qie as oQ,SX as oR,Mrt as oS,XIt as oT,Ac as oU,wZ as oV,yAt as oW,lOt as oX,J4 as oY,Cve as oZ,A3t as o_,bu as oa,MPt as ob,RPt as oc,PPt as od,dVe as oe,LT as of,stt as og,YS as oh,P6e as oi,lu as oj,Xrt as ok,aH as ol,nJ as om,_Ye as on,nVe as oo,rVe as op,pg as oq,mTt as or,vX as os,Au as ot,lYe as ou,$Ct as ov,e_ as ow,wo as ox,pOt as oy,Ive as oz,WRe as p,xkt as p$,am as p0,U6 as p1,dZ as p2,Nh as p3,fp as p4,jS as p5,vo as p6,C8 as p7,cSe as p8,wSe as p9,AS as pA,_At as pB,QQe as pC,SZ as pD,uve as pE,CS as pF,pbe as pG,QVe as pH,Gg as pI,j6 as pJ,bYe as pK,nOt as pL,Nne as pM,hMt as pN,hP as pO,zw as pP,oi as pQ,mOt as pR,Ec as pS,fS as pT,aBe as pU,Nf as pV,O1e as pW,lge as pX,pDe as pY,u3t as pZ,LZe as p_,Je as pa,eJ as pb,jd as pc,AAt as pd,bZ as pe,ple as pf,cMt as pg,vR as ph,g1e as pi,N_ as pj,cOt as pk,aU as pl,W4 as pm,Ust as pn,Ckt as po,qIt as pp,LS as pq,Okt as pr,Akt as ps,gP as pt,C3t as pu,Hie as pv,rf as pw,na as px,mR as py,TZ as pz,u1t as q,tCt as q$,FI as q0,TSe as q1,O_t as q2,iVe as q3,_8t as q4,FBe as q5,mhe as q6,eS as q7,sMt as q8,RS as q9,Ho as qA,uCt as qB,eu as qC,WIt as qD,NG as qE,zIt as qF,mit as qG,S6 as qH,Tpt as qI,hJ as qJ,$n as qK,Vpt as qL,g3e as qM,hAe as qN,N0e as qO,mbe as qP,XD as qQ,w4t as qR,PS as qS,OVe as qT,wg as qU,jJ as qV,z8 as qW,Gr as qX,D8t as qY,SCt as qZ,CX as q_,qBe as qa,Pn as qb,uOe as qc,_E as qd,zt as qe,mCe as qf,gCe as qg,tLt as qh,oht as qi,LC as qj,E6 as qk,SP as ql,vE as qm,Fw as qn,m1e as qo,xpt as qp,qit as qq,Hit as qr,pLt as qs,dLt as qt,jg as qu,zLt as qv,js as qw,Uo as qx,V5t as qy,PJ as qz,d1t as r,qe as r$,TR as r0,iLt as r1,kxe as r2,n_t as r3,x8t as r4,h_ as r5,_Ve as r6,ene as r7,ure as r8,Oft as r9,eO as rA,V6 as rB,Sbe as rC,fOt as rD,xHe as rE,Ert as rF,O3t as rG,UEt as rH,u6t as rI,E3t as rJ,HIt as rK,hc as rL,eCt as rM,jSt as rN,jot as rO,Hc as rP,pr as rQ,hs as rR,Un as rS,Ct as rT,yi as rU,No as rV,YQ as rW,Zf as rX,dIt as rY,At as rZ,Tt as r_,e6 as ra,Ht as rb,QSe as rc,JSe as rd,ZCt as re,$ce as rf,RW as rg,ld as rh,nF as ri,jFt as rj,sF as rk,lc as rl,uc as rm,$W as rn,PW as ro,IW as rp,MW as rq,Ice as rr,Zve as rs,Ywe as rt,_Z as ru,x4 as rv,fHe as rw,Hwe as rx,Qg as ry,k6 as rz,JRe as s,sht as s$,OLt as s0,FSt as s1,USt as s2,r$e as s3,zNt as s4,Dnt as s5,BNt as s6,yCe as s7,dCt as s8,JMe as s9,omt as sA,amt as sB,FA as sC,P8e as sD,Q9e as sE,ULt as sF,LLt as sG,Fze as sH,SG as sI,N9 as sJ,F9 as sK,MEt as sL,$Et as sM,ELt as sN,B_ as sO,Tye as sP,fRe as sQ,D0t as sR,hRe as sS,Y0t as sT,Cv as sU,xK as sV,wK as sW,Qce as sX,$0t as sY,Kce as sZ,olt as s_,ER as sa,QFe as sb,v4 as sc,c6 as sd,yrt as se,d1e as sf,HCt as sg,WCt as sh,qCt as si,RNe as sj,NFt as sk,HFt as sl,E3e as sm,ab as sn,Lce as so,DFt as sp,UFt as sq,ob as sr,IFt as ss,Iz as st,ZD as su,rm as sv,Pl as sw,Fh as sx,VEe as sy,uh as sz,YRe as t,IY as t$,KJ as t0,OAe as t1,eK as t2,RAe as t3,Kct as t4,uW as t5,$lt as t6,_3t as t7,vue as t8,fue as t9,$Nt as tA,INt as tB,Qae as tC,Kae as tD,Jae as tE,ONt as tF,RNt as tG,uue as tH,tue as tI,rue as tJ,iue as tK,Tue as tL,Zue as tM,Kue as tN,hue as tO,Que as tP,T6 as tQ,G3e as tR,LNt as tS,llt as tT,clt as tU,CNt as tV,ANt as tW,V3e as tX,ENt as tY,npt as tZ,ult as t_,Z6e as ta,mue as tb,Mue as tc,gue as td,P3t as te,xue as tf,kue as tg,zue as th,Bue as ti,x3t as tj,bY as tk,Cye as tl,v3t as tm,u8e as tn,t8e as to,b3t as tp,Vue as tq,S3t as tr,MAt as ts,SNt as tt,DNt as tu,Pue as tv,Lue as tw,MNt as tx,PNt as ty,ept as tz,Yxe as u,k_ as u0,f3 as u1,f9e as u2,p9e as u3,d9e as u4,n3t as u5,y9e as u6,o9t as u7,bOt as u8,bGe as u9,aft as uA,E_ as uB,SEe as uC,Zwe as uD,D3 as uE,DT as uF,qV as uG,tl as uH,pS as uI,TX as uJ,iRt as uK,pct as uL,_w as uM,B5e as uN,tOt as uO,JIt as uP,GLt as uQ,v4t as uR,E9t as uS,vGe as ua,UNt as ub,HF as uc,v9e as ud,ixt as ue,YDe as uf,L4 as ug,N4 as uh,aUe as ui,VEt as uj,iAt as uk,C9e as ul,A9e as um,Aie as un,GNt as uo,kNt as up,HY as uq,eTt as ur,Rkt as us,xOt as ut,cU as uu,GCt as uv,zCt as uw,kCt as ux,u6 as uy,mst as uz,AWe as v,Pxe as w,iqe as x,rO as y,f1t as z};
